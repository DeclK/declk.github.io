<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ONCE Semi-supervised Training</title>
      <link href="/archives/313cd849.html"/>
      <url>/archives/313cd849.html</url>
      
        <content type="html"><![CDATA[<h1 id="ONCE-Semi-Supervised-Training"><a href="#ONCE-Semi-Supervised-Training" class="headerlink" title="ONCE Semi-Supervised Training"></a>ONCE Semi-Supervised Training</h1><p>å­¦ä¹ è§„åˆ’ï¼š</p><ol><li><strong>dataset ç»“æ„æ•´ç†</strong></li><li>detector ç»“æ„æ•´ç†ï¼ˆalmost doneï¼‰ï¼Œæ¨¡å‹åè€Œæ˜¯æœ€å¥½ç†è§£çš„éƒ¨åˆ†</li><li><strong>semi-supervised æµç¨‹æ•´ç†ï¼ŒSESS + mean teacher</strong></li></ol><h2 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h2><h3 id="build-semi-dataset"><a href="#build-semi-dataset" class="headerlink" title="build_semi_dataset"></a>build_semi_dataset</h3><p>é€šè¿‡æ•°æ®é›†é…ç½®å»ºé€  datasets, dataloaders, samplers</p><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">build_semi_dataloader</span><span class="token punctuation">(</span>dataset_cfg<span class="token punctuation">,</span>                           class_names<span class="token punctuation">,</span>                          batch_size<span class="token punctuation">,</span>                          dist<span class="token punctuation">,</span>                           root_path<span class="token punctuation">,</span>                          workers<span class="token punctuation">,</span>                          logger<span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">return</span> datasets<span class="token punctuation">,</span> dataloaders<span class="token punctuation">,</span> samplers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¸‰ä¸ªè¿”å›çš„éƒ½æ˜¯å­—å…¸ï¼Œå­˜å‚¨å››ç§ç±»å‹çš„æ•°æ®é›† <code>pretrain, labeled, unlabeled, test</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">datasets <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'pretrain'</span><span class="token punctuation">:</span> pretrain_dataset<span class="token punctuation">,</span>    <span class="token string">'labeled'</span><span class="token punctuation">:</span> labeled_dataset<span class="token punctuation">,</span>    <span class="token string">'unlabeled'</span><span class="token punctuation">:</span> unlabeled_dataset<span class="token punctuation">,</span>    <span class="token string">'test'</span><span class="token punctuation">:</span> test_dataset<span class="token punctuation">}</span>dataloaders <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'pretrain'</span><span class="token punctuation">:</span> pretrain_dataloader<span class="token punctuation">,</span>    <span class="token string">'labeled'</span><span class="token punctuation">:</span> labeled_dataloader<span class="token punctuation">,</span>    <span class="token string">'unlabeled'</span><span class="token punctuation">:</span> unlabeled_dataloader<span class="token punctuation">,</span>    <span class="token string">'test'</span><span class="token punctuation">:</span> test_dataloader<span class="token punctuation">}</span>samplers <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'pretrain'</span><span class="token punctuation">:</span> pretrain_sampler<span class="token punctuation">,</span>    <span class="token string">'labeled'</span><span class="token punctuation">:</span> labeled_sampler<span class="token punctuation">,</span>    <span class="token string">'unlabeled'</span><span class="token punctuation">:</span> unlabeled_sampler<span class="token punctuation">,</span>    <span class="token string">'test'</span><span class="token punctuation">:</span> test_sampler<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>used functions</p><ol><li><p><code>split_once_semi_data</code>ï¼Œå°±æ˜¯è½½å…¥ <code>once_infos_***.pkl</code> æ–‡ä»¶ï¼Œé‡Œé¢å­˜å‚¨äº†ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚ frame_id, meta_info, lidar, pose, calibâ€¦</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">split_once_semi_data</span><span class="token punctuation">(</span>info_paths<span class="token punctuation">,</span> data_splits<span class="token punctuation">,</span> root_path<span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> once_pretrain_infos<span class="token punctuation">,</span> once_test_infos<span class="token punctuation">,</span> once_labeled_infos<span class="token punctuation">,</span> once_unlabeled_infos<span class="token comment"># pretrain &amp; labeled are the same</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol></li></ol><h3 id="SemiDatasetTemplate"><a href="#SemiDatasetTemplate" class="headerlink" title="SemiDatasetTemplate"></a>SemiDatasetTemplate</h3><p>è¿™ä¸ªç±»æ˜¯æ‰€æœ‰ semi-dataset çš„ç¥–å…ˆï¼Œè¯¥ç±»è¦å¤„ç†ç›‘ç£æƒ…å†µä¸‹çš„æ•°æ®é›†ï¼Œä¹Ÿè¦å¤„ç†åŠç›‘ç£æƒ…å†µä¸‹çš„æ•°æ®é›†ã€‚åŒæ—¶åŠç›‘ç£æƒ…å†µä¸‹ä¹Ÿåˆ†ä¸º teacher &amp; student ä¸¤ä¸ªç±»å‹ã€‚è€Œè¿™äº›ä»£ç ä¼¼ä¹éƒ½æ˜¯ç”¨ numpy åœ¨ cpu ä¸Šè¿è¡Œï¼Œå¯èƒ½ numpy åœ¨ cpu ä¸Šæ›´å¿«è·Ÿè½»é‡</p><h4 id="init"><a href="#init" class="headerlink" title="init"></a>init</h4><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SemiDatasetTemplate</span><span class="token punctuation">(</span>torch_data<span class="token punctuation">.</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset_cfg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> class_names<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> root_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> logger<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>attributes</p><p>ä¸€äº›åŸºç¡€çš„å±æ€§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>dataset_cfgself<span class="token punctuation">.</span>trainingself<span class="token punctuation">.</span>class_namesself<span class="token punctuation">.</span>loggerself<span class="token punctuation">.</span>point_cloud_rangeself<span class="token punctuation">.</span>grid_size <span class="token operator">=</span> self<span class="token punctuation">.</span>data_processor<span class="token punctuation">.</span>grid_sizeself<span class="token punctuation">.</span>voxel_size <span class="token operator">=</span> self<span class="token punctuation">.</span>data_processor<span class="token punctuation">.</span>voxel_size<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±ç±»ç»„æˆçš„å±æ€§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>point_feature_encoder<span class="token comment"># PointFeatureEncoder</span>self<span class="token punctuation">.</span>data_augmentor<span class="token comment"># DataAugmentor</span>self<span class="token punctuation">.</span>data_processor<span class="token comment"># DataProcessor</span>self<span class="token punctuation">.</span>teacher_augmentor<span class="token comment"># Different augmentation for teacher &amp; student</span>self<span class="token punctuation">.</span>student_augmentor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ‰å¿…è¦ä»‹ç»ä¸€ä¸‹ä¸‰ä¸ªç±»çš„åŠŸèƒ½</p><ol><li><p><code>PointFeatureEncoder</code> åŸºæœ¬ä¸Šä¸åšä»€ä¹ˆäº‹æƒ…ï¼Œçœ‹ä¸€çœ‹ <code>used_feature_list</code> å°±å¥½</p></li><li><p><code>DataAugmentor</code> æŠŠéœ€è¦çš„ augmentation æ”¾åˆ° <code>self. data_augmentor_queue</code> ä¹‹åè°ƒç”¨ï¼Œé€šå¸¸æœ‰ä¸‰ä¸ªæ“ä½œ</p><ol><li>random_world_flipï¼ŒALONG_AXIS_LIST: [â€˜xâ€™, â€˜yâ€™]</li><li>random_world_rotationï¼ŒWORLD_ROT_ANGLE: [-0.78539816, 0.78539816]</li><li>random_world_scalingï¼ŒWORLD_SCALE_RANGE: [0.95, 1.05]</li></ol></li><li><p><code>DataProcessor</code> å¤„ç†ç‚¹äº‘ï¼Œä¸€èˆ¬æœ‰ä¸‰æ­¥</p><ol><li><p>mask_points_and_boxes_outside_range</p></li><li><p>shuffile_points</p></li><li><p>transform_points_to_voxelsï¼Œè¿™ä¸€æ­¥ç”± spconv çš„ <code>VoxelGenerator</code> å®Œæˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">points <span class="token operator">=</span> data_dict<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span>voxel_output <span class="token operator">=</span> self<span class="token punctuation">.</span>voxel_generator<span class="token punctuation">.</span>generate<span class="token punctuation">(</span>points<span class="token punctuation">)</span>voxels<span class="token punctuation">,</span> coordinates<span class="token punctuation">,</span> num_points <span class="token operator">=</span> voxel_output<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol></li></ol></li></ol><h4 id="prepare-data"><a href="#prepare-data" class="headerlink" title="prepare_data"></a>prepare_data</h4><p>ç»™ç›‘ç£å­¦ä¹ å‡†å¤‡æ•°æ®ï¼ˆæ•°æ®å¢å¼ºï¼Œä½“ç´ åŒ–ç­‰ï¼‰</p><ol><li><p>input params &amp; output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">prepare_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        data_dict:            points: (N, 3 + C_in)            gt_boxes: optional, (N, 7 + C) [x, y, z, dx, dy, dz, heading, ...]            gt_names: optional, (N), string            ...    Returns:        data_dict:            points: (N, 3 + C_in)            gt_boxes: optional, (N, 7 + C + 1) [x, y, z, dx, dy, dz, heading, ..., class]            gt_names: optional, (N), string            voxels: optional (num_voxels, max_points_per_voxel, 3 + C)            voxel_coords: optional (num_voxels, 3)            voxel_num_points: optional (num_voxels)            ...    """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>used functions</p><ol><li><code>self.data_augmentor</code>ï¼Œæ•°æ®å¢å¼º</li><li>è¿‡æ»¤æ‰ä¸å…³æ³¨çš„ gt ç±»åˆ«ï¼Œå¹¶ä¸”å°†å…³æ³¨ç±»åˆ«è½¬æ¢ä¸º digitã€‚è™½ç„¶è¿™ä¸æ˜¯ functionsï¼Œä½†æˆ‘ä¹Ÿæ•´ç†åœ¨æ­¤</li><li><code>self.point_feature_encoder &amp; self.data_processor</code>ï¼Œä½“ç´ åŒ–</li></ol></li></ol><h4 id="prepare-datset-ssl"><a href="#prepare-datset-ssl" class="headerlink" title="prepare_datset_ssl"></a>prepare_datset_ssl</h4><p>ä¸å¸¸è§„ prepare_dataset ç›¸æ¯”ï¼Œssl è¦è¾“å‡ºä¸¤ä¸ª data_dictï¼Œä¸€ä¸ªç»™ teacherï¼Œä¸€ä¸ªç»™ studentï¼Œå¹¶ä¸”è¦å¯¹æœ‰æ—  <code>gt_boxes</code> æ ‡ç­¾è¿›è¡Œåˆ†åˆ«å¤„ç†</p><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">prepare_data_ssl</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_dict<span class="token punctuation">,</span> output_dicts<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># output_dicts is a list: ['teacher', 'student']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">return</span> teacher_data_dict<span class="token punctuation">,</span> student_data_dict<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>used functions</p><ol><li><p><code>self.teacher_augmentor &amp; self.student_augmentor</code>ï¼Œä¸å¸¸è§„ augmentor ä¸åŒçš„æ˜¯ï¼š</p><ol><li><p>äº‹å…ˆå°† data_dict è¿›è¡Œäº† deepcopyï¼Œåˆ†åˆ«é€å…¥äºŒè€…çš„ augmentor ä¸­</p></li><li><p>augmentor è®°å½•äº† augmentation çš„å‚æ•°ï¼Œåœ¨ä¹‹åä¼š inverse augmentation</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data_dict<span class="token punctuation">[</span><span class="token string">'augmentation_list'</span><span class="token punctuation">]</span> <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">.</span>aug_list<span class="token punctuation">)</span>data_dict<span class="token punctuation">[</span><span class="token string">'augmentation_params'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol></li><li><p>ï¼ˆå¦‚æœæœ‰ gtï¼‰è¿‡æ»¤æ‰ä¸å…³æ³¨çš„ gt ç±»åˆ«</p></li><li><p><code>self.point_feature_encoder &amp; self.data_processor</code>ï¼Œä½“ç´ åŒ–</p></li></ol></li></ol><h4 id="collate-batch"><a href="#collate-batch" class="headerlink" title="collate_batch"></a>collate_batch</h4><p>pytorch <code>Dataset</code> é€šè¿‡ <code>collat_fn</code> å°†å¤šä¸ª sample ç»„åˆåˆ°ä¸€ä¸ª batch å½“ä¸­ï¼ŒOpencPCDet å°†å¤šä¸ªæ•°æ®å­—å…¸ï¼Œæ‰“åŒ…ä¸ºä¸€ä¸ªæ•°æ®å­—å…¸ã€‚è¿™é‡Œéœ€è¦é¢å¤–å¤„ç† student &amp; teacher ä¸¤ä¸ª data_dict çš„æƒ…å†µ</p><ol><li><p>input params: batch_list</p></li><li><p>output: </p><ol><li>return teacher_batch, student_batchï¼Œå¦‚æœæ˜¯ <code>prepare_dataset_ssl</code></li><li>return single_batchï¼Œå¦‚æœæ˜¯ <code>prepare_dataset</code></li></ol><p>æ¯ä¸€ä¸ª batch è¿˜åšäº†ä¸€äº›å½¢çŠ¶ä¸Šçš„å¤„ç†ï¼š</p><ol><li>å¯¹äº <code>voxels, voxel_num_points</code> ç›´æ¥ concatï¼Œ(N1+N2+â€¦, max_points_per_voxel, 3+C)</li><li>å¯¹äº <code>points, voxel_coords</code> åŠ å…¥äº† batch åºå·ï¼Œç„¶åå† concatï¼Œ(N1+N2+â€¦, 1+3+C)</li><li>å¯¹äº <code>gt_boxes</code> åˆ™è¦å…¼é¡¾æ¯ä¸ª sample gt æ•°é‡ä¸åŒçš„æƒ…å†µï¼Œç”¨ (batch_size, max_gt, 7+C+1) å½¢çŠ¶çš„ array å­˜å‚¨èµ·æ¥ã€‚ç©º gt ç”¨ 0 å¡«è¡¥</li><li>å…¶ä»–çš„ç›´æ¥ stackï¼Œæˆ–è€…ä¸å˜</li></ol></li></ol><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li><code>np.pad(array, ...)</code> å¯¹æ•°æ®è¿›è¡Œ paddingã€‚ç±»ä¼¼çš„æ•ˆæœä¹Ÿå¯ä»¥å…ˆåˆ›å»º zero matrixï¼Œç„¶åå†èµ‹å€¼</li></ol><h3 id="ONCESemiDataset"><a href="#ONCESemiDataset" class="headerlink" title="ONCESemiDataset"></a>ONCESemiDataset</h3><p>è¯¥ç±»ç»§æ‰¿äº† <code>SemiDatasetTemplate</code>ï¼Œå¹¶å®ç°ä¸‰ä¸ªåŸºæœ¬åŠŸèƒ½</p><ol><li><strong>åŸå§‹æ•°æ®çš„è·å–</strong></li><li><strong>å°è£…é¢„æµ‹å¾—åˆ°çš„ pred_dicts</strong></li><li><strong>evaluation code</strong></li></ol><p>ä¸€èˆ¬å¯¹äºç›‘ç£å­¦ä¹ çš„ Datasetï¼Œè¿˜éœ€è¦å®ç° <code>__getitem__</code>  è·å¾—æ•°æ®ï¼Œè€Œè¿™é‡Œä¸ºäº†å…¼é¡¾åŠç›‘ç£å­¦ä¹ ï¼ŒæŠŠè¿™ä¸¤ä¸ªæ–¹æ³•ä¸‹æ”¾åˆ°å­ç±»å»å®ç°äº†</p><h4 id="init-1"><a href="#init-1" class="headerlink" title="init"></a>init</h4><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ONCESemiDataset</span><span class="token punctuation">(</span>SemiDatasetTemplate<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset_cfg<span class="token punctuation">,</span> class_names<span class="token punctuation">,</span> infos<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> root_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> logger<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h4 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h4><ol><li><code>get_lidar</code> &amp; <code>get_image</code> &amp; <code>project_lidar_to_image</code></li><li><code>generate_prediction_dicts</code> è¿”å›ä¸€ä¸ª once-style annos listï¼Œ</li><li><code>evaluation</code>ï¼Œæ ¹æ® det_annos &amp; class_names ç”Ÿæˆç»“æœ</li></ol><h3 id="ONCEPretrainDataset-amp-ONCELabeledDataset-amp-ONCEUnlabeledDataset-amp-ONCETestDataset"><a href="#ONCEPretrainDataset-amp-ONCELabeledDataset-amp-ONCEUnlabeledDataset-amp-ONCETestDataset" class="headerlink" title="ONCEPretrainDataset &amp; ONCELabeledDataset &amp; ONCEUnlabeledDataset &amp; ONCETestDataset"></a>ONCEPretrainDataset &amp; ONCELabeledDataset &amp; ONCEUnlabeledDataset &amp; ONCETestDataset</h3><p>è¿™å››ä¸ªç±»éƒ½ç»§æ‰¿äº† <code>ONCESemiDataset</code>ï¼Œå¹¶å„è‡ªå®ç° <code>__getitem__</code>ï¼Œæ„æˆ input_dictï¼Œç„¶åè¾“å…¥ <code>prepare_data or prepare_data_ssl</code>ï¼Œæœ€åè¿”å›æœ€ç»ˆçš„ data_dict</p><p>å…¶ä¸­ Pretrain å’Œ Test ä¸¤ä¸ª Dataset æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œè¿”å›å¸¸è§„çš„ data_dict</p><p>Labeled å’Œ Unlabeled ä¸¤ä¸ª Dataset è¿”å› (teacher_dict, student_dict)</p><h2 id="ONCEDataset-Infos-amp-Database-Processing"><a href="#ONCEDataset-Infos-amp-Database-Processing" class="headerlink" title="ONCEDataset Infos &amp; Database Processing"></a>ONCEDataset Infos &amp; Database Processing</h2><p>ä¸ºäº†åŠ é€Ÿè®­ç»ƒè¿‡ç¨‹ï¼Œæˆ‘éœ€è¦åŠ å…¥è‡ªå·±å…³æ³¨çš„ database ä¿¡æ¯ï¼Œæ‰€ä»¥å¿…é¡»è¦å­¦ä¹ å¦‚ä½•æ„å»ºè‡ªå·±çš„ database info</p><p>ä¹‹å‰åœ¨çœ‹ <code>ONCEDataset</code> çš„æ—¶å€™å°±çœ‹åˆ° <code>__getitem</code> å°±åœæ­¢äº†ï¼Œå¯¹äº <code>get_infos &amp; create_ground_truth_database</code> è¿™ä¸¤ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰ä»”ç»†çœ‹äº†ï¼Œç°åœ¨æ˜¯å¿…é¡»è¦ä¸Šäº†ï¼Œåœ¨ç„¶åå°±æ˜¯ <code>DatabaseSampler</code> çš„åŠŸèƒ½æ•´ç†ä¸€ä¸‹ï¼Œå°±åŸºæœ¬æ‰“é€šäº†æ•°æ®é›†çš„å¤„ç†æµç¨‹ï¼Œç„¶åå°±å¯ä»¥åŠ å…¥è‡ªå·±æƒ³è¦çš„ç‰¹å¾äº†</p><h3 id="get-infos"><a href="#get-infos" class="headerlink" title="get_infos"></a>get_infos</h3><p>ç”Ÿæˆå„ä¸ª split ç”Ÿæˆ info ä¿¡æ¯ï¼Œåœ¨ä¹‹åå°†è¿™äº› info å­˜å‚¨ä¸º <code>once_infos_***.pkl</code> æ–‡ä»¶</p><ol><li><p>input paramsï¼ŒåŸºæœ¬ä¸éœ€è¦</p></li><li><p>outputï¼Œä¸€ä¸ªåˆ—è¡¨ <code>all_infos</code>ï¼Œå­˜å‚¨äº†æ‰€æœ‰ frames çš„ä¿¡æ¯</p></li><li><p>used functions</p><ol><li><p><code>process_single_sequence</code>ï¼Œè¿”å›ä¸€ä¸ª list of dictï¼Œæ¯ä¸€ä¸ª dict ä»£è¡¨ä¸€ä¸ª frameï¼Œé‡Œé¢å­—å…¸åŒ…æ‹¬å¾ˆå¤šä¿¡æ¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">frame_dict <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'sequence_id'</span><span class="token punctuation">:</span> seq_idx<span class="token punctuation">,</span>    <span class="token string">'frame_id'</span><span class="token punctuation">:</span> frame_id<span class="token punctuation">,</span>    <span class="token string">'timestamp'</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>frame_id<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">'prev_id'</span><span class="token punctuation">:</span> prev_id<span class="token punctuation">,</span>    <span class="token string">'next_id'</span><span class="token punctuation">:</span> next_id<span class="token punctuation">,</span>    <span class="token string">'meta_info'</span><span class="token punctuation">:</span> meta_info<span class="token punctuation">,</span>    <span class="token string">'lidar'</span><span class="token punctuation">:</span> pc_path<span class="token punctuation">,</span>    <span class="token string">'pose'</span><span class="token punctuation">:</span> pose<span class="token punctuation">,</span>    <span class="token string">'annos'</span><span class="token punctuation">:</span>    <span class="token punctuation">{</span>            <span class="token string">'name'</span><span class="token punctuation">:</span>            <span class="token string">'boxes_3d'</span><span class="token punctuation">:</span>            <span class="token string">'boxes_2d'</span><span class="token punctuation">:</span>            <span class="token string">'num_points_in_gt'</span><span class="token punctuation">:</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆçš„ <code>all_infos</code> å°±æ˜¯å¤šä¸ª <code>process_single_sequence</code> çš„ç»“æœåˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå¤§çš„ list of dict</p></li></ol></li></ol><h3 id="create-groundtruth-database"><a href="#create-groundtruth-database" class="headerlink" title="create_groundtruth_database"></a>create_groundtruth_database</h3><p>è¿™ä¸€æ­¥æ˜¯ä¸º data augmentation å‡†å¤‡çš„ï¼Œåªé’ˆå¯¹è®­ç»ƒé›†ç”Ÿæˆ databaseã€‚æŠŠæ¯ä¸ªç±»åˆ«çš„ç‰©ä½“éƒ½æ”¾åœ¨äº†ä¸€èµ·ï¼Œåœ¨ä¹‹åå¥½é’ˆå¯¹ç±»åˆ«è¿›è¡Œé‡‡æ ·</p><ol><li><p>input paramsï¼Œä¸»è¦æœ‰ä¸¤ä¸ªï¼š<code>info_path &amp; split</code>ï¼Œå…·ä½“ä¸€ç‚¹æ¥è¯´å°±æ˜¯ <code>once_infos_train.pkl &amp; train</code>ã€‚</p></li><li><p>output å¯ä»¥è®¤ä¸ºæœ‰ä¸¤ä¸ªï¼š</p><ol><li><p><code>once_dbinfos_train.pkl</code> æ˜¯ä¸€ä¸ª dict of list of dictï¼Œå­˜å‚¨æ‰€æœ‰ç±»åˆ«çš„ä¿¡æ¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">db_info <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'path'</span><span class="token punctuation">:</span> db_path<span class="token punctuation">,</span> <span class="token string">'gt_idx'</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span>            <span class="token string">'box3d_lidar'</span><span class="token punctuation">:</span> gt_boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'num_points_in_gt'</span><span class="token punctuation">:</span> gt_points<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>'%s_%s_%d.bin' % (frame_id, names[i], i)</code>ï¼Œç›´æ¥å­˜å‚¨æ¯ä¸ªåœºæ™¯çš„æ¯ä¸ªç‰©ä½“ï¼Œé€šè¿‡ä¸Šé¢çš„ <code>db_path</code> å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„ç‰©ä½“</p></li></ol></li></ol><h3 id="å¦‚ä½•æ„å»ºå¤æ‚é¡¹ç›®ï¼Ÿ"><a href="#å¦‚ä½•æ„å»ºå¤æ‚é¡¹ç›®ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ„å»ºå¤æ‚é¡¹ç›®ï¼Ÿ"></a>å¦‚ä½•æ„å»ºå¤æ‚é¡¹ç›®ï¼Ÿ</h3><p>æ•´ç†å®Œäº†ä»£ç ï¼Œè™½ç„¶çŸ¥é“æ¯ä¸€ä¸ªæ¨¡å—çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿˜æ˜¯ç¨å¾®æœ‰ç‚¹æ··ä¹±çš„æ„Ÿè§‰ã€‚è¿™ç§æ„Ÿè§‰æ¥è‡ªäºä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœè®©æˆ‘è‡ªå·±æ¥è®¾è®¡æµç¨‹åº”è¯¥æ€ä¹ˆå»æ„å»ºä»£ç çš„ç»“æ„ï¼Ÿç°åœ¨æˆ‘åªèƒ½æœ‰ä¸€ä¸ªç®€å•çš„æƒ³æ³•ï¼š</p><ol><li>æ¸…æ™°åœ°æ„å»ºæˆ‘ä»¬éœ€è¦å®Œæˆçš„æ‰€æœ‰æµç¨‹çº¿</li><li>æ„å»ºæ¯ä¸€æ¡æµç¨‹çº¿éœ€è¦çš„ä»£ç </li><li>å¯¹äºå¹³è¡Œåº¦/ç›¸ä¼¼åº¦é«˜çš„æµç¨‹çº¿ï¼Œæ¯”è¾ƒä¸€ä¸‹æœ‰æ— å…±åŒç‚¹ï¼Œå°†å…±åŒç‚¹ç”¨ä¸€ä¸ªï¼ˆåŸºï¼‰ç±»å®ç°ã€‚é«˜åº¦çš„æ¨¡å—åŒ–èƒ½åœ¨ä¹‹åå±•ç°æ›´å¥½çš„çµæ´»æ€§å’Œè§„èŒƒæ€§</li><li>å®ç°å„ä¸ªå·®å¼‚åŒ–å­ç±»</li></ol><p>å¦‚æœæŠŠè¿™ä¸ª semi-supervised dataset ç”»ä¸€ä¸ªæµç¨‹å›¾çš„ç”»ï¼Œæˆ‘ä¼šç”¨ä¸‹å›¾è¡¨ç¤º</p><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid">graph LR    labeled(labeled)    unlabeled(unlabeled)    getitem(student dict &amp; teacher dict)    prepare_data(prepare_data_ssl)    semi-supervise --&gt; labeled &amp; unlabeled --&gt; getitem --&gt; prepare_data    subgraph DatasetTemplate    prepare_data    collate_fn(collate_batch)    end    subgraph ONCESemiDataset    getitem    others(generate_pred_dicts &amp; evaluation)    end    style semi-supervise fill:pink<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>OpenPCDet çš„ä¸€ä¸ªä¼˜åŠ¿å°±åœ¨äºå°† <code>prepare_dataset</code> è¿™ä¸€éƒ¨åˆ†ä½¿ç”¨ä¸€ä¸ª DatasetTemplate å®ç°ï¼Œä¸å…·ä½“æ•°æ®é›†åˆ†ç¦»ï¼Œå„ä¸ªæ•°æ®é›†æ‰€è¾“å…¥çš„ data_dict å½¢å¼ä¸Šæ˜¯ç»Ÿä¸€çš„ï¼Œæœ‰å¾ˆå¥½çš„è§„èŒƒä½œç”¨ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†çµæ´»æ€§</p><h2 id="SemiSECOND-amp-AnchorHeadSemi"><a href="#SemiSECOND-amp-AnchorHeadSemi" class="headerlink" title="SemiSECOND &amp; AnchorHeadSemi"></a>SemiSECOND &amp; AnchorHeadSemi</h2><p>å’ŒåŸå§‹ SECOND æ¯”è¾ƒï¼ŒSemiSECOND å°†æ¨¡å‹åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šorigin, student, teacherã€‚æ ¹æ®ä¸åŒçš„ç±»å‹ï¼Œå‰å‘æ–¹ç¨‹ <code>forward</code> å°†ç¨æœ‰å·®åˆ«ã€‚Detector åœ¨é€»è¾‘ä¸Šåˆ†ä¸ºä¸Šé¢ä¸‰ç±»ï¼Œå®é™…æ‰§è¡Œæ¨¡å—æ˜¯è½å®åˆ° dense head ä¸Šï¼Œå³ <code>AnchorHeadSemi</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">set_model_type</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_type<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">assert</span> model_type <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'origin'</span><span class="token punctuation">,</span> <span class="token string">'teacher'</span><span class="token punctuation">,</span> <span class="token string">'student'</span><span class="token punctuation">]</span>    self<span class="token punctuation">.</span>model_type <span class="token operator">=</span> model_type    self<span class="token punctuation">.</span>dense_head<span class="token punctuation">.</span>model_type <span class="token operator">=</span> model_type<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¦ä¸€ä¸ªç‚¹ï¼šconsistency loss æ˜¯åœ¨æ¨¡å‹ä¹‹å¤–è®¡ç®—çš„ï¼Œtraining loss æ˜¯åœ¨æ¨¡å‹å†…è®¡ç®—çš„</p><h3 id="Origin"><a href="#Origin" class="headerlink" title="Origin"></a>Origin</h3><p>ä¸åšè¿‡å¤šä»‹ç»ï¼Œå°±æ˜¯åŸæ±åŸå‘³çš„ SECONDã€‚training å’Œ testing çš„è¡¨ç°éƒ½ä¸æ”¹å˜</p><h3 id="Student"><a href="#Student" class="headerlink" title="Student"></a>Student</h3><p>å…¶å® student æ¨¡å‹å’Œ origin æ˜¯æ¯”è¾ƒå¾ˆç›¸ä¼¼çš„ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹å¤„ç† unlabeled dataï¼Œå¤šäº†ä¸€ä¸ªåˆ¤æ–­</p><ul><li>training, return (loss &amp; pred_boxes) or just pred_boxes </li><li>testing, return pred_boxes with post processing</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">elif</span> self<span class="token punctuation">.</span>model_type <span class="token operator">==</span> <span class="token string">'student'</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> cur_module <span class="token keyword">in</span> self<span class="token punctuation">.</span>module_list<span class="token punctuation">:</span>        batch_dict <span class="token operator">=</span> cur_module<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'gt_boxes'</span> <span class="token keyword">in</span> batch_dict<span class="token punctuation">:</span> <span class="token comment"># for (pseudo-)labeled data, this is the only difference between origin mode</span>            loss<span class="token punctuation">,</span> tb_dict<span class="token punctuation">,</span> disp_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>get_training_loss<span class="token punctuation">(</span><span class="token punctuation">)</span>            ret_dict <span class="token operator">=</span> <span class="token punctuation">{</span>                <span class="token string">'loss'</span><span class="token punctuation">:</span> loss            <span class="token punctuation">}</span>            <span class="token keyword">return</span> batch_dict<span class="token punctuation">,</span> ret_dict<span class="token punctuation">,</span> tb_dict<span class="token punctuation">,</span> disp_dict        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> batch_dict    <span class="token keyword">else</span><span class="token punctuation">:</span>        pred_dicts<span class="token punctuation">,</span> recall_dicts <span class="token operator">=</span> self<span class="token punctuation">.</span>post_processing<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>        <span class="token keyword">return</span> pred_dicts<span class="token punctuation">,</span> recall_dicts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Teacher"><a href="#Teacher" class="headerlink" title="Teacher"></a>Teacher</h3><p>æŠŠæ‰€æœ‰è¾“å…¥éƒ½ä½œä¸º unlabeldï¼Œç›´æ¥ return pred_boxes</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">elif</span> self<span class="token punctuation">.</span>model_type <span class="token operator">==</span> <span class="token string">'teacher'</span><span class="token punctuation">:</span>    <span class="token comment"># assert not self.training</span>    <span class="token keyword">for</span> cur_module <span class="token keyword">in</span> self<span class="token punctuation">.</span>module_list<span class="token punctuation">:</span> <span class="token comment"># MIGHT CONSIDERING GET SOME LOSS</span>        batch_dict <span class="token operator">=</span> cur_module<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>    <span class="token keyword">return</span> batch_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Model-Wrapper"><a href="#Model-Wrapper" class="headerlink" title="Model Wrapper"></a>Model Wrapper</h3><p>åŠç›‘ç£å­¦ä¹ æ—¢æœ‰ labeled æ•°æ®ï¼Œåˆæœ‰ unlabeled æ•°æ®ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€ä¸ª Wrapper æ¥åŒæ—¶å¤„ç†ä¸¤ç§æ•°æ®</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DistStudent</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> student<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>onepass <span class="token operator">=</span> student    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ld_batch<span class="token punctuation">,</span> ud_batch<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>onepass<span class="token punctuation">(</span>ld_batch<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>onepass<span class="token punctuation">(</span>ud_batch<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SE-SSD-amp-Mean-Teacher"><a href="#SE-SSD-amp-Mean-Teacher" class="headerlink" title="SE-SSD &amp; Mean-Teacher"></a>SE-SSD &amp; Mean-Teacher</h2><h3 id="sess-se-ssd"><a href="#sess-se-ssd" class="headerlink" title="sess / se_ssd"></a>sess / se_ssd</h3><p>sess å’Œ se_ssd æ˜¯éå¸¸è¿‘ä¼¼çš„ä¸¤ä¸ªå‡½æ•°ã€‚ä¹Ÿæ˜¯åŠç›‘ç£å­¦ä¹ çš„æ ¸å¿ƒä»£ç ï¼šè¾“å…¥ student &amp; teacher æ¨¡å‹ï¼Œè¾“å…¥ labeled_data &amp; unlabeled_dataï¼Œé€šè¿‡å‰å‘æ–¹ç¨‹å¾—åˆ°é¢„æµ‹ç»“æœï¼Œæœ€åè®¡ç®—ç›‘ç£å­¦ä¹ çš„ loss &amp; åŠç›‘ç£çš„ consistency loss </p><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">se_ssd</span><span class="token punctuation">(</span>teacher_model<span class="token punctuation">,</span> student_model<span class="token punctuation">,</span>         ld_teacher_batch_dict<span class="token punctuation">,</span> ld_student_batch_dict<span class="token punctuation">,</span>         ud_teacher_batch_dict<span class="token punctuation">,</span> ud_student_batch_dict<span class="token punctuation">,</span>         cfgs<span class="token punctuation">,</span> epoch_id<span class="token punctuation">,</span> dist<span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>output: return loss, tb_dict, disp_dictï¼Œå…¶ä¸­ loss ç”±2ä¸ªéƒ¨åˆ†ç»„æˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">loss <span class="token operator">=</span> sup_loss <span class="token operator">+</span> consistency_weight <span class="token operator">*</span> consistency_loss<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>used functions </p><ol><li><p><code>load_data_to_gpu(data_dict)</code> åå­—å°±æ˜¯åŠŸèƒ½ã€‚æä¸€å¥ï¼šè¿™ä¸ªå‡½æ•°åœ¨ç›‘ç£å­¦ä¹ é‡Œæ˜¯è¢«åŒ…è¿›äº† <code>model_fn_decorator</code></p></li><li><p><code>filter_boxes(data_dict, cfg)</code> è¿™ä¸€æ­¥å…¶å®åšçš„æ˜¯ post_processing çš„å·¥ä½œï¼Œä»…æœ‰ä¸€ä¸ªåŒºåˆ«ï¼š<code>pred_cls</code> æ²¡æœ‰å–æœ€å¤§å€¼ï¼Œæ‰€æœ‰ class çš„å¾—åˆ†éƒ½ä¿ç•™äº†ã€‚æœ€ç»ˆè¿”å› list of dict</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">record_dict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>    <span class="token string">'pred_boxes'</span><span class="token punctuation">:</span> final_boxes<span class="token punctuation">,</span>    <span class="token string">'pred_cls_preds'</span><span class="token punctuation">:</span> final_cls_preds<span class="token punctuation">,</span>    <span class="token string">'pred_labels'</span><span class="token punctuation">:</span> final_labels<span class="token punctuation">}</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> batch_size<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>reverse_transform</code> å°† teacher çš„ augmentation é€†è½¬ï¼Œå¹¶å®æ–½ student_augmentation</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@torch<span class="token punctuation">.</span>no_grad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">reverse_transform</span><span class="token punctuation">(</span>teacher_boxes<span class="token punctuation">,</span> teacher_dict<span class="token punctuation">,</span> student_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> teacher_boxes<span class="token comment"># dict like output of filter_boxes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><strong><code>get_iou_consistency_loss</code></strong> å°±æ˜¯è®¡ç®—ä¸€è‡´æŸå¤±çš„æ ¸å¿ƒ</p><ol><li><p>input params: teacher_boxes, student_boxesï¼Œç»è¿‡äº† filter &amp; transform</p></li><li><p>output: box_loss, cls_loss</p></li><li><p><strong>è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹</strong>ï¼š</p><ol><li>è®¡ç®— teacher_class &amp; student_class çš„åŒ¹é…çŸ©é˜µ (Nt, Ns)ï¼Œç±»åˆ«ç›¸åŒä¸º1ï¼Œä¸åŒä¸º0</li><li>è®¡ç®— teacher_boxes &amp; student_boxes çš„ IoU çŸ©é˜µ (Nt, Ns)ï¼Œå¹¶ä¸”å‡å»åŒ¹é…çŸ©é˜µï¼Œè¿™æ ·å°±èƒ½è¿‡æ»¤ç±»åˆ«ä¸åŒçš„ boxes</li><li>è®¡ç®— student_boxes åŒ¹é…çš„ matched_teacher_boxes (Ns,)ã€‚å¹¶è®¡ç®—ä¸€ä¸ª maskï¼šIoU &gt;= thresh = 0.7ï¼Œåœ¨è®¡ç®— smooth L1 loss æ—¶è¿›è¡Œè¿‡æ»¤</li><li>è®¡ç®— smooth L1 lossï¼Œå¹¶ä½¿ç”¨ batch_normalizer &amp; num_matched_boxes è¿›è¡Œå½’ä¸€åŒ–</li></ol><p>sess ä¸º <code>get_consistency_loss</code>ï¼Œå®ç°ç¨æœ‰ä¸åŒï¼Œè¿™é‡Œä¸åšæ•´ç†ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒONCE è®ºæ–‡è¯´ box size ç›¸å…³çš„ä¸€è‡´æŸå¤±ä¼¼ä¹å¹¶ä¸é‡è¦ï¼Ÿ</p><blockquote><p>SESS [57] performs worse than Mean Teacher with 58.78% mAP, which indicates that size and center consistency may not be useful in driving scenarios.</p></blockquote></li></ol></li><li><p><code>sigmoid_rampup</code> æ§åˆ¶ consistency loss çš„æƒé‡é€æ¸å¢åŠ ç›´åˆ°å¢åŠ åˆ°1</p></li></ol></li></ol><h3 id="Mean-Teacher-Update"><a href="#Mean-Teacher-Update" class="headerlink" title="Mean Teacher Update"></a>Mean Teacher Update</h3><p>åœ¨æ¯ä¸€æ¬¡ iteration è¿‡åå¯¹ teacher model è¿›è¡Œ updateã€‚å¯ä»¥å¤§æ¦‚åˆ†ä¸º2ä¸ªé˜¶æ®µï¼š</p><ol><li>rampup é˜¶æ®µï¼Œä½¿ç”¨çœŸå®å¹³å‡å€¼</li><li>ema é˜¶æ®µï¼Œä½¿ç”¨ ema</li></ol><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li><p>ä½¿ç”¨ <code>model.parameters()</code> æ–¹æ³•å®Œæˆå¯¹æ‰€æœ‰å‚æ•°çš„è¿­ä»£ï¼Œå¹¶ä½¿ç”¨ <code>tensor.data</code> å¯¹å¼ é‡å€¼è¿›è¡Œä¿®æ”¹ï¼Œ<code>tensor.data</code> ä¸åŸ tensor å…±äº«å­˜å‚¨ï¼Œä½¿ç”¨ inplace æ“ä½œå°±å¯ä»¥å®Œæˆã€‚<code>tensor.detach()</code> ä¹Ÿæ˜¯å¯ä»¥å®Œæˆç±»ä¼¼çš„åŠŸèƒ½çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">update_ema_variables_with_fixed_momentum</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> ema_model<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> ema_param<span class="token punctuation">,</span> param <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>ema_model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># ema_param.data.mul_(alpha).add_(1 - alpha, param.data)</span>        ema_param<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mul_<span class="token punctuation">(</span>alpha<span class="token punctuation">)</span><span class="token punctuation">.</span>add_<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> alpha<span class="token punctuation">,</span> param<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        <span class="token comment"># if use .data, loss.backward would extremely slow sometimes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="Mermaid"><a href="#Mermaid" class="headerlink" title="Mermaid"></a>Mermaid</h2><p>ä¸Šé¢çš„æµç¨‹å›¾å°±æ˜¯ç”¨ mermaid å†™çš„ï¼Œè¿™é‡Œç®€å•æ€»ç»“ä¸€ä¸‹ç”»æµç¨‹å›¾çš„è¯­æ³•</p><ol><li><p>ä½¿ç”¨ <code>graph</code> or <code>flowchart</code>åˆ›å»ºæµç¨‹å›¾ï¼Œå¹¶åˆå§‹åŒ–å…¶æ–¹å‘ <code>LR, RL, TB, BT</code> ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹éƒ½å¯æŒ‡å®š</p></li><li><p>ç›´æ¥ä½¿ç”¨å˜é‡æ–°å»ºèŠ‚ç‚¹ï¼Œé€šè¿‡ä¸€äº›ç‰¹æ®Šç¬¦æŒ‡å®šå½¢çŠ¶ï¼Œåœ¨å­—ç¬¦ä¹‹å†…å¡«å†™æ–‡å­—</p><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid">flowchart LR    a("(A node with round edges)") -.-&gt;    b{"{rhombus}"} &lt;--&gt;    c(("((circle))")) --xd["[square] defualt"]    style a fill:#ffffd2    style b fill:#fcbad3    style c fill:#aa96da    style d fill:#a8d8ea<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä½¿ç”¨ç®­å¤´ <code>--&gt;</code> è¿æ¥å„ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå¯åœ¨ç®­å¤´ä¸­æ·»åŠ æ–‡å­— <code>--text-&gt;</code>ã€‚ç®­å¤´çš„æ ·å¼ä¹Ÿå¯ä»¥æŒ‡å®šï¼š<code>---, -.-, --x, &lt;--&gt;, ==&gt;</code></p></li><li><p>ä½¿ç”¨ style è¯­æ³•æ›´æ”¹é¢œè‰²ï¼š<code>style id fill:#ffffff, stroke: #ffffff, stroke_witdh: 4px</code></p></li><li><p>ä½¿ç”¨ <code>subgraph id... end</code> è¯­æ³•åˆ›å»ºå­å›¾</p></li></ol><pre class="line-numbers language-scripts" data-language="scripts"><code class="language-scripts">flowchart LR    a("(A node with round edges)") -.-&gt;    b{"{rhombus}"} &lt;--&gt;    c(("((circle))")) --xd["[square] defualt"]    style a fill:#ffffd2    style b fill:#fcbad3    style c fill:#aa96da    style d fill:#a8d8ea<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>mermaid è¿˜èƒ½ç”»å¾ˆå¤šç±»å‹çš„å›¾è¡¨ï¼Œæœ‰éœ€è¦å†å»æ¢ç´¢å§ğŸ˜</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ONCE </tag>
            
            <tag> Semi-supervised </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CG-SSD</title>
      <link href="/archives/e58312c.html"/>
      <url>/archives/e58312c.html</url>
      
        <content type="html"><![CDATA[<h1 id="CG-SSD"><a href="#CG-SSD" class="headerlink" title="CG-SSD"></a>CG-SSD</h1><p>è¿™ç¯‡æ˜¯è¾…åŠ©ç½‘ç»œæœ€è¿‘çš„ä¸€ä¸ªå·¥ä½œï¼Œå¯¹äºå°ç›®æ ‡çš„æ•ˆæœæå‡éå¸¸å¥½ï¼ç®€å•æ•´ç†ä¸€ä¸‹å…¶ä¸­çš„è¾…åŠ©æ¨¡å— CGAM (corner-guided auxiliary module)</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>CGAM çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä½¿ç”¨ BEV map å»åšä¸¤ä¸ªè¾…åŠ©ä»»åŠ¡ï¼š</p><ol><li>corner classification</li><li>corner offset predicton</li></ol><p>ç„¶åå°†é¢„æµ‹å¾—åˆ°çš„ feature map concat åˆ°åŸæ¥çš„ BEV mapï¼Œç„¶åå†å»åš box predictionã€‚è¿™æ ·çš„ CGAM å¯ä»¥å½“ä½œä¸€ä¸ª plug-in å»å¸®åŠ© BEV-based ç½‘ç»œæç‚¹</p><h2 id="Corner-Selection"><a href="#Corner-Selection" class="headerlink" title="Corner Selection"></a>Corner Selection</h2><p>ä¸ºäº†è®© corner å¸¦æœ‰æ›´å¤šçš„ä¿¡æ¯ï¼Œè®ºæ–‡è¿˜æŠŠ corner åˆ†æˆäº†å››ä¸ªç±»åˆ«ï¼š1. Visible; 2. Partly Visible L; 3. Partly Visble W; 4. Invisible</p><p><img src="/archives/e58312c/image-20220519180350316.png" alt="image-20220519180350316" style="zoom:50%;"></p><p>ç®€å•æ¥è®²ï¼Œè§’çš„ç±»åˆ«æ˜¯å…¶æ‰€åœ¨è±¡é™çš„ç‚¹äº‘æ•°é‡å†³å®šçš„ï¼šç‚¹äº‘æœ€å¤šçš„å°±æ˜¯ visible cornerï¼Œæœ€å°‘çš„å°±æ˜¯ invisible cornerï¼Œä¸å¤šä¸å°‘çš„å°±æ˜¯ partly visible corners</p><p>åœ¨åš corner classification çš„æ—¶å€™ä¸ä¼šå»è¯†åˆ«æ‰€æœ‰çš„è§’ï¼Œè€Œæ˜¯å»è¯†åˆ«åä¸‰ç±»è§’ï¼Œè¿™æ ·æ•ˆæœæœ€å¥½ã€‚Corner Selection å°±æ˜¯æŠŠåä¸‰ç±»è§’ç»™æ‰¾å‡ºæ¥ï¼Œå¹¶ä¸”ä¸ºäº†é²æ£’æ€§ï¼Œåˆ†ä¸¤ç§æƒ…å†µè®¨è®ºäº†å¦‚ä½•è¡¡é‡è±¡é™å†…çš„ç‚¹äº‘æ•°é‡ï¼š</p><ol><li>å¦‚æœç‰©ä½“å†…çš„ç‚¹å¾ˆå°‘ï¼Œåªæœ‰ä¸¤ä¸ªè±¡é™æœ‰ç‚¹äº‘ï¼Œå°±ç›´æ¥çœ‹å•ä¸ªè±¡é™å†…ç‚¹äº‘çš„ä¸ªæ•°</li><li>å¦‚æœç‰©ä½“å†…çš„ç‚¹äº‘å¤šï¼Œè€ƒè™‘è¿ç»­ä¸‰ä¸ªè±¡é™å†…çš„ç‚¹äº‘</li></ol><p>è®ºæ–‡ä¸­çš„è¯¦ç»†ç®—æ³•å¦‚ä¸‹</p><p><img src="/archives/e58312c/image-20220519180735304.png" alt="image-20220519180735304" style="zoom: 80%;"></p><h2 id="Archetecture"><a href="#Archetecture" class="headerlink" title="Archetecture"></a>Archetecture</h2><p>CGAM çš„ç»“æ„è®ºæ–‡ä¹Ÿç”»çš„éå¸¸æ¸…æ™°</p><p><img src="/archives/e58312c/image-20220519181158507.png" alt="image-20220519181158507" style="zoom: 67%;"></p><p>æ•´ä¸ªç½‘ç»œçš„ç»“æ„å¦‚ä¸‹</p><p><img src="/archives/e58312c/image-20220519181346862.png" alt="image-20220519181346862" style="zoom: 67%;"></p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><ol><li>ONCE éªŒè¯é›†çš„ç»“æœ</li></ol><p><img src="/archives/e58312c/image-20220521102510164.png" alt="image-20220521102510164" style="zoom: 80%;"></p><ol><li>ä¸åŒè§’å¯¹äºè¡¨ç°çš„æå‡</li></ol><p><img src="/archives/e58312c/image-20220521102558999.png" alt="image-20220521102558999" style="zoom:80%;"></p><ol><li>é€‰å–è§’å¯¹è¡¨ç°çš„æå‡</li></ol><p><img src="/archives/e58312c/image-20220521102632165.png" alt="image-20220521102632165" style="zoom:80%;"></p><ol><li>é¢„æµ‹ offset å¯¹äºæ¨¡å‹çš„æå‡</li></ol><p><img src="/archives/e58312c/image-20220530153242009.png" alt="image-20220530153242009" style="zoom:67%;"></p><ol><li>CGAM ä½œä¸ºè¾…åŠ©æ¨¡å—</li></ol><p><img src="/archives/e58312c/image-20220521102705759.png" alt="image-20220521102705759" style="zoom:80%;"></p><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>ä¸ºä»€ä¹ˆè‡ªå·±çš„ç»“æ„ä¸èµ·ä½œç”¨ï¼Ÿä¹‹åè®¾è®¡ç»“æ„éœ€è¦æ³¨æ„å“ªäº›åœ°æ–¹ï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Point Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenPCDet Center_Head</title>
      <link href="/archives/3d8b79a8.html"/>
      <url>/archives/3d8b79a8.html</url>
      
        <content type="html"><![CDATA[<h1 id="Center-Head"><a href="#Center-Head" class="headerlink" title="Center_Head"></a>Center_Head</h1><p>æˆ‘åˆé‡æ–°æ€è€ƒäº†ä¸€ä¸‹è¯¥å¦‚ä½•å»å­¦ä¹ ä¸€ä¸ªå¤æ‚çš„é¡¹ç›®ï¼Œéš¾ç‚¹åœ¨äºå¤æ‚é¡¹ç›®çš„ä½“é‡ä¼šå¾ˆå¤§ï¼Œæ€æ ·å°†å…¶ä¸­çš„ç»†èŠ‚å’Œæ•´ä½“å¾ˆå¥½çš„æŠŠæ¡ä½ï¼Ÿæˆ‘æ‰“ç®—ç”¨ Center_Head æ¥å®éªŒä¸€ä¸‹è¿™ä¸ªç­–ç•¥ï¼š</p><ol><li><strong>å…³æ³¨æ•´ä½“çš„æ¨¡å—</strong>ï¼Œå¯¹è¾“å…¥ &amp; è¾“å‡º &amp; è¿è¡Œé€»è¾‘éœ€è¦ç‰¹åˆ«æ¸…æ¥š</li><li><strong>ç»†èŠ‚éƒ¨åˆ†è¿‡ä¸€ä¸‹å°±å¥½</strong>ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ç‰¹åˆ«çš„ trick æˆ–è€…å¥‡æ€ªçš„åœ°æ–¹éœ€è¦æ³¨æ„çš„ï¼Œä¸»è¦ç›®çš„ä¸ºå­¦ä¹ ä»£ç æŠ€å·§</li></ol><p>å…·ä½“æ¥è¯´ï¼Œå¯¹äºç±»ï¼ŒæŒ‰ç…§ init å’Œ methods è¿›è¡Œç®€å•åˆ’åˆ†ï¼Œå¯¹äºæ¯ä¸€ä¸ª methodsï¼ŒæŒ‰ç…§ logic + input + output/attributes + used functions + å­¦ä¹ ç‚¹ è¿›è¡Œæ•´ç† </p><p>ä»¥ä¸Šæ˜¯å­¦ä¹ æ¨¡å—çš„æ€è·¯ï¼Œä½†é™¤äº†æ¨¡å—é™¤æ­¤ä¹‹å¤–å¯èƒ½è¿˜è¦æ•´ç†ä¸€ä¸‹é¡¹ç›®çš„å¤§æ¡†æ¶é€»è¾‘ï¼Œä»è€Œé€’å½’åœ°å®Œæˆå¯¹æ•´ä¸ªé¡¹ç›®çš„æŒæ¡</p><h2 id="SeperateHead"><a href="#SeperateHead" class="headerlink" title="SeperateHead"></a>SeperateHead</h2><p>è¿™ä¸ªç±»å°±æ˜¯ç”¨äºå®ç°å­ä»»åŠ¡çš„</p><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><ol><li>input params</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SeparateHead</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_channels<span class="token punctuation">,</span> sep_head_dict<span class="token punctuation">,</span> init_bias<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2.19</span><span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li><p>attributes</p><ol><li><p><code>self.sep_head_dict</code> å­˜æ”¾å‚æ•°ä¿¡æ¯ï¼Œå¤§æ¦‚é•¿è¿™æ ·</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">HEAD_DICT</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token key atrule">'center'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">'out_channels'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token key atrule">'num_conv'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token key atrule">'center_z'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">'out_channels'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token key atrule">'num_conv'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token key atrule">'dim'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">'out_channels'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token key atrule">'num_conv'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token key atrule">'rot'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">'out_channels'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token key atrule">'num_conv'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ hm head çš„ out_channels æ˜¯æ ¹æ® classes each head å†³å®šï¼Œæ•…æ²¡æœ‰å†™åœ¨ dict ä¸­ï¼Œä½†æœ€ç»ˆçš„å­—å…¸é‡Œæ˜¯æœ‰çš„</p></li><li><p>ä¸åŒçš„ fcï¼Œç”¨äºä¸åŒçš„å¤´ï¼Œå…¶åç§°å°±æ˜¯ä¸Šé¢ dict é‡Œçš„ keyã€‚ä» dict æ¥çœ‹éƒ½æ˜¯ç”±ä¸¤å±‚ Conv2d ç»„æˆ</p></li></ol></li></ol><h3 id="forward"><a href="#forward" class="headerlink" title="forward"></a>forward</h3><p>ç›´æ¥ä¸Šå‡½æ•°ï¼Œéå¸¸ç®€å•çš„å‰å‘</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>    ret_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">for</span> cur_name <span class="token keyword">in</span> self<span class="token punctuation">.</span>sep_head_dict<span class="token punctuation">:</span>        ret_dict<span class="token punctuation">[</span>cur_name<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>__getattr__<span class="token punctuation">(</span>cur_name<span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token keyword">return</span> ret_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li>ä½¿ç”¨ <code>__setattr__</code> æ–¹æ³•è®¾ç½® fc çš„åç§°ï¼Œç„¶åä½¿ç”¨ <code>__getattr__</code> è°ƒç”¨ã€‚å½“ç„¶ä½¿ç”¨ <code>getattr &amp; setattr</code> æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥å®ç°ä¸€æ ·çš„åŠŸèƒ½</li><li>ä½¿ç”¨ <code>fc.modules</code> å¾ªç¯æ¨¡å—ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–</li></ol><h2 id="CenterHead"><a href="#CenterHead" class="headerlink" title="CenterHead"></a>CenterHead</h2><h3 id="init-1"><a href="#init-1" class="headerlink" title="init"></a>init</h3><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">CenterHead</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_cfg<span class="token punctuation">,</span> input_channels<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> class_names<span class="token punctuation">,</span> grid_size<span class="token punctuation">,</span> point_cloud_range<span class="token punctuation">,</span> voxel_size<span class="token punctuation">,</span> predict_boxes_when_training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>attribute</p><ol><li><p><code>self.shared_conv</code>ï¼Œä¸€å±‚ kernel_size=3 çš„ Conv2d</p></li><li><p><code>self.heads_list</code>ï¼Œå…¶å®å°±æ˜¯å°†å¤šä¸ª <code>SeqarateHead</code> æ”¾åˆ°ä¸€ä¸ª <code>nn.ModuleList</code> ä¸­ã€‚åœ¨ nuScenes ä¸­æœ‰å¤šä¸ª headï¼ˆå¯èƒ½å› ä¸ºç±»åˆ«å¤ªå¤šï¼ŒæŠŠç›¸ä¼¼çš„ç±»åˆ«æ”¾åˆ°ä¸€ä¸ª head å¤„ç†ï¼‰ï¼Œä½†æ˜¯åœ¨ waymo é‡Œé¢åªæœ‰ä¸€ä¸ª head</p></li><li><p><code>self.build_losses()</code> åˆ›å»ºæŸå¤±å‡½æ•°æ¨¡å—ï¼Œå…·ä½“çš„æŸå¤±å‡½æ•°åˆ†æåœ¨ä¹‹åçš„ç¬”è®°ä¸­å†™ï¼ˆæŒ–å‘ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">build_losses</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">'hm_loss_func'</span><span class="token punctuation">,</span> loss_utils<span class="token punctuation">.</span>FocalLossCenterNet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">'reg_loss_func'</span><span class="token punctuation">,</span> loss_utils<span class="token punctuation">.</span>RegLossCenterNet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p><code>self.class_names_each_head</code> åœ¨ nuScenes ä¸­å¥½åƒæŠŠç›¸ä¼¼çš„ç‰©ä½“ç”¨ä¸€ä¸ªå¤´æ¥å¤„ç†</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">CLASS_NAMES_EACH_HEAD</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token string">'car'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token punctuation">[</span><span class="token string">'truck'</span><span class="token punctuation">,</span> <span class="token string">'construction_vehicle'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">'bus'</span><span class="token punctuation">,</span> <span class="token string">'trailer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">'barrier'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">'motorcycle'</span><span class="token punctuation">,</span> <span class="token string">'bicycle'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">'pedestrian'</span><span class="token punctuation">,</span> <span class="token string">'traffic_cone'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span>      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯åœ¨ waymo æ²¡æœ‰è¿™ä¹ˆåšï¼Œè½¦äººéƒ½æ˜¯ç”¨ä¸€ä¸ª head å¤„ç†</p></li><li><p><code>self.class_id_mapping_each_head</code>ï¼Œåœ¨ä¹‹åéœ€è¦æŠŠ pred label è¿˜åŸåˆ°åŸå§‹ indexã€‚å› ä¸ºåˆ†äº†å¤šå¤´ï¼Œæ¯ä¸ªç±»çš„æ•°å­—æ ‡ç­¾æ˜¯é‡æ–°å¼€å§‹ç®—çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">CLASS_NAMES_EACH_HEAD<span class="token punctuation">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token string">'car'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment"># label [1]</span>    <span class="token punctuation">[</span><span class="token string">'truck'</span><span class="token punctuation">,</span> <span class="token string">'construction_vehicle'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment"># label [1, 2]</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†åœ¨æœ€åç”Ÿæˆ boxes æ—¶ï¼Œè¦è¿˜åŸä¸ºåŸå§‹æ•°å­—æ ‡ç­¾ [1, 2, 3, â€¦]</p></li></ol></li></ol><h3 id="assign-target-of-single-head"><a href="#assign-target-of-single-head" class="headerlink" title="assign_target_of_single_head"></a>assign_target_of_single_head</h3><p>è¯¥å‡½æ•°å°±æ˜¯ç»™å•ä¸ª sample é‡Œçš„æŒ‡å®š classes åˆ†é…ç›®æ ‡</p><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">assign_target_of_single_head</span><span class="token punctuation">(</span>        self<span class="token punctuation">,</span> num_classes<span class="token punctuation">,</span> gt_boxes<span class="token punctuation">,</span> feature_map_size<span class="token punctuation">,</span> feature_map_stride<span class="token punctuation">,</span> num_max_objs<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>        gaussian_overlap<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> min_radius<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token string">""</span>"    Args<span class="token punctuation">:</span>        gt_boxes<span class="token punctuation">:</span> <span class="token punctuation">(</span>N<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>        feature_map_size<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span>W<span class="token punctuation">,</span> H<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">return</span> heatmap<span class="token punctuation">,</span> ret_boxes<span class="token punctuation">,</span> inds<span class="token punctuation">,</span> mask<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li><code>heatmap</code>: (num_classes, y, x) ä»£è¡¨ä¸ºå„ä¸ªç±»çš„å¯èƒ½æ€§</li><li><code>ret_boxes</code>: (num_max_objs, 8+C) æ˜¯ç»è¿‡ encode è¿‡åçš„ boxes $(o_x, o_y, z, log(dx), log(dy), log(dz), sin(\theta), cos(\theta),â€¦)$ï¼š<ol><li>ä¸­å¿ƒé¢„æµ‹ offset</li><li>é•¿å®½é«˜ä¸ºåŸå§‹çš„ log</li><li>å»é™¤äº† class ç»´åº¦ï¼Œä½†æŠŠè§’åº¦ç»´åº¦å˜ä¸ºä¸¤ä¸ª (cos, sin)</li></ol></li><li><code>inds</code>: (num_max_objs) æ¯ä¸€ä¸ªç›®æ ‡çš„åºå·ï¼Œæ˜¯æŠŠäºŒç»´è¡¨æ ¼æ’åºä¸ºä¸€ç»´è¿‡åçš„åºå·</li><li><code>mask</code> (num_max_objs) è¡¨ç¤ºæ˜¯å¦ä¸ºç©ºç›®æ ‡</li></ol></li><li><p>used functions</p><ol><li><code>centernet_utils.gaussian_radius</code> é€šè¿‡ box çš„é•¿å®½ä»¥åŠæœ€å°é‡å æ¯”ä¾‹ï¼Œå¯ä»¥ç®—å‡ºä¸€ä¸ªåŠå¾„å€¼ï¼Œ<a href="https://zhuanlan.zhihu.com/p/96856635">zhihu</a></li><li><code>centernet_utils.draw_gaussian_to_heatmap</code> å°†æ‰©å¼ è¿‡åçš„ gaussian æ”¾åˆ° heatmap ä¸Š</li></ol></li></ol><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li>gaussian2D æ–¹æ³•ä½¿ç”¨äº† <code>np.ogrid</code> äº§ç”Ÿæˆ‘ä»¬å¸Œæœ›çš„æ ¼ç‚¹åºåˆ—ï¼Œç„¶åä½¿ç”¨å¹¿æ’­çš„æ–¹å¼å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„æ ¼ç‚¹å€¼</li><li>tensor çš„åˆ‡ç‰‡æ˜¯å’ŒåŸ tensor å…±äº«å­˜å‚¨çš„ï¼Œè€Œä¸åƒ list çš„åˆ‡ç‰‡ç”Ÿæˆæ–°çš„å¯¹è±¡</li></ol><h3 id="assign-targets"><a href="#assign-targets" class="headerlink" title="assign_targets"></a>assign_targets</h3><p>åˆ©ç”¨å‰é¢å®šä¹‰çš„ <code>assign_target_of_single_head</code>ï¼Œå¯¹æ¯ä¸ª headï¼Œæ¯ä¸€ä¸ª batch è¿›è¡Œå•ç‹¬è®¡ç®—ï¼Œç„¶åå¯¹ batch çš„ç»“æœ concatï¼Œå¯¹æ¯ä¸ª head çš„ç»“æœ appendã€‚ä¸ªäººæ„Ÿè§‰è¿™é‡Œçš„ assign_targets ä¸åƒ anchor-based æ–¹æ³•ï¼Œ<strong>assign è¿™ä¸ªåŠ¨ä½œä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œæ›´åƒæ˜¯åœ¨ build targets</strong> </p><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">assign_targets</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> gt_boxes<span class="token punctuation">,</span> feature_map_size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token string">""</span>"    Args<span class="token punctuation">:</span>        gt_boxes<span class="token punctuation">:</span> <span class="token punctuation">(</span>B<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token number">8</span><span class="token operator">+</span>C<span class="token punctuation">)</span>        feature_map_size<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>H<span class="token punctuation">,</span> W<span class="token punctuation">]</span>    Returns<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äº gt_boxesï¼Œæœ€åä¸€ä¸ª dim æ˜¯ç±»åˆ«ï¼Œæ‰€ä»¥æœ‰ 7 + 1 ä¸ª dimã€‚å¯¹äº nuScenes è¿˜æœ‰é€Ÿåº¦æ ‡ç­¾ (vx, vy)ï¼Œæ‰€ä»¥ dim ä¸º 10</p></li><li><p>output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ret_dict <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'heatmaps'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'target_boxes'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'inds'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'masks'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string">'heatmap_masks'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment"># not used</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œæ¯ä¸€ä¸ªå­—å…¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå†æ¬¡å¼ºè°ƒï¼Œå¯¹äº waymo æ¥è¯´æ¯ä¸ªåˆ—è¡¨åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼ˆåªæœ‰ä¸€ä¸ªå¤´ï¼‰ï¼Œåªæœ‰ nuScenes æŠŠç±»åˆ«åˆ†ç»™äº†å¤šä¸ªå¤´å»å¤„ç†ï¼Œæ‰€ä»¥åˆ—è¡¨æœ‰å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„å½¢çŠ¶å¦‚ä¸‹</p><ol><li><code>heatmaps</code>ï¼Œ(B, num_classes, y, x) $\leftrightarrow$ (B, num_classes, H, W)</li><li><code>target_boxes</code>ï¼Œ(B, num_max_objs, 8 + C)</li><li><code>inds</code>ï¼Œ(B, num_max_objs)</li><li><code>masks</code>ï¼Œ(B, num_max_objs)</li></ol></li></ol><h3 id="sigmoid"><a href="#sigmoid" class="headerlink" title="sigmoid"></a>sigmoid</h3><p>å†™äº†ä¸€ä¸ªç®€å•çš„ sigmoid å‡½æ•°ï¼Œå¯¹ä¸Šä¸‹ç•Œè¿›è¡Œ clamp</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sigmoid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>    y <span class="token operator">=</span> torch<span class="token punctuation">.</span>clamp<span class="token punctuation">(</span>x<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token operator">=</span><span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="get-loss"><a href="#get-loss" class="headerlink" title="get_loss"></a>get_loss</h3><p>å¯¹äºæ¯ä¸€ä¸ª head åˆ†åˆ«è®¡ç®— lossï¼ŒåŒ…æ‹¬ focal loss &amp; reg lossï¼Œå¹¶ç»™è¿™äº› loss ä¹˜ä»¥ç›¸åº”çš„æƒé‡ï¼Œç„¶åå…¨éƒ¨åŠ èµ·æ¥</p><ol><li>input params: noneï¼Œæ²¡æœ‰ inputï¼Œä½¿ç”¨çš„æ˜¯ <code>self.forward_ret_dict</code> é‡Œé¢çš„é¢„æµ‹æ•°æ®</li><li>output: loss, tb_dict</li><li>used functions: è¿™éƒ¨åˆ†å…¶å®ç›¸å¯¹å¤æ‚ï¼ŒOpenPCDet ç›´æ¥æ¬è¿äº† CenterPoint é‡Œé¢çš„åŸå§‹ loss functionsï¼Œæœ‰ä¸¤ä¸ªç±»å‹ï¼š<ol><li>FocalLossCenterNet</li><li>RegLossCenterNet</li></ol></li></ol><h4 id="FocalLossCenterNet"><a href="#FocalLossCenterNet" class="headerlink" title="FocalLossCenterNet"></a>FocalLossCenterNet</h4><p>è¿™ä¸ªç±»å®é™…ä¸Šæ˜¯è°ƒç”¨äº† <code>neg_loss_cornernet</code> å‡½æ•°ï¼Œæ‰€ä»¥ç›´æ¥çœ‹è¿™ä¸ªå‡½æ•°çš„å°±å¥½ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ focal loss çš„ä¸€ä¸ªå˜ä½“ï¼Œè¿›ä¸€æ­¥æŠ‘åˆ¶è´Ÿæ ·æœ¬çš„ loss</p><script type="math/tex; mode=display">L_{\text {det }}=\frac{-1}{N} \sum_{c=1}^{C} \sum_{i=1}^{H} \sum_{j=1}^{W}\left\{\begin{array}{cc}\left(1-p_{c i j}\right)^{\alpha} \log \left(p_{c i j}\right) & \text { if } y_{c i j}=1 \\\left(1-y_{c i j}\right)^{\beta}\left(p_{c i j}\right)^{\alpha} \log \left(1-p_{c i j}\right) & \text { otherwise }\end{array}\right.</script><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">neg_loss_cornernet</span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> gt<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Refer to https://github.com/tianweiy/CenterPoint.    Modified focal loss. Exactly the same as CornerNet. Runs faster and costs a little bit more memory    Args:        pred: (batch x c x h x w)        gt: (batch x c x h x w)        mask: (batch x h x w)    Returns:    """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>c ä»£è¡¨ç±»åˆ«æ•°é‡</p></li><li><p>output: loss with shape []ï¼Œæ˜¯ä¸€ä¸ªæ ‡é‡</p></li></ol><h4 id="RegLossCenterNet"><a href="#RegLossCenterNet" class="headerlink" title="RegLossCenterNet"></a>RegLossCenterNet</h4><p>å¯¹ positive point è®¡ç®—å›å½’æŸå¤±</p><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> output<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> ind<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> target<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        output: (batch x dim x h x w) or (batch x max_objects)        mask: (batch x max_objects)        ind: (batch x max_objects)        target: (batch x max_objects x dim)    Returns:    """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>output: loss with shape [dim]ï¼Œä¹Ÿæ˜¯ normalized by mask (true gt)</p></li><li><p>used functions</p><ol><li><code>_transpose_and_gather_feat(output, ind)</code> æŠŠ feature map æ‹‰ç›´å¹¶å˜æ¢ä¸€ä¸‹ç»´åº¦é¡ºåº (B, M, dim)ï¼Œç„¶åä½¿ç”¨ gather é€šè¿‡ inds é€‰å‡ºéœ€è¦çš„ feature</li><li><code>_reg_loss</code> è®¡ç®—å„ä¸ªç»´åº¦çš„ L1 æŸå¤±å‡½æ•°ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸¤ç‚¹æ³¨æ„ï¼š<ol><li>å¤„ç†äº† nan å€¼ï¼ŒæŠŠå…¶ç½®0</li><li>ä½¿ç”¨äº† mask å°†ç©º gt æ©å»</li></ol></li></ol></li></ol><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li><code>tensor.expand</code> å’Œ <code>tensor.repeat</code> çš„åŒºåˆ«æœ‰ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯ expand ä»…ä»…æ”¹å˜ viewï¼Œä¸åŸ tensor å…±äº«å†…å­˜ï¼Œä½† repeat æ˜¯ç”Ÿæˆæ–°å¯¹è±¡ï¼›å¦ä¸€ä¸ªæ˜¯è¾“å…¥å‚æ•°ä¸ä¸€æ ·ï¼Œexpand æ˜¯ desired shapeï¼Œrepeat æ˜¯é‡å¤æ¬¡æ•°ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>tensor.expand_as(tensor)</code> ç®€åŒ–</li><li>å¯ä»¥ä½¿ç”¨ unsqueeze æ–¹æ³•ï¼Œè¿™æ ·åœ¨ broadcast æ—¶ï¼ˆä¾‹å¦‚ expandï¼‰ä¸å®¹æ˜“å‡ºé”™</li><li><code>torch.gather</code> å’Œ <code>torch.scatter</code> æ˜¯ç›¸åçš„æ“ä½œï¼Œ<a href="https://pytorch.org/docs/stable/generated/torch.gather.html#torch.gather">gather</a> å¯ä»¥çœ‹ä½œåœ¨ tensor é‡Œé¢å–ä¸€äº›å…ƒç´ ï¼Œç”Ÿæˆæ–°çš„ tensorã€‚åœ¨è¿™é‡Œæ˜¯ä½¿ç”¨ inds åœ¨ output ä¸­å–ä¸€äº›å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ä¸ gt çš„ä½ç½®å¯¹åº”</li><li>ä½¿ç”¨ <code>(~ torch.isnan(gt_regr)).float()</code> ç”Ÿæˆ nan çš„ maskï¼ŒæŠŠä¸€äº›å¼‚å¸¸ç‚¹ç­›é™¤</li></ol><h3 id="generate-predicted-boxes"><a href="#generate-predicted-boxes" class="headerlink" title="generate_predicted_boxes"></a>generate_predicted_boxes</h3><p>å¯¹ encode çš„ boxes è¿›è¡Œ decodeï¼Œå¹¶ä¸”æ ¹æ® post processing é…ç½®è¿›è¡Œè¿‡æ»¤</p><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_predicted_boxes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> pred_dicts<span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¾ç„¶æ˜¯å¯¹æ¯ä¸€ä¸ª headï¼Œæ¯ä¸€ä¸ª batch è¿›è¡Œå¾ªç¯å¤„ç†</p></li><li><p>output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ret_dict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>    <span class="token string">'pred_boxes'</span><span class="token punctuation">:</span> boxes_all_heads<span class="token punctuation">,</span><span class="token comment"># (num_boxes_all_heads, 7+C),</span>    <span class="token string">'pred_scores'</span><span class="token punctuation">:</span> scores_all_heads<span class="token punctuation">,</span><span class="token comment"># (num_boxes_all_heads,)</span>    <span class="token string">'pred_labels'</span><span class="token punctuation">:</span> labels_all_heads<span class="token punctuation">,</span><span class="token comment"># (num_boxes_all_heads,)</span><span class="token punctuation">}</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™å’Œ assign_targets çš„è¾“å‡ºæœ‰ç‚¹ç›¸ä¼¼ï¼Œä½†åè€…æ˜¯ list of dict of listï¼Œæ¯”å‰è€…è¿˜å¤šä¸€ä¸ª batch å¥—å¨ƒ</p></li><li><p>used functionsï¼š</p><ol><li><p><code>centernet_utils.decode_bbox_from_heatmap</code>ï¼ŒåŠŸèƒ½å°±æ˜¯å‡½æ•°åï¼Œå…¶ input params å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">final_pred_dicts <span class="token operator">=</span> centernet_utils<span class="token punctuation">.</span>decode_bbox_from_heatmap<span class="token punctuation">(</span>    heatmap<span class="token operator">=</span>batch_hm<span class="token punctuation">,</span><span class="token comment"># pred heatmap, note is batch data</span>    rot_cos<span class="token operator">=</span>batch_rot_cos<span class="token punctuation">,</span> rot_sin<span class="token operator">=</span>batch_rot_sin<span class="token punctuation">,</span><span class="token comment"># pred rotation</span>    center<span class="token operator">=</span>batch_center<span class="token punctuation">,</span> center_z<span class="token operator">=</span>batch_center_z<span class="token punctuation">,</span><span class="token comment"># pred center offset &amp; z</span>    dim<span class="token operator">=</span>batch_dim<span class="token punctuation">,</span><span class="token comment"># pred h w l </span>    vel<span class="token operator">=</span>batch_vel<span class="token punctuation">,</span><span class="token comment"># pred velocity</span>    point_cloud_range<span class="token operator">=</span>self<span class="token punctuation">.</span>point_cloud_range<span class="token punctuation">,</span><span class="token comment"># point cloud range</span>    voxel_size<span class="token operator">=</span>self<span class="token punctuation">.</span>voxel_size<span class="token punctuation">,</span><span class="token comment"># voxel size</span>    feature_map_stride<span class="token operator">=</span>self<span class="token punctuation">.</span>feature_map_stride<span class="token punctuation">,</span><span class="token comment"># feature map stride</span>    K<span class="token operator">=</span>post_process_cfg<span class="token punctuation">.</span>MAX_OBJ_PER_SAMPLE<span class="token punctuation">,</span><span class="token comment"># max objects per sample</span>    circle_nms<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token comment"># not implemented yet</span>    score_thresh<span class="token operator">=</span>post_process_cfg<span class="token punctuation">.</span>SCORE_THRESH<span class="token punctuation">,</span><span class="token comment"># score thresh</span>    post_center_limit_range<span class="token operator">=</span>post_center_limit_range<span class="token comment"># center limit range</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‰é¢çš„ input å°±æ˜¯ä¸ºäº†ç”Ÿæˆ boxï¼Œ<strong>åé¢å››ä¸ªå‚æ•°æ˜¯ä¸ºäº†è¿‡æ»¤å¾—åˆ†ä½æˆ–è€…åœ¨è§†è§’èŒƒå›´å¤–çš„é€‰æ¡†</strong>ã€‚output æ˜¯å•ä¸ª head çš„ batch ç»“æœ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ret_dict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>    <span class="token string">'pred_boxes'</span><span class="token punctuation">:</span> boxes_single_head<span class="token punctuation">,</span><span class="token comment"># (num_boxes, 7 + C)</span>    <span class="token string">'pred_scores'</span><span class="token punctuation">:</span> scores_single_head<span class="token punctuation">,</span><span class="token comment"># (num_boxes,)</span>    <span class="token string">'pred_labels'</span><span class="token punctuation">:</span> labels_single_head<span class="token punctuation">,</span><span class="token comment"># (num_boxes,)</span><span class="token punctuation">}</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>pred_labels ä¼šåœ¨ä¹‹åç»è¿‡ class_id_mapping_each_head æ¢å¤ä¸ºåŸå§‹ id</p></li><li><p><code>model_nms_utils.class_agnostic_nms</code>ï¼Œæ˜¯å¯¹ batch ä¸­çš„æ¯ä¸ª sample è¿›è¡Œ nmsï¼Œè·å¾—æœ€ç»ˆçš„final boxesã€‚Input params å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">class_agnostic_nms</span><span class="token punctuation">(</span>box_scores<span class="token punctuation">,</span> box_preds<span class="token punctuation">,</span> nms_config<span class="token punctuation">,</span> score_thresh<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>NMS_CONFIG å¤§æ¦‚é•¿è¿™æ ·</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">NMS_CONFIG</span><span class="token punctuation">:</span>    <span class="token key atrule">NMS_TYPE</span><span class="token punctuation">:</span> nms_gpu    <span class="token key atrule">NMS_THRESH</span><span class="token punctuation">:</span> <span class="token number">0.2</span>    <span class="token key atrule">NMS_PRE_MAXSIZE</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token comment"># not useful</span>    <span class="token key atrule">NMS_POST_MAXSIZE</span><span class="token punctuation">:</span> <span class="token number">83</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>output æœ‰ä¸¤ä¸ªï¼š1. selected index; 2. selected scores</p></li></ol></li></ol><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li><code>torch.topk(tensor, k, dim)</code> å¯ä»¥åœ¨æŸä¸ªç»´åº¦é€‰æ‹© top k ä¸ªæ•°æ®ï¼Œè¿”å› (topk_tensor, topk_index)</li><li><code>torch.LongTensor</code> or <code>torch.Tensor</code>ä»…è¾“å…¥ä¸€ä¸ªæ•°å­— n åˆ›å»ºä¸€ä¸ª shape ä¸º (n,) çš„ tensor</li></ol><h3 id="reorder-rois-for-refining"><a href="#reorder-rois-for-refining" class="headerlink" title="reorder_rois_for_refining"></a>reorder_rois_for_refining</h3><p>ç”±äºæ¯ä¸ª batch è·å¾—æœ€ç»ˆçš„ boxes ä¸ªæ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œä¸ºäº†è®©è¿™äº› boxes é€åˆ° roi head ä¸­ï¼Œéœ€è¦å°†è¿™äº› boxes åˆå¹¶ä¸ºä¸€ä¸ª tensor</p><ol><li><p>input params</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@staticmethod</span><span class="token keyword">def</span> <span class="token function">reorder_rois_for_refining</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> pred_dicts<span class="token punctuation">)</span><span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>pred_dictsï¼Œå°±æ˜¯ generate_predicted_boxes çš„è¾“å‡º</p></li><li><p>output</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">        <span class="token keyword">return</span> rois<span class="token punctuation">,</span> roi_scores<span class="token punctuation">,</span> roi_labels<span class="token comment"># rois: (B, num_max_boxes, 7 + C)</span><span class="token comment"># roi_scores: (B, num_max_boxes)</span><span class="token comment"># roi_labels: (B, num_max_boxes)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç©º roiï¼Œä½¿ç”¨0ä»£æ›¿ï¼Œå¹¶ä¸” num_max_boxes çš„æœ€å°å€¼ clamp ä¸º1ï¼Œä»¥é¿å…ç¨‹åºé”™è¯¯</p></li></ol><h3 id="forward-1"><a href="#forward-1" class="headerlink" title="forward"></a>forward</h3><p>forward æŠŠä¹‹å‰çš„ç»„ä»¶ä¸²èµ·æ¥ï¼š</p><ol><li>è·å¾— spatial features 2d</li><li>ä½¿ç”¨ seperate heads é¢„æµ‹</li><li>ä¸ºæ¯ä¸ª headï¼Œæ¯ä¸ª batchï¼Œæ„å»º targets</li><li>æ›´æ–° forward_ret_dict</li><li>å¦‚æœéœ€è¦çš„è¯ï¼Œç”Ÿæˆé¢„æµ‹é€‰æ¡†ï¼Œå¹¶æ„å»º roisï¼Œç„¶åæ›´æ–° data_dict</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenPCDet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Offboard 3D Object Detection from Point Cloud Sequences</title>
      <link href="/archives/1d439585.html"/>
      <url>/archives/1d439585.html</url>
      
        <content type="html"><![CDATA[<h1 id="Offboard-3D-Object-Detection-from-Point-Cloud-Sequences"><a href="#Offboard-3D-Object-Detection-from-Point-Cloud-Sequences" class="headerlink" title="Offboard 3D Object Detection from Point Cloud Sequences"></a>Offboard 3D Object Detection from Point Cloud Sequences</h1><hr><p>Qi, Charles R., et al. â€œOffboard 3D Object Detection from Point Cloud Sequences.â€ <em>ArXiv:2103.05073 [Cs]</em>, 1, Mar. 2021. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/2103.05073">http://arxiv.org/abs/2103.05073</a>.</p><p>Yang, Bin, et al. â€œAuto4D: Learning to Label 4D Objects from Sequential Point Clouds.â€ <em>ArXiv:2101.06586 [Cs]</em>, Mar. 2021. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/2101.06586">http://arxiv.org/abs/2101.06586</a>.</p><hr><p>è¿™ä¸¤ç¯‡æ–‡ç« éƒ½æ˜¯ä¸ºäº†è‡ªåŠ¨æ ‡æ³¨è€Œè®¾è®¡ã€‚ä¸åæƒœè®¡ç®—èµ„æºï¼Œç›®çš„å°±æ˜¯è¦æŠŠå‡†ç¡®ç‡ç»™å†²ä¸Šå»ï¼Œä¸€æ—¦è¶…è¶Šæˆ–æ¥è¿‘äº†äººå·¥æ ‡æ³¨çš„æ°´å¹³ï¼Œè¿™äº›è®¡ç®—ä»£ä»·ç›¸æ¯”äºäººåŠ›å°†ä¼šæ˜¾å¾—æ›´ä¾¿å®œï¼Œå¯ç”¨äºè®­ç»ƒ data-hungry æ¨¡å‹</p><h2 id="Auto4D"><a href="#Auto4D" class="headerlink" title="Auto4D"></a>Auto4D</h2><p>ä¸­å¿ƒæ€æƒ³éƒ½æ˜¯ä½¿ç”¨å¤šå¸§ç‚¹äº‘æ¥ä¼˜åŒ–å½“ä¸‹çš„é¢„æµ‹</p><ol><li><p>ç”Ÿæˆé¢„æµ‹é€‰æ¡†ã€‚ä½¿ç”¨ä¸€ä¸ªç°æˆçš„ç‚¹äº‘ç›®æ ‡æ£€æµ‹å™¨ï¼Œå¯¹ï¼ˆè¿ç»­ï¼‰å¤šå¸§çš„ç‚¹äº‘è¿›è¡Œæ£€æµ‹ï¼Œå½¢æˆæœ€åˆçš„è½¨è¿¹é¢„æµ‹ã€‚è½¨è¿¹è¡¨ç¤ºä¸º $O =\set {D_i}$ å…¶ä¸­ D å°±ä»£è¡¨ detectionsï¼Œä¸ä¹‹å‰çš„é€‰æ¡†è¡¨ç¤ºä¸åŒï¼Œè¿™é‡Œé¢„æµ‹é€‰æ¡†ç»“æœä¸º $D_i = (p,s,t)$ ï¼Œ $p=(x, y, \theta)$ ä»£è¡¨ä½ç½®ï¼Œ$s=(w,l)$ ä»£è¡¨é€‰æ¡†é•¿å®½ï¼Œ$t$ è‡ªç„¶å°±æ˜¯æ—¶é—´æˆ³äº†</p></li><li><p>ç›®æ ‡å¤§å°é¢„æµ‹ object size branchã€‚å°†è½¨è¿¹ä¸­æ¯ä¸€ä¸ªç›®æ ‡çš„<strong>ç‚¹</strong> $x_{box}^O$ æ•´åˆåˆ°åŒä¸€ä¸ªåæ ‡ç³» object coordinateï¼ˆè¿™ä¸€æ­¥åº”è¯¥éœ€è¦ç›®æ ‡è·Ÿè¸ªçš„ç®—æ³•ï¼Œä»¥åå†æ€»ç»“ï¼Œå‡è®¾å’±ä¼šäº†ï¼Œå…ˆæ‹¿æ¥ç”¨ğŸ˜ï¼‰ã€‚é€šè¿‡ä¸€ä¸ª encoder &amp; decoder æ¶æ„é¢„æµ‹å‡ºæ¯ä¸€ä¸ªç›®æ ‡çš„å¤§å°ï¼Œä½¿ç”¨è¯¥å¤§å°å»æ›´æ–°è½¨è¿¹ä¸­çš„é€‰æ¡†ã€‚å¯¹äºæ›´æ–°æ–¹æ³•è®ºæ–‡æå‡ºäº†ä¸€ä¸ªå‘è¿‘ä¾§è§’å¯¹é½çš„æ–¹æ³•ï¼Œæ‰€è°“è¿‘ä¾§è§’å°±æ˜¯ç¦»è‡ªè½¦ ego-car è¿‘çš„é‚£ä¸€ä¸ªè§’</p><script type="math/tex; mode=display">\mathcal{F}_{\text {object }}=\mathrm{CNN}_{\text {box}}\left(\mathbf{x}_{\text {box }}^{\mathbf{O}}\right)\\\mathbf{s}^{\prime}=\operatorname{MLP}_{\text {size }}\left(\mathcal{F}_{\text {object }}(\mathbf{c})\right)</script><p><img src="/archives/1d439585/image-20220415215513217.png" alt="image-20220415215513217" style="zoom:50%;"></p></li><li><p>é€šè¿‡è½¨è¿¹ä¿¡æ¯ç»†åŒ–é€‰æ¡† motion path branchã€‚è¿™é‡Œå°±ä¸å†åƒä¸Šä¸€æ­¥ä½¿ç”¨ object coordinateï¼Œè€Œæ˜¯ä½¿ç”¨ world corrdinate å°†æ‰€æœ‰çš„ç›®æ ‡ä¸­çš„ç‚¹ $x_{box}^O$ æ•´åˆåˆ°åŒä¸€ä¸ªåæ ‡åœºæ™¯ä¸­ï¼Œè·å¾—è½¨è¿¹ trajectoryï¼Œè®ºæ–‡é‡Œä¹Ÿå« pathã€‚path çš„ç‰¹å¾åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šè½¨è¿¹ $x_{path}^O$ï¼ˆç»å¯¹ç‰¹å¾ï¼‰å’Œä½ç§» $h_{motion}$ï¼ˆç›¸å¯¹ç‰¹å¾ï¼‰ã€‚å…¶ä¸­è½¨è¿¹ç‰¹å¾å°±æ˜¯ä½¿ç”¨ç‚¹ç‰¹å¾ï¼Œè€Œä½ç§»ç‰¹å¾æ˜¯å‰åå¸§ä¹‹é—´çš„é€‰æ¡†ä½ç½®çš„åç§»</p><script type="math/tex; mode=display">\mathcal{F}_{\text {path }}=\mathrm{C N N}_\text {path}\left(\mathbf{x}_{\text {path }}^{\mathbf{O}}\right)\\\mathbf{h}_{\text {motion }}^{i}=\left[x^{i}-x^{i-1}, y^{i}-y^{i-1}, \theta^{i}-\theta^{i-1}\right]</script><p>ä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªç‰¹å¾å»ç»†åŒ–ä¹‹å‰é¢„æµ‹å¾—åˆ°é€‰æ¡†</p><script type="math/tex; mode=display">\Delta \mathbf{p}=\operatorname{MLP}_{\text {path }}\left(\left[\mathcal{F}_{\text {path }}(\mathbf{p}), \mathcal{F}_{\text {motion }}(t)\right]\right)\\\begin{array}{l}x^{\prime}=(1+\Delta x) * x \\y^{\prime}=(1+\Delta y) * y \\\theta^{\prime}=\theta+\Delta \theta\end{array}</script></li><li><p>å¯¹äºé™æ€å’ŒåŠ¨æ€çš„ç‰©ä½“è®ºæ–‡è¿˜åšäº†ç®€å•çš„åŒºåˆ†å¤„ç†ï¼šé™æ€çš„ç‰©ä½“å› ä¸ºæ²¡æœ‰è½¨è¿¹ï¼Œæ‰€ä»¥åªå¯¹å¾—åˆ†æœ€é«˜çš„é‚£ä¸€å¸§è¿›è¡Œç»†åŒ–</p></li></ol><p>ä¸‹é¢çœ‹çœ‹å›¾ç¤ºå§ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„</p><p><img src="/archives/1d439585/image-20220415215531822.png" alt="image-20220415215531822" style="zoom:50%;"></p><h2 id="Offboard-3D-Object-Detection-Waymo"><a href="#Offboard-3D-Object-Detection-Waymo" class="headerlink" title="Offboard 3D Object Detection, Waymo"></a>Offboard 3D Object Detection, Waymo</h2><p>è¿™ä¸€ç¯‡æ˜¯ waymo çš„å·¥ä½œï¼Œå‡ºå‘ç‚¹ä¾ç„¶æ˜¯åˆ©ç”¨è¿ç»­å¤šå¸§ä¿¡æ¯æ¥æé«˜æ£€æµ‹è¡¨ç°ï¼Œç„¶åç–¯ç‹‚å åŠ  trickï¼Œèƒ½æ¶¨ç‚¹çš„å…¨éƒ¨éƒ½ç»™æˆ‘ä¸Šï¼Œç»†èŠ‚å¾ˆå¤šï¼Œæœ€ç»ˆæ•ˆæœç”šè‡³å¯ä»¥æ¥è¿‘äººç±»æ ‡æ³¨ã€‚å‚è€ƒé“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/397180644">çŸ¥ä¹</a></p><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>åŸºæœ¬å¥—è·¯éƒ½æ˜¯ä¸€æ ·çš„</p><ol><li>é¦–å…ˆå’Œ Auto4D ä¸€æ ·ï¼Œä½¿ç”¨æ£€æµ‹å™¨å¯¹å¤šå¸§è¿›è¡Œæ£€æµ‹ï¼Œç›¸å½“äºåˆå§‹åŒ–ç›®æ ‡ä½ç½®</li><li>å°†å¤šå¸§ä¸­çš„ç›®æ ‡ä¿¡æ¯æŠ½å–å‡ºæ¥ï¼ˆåŒ…å«ç‚¹äº‘ä¿¡æ¯ï¼Œæ£€æµ‹æ¡†ä¿¡æ¯ï¼Œæ—¶é—´ä¿¡æ¯ï¼‰</li><li>ä½¿ç”¨è¿™äº›ä¿¡æ¯æå‡ºé«˜è´¨é‡é€‰æ¡†ï¼ˆæ­¤å¤„çœç•¥å¤§é‡ç»†èŠ‚â€¦ï¼‰</li></ol><p><strong>Problem Statement</strong></p><ol><li>è€ƒè™‘ç‚¹äº‘åºåˆ— $\set {P_i \in \mathbb R^{n_i \times C}}, i=1,2,â€¦,N$ï¼ŒC ä¸ºç‚¹äº‘åŸå§‹ç‰¹å¾å¦‚ (x, y, z, r)</li><li>sensor poses $\set{M_i=[R_i|t_i] \in \mathbb R^{3\times 4}}$ï¼Œæ˜¯å·²çŸ¥çš„ã€‚è¯¥çŸ©é˜µç”¨äºè¡¨ç¤ºä¼ æ„Ÿå™¨åœ¨ç»å¯¹åæ ‡ä¸‹çš„çŠ¶æ€ï¼Œç”¨äºæ¶ˆé™¤è‡ªè½¦è¿åŠ¨çš„å½±å“</li></ol><p><strong>Frame-centric to Object-centric</strong></p><p>ç›´æ¥å°†å¤šä¸ª frame è¿›è¡Œå åŠ å¹¶ä¸èƒ½è¡¥å¿æˆ‘ä»¬å…³å¿ƒå¯¹è±¡ä¸­çš„ç‚¹äº‘ï¼Œæ‰€ä»¥å¾ˆè‡ªç„¶å°±å¼•å‡ºäº† object-centric å åŠ æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ˜¯å¯¹æ¯ä¸ªç‰©ä½“åœ¨å¤šå¸§é‡Œé¢çš„ç‚¹äº‘è¿›è¡Œå åŠ </p><p><img src="/archives/1d439585/image-20220417210343607.png" alt="image-20220417210343607" style="zoom:50%;"></p><p>æ•´ä¸ªæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼ˆç°åœ¨å¯èƒ½æš‚æ—¶çœ‹ä¸æ˜ç™½ï¼Œå¯ä»¥ä¸€ä¼šå„¿å€’å›æ¥çœ‹ï¼‰</p><p><img src="/archives/1d439585/image-20220417210653531.png" alt="image-20220417210653531" style="zoom: 80%;"></p><h3 id="Multi-frame-3D-Object-Detection"><a href="#Multi-frame-3D-Object-Detection" class="headerlink" title="Multi-frame 3D Object Detection"></a>Multi-frame 3D Object Detection</h3><p>è®ºæ–‡æå‡º MVF çš„å‡çº§ç‰ˆï¼ŒMVF++ï¼Œæ”¹å˜å¦‚ä¸‹ï¼š</p><ol><li>è¾…åŠ©æ¨¡å—ç”¨äºè¯­ä¹‰åˆ†å‰² auxiliary segmentation</li><li>æ”¾å¼ƒ anchor-based ç»“æ„é‡‡ç”¨ FCOS ï¼ˆè¿˜æ²¡çœ‹è¿‡è¿™ç¯‡ğŸ˜­ï¼‰ä¸­çš„ anchor-free</li><li>å¢å¤§æ¨¡å‹çš„å‚æ•°</li></ol><p>å›¾ç¤ºå¦‚ä¸‹ï¼ˆæœ¬æ¥åˆå¯ä»¥å‘ä¸€ç¯‡è®ºæ–‡ï¼Œå¤§ä½¬ç›´æ¥å‡ å¥è¯å¸¦è¿‡ï¼Œç„¶åæŠŠè¯¦ç»†å†…å®¹æ”¾é™„å½•â€¦ï¼‰</p><p><img src="/archives/1d439585/image-20220417211602761.png" alt="image-20220417211602761" style="zoom:50%;"></p><p>è®ºæ–‡ç›´æ¥å°†å¤šå¸§çš„ç‚¹ï¼ŒåŸºäºè‡ªè½¦è¿åŠ¨ ego-motionï¼Œè½¬ç§»åˆ°å½“å‰å¸§é‡Œï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªç‚¹åŠ å…¥äº†ç›¸å¯¹çš„æ—¶é—´æˆ³ã€‚è¿™ä¸ªèšåˆçš„ç‚¹äº‘åœºæ™¯å°†ä½œä¸ºè¾“å…¥ï¼Œé€è‡³ MFV++ ä¸­</p><p><strong>Test Time Augmentation</strong></p><p>é™¤æ­¤ä¹‹å¤–ä½¿ç”¨ TTA è®¾ç½®ï¼šå°†ç‚¹äº‘åœºæ™¯æ—‹è½¬10ç§è§’åº¦ï¼Œå¹¶å°†è·å¾—çš„é¢„æµ‹é€‰æ¡†ç»“æœè¿›è¡ŒåŠ æƒèåˆ</p><h3 id="Multi-object-Tracking"><a href="#Multi-object-Tracking" class="headerlink" title="Multi-object Tracking"></a>Multi-object Tracking</h3><p>è®ºæ–‡çš„è·Ÿè¸ªç®—æ³•æ˜¯ <a href="https://github.com/xinshuoweng/AB3DMOT">AB3DMOT</a> çš„ä¸€ä¸ªå˜ä½“ï¼ˆæˆ–è€…è¯´ç®€åŒ–ç‰ˆï¼Ÿï¼‰ç”¨æ£€æµ‹æ¡†åšæ•°æ®å…³è”ï¼Œå¡å°”æ›¼æ»¤æ³¢åšè¿åŠ¨çŠ¶æ€ä¼°è®¡</p><h3 id="Object-Track-Data-Extraction"><a href="#Object-Track-Data-Extraction" class="headerlink" title="Object Track Data Extraction"></a>Object Track Data Extraction</h3><p>å¯¹äºæ¯ä¸€ä¸ªç‹¬ç‰¹çš„ç›®æ ‡ï¼Œå°†å®ƒçš„å¤šå¸§æ£€æµ‹æ¡†ä»¥åŠæ¡†å†…çš„ç‚¹æå–å‡ºæ¥ï¼ˆæ£€æµ‹æ¡†ä¼šç¨å¾®æ”¾å¤§ä¸€ç‚¹ä»¥ä¿ç•™æ›´å¤šä¿¡æ¯ï¼‰ï¼Œç”¨ $\set {P_{j,k}} , \set {B_{j,k}}$ åˆ†åˆ«è¡¨ç¤ºç¬¬ k å¸§ï¼Œç¬¬ j ä¸ªç‰©ä½“çš„ç‚¹äº‘å’Œé€‰æ¡†ä¿¡æ¯</p><h3 id="Object-centric-Auto-Labeling"><a href="#Object-centric-Auto-Labeling" class="headerlink" title="Object-centric Auto Labeling"></a>Object-centric Auto Labeling</h3><p>ç°åœ¨ç»ˆäºå¯ä»¥è¿›è¡Œæ ¸å¿ƒçš„è‡ªåŠ¨æ ‡æ³¨éƒ¨åˆ†äº†ã€‚è‡ªåŠ¨æ ‡æ³¨è¿‡ç¨‹ä¸»è¦ç”±ä¸‰ä¸ªå­æ¨¡å—å®Œæˆï¼š</p><ol><li>Track-based motion state classificationï¼Œä¼°è®¡ç‰©ä½“çš„è¿åŠ¨çŠ¶æ€ï¼Œçœ‹ç‰©ä½“æ˜¯é™æ­¢çš„è¿˜æ˜¯è¿åŠ¨çš„</li><li>Static object auto labelingï¼Œé™æ€ç‰©ä½“è‡ªåŠ¨æ ‡æ³¨</li><li>Dynamic object auto labelingï¼ŒåŠ¨æ€ç‰©ä½“è‡ªåŠ¨æ ‡æ³¨</li></ol><p>è¿˜æœ‰ä¸€ä¸ªè¦æçš„ç‚¹ï¼šè®ºæ–‡ä¸ºé™æ€ç‰©ä½“åˆ†é…ä¸€ä¸ªå•ä¸€çš„ 3D bounding boxï¼Œè€Œä¸æ˜¯åœ¨ä¸åŒçš„å¸§ä¸­åˆ†é…å•ç‹¬çš„ boxesï¼Œè¿™æ ·èƒ½é¿å…æŠ–åŠ¨</p><p>å¯¹äºè¿ç»­å¸§å°äº7å¸§çš„ç‰©ä½“ï¼Œè®ºæ–‡ä¸å¯¹å…¶è¿›è¡Œè‡ªåŠ¨æ ‡æ³¨ï¼Œï¼ˆä¸ªäººçŒœæµ‹ï¼‰å°±ç›´æ¥æ‹¿ MVF++ é‡Œçš„ç»“æœä½œä¸ºæœ€ç»ˆç»“æœ</p><h4 id="State-Classification"><a href="#State-Classification" class="headerlink" title="State Classification"></a>State Classification</h4><p>å¯¹æ¯ä¸ªç›®æ ‡æå–ä¸¤ä¸ªç‰¹å¾ï¼šæ£€æµ‹æ¡†ä¸­å¿ƒçš„æ–¹å·®å’Œè·Ÿè¸ªæ¡†ä¸­å¿ƒä»å¼€å§‹åˆ°ç»“æŸè·ç¦»ï¼Œç„¶åç”¨ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ä¼°è®¡è¿åŠ¨çŠ¶æ€ã€‚æ ‡ç­¾åˆ¶ä½œæ–¹æ³•å¦‚ä¸‹ï¼šå¦‚æœç›®æ ‡ä¸­å¿ƒç‚¹çš„åç§»é€Ÿåº¦å°äº1m/sï¼ä¸”å¼€å§‹åˆ°ç»“æŸçš„è·ç¦»ä¸è¶…è¿‡ï¼‘mï¼Œåˆ™è®¤ä¸ºæ˜¯é™æ€ç›®æ ‡ï¼›å¦åˆ™è®¤ä¸ºå®ƒæ˜¯åŠ¨æ€ç›®æ ‡ã€‚è€Œå¯¹äºè¡Œäººï¼Œä¸€å¾‹ä½œä¸ºåŠ¨æ€å¤„ç†</p><p>è¯¥åˆ†ç±»å™¨å¯¹äºè½¦è¾†å‡†ç¡®ç‡é«˜è¾¾ 99% ä»¥ä¸Šï¼Œåªæœ‰ä¸€äº›é®æŒ¡å¾ˆä¸¥é‡çš„æƒ…å†µè¯†åˆ«é”™è¯¯</p><h4 id="Static-Object-Auto-Labeling"><a href="#Static-Object-Auto-Labeling" class="headerlink" title="Static Object Auto Labeling"></a>Static Object Auto Labeling</h4><p>è¯¥æ¨¡å—çš„è¾“å…¥ä¾ç„¶æ˜¯ä¹‹å‰èåˆçš„ç‚¹äº‘ merged point cloudsï¼Œå¹¶å¯¹æ¯ä¸€ä¸ªç‰©ä½“é¢„æµ‹<strong>ä¸€ä¸ª</strong>é€‰æ¡†</p><p>è®ºæ–‡å…ˆå°†ç‰©ä½“ä¸­çš„ç‚¹äº‘è½¬ç§»åˆ° box coordinateï¼Œä¸ªäººç†è§£æ˜¯å°†ç‰©ä½“ä¸­çš„ç‚¹äº‘åæ ‡è½¬ç§»åˆ°ä»¥ç‰©ä½“ä¸ºåŸç‚¹çš„åæ ‡ç³»ã€‚å› ä¸ºæ˜¯é™æ€ç‰©ä½“ï¼Œæ‰€ä»¥å¤šå¸§çš„é‡åˆåº¦åº”è¯¥æŒºé«˜çš„ã€‚<strong>å¯¹äºåŒä¸€ä¸ªç‰©ä½“</strong>ï¼Œä¸éœ€è¦å¯¹æ¯ä¸€ä¸ªå¸§éƒ½åšè¿™æ ·çš„åæ ‡è½¬ç§»æ“ä½œï¼Œè€Œæ˜¯é€‰æ‹©ä¸€ä¸ªå¸§ï¼Œä»¥è¯¥å¸§çš„ç‰©ä½“ä½œä¸ºåŸç‚¹ï¼Œç„¶åå†å°†æ‰€æœ‰å¸§ä¸­ç‰©ä½“çš„ç‚¹è½¬ç§»åˆ°è¯¥ box coordinate ä¸‹ã€‚è®ºæ–‡ä¸­ç›´æ¥é€‰æ‹©å¾—åˆ†æœ€é«˜çš„é‚£ä¸€ä¸ªå¸§ä½œä¸ºé€‰æ‹© box coordinate æ ‡å‡†</p><p><strong>æ‰€æœ‰çš„é¢„æµ‹ç½‘ç»œéƒ½æ˜¯ PointNet ç»“æ„</strong>ï¼ˆçœ‹æ¥ PointNet ä½œä¸ºäºŒé˜¶æ®µå¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªä¸»æµï¼ŒLidar R-CNNï¼‰ï¼Œä¸ºäº†è¿›ä¸€æ­¥æé«˜è¡¨ç°ï¼Œè¿˜æ˜¯ç”¨äº† segmentation è¾…åŠ©ä»»åŠ¡ä»¥åŠ Cascade RCNN çº§è”æ£€æµ‹ã€‚æ•´ä½“çš„æµç¨‹ç¤ºæ„å›¾å¦‚ä¸‹</p><p><img src="/archives/1d439585/image-20220418111344037.png" alt="image-20220418111344037" style="zoom: 33%;"></p><h4 id="Dynamic-Object-Auto-Labeling"><a href="#Dynamic-Object-Auto-Labeling" class="headerlink" title="Dynamic Object Auto Labeling"></a>Dynamic Object Auto Labeling</h4><p>å¯¹äºåŠ¨æ€ç‰©ä½“ï¼Œè®ºæ–‡å¯¹<strong>æ¯ä¸€ä¸ªå¸§</strong>éƒ½å»é¢„æµ‹é€‰æ¡†ï¼ˆè¿™æ ·åšä¸ä¼šé€ æˆæŠ–åŠ¨å—ï¼Ÿï¼‰</p><p>å¯¹äºæŸä¸ªåŠ¨æ€ç‰©ä½“æ¯”è¾ƒéš¾å°†å¤šå¸§ä¿¡æ¯è½¬ç§»åˆ°åŒä¸€ä¸ª box ä¸­åšèåˆï¼Œå› ä¸ºå…¶ä¸­çš„è¿åŠ¨ï¼ˆè½¦è¾†ï¼‰å’Œå˜æ¢ï¼ˆè¡Œäººï¼‰éƒ½ä¸å¤ªå¥½æ“ä½œï¼Œæ‰€ä»¥è®ºæ–‡é€‰æ‹©å¯¹åºåˆ—é‡‡å–æ“ä½œã€‚åºåˆ—æ˜¯ä»¥<strong>æ»‘åŠ¨çª—å£</strong>å½¢å¼å‘ˆç°ï¼Œå¯¹äºå…³é”®å¸§ kï¼ˆä¹Ÿæ˜¯å½“å‰å¸§ï¼‰ï¼Œä½¿ç”¨å…¶ä¸Šä¸‹æ–‡ 2r or 2s ä¸ªå¸§å»é¢„æµ‹å…³é”®å¸§ä¸­çš„ç‰©ä½“é€‰æ¡†</p><p>è®ºæ–‡ä¹Ÿæ˜¯ä½¿ç”¨äº†2ä¸ª branch å»å¤„ç†ï¼š</p><ol><li>Point cloud branchï¼Œè¯¥åˆ†æ”¯ä½¿ç”¨ä¸€ä¸ªç›®æ ‡çš„<strong>ç‚¹äº‘å­åºåˆ—</strong> $\set {P_{j,k}}_{k=T-r}^{T+r}$ï¼Œå°†æ—¶é—´æˆ³ä¿¡æ¯æ·»åŠ åˆ°å…¶ä¸­ï¼Œç„¶åå°†æ‰€æœ‰çš„ç‚¹è½¬ç§»åˆ°å…³é”®å¸§ box coordinate $B_{j,T}$ï¼Œä¹‹åä½¿ç”¨ä¸€ä¸ªåˆ†å‰²ç½‘ç»œè·å¾—æ›´ç²¾ç»†çš„å‰æ™¯ç‚¹ï¼Œå†å¯¹æ¯ä¸ªç‰©ä½“ä½¿ç”¨å¦ä¸€ä¸ªç½‘ç»œå¯¹è¯¥ç‚¹äº‘åºåˆ—è¿›è¡Œç¼–ç ï¼Œå¾—åˆ° point embedding</li><li>Box sequence branchï¼Œè¯¥åˆ†æ”¯ä½¿ç”¨ä¸€ä¸ªç›®æ ‡çš„<strong>é€‰æ¡†å­åºåˆ—</strong> $\set {B_{j,k}}_{k=T-s}^{T+s}$ï¼ˆè¯¥åºåˆ—ç›¸æ¯”äº point branch å¯ä»¥å–æ›´é•¿ï¼‰ï¼Œä¾ç„¶æ˜¯å…ˆåŠ å…¥æ—¶é—´ç¼–ç ï¼Œç„¶åé€‰æ¡†è½¬ç§»åˆ°å…³é”®å¸§çš„é€‰æ¡†åæ ‡ç³»ä¸­ï¼Œæ­¤æ—¶ box è¡¨ç¤ºä¸º8ç»´å‘é‡ï¼ˆ7ç»´ç©ºé—´ + 1ç»´æ—¶é—´ï¼‰ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ª PointNet å¯¹è¯¥é€‰æ¡†åºåˆ—è¿›è¡Œç¼–ç ï¼Œå¾—åˆ° trajectory embedding</li><li>å¾—åˆ° point embedding &amp; trajetory embedding ä¹‹åï¼Œå°†äºŒè€… concat è¿æ¥ï¼Œç„¶åè¾“å…¥å›å½’ç½‘ç»œï¼Œå¾—åˆ°æœ€ç»ˆ box é€‰æ¡†</li></ol><p>æ•´ä½“çš„æµç¨‹å›¾å¦‚ä¸‹</p><p><img src="/archives/1d439585/image-20220418122356411.png" alt="image-20220418122356411" style="zoom: 33%;"></p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><p>ç®€å•æ•´ç†ä¸€ä¸‹å®éªŒç»“æœï¼Œåªèƒ½è¯´æ•ˆæœçˆ†ç‚¸</p><p><img src="/archives/1d439585/image-20220418122947438.png" alt="image-20220418122947438" style="zoom:50%;"></p><p>å¹¶ä¸”èƒ½è·Ÿäººç±»æ ‡æ³¨æ•ˆæœæ¯”ä¸€æ¯”</p><p><img src="/archives/1d439585/image-20220418123032394.png" alt="image-20220418123032394" style="zoom:50%;"></p><p>ï¼ˆå·¦ä¾§ï¼‰å°†å…¶ç”¨äºåŠç›‘ç£å­¦ä¹ æ•ˆæœä¹Ÿå¾ˆä¸é”™ï¼Œï¼ˆå³ä¾§ï¼‰MVF++ çš„ä¸€äº›æ¶ˆèå®éªŒï¼Œå¸§æ•°å¸¦æ¥çš„æ¶¨å¹…è¾¹é™…é€’å‡</p><p><img src="/archives/1d439585/image-20220418123149560.png" alt="image-20220418123149560" style="zoom:50%;"></p><p>ä¸Šä¸‹æ–‡ä¿¡æ¯å¯¹æ£€æµ‹å™¨çš„å½±å“</p><p><img src="/archives/1d439585/image-20220418123701957.png" alt="image-20220418123701957" style="zoom: 50%;"></p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Auto Label </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mean Teacher &amp; MoCo</title>
      <link href="/archives/5871b266.html"/>
      <url>/archives/5871b266.html</url>
      
        <content type="html"><![CDATA[<h1 id="Mean-Teacher-amp-MoCo"><a href="#Mean-Teacher-amp-MoCo" class="headerlink" title="Mean Teacher &amp; MoCo"></a>Mean Teacher &amp; MoCo</h1><hr><p>Tarvainen, Antti, and Harri Valpola. â€œMean Teachers Are Better Role Models: Weight-Averaged Consistency Targets Improve Semi-Supervised Deep Learning Results.â€ <em>ArXiv:1703.01780 [Cs, Stat]</em>, Apr. 2018. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/1703.01780">http://arxiv.org/abs/1703.01780</a>.</p><p>He, Kaiming, et al. â€œMomentum Contrast for Unsupervised Visual Representation Learning.â€ <em>ArXiv:1911.05722 [Cs]</em>, 3, Mar. 2020. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/1911.05722">http://arxiv.org/abs/1911.05722</a>.</p><hr><p>å› ä¸ºæœ€è¿‘çš„æ¯•è®¾ç ”ç©¶æœ‰ç”¨åˆ° mean teacher è¿™ç§åŠç›‘ç£æ–¹æ³•ï¼Œå†ç»“åˆåˆ°ä¹‹å‰çœ‹åˆ°çš„ MoCo è¿™ç§å¯¹æ¯”å­¦ä¹ çš„æ–¹æ³•ï¼Œæ„Ÿè§‰äºŒè€…æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚è¿™é‡Œåšç®€å•æ•´ç†</p><p>Mean teacher å¯ä»¥ç”¨ä»¥ä¸‹æ­¥éª¤æ¦‚æ‹¬ï¼Œ<a href="https://github.com/CuriousAI/mean-teacher">github</a>ï¼š</p><ol><li>Take a supervised architecture and make a copy of it. Letâ€™s call the original model the <strong>student</strong> and the new one the <strong>teacher</strong>.</li><li>At each training step, use the same minibatch as inputs to both the student and the teacher but <strong>add random augmentation or noise to the inputs separately.</strong></li><li><strong>Add an additional <em>consistency cost</em> between the student and teacher outputs</strong> (after softmax).</li><li>Let the optimizer update the student weights normally.</li><li><strong>Let the teacher weights be an exponential moving average (EMA) of the student weights.</strong> That is, after each training step, update the teacher weights a little bit toward the student weights.</li></ol><p>å…¶ä¸­ç¬¬ 2ï¼Œ3ï¼Œ5 æ­¥æ˜¯ mean teacher çš„æ ¸å¿ƒæ­¥éª¤</p><h2 id="Mean-Teacher-Motivations"><a href="#Mean-Teacher-Motivations" class="headerlink" title="Mean Teacher Motivations"></a>Mean Teacher Motivations</h2><p>åŠç›‘ç£è®­ç»ƒå¯ä»¥ä½¿ç”¨ä¸€äº›æ— æ ‡ç­¾çš„æ•°æ®æå‡ç½‘ç»œæ•ˆæœã€‚å…¶ä¸­ä¸€ä¸ªåŠç›‘ç£çš„å‡ºå‘ç‚¹ä¸ºï¼šä¸€ä¸ªå¥½çš„æ¨¡å‹åº”è¯¥å¯¹äºç›¸ä¼¼æ•°æ®åº”è¯¥ç»™å‡ºä¸€è‡´çš„è¾“å‡ºã€‚ä»ä¸‹é¢è¿™ä¸ªå›¾ç¤ºå¯ä»¥ç›´è§‚äº†è§£ï¼Œä¸ºä»€ä¹ˆåŠç›‘ç£ &amp; noise &amp; ensenble èƒ½å¤Ÿè®©æ¨¡å‹å˜å¾—æ›´å¥½</p><p><img src="/archives/5871b266/image-20220411170829079.png" alt="image-20220411170829079" style="zoom: 25%;"></p><p>(a) è¡¨ç¤ºäº†ç›‘ç£å­¦ä¹ å¯èƒ½å¾—åˆ°çš„æ¨¡å‹é¢„æµ‹ç»“æœï¼Œ<strong>è¿™å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª overfitting çš„ç»“æœ</strong></p><p>(b) è¡¨ç¤ºäº†ä½¿ç”¨ noisy labeled data åï¼ˆconsistency between noisy dataï¼‰ï¼Œè¿‡æ‹Ÿåˆè¢«å‡ç¼“</p><p>(c) è¡¨ç¤ºä½¿ç”¨äº† unlabeled data with consistency åï¼ŒåŠç›‘ç£å­¦ä¹ å°†è®©æ¨¡å‹çš„é¢„æµ‹ç»“æœæ›´åŠ å¹³æ»‘</p><p>(d) è¡¨ç¤ºå¯¹ unlabeled data å¾—åˆ°çš„é¢„æµ‹ç»“æœåŠ å…¥ noiseï¼Œèƒ½å¤Ÿè¿›ä¸€æ­¥å‡å°‘åå·®ï¼Œè®©ç»“æœæ›´å¥½</p><p>(e) è¡¨ç¤ºè¿›ä¸€æ­¥ä½¿ç”¨ ensemle æ¨¡å‹èƒ½å¤Ÿæ›´æ¥è¿‘äºæœŸæœ›ç›®æ ‡ï¼Œè¾¾åˆ°æœ€å¥½çš„ç»“æœ</p><p>å…¶å®ä¸Šå›¾å°±æŠŠæ•´ä¸ªè®ºæ–‡çš„åŠ¨æœºæè¿°äº†ä¸ªå¤§æ¦‚ã€‚ä¸‹é¢å†è¯¦ç»†æå‡ºï¼š</p><p>å°†æ¨¡å‹çš„é¢„æµ‹ä½œä¸ºæ ‡ç­¾ï¼Œå¹¶ä½¿ç”¨è¿™äº›æ ‡ç­¾è¿›è¡Œâ€ç›‘ç£â€œä¼šé¢ä¸´ä¸€å®šçš„é£é™©ï¼Œå› ä¸ºè¿™äº›æ ‡ç­¾å¹¶ä¸ä¸€å®šæ˜¯å‡†ç¡®çš„ã€‚<strong>è¯¥é£é™©èƒ½å¤Ÿè¢«æ›´å¥½çš„é¢„æµ‹ç»“æœå‡ç¼“</strong>ã€‚åŸºäºæ­¤æå‡º noisy teacher/targetï¼Œå…·ä½“æ“ä½œå¯ä½¿ç”¨ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ol><li>å¯¹ input è¿›è¡Œæ•°æ®å¢å¼ºï¼ŒåŠ å…¥ noise æ‰°åŠ¨</li><li>å¯¹é¢„æµ‹ç»“æœä½¿ç”¨ EMA</li><li>ä½¿ç”¨æ›´å¥½çš„æ¨¡å‹ç»“æ„è‡ªç„¶ä¹Ÿèƒ½å¾—åˆ°æ›´å¥½çš„ target</li></ol><p>å¯¹é¢„æµ‹ç»“æœè¿›è¡Œ EMA æœ‰ä¸€ä¸ªè‡´å‘½ç¼ºç‚¹ï¼šæ›´æ–°é¢‘ç‡å¤ªæ…¢ï¼Œå¯¹äºæŸä¸€ä¸ªæ ·æœ¬è€Œè¨€ï¼Œè¦ç»è¿‡ä¸€æ•´ä¸ª epoch æ‰èƒ½å†æ¬¡è¿›è¡Œ EMA è®¡ç®—ã€‚åŸºäºæ­¤æ­£å¼æå‡º mean teacherï¼Œå³å¯¹ teacher model è¿›è¡Œ EMAï¼Œè¿™æ ·èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ª iteration è¿‡åå³ä½¿è¿›è¡Œæ›´æ–°</p><p>ä»¥ä¸Šå°±æ˜¯ mean teacher çš„é€»è¾‘ï¼Œç®€å•å¥½ç”¨ï¼</p><h2 id="MoCo"><a href="#MoCo" class="headerlink" title="MoCo"></a>MoCo</h2><p>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1C3411s7t9/?spm_id_from=333.788">MoCo è®ºæ–‡é€æ®µç²¾è¯»</a></p><p>MoCo æ˜¯ Momentum Contrast çš„ç¼©å†™ï¼Œå…¶ä¸­ Momentum å¯ä»¥è®¤ä¸ºæ˜¯ EMA æŒ‡æ•°å¹³å‡ï¼ŒContrast è¡¨ç¤ºå¯¹æ¯”å­¦ä¹ ã€‚å¯¹æ¯”å­¦ä¹ æ˜¯ä¸€ç§ unsuperviesed/self-supervised learningï¼ŒMoCo å…¶å®æ˜¯æå‡ºäº†ä¸€ç§å¯¹æ¯”å­¦ä¹ çš„èŒƒå¼ï¼ŒæŠŠè¿™ç§èŒƒå¼ä½¿ç”¨äº†ä¸€ä¸ªåŠ¨æ€å­—å…¸è¡¨ç¤ºï¼ˆè¯´æ˜¯å­—å…¸ï¼Œå…¶å®å­˜å‚¨çš„æ•°æ®ç»“æ„æ˜¯é˜Ÿåˆ—â€¦ä¸è¿‡ä½¿ç”¨äº†å­—å…¸ä¸­çš„ key, query æ¦‚å¿µï¼‰ï¼ŒåŸæ–‡æè¿°å¦‚ä¸‹ï¼š</p><blockquote><p>We present Momentum Contrast (MoCo) as a way of building <strong>large and consistent dictionaries</strong> for unsupervised learning with a contrastive loss</p></blockquote><p>ä¸Šé¢çš„ä¸¤ä¸ªå…³é”®è¯ï¼šlarge &amp; consistent å°±æ˜¯å»ºé€ å­—å…¸çš„æ ¸å¿ƒã€‚çœ‹å®Œè¿™æ®µæè¿°è‚¯å®šè¿˜æ˜¯äº‘é‡Œé›¾é‡Œçš„ï¼Œè¿™å¾ˆæ­£å¸¸ï¼Œä¸‹é¢å°†é‡Œé¢çš„æ¦‚å¿µé€ä¸€å…·ä½“åŒ–ï¼Œç„¶åä»‹ç»ä¸€ä¸‹å¯¹æ¯”å­¦ä¹ ï¼Œæœ€åæå‡º MoCo çš„å¯¹æ¯”å­¦ä¹ æµç¨‹ä»¥åŠ MoCo çš„å‡ºå‘ç‚¹</p><h3 id="Dictionary"><a href="#Dictionary" class="headerlink" title="Dictionary"></a>Dictionary</h3><p>è¿™é‡Œçš„å­—å…¸æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿè¿™é‡Œçš„å­—å…¸æ˜¯ä¸€ä¸ªé˜Ÿåˆ—å®¹å™¨ï¼Œé‡Œé¢å­˜å‚¨çš„å¯¹è±¡æ˜¯<strong>ç»è¿‡ç¼–ç åçš„æ•°æ®é›†æ ·æœ¬</strong>ï¼Œæˆ‘ä»¬ç§°å­—å…¸é‡Œçš„è¿™äº›ç¼–ç å¥½çš„æ ·æœ¬ä¸º key</p><h3 id="Contrastive-Learning"><a href="#Contrastive-Learning" class="headerlink" title="Contrastive Learning"></a>Contrastive Learning</h3><p>è®¡ç®—å¯¹æ¯”æŸå¤±æ˜¯æ— ç›‘ç£è®­ç»ƒçš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¸Œæœ›ç›¸ä¼¼çš„ç‰©ä½“æœ‰ç€ç›¸ä¼¼çš„ç‰¹å¾ï¼Œé€šè¿‡è®¾è®¡å¯¹æ¯”æŸå¤±å‡½æ•°å°†ä¸åŒçš„ç‰¹å¾æ›´å¥½åœ°åŒºåˆ†å¼€æ¥ã€‚ç»“åˆä¸Šé¢æåˆ°çš„å­—å…¸ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°æ„é€ è¿™æ ·çš„è¿‡ç¨‹ï¼š</p><ol><li>å‡è®¾æˆ‘ä»¬å·²ç»å»ºé€ å¥½äº†ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸é‡Œå­˜å‚¨ç€å¤§é‡çš„ç¼–ç å¥½çš„æ ·æœ¬ï¼Œkey</li><li>è·å¾—å½“å‰æ ·æœ¬ï¼Œå¹¶å°†å…¶é€šè¿‡ç¼–ç å™¨ï¼Œè·å¾—å½“å‰æ ·æœ¬çš„ç¼–ç ï¼Œquery</li><li>è®¡ç®— query å’Œæ‰€æœ‰ key ä¹‹é—´çš„æŸå¤±</li></ol><h3 id="Contrastive-Loss"><a href="#Contrastive-Loss" class="headerlink" title="Contrastive Loss"></a>Contrastive Loss</h3><p>ç°åœ¨é—®é¢˜å°±æ¥äº†ï¼Œæ€ä¹ˆæ„é€ æŸå¤±å‡½æ•°ï¼Œæ¥æ»¡è¶³è¿™æ ·çš„è¦æ±‚ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼ï¼Œå®šä¹‰ key å’Œ query æ˜¯å¦æ˜¯ç›¸ä¼¼çš„ï¼Œè¿™æ ·æ‰èƒ½è¿›ä¸€æ­¥è®¡ç®—æŸå¤±ã€‚ç›¸ä¼¼çš„ç‰©ä½“è‚¯å®šå…·æœ‰ç›¸ä¼¼çš„ç‰¹å¾ï¼Œä½†æ˜¯è¿™ä¸æ˜¯æ— ç›‘ç£è®­ç»ƒå—ï¼Œå“ªæ¥çš„ç‰©ä½“æ ‡ç­¾å‘¢ï¼Ÿè¿™é‡Œè®ºæ–‡ä½¿ç”¨äº† instance discrimination çš„ä»£ç†ä»»åŠ¡ï¼Œå®ƒä¸éœ€è¦æ ‡ç­¾æ¥å®šä¹‰ç›¸ä¼¼ä¸å¦ï¼Œç®€å•æ¥è¯´ï¼šæ¯ä¸ªæ ·æœ¬éƒ½ä¸ï¼ˆaugmented åçš„ï¼‰è‡ªå·±ç›¸ä¼¼ï¼Œä¸å…¶ä»–æ ·æœ¬ä¸ç›¸ä¼¼ã€‚ç›¸ä¼¼å°±æ˜¯æ­£æ ·æœ¬ï¼Œä¸ç›¸ä¼¼å°±æ˜¯è´Ÿæ ·æœ¬</p><p>è®ºæ–‡ç›´æ¥ä½¿ç”¨äº†ä¸€ä¸ªå¤šåˆ†ç±»ä»»åŠ¡æ¥å»ºæ¨¡è¿™æ ·çš„å­¦ä¹ è¿‡ç¨‹</p><p>æ‰€æœ‰çš„æ­£è´Ÿæ ·æœ¬ç‹¬ç«‹ä¸ºä¸€ç±»ï¼Œå…¶ä¸­æ­£æ ·æœ¬åªæœ‰ä¸€ä¸ª $k_+$ï¼ˆæ¥è‡ªäºå¢å¼ºåçš„è‡ªå·±ï¼‰ï¼Œå­—å…¸ä¸­çš„å…¨æ˜¯è´Ÿæ ·æœ¬ $k$ï¼ˆæ¥è‡ªäºå…¶ä»–æ ·æœ¬ï¼‰ï¼Œç°åœ¨æˆ‘ä»¬å°±è¦è®¡ç®—å‡º query $q$ å±äºå“ªä¸€ç±»çš„æ¦‚ç‡åˆ†å¸ƒï¼Œä½¿ç”¨ <strong>ç‚¹ç§¯ + softmax</strong> æ¥å»ºæ¨¡æ˜¯å¾ˆç›´æ¥çš„æƒ³æ³•</p><script type="math/tex; mode=display">\frac{\exp \left(q \cdot k_{i} / \tau\right)}{\sum_{i=0}^{K} \exp \left(q \cdot k_{i} / \tau\right)}</script><p>å…¶ä¸­ $\tau$ æ˜¯ä¸€ä¸ªè¶…å‚æ•°ã€‚é€šå¸¸å¯è®¤ä¸ºè®¾å®šï¼Œi = 0 æ—¶ï¼Œ$k_0$ æ˜¯å”¯ä¸€çš„æ­£æ ·æœ¬ $k_+$ï¼Œi = 1,â€¦,K æ—¶ï¼Œéƒ½æ˜¯è´Ÿæ ·æœ¬ã€‚æ­¤æ—¶ $q$ æ ¹æ®å®šä¹‰è‚¯å®šæ˜¯å±äºæ­£æ ·æœ¬ç±»çš„ï¼Œé‚£ä¹ˆäº¤å‰ç†µå°±å¯ä»¥è®¡ç®—ä¸º</p><script type="math/tex; mode=display">\mathcal{L}_{q}=-\log \frac{\exp \left(q \cdot k_{+} / \tau\right)}{\sum_{i=0}^{K} \exp \left(q \cdot k_{i} / \tau\right)}</script><h3 id="MoCo-Algorithm"><a href="#MoCo-Algorithm" class="headerlink" title="MoCo Algorithm"></a>MoCo Algorithm</h3><p>ç§¯æœ¨éƒ½å‡†å¤‡å¾—å·®ä¸å¤šäº†ï¼Œå°±å¯ä»¥å¼€å§‹æ­å»ºäº†ã€‚ä¸‹å›¾æ˜¯æ•´ä¸ª MoCo ç®—æ³•çš„ç¤ºæ„å›¾ï¼Œæ¯”è¾ƒç®€æ´</p><p><img src="/archives/5871b266/image-20220411185650031.png" alt="image-20220411185650031" style="zoom:50%;"></p><p>çœ‹ä¸€ä¸‹ä¹‹å‰ç•™ä¸‹çš„å‘ï¼šæˆ‘ä»¬å¹¶æ²¡æœ‰è¯´æ€ä¹ˆå»å»ºé€ å­—å…¸ï¼Œä¹Ÿæ²¡æœ‰è¯´æ€ä¹ˆå»å»ºé€  encoderã€‚åªè¦æŠŠè¿™ä¸¤ä¸ªé—®é¢˜å¡«ä¸Šï¼ŒMoCo çš„æµç¨‹å°±è·ƒç„¶çº¸ä¸Šäº†</p><ol><li>æ€ä¹ˆå»å»ºé€ å­—å…¸ï¼Ÿè®ºæ–‡ä½¿ç”¨äº†ä¸€ä¸ªé˜Ÿåˆ—å»å»ºé€ ã€‚å½“å‰æ ·æœ¬ç»è¿‡ encoder ç¼–ç åå¾—åˆ° $q$ï¼ŒåŒæ—¶å½“å‰æ ·æœ¬è¿˜è¦é€šè¿‡æ•°æ®å¢å¼ºç»è¿‡ momentum encoder å¾—åˆ° $k_0$ï¼Œå°† $k_0$ å…¥é˜Ÿï¼Œå¹¶è®¡ç®—æŸå¤±ï¼Œè®¡ç®—å®Œåï¼Œé˜Ÿåˆ—å¤´éƒ¨ key å‡ºé˜Ÿ</li><li>æ€æ ·å»å»ºé€  encoderï¼Ÿå½“å‰æ ·æœ¬ç»è¿‡çš„ encoder å°±æ˜¯å½“å‰çš„ encoderï¼Œå¯¹äºå­—å…¸ä¸­çš„ key ç»è¿‡çš„æ˜¯ EMA encoderï¼Œå³ç»è¿‡æŒ‡æ•°å¹³å‡çš„ encoder</li></ol><p>è®ºæ–‡ç›´æ¥ç»™å‡ºäº†ç®—æ³•çš„ pytorch style ä¼ªä»£ç ï¼Œ<strong>ç®€ç›´æ¸…æ™°å¾—ä¸€æ‰¹</strong>ï¼Œæ¯”çœ‹å›¾æ›´æ¸…æ¥šï¼</p><p><img src="/archives/5871b266/image-20220411190818950.png" alt="image-20220411190818950" style="zoom:50%;"></p><h3 id="MoCo-Motivation"><a href="#MoCo-Motivation" class="headerlink" title="MoCo Motivation"></a>MoCo Motivation</h3><p>ä¹‹å‰æåˆ°äº†ï¼š<strong>large &amp; consistent å°±æ˜¯å»ºé€ å­—å…¸çš„æ ¸å¿ƒ</strong>ï¼Œæœ€åæ¥å¡«è¿™ä¸ªå‘ï¼Œäº†è§£ MoCo ç®—æ³•çš„å‡ºå‘ç‚¹</p><ol><li>Why largeï¼Ÿå¤§å­—å…¸å°±ä»¥ä¸ºç€æ›´å¤šçš„æ ·æœ¬è¢«ä¿å­˜äº†ä¸‹æ¥ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¸è¨€è€Œå–»çš„ï¼Œç›¸å½“äºä½ æ‹¥æœ‰äº†æ›´å¤šçš„ä¿¡æ¯å’Œå‚ç…§ç‰©</li><li>Why consistentï¼Ÿå¯¹æ¯”çš„ç‰¹å¾ï¼Œåº”å½“åœ¨ç›¸åŒçš„æˆ–è€…ç›¸ä¼¼çš„ç¼–ç å™¨ä¸‹å¾—åˆ°ï¼Œä¸ç„¶å¯¹æ¯”æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚é‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ copy å½“å‰çš„ç¼–ç å™¨ï¼Œè€Œä½¿ç”¨ EMA å¾—åˆ°çš„ç¼–ç å™¨ï¼Ÿå› ä¸ºåœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œç¼–ç å™¨çš„æ›´æ–°å¯èƒ½ä¼šéå¸¸çš„è¿…é€Ÿï¼Œè¿™ä¹Ÿå°†ä¼šå¯¼è‡´ç¼–ç å™¨çš„ä¸ä¸€è‡´</li></ol><p>çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å‘ç°äº†è¿™å’Œ mean teacher æœ‰ç€ç¥ä¼¼ä¹‹å¤„ï¼Ÿä¼¼ä¹è¿™æ˜¯ mean teacher çš„ä¸€ä¸ªå‡çº§ï¼Œä¸ä»…ä»…çœ‹å½“å‰æ ·æœ¬ï¼Œè¿˜çœ‹åˆ°äº†å…¶ä»–æ ·æœ¬ï¼›ä¸ä»…ä»…çœ‹åˆ°äº†æ­£æ ·æœ¬ï¼Œè¿˜çœ‹åˆ°äº†è´Ÿæ ·æœ¬</p><h3 id="MoCo-v2"><a href="#MoCo-v2" class="headerlink" title="MoCo v2"></a>MoCo v2</h3><p>v2 é‡Œé¢å€Ÿé‰´äº† SimCLR ä¸­çš„ä¸€äº›ç®€å•æ“ä½œï¼Œä½†æ˜¯å·¨æœ‰æ•ˆæœã€‚ä¸»è¦æœ‰æå‡çš„æ˜¯ä¸¤ä¸ªï¼š1. ä½¿ç”¨äº† MLP/affinity å¯¹ key è¿›è¡Œå†æ¬¡ç¼–ç ï¼Œç„¶åå†è¿›è¡ŒæŸå¤±è®¡ç®—ï¼›2. æ›´å¥½çš„æ•°æ®å¢å¼º</p><p><img src="/archives/5871b266/image-20220413175244560.png" alt="image-20220413175244560" style="zoom:50%;"></p><p>å°¤å…¶æ˜¯åŠ äº† MLP è¿‡åç›´æ¥æš´æ¶¨6ä¸ªç‚¹ï¼</p><p><img src="/archives/5871b266/image-20220413175358910.png" alt="image-20220413175358910" style="zoom:50%;"></p><h2 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h2><blockquote><p>Beyond the simple instance discrimination task [61], it is possible to <strong>adopt MoCo for pretext tasks like masked auto-encoding</strong>, e.g., in language [12] and in vision [46]. We hope MoCo will be useful with other pretext tasks that involve contrastive learning.</p></blockquote><p>åœ¨è®ºæ–‡æœ«ï¼Œä½œè€…å°±å·²ç»è°ˆè®ºåˆ°äº†å°† MoCo çš„ pretext task æ¢ä¸ºæ›´å¥½çš„ masked autoencodingã€‚å®é™…ä¸Šåœ¨ä¸€å¹´å¤šè¿‡åï¼ŒKaiming å¤§ä½¬å°±å¸¦ç€ MAE è®ºæ–‡å›æ¥äº†ï¼Œè¿™ä¼¼ä¹åˆå®£å¸ƒäº†æœ‰ç›‘ç£å’Œæ— ç›‘ç£ä¹‹é—´çš„å·®è·è¢«è¿›ä¸€æ­¥ç¼©å°</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mean Teacher </tag>
            
            <tag> MoCo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ViT &amp; MAE &amp; Swin Transformer</title>
      <link href="/archives/d672e65b.html"/>
      <url>/archives/d672e65b.html</url>
      
        <content type="html"><![CDATA[<h2 id="ViT-amp-MAE-amp-Swin-Transformer"><a href="#ViT-amp-MAE-amp-Swin-Transformer" class="headerlink" title="ViT &amp; MAE &amp; Swin Transformer"></a>ViT &amp; MAE &amp; Swin Transformer</h2><hr><p>Dosovitskiy, Alexey, et al. â€œAn Image Is Worth 16x16 Words: Transformers for Image Recognition at Scale.â€ <em>ArXiv:2010.11929 [Cs]</em>, June 2021. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/2010.11929">http://arxiv.org/abs/2010.11929</a>.</p><p>He, Kaiming, et al. â€œMasked Autoencoders Are Scalable Vision Learners.â€ <em>ArXiv:2111.06377 [Cs]</em>, Dec. 2021. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/2111.06377">http://arxiv.org/abs/2111.06377</a>.</p><p>Liu, Ze, et al. â€œSwin Transformer: Hierarchical Vision Transformer Using Shifted Windows.â€ <em>ArXiv:2103.14030 [Cs]</em>, Aug. 2021. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/2103.14030">http://arxiv.org/abs/2103.14030</a>.</p><hr><p>æƒ³è¦æŠŠè¿™ä¸‰ç¯‡è®ºæ–‡ç»Ÿä¸€æ•´ç†ä¸€ä¸‹ã€‚ViT æ˜¯è§†è§‰ transformer çš„å¥ åŸºä½œä¹‹ä¸€ï¼Œè€Œ MAE å’Œ Swin æ˜¯æœ€è¿‘çš„å¼ºåŠ¿è®ºæ–‡ã€‚åœ¨äº†è§£ transformer ä¹‹å‰è€æ˜¯è¢«è¿™ä¸ªä¸œè¥¿çš„è®¡ç®—æ—¶é—´ç»™å“åˆ°ï¼Œè¦ä»€ä¹ˆå‡ ç™¾ä¸ª GPU/TPU è·‘ä¸ªå‡ å¤©æ‰è·‘å¾—å‡ºæ¥ï¼Œä½†äº†è§£ä¹‹åæˆ‘ä¼¼ä¹è§‰å¾—ä¸æ˜¯è¿™ä¹ˆå›äº‹ã€‚Transformer æ¨¡å‹å¯ä»¥åšçš„å’Œæ™®é€šå·ç§¯ç½‘ç»œä¸€æ ·å°çš„ï¼Œè®¡ç®—é‡ä¹Ÿæ˜¯å·®ä¸å¤šçš„ï¼Œä¸è¿‡é€šå¸¸ä¸ºäº†åˆ·æ¦œä¼šä½¿ç”¨<strong>æ›´å¤§çš„æ¨¡å‹å’Œè¶…å¤§çš„æ•°æ®é›†</strong>ï¼Œè¿™å°±å¯¼è‡´äº†è®­ç»ƒæ—¶é—´ç‚¸è£‚ï¼ä½†å®é™…ä¸Š transformer æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ç»“æ„ï¼Œæ•ˆç‡å¹¶ä¸ä½ï¼Œåº”å½“é‡è§†èµ·æ¥ï¼ï¼</p><h2 id="ViT"><a href="#ViT" class="headerlink" title="ViT"></a>ViT</h2><p><a href="https://www.bilibili.com/video/BV15P4y137jb/?spm_id_from=333.788">ViTè®ºæ–‡é€æ®µç²¾è¯»</a></p><p>Transformer åˆ°åº•æœ‰ä»€ä¹ˆä¼˜è¶Šæ€§ï¼ŸTransformer èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†å¦‚ä¸‹éš¾é¢˜ï¼š</p><ol><li>Occlusionï¼Œé®æŒ¡</li><li>Distribution shiftï¼Œåˆ†å¸ƒåç§»</li><li>Permutationï¼Œæ’åˆ—</li></ol><p>ç®€å•æ¥è®²è¿™äº›æ€§è´¨æ¥æºäº transformer çš„å…¨å±€å»ºæ¨¡èƒ½åŠ›ï¼ˆå…·ä½“åŸå› å’±ä¹Ÿä¸çŸ¥é“å“ˆğŸ˜€ï¼‰é™¤æ­¤ä¹‹å¤– transfomer ç›®å‰ä¼¼ä¹è¿˜æœªè§‚å¯Ÿåˆ°æ€§èƒ½é¥±å’Œçš„ç°è±¡ï¼Œæ•°æ®é›†è¶Šå¤§ï¼Œæ¨¡å‹è¶Šå¤§ï¼Œæ•ˆæœè¶Šå¥½</p><p>ä½†æ˜¯åœ¨ä¸€äº›ä¸é‚£ä¹ˆå¤§çš„æ•°æ®é›†ä¸Šè®­ç»ƒ ViTï¼Œæ•ˆæœåè€Œä¸æ˜¯é‚£ä¹ˆå¥½ï¼Œè®ºæ–‡è®¤ä¸ºè¿™æ˜¯å› ä¸ºæ•°æ®é›†å°‘ï¼Œtransformer éš¾ä»¥å­¦åˆ°æœ€å¥½çš„ç‰¹å¾ã€‚CNN å› ä¸ºæœ‰ä¸¤ä¸ªå…ˆéªŒçŸ¥è¯†ï¼š1. å¹³ç§»ä¸å˜æ€§ï¼›2. ç›¸å¯¹ä½ç½®ï¼Œæ‰€ä»¥ä½¿ç”¨è¾ƒå°çš„æ•°æ®é›†èƒ½å¤Ÿæœ‰æ›´å¥½çš„è¡¨ç°ã€‚ä½†æ˜¯éšç€æ•°æ®é›†çš„å¢å¤§ï¼Œtransformer çš„å¨åŠ›å°±å…¨é¢çˆ†å‘äº†</p><p>ç”±äºè‡ªæ³¨æ„åŠ›æ˜¯å¹³æ–¹å¤æ‚åº¦çš„å¢é•¿ï¼Œæ‰€ä»¥ç›´æ¥åº”ç”¨åˆ° cv ä¸Šæœ‰ä¸€å®šå›°éš¾ï¼Œå‰äººå°è¯•è¿‡çš„æ–¹æ³•ï¼š1. åœ¨ window ä¸Šåšè‡ªæ³¨æ„åŠ›ï¼›2. ä½¿ç”¨ sparse transformerï¼Œä¸ºå…¨å±€æ³¨æ„åŠ›çš„è¿‘ä¼¼ï¼›3. è½´æ³¨æ„åŠ›ï¼Œå…ˆåœ¨æ¨ªè½´ä¸Šåšè‡ªæ³¨æ„åŠ›ï¼Œç„¶ååœ¨çºµè½´ä¸Šåšè‡ªæ³¨æ„åŠ›</p><h3 id="ViT-Model"><a href="#ViT-Model" class="headerlink" title="ViT Model"></a>ViT Model</h3><p>å¦‚æœä½ äº†è§£ BERT &amp; Tansformerï¼ŒViT çš„æ¨¡å‹ç†è§£èµ·æ¥æ ¹æœ¬æ²¡æœ‰éš¾åº¦</p><p><img src="/archives/d672e65b/image-20220412230331225.png" alt="image-20220412230331225" style="zoom:50%;"></p><p>æˆ‘ä»¬æŒ‰ç…§å‰å‘æ–¹ç¨‹çš„é¡ºåºæ¥é€ä¸ªçœ‹çœ‹ï¼š</p><ol><li>å°†å›¾ç‰‡åˆ†å‰²ä¸º Pathesï¼Œæ¯ä¸€ä¸ª Patch ä¸º 16x16 å¤§å°çš„å­å›¾ï¼Œå°†è¯¥å­å›¾å±•å¼€ä¸º 16x16x3 = 768 ç»´çš„ç‰¹å¾ã€‚å‡è®¾åŸå›¾å¤§å°ä¸º 224x224 é‚£ä¹ˆèƒ½å¤Ÿå¾—åˆ° 196 ä¸ªå­å›¾ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸€ä¸ªå­å›¾å°±å½“ä½œä¸€ä¸ª tokenï¼Œæ­¤æ—¶æœ‰ 196 ä¸ªç»´åº¦ä¸º 768 çš„ token</li><li>å¢åŠ  cls token åˆ° Patch token ä¸­ï¼Œç”¨äºä¹‹åçš„åˆ†ç±»ä»»åŠ¡ï¼ˆä¸ä¸€å®šéè¦ä½¿ç”¨è¿™ä¸ª cls token ç»“æ„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹å…¶ä»– token ä½¿ç”¨ global average poolingã€‚è®ºæ–‡è¿™ä¹ˆåšæ˜¯ä¸ºäº†å’Œ BERT å°½é‡é è¿‘ï¼Œæ’é™¤æ˜¯è§†è§‰ä¸­çš„ trick å¸¦æ¥æ•ˆæœæå‡ï¼‰</li><li>å°† Patch token è¾“å…¥åˆ°ä¸€ä¸ªå…¨è¿æ¥å±‚è¿›è¡Œç»´åº¦è½¬æ¢/çº¿æ€§æ˜ å°„</li><li>ç”Ÿæˆä½ç½®ç¼–ç ã€‚ç±»ä¼¼äº BERTï¼Œè®¾ç½®ä¸€ä¸ªå¯å­¦ä¹ çš„ä½ç½®ç¼–ç ï¼Œç»´åº¦ä¸ Patch token çš„ç»´åº¦ç›¸åŒã€‚å°†ä½ç½®ç¼–ç ä¸ Patch token åŠ èµ·æ¥ï¼Œå¾—åˆ° input</li><li>å°† input è¾“å…¥ Transformer encoder</li><li>ä½¿ç”¨ cls token å¤„è·å¾—çš„ç‰¹å¾ï¼Œè¾“å…¥åˆ°å…¨è¿æ¥å±‚åšåˆ†ç±»ä»»åŠ¡</li></ol><p><strong>ViT åœ¨å¾®è°ƒçš„ç¼ºç‚¹</strong></p><p>åœ¨è¿›è¡Œå¾®è°ƒæ—¶ï¼Œä½¿ç”¨ä¸åŒå°ºå¯¸ï¼Œä½†æ˜¯ç”±äºé¢„è®­ç»ƒæ—¶ä½ç½®ç¼–ç å¤§å°æ˜¯å›ºå®šï¼Œæ‰€ä»¥é¢„è®­ç»ƒçš„ä½ç½®ç¼–ç ä¸å¥½ä½¿ç”¨åœ¨å¾®è°ƒä¸­ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•å°±æ˜¯ç”¨æ’å€¼</p><p><strong>ä¸åŒå¤§å°çš„ ViT</strong></p><p><img src="/archives/d672e65b/image-20220412233547870.png" alt="image-20220412233547870" style="zoom:50%;"></p><p>ä¹‹åçš„ vision transformer å¾ˆå¤šéƒ½æ—¶è¿™æ ·çš„å‘½åæ–¹å¼ï¼Œåé¢çš„ B, L, Hâ€¦éƒ½ä»£è¡¨æ¨¡å‹çš„å¤§å° base, large, huge, tiny, smallâ€¦.</p><h3 id="ViT-Experiment"><a href="#ViT-Experiment" class="headerlink" title="ViT Experiment"></a>ViT Experiment</h3><p><img src="/archives/d672e65b/image-20220412233654796.png" alt="image-20220412233654796" style="zoom: 50%;"></p><p>æ•´ç¯‡è®ºæ–‡çš„æ ¸å¿ƒå®éªŒç»“æœï¼šå°æ•°æ®ä¸å¦‚ resnet-based æ¨¡å‹ï¼Œå¤§æ•°æ®æ•ˆæœæ‹”ç¾¤ã€‚æ‰€ä»¥è¿™é‡Œå°±æœ‰ä¸€ä¸ªæ½œåœ¨çš„ç ”ç©¶æ–¹å‘ï¼štransformer åœ¨å°æ ·æœ¬ä¸Šçš„å­¦ä¹ </p><h2 id="MAE"><a href="#MAE" class="headerlink" title="MAE"></a>MAE</h2><p><a href="https://www.bilibili.com/video/BV1sq4y1q77t/?spm_id_from=333.788">MAE è®ºæ–‡é€æ®µç²¾è¯»</a></p><p>Masked Autoencoders Are Scalable Vision Learners æ˜¯ä¸€ç¯‡æ¯”è¾ƒæ–°çš„æ–‡ç« ï¼ˆ2021/11ï¼‰ï¼Œä¸»è¦æ•´ç†ä¸€ä¸‹æ€æƒ³ï¼Œç»†èŠ‚éƒ¨åˆ†éœ€è¦çœ‹ä»£ç ï¼Œä»£ç ä¹Ÿæ˜¯ä»Šå¹´å¹´åˆå¼€æºï¼ˆ2022/1ï¼‰ï¼Œ<a href="https://github.com/facebookresearch/mae">MAE pytorch</a>ã€‚æ ‡é¢˜ä¸­çš„ scalable è¡¨ç¤ºæ¨¡å‹èƒ½å¤Ÿé€‚ç”¨äºéå¸¸å¤§çš„æ•°æ®é›†ï¼Œè€Œæ ‡é¢˜ä¸­çš„ auto ä¸æ˜¯è‡ªåŠ¨çš„æ„æ€ï¼Œä»…ä»…è¡¨è¾¾â€è‡ªâ€ selfï¼Œæ›´å…·ä½“ä¸€ç‚¹è¡¨ç¤ºè‡ªç›‘ç£</p><h3 id="MAE-Model"><a href="#MAE-Model" class="headerlink" title="MAE Model"></a>MAE Model</h3><p>MAE çš„æ¨¡å‹å›¾ç¤ºæ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œçœ‹å®Œå°±èƒ½æœ‰ä¸€äº›æ¦‚å¿µäº†</p><p><img src="/archives/d672e65b/image-20220413175839548.png" alt="image-20220413175839548" style="zoom:50%;"></p><p>è¿˜æ˜¯ç”¨è¯­è¨€æ¥æ€»ä¸€ä¸‹ï¼š</p><ol><li>å°†å›¾ç‰‡åˆ†ä¸º patchesï¼Œç„¶åéšæœºæ©ç›–æ‰å¤§éƒ¨åˆ† patches (75%)</li><li>å°†æ²¡æœ‰æ©ç›–çš„ pathesï¼ŒæŒ‰ç…§ ViT ä¸­çš„æ–¹æ³•è¿›è¡Œç¼–ç ï¼ˆpositional + patch embeddingï¼‰</li><li>åŠ å…¥ masked patches åˆ°å·²ç»ç¼–ç å¥½çš„ patchesï¼Œæ­¤æ—¶ mask patches ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„å¯å­¦ä¹ å‘é‡è¡¨ç¤ºã€‚å¹¶ä¸”é¡ºåºæ˜¯æŒ‰ç…§åˆå§‹åˆ†å‰²é¡ºåº</li><li>å†å°†æ‰€æœ‰ patchesï¼ŒæŒ‰ç…§ ViT ä¸­çš„æ–¹æ³•è¿›è¡Œè§£ç ï¼Œä½†ä½¿ç”¨ä¸€ä¸ªè½»é‡çš„ ViT</li></ol><h3 id="MAE-Motivation"><a href="#MAE-Motivation" class="headerlink" title="MAE Motivation"></a>MAE Motivation</h3><p>MAE çš„è®¾è®¡é€»è¾‘å†™å¾—æ˜¯çœŸçš„æ¸…æ™°ï¼Œå°†è§†è§‰ä¸­çš„è‡ªç›‘ç£éš¾ç‚¹ä¸ NLP ä¸­çš„è‡ªç›‘ç£è¿›è¡Œæ¯”è¾ƒï¼Œè§£é‡Šä¸ºä»€ä¹ˆè§†è§‰ä¸­çš„è‡ªç›‘ç£æ¯”è¾ƒéš¾ï¼š</p><ol><li>è§†è§‰é¢†åŸŸä¹‹å‰éš¾ä»¥æå‡ºåƒ NLP é‡Œçš„ token æ¦‚å¿µã€‚ä½†ç°åœ¨å·²ç»è¢« ViT è§£å†³</li><li>è§†è§‰ä¸­çš„ä¿¡æ¯æ˜¯å†—ä½™çš„ã€‚ä¸€ä¸ªå›¾ç‰‡å»æ‰å°‘é‡åƒç´ ç‚¹ï¼Œä¸å¦¨ç¢è¿™ä¸ªå›¾ç‰‡çš„æ•´ä½“è¡¨ç¤ºã€‚ä½†æ˜¯ä¸€å¥è¯é‡Œå»æ‰ä¸€ä¸ªè¯ï¼Œå¯èƒ½æ•´ä¸ªæ„æ€éƒ½ä¸æ˜ç¡®çš„ã€‚è¿™æ˜¯ CV å’Œ NLP åœ¨ä¿¡æ¯å¯†åº¦ä¸Šçš„å·®åˆ«</li><li>å¯¹äºè§£ç å™¨ï¼ŒNLP ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ MLP è¿›è¡Œè§£ç å»é¢„æµ‹ masked tokenï¼Œè€Œè¿™ä¸ª token æ‰€è¡¨ç¤ºçš„è¯­ä¹‰ä¿¡æ¯æ˜¯å¾ˆä¸°å¯Œçš„ã€‚ä½†æ˜¯ CV éœ€è¦é¢„æµ‹çš„æ˜¯ä¸€ä¸ªåŸå§‹çš„åƒç´ ç‚¹çš„è¯ï¼Œå…¶è¯­ä¹‰ä¿¡æ¯å¹¶ä¸é‚£ä¹ˆæ˜ç¡®ï¼Œæ‰€ä»¥éœ€è¦æ¯” MLP æ›´å¼ºå¤§çš„è§£ç å™¨</li></ol><p>ä»¥ä¸Šå°±æ˜¯ MAE çš„è®¾è®¡é€»è¾‘ï¼Œå¯¹äºæ¯ä¸ªéš¾ç‚¹ç²¾å‡†å‡ºå‡»ï¼</p><h3 id="MAE-Experiment"><a href="#MAE-Experiment" class="headerlink" title="MAE Experiment"></a>MAE Experiment</h3><h4 id="Ablation-Study"><a href="#Ablation-Study" class="headerlink" title="Ablation Study"></a>Ablation Study</h4><p><img src="/archives/d672e65b/image-20220413182021165.png" alt="image-20220413182021165" style="zoom:50%;"></p><p>fine-tuning ä»£è¡¨æ•´ä¸ªç½‘ç»œçš„å‚æ•°éƒ½å¯ä»¥è°ƒæ•´ï¼Œlinear probing åªèƒ½è°ƒæ•´æœ€åçš„è¾“å‡ºå±‚ï¼Œä¸¤ç§ä¸åŒçš„ç­–ç•¥æ•ˆæœç›¸å·®å¾ˆå¤§ï¼ä¸‹é¢è¿™å¼ å›¾æ¯”è¾ƒäº† MAE å’Œ ViT</p><h4 id="MAE-vs-ViT"><a href="#MAE-vs-ViT" class="headerlink" title="MAE vs. ViT"></a>MAE vs. ViT</h4><p><img src="/archives/d672e65b/image-20220413182400525.png" alt="image-20220413182400525" style="zoom:50%;"></p><p>è™½ç„¶åªçœ‹ç»“æœä¼¼ä¹ MAE è½åäº ViTï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ MAE åªåœ¨ ImageNet-1K ä¸Šåšçš„é¢„è®­ç»ƒï¼Œè€Œ ViT åœ¨ JFT ä¸Šåšçš„é¢„è®­ç»ƒï¼ˆè¿™æ˜¯ä¸€ä¸ªè¶…å¤§çš„æ•°æ®é›†ï¼‰ï¼Œä¸çŸ¥é“åœ¨æ›´å¤§çš„æ•°æ®é›†ä¸Šè¿›è¡Œé¢„è®­ç»ƒ MAE ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><h4 id="MAE-vs-MoCo"><a href="#MAE-vs-MoCo" class="headerlink" title="MAE vs. MoCo"></a>MAE vs. MoCo</h4><p><strong>å¾®è°ƒå±‚æ•°å®éªŒ</strong></p><p><img src="/archives/d672e65b/image-20220413182617158.png" alt="image-20220413182617158" style="zoom:50%;"></p><p><strong>ç›´æ¥ç»“æœæ¯”è¾ƒ</strong></p><p><img src="/archives/d672e65b/image-20220413183109192.png" alt="image-20220413183109192" style="zoom:50%;"></p><p>MAE å¯ä»¥è¯´æ˜¯æ¯” MoCo æ›´åŠ å¼ºåŠ²çš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ï¼ˆä½†æ˜¯ MoCo çš„è½»é‡å¥½ç”¨ä¹Ÿæ˜¯æ— å¯äº‰è®®çš„ï¼‰ã€‚ä»ç¬¬ä¸€å¼ å›¾å¯ä»¥çœ‹åˆ°éšç€è§£å†»çš„å±‚æ•°å¢åŠ ï¼ŒMAE è¿…é€Ÿè¶…è¶Šäº† MoCoã€‚è¿™è¯´æ˜äº† MAE/ViT ä¸æ˜¯ä¸€ä¸ªçº¿æ€§å¯åˆ†çš„ç»“æ„ï¼Œæœ€åå‡ å±‚çš„ transformer block æ˜¯å’Œä»»åŠ¡ç´§å¯†ç›¸å…³çš„ã€‚å¦ä¸€ä¸ªä¹Ÿè¯´æ˜äº†åº•å±‚æ‰€å­¦ä¹ çš„ç‰¹å¾æ˜¯é€šç”¨çš„ï¼Œå› ä¸ºéšç€è§£å†»å±‚çš„å¢åŠ ï¼Œè¡¨ç°çš„æå‡å¢åŠ ç¼“æ…¢</p><p>è®ºæ–‡åœ¨ç›¸å…³å·¥ä½œé‡Œæäº†ä¸€å¥å¯¹æ¯”å­¦ä¹ ï¼šå¯¹æ¯”å­¦ä¹ æ›´ä¾èµ–äºä»£ç†ä»»åŠ¡å’Œæ•°æ®å¢å¼ºï¼ˆå†è”ç³»ä¸Š mean teacherï¼Œæˆ‘ä¼¼ä¹æ„Ÿè§‰ï¼šåŠç›‘ç£å’Œæ— ç›‘ç£çš„åŒºåˆ«å†æ…¢æ…¢å‡å°‘ï¼Ÿï¼‰</p><h2 id="Swin"><a href="#Swin" class="headerlink" title="Swin"></a>Swin</h2><p><a href="https://www.bilibili.com/video/BV1pL4y1v7jC/?spm_id_from=333.788">Swin-Transformerç½‘ç»œç»“æ„è¯¦è§£</a> <a href="https://www.bilibili.com/video/BV13L4y1475U/?spm_id_from=333.788">Swin Transformerè®ºæ–‡ç²¾è¯»</a></p><p>çœ‹äº†ä¸Šé¢ä¸¤ä¸ªè®²è§£è§†é¢‘ï¼Œæœ€å¤§çš„æ„Ÿå—å°±æ˜¯ï¼šå¥½å¤šå¥½å¤š trick å•Šï¼ï¼è‡ªå·±ç†è§£èµ·æ¥ä¹Ÿæ²¡æœ‰ç‰¹åˆ«æ¸…æ™°â€¦éš¾é“ä»¥åè¦ä½¿ç”¨ swin ä½œä¸ºä¹‹åçš„ä¸»è¦éª¨å¹²å—ï¼Ÿå›æƒ³èµ· ResNet ç®€æ´ï¼Œæˆ‘å®åœ¨æ˜¯éš¾ä»¥æ¥å—â€¦è¿™é‡Œå°±ç®€å•æ•´ç†ä¸€ä¸‹é‡Œé¢çš„æ ¸å¿ƒæ€æƒ³å§</p><p>Swin è®¤ä¸º Transformer åœ¨è§†è§‰é‡Œçš„ä¸¤å¤§éš¾ç‚¹ï¼š</p><ol><li>å¤„ç†å¤šå°ºåº¦ä¿¡æ¯</li><li>å¤„ç†é«˜åˆ†è¾¨ç‡å›¾åƒ</li></ol><p>è¿™ä¸¤è€…ä¸ªéš¾ç‚¹ä½¿ç”¨ç§»åŠ¨çª—å£åœ¨ CNN é‡Œæ˜¯å¾ˆå¥½çš„è§£å†³çš„ï¼ˆä¸ºä»€ä¹ˆä¸èƒ½ä¹Ÿä½¿ç”¨ç§»åŠ¨çª—å£ï¼Ÿå¯èƒ½æ˜¯è®¡ç®—ä¸Šçš„åŸå› å§ï¼‰ï¼Œè®ºæ–‡å°±æƒ³å°½åŠæ³•ï¼ŒæŠŠ CNN ä¸Šçš„â€œçª—å£â€å¾€ transformer é‡Œé¢æ¬ï¼š</p><ol><li>å¯¹äºé«˜åˆ†è¾¨ç‡é—®é¢˜ï¼Œä¹Ÿæ˜¯è®¡ç®—é‡é—®é¢˜ï¼ŒSwin ç›´æ¥åœ¨ä¸€ä¸ªå›ºå®šçš„ window å†…éƒ¨åšè‡ªæ³¨æ„åŠ›å³å¯ </li><li>å¯¹äºå¤šå°ºåº¦é—®é¢˜ï¼ŒSwin ä½¿ç”¨äº†ä¸€ä¸ª Patch Merging çš„æ–¹æ³•ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¿›è¡Œåƒ CNN ä¸€æ ·çš„ä¸‹é‡‡æ ·ï¼Œè·å¾—æ›´å¤§çš„æ„Ÿå—é‡</li><li>å¯¹äºå›ºå®š window çš„æ–¹æ³•æœ‰å±€é™æ€§ï¼šwindow ä¹‹é—´çš„äº¤äº’æ²¡æœ‰äº†ã€‚æ‰€ä»¥æå‡ºäº† shifted window è‡ªæ³¨æ„åŠ›</li><li>å¯¹äºæå‡ºçš„ shifted window è‡ªæ³¨æ„åŠ›ï¼Œç”±äºå„ä¸ªå¤§å°çš„å—ä¸ä¸€æ ·äº†ï¼Œæå‡ºäº†æ›´æœ‰æ•ˆçš„å¾ªç¯ä½ç§»+æ©ç è®¡ç®—æ–¹æ³•</li><li>ä½¿ç”¨äº†ä¸€ä¸ªä¸å¤ªå¥½ç†è§£çš„ç›¸å¯¹ä½ç½®ç¼–ç ï¼Œä½œä¸ºåç½®åŠ å…¥åˆ°æƒé‡å½“ä¸­ï¼Œè€Œä¸æ˜¯åƒ ViT ä¸€æ ·åš embedding</li></ol><p>å¯ä»¥çœ‹åˆ°åé¢ä¸‰ç‚¹éƒ½æ˜¯é’ˆå¯¹ç¬¬ä¸€ç‚¹çš„ idea åšçš„è¡¥å……ï¼Œå¹¶ä¸”éƒ½ä¸æ˜¯ç‰¹åˆ«å¥½ç†è§£â€¦ä½†æœ€ç»ˆ Swin çš„æ•ˆæœå°±æ˜¯å·¨å¥½ï¼ç®€ç›´å°±æ˜¯æ— æƒ…çš„å± æ¦œæœºå™¨ï¼å¹¶ä¸”åœ¨å„å¼å„æ ·çš„æ€§èƒ½ä¼˜åŒ–ä¸‹ï¼Œè®¡ç®—é‡å’ŒåŒç­‰å¤§å°çš„ ResNet æ˜¯å·®ä¸å¤šçš„ï¼Œå¸Œæœ›å¤§ä½¬ä»¬ç»§ç»­åŠªåŠ›ï¼Œä¸‹æ”¾æ›´å¥½çš„æŠ€æœ¯ç»™æˆ‘ä»¬ç”¨555</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ViT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IA-SSD</title>
      <link href="/archives/2083e7ea.html"/>
      <url>/archives/2083e7ea.html</url>
      
        <content type="html"><![CDATA[<h1 id="IA-SSD"><a href="#IA-SSD" class="headerlink" title="IA-SSD"></a>IA-SSD</h1><hr><p>Zhang, Yifan, Qingyong Hu, Guoquan Xu, Yanxin Ma, Jianwei Wan, and Yulan Guo. â€œNot All Points Are Equal: Learning Highly Efficient Point-Based Detectors for 3D LiDAR Point Clouds.â€ <em>ArXiv:2203.11139 [Cs]</em>, March 21, 2022. <a href="http://arxiv.org/abs/2203.11139">http://arxiv.org/abs/2203.11139</a>.</p><hr><p>å¥½ä¹…æ²¡æœ‰çœ‹æ–°çš„æ–‡ç« äº†â€¦æ¥çœ‹çœ‹æ–°é²œå‡ºç‚‰çš„ CVPR 2022 çš„è®ºæ–‡å§ï¼</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>ä¾ç„¶æ˜¯è§£å†³è€é—®é¢˜ï¼šä½“ç´ åŒ–çš„éœ€è¦è§£å†³ä¿¡æ¯æŸå¤± ï¼Œç›´æ¥å¯¹ç‚¹è¿›è¡Œç‰¹å¾æå–é€Ÿåº¦åˆä¸å¤ªè¡Œã€‚è¿™ç¯‡è®ºæ–‡æ˜¯ point-based SSDï¼Œæƒ³è¦ä½¿ç”¨ point çš„ç²¾ç»†ç‰¹å¾ï¼Œåˆä¸æƒ³è¦å¤§é‡çš„è®¡ç®—ï¼Œå¦‚æœèƒ½å¤Ÿæœ‰ä¸é”™çš„æ–¹æ³•å¯¹ç‚¹äº‘è¿›è¡Œç­›é€‰å°±å¥½äº†</p><p>ä¹‹å‰çš„ point-based çš„é‡‡æ ·æ–¹æ³•éƒ½æ˜¯ furthest points sampling (FPS) åŸºäºè·ç¦»çš„æœ€è¿œé‡‡æ ·æ³•ï¼Œè¿™æ ·ç”šè‡³ä¼šä¸¢å¤±ä¸€äº›é‡è¦çš„å‰æ™¯ç‚¹ã€‚è®ºæ–‡ç›´æ¥ä½¿ç”¨äº†ä¸€ä¸ªç½‘ç»œæ¥é¢„æµ‹æŸä¸ªç‚¹æ˜¯å¦ä¸ºå‰æ™¯ç‚¹ï¼Œå¹¶åŸºäºè¿™äº›é¢„æµ‹ç»“æœè¿›è¡Œä¸‹é‡‡æ ·ï¼Œè¿™æ ·å°±ä¿è¯äº†é‡è¦çš„ç‚¹ä¸è¢«ä¸¢å¼ƒ</p><h2 id="IA-SSD-1"><a href="#IA-SSD-1" class="headerlink" title="IA-SSD"></a>IA-SSD</h2><h3 id="Class-aware-sampling"><a href="#Class-aware-sampling" class="headerlink" title="Class-aware sampling"></a>Class-aware sampling</h3><p>ç®€å•æ¥è¯´è®ºæ–‡ä½¿ç”¨ MLPï¼Œå°†æ¯ä¸ªç‚¹çš„ç‰¹å¾ç”¨äºé¢„æµ‹æ¯ä¸ªç‚¹çš„ç±»åˆ«ã€‚æŸå¤±å‡½æ•°ä¸ºäº¤å‰ç†µæŸå¤±</p><script type="math/tex; mode=display">L_{c l s-a w a r e}=-\sum_{c=1}^{C}\left(s_{i} \log \left(\hat{s_{i}}\right)+\left(1-s_{i}\right) \log \left(1-{\hat{s_{i}}}\right)\right)</script><p>C ä»£è¡¨çš„æ˜¯æ•°æ®é›†çš„æ‰€æœ‰æ ‡ç­¾ç±»åˆ«ï¼Œ$s_i$ ä¸ºæ ‡ç­¾çš„ one-hot å‘é‡ã€‚åœ¨æ¨ç†çš„æ—¶å€™ï¼Œå–å‰ k ä¸ªæœ€é«˜å¾—åˆ†çš„ç‚¹</p><h3 id="Centroid-aware-sampling"><a href="#Centroid-aware-sampling" class="headerlink" title="Centroid-aware sampling"></a>Centroid-aware sampling</h3><p>è¿™æ˜¯è®ºæ–‡è¿›ä¸€æ­¥æå‡ºçš„é‡‡æ ·æ–¹æ³•ï¼Œè®©æŸå¤±å‡½æ•°æ›´èšç„¦äºæ¥è¿‘ç‰©ä½“ä¸­å¿ƒçš„ç‚¹</p><script type="math/tex; mode=display">L_{c t r-a w a r e}=-\sum_{c=1}^{C}\left(M a s k_{i} \cdot s_{i} \log \left(\hat{s_{i}}\right)+\left(1-s_{i}\right) \log \left(1-\hat{s_{i}}\right)\right)\\M a s k_{i}=\sqrt[3]{\frac{\min \left(f^{*}, b^{*}\right)}{\max \left(f^{*}, b^{*}\right)} \times \frac{\min \left(l^{*}, r^{*}\right)}{\max \left(l^{*}, r^{*}\right)} \times \frac{\min \left(u^{*}, d^{*}\right)}{\max \left(u^{*}, d^{*}\right)}}</script><p>å…¶ä¸­ $f^<em>,b^</em>,l^<em>,r^</em>,u^<em>,d^</em>$ ä»£è¡¨çš„æ˜¯è¿™ä¸ªç‚¹åˆ° ground truth bbox å‰åå·¦å³ä¸Šä¸‹è¡¨é¢çš„è·ç¦»</p><p>åœ¨æ¨ç†/è®­ç»ƒæ—¶ï¼Œç›´æ¥ä¸‹é‡‡æ ·å¾—åˆ†æœ€é«˜çš„ top k ä¸ªç‚¹ä»¥åŠå®ƒä»¬çš„ç‰¹å¾ç»§ç»­è¿›è¡Œé€‰æ¡†é¢„æµ‹</p><h3 id="Centroid-Prediction"><a href="#Centroid-Prediction" class="headerlink" title="Centroid Prediction"></a>Centroid Prediction</h3><p>ç»§ç»­ç»™ç½‘ç»œåŠ å…¥ä¸€äº›å…ˆéªŒçŸ¥è¯†ï¼šè®©ç½‘ç»œå»åšä¸€äº›ä¸Šä¸‹æ–‡çš„é¢„æµ‹ï¼Œèƒ½å¤Ÿè®©æ£€æµ‹çš„ç»“æœæ›´å¥½ï¼Œè®ºæ–‡é€‰æ‹©å»åšä¸­å¿ƒå›å½’é¢„æµ‹</p><script type="math/tex; mode=display">\begin{aligned}L_{c e n t}=& \frac{1}{\left|\mathcal{F}_{+}\right|} \frac{1}{\left|\mathcal{S}_{+}\right|} \sum_{i} \sum_{j}\left(\left|\Delta \hat c_{i j}-\Delta c_{i j}\right|+\left| \hat{c_{i j}}-\overline{c_{i}}\right|\right) \cdot \mathbf{I}_{\mathcal{S}}\left(p_{i j}\right) \\& \text { where } \quad \overline{c_{i}}=\frac{1}{\left|\mathcal{S}_{+}\right|} \sum_{j} c_{i j}, \quad \mathbf{I}_{\mathcal{S}}: \mathcal{P} \rightarrow\{0,1\}\end{aligned}</script><p>å…ˆä»‹ç»ä¸€ä¸‹å…¬å¼ä¸­æ ‡è®°çš„å«ä¹‰ï¼š</p><ol><li>F ä»£è¡¨ ground truth boxes ä¸ªæ•°</li><li>S ä»£è¡¨ï¼ˆæŸ gt box å†…ï¼‰è¿›è¡Œé¢„æµ‹çš„ç‚¹</li><li>c ä»£è¡¨ center offsetï¼Œi ä»£è¡¨ç¬¬ i ä¸ª gt boxï¼Œj ä»£è¡¨åœ¨å¯¹åº” gt box ä¸­ç¬¬ j ä¸ªç‚¹</li><li>I ä¸ºç¤ºæ€§å‡½æ•°ï¼Œä»£è¡¨è¿™ä¸ªç‚¹æœ‰æ²¡æœ‰åœ¨æŸä¸ª gt ä¸­ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦ä¸ºå‰æ™¯ç‚¹</li></ol><p>å¯èƒ½ä¸Šè¿°çš„å…¬å¼ä¹Ÿä¸æ˜¯ç‰¹åˆ«ä¸¥è°¨ï¼Œä½†æ˜¯æ•´ä½“è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼š</p><ol><li>æ¯ä¸€ä¸ªï¼ˆå‰æ™¯ï¼‰ç‚¹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ gt bboxï¼ŒæŸå¤±çš„è®¡ç®—éƒ½æ˜¯ç‚¹ä¸å„è‡ªçš„ gt ä¹‹é—´è®¡ç®—çš„ã€‚æŸå¤±è¿›å¯¹å‰æ™¯ç‚¹è¿›è¡Œï¼Œå¹¶ä½¿ç”¨å‰æ™¯ç‚¹çš„æ•°é‡è¿›è¡Œå½’ä¸€åŒ–</li><li>å¢åŠ äº†ä¸€ä¸ªç±»ä¼¼äºæ–¹å·®çš„æŸå¤±é¡¹ï¼Œå¸Œæœ›é¢„æµ‹çš„ä¸­å¿ƒå°½é‡èšé›†åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯æ–¹å·®å°½é‡çš„å°</li></ol><h3 id="Centroid-based-Instance-Aggregation"><a href="#Centroid-based-Instance-Aggregation" class="headerlink" title="Centroid-based Instance Aggregation"></a>Centroid-based Instance Aggregation</h3><p>æœ‰ä¸ªé¢„æµ‹çš„ä¸­å¿ƒç‚¹è¿‡åï¼Œå°±å¯ä»¥åŸºäºè¿™äº›ä¸­å¿ƒç‚¹åšç‰¹å¾æå–ã€‚è®ºæ–‡ä½¿ç”¨ PointNet++ å¯¹ç‚¹é›†è¿›è¡Œ set abstractionã€‚è®ºæ–‡è¿™é‡Œè®²å¾—ç‰¹åˆ«çš„æ¨¡ç³Šï¼Œç›´æ¥ä¸€å¥å¸¦è¿‡äº†ï¼Œè¯´æ˜¯ç”¨äº† local canonical coordinate systemï¼Œä½†æ˜¯æˆ‘å»çœ‹ä»£ç çš„æ—¶å€™å¥½åƒæ²¡æœ‰çœ‹åˆ°å¯¹åº”çš„ canonical transformationã€‚ç›´æ¥ä½¿ç”¨äº†é¢„æµ‹å¾—åˆ°çš„ä¸­å¿ƒä½œä¸º new_xyzï¼ˆéœ€è¦åšç‰¹å¾èšé›†çš„ç‚¹ï¼‰ç„¶åä½¿ç”¨ PointNet++ çš„æ–¹å¼æŠ½å–ç‰¹å¾ã€‚ç‰¹å¾æ¥æºæ˜¯ä¹‹å‰ SA çš„è¾“å‡ºï¼Œå³ç»è¿‡ centroid-aware sampling åçš„è¾“å‡º</p><h3 id="Proposal"><a href="#Proposal" class="headerlink" title="Proposal"></a>Proposal</h3><p>è®ºæ–‡ä¹Ÿæ˜¯ä¸€å¥å¸¦è¿‡ã€‚åº”è¯¥å°±æ˜¯ä½¿ç”¨ç‚¹çš„ç‰¹å¾é¢„æµ‹ bboxï¼Œç„¶åä½¿ç”¨ NMS åšè¿‡æ»¤ã€‚è®ºæ–‡è¿˜ä½¿ç”¨äº† corner lossï¼Œå³æ˜¯å…«ä¸ªè§’ç‚¹çš„æŸå¤±å‡½æ•°ã€‚è¿™ä¸ªæŸå¤±ä¼¼ä¹è¶Šæ¥è¶Šå¤šåœ¨ç”¨äº†</p><script type="math/tex; mode=display">L_{\text {corner }}=\sum_{m=1}^{8}\left\|P_{m}-G_{m}\right\|</script><h3 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h3><p>æ•´ä½“çœ‹ä¸€ä¸‹ç½‘ç»œç»“æ„</p><p><img src="/archives/2083e7ea/image-20220519164546481.png" alt="image-20220519164546481" style="zoom: 50%;"></p><p>ä¹‹å‰æ²¡æåˆ°çš„ç‚¹ï¼šè™½ç„¶è®ºæ–‡çš„ä¸‹é‡‡æ ·æ ¸å¿ƒæ˜¯ centroid-aware samplingï¼Œä½†æ˜¯åœ¨æœ€å¼€å§‹ä¾ç„¶é‡‡ç”¨çš„åŸå§‹çš„ distance-based grouping &amp; downsampling ç”¨äºæå–ç‰¹å¾ï¼Œä¸Šå›¾çš„ <code>...</code> å°±ä»£è¡¨å¤šå±‚çš„åŸå§‹ SA æ¨¡å—</p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="Effectiveness-of-downsampling"><a href="#Effectiveness-of-downsampling" class="headerlink" title="Effectiveness of downsampling"></a>Effectiveness of downsampling</h3><p>è®ºæ–‡æå‡ºçš„ centroid-aware sampling èƒ½å¤Ÿæ›´å¥½åœ°ä¿å­˜å‰æ™¯ç‚¹</p><p><img src="/archives/2083e7ea/image-20220519165428941.png" alt="image-20220519165428941" style="zoom:67%;"></p><h3 id="Waymo-amp-ONCE-Results"><a href="#Waymo-amp-ONCE-Results" class="headerlink" title="Waymo &amp; ONCE Results"></a>Waymo &amp; ONCE Results</h3><p><img src="/archives/2083e7ea/image-20220519165729325.png" alt="image-20220519165729325" style="zoom: 67%;"></p><p>æ£€æµ‹æ•ˆæœè¿˜æ˜¯å¯ä»¥çš„ï¼Œè™½ç„¶ä¸æ˜¯æœ€å¥½çš„çš„ï¼Œä½† IA-SSD èƒœåœ¨è½»å·§ï¼Œåœ¨ KITTI ä¸Šèƒ½å¤Ÿé€šè¿‡é«˜åº¦å¹¶è¡Œè¾¾åˆ° <strong>80 fps</strong> çš„æ¨ç†é€Ÿåº¦</p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><p>ä»£ç è§£è¯»ï¼Œæ„Ÿè§‰è¿™ç¯‡è®ºæ–‡ç”¨åˆ°äº†å¾ˆå¤š point-based æ–¹æ³•ï¼Œä¹Ÿè®¸ä»¥åä¼šç”¨åˆ°</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Point Cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 14 è‡ªç„¶è¯­è¨€å¤„ç†ï¼šé¢„è®­ç»ƒ</title>
      <link href="/archives/736b157a.html"/>
      <url>/archives/736b157a.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-14-è‡ªç„¶è¯­è¨€å¤„ç†ï¼šé¢„è®­ç»ƒ"><a href="#D2L-14-è‡ªç„¶è¯­è¨€å¤„ç†ï¼šé¢„è®­ç»ƒ" class="headerlink" title="D2L 14 è‡ªç„¶è¯­è¨€å¤„ç†ï¼šé¢„è®­ç»ƒ"></a>D2L 14 è‡ªç„¶è¯­è¨€å¤„ç†ï¼šé¢„è®­ç»ƒ</h1><h2 id="Word2vec"><a href="#Word2vec" class="headerlink" title="Word2vec"></a>Word2vec</h2><p>è¯å‘é‡æ˜¯ç”¨äºè¡¨ç¤ºå•è¯æ„ä¹‰çš„å‘é‡ï¼Œ å¹¶ä¸”è¿˜å¯ä»¥è¢«è®¤ä¸ºæ˜¯å•è¯çš„ç‰¹å¾å‘é‡æˆ–è¡¨ç¤ºã€‚ å°†å•è¯æ˜ å°„åˆ°å®å‘é‡çš„æŠ€æœ¯ç§°ä¸ºè¯åµŒå…¥ã€‚ è¿‘å¹´æ¥ï¼Œè¯åµŒå…¥é€æ¸æˆä¸ºè‡ªç„¶è¯­è¨€å¤„ç†çš„åŸºç¡€çŸ¥è¯†ã€‚<strong>è™½ç„¶ç‹¬çƒ­å‘é‡å¾ˆå®¹æ˜“æ„å»ºï¼Œä½†å®ƒä»¬é€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©</strong>ã€‚ä¸€ä¸ªä¸»è¦åŸå› æ˜¯ç‹¬çƒ­å‘é‡ä¸èƒ½å‡†ç¡®è¡¨è¾¾ä¸åŒè¯ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„â€œä½™å¼¦ç›¸ä¼¼åº¦â€</p><p><strong>word2vec å·¥å…·æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜è€Œæå‡ºçš„</strong>ã€‚å®ƒå°†æ¯ä¸ªè¯æ˜ å°„åˆ°ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å‘é‡ï¼Œè¿™äº›å‘é‡èƒ½æ›´å¥½åœ°è¡¨è¾¾ä¸åŒè¯ä¹‹é—´çš„ç›¸ä¼¼æ€§å’Œç±»æ¯”å…³ç³»ã€‚word2vec å·¥å…·åŒ…å«ä¸¤ä¸ªæ¨¡å‹ï¼Œå³è·³å…ƒæ¨¡å‹ï¼ˆskip-gramï¼‰è¿ç»­è¯è¢‹ï¼ˆCBOWï¼‰</p><h3 id="è·³å…ƒæ¨¡å‹ï¼ˆskip-gramï¼‰"><a href="#è·³å…ƒæ¨¡å‹ï¼ˆskip-gramï¼‰" class="headerlink" title="è·³å…ƒæ¨¡å‹ï¼ˆskip-gramï¼‰"></a>è·³å…ƒæ¨¡å‹ï¼ˆskip-gramï¼‰</h3><p>è·³å…ƒæ¨¡å‹å‡è®¾ä¸€ä¸ªè¯å¯ä»¥ç”¨æ¥åœ¨æ–‡æœ¬åºåˆ—ä¸­ç”Ÿæˆå…¶å‘¨å›´çš„å•è¯ã€‚ä»¥æ–‡æœ¬åºåˆ—â€œtheâ€ã€â€œmanâ€ã€â€œlovesâ€ã€â€œhisâ€ã€â€œsonâ€ä¸ºä¾‹ã€‚å‡è®¾ä¸­å¿ƒè¯é€‰æ‹©â€œlovesâ€ï¼Œå¹¶å°†ä¸Šä¸‹æ–‡çª—å£è®¾ç½®ä¸º2ï¼Œå‡è®¾ä¸Šä¸‹æ–‡è¯æ˜¯åœ¨ç»™å®šä¸­å¿ƒè¯çš„æƒ…å†µä¸‹ç‹¬ç«‹ç”Ÿæˆçš„ï¼Œè”åˆæ¡ä»¶æ¦‚ç‡å¯ç”¨å¦‚ä¸‹å›¾è¡¨ç¤º</p><p><img src="/archives/736b157a/image-20220330215317546.png" alt="image-20220330215317546" style="zoom:50%;"></p><p>åœ¨è·³å…ƒæ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¯éƒ½æœ‰ä¸¤ä¸ª d ç»´å‘é‡è¡¨ç¤ºï¼Œç”¨äºè®¡ç®—æ¡ä»¶æ¦‚ç‡ã€‚ç»™å®šä¸­å¿ƒè¯ $w_c$ï¼ˆè¯å…¸ä¸­çš„ç´¢å¼• cï¼‰ï¼Œç”Ÿæˆä»»ä½•ä¸Šä¸‹æ–‡è¯ $w_o$ï¼ˆè¯å…¸ä¸­çš„ç´¢å¼• oï¼‰çš„æ¡ä»¶æ¦‚ç‡å¯ä»¥é€šè¿‡å¯¹å‘é‡ç‚¹ç§¯çš„ softmax æ“ä½œæ¥å»ºæ¨¡</p><script type="math/tex; mode=display">P\left(w_{o} \mid w_{c}\right)=\frac{\exp \left(\mathbf{u}_{o}^{\top} \mathbf{v}_{c}\right)}{\sum_{i \in \mathcal{V}} \exp \left(\mathbf{u}_{i}^{\top} \mathbf{v}_{c}\right)}</script><p>å…¶ä¸­è¯è¡¨ç´¢å¼•é›† $V={0,1,â€¦,|V|âˆ’1}$ã€‚ç»™å®šé•¿åº¦ä¸º $T$ çš„æ–‡æœ¬åºåˆ—ï¼Œå…¶ä¸­æ—¶é—´æ­¥ t å¤„çš„è¯è¡¨ç¤ºä¸º $w^{(t)}$ã€‚å‡è®¾ä¸Šä¸‹æ–‡è¯æ˜¯åœ¨ç»™å®šä»»ä½•ä¸­å¿ƒè¯çš„æƒ…å†µä¸‹ç‹¬ç«‹ç”Ÿæˆçš„ã€‚å¯¹äºä¸Šä¸‹æ–‡çª—å£ mï¼Œè·³å…ƒæ¨¡å‹çš„ä¼¼ç„¶å‡½æ•°æ˜¯åœ¨ç»™å®šä»»ä½•ä¸­å¿ƒè¯çš„æƒ…å†µä¸‹ç”Ÿæˆæ‰€æœ‰ä¸Šä¸‹æ–‡è¯çš„æ¦‚ç‡ï¼š</p><script type="math/tex; mode=display">\prod_{t=1}^{T} \prod_{-m \leq j \leq m, j \neq 0} P\left(w^{(t+j)} \mid w^{(t)}\right)</script><p>åšæ·±åº¦å­¦ä¹ ä¹…äº†ï¼Œæ„Ÿè§‰æ‰€æœ‰ä¸œè¥¿å¿…é¡»è¦æœ‰ä¸€ä¸ªæ ‡ç­¾æ‰èƒ½è®¡ç®—æŸå¤±å‡½æ•°ï¼Œç„¶åä½¿ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•è¿›è¡Œä¼˜åŒ–ï¼Œçœ‹åˆ°è¿™é‡Œè¿˜æœ‰ç‚¹ä¸å¤ªä¹ æƒ¯ğŸ˜‚å®é™…ä¸Šè¯¥ä¼¼ç„¶å‡½æ•°å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼˜åŒ–ç¥ç»ç½‘ç»œçš„å‚æ•°è·å¾—ä¼¼ç„¶å‡½æ•°çš„æœ€ä¼˜è§£</p><h3 id="è¿ç»­è¯è¢‹ï¼ˆCBOWï¼‰æ¨¡å‹"><a href="#è¿ç»­è¯è¢‹ï¼ˆCBOWï¼‰æ¨¡å‹" class="headerlink" title="è¿ç»­è¯è¢‹ï¼ˆCBOWï¼‰æ¨¡å‹"></a>è¿ç»­è¯è¢‹ï¼ˆCBOWï¼‰æ¨¡å‹</h3><p>è¿ç»­è¯è¢‹ç±»ä¼¼äºå®Œå½¢å¡«ç©ºï¼Œç»™å®šä¸Šä¸‹æ–‡æ¨ç†å‡ºç©ºç¼ºè¯ã€‚</p><p><img src="/archives/736b157a/image-20220409162215687.png" alt="image-20220409162215687" style="zoom:50%;"></p><p>ç”±äºè¿ç»­è¯è¢‹æ¨¡å‹ä¸­å­˜åœ¨å¤šä¸ªä¸Šä¸‹æ–‡è¯ï¼Œå› æ­¤åœ¨è®¡ç®—æ¡ä»¶æ¦‚ç‡æ—¶å¯¹è¿™äº›ä¸Šä¸‹æ–‡è¯å‘é‡è¿›è¡Œå¹³å‡ï¼Œå‡è®¾æœ‰ 2m ä¸ªä¸Šä¸‹æ–‡è¯</p><script type="math/tex; mode=display">P\left(w_{c} \mid w_{o 1}, \ldots, w_{o 2 m}\right)=\frac{\exp \left(\frac{1}{2 m} \mathbf{u}_{c}^{\top}\left(\mathbf{v}_{o 1}+\ldots,+\mathbf{v}_{o 2 m}\right)\right)}{\sum_{i \in \mathcal{V}} \exp \left(\frac{1}{2 m} \mathbf{u}_{i}^{\top}\left(\mathbf{v}_{o 1}+\ldots,+\mathbf{v}_{o 2 m}\right)\right)}</script><p>è¿ç»­è¯è¢‹æ¨¡å‹çš„ä¼¼ç„¶å‡½æ•°æ˜¯åœ¨ç»™å®šå…¶ä¸Šä¸‹æ–‡è¯çš„æƒ…å†µä¸‹ç”Ÿæˆæ‰€æœ‰ä¸­å¿ƒè¯çš„æ¦‚ç‡</p><script type="math/tex; mode=display">\prod_{t=1}^{T} P\left(w^{(t)} \mid w^{(t-m)}, \ldots, w^{(t-1)}, w^{(t+1)}, \ldots, w^{(t+m)}\right)</script><h2 id="è¿‘ä¼¼è®­ç»ƒ"><a href="#è¿‘ä¼¼è®­ç»ƒ" class="headerlink" title="è¿‘ä¼¼è®­ç»ƒ"></a>è¿‘ä¼¼è®­ç»ƒ</h2><p>å¯ä»¥çœ‹ä¸€çœ‹ <a href="https://www.bilibili.com/video/BV154411S7Tf?p=16">å®˜æ–¹è§†é¢‘</a>ï¼Œæ¯”æ•™æè¿˜è¦è®²å¾—æ›´æ¸…æ¥šã€‚ç”±äºè·³å…ƒæ¨¡å‹å’Œè¿ç»­è¯è¢‹æ¨¡å‹éå¸¸ç›¸åƒï¼Œä¹‹åéƒ½ä»¥è·³å…ƒæ¨¡å‹è¿›è¡Œè¯´æ˜</p><p>å¦‚æœæˆ‘ä»¬å¯¹è·³å…ƒæ¨¡å‹çš„ç›®æ ‡å‡½æ•°è¿›è¡Œæ±‚å¯¼å¯å¾—ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\frac{\partial \log P\left(w_{o} \mid w_{c}\right)}{\partial \mathbf{v}_{c}} &=\mathbf{u}_{o}-\frac{\sum_{j \in \mathcal{V}} \exp \left(\mathbf{u}_{j}^{\top} \mathbf{v}_{c}\right) \mathbf{u}_{j}}{\sum_{i \in \mathcal{V}} \exp \left(\mathbf{u}_{i}^{\top} \mathbf{v}_{c}\right)} \\&=\mathbf{u}_{o}-\sum_{j \in \mathcal{V}}\left(\frac{\exp \left(\mathbf{u}_{j}^{\top} \mathbf{v}_{c}\right)}{\sum_{i \in \mathcal{V}} \exp \left(\mathbf{u}_{i}^{\top} \mathbf{v}_{c}\right)}\right) \mathbf{u}_{j} \\&=\mathbf{u}_{o}-\sum_{j \in \mathcal{V}} P\left(w_{j} \mid w_{c}\right) \mathbf{u}_{j}\end{aligned}</script><p>å¯ä»¥å‘ç°å…¶ä¸­æœ‰ä¸€ä¸ªæ±‚å’Œé¡¹ï¼Œå¯¹äºè¯å…¸æ•°é‡ V å¾ˆå¤§çš„æƒ…å†µï¼Œè®¡ç®—é‡ä¼šéå¸¸å¤§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æå‡ºäº†ä¸¤ä¸ªæ–¹æ³•</p><h3 id="è´Ÿé‡‡æ ·"><a href="#è´Ÿé‡‡æ ·" class="headerlink" title="è´Ÿé‡‡æ ·"></a>è´Ÿé‡‡æ ·</h3><p>ä¸Šé¢çš„æ±‚å’Œé—®é¢˜æ˜¯ç”±äº softmax çš„è®¡ç®—æ–¹å¼å¯¼è‡´ã€‚ç›´æ¥é‡‡ç”¨ sigmoid è¿›è¡Œæ¦‚ç‡è¡¨ç¤ºå°±ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç°åœ¨æ¥å»ºæ¨¡å¦ä¸€ä¸ªæ¦‚ç‡äº‹ä»¶</p><script type="math/tex; mode=display">P\left(D=1 \mid w_{c}, w_{o}\right)=\sigma\left(\mathbf{u}_{o}^{\top} \mathbf{v}_{c}\right)</script><p>å…¶ä¸­å‡ºç°äº†ä¸€ä¸ªæ–°çš„éšæœºå˜é‡ Dï¼Œè¯¥å˜é‡è¡¨ç¤º $w_c, w_o$ æ˜¯å¦å‡ºç°åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡çª—å£ï¼Œå¦‚æœåœ¨åˆ™ D = 1 å¦‚æœä¸åœ¨åˆ™ D = 0ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç”¨ä¸¤ä¸ªè¯æ˜¯å¦å‡ºç°åœ¨åŒä¸€ä¸ªçª—å£æ¥è¿›è¡Œå»ºæ¨¡ã€‚ä½†é‡‡ç”¨è¿™æ ·çš„å»ºæ¨¡æ–¹å¼æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå½“ä½ å»æœ€å¤§åŒ–ä¼¼ç„¶æ—¶ï¼Œå¾—åˆ°çš„æ‰€æœ‰è¯å‘é‡å°†ä¼šæ˜¯ä¸€ä¸ªæ— ç©·å¤§çš„æ•°ã€‚ä¸ºäº†è®©æ¨¡å‹å˜å¾—åˆç†ï¼Œæˆ‘ä»¬åŠ å…¥è´Ÿæ ·æœ¬/å™ªå£°æ ·æœ¬/èƒŒæ™¯æ ·æœ¬ï¼Œè´Ÿæ ·æœ¬é€šè¿‡äººä¸ºè®¾å®šçš„å…ˆéªŒæ¦‚ç‡ P(w) é‡‡æ ·å¾—åˆ°ã€‚æˆ‘ä»¬é‡‡æ · K ä¸ªè´Ÿæ ·æœ¬ $w_k$ï¼Œå¹¶é‡æ–°å†™å‡ºæ¦‚ç‡</p><script type="math/tex; mode=display">P\left(w^{(t+j)} \mid w^{(t)}\right)=P\left(D=1 \mid w^{(t)}, w^{(t+j)}\right) \prod_{k=1, w k \sim P(w)}^{K} P\left(D=0 \mid w^{(t)}, w_{k}\right)</script><p>æ­¤æ—¶æˆ‘ä»¬å°†åŸå§‹çš„æ¨¡å‹åˆ†è§£ä¸ºäº†ä¸¤éƒ¨åˆ†ï¼šä¸¤ä¸ªè¯åœ¨åŒä¸€çª—å£å†…ï¼Œä¸¤ä¸ªè¯ä¸åœ¨åŒä¸€çª—å£å†…ã€‚æ­¤æ—¶è¯¥æ¨¡å‹å°†ä¸å†å«æœ‰ softmax å½“ä¸­çš„æ±‚å’Œï¼Œè®¡ç®—é‡ç”±é‡‡æ ·æ•° K é™åˆ¶ã€‚å°†ç›®æ ‡å‡½æ•°å†™å¾—å…·ä½“ä¸€äº›</p><script type="math/tex; mode=display">\begin{aligned}-\log P\left(w^{(t+j)} \mid w^{(t)}\right) &=-\log P\left(D=1 \mid w^{(t)}, w^{(t+j)}\right)-\sum_{k=1, w k \sim P(w)}^{K} \log P\left(D=0 \mid w^{(t)}, w_{k}\right) \\&=-\log \sigma\left(\mathbf{u}_{i t+j}^{\top} \mathbf{v}_{i t}\right)-\sum_{k=1, w k \sim P(w)}^{K} \log \left(1-\sigma\left(\mathbf{u}_{h k}^{\top} \mathbf{v}_{i t}\right)\right) \\&=-\log \sigma\left(\mathbf{u}_{i t+j}^{\top} \mathbf{v}_{i t}\right)-\sum_{k=1, w k \sim P(w)}^{K} \log \sigma\left(-\mathbf{u}_{h k}^{\top} \mathbf{v}_{i t}\right) .\end{aligned}</script><h3 id="å±‚åº-Softmax"><a href="#å±‚åº-Softmax" class="headerlink" title="å±‚åº Softmax"></a>å±‚åº Softmax</h3><p>è¿™ä¸ªä¸œè¥¿ä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘ä¹Ÿä¸å¤ªæƒ³è¦æ·±ç©¶ï¼Œè´´ä¸€ä¸‹å›¾å’Œå…¬å¼</p><p><img src="/archives/736b157a/image-20220409183444554.png" alt="image-20220409183444554" style="zoom:50%;"></p><script type="math/tex; mode=display">P\left(w_{o} \mid w_{c}\right)=\prod_{j=1}^{L\left(w_{o}\right)-1} \sigma\left(\| n\left(w_{o}, j+1\right)\ is \operatorname{leftChild}\left(n\left(w_{o}, j\right)\right)\| \cdot \mathbf{u}_{n\left(w_{o}, j\right)}^{\top} \mathbf{v}_{c}\right)</script><p>ä¾ç„¶è¿˜æ˜¯ä½¿ç”¨ sigmoid å»å»ºæ¨¡æ¦‚ç‡ï¼Œä½†æ˜¯ç¼–ç æ˜¯é‡‡ç”¨äº†ä¸€ä¸ªäºŒåˆ†çš„ç¼–ç æ–¹å¼ï¼Œä¸æ˜ç™½è¿™æ ·ç¼–ç çš„æœ‰æ•ˆæ€§</p><h2 id="é¢„è®­ç»ƒ-word2vec"><a href="#é¢„è®­ç»ƒ-word2vec" class="headerlink" title="é¢„è®­ç»ƒ word2vec"></a>é¢„è®­ç»ƒ word2vec</h2><p>åªè®°å½•è´Ÿé‡‡æ ·çš„è·³å…ƒæ¨¡å‹</p><h3 id="åµŒå…¥å±‚"><a href="#åµŒå…¥å±‚" class="headerlink" title="åµŒå…¥å±‚"></a>åµŒå…¥å±‚</h3><p>åµŒå…¥å±‚å°†è¯å…ƒçš„ç´¢å¼•æ˜ å°„åˆ°å…¶ç‰¹å¾å‘é‡ã€‚è¯¥å±‚çš„æƒé‡æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œå…¶è¡Œæ•°ç­‰äºå­—å…¸å¤§å°ï¼ˆ<code>input_dim</code>ï¼‰ï¼Œåˆ—æ•°ç­‰äºæ¯ä¸ªæ ‡è®°çš„å‘é‡ç»´æ•°ï¼ˆ<code>output_dim</code>ï¼‰ã€‚åœ¨è¯åµŒå…¥æ¨¡å‹è®­ç»ƒä¹‹åï¼Œè¿™ä¸ªæƒé‡å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œ<a href="https://pytorch.org/docs/stable/generated/torch.nn.Embedding.html">nn.Embedding</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">embed <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>num_embeddings<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> embedding_dim<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å‰å‘ä¼ æ’­"><a href="#å‰å‘ä¼ æ’­" class="headerlink" title="å‰å‘ä¼ æ’­"></a>å‰å‘ä¼ æ’­</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">skip_gram</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> contexts_and_negatives<span class="token punctuation">,</span> embed_v<span class="token punctuation">,</span> embed_u<span class="token punctuation">)</span><span class="token punctuation">:</span>    v <span class="token operator">=</span> embed_v<span class="token punctuation">(</span>center<span class="token punctuation">)</span><span class="token comment"># ï¼ˆB, 1, H)</span>    u <span class="token operator">=</span> embed_u<span class="token punctuation">(</span>contexts_and_negatives<span class="token punctuation">)</span><span class="token comment"># (B, M, H)</span>    pred <span class="token operator">=</span> torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># (B, 1, M)</span>    <span class="token keyword">return</span> pred<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä»£ç å°±éå¸¸æ¸…æ™°ï¼Œé¦–å…ˆæœ‰ä¸¤ä¸ª embedding å±‚åˆ†åˆ«å¯¹åº” center embedding å’Œ context embeddingï¼ˆæ˜¯çš„ï¼ŒäºŒè€…æ˜¯ä¸åŒçš„ embeddingï¼Œæˆ‘ä¹‹å‰è®¤ä¸ºä¸€ä¸ªè¯åªæœ‰ä¸€ä¸ª embeddingï¼‰ï¼Œç„¶åä½¿ç”¨æ‰¹é‡çŸ©é˜µä¹˜æ³•è·å¾—æœ€åçš„ç»“æœ</p><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ masked binary cross entropy loss</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SigmoidBCELoss</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># å¸¦æ©ç çš„äºŒå…ƒäº¤å‰ç†µæŸå¤±</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">,</span> target<span class="token punctuation">,</span> mask<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        out <span class="token operator">=</span> nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>binary_cross_entropy_with_logits<span class="token punctuation">(</span>            inputs<span class="token punctuation">,</span> target<span class="token punctuation">,</span> weight<span class="token operator">=</span>mask<span class="token punctuation">,</span> reduction<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> out<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>loss <span class="token operator">=</span> SigmoidBCELoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦ç†è§£è¿™ä¸ªæŸå¤±å‡½æ•°ï¼Œè¦å›ç­”ä¸¤ä¸ªé—®é¢˜ï¼š1. ä¸ºä»€ä¹ˆè¦å¸¦æ©ç ï¼Ÿ2. æŸå¤±å‡½æ•°çš„è¾“å…¥å’Œæ ‡ç­¾æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç¬¬ä¸€ä¸ªé—®é¢˜å¾ˆå¥½å›ç­”ï¼Œå› ä¸ºä¸Šä¸‹æ–‡çš„é•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œéœ€è¦ mask æ‰ padding çš„éƒ¨åˆ†ä¸è®¡ç®—æŸå¤±ã€‚ç¬¬äºŒä¸ªé—®é¢˜å…ˆç»™ç­”æ¡ˆï¼šè¾“å…¥ä¸ºå‰å‘ä¼ æ’­çš„é¢„æµ‹ç»“æœ pred (B, 1, M)ï¼Œè¾“å‡ºæ˜¯æ­£è´Ÿæ ·æœ¬æ ‡ç­¾ (B, 1, M) ä»£è¡¨è¿™ä¸ªè¯æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡çª—å£ä¸­</p><p>è¿™æ ·çš„æ ‡ç­¾æ˜¯éå¸¸åˆç†çš„ï¼Œä½†æ˜¯åœ¨ä¹‹å‰çš„ç¬”è®°ä¸­æåˆ°ï¼šæœ€å¤§åŒ–ä¼¼ç„¶å‡½æ•°ä¸éœ€è¦æ ‡ç­¾ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ä¹‹å‰çš„ MLE å»åšæœ€ä¼˜åŒ–å‘¢ï¼Ÿ<strong>å› ä¸ºåœ¨åˆ†ç±»é—®é¢˜ä¸ŠäºŒè€…æ˜¯ç­‰ä»·çš„</strong>ï¼Œ<a href="https://zhuanlan.zhihu.com/p/165139520">çŸ¥ä¹</a></p><h2 id="GloVe"><a href="#GloVe" class="headerlink" title="GloVe"></a>GloVe</h2><p>æ²¡èƒ½ç†è§£ï¼Œä¸æ‰“ç®—æ·±å…¥å­¦ä¹ ã€‚ä¼¼ä¹è¿™ç§æ–¹æ³•æ˜¯æƒ³è¦å»ºæ¨¡ä¸€ä¸ªä¸‰è¯ä¹‹é—´çš„æ¡ä»¶å…³ç³»ï¼Œè¯¥å»ºæ¨¡å»ºç«‹åœ¨ä¸€ä¸ªå…±ç°çŸ©é˜µä¸Šï¼ˆè¯ j å‡ºç°åœ¨è¯ i ä¸Šä¸‹æ–‡çš„é¢‘ç‡ï¼‰ï¼Œå…±ç°æ¦‚ç‡çš„æ¯”å€¼èƒ½å¤Ÿç›´è§‚åœ°è¡¨è¾¾è¯ä¸è¯ä¹‹é—´çš„å…³ç³»</p><p><img src="/archives/736b157a/image-20220409235231501.png" alt="image-20220409235231501" style="zoom:50%;"></p><h2 id="FastText-å­è¯åµŒå…¥"><a href="#FastText-å­è¯åµŒå…¥" class="headerlink" title="FastText å­è¯åµŒå…¥"></a>FastText å­è¯åµŒå…¥</h2><p>fastText åœ¨ä½¿ç”¨è´Ÿé‡‡æ ·çš„ skip-gram æ¨¡å‹åŸºç¡€ä¸Šï¼Œå°†æ¯ä¸ªä¸­å¿ƒè¯è§†ä¸ºå­è¯ subword çš„é›†åˆï¼Œå¹¶å­¦ä¹ å­è¯çš„è¯å‘é‡ï¼Œç”¨å­è¯è¯å‘é‡çš„å’Œæ¥æ›¿ä»£åŸæ¥ä¸­å¿ƒè¯è¯å‘é‡</p><p>è®©æˆ‘ä»¬æ¥è¯´æ˜å¦‚ä½•ä»¥å•è¯ â€œwhereâ€ ä¸ºä¾‹è·å¾— fastText ä¸­æ¯ä¸ªä¸­å¿ƒè¯çš„å­è¯ã€‚é¦–å…ˆï¼Œåœ¨è¯çš„å¼€å¤´å’Œæœ«å°¾æ·»åŠ ç‰¹æ®Šå­—ç¬¦â€œ&lt;â€å’Œâ€œ&gt;â€ï¼Œä»¥å°†å‰ç¼€å’Œåç¼€ä¸å…¶ä»–å­è¯åŒºåˆ†å¼€æ¥ã€‚ ç„¶åï¼Œä»è¯ä¸­æå–å­—ç¬¦ n-gramã€‚ ä¾‹å¦‚ï¼Œå€¼ n=3 æ—¶ï¼Œæˆ‘ä»¬å°†è·å¾—é•¿åº¦ä¸º3çš„æ‰€æœ‰å­è¯ï¼šâ€œ<whâ€ã€â€œwheâ€ã€â€œherâ€ã€â€œereâ€ã€â€œre>â€å’Œç‰¹æ®Šå­è¯ï¼ˆæ•´è¯ï¼‰â€œ<where>â€</where></whâ€ã€â€œwheâ€ã€â€œherâ€ã€â€œereâ€ã€â€œre></p><p>å‡è®¾ $z_g$ æ˜¯è¯å…¸ä¸­çš„å­è¯ g çš„å‘é‡ï¼Œåˆ™è·³å…ƒæ¨¡å‹ä¸­ä¸­å¿ƒè¯å‘é‡ $v_c$ æˆ‘ä»¬è®¡ç®—ä¸ºå…¶å­è¯å‘é‡çš„å’Œï¼š</p><script type="math/tex; mode=display">\mathbf{v}_{c}=\sum_{g} \mathbf{z}_{g}</script><p>äºæ˜¯ fastText æ¨¡å‹å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">\begin{array}{c}\text{fastText:    }-\log \mathbb{P}\left(w_{o} \mid w_{c}\right)=-\log \frac{1}{1+\exp \left(-\mathbf{u}_{o}^{\top} \sum_{g \in \mathcal{G}_{w_{c}}} \mathbf{z}_{g}\right)}-\sum_{k=1, w_{k} \sim \mathbb{P}(w)}^{K} \log \frac{1}{1+\exp \left(\mathbf{u}_{i_{k}}^{\top} \sum_{g \in \mathcal{G}_{w_{c}}} \mathbf{z}_{g}\right)}\\\text{original:    }-\log \mathbb{P}\left(w_{o} \mid w_{c}\right)=-\log \frac{1}{1+\exp \left(-\mathbf{u}_{o}^{\top} \mathbf{v}_{c}\right)}-\sum_{k=1, w_{k} \sim \mathbb{P}(w)}^{K} \log \frac{1}{1+\exp \left(\mathbf{u}_{i_{k}}^{\top} \mathbf{v}_{c}\right)} \end{array}</script><p>ä»ä¸Šé¢ä¸¤å¼å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°æ”¹åŠ¨çš„åŒºåˆ«ã€‚è¿™æ ·æ”¹åŠ¨çš„æ„ä¹‰åœ¨å“ªé‡Œå‘¢ï¼Ÿæ•™æç®€å•æ€»ç»“ï¼šå­è¯åµŒå…¥å¯ä»¥æé«˜ç¨€æœ‰è¯å’Œè¯å…¸å¤–è¯çš„è¡¨ç¤ºè´¨é‡ã€‚å¯èƒ½å› ä¸ºå®ƒå¯¹è¯çš„å•è¯å†…éƒ¨ä¹Ÿè¿›è¡Œäº†ä¸€å®šçš„å»ºæ¨¡å§ï¼Œè¿™æ ·åšçš„å‡ºå‘ç‚¹ä¹Ÿæ˜¯ç”±äºæŸäº›è¯­è¨€ç‰¹æ€§å¯¼è‡´ï¼Œå› ä¸ºä¸€ä¸ªå•è¯å¾€å¾€å¯ä»¥æ‹†è§£ä¸ºå¤šä¸ªè¯æ ¹</p><h2 id="è¯çš„ç›¸ä¼¼æ€§å’Œç±»æ¯”ä»»åŠ¡"><a href="#è¯çš„ç›¸ä¼¼æ€§å’Œç±»æ¯”ä»»åŠ¡" class="headerlink" title="è¯çš„ç›¸ä¼¼æ€§å’Œç±»æ¯”ä»»åŠ¡"></a>è¯çš„ç›¸ä¼¼æ€§å’Œç±»æ¯”ä»»åŠ¡</h2><p>æœ¬æ¥æƒ³è·³è¿‡è¿™ä¸€èŠ‚çš„ï¼Œè¿˜æ˜¯æŠŠæ•™æé‡Œçš„å°ç»“è´´ä¸€ä¸‹å§ï¼Œæœ‰ä¸ªæ¦‚å¿µï¼š</p><ul><li>åœ¨å®è·µä¸­ï¼Œåœ¨å¤§å‹è¯­æ–™åº“ä¸Šé¢„å…ˆç»ƒçš„è¯å‘é‡å¯ä»¥åº”ç”¨äºä¸‹æ¸¸çš„è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡</li><li>é¢„è®­ç»ƒçš„è¯å‘é‡å¯ä»¥åº”ç”¨äºè¯çš„ç›¸ä¼¼æ€§å’Œç±»æ¯”ä»»åŠ¡</li></ul><h2 id="BERT"><a href="#BERT" class="headerlink" title="BERT"></a>BERT</h2><p>ç»ˆäºæ¥åˆ°è‡ªå·±æœ€æƒ³è¦äº†è§£çš„éƒ¨åˆ†äº†ğŸ˜ä¸»è¦å‚è€ƒå®˜æ–¹è§†é¢‘ <a href="https://www.bilibili.com/video/BV1yU4y1E7Ns?p=1">bilibili</a>ï¼Œå› ä¸ºæƒ³æ›´å¥½çš„äº†è§£æ¨¡å‹çš„å†…åœ¨é€»è¾‘</p><h3 id="NLP-é‡Œçš„è¿ç§»å­¦ä¹ "><a href="#NLP-é‡Œçš„è¿ç§»å­¦ä¹ " class="headerlink" title="NLP é‡Œçš„è¿ç§»å­¦ä¹ "></a>NLP é‡Œçš„è¿ç§»å­¦ä¹ </h3><p>word2vec æ¨¡å‹çš„ç¼ºç‚¹ï¼š<strong>å¿½ç•¥äº†éƒ¨åˆ†æ—¶åºä¿¡æ¯ï¼Œæ˜¯ä¸€ç§é™æ€çš„è¡¨å¾</strong>ã€‚ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šå¦‚æ°´æœä¸­çš„â€œè‹¹æœâ€å’Œè‹¹æœå…¬å¸çš„â€œè‹¹æœâ€ï¼Œåœ¨ word2vec æ¨¡å‹ä¸­è¯å‘é‡è¡¨ç¤ºæ˜¯ä¸€æ ·çš„ï¼Œè€Œå®é™…ä¸Šè¿™ä¸¤è¯çš„æ„æ€å®Œå…¨ä¸ä¸€æ ·</p><p>BERT çš„åŠ¨æœºä¹‹ä¸€ï¼šå¸Œæœ›é€šè¿‡å¾®è°ƒæ¥åšä¸‹æ¸¸ä»»åŠ¡ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªé¢„è®­ç»ƒå¥½çš„ï¼ˆ<strong>å¤§</strong>ï¼‰æ¨¡å‹ï¼Œè¯¥æ¨¡å‹èƒ½æå–å‡ºè¶³å¤Ÿå¥½çš„åµŒå…¥ç‰¹å¾ï¼Œç„¶åç›´æ¥æ‹¿è¿™äº›ç‰¹å¾é€šè¿‡ä¸€ä¸ªç®€å•çš„è§£ç å™¨ï¼ˆMLPï¼‰å®Œæˆä¸‹æ¸¸ä»»åŠ¡ï¼ˆå½“ç„¶è¿˜æœ‰å¾®è°ƒçš„è¿‡ç¨‹ï¼‰</p><h3 id="BERT-æ¶æ„"><a href="#BERT-æ¶æ„" class="headerlink" title="BERT æ¶æ„"></a>BERT æ¶æ„</h3><p><strong>ç®€å•æ¦‚æ‹¬ï¼šåªæœ‰ç¼–ç å™¨çš„ transformer</strong></p><p>BERT è®ºæ–‡ä½¿ç”¨äº†ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸‹é¢æ˜¯ä¸€äº›å‚æ•°ç»†èŠ‚ï¼š</p><ol><li>Base: # blocks = 12, hidden size = 768, # heads = 12, # parameters = 110M</li><li>Large: # blocks = 12, hidden size = 1024, # heads = 16. # parameters = 340M</li></ol><h3 id="BERT-è¾“å…¥"><a href="#BERT-è¾“å…¥" class="headerlink" title="BERT è¾“å…¥"></a>BERT è¾“å…¥</h3><ol><li>æ¯ä¸ªæ ·æœ¬æ˜¯ä¸€ä¸ªå¥å­å¯¹</li><li>åŠ å…¥é¢å¤–çš„ç‰‡æ®µåµŒå…¥ã€‚ä»£è¡¨æ˜¯ç¬¬ä¸€ä¸ªå¥å­ï¼Œè¿˜æ˜¯ç¬¬äºŒä¸ªå¥å­</li><li>ä½ç½®ç¼–ç å¯å­¦ä¹ </li></ol><p><img src="/archives/736b157a/image-20220410152406518.png" alt="image-20220410152406518" style="zoom:50%;"></p><p>ä¸Šä»£ç ï¼æ¸…æ™°å¾—ä¸€æ‰¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">def</span> <span class="token function">get_tokens_and_segments</span><span class="token punctuation">(</span>tokens_a<span class="token punctuation">,</span> tokens_b<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""è·å–è¾“å…¥åºåˆ—çš„è¯å…ƒåŠå…¶ç‰‡æ®µç´¢å¼•"""</span>    tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;cls&gt;'</span><span class="token punctuation">]</span> <span class="token operator">+</span> tokens_a <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'&lt;sep&gt;'</span><span class="token punctuation">]</span>    <span class="token comment"># 0å’Œ1åˆ†åˆ«æ ‡è®°ç‰‡æ®µAå’ŒB</span>    segments <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>tokens_a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> tokens_b <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        tokens <span class="token operator">+=</span> tokens_b <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'&lt;sep&gt;'</span><span class="token punctuation">]</span>        segments <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>tokens_b<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> tokens<span class="token punctuation">,</span> segments<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢è¿™æ®µä»£ç æ˜¯å…ˆå¤„ç†çš„æ–‡æœ¬ï¼š1. åŠ å…¥ç‰¹æ®Šè¯å…ƒï¼ˆä¸åŒ…å« <mask> è¯å…ƒï¼‰ï¼›2. åˆ›å»ºæ®µä¿¡æ¯</mask></p><p>ä¹‹åç›´æ¥ä½¿ç”¨ nn.Embeddingï¼Œå°†è¾“å…¥åµŒå…¥åˆ°ç›¸åŒçš„ç»´åº¦ä¸Š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">BERTEncoder</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""BERTç¼–ç å™¨"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> norm_shape<span class="token punctuation">,</span> ffn_num_input<span class="token punctuation">,</span>                 ffn_num_hiddens<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span>                 max_len<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> key_size<span class="token operator">=</span><span class="token number">768</span><span class="token punctuation">,</span> query_size<span class="token operator">=</span><span class="token number">768</span><span class="token punctuation">,</span> value_size<span class="token operator">=</span><span class="token number">768</span><span class="token punctuation">,</span>                 <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>BERTEncoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>token_embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>segment_embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>blks <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_layers<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>blks<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>EncoderBlock<span class="token punctuation">(</span><span class="token comment"># transformer block</span>                key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> norm_shape<span class="token punctuation">,</span>                ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># åœ¨BERTä¸­ï¼Œä½ç½®åµŒå…¥æ˜¯å¯å­¦ä¹ çš„ï¼Œå› æ­¤æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¶³å¤Ÿé•¿çš„ä½ç½®åµŒå…¥å‚æ•°</span>        <span class="token comment"># å¹¶ä¸”ä¸éœ€è¦ batch ç»´åº¦, å› ä¸ºæ¯ä¸ª sample çš„ä½ç½®ä¿¡æ¯ç¼–ç éƒ½åº”è¯¥ä¸€æ ·</span>        self<span class="token punctuation">.</span>pos_embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_len<span class="token punctuation">,</span>                                                      num_hiddens<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tokens<span class="token punctuation">,</span> segments<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># åœ¨ä»¥ä¸‹ä»£ç æ®µä¸­ï¼ŒXçš„å½¢çŠ¶ä¿æŒä¸å˜ï¼šï¼ˆæ‰¹é‡å¤§å°ï¼Œæœ€å¤§åºåˆ—é•¿åº¦ï¼Œnum_hiddensï¼‰</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>token_embedding<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>segment_embedding<span class="token punctuation">(</span>segments<span class="token punctuation">)</span>        X <span class="token operator">=</span> X <span class="token operator">+</span> self<span class="token punctuation">.</span>pos_embedding<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> blk <span class="token keyword">in</span> self<span class="token punctuation">.</span>blks<span class="token punctuation">:</span>            X <span class="token operator">=</span> blk<span class="token punctuation">(</span>X<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span>        <span class="token keyword">return</span> X<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="BERT-é¢„è®­ç»ƒä»»åŠ¡"><a href="#BERT-é¢„è®­ç»ƒä»»åŠ¡" class="headerlink" title="BERT é¢„è®­ç»ƒä»»åŠ¡"></a>BERT é¢„è®­ç»ƒä»»åŠ¡</h3><h4 id="å¸¦æ©ç çš„è¯­è¨€æ¨¡å‹"><a href="#å¸¦æ©ç çš„è¯­è¨€æ¨¡å‹" class="headerlink" title="å¸¦æ©ç çš„è¯­è¨€æ¨¡å‹"></a>å¸¦æ©ç çš„è¯­è¨€æ¨¡å‹</h4><p>å¸¦æ©ç çš„è¯­è¨€æ¨¡å‹æ¯æ¬¡éšæœºï¼ˆ15%æ¦‚ç‡ï¼‰å°†ä¸€äº›è¯å…ƒæ¢æˆ <mask> tokenã€‚ä½†å› ä¸ºå¾®è°ƒä»»åŠ¡ä¸­ä¸å‡ºç° <mask> æ‰€ä»¥å¯¹äº <mask> æœ‰é¢å¤–å¤„ç†ï¼š</mask></mask></mask></p><ol><li>80% æ¦‚ç‡ä¸‹ï¼Œä¿æŒ <mask> token</mask></li><li>10% æ¦‚ç‡ä¸‹ï¼Œéšæœºæ¢æˆå…¶ä»– token</li><li>10% æ¦‚ç‡ä¸‹ï¼Œä¿æŒåŸæœ‰ token</li></ol><h4 id="ä¸‹ä¸€å¥å­é¢„æµ‹"><a href="#ä¸‹ä¸€å¥å­é¢„æµ‹" class="headerlink" title="ä¸‹ä¸€å¥å­é¢„æµ‹"></a>ä¸‹ä¸€å¥å­é¢„æµ‹</h4><p>é¢„æµ‹ä¸€ä¸ªå¥å­å¯¹ä¸­ä¸¤ä¸ªå¥å­æ˜¯ä¸æ˜¯ç›¸é‚»çš„ã€‚åœ¨è®­ç»ƒæ ·æœ¬ä¸­ï¼š50% æ¦‚ç‡å…ˆæ‹©ç›¸é‚»å¥å­å¯¹ï¼Œ50% æ¦‚ç‡é€‰æ‹©éšæœºå¥å­å¯¹ã€‚å¹¶å°† <cls> å¯¹åº”çš„è¾“å‡ºæ”¾åˆ°ä¸€ä¸ªå…¨è¿æ¥å±‚æ¥åšé¢„æµ‹</cls></p><p>è¡¥å……ï¼š</p><ol><li>ä¸å¿…è¿‡äºçº ç»“ BERT ä¸­çš„ B -&gt; bidirectionalï¼Œè¿™å…¶å®æ˜¯ transformer è‡ªå¸¦çš„å±æ€§ï¼Œç›´ç™½çš„æ¥è®²è¿™ä¸ª bidirectional æ›´åƒæ˜¯æŒ‡ä»£ä¸€ç§å…¨å±€èƒ½åŠ›</li><li>æ²ç¥æåˆ°ï¼Œä»–ä»¬å°† BERT çš„ä»£ç åˆ†ä¸ºäº†ï¼š<strong>æ•°æ®ï¼Œæ¨¡å‹ï¼Œè®­ç»ƒ</strong>ä¸‰éƒ¨åˆ†ã€‚è¿™ä¸ªèŒƒå¼åº”è¯¥è¦ç‰¢è®°ï¼</li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 13 è®¡ç®—æœºè§†è§‰</title>
      <link href="/archives/15b3ab53.html"/>
      <url>/archives/15b3ab53.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-13-è®¡ç®—æœºè§†è§‰"><a href="#D2L-13-è®¡ç®—æœºè§†è§‰" class="headerlink" title="D2L 13 è®¡ç®—æœºè§†è§‰"></a>D2L 13 è®¡ç®—æœºè§†è§‰</h1><p>å› ä¸ºå¯¹äºè®¡ç®—æœºè§†è§‰å·²ç»æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼ˆä¸»è¦æ˜¯é€šè¿‡çœ‹è®ºæ–‡äº†è§£çš„ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸€ç« èŠ‚ä¹Ÿæ˜¯ç®€å•æ•´ç†</p><h2 id="å›¾åƒå¢å¹¿"><a href="#å›¾åƒå¢å¹¿" class="headerlink" title="å›¾åƒå¢å¹¿"></a>å›¾åƒå¢å¹¿</h2><p>éšæœºæ”¹å˜è®­ç»ƒæ ·æœ¬å¯ä»¥å‡å°‘æ¨¡å‹å¯¹æŸäº›å±æ€§çš„ä¾èµ–ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›</p><p>ä¸ºäº†åœ¨é¢„æµ‹è¿‡ç¨‹ä¸­å¾—åˆ°ç¡®åˆ‡çš„ç»“æœï¼Œæˆ‘ä»¬é€šå¸¸å¯¹è®­ç»ƒæ ·æœ¬åªè¿›è¡Œå›¾åƒå¢å¹¿ï¼Œè€Œåœ¨é¢„æµ‹è¿‡ç¨‹ä¸­ä¸ä½¿ç”¨å¸¦éšæœºæ“ä½œçš„å›¾åƒå¢å¹¿</p><h3 id="å¸¸ç”¨çš„å›¾åƒå¢å¹¿æ–¹æ³•"><a href="#å¸¸ç”¨çš„å›¾åƒå¢å¹¿æ–¹æ³•" class="headerlink" title="å¸¸ç”¨çš„å›¾åƒå¢å¹¿æ–¹æ³•"></a>å¸¸ç”¨çš„å›¾åƒå¢å¹¿æ–¹æ³•</h3><p>é€šå¸¸å¯ä»¥ä½¿ç”¨ <code>torchvision.transforms</code> ä¸­çš„æ–¹æ³•è¿›è¡Œæ“ä½œã€‚è¿™é‡Œæš‚æ—¶ä¸æ•´ç†</p><ol><li>ç¿»è½¬å’Œå‰ªè£</li><li>æ”¹å˜é¢œè‰²</li><li>æ··åˆå¢å¹¿æ–¹æ³•</li></ol><h2 id="å¾®è°ƒï¼ˆè¿ç§»å­¦ä¹ ï¼‰"><a href="#å¾®è°ƒï¼ˆè¿ç§»å­¦ä¹ ï¼‰" class="headerlink" title="å¾®è°ƒï¼ˆè¿ç§»å­¦ä¹ ï¼‰"></a>å¾®è°ƒï¼ˆè¿ç§»å­¦ä¹ ï¼‰</h2><p>ç”±äºè®­ç»ƒæ ·æœ¬æ•°é‡æœ‰é™ï¼Œè®­ç»ƒæ¨¡å‹çš„å‡†ç¡®æ€§å¯èƒ½æ— æ³•æ»¡è¶³å®é™…è¦æ±‚ï¼Œä¾‹å¦‚ï¼šä¼šäº§ç”Ÿè¿‡æ‹Ÿåˆçš„ç°è±¡</p><p>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åº”ç”¨è¿ç§»å­¦ä¹ ï¼ˆtransfer learningï¼‰å°†ä»<em>æºæ•°æ®é›†</em>å­¦åˆ°çš„çŸ¥è¯†è¿ç§»åˆ°<em>ç›®æ ‡æ•°æ®é›†</em>ã€‚ ä¾‹å¦‚ï¼Œå°½ç®¡ ImageNet æ•°æ®é›†ä¸­çš„å¤§å¤šæ•°å›¾åƒä¸æ¤…å­æ— å…³ï¼Œä½†åœ¨æ­¤æ•°æ®é›†ä¸Šè®­ç»ƒçš„æ¨¡å‹å¯èƒ½ä¼šæå–æ›´é€šç”¨çš„å›¾åƒç‰¹å¾ï¼Œè¿™æœ‰åŠ©äºè¯†åˆ«è¾¹ç¼˜ã€çº¹ç†ã€å½¢çŠ¶å’Œå¯¹è±¡ç»„åˆã€‚ è¿™äº›ç±»ä¼¼çš„ç‰¹å¾ä¹Ÿå¯èƒ½æœ‰æ•ˆåœ°è¯†åˆ«æ¤…å­</p><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>åœ¨æºæ•°æ®é›†ï¼ˆä¾‹å¦‚ ImageNet æ•°æ®é›†ï¼‰ä¸Šé¢„è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œå³ç›®æ ‡æ¨¡å‹ã€‚å¤åˆ¶æºæ¨¡å‹ä¸Šçš„æ‰€æœ‰æ¨¡å‹è®¾è®¡åŠå…¶å‚æ•°ï¼ˆè¾“å‡ºå±‚é™¤å¤–ï¼‰</li><li>å‘ç›®æ ‡æ¨¡å‹æ·»åŠ è¾“å‡ºå±‚ï¼Œå…¶è¾“å‡ºæ•°æ˜¯ç›®æ ‡æ•°æ®é›†ä¸­çš„ç±»åˆ«æ•°ã€‚ç„¶åéšæœºåˆå§‹åŒ–è¯¥å±‚çš„æ¨¡å‹å‚æ•°</li><li>åœ¨ç›®æ ‡æ•°æ®é›†ï¼ˆå¦‚æ¤…å­æ•°æ®é›†ï¼‰ä¸Šè®­ç»ƒç›®æ ‡æ¨¡å‹ã€‚è¾“å‡ºå±‚å°†ä»å¤´å¼€å§‹è¿›è¡Œè®­ç»ƒï¼Œè€Œæ‰€æœ‰å…¶ä»–å±‚çš„å‚æ•°å°†æ ¹æ®æºæ¨¡å‹çš„å‚æ•°è¿›è¡Œå¾®è°ƒ</li></ol><p>ä¸‹é¢è´´ä¸€ä¸‹è½½å…¥æ¨¡å‹å’Œæ›´æ”¹å‚æ•°çš„ç®€å•ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python">finetune_net <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>models<span class="token punctuation">.</span>resnet18<span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>finetune_net<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>finetune_net<span class="token punctuation">.</span>fc<span class="token punctuation">.</span>in_features<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>xavier_uniform_<span class="token punctuation">(</span>finetune_net<span class="token punctuation">.</span>fc<span class="token punctuation">.</span>weight<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>é€šå¸¸ï¼Œå¾®è°ƒå‚æ•°ä½¿ç”¨è¾ƒå°çš„å­¦ä¹ ç‡ï¼Œè€Œä»å¤´å¼€å§‹è®­ç»ƒè¾“å‡ºå±‚å¯ä»¥ä½¿ç”¨æ›´å¤§çš„å­¦ä¹ ç‡</strong></p><h2 id="ç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†"><a href="#ç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†" class="headerlink" title="ç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†"></a>ç›®æ ‡æ£€æµ‹å’Œè¾¹ç•Œæ¡†</h2><p>ç›®æ ‡æ£€æµ‹ä¸ä»…å¯ä»¥è¯†åˆ«å›¾åƒä¸­æ‰€æœ‰æ„Ÿå…´è¶£çš„ç‰©ä½“ï¼Œè¿˜èƒ½è¯†åˆ«å®ƒä»¬çš„ä½ç½®ï¼Œè¯¥ä½ç½®é€šå¸¸ç”±çŸ©å½¢è¾¹ç•Œæ¡†è¡¨ç¤º</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ç§å¸¸ç”¨çš„è¾¹ç•Œæ¡†è¡¨ç¤ºï¼ˆä¸­é—´ï¼Œå®½åº¦ï¼Œé«˜åº¦ï¼‰å’Œï¼ˆå·¦ä¸Šï¼Œå³ä¸‹ï¼‰åæ ‡ä¹‹é—´è¿›è¡Œè½¬æ¢</p><h2 id="é”šæ¡†"><a href="#é”šæ¡†" class="headerlink" title="é”šæ¡†"></a>é”šæ¡†</h2><p>ç›®æ ‡æ£€æµ‹ç®—æ³•é€šå¸¸ä¼šåœ¨è¾“å…¥å›¾åƒä¸­é‡‡æ ·å¤§é‡çš„åŒºåŸŸï¼Œç„¶ååˆ¤æ–­è¿™äº›åŒºåŸŸä¸­æ˜¯å¦åŒ…å«æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç›®æ ‡ï¼Œå¹¶è°ƒæ•´åŒºåŸŸè¾¹ç•Œä»è€Œæ›´å‡†ç¡®åœ°é¢„æµ‹ç›®æ ‡çš„çœŸå®è¾¹ç•Œæ¡†ï¼ˆground-truth bounding boxï¼‰</p><p>æˆ‘ä»¬ä»‹ç»å…¶ä¸­çš„ä¸€ç§æ–¹æ³•ï¼šä»¥æ¯ä¸ªåƒç´ ä¸ºä¸­å¿ƒï¼Œç”Ÿæˆå¤šä¸ªç¼©æ”¾æ¯”å’Œå®½é«˜æ¯”ï¼ˆaspect ratioï¼‰ä¸åŒçš„è¾¹ç•Œæ¡†ã€‚ è¿™äº›è¾¹ç•Œæ¡†è¢«ç§°ä¸ºé”šæ¡†ï¼ˆanchor boxï¼‰</p><h3 id="æ ‡æ³¨é”šæ¡†"><a href="#æ ‡æ³¨é”šæ¡†" class="headerlink" title="æ ‡æ³¨é”šæ¡†"></a>æ ‡æ³¨é”šæ¡†</h3><p>åœ¨è®­ç»ƒé›†ä¸­ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªé”šæ¡†è§†ä¸ºä¸€ä¸ªè®­ç»ƒæ ·æœ¬ã€‚ ä¸ºäº†è®­ç»ƒç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦æ¯ä¸ªé”šæ¡†çš„ç±»åˆ«ï¼ˆclassï¼‰å’Œåç§»é‡ï¼ˆoffsetï¼‰ä½œä¸ºæ ‡ç­¾ã€‚å‰è€…æ˜¯ä¸é”šæ¡†ç›¸å…³çš„å¯¹è±¡çš„ç±»åˆ«ï¼Œåè€…æ˜¯çœŸå®è¾¹ç•Œæ¡†ç›¸å¯¹äºé”šæ¡†çš„åç§»é‡</p><p>ä¸ºäº†æ ‡æ³¨é”šæ¡†ï¼Œè‡ªç„¶å°±éœ€è¦çŸ¥é“é”šæ¡†ä¸å“ªä¸ª ground truth ç›¸å…³ã€‚è¿™å°±éœ€è¦å°† ground truth åˆ†é…ç»™é”šæ¡†ã€‚æ•™æç»™å‡ºäº†ä¸€ä¸ªæ–¹æ³•ï¼Œä½†ä¼¼ä¹ä¸æˆ‘äº†è§£çš„æ–¹æ³•ä¸å¤ªç¬¦åˆ</p><p>æˆ‘æ‰€äº†è§£çš„æ–¹æ³•ï¼šæœ€ç»ˆçš„ç›®çš„æ˜¯è¦å¾—åˆ°<strong>æ­£è´Ÿé”šæ¡†æ ·æœ¬</strong>ï¼Œä¹Ÿå°±æ˜¯çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¥½çš„é”šæ¡†ï¼Œè¿˜æ˜¯ä¸€ä¸ªåçš„é”šæ¡†ã€‚è¯„ä»·æ ‡æ³¨å°±æ˜¯é”šæ¡†ä¸ ground truth çš„ iou<br>å¦‚æœ iou &gt; thresh åˆ™æ˜¯æ­£æ ·æœ¬ï¼Œè‹¥ iou &lt; thresh åˆ™æ˜¯è´Ÿæ ·æœ¬ï¼ˆæ­£è´Ÿæ ·æœ¬çš„ thresh ä¹Ÿå¯ä»¥ä¸åŒï¼‰ã€‚æœ‰äº†æ­£è´Ÿæ ·æœ¬å°±å¯ä»¥è¿›è¡ŒäºŒå…ƒäº¤å‰ç†µè®¡ç®—åˆ†ç±»æŸå¤±äº†ï¼ˆå…¶å®åªæœ‰æ­£æ ·æœ¬ä¹Ÿèƒ½è¡Œï¼Œä½†æ˜¯åŠ å…¥è´Ÿæ ·æœ¬èƒ½å¤Ÿæœ‰æ›´å¼ºçš„ç›‘ç£ä¿¡å·ï¼‰</p><p>å¯¹äºå›å½’æŸå¤±é€šå¸¸åªå¯¹æ­£æ ·æœ¬è¿›è¡Œè®¡ç®—ï¼Œä¸ªäººè®¤ä¸ºæ˜¯ä¸ºäº†ä¿æŒæ¨¡å‹çš„ç¨³å®šï¼Œåœ¨è®­ç»ƒåˆæœŸè´Ÿæ ·æœ¬çš„å›å½’æŸå¤±ä¼šå¾ˆå¤§ã€‚æ ·æœ¬æ ‡ç­¾æ˜¯é”šæ¡†å’Œ ground truth çš„æ®‹å·®</p><h3 id="NMS"><a href="#NMS" class="headerlink" title="NMS"></a>NMS</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹æ³•ï¼å¼ºçƒˆå»ºè®®è‡ªå·±å†™ä¸€å†™ï¼Œé¢è¯•å¸¸è€ƒï¼å…¶ç›®çš„æ˜¯ä¸ºäº†åœ¨ä¼—å¤šé¢„æµ‹é€‰æ¡†ä¸­å»é™¤é‡å¤é€‰æ¡†ï¼Œç­›é€‰è·å¾—è´¨é‡é«˜çš„é€‰æ¡†ã€‚è´´ä¸€ä¸ªæˆ‘è‡ªå·±å†™çš„ç‰ˆæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">nms</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> thresh<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Pure Python NMS baseline."""</span>    data <span class="token operator">=</span> data<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    x1 <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>    y1 <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>    x2 <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>    y2 <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>    areas <span class="token operator">=</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span>    index <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># é‡ç‚¹ï¼Œä½¿ç”¨ index ä¿å­˜ä»éœ€è¦è®¡ç®—çš„ boxes</span>    keep <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">while</span> index<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>        i <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        keep<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        xx1 <span class="token operator">=</span> np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span>x1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> x1<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># ä»…è®¡ç®— index ä¸­çš„ boxes</span>        yy1 <span class="token operator">=</span> np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span>y1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> y1<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>        xx2 <span class="token operator">=</span> np<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>x2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> x2<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>        yy2 <span class="token operator">=</span> np<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>y2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> y2<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>        w <span class="token operator">=</span> np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> xx2 <span class="token operator">-</span> xx1<span class="token punctuation">)</span>        h <span class="token operator">=</span> np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> yy2 <span class="token operator">-</span> yy1<span class="token punctuation">)</span>        inter <span class="token operator">=</span> w <span class="token operator">*</span> h        ovr <span class="token operator">=</span> inter <span class="token operator">/</span> <span class="token punctuation">(</span>areas<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> areas<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">-</span> inter<span class="token punctuation">)</span>        index <span class="token operator">=</span> index<span class="token punctuation">[</span>ovr <span class="token operator">&lt;</span> thresh<span class="token punctuation">]</span>    <span class="token keyword">return</span> np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>keep<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹"><a href="#å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹" class="headerlink" title="å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹"></a>å¤šå°ºåº¦ç›®æ ‡æ£€æµ‹</h2><ul><li>åœ¨å¤šä¸ªå°ºåº¦ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥<strong>ç”Ÿæˆä¸åŒå°ºå¯¸çš„é”šæ¡†</strong>æ¥æ£€æµ‹ä¸åŒå°ºå¯¸çš„ç›®æ ‡</li><li>é€šè¿‡å®šä¹‰ç‰¹å¾å›¾çš„å½¢çŠ¶ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥å†³å®šä»»ä½•å›¾åƒä¸Šå‡åŒ€é‡‡æ ·çš„é”šæ¡†çš„ä¸­å¿ƒ</strong></li></ul><h2 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h2><p>æˆ‘ä»¬å¯ä»¥è®¾è®¡åŸºç¡€ç½‘ç»œï¼Œä½¿å®ƒè¾“å‡ºçš„é«˜å’Œå®½è¾ƒå¤§ã€‚ è¿™æ ·ä¸€æ¥ï¼ŒåŸºäºè¯¥ç‰¹å¾å›¾ç”Ÿæˆçš„é”šæ¡†æ•°é‡è¾ƒå¤šï¼Œå¯ä»¥ç”¨æ¥æ£€æµ‹å°ºå¯¸è¾ƒå°çš„ç›®æ ‡ã€‚ æ¥ä¸‹æ¥çš„æ¯ä¸ªå¤šå°ºåº¦ç‰¹å¾å—å°†ä¸Šä¸€å±‚æä¾›çš„ç‰¹å¾å›¾çš„é«˜å’Œå®½ç¼©å°ï¼ˆå¦‚å‡åŠï¼‰ï¼Œå¹¶ä½¿ç‰¹å¾å›¾ä¸­æ¯ä¸ªå•å…ƒåœ¨è¾“å…¥å›¾åƒä¸Šçš„æ„Ÿå—é‡å˜å¾—æ›´å¹¿é˜”</p><p><img src="/archives/15b3ab53/image-20220324202819029.png" alt="image-20220324202819029" style="zoom:50%;"></p><p>å‡ ä¸ªç‚¹ï¼š</p><ol><li>å¤šå°ºåº¦ç‰¹å¾å—çš„åˆ†è¾¨ç‡é€šå¸¸æ˜¯é€æ¸é™ä½çš„</li><li>éœ€è¦å°†æ‰€æœ‰é¢„æµ‹çš„ç»“æœ concat èµ·æ¥</li><li>åˆ†ç±»æŸå¤±ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼›è¾¹ç•Œæ¡†é¢„æµ‹ä½¿ç”¨ L1 æŸå¤±å‡½æ•°</li></ol><h2 id="R-CNN"><a href="#R-CNN" class="headerlink" title="R-CNN"></a>R-CNN</h2><p>å…·ä½“æ¥è¯´ï¼Œï¼ˆæœ€åŸå§‹çš„ï¼‰R-CNN åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ol><li>å¯¹è¾“å…¥å›¾åƒä½¿ç”¨é€‰æ‹©æ€§æœç´¢æ¥é€‰å–å¤šä¸ªé«˜è´¨é‡çš„æè®®åŒºåŸŸï¼ˆproposalï¼‰ï¼ˆé”šæ¡†ä¹Ÿæ˜¯ä¸€ç§é€‰å–æ–¹æ³•ï¼‰</li><li>å°†æ¯ä¸ªæè®®åŒºåŸŸå˜å½¢ä¸ºç½‘ç»œéœ€è¦çš„è¾“å…¥å°ºå¯¸ï¼Œå¹¶é€šè¿‡ CNN æè®®åŒºåŸŸç‰¹å¾</li><li>ä½¿ç”¨æ¯ä¸ª proposal çš„ç‰¹å¾é¢„æµ‹æ¯ä¸ª proposal çš„ç±»åˆ«å’Œè¾¹ç•Œæ¡†</li></ol><p><strong>ç¼ºç‚¹ï¼šå®ƒçš„é€Ÿåº¦å¾ˆæ…¢ã€‚</strong> æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä»ä¸€å¼ å›¾åƒä¸­é€‰å‡ºä¸Šåƒä¸ªæè®®åŒºåŸŸï¼Œè¿™éœ€è¦ä¸Šåƒæ¬¡çš„å·ç§¯ç¥ç»ç½‘ç»œçš„å‰å‘ä¼ æ’­æ¥æ‰§è¡Œç›®æ ‡æ£€æµ‹</p><h3 id="Fast-R-CNN"><a href="#Fast-R-CNN" class="headerlink" title="Fast R-CNN"></a>Fast R-CNN</h3><p>R-CNNçš„ä¸»è¦æ€§èƒ½ç“¶é¢ˆåœ¨äºï¼Œå¯¹æ¯ä¸ªæè®®åŒºåŸŸï¼Œå·ç§¯ç¥ç»ç½‘ç»œçš„å‰å‘ä¼ æ’­æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œæ²¡æœ‰å…±äº«è®¡ç®—ã€‚ ç”±äºè¿™äº›åŒºåŸŸé€šå¸¸æœ‰é‡å ï¼Œç‹¬ç«‹çš„ç‰¹å¾æŠ½å–ä¼šå¯¼è‡´é‡å¤çš„è®¡ç®—</p><p> Fast R-CNN å¯¹ R-CNN çš„ä¸»è¦æ”¹è¿›ä¹‹ä¸€ï¼Œæ˜¯<strong>ä»…åœ¨æ•´å¼ å›¾è±¡ä¸Šæ‰§è¡Œå·ç§¯ç¥ç»ç½‘ç»œçš„å‰å‘ä¼ æ’­</strong>ï¼Œå¹¶æå‡ºäº† Region of Interest Pooling (roi pooling) å¯ä»å½¢çŠ¶å„å¼‚çš„å…´è¶£åŒºåŸŸä¸­å‡æŠ½å–å‡ºå½¢çŠ¶ç›¸åŒçš„ç‰¹å¾</p><p><img src="/archives/15b3ab53/image-20220325192949807.png" alt="image-20220325192949807" style="zoom:50%;"></p><h3 id="Faster-R-CNN"><a href="#Faster-R-CNN" class="headerlink" title="Faster R-CNN"></a>Faster R-CNN</h3><p>Fast R-CNNæ¨¡å‹é€šå¸¸éœ€è¦åœ¨é€‰æ‹©æ€§æœç´¢ä¸­ç”Ÿæˆå¤§é‡çš„æè®®åŒºåŸŸï¼Œä¸ªäººç†è§£æ˜¯ï¼šFast R-CNN æ˜¯ç›´æ¥æŠŠé”šæ¡†ä½œä¸º roiï¼Ÿé”šæ¡†çš„æ•°é‡çº§æ˜¯è¾ƒå¤§çš„ï¼Œå¯¹æ¯ä¸€ä¸ªé”šæ¡†éƒ½è¦è¿›è¡Œ roi pooling å¹¶è¿›è¡Œé¢„æµ‹çš„è®¡ç®—é‡å°†å¾ˆå¤§ã€‚Faster R-CNN æå‡ºå°†é€‰æ‹©æ€§æœç´¢æ›¿æ¢ä¸ºåŒºåŸŸæè®®ç½‘ç»œï¼ˆregion proposal networkï¼‰ï¼Œä»è€Œå‡å°‘æè®®åŒºåŸŸçš„ç”Ÿæˆæ•°é‡ã€‚<strong>æ›´å…·ä½“çš„å†…å®¹å¼ºçƒˆå»ºè®®é˜…è¯» Faster R-CNN çš„è®ºæ–‡æˆ–è€…ç›¸å…³åšå®¢</strong></p><h3 id="Mask-R-CNN"><a href="#Mask-R-CNN" class="headerlink" title="Mask R-CNN"></a>Mask R-CNN</h3><p>Mask R-CNN æ˜¯åŸºäº Faster R-CNN ä¿®æ”¹è€Œæ¥çš„ã€‚ å…·ä½“æ¥è¯´ï¼ŒMask R-CNN å°† roi pooling æ›¿æ¢ä¸ºäº† roi alignï¼Œä½¿ç”¨åŒçº¿æ€§æ’å€¼ï¼ˆbilinear interpolationï¼‰æ¥ä¿ç•™ç‰¹å¾å›¾ä¸Šçš„ç©ºé—´ä¿¡æ¯ï¼Œä»è€Œæ›´é€‚äºåƒç´ çº§é¢„æµ‹ï¼Œè¿™å°±å±äºè¯­ä¹‰åˆ†å‰²çš„èŒƒå›´äº†ï¼Œæ¥ä¸‹æ¥å°±ä»‹ç»ä¸€äº›è¯­ä¹‰åˆ†å‰²å¸¸ç”¨çš„ç»“æ„</p><h2 id="è½¬ç½®å·ç§¯ä¸å…¨å·ç§¯"><a href="#è½¬ç½®å·ç§¯ä¸å…¨å·ç§¯" class="headerlink" title="è½¬ç½®å·ç§¯ä¸å…¨å·ç§¯"></a>è½¬ç½®å·ç§¯ä¸å…¨å·ç§¯</h2><p>å·ç§¯å±‚é€šå¸¸ä¼šå‡å°‘ä¸‹é‡‡æ ·è¾“å…¥å›¾åƒçš„ç©ºé—´ç»´åº¦ï¼ˆé«˜å’Œå®½ï¼‰ï¼Œç„¶è€Œå¦‚æœè¾“å…¥å’Œè¾“å‡ºå›¾åƒçš„ç©ºé—´ç»´åº¦ç›¸åŒï¼Œåœ¨ä»¥åƒç´ çº§åˆ†ç±»çš„è¯­ä¹‰åˆ†å‰²ä¸­å°†ä¼šå¾ˆæ–¹ä¾¿ã€‚ è€Œè½¬ç½®å·ç§¯ï¼ˆTransposed Convolutionï¼Œæœ‰çš„åœ°æ–¹ä¹Ÿå«åå·ç§¯ Deconvolutionï¼‰å¯ä»¥å¢åŠ ä¸Šé‡‡æ ·ä¸­é—´å±‚ç‰¹å¾å›¾çš„ç©ºé—´ç»´åº¦ï¼Œç”¨äºé€†è½¬ä¸‹é‡‡æ ·å¯¼è‡´çš„ç©ºé—´å°ºå¯¸å‡å°</p><p><img src="/archives/15b3ab53/image-20220325194527594.png" alt="image-20220325194527594" style="zoom:50%;"></p><p>é€šè¿‡è½¬ç½®å·ç§¯ï¼Œå°±èƒ½å¤Ÿæ„é€ åŸºæœ¬çš„å…¨å·ç§¯ç½‘ç»œï¼ˆFully Convolutional Network, FCNï¼‰</p><p><img src="/archives/15b3ab53/image-20220325195223193.png" alt="image-20220325195223193" style="zoom:50%;"></p><p>å…¨å·ç§¯ç½‘ç»œå…ˆä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œæŠ½å–å›¾åƒç‰¹å¾ï¼Œç„¶åé€šè¿‡1Ã—1å·ç§¯å±‚å°†é€šé“æ•°å˜æ¢ä¸ºç±»åˆ«ä¸ªæ•°ï¼Œæœ€åé€šè¿‡è½¬ç½®å·ç§¯å±‚å°†ç‰¹å¾å›¾çš„é«˜å’Œå®½å˜æ¢ä¸ºè¾“å…¥å›¾åƒçš„å°ºå¯¸</p><p>åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶éœ€è¦å°†å›¾åƒæ”¾å¤§ï¼Œå³ä¸Šé‡‡æ ·ï¼ˆupsamplingï¼‰ã€‚ åŒçº¿æ€§æ’å€¼ï¼ˆbilinear interpolationï¼‰ æ˜¯å¸¸ç”¨çš„ä¸Šé‡‡æ ·æ–¹æ³•ä¹‹ä¸€ï¼Œå®ƒä¹Ÿç»å¸¸ç”¨äºåˆå§‹åŒ–è½¬ç½®å·ç§¯å±‚ã€‚ä¸ªäººç†è§£ï¼Œé€šè¿‡è®¾ç½®è½¬ç½®å·ç§¯çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°åŒçº¿æ€§æ’å€¼çš„åŠŸèƒ½ï¼Ÿ</p><h2 id="é£æ ¼è¿ç§»"><a href="#é£æ ¼è¿ç§»" class="headerlink" title="é£æ ¼è¿ç§»"></a>é£æ ¼è¿ç§»</h2><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸¤å¼ è¾“å…¥å›¾åƒï¼šä¸€å¼ æ˜¯å†…å®¹å›¾åƒï¼Œå¦ä¸€å¼ æ˜¯é£æ ¼å›¾åƒã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ç¥ç»ç½‘ç»œä¿®æ”¹å†…å®¹å›¾åƒï¼Œä½¿å…¶åœ¨é£æ ¼ä¸Šæ¥è¿‘é£æ ¼å›¾åƒ</p><p>æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªé¢„è®­ç»ƒçš„å·ç§¯ç¥ç»ç½‘ç»œæ¥æŠ½å–å›¾åƒçš„ç‰¹å¾ï¼Œå…¶ä¸­çš„æ¨¡å‹å‚æ•°åœ¨è®­ç»ƒä¸­<strong>æ— é¡»æ›´æ–°ï¼Œåˆæˆå›¾åƒæ˜¯é£æ ¼è¿ç§»è¿‡ç¨‹ä¸­å”¯ä¸€éœ€è¦æ›´æ–°çš„å˜é‡</strong>ï¼ˆå¯ä»¥è®¤ä¸ºæˆ‘ä»¬ä¸æ–­å»æ›´æ–°æˆ‘ä»¬çš„è¾“å…¥ä»¥åŒ¹é…ï¼‰</p><p><img src="/archives/15b3ab53/image-20220325202045253.png" alt="image-20220325202045253" style="zoom:50%;"></p><p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©å…¶ä¸­æŸäº›å±‚çš„è¾“å‡ºä½œä¸ºå†…å®¹ç‰¹å¾æˆ–é£æ ¼ç‰¹å¾ã€‚ è¿™é‡Œé€‰å–çš„é¢„è®­ç»ƒçš„ç¥ç»ç½‘ç»œå«æœ‰3ä¸ªå·ç§¯å±‚ï¼Œå…¶ä¸­ç¬¬äºŒå±‚è¾“å‡ºå†…å®¹ç‰¹å¾ï¼Œç¬¬ä¸€å±‚å’Œç¬¬ä¸‰å±‚è¾“å‡ºé£æ ¼ç‰¹å¾</p><p>ä¸Šå›¾æåˆ°çš„ä¸‰ä¸ªæŸå¤±å‡½æ•°å°±ä¸ç»†ç©¶äº†ï¼Œå†…å®¹æŸå¤±å°±æ˜¯ç®€å•çš„ç‰¹å¾ä¹‹é—´çš„ MSE æŸå¤±ï¼Œæ ·å¼æŸå¤±ä¸ºè®¡ç®— gram çŸ©é˜µï¼ˆé€šé“ä¹‹é—´çš„åæ–¹å·®çŸ©é˜µï¼‰çš„ MSE æŸå¤±ï¼Œå…¨å˜åˆ†æŸå¤±ï¼ˆTV Lossï¼‰ç”¨äºå»å™ª</p>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode-diary 3 Array &amp; Binary Search</title>
      <link href="/archives/6921f8d1.html"/>
      <url>/archives/6921f8d1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-diary-3-Array-amp-Binary-Search"><a href="#Leetcode-diary-3-Array-amp-Binary-Search" class="headerlink" title="Leetcode-diary 3 Array &amp; Binary Search"></a>Leetcode-diary 3 Array &amp; Binary Search</h1><h2 id="Binary-Search"><a href="#Binary-Search" class="headerlink" title="Binary Search"></a>Binary Search</h2><h4 id="528-æŒ‰æƒé‡éšæœºé€‰æ‹©"><a href="#528-æŒ‰æƒé‡éšæœºé€‰æ‹©" class="headerlink" title="528. æŒ‰æƒé‡éšæœºé€‰æ‹©"></a><a href="https://leetcode-cn.com/problems/random-pick-with-weight/">528. æŒ‰æƒé‡éšæœºé€‰æ‹©</a></h4><p>æˆ‘å…ˆä½¿ç”¨äº† numpy è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæ˜¾ç„¶è¿™ä¸€é¢˜éœ€è¦ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ã€‚å…·ä½“æ€è·¯æ˜¯å°†éšæœºé—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ªåœ¨åŒºé—´ä¹‹å†…é€‰æ‹©æ•°å­—çš„é—®é¢˜</p><h4 id="162-å¯»æ‰¾å³°å€¼"><a href="#162-å¯»æ‰¾å³°å€¼" class="headerlink" title="162. å¯»æ‰¾å³°å€¼"></a><a href="https://leetcode-cn.com/problems/find-peak-element/">162. å¯»æ‰¾å³°å€¼</a></h4><p>è¿™ä¸€é¢˜çš„äºŒåˆ†æŸ¥æ‰¾éœ€è¦å¯¹é€»è¾‘éå¸¸æ¸…æ™°ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå½“ mid å€¼å°äºä»»ä¸€é‚»å€¼æ—¶ï¼Œé‚»å±…æ–¹å‘å¿…å®šæœ‰è§£ã€‚å¹¶ä¸”å¯¹äºè¾¹ç•Œçš„æƒ…å†µéœ€è¦å¥½å¥½æ€è€ƒï¼Œä¹Ÿå°±æ˜¯å·¦å³ä¸å­˜åœ¨é‚»å€¼ã€‚ä¸€ä¸ªä¼˜é›…çš„è§£æ³•æ˜¯å®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œæ¥è¿”å› -1 å’Œ n è¾¹ç•Œçš„å€¼</p><h4 id="410-åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼"><a href="#410-åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼" class="headerlink" title="410. åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/split-array-largest-sum/">410. åˆ†å‰²æ•°ç»„çš„æœ€å¤§å€¼</a></h4><p>ä½¿ç”¨åŠ¨æ€è§„åˆ’ä¼šè¶…å‡ºæ—¶é—´é™åˆ¶ï¼Œè€Œä¸”è¿™ä¸€é¢˜çš„åŠ¨æ€è§„åˆ’ä¹ŸæŒºç»•çš„ï¼Œä¸»è¦æ˜¯åˆå§‹åŒ–å¦‚ä½•è¿›è¡Œï¼šå…³é”®ç‚¹ä¸ºè¦å…³æ³¨æœ‰å‡å·çš„åœ°æ–¹ï¼Œå½“è¿™äº›åœ°æ–¹è¶…è¿‡äº†æ•°ç»„çš„èŒƒå›´ï¼Œå°±éœ€è¦è¿›è¡Œåˆå§‹åŒ–æˆ–è€…ç‰¹æ®Šå¤„ç†ï¼Œå¦‚æœèƒ½åœ¨å¾ªç¯ä¹‹å¤–è¿›è¡Œåˆå§‹åŒ–å°±æ˜¯æœ€å¥½ä¸è¿‡çš„äº†ï¼ŒäºŒç»´é€šå¸¸è¦å¤š1ä¸ªé•¿åº¦</p><p>è¿™ä¸€é¢˜çš„æœ€ä½³è§£æ³•æ˜¯äºŒåˆ†æœç´¢+è´ªå¿ƒç®—æ³•ï¼šå‡è®¾ä¸€ä¸ªå€¼ x, åˆ¤æ–­æ•´ä¸ªæ•°ç»„èƒ½ä¸èƒ½åˆ†æˆ m ä»½, æ¯ä¸€ä»½éƒ½å°äºç­‰äº xï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾å¾ˆå¿«å°±èƒ½åˆ¤å®šè¿™ä¸ªå€¼çš„å¤§å°</p><h4 id="658-æ‰¾åˆ°-K-ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ "><a href="#658-æ‰¾åˆ°-K-ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ " class="headerlink" title="658. æ‰¾åˆ° K ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ "></a><a href="https://leetcode-cn.com/problems/find-k-closest-elements/">658. æ‰¾åˆ° K ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ </a></h4><p>å…ˆç”¨äºŒåˆ†æŸ¥æ‰¾åˆ°ä½ç½®ï¼Œç„¶åä½¿ç”¨åŒæŒ‡é’ˆåˆ¤æ–­é‚»å±…</p><h4 id="1011-åœ¨-D-å¤©å†…é€è¾¾åŒ…è£¹çš„èƒ½åŠ›"><a href="#1011-åœ¨-D-å¤©å†…é€è¾¾åŒ…è£¹çš„èƒ½åŠ›" class="headerlink" title="1011. åœ¨ D å¤©å†…é€è¾¾åŒ…è£¹çš„èƒ½åŠ›"></a><a href="https://leetcode-cn.com/problems/capacity-to-ship-packages-within-d-days/">1011. åœ¨ D å¤©å†…é€è¾¾åŒ…è£¹çš„èƒ½åŠ›</a></h4><p>å’Œ410çš„é¢˜ç›®æ˜¯å®Œå…¨ä¸€æ ·çš„</p><h4 id="315-è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°"><a href="#315-è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°" class="headerlink" title="315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°"></a><a href="https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/">315. è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°</a></h4><p>ä¸ç†è§£â€¦æ˜æ˜å†™çš„ä¸¤ç§ç®—æ³•æ—¶é—´å¤æ‚åº¦åº”è¯¥éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†å†™çš„ç¬¬ä¸€ç§å°±æ˜¯ä¼šè¶…æ—¶ï¼ŒåŸå› åœ¨äºæ¯æ¬¡æœå¯»çš„éƒ½æ˜¯æœ€é•¿çš„æ•°ç»„</p><h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><p>ç°åœ¨é‡ç‚¹çªå‡» array &amp; dpï¼Œæ„Ÿè§‰è¿™ä¸¤ä¸ªæ‰æ˜¯å¤§å¤´çš„è€ƒç‚¹</p><h4 id="442-æ•°ç»„ä¸­é‡å¤çš„æ•°æ®"><a href="#442-æ•°ç»„ä¸­é‡å¤çš„æ•°æ®" class="headerlink" title="442. æ•°ç»„ä¸­é‡å¤çš„æ•°æ®"></a><a href="https://leetcode-cn.com/problems/find-all-duplicates-in-an-array/">442. æ•°ç»„ä¸­é‡å¤çš„æ•°æ®</a></h4><p>ä½¿ç”¨æ•°ç»„çš„ä¸‹æ ‡åšæ ‡è®°â€¦ç¬¬ä¸€æ¬¡ç¢°åˆ°ï¼Œè¿™å°±æ˜¯åŸåœ°å“ˆå¸Œã€‚å……åˆ†åˆ©ç”¨äº†æ•°ç»„çš„èŒƒå›´åœ¨ [1, n] ä¹‹é—´è¿™ä¸ªä¿¡æ¯ã€‚æˆ‘çš„ç¬¬ä¸€ä¸ªæƒ³æ³•è¿˜æ˜¯ä½è¿ç®—ï¼Œåœ¨é¢˜è§£é‡Œæ‰¾åˆ°ä¸€ä¸ªä½è¿ç®—çš„è§£æï¼Œå…¶å®æœ‰ä¸€ç‚¹ç‚¹ bugï¼Œå› ä¸º python çš„æ•°å€¼æ˜¯å¯ä»¥æ— é™å¤§çš„ï¼Œä½¿ç”¨ä½æ¥è®°å½•ä¹Ÿæœ‰ç‚¹ä½œå¼Šï¼Œä½†äº‹å®ä¸Šç”±äºè®¡ç®—æœºçš„é™åˆ¶ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥æŠŠè¿™é‡Œçœ‹ä½œ O(1) ç©ºé—´</p><h4 id="581-æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„"><a href="#581-æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„" class="headerlink" title="581. æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/shortest-unsorted-continuous-subarray/">581. æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„</a></h4><p>å¾ˆå®¹æ˜“å°±æƒ³åˆ°æ–¹æ³•ï¼Œä½†æ˜¯æƒ³è¦å¼„åˆ° O(N) éœ€è¦å¦å¤–çš„æ–¹æ³•ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°çš„ä¾ç„¶æ˜¯å•è°ƒæ ˆï¼Œä¸€æ—¦é‡åˆ°é™åºçš„æ•°å­—å°±éœ€è¦ç»´æŠ¤å•è°ƒæ ˆï¼Œå¹¶è®°å½• pop  æ‰çš„ä½ç½®</p><h4 id="189-è½®è½¬æ•°ç»„"><a href="#189-è½®è½¬æ•°ç»„" class="headerlink" title="189. è½®è½¬æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/rotate-array/">189. è½®è½¬æ•°ç»„</a></h4><p>ä¸»è¦æ˜¯å¯¹ç©ºé—´å¤æ‚åº¦çš„è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤æ¬¡ç¿»è½¬æ•°ç»„å®Œæˆã€‚ä»¥ååº”è¯¥å…»æˆå¿«é€Ÿè§£é¢˜çš„ä¹ æƒ¯ï¼Œè€Œä¸åº”è¯¥æ‹˜æ³¥äºè¿™äº›ç»†èŠ‚ï¼Œå¦‚æœæ„Ÿè§‰è¿™äº› trick æ²¡ä»€ä¹ˆå¸®åŠ©ï¼Œå°±åº”èµ¶ç´§è·³è¿‡</p><h4 id="41-ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°"><a href="#41-ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°" class="headerlink" title="41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°"></a><a href="https://leetcode-cn.com/problems/first-missing-positive/">41. ç¼ºå¤±çš„ç¬¬ä¸€ä¸ªæ­£æ•°</a></h4><p>è¿™ä¸€é¢˜åˆé‡åˆ°äº†åŸåœ°å“ˆå¸Œçš„æ¦‚å¿µï¼Œåœ¨ 442 ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚åŸåœ°å“ˆå¸Œç®—æ³•ä¸»è¦åº”ç”¨åœ¨èŒƒå›´ä¸º [0, len(nums)] çš„æ•°ç»„è§£æ³•ä¸­ï¼Œå°†æ•°ç»„å…ƒç´ æœ¬èº«ä½œä¸º <code>nums</code> çš„ä¸‹æ ‡ï¼Œå³ <code>nums[nums[i]]</code>ï¼Œè¿™å°†è§£å†³ç©ºé—´ä¸è¶³çš„é—®é¢˜ã€‚è¿™ä¸€é¢˜è™½ç„¶æ•°å­—çš„èŒƒå›´å¾ˆå¹¿ï¼Œä½†ç¨åŠ æ¨æµ‹å¯ä»¥çŸ¥é“ï¼Œç­”æ¡ˆçš„è§£å¿…å®šåœ¨ 1~n+1 ä¹‹é—´ï¼Œæ‰€ä»¥ä½¿ç”¨åŸåœ°å“ˆå¸Œä¹Ÿæ˜¯æ¯”è¾ƒè‡ªç„¶çš„ã€‚å¸¸ç”¨çš„æ–¹æ³•æ˜¯å¯¹åŸå§‹æ•°ç»„è¿›è¡Œæ­£è´Ÿæ ‡å®šï¼Œæ¥è¡¨å¾æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œäºæ­¤åŒæ—¶åœ¨éå†æ•°ç»„çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨ abs() ç»å¯¹å€¼æ“ä½œï¼Œæ¥è·å–åŸå§‹ä¿¡æ¯</p><p>æˆ‘å¯ä»¥å…ˆæŠŠè´Ÿæ•°è½¬æ¢æˆä¸€ä¸ªå¾ˆå¤§çš„æ­£æ•°ï¼Œè¿™å°†ä¸å½±å“ç­”æ¡ˆ</p><h4 id="845-æ•°ç»„ä¸­çš„æœ€é•¿å±±è„‰"><a href="#845-æ•°ç»„ä¸­çš„æœ€é•¿å±±è„‰" class="headerlink" title="845. æ•°ç»„ä¸­çš„æœ€é•¿å±±è„‰"></a><a href="https://leetcode-cn.com/problems/longest-mountain-in-array/">845. æ•°ç»„ä¸­çš„æœ€é•¿å±±è„‰</a></h4><p>å…ˆå°è¯•äº†åŠ¨æ€è§„åˆ’ï¼Œä½†æ˜¯è¶…æ—¶äº†ï¼Œç”¨äº† N æ–¹å¤æ‚åº¦ï¼Œç„¶åè€ƒè™‘ä½¿ç”¨æ ˆï¼ŒèŠ±è´¹äº†æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œå› ä¸ºæ€è·¯éœ€è¦æ›´ç»†è‡´ã€‚çœ‹äº†é¢˜è§£ï¼šä½¿ç”¨ä¸¤æ¬¡åŠ¨æ€è§„åˆ’ï¼Œè®¡ç®—æ•°å­—å·¦ä¾§å¯æ‰©å±•çš„æ•°å­—å’Œå³ä¾§å¯æ‰©å±•çš„æ•°å­—ï¼åˆæ˜¯ä¸€é¢˜ä½¿ç”¨å¤šä¸ªåŠ¨æ€è§„åˆ’ç»“æœæ¥è§£å†³çš„ï¼Œè¿™ç§é¢˜åšçš„æ¯”è¾ƒå°‘</p><h4 id="274-H-æŒ‡æ•°"><a href="#274-H-æŒ‡æ•°" class="headerlink" title="274. H æŒ‡æ•°"></a><a href="https://leetcode-cn.com/problems/h-index/">274. H æŒ‡æ•°</a></h4><p>å¾ˆæ˜æ˜¾çš„å°±æƒ³åˆ°äº†äºŒåˆ†æŸ¥æ‰¾çš„æ€æƒ³ã€‚ä½†è¦å®ç° O(N) å¤æ‚åº¦å°±éœ€è¦ç›´æ¥è§£é¢˜ï¼Œè¿™ä¸€é¢˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯ H æŒ‡æ•°ä¸€å®šä¸ä¼šè¶…è¿‡ Nï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸€ä¸ª N + 1 æ•°ç»„è¿›è¡Œå­˜å‚¨ï¼Œä½¿ç”¨ä¸€ä¸ªæ•°ç»„å­˜å‚¨ store[i + 1] ä»£è¡¨å€¼ä¸º i çš„æ¬¡æ•°ï¼Œå…¶ä¸­ store[N] è¡¨ç¤ºå€¼ &gt;=N çš„æ¬¡æ•°</p><h4 id="275-H-æŒ‡æ•°-II"><a href="#275-H-æŒ‡æ•°-II" class="headerlink" title="275. H æŒ‡æ•° II"></a><a href="https://leetcode-cn.com/problems/h-index-ii/">275. H æŒ‡æ•° II</a></h4><p>ä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾çš„é¢˜ç›®ï¼Œçœ‹ç¬¬ k ä¸ªæ•°å­—ä¸å…¶å­˜å‚¨å€¼ citations[k] çš„å¤§å°</p><h4 id="220-å­˜åœ¨é‡å¤å…ƒç´ -III"><a href="#220-å­˜åœ¨é‡å¤å…ƒç´ -III" class="headerlink" title="220. å­˜åœ¨é‡å¤å…ƒç´  III"></a><a href="https://leetcode-cn.com/problems/contains-duplicate-iii/">220. å­˜åœ¨é‡å¤å…ƒç´  III</a></h4><p>è¿™ä¸€é¢˜ä¹Ÿä¸å¤ªå¸¸è§„ï¼Œè™½ç„¶æˆ‘ä½¿ç”¨äº†æš´åŠ›è§£æ³•ã€‚ç¬¬ä¸€ç§æ€è·¯æ˜¯ä½¿ç”¨çº¢é»‘æ ‘ç»´æŠ¤æœ‰åºæ•°ç»„ï¼Œä½†æ˜¯åŸç”Ÿ Python é‡Œæ²¡æœ‰è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œéœ€è¦ä½¿ç”¨ <a href="https://grantjenks.com/docs/sortedcontainers/">sortedcontainiers</a> è¿™ä¸ªåº“â€¦è¿™ä¸ªåº“å…¶å®ç”¨äºç»´æŠ¤æœ‰åºæ•°ç»„éå¸¸æœ‰ç”¨ï¼Œä½†è€ƒè™‘åˆ°ç¬”è¯•é¢è¯•çš„æ—¶å€™å¯èƒ½ç”¨ä¸ä¸Šè¿™ä¸ªåº“ï¼Œæ‰€ä»¥äº†è§£ä¸€ä¸‹ç¬¬äºŒç§æ€è·¯ï¼šæ¡¶æ’åºã€‚æœ€å¤šä½¿ç”¨ k ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶çš„ç¼–å·ä¸º mï¼Œè¿™ä¸ªç¼–å·ä»£è¡¨äº†æ•°å€¼åœ¨ $m \times (t + 1) \sim (m + 1)\times (t + 1) - 1$ ä¹‹é—´çš„æ•°ï¼Œä½¿ç”¨å­—å…¸ <code>bucket</code> åˆ›å»ºæ¡¶ï¼Œå…·ä½“æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹éå†ï¼Œå‡è®¾å½“å‰å…ƒç´ ä¸º <code>num[i]</code>ï¼Œè®¡ç®—å…¶æ‰€å±æ¡¶çš„ç¼–å· <code>m = num[i] // (t + 1)</code></li><li>æŸ¥è¯¢å½“å‰æ˜¯å¦å­˜åœ¨æœ‰æ¡¶çš„ç¼–å·ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å› trueï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŸ¥æ‰¾ç›¸é‚»ç¼–å· <code>m + 1 or m - 1</code> çš„æ¡¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨æŸ¥çœ‹æ¡¶ä¸­å…ƒç´ æ˜¯å¦ç¬¦åˆ <code>abs(bucket[m + 1 or m - 1] - num[i]) &lt;= t</code>ï¼Œå¦‚æœå­˜åœ¨ä¹Ÿè¿”å› trueï¼Œå¦‚æœä¾ç„¶ä¸å­˜åœ¨åˆ™å»ºç«‹æ–°çš„æ¡¶ã€‚æ­¤æ—¶å¦‚æœæ¡¶çš„ä¸ªæ•°è¶…è¿‡äº† k ä¸ªï¼Œåˆ™åˆ é™¤æœ€æ—©å»ºç«‹çš„æ¡¶ <code>bucker(num[i - k] // (t + 1))</code>ã€‚é€šè¿‡å­—å…¸èƒ½å¤Ÿå¿«é€Ÿå®ç°æ–°å»ºæ¡¶å’Œåˆ é™¤æ¡¶</li></ol><h4 id="307-åŒºåŸŸå’Œæ£€ç´¢-æ•°ç»„å¯ä¿®æ”¹"><a href="#307-åŒºåŸŸå’Œæ£€ç´¢-æ•°ç»„å¯ä¿®æ”¹" class="headerlink" title="307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹"></a><a href="https://leetcode-cn.com/problems/range-sum-query-mutable/">307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹</a></h4><p>çº¿æ®µæ ‘â€¦ç›´æ¥æ”¾å¼ƒï¼Œå¦‚æœçœŸçš„éœ€è¦å¾’æ‰‹å®ç°è¿™æ ·çš„æ•°æ®ç»“æ„è¿˜æ˜¯ç®—äº†å§</p><h4 id="121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"><a href="#121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº" class="headerlink" title="121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"></a><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/">121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a></h4><p>è¿™ä¸€é¢˜æ˜¯ä¸€ä¸ªç³»åˆ—ï¼Œä¸€èµ·å¹²æ‰ï¼è¿™ä¸€é¢˜çœŸæ­£å±•ç¤ºäº†åŠ¨æ€è§„åˆ’çš„æœ¬è´¨ï¼šä¸€ä¸ªé—®é¢˜ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„ç»ˆææ ‡å‡†å°±æ˜¯è¯¥é—®é¢˜èƒ½å¦ç”±<strong>ä¸€äº›</strong>å­é—®é¢˜ï¼ˆçŠ¶æ€ï¼‰æ–¹ä¾¿è§£å†³ï¼Œè€Œè¿™äº›å­é—®é¢˜åˆèƒ½å¤Ÿé€šè¿‡<strong>é€’å½’</strong>æ–¹ä¾¿è§£å†³ï¼Œå­é—®é¢˜å¯ä»¥æ˜¯ä¸åŸé—®é¢˜ä¸åŒçš„é—®é¢˜ã€‚é€šè¿‡é€’å½’è§£å†³å­é—®é¢˜ï¼ˆçŠ¶æ€ï¼‰å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š1. çŠ¶æ€è‡ªèº«çš„ç®€å•é€’å½’ï¼›2. ä¸åŒçŠ¶æ€ä¹‹é—´çš„é€’å½’</p><p>è¿™ä¸€é¢˜ç›´æ¥è®°å½•æœ€å¤šäº¤æ˜“ k æ¬¡çš„æƒ…å†µã€‚æˆ‘èµ·å§‹æ€è·¯å…¶å®æ˜¯ä»æ€è€ƒ k -1 æ¬¡çš„æƒ…å†µå¼€å§‹ï¼šå¦‚æœçŸ¥é“åˆ°æˆªæ­¢åˆ°ç¬¬ j å¤©çš„ k - 1 æ¬¡çš„æƒ…å†µï¼Œé€šè¿‡ n æ¬¡å¾ªç¯å°±èƒ½å¾ˆå¿«å¾—å‡ºæ­¤é—®é¢˜çš„ç­”æ¡ˆã€‚ç„¶è€Œäº‹å®æ˜¯è§£å†³è¿™ä¸¤ä¸ªå­é—®é¢˜ä¼šå˜å¾—æ¯”è¾ƒå¤æ‚ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li><code>dp_1[i][j]</code> ä»£è¡¨åˆ°ç¬¬ i å¤©æœ€å¤šäº¤æ˜“ j æ¬¡çš„æƒ…å†µ</li><li><code>dp_2[i][j]</code> ä»£è¡¨ç¬¬ i å¤©åˆ°ç¬¬ j å¤©æœ€å¤šäº¤æ˜“1æ¬¡çš„æƒ…å†µ</li></ol><p>è¿™ä¼¼ä¹ä¸æ˜¯ä¸€ä¸ªå¥½çš„çŠ¶æ€å®šä¹‰ï¼Œå°¤å…¶æ˜¯ç¬¬äºŒä¸ªå­é—®é¢˜ç›´æ¥éœ€è¦ n æ–¹çš„æ—¶é—´å¤æ‚åº¦ã€‚é¢˜è§£çš„æ€è·¯ä¸ºï¼Œå¦‚æœçŸ¥é“æ¯ä¸ªæ—¶é—´ç‚¹çš„æ‰€æœ‰ä¹°å–çŠ¶æ€ï¼Œå°±èƒ½å¤ŸçŸ¥é“ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹çš„æ‰€æœ‰ä¹°å–çŠ¶æ€ã€‚æ¯ä¸ªæ—¶é—´ç‚¹ä¹°å–çŠ¶æ€æœ‰ 2 * k + 1ä¸ªï¼š</p><ol><li>ç¬¬ i å¤©ï¼Œæœ€å¤š0æ¬¡äº¤æ˜“ï¼Œå¹¶ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Š</li><li>ç¬¬ i å¤©ï¼Œæœ€å¤š0æ¬¡äº¤æ˜“ï¼Œå¹¶æŒæœ‰1æ”¯è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Š</li><li>ç¬¬ i å¤©ï¼Œæœ€å¤š1æ¬¡äº¤æ˜“ï¼Œå¹¶ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Š</li><li>ç¬¬ i å¤©ï¼Œæœ€å¤š1æ¬¡äº¤æ˜“ï¼Œå¹¶æŒæœ‰1æ”¯è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Š</li><li>ç¬¬ i å¤©ï¼Œæœ€å¤š2æ¬¡äº¤æ˜“ï¼Œå¹¶ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Š</li><li>â€¦</li></ol><p>è¯¥é¢˜çš„éš¾ç‚¹åœ¨äºæ‰¾åˆ°åˆé€‚çš„çŠ¶æ€ã€‚ç”±äºéœ€è¦çŸ¥é“å‰ä¸€å¤©æ˜¯å¦æŒæœ‰è‚¡ç¥¨æ‰èƒ½è¿›è¡Œä¹°å…¥å–å‡ºï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰æ­¤æ—¶ä¹°å…¥å–å‡ºçš„çŠ¶æ€ï¼Œè¿™æ ·åœ¨æ›´æ–°ç¬¬ i + 1 å¤©çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ ¹æ®æ˜¨æ—¥çš„çŠ¶æ€æ›´æ–°æ‰€æœ‰ 2 * k + 1 ä¸ªçŠ¶æ€</p><h4 id="11-ç››æœ€å¤šæ°´çš„å®¹å™¨"><a href="#11-ç››æœ€å¤šæ°´çš„å®¹å™¨" class="headerlink" title="11. ç››æœ€å¤šæ°´çš„å®¹å™¨"></a><a href="https://leetcode-cn.com/problems/container-with-most-water/">11. ç››æœ€å¤šæ°´çš„å®¹å™¨</a></h4><p>å¤ªç»å…¸çš„è´ªå¿ƒç®—æ³•äº†ï¼Œä½¿ç”¨åŒæŒ‡é’ˆä¸æ–­åœ°è¿›è¡Œè´ªå¿ƒæœç´¢ï¼Œè¿”å›æœç´¢è¿‡ç¨‹ä¸­çš„æœ€å¤§å€¼</p><h4 id="42-æ¥é›¨æ°´"><a href="#42-æ¥é›¨æ°´" class="headerlink" title="42. æ¥é›¨æ°´"></a><a href="https://leetcode-cn.com/problems/trapping-rain-water/">42. æ¥é›¨æ°´</a></h4><p>è¿™ä¸€é¢˜æœ‰å¤šç§è§£æ³•ï¼š1. åŠ¨æ€è§„åˆ’ï¼›2. å•è°ƒæ ˆï¼ˆç»´æŠ¤å•è°ƒå±æ€§ï¼‰ï¼›3. åŒæŒ‡é’ˆï¼ˆåŠ¨æ€è§„åˆ’çš„å‡çº§ï¼‰</p><p>é‡ç‚¹æä¸€ä¸‹åŒæŒ‡é’ˆï¼šå› ä¸ºæˆ‘ä»¬æ˜¯ä¸æ–­åœ°ç§»åŠ¨è¾ƒå°æŒ‡é’ˆï¼Œæ‰€ä»¥å³ä½¿æŒ‡é’ˆä¸­é—´å‡ºç°æ›´å¤§/æ›´å°çš„å€¼ï¼Œä¹Ÿä¸ä¼šå¯¹å½“å‰è¾ƒå°æŒ‡é’ˆæ¥çš„æ°´æœ‰æ‰€å½±å“</p><h4 id="128-æœ€é•¿è¿ç»­åºåˆ—"><a href="#128-æœ€é•¿è¿ç»­åºåˆ—" class="headerlink" title="128. æœ€é•¿è¿ç»­åºåˆ—"></a><a href="https://leetcode-cn.com/problems/longest-consecutive-sequence/">128. æœ€é•¿è¿ç»­åºåˆ—</a></h4><p>è™½ç„¶éœ€è¦æ—¶é—´å¤æ‚åº¦ä¸º O(N)ï¼Œä½†æˆ‘è¿˜æ˜¯è¦å…ˆå®ç°ä¸€ä¸ªæš´åŠ›è§£æ³•ï¼Œè¿…é€Ÿè§£é¢˜ï¼Œå¹¶ä¸”æš´åŠ›è§£æ³•çš„æ—¶é—´å¤æ‚åº¦å¹¶ä¸æ˜¯å¾ˆé«˜ã€‚æ¥ç€æˆ‘å°±æƒ³åˆ°äº†è¿é€šçš„æ€æƒ³ï¼Œä½¿ç”¨ä¸€ä¸ªé›†åˆï¼Œç„¶åä¸æ–­åœ°å¯»æ‰¾å…¶è¿é€šçš„æ•°å­—</p><h4 id="239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/sliding-window-maximum/">239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a></h4><p>è¿™ä¸€é¢˜åœ¨å‰‘æŒ‡é‡Œé¢åˆ·è¿‡ï¼Œæˆ‘å†è‡ªå·±å†™ä¸€æ¬¡ï¼Œå…³é”®æ˜¯åœ¨äºç»´æŠ¤ä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚é¦–å…ˆå®ç°äº†å †çš„å†™æ³•ï¼Œæ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°ã€‚ä½†æ˜¯ç»´æŠ¤å•è°ƒæ€§è´¨çš„æ•°æ®ç»“æ„åº”è¯¥é¦–å…ˆè€ƒè™‘å•è°ƒæ ˆï¼Œè¿™ä¸€é¢˜æ›´ç‰¹æ®Šä¸€ç‚¹ï¼Œè¦ç»´æŠ¤ä¸€ä¸ªå®šé•¿çš„æ•°ç»„ï¼Œæ‰€ä»¥éœ€è¦ä»æ ˆåº•åˆ é™¤å…ƒç´ ï¼Œæ‰€ä»¥æ›´åŠ è‡ªç„¶çš„å°±å¾—å‡ºäº†å•è°ƒé˜Ÿåˆ—çš„æ–¹æ³•</p><h4 id="295-æ•°æ®æµçš„ä¸­ä½æ•°"><a href="#295-æ•°æ®æµçš„ä¸­ä½æ•°" class="headerlink" title="295. æ•°æ®æµçš„ä¸­ä½æ•°"></a><a href="https://leetcode-cn.com/problems/find-median-from-data-stream/">295. æ•°æ®æµçš„ä¸­ä½æ•°</a></h4><p>ä¸€å¼€å§‹é¢˜ç›®å°±ç†è§£é”™äº†â€¦éœ€è¦çš„æ˜¯æœ‰åºåˆ—è¡¨çš„ä¸­ä½æ•°ï¼ä¹‹å‰è¿˜åœ¨å‰‘æŒ‡ offer åšè¿‡è¿™ä¸€é¢˜çš„ï¼ä½¿ç”¨æœ€å¤§å †ç»´æŠ¤å·¦è¾¹ï¼Œæœ€å°å †ç»´æŠ¤å³è¾¹</p><h4 id="209-é•¿åº¦æœ€å°çš„å­æ•°ç»„"><a href="#209-é•¿åº¦æœ€å°çš„å­æ•°ç»„" class="headerlink" title="209. é•¿åº¦æœ€å°çš„å­æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/minimum-size-subarray-sum/">209. é•¿åº¦æœ€å°çš„å­æ•°ç»„</a></h4><p>æ€è·¯éå¸¸çš„æ¸…æ™°ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨åŒæŒ‡é’ˆè¿›è¡Œæ»‘åŠ¨çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚äºŒåˆ†æŸ¥æ‰¾æ•ˆç‡æ›´å·®ï¼Œä¸è¿‡ä¹Ÿæ˜¯ä¸€ç§æš´åŠ›è§£ï¼Œåœ¨è°ƒè¯•ä¸å‡ºæ¥çš„æ—¶å€™å¯ä»¥è¿›ä¸€æ­¥å°è¯•</p><h4 id="238-é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯"><a href="#238-é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯" class="headerlink" title="238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯"></a><a href="https://leetcode-cn.com/problems/product-of-array-except-self/">238. é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯</a></h4><p>ä¸Šä¸‹ä¸‰è§’å½¢å­˜å‚¨æ‰€éœ€è¦çš„ä¹˜ç§¯ã€‚å¦‚æœéœ€è¦ä½¿ç”¨å¸¸æ•°å­˜å‚¨ç©ºé—´ï¼Œé‚£ä¹ˆä½¿ç”¨ä¸€ä¸ªæµè½¬å¾ªç¯çš„æ–¹å¼å³å¯</p><h4 id="152-ä¹˜ç§¯æœ€å¤§å­æ•°ç»„"><a href="#152-ä¹˜ç§¯æœ€å¤§å­æ•°ç»„" class="headerlink" title="152. ä¹˜ç§¯æœ€å¤§å­æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/maximum-product-subarray/">152. ä¹˜ç§¯æœ€å¤§å­æ•°ç»„</a></h4><p>åŠ¨æ€è§„åˆ’ï¼Œä½¿ç”¨ä¸¤ä¸ªçŠ¶æ€ï¼šæœ€å¤§æ•´æ•°ï¼Œæœ€å°è´Ÿæ•°åˆ†æå³å¯</p><h4 id="713-ä¹˜ç§¯å°äºKçš„å­æ•°ç»„"><a href="#713-ä¹˜ç§¯å°äºKçš„å­æ•°ç»„" class="headerlink" title="713. ä¹˜ç§¯å°äºKçš„å­æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/subarray-product-less-than-k/">713. ä¹˜ç§¯å°äºKçš„å­æ•°ç»„</a></h4><p>è¿™é‡Œæ€»ç»“äº†ä¸€ä¸‹åŒæŒ‡é’ˆçš„å¥—è·¯ï¼šåŒæŒ‡é’ˆå¸¸å¸¸ä¸è¿ç»­/é¡ºåºæœ‰å…³, å¹¶ä¸”èƒ½å¤Ÿé€šè¿‡æŒ‡é’ˆç§»åŠ¨æ–¹ä¾¿åœ°æ›´æ–°åŒºé—´çš„æ€§è´¨ã€‚é€šå¸¸ï¼ŒåŒæŒ‡é’ˆå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå¾ªç¯ç”šè‡³ä¸€ä¸ªå¾ªç¯å®Œæˆï¼Œ<strong>å…ˆå°†æŸä¸ªæŒ‡é’ˆç§»åŠ¨</strong>ï¼Œç„¶åè¿›è¡Œæ¡ä»¶åˆ¤æ–­(å¹¶ç§»åŠ¨æŒ‡é’ˆ)ï¼Œç›´åˆ°æ»¡è¶³/ä¸æ»¡è¶³æŸä¸ªæ¡ä»¶ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯</p><p>å¤§å¤šæ•°çš„å¾ªç¯éƒ½åº”è¯¥æ˜¯å¦‚æ­¤ï¼šéœ€è¦æ”¶å°¾ç›¸æ¥ï¼Œä¹Ÿå°±æ˜¯å¾ªç¯ç»“æŸçš„æœ«å°¾éœ€è¦å’Œå¼€å¤´å¯¹åº”ï¼Œåˆå§‹æƒ…å†µéœ€è¦ç‰¹æ®Šå¤„ç†ã€‚æ¢å¥è¯è¯´å¾ªç¯çš„å¼€å¤´éœ€è¦èƒ½å¤Ÿå¤„ç†åˆå§‹çŠ¶å†µå’Œæ»¡è¶³æ¡ä»¶çš„çŠ¶å†µï¼</p><p>æœ¬é¢˜çš„åŒæŒ‡é’ˆä¸å¤ªä¸€æ ·ï¼Œå³æŒ‡é’ˆéœ€è¦æŒ‰ç…§é¡ºåºç§»åŠ¨, å·¦æŒ‡é’ˆå°†çµæ´»ç§»åŠ¨</p><h4 id="974-å’Œå¯è¢«-K-æ•´é™¤çš„å­æ•°ç»„"><a href="#974-å’Œå¯è¢«-K-æ•´é™¤çš„å­æ•°ç»„" class="headerlink" title="974. å’Œå¯è¢« K æ•´é™¤çš„å­æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/subarray-sums-divisible-by-k/">974. å’Œå¯è¢« K æ•´é™¤çš„å­æ•°ç»„</a></h4><p>ç›´æ¥æ±‚å‰ç¼€å’Œï¼Œç»Ÿè®¡å…¶ä½™æ•°ç›¸åŒçš„ä½ç½®ï¼Œåªè¦ä½™æ•°ç›¸ç­‰é‚£ä¹ˆä»–ä»¬çš„å·®å¿…å®šæ˜¯ k çš„å€æ•°ï¼Œå¹¶ä¸”ç‰¹æ®Šå¤„ç†å‰ç¼€å’Œä¸º0çš„æƒ…å†µ</p><h4 id="945-ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡"><a href="#945-ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡" class="headerlink" title="945. ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡"></a><a href="https://leetcode-cn.com/problems/minimum-increment-to-make-array-unique/">945. ä½¿æ•°ç»„å”¯ä¸€çš„æœ€å°å¢é‡</a></h4><p>æˆ‘æƒ³ç”¨ empty è®°å½•ä¸€ä¸ªç©ºç¼ºä½ç½®ã€‚æ›´å¥½ç†è§£çš„æ˜¯ï¼šç›´æ¥å…ˆæ’åºï¼Œç„¶åé‡åˆ°ä¸å‰ä¸€ä¸ªæ•°å­—ç›¸ç­‰å°±å°†å…¶å˜ä¸ºå‰ä¸€ä¸ªæ•°å­—åŠ ä¸€</p><h4 id="321-æ‹¼æ¥æœ€å¤§æ•°"><a href="#321-æ‹¼æ¥æœ€å¤§æ•°" class="headerlink" title="321. æ‹¼æ¥æœ€å¤§æ•°"></a><a href="https://leetcode-cn.com/problems/create-maximum-number/">321. æ‹¼æ¥æœ€å¤§æ•°</a></h4><p>è¿™ä¸€é¢˜å¾ˆæ˜æ˜¾æ˜¯ä¸¤é“ä¸­ç­‰é¢˜ç›®æ‹¼æ¥è€Œæ¥ï¼Œéœ€è¦å¯¹ä¸­ç­‰é¢˜ç›®æœ‰æ¯”è¾ƒé«˜çš„ç†Ÿç»ƒç¨‹åº¦ï¼æˆ‘å¾ˆå¿«å°±è§£å‡ºäº†ä¸€ä¸ªå­é—®é¢˜ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªå­é—®é¢˜å°†ä¸¤ä¸ªæ•°å­—è¿›è¡Œæ‹¼æ¥è¿™ä¸€æ­¥è§£å†³å¾—ä¸å¤ªé¡ºç•…ã€‚é¦–å…ˆè®©æˆ‘æƒ³åˆ°äº† offer 45ï¼Œä½†å®é™…ä¸ŠäºŒè€…å¹¶æ²¡æœ‰ç‰¹åˆ«ç±»ä¼¼ï¼Œè™½ç„¶æœ‰æœ¦æœ¦èƒ§èƒ§çš„æƒ³æ³•ï¼Œä½†æ˜¯å¹¶ä¸ç²¾ç¡®ï¼Œé¢˜è§£ä¸­ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å­—å…¸åºå¤§å°ï¼Œéå¸¸å¥½ç”¨</p><h4 id="402-ç§»æ‰-K-ä½æ•°å­—"><a href="#402-ç§»æ‰-K-ä½æ•°å­—" class="headerlink" title="402. ç§»æ‰ K ä½æ•°å­—"></a><a href="https://leetcode-cn.com/problems/remove-k-digits/">402. ç§»æ‰ K ä½æ•°å­—</a></h4><p>è¿™æ˜¯è§£å†³ä¸Šä¸€é¢˜çš„å­é—®é¢˜ã€‚å­¦ä¹ ç‚¹ï¼š<strong>å¯ä»¥ä½¿ç”¨ strip/lstrip/rstrip æ¥å¯¹å­—ç¬¦ä¸²å‰åè¿›è¡Œè£åˆ‡</strong></p><h4 id="403-é’è›™è¿‡æ²³"><a href="#403-é’è›™è¿‡æ²³" class="headerlink" title="403. é’è›™è¿‡æ²³"></a><a href="https://leetcode-cn.com/problems/frog-jump/">403. é’è›™è¿‡æ²³</a></h4><p>åŠ¨æ€è§„åˆ’ï¼Œè¿™ä¸€é¢˜å°±æ˜¯çº¯ç²¹åœ°ä»ç®€å•æ¨å¹¿åˆ°å¤æ‚ï¼Œè®°å½•åˆ°è¾¾å½“å‰çŸ³å¤´çš„æ­¥é•¿ï¼Œå°è¯•ä»å½“å‰çŸ³å¤´å‘å‰å‡ºå‘ï¼Œæ›´æ–°å…¶ä»–çŸ³å¤´çš„çŠ¶æ€å’Œæ­¥é•¿ã€‚å†ä¸€æ¬¡æ¸…æ™°äº†åŠ¨æ€è§„åˆ’çš„æ ¸å¿ƒï¼šå»ºç«‹å½“å‰æ‰€å¾—çŠ¶æ€ä¸æœªçŸ¥çŠ¶æ€ä¹‹é—´çš„è½¬ç§»æ–¹ç¨‹</p><h4 id="1029-ä¸¤åœ°è°ƒåº¦"><a href="#1029-ä¸¤åœ°è°ƒåº¦" class="headerlink" title="1029. ä¸¤åœ°è°ƒåº¦"></a><a href="https://leetcode-cn.com/problems/two-city-scheduling/">1029. ä¸¤åœ°è°ƒåº¦</a></h4><p>å‡è®¾ä»–ä»¬éƒ½å»äº†åŒä¸€ä¸ªåœ°æ–¹ï¼Œçœ‹å¦‚æœä»–ä»¬å»å¦ä¸€ä¸ªåœ°æ–¹éœ€è¦èŠ±è´¹å¤šå°‘</p><h4 id="986-åŒºé—´åˆ—è¡¨çš„äº¤é›†"><a href="#986-åŒºé—´åˆ—è¡¨çš„äº¤é›†" class="headerlink" title="986. åŒºé—´åˆ—è¡¨çš„äº¤é›†"></a><a href="https://leetcode-cn.com/problems/interval-list-intersections/">986. åŒºé—´åˆ—è¡¨çš„äº¤é›†</a></h4><p>çº¯çº¯çš„é€’å½’å†™æ³•ï¼Œä»…éœ€è¦ä¸æ–­åœ°åˆ¤æ–­ç¬¬ä¸€ä¸ªåŒºé—´æ˜¯å¦ç›¸äº¤å³å¯ï¼Œç„¶å pop å‡ºå°¾ç«¯è¾ƒå°çš„é¦–éƒ¨ï¼Œç»§ç»­é€’å½’</p><h4 id="939-æœ€å°é¢ç§¯çŸ©å½¢"><a href="#939-æœ€å°é¢ç§¯çŸ©å½¢" class="headerlink" title="939. æœ€å°é¢ç§¯çŸ©å½¢"></a><a href="https://leetcode-cn.com/problems/minimum-area-rectangle/">939. æœ€å°é¢ç§¯çŸ©å½¢</a></h4><p>ä½¿ç”¨å“ˆå¸Œè¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œéœ€è¦ä½¿ç”¨æš´åŠ›è§£æ³•</p><h4 id="957-N-å¤©åçš„ç‰¢æˆ¿"><a href="#957-N-å¤©åçš„ç‰¢æˆ¿" class="headerlink" title="957. N å¤©åçš„ç‰¢æˆ¿"></a><a href="https://leetcode-cn.com/problems/prison-cells-after-n-days/">957. N å¤©åçš„ç‰¢æˆ¿</a></h4><p>è¿™ä¸€é¢˜æ¯”è¾ƒæœ‰æ„æ€ã€‚å› ä¸ºç‰¢æˆ¿çš„æ•°é‡æ˜¯æ’å®šçš„ï¼Œæ‰€ä»¥çŠ¶æ€æ˜¯å¯ä»¥ç©·ä¸¾çš„ã€‚æˆ‘åªéœ€è¦çŸ¥é“åˆ°å“ªä¸€ä¸ªçŠ¶æ€è¿‡ååˆå›åˆ°åˆå§‹çŠ¶æ€ï¼Œå°±å¯ä»¥è¿›å…¥å¾ªç¯æ±‚è§£äº†ã€‚è¿™é‡Œè¿˜è¿ç”¨äº†å­—å…¸æ˜¯æŒ‰ç…§é¡ºåºåˆ›å»ºçš„ç‰¹æ€§</p><h4 id="4-å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°"><a href="#4-å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°" class="headerlink" title="4. å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°"></a><a href="https://leetcode-cn.com/problems/median-of-two-sorted-arrays/">4. å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°</a></h4><p>è¿™ä¸€é¢˜çš„äºŒåˆ†æŸ¥æ‰¾æŒºå¥‡è¯¡å“çš„â€¦ä¸å¤ªå¥½ç†è§£ï¼Œå¹¶ä¸æ˜¯ä¸€èˆ¬çš„æ¯æ¬¡æ’é™¤æ‰ä¸€åŠçš„æœç´¢èŒƒå›´ï¼Œæ„Ÿè§‰æ˜¯æ¯æ¬¡æ’é™¤ 1/4 çš„æœç´¢èŒƒå›´ï¼Œä¸è¿‡è¿™æ ·ä¹Ÿèƒ½å¤Ÿè¾¾æˆæŒ‡æ•°çº§çš„ä¸‹é™ã€‚åŒæ—¶è¿˜éœ€è¦å¤„ç†è¾¹ç•Œæ¡ä»¶ k = 1 or 0 çš„æƒ…å†µï¼Œ<strong>ä»£ç æˆ‘æ²¡æœ‰å°è¯•å†™è¿‡ï¼Œä¹‹åè¦å†™ä¸€ä¸‹</strong></p><h4 id="56-åˆå¹¶åŒºé—´"><a href="#56-åˆå¹¶åŒºé—´" class="headerlink" title="56. åˆå¹¶åŒºé—´"></a><a href="https://leetcode-cn.com/problems/merge-intervals/">56. åˆå¹¶åŒºé—´</a></h4><p>å’Œä¹‹å‰çš„é‡å åŒºé—´æ˜¯ç±»ä¼¼çš„ï¼ŒæŠŠæ¡å¥½äº†é‡å æ¡ä»¶å³å¯</p><h4 id="376-æ‘†åŠ¨åºåˆ—"><a href="#376-æ‘†åŠ¨åºåˆ—" class="headerlink" title="376. æ‘†åŠ¨åºåˆ—"></a><a href="https://leetcode-cn.com/problems/wiggle-subsequence/">376. æ‘†åŠ¨åºåˆ—</a></h4><h2 id="Hard"><a href="#Hard" class="headerlink" title="Hard"></a>Hard</h2><h4 id="25-K-ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"><a href="#25-K-ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨" class="headerlink" title="25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/reverse-nodes-in-k-group/">25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</a></h4><p>é¦–å…ˆå¤ä¹ äº†ä¸€ä¸‹åè½¬é“¾è¡¨ï¼Œéƒ½æ˜¯å…¸å‹çš„é€’å½’å¤„ç†ï¼Œè¿™ä¸€é¢˜æ˜¯å»ºç«‹åœ¨åè½¬é“¾è¡¨ä¹‹ä¸Šçš„ã€‚ä¸è¿‡æ­¤é¢˜åœ¨è§£å†³é€’å½’æ—¶çš„åŸºç¡€æƒ…å†µéœ€è¦è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„åˆ¤æ–­ï¼šé“¾è¡¨çš„é•¿åº¦æ˜¯å¦å°äº kã€‚åˆ¤æ–­è¿‡åå†è¿›è¡Œæ¥ä¸‹æ¥çš„åè½¬</p><h4 id="85-æœ€å¤§çŸ©å½¢"><a href="#85-æœ€å¤§çŸ©å½¢" class="headerlink" title="85. æœ€å¤§çŸ©å½¢"></a><a href="https://leetcode-cn.com/problems/maximal-rectangle/">85. æœ€å¤§çŸ©å½¢</a></h4><p>è¿™ä¸€é¢˜æ˜¯ 84 é¢˜çš„å‡çº§ç‰ˆæœ¬ï¼Œéœ€è¦ 84 é¢˜çš„ç»“æœâ€¦å…³é”®ç‚¹åœ¨äºæ„å»º arrayã€‚è¿™é‡Œæ˜¯ä½¿ç”¨ä¸€ä¸ªæ•°ç»„è¿›è¡Œæ›´æ–°çš„å½¢å¼</p><h4 id="84-æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢"><a href="#84-æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢" class="headerlink" title="84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢"></a><a href="https://leetcode-cn.com/problems/largest-rectangle-in-histogram/">84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢</a></h4><p>è¿™ä¸€é¢˜ä½¿ç”¨å•è°ƒæ ˆï¼Œå¯ä»¥è¯´æ˜¯å•è°ƒæ ˆçš„æœ¬è´¨ï¼šå¯»æ‰¾å·¦ä¾§/å³ä¾§ç¬¬ä¸€ä¸ªå°äº/å¤§äºæŸä¸ªæ•°çš„æ•°å­—ã€‚è¿™ä¸€é¢˜è¿˜éœ€è¦ä½¿ç”¨â€å“¨å…µâ€œå˜é‡ï¼Œå¢å¼ºåŸæ•°ç»„ï¼Œè¿™æ ·å°±èƒ½å¤Ÿç»Ÿä¸€å¤„ç†ï¼Œè€Œä¸ç”¨ç‰¹æ®Šå¤„ç†å¼€å¤´å’Œç»“å°¾</p><h4 id="376-æ‘†åŠ¨åºåˆ—-1"><a href="#376-æ‘†åŠ¨åºåˆ—-1" class="headerlink" title="376. æ‘†åŠ¨åºåˆ—"></a><a href="https://leetcode-cn.com/problems/wiggle-subsequence/">376. æ‘†åŠ¨åºåˆ—</a></h4><p>å…ˆä½¿ç”¨äº†åŠ¨æ€è§„åˆ’ï¼Œæ˜¯ N æ–¹å¤æ‚åº¦ã€‚æ¥ç€è€ƒè™‘å°†å¤šæ¬¡å•è°ƒçš„æ•°å€¼å»é™¤ï¼Œä½¿ç”¨ O(N) å¤æ‚åº¦</p><h4 id="324-æ‘†åŠ¨æ’åº-II"><a href="#324-æ‘†åŠ¨æ’åº-II" class="headerlink" title="324. æ‘†åŠ¨æ’åº II"></a><a href="https://leetcode-cn.com/problems/wiggle-sort-ii/">324. æ‘†åŠ¨æ’åº II</a></h4><p>ä¸€ä¸ªå°ä¸€ä¸ªå¤§çš„è¿›è¡Œæ’åºï¼Œä½†æ˜¯è¦å€’ç€æ¥æ’ã€‚è¿™é‡Œè¦æ±‚æ—¶é—´å¤æ‚åº¦ O(N) å¯ä»¥ä½¿ç”¨æ¡¶æ’åºï¼Œå› ä¸ºæ•°å€¼çš„èŒƒå›´æ¯”è¾ƒå°</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h4 id="200-å²›å±¿æ•°é‡"><a href="#200-å²›å±¿æ•°é‡" class="headerlink" title="200. å²›å±¿æ•°é‡"></a><a href="https://leetcode-cn.com/problems/number-of-islands/">200. å²›å±¿æ•°é‡</a></h4><p>å¹¶æŸ¥é›†å¸¸å¸¸å¯ä»¥ä½¿ç”¨æ·±åº¦æœç´¢è¿›è¡Œæ›¿ä»£ï¼Œä»Šåé‡åˆ°å¹¶æŸ¥é›†ï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè¿é€šçš„ç»“æ„ï¼Œç„¶åä½¿ç”¨æ·±åº¦æœç´¢è§£å†³</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SPG &amp; BtcDet</title>
      <link href="/archives/199de5de.html"/>
      <url>/archives/199de5de.html</url>
      
        <content type="html"><![CDATA[<h1 id="SPG-amp-BtcDet"><a href="#SPG-amp-BtcDet" class="headerlink" title="SPG &amp; BtcDet"></a>SPG &amp; BtcDet</h1><hr><p>Xu, Qiangeng, et al. â€œSPG: Unsupervised Domain Adaptation for 3D Object Detection via Semantic Point Generation.â€ <em>ArXiv:2108.06709 [Cs]</em>, Aug. 2021. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/2108.06709">http://arxiv.org/abs/2108.06709</a>.</p><p>Xu, Qiangeng, et al. â€œBehind the Curtain: Learning Occluded Shapes for 3D Object Detection.â€ <em>ArXiv:2112.02205 [Cs]</em>, Dec. 2021. <em>arXiv.org</em>, <a href="http://arxiv.org/abs/2112.02205">http://arxiv.org/abs/2112.02205</a>.</p><hr><p>è¿™ä¸¤ç¯‡è®ºæ–‡æœ‰ç€éå¸¸ç›¸ä¼¼çš„æ€è·¯ï¼Œå®ƒä»¬éƒ½æ˜¯ä»ç‚¹äº‘çš„ç¨€ç–æ€§å‡ºå‘ï¼Œå°è¯•åœ¨åœºæ™¯å½“ä¸­ç”Ÿæˆå‰æ™¯ç‚¹ï¼Œæˆ–è€…åœ¨ç‰¹å¾å›¾è°±ä¸­èåˆå‰æ™¯ç‚¹å­˜åœ¨çš„æ¦‚ç‡</p><h2 id="SPG"><a href="#SPG" class="headerlink" title="SPG"></a>SPG</h2><h3 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h3><p>è®ºæ–‡é¦–å…ˆæå‡ºäº†é—®é¢˜ï¼šdomain shiftsï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®é›†ä¹‹é—´ï¼Œæ ·æœ¬çš„åˆ†å¸ƒæ˜¯æœ‰å·®å¼‚çš„ã€‚æœ‰çš„ç‚¹äº‘æ ·æœ¬å¯†åº¦è¾ƒå¤§ï¼Œè€Œæœ‰çš„ç‚¹äº‘é‡‡é›†å¯èƒ½ç”±äºå¤©æ°”çš„åŸå› ï¼Œå¯†åº¦è¾ƒå°ã€‚ä½¿ç”¨æ£€æµ‹å™¨åœ¨ç‚¹äº‘è¾ƒå°‘çš„åœºæ™¯ä¸­è¿›è¡Œé¢„æµ‹ï¼Œè¡¨ç°å°†ä¼šå¤§å¤§é™ä½</p><p>è®ºæ–‡æå‡ºè§£å†³æ–¹æ³•ï¼šSemantic Point Generation (SPG)ï¼Œä½¿ç”¨è½»é‡çº§ç¥ç»ç½‘ç»œåœ¨ç›¸å…³åœºæ™¯ (generation area) ä¸­ç”Ÿæˆå‰æ™¯ç‚¹ï¼Œä»¥è¡¥å¿ç‚¹äº‘æ¶ˆå¤±çš„éƒ¨åˆ†</p><h3 id="Domian-gap"><a href="#Domian-gap" class="headerlink" title="Domian gap"></a>Domian gap</h3><p>åœ¨æˆ‘ç†è§£ domain gap å°±æ˜¯åœ¨äºæ•°æ®é›†åˆ†å¸ƒçš„å·®å¼‚ã€‚åœ¨çœ‹è®ºæ–‡çš„æ—¶å€™çœ‹åˆ°äº† feature misalign é—®é¢˜ï¼Œè¿™é‡Œä¹Ÿæ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li>å¤šå°ºåº¦é—®é¢˜ã€‚ä¸€ä¸ªç‰¹å¾ç‚¹å¯¹åº”äº†å¤šä¸ªå°ºåº¦ï¼Œè¯¥é—®é¢˜å¯ä»¥ä½¿ç”¨ FPN è§£å†³ï¼Œæœ‰ä¸€ç§åˆ†æ²»çš„æ€æƒ³åœ¨é‡Œé¢ï¼Œå°ç›®æ ‡ä½¿ç”¨é«˜åˆ†è¾¨ç‡ç‰¹å¾ï¼Œå¤§ç›®æ ‡ä½¿ç”¨ä½åˆ†è¾¨ç‡ç‰¹å¾</li><li>anchor &amp; åˆ†ç±»å¾—åˆ†ä¸åŒ¹é…ã€‚å¯ä»¥é€šè¿‡ RCNN çš„ç»†åŒ–è§£å†³</li><li>é®æŒ¡ã€‚æ— æ³•è§£å†³è¿™æ ·çš„é—®é¢˜</li></ol><p>é™¤äº†ä½¿ç”¨ç‰¹å¾å¯¹é½çš„æ–¹æ³•ï¼Œè¿˜æœ‰çš„è®ºæ–‡å°†æ•°æ®ä»ä¸€ä¸ªåŸŸè½¬åˆ°å¦ä¸€ä¸ªåŸŸï¼Œæœ¬æ–‡ä¹Ÿåº”è¯¥å—åˆ°è¯¥æ–¹æ³•çš„å¯å‘</p><p>å¦å¤–è¿˜æåˆ°äº†ä½¿ç”¨å¯¹æŠ—ç”Ÿæˆç½‘ç»œæ¥è§£å†³çš„æ–¹æ³•ï¼Œä¸è¿‡æ²¡æœ‰æ·±å…¥</p><h3 id="Semantic-Point-Generation"><a href="#Semantic-Point-Generation" class="headerlink" title="Semantic Point Generation"></a>Semantic Point Generation</h3><p>å®šä¹‰åŸå§‹ç‚¹äº‘è¾“å…¥</p><script type="math/tex; mode=display">PC_{raw}={p_1,..,p_n} \in \mathbb R^{3+F}</script><p>Fï¼Œä»£è¡¨å…¶ä»–çš„åŸå§‹ç‰¹å¾ï¼Œä¾‹å¦‚åå°„å¼ºåº¦ã€‚å°†ç‚¹äº‘åœºæ™¯è¿›è¡Œä½“ç´ åŒ–ï¼Œå¯¹äºæ¯ä¸€ä¸ªä½“ç´ ï¼Œéƒ½å°†ç”Ÿæˆä¸€ä¸ªç½®ä¿¡åº¦ $\tilde P^f$ ä»¥åŠä¸€ä¸ªç‰¹å¾ $\tilde \phi$ ï¼Œå‰è€…è¡¨ç¤ºè¯¥ä½“ç´ æœ‰å‰æ™¯ç‚¹çš„æ¦‚ç‡ï¼Œåè€…è¡¨ç¤ºè¯¥ç‚¹çš„ç‰¹å¾ $(x, y, z, f)$</p><p>è™½ç„¶å¯¹æ¯ä¸€ä¸ªä½“ç´ éƒ½è¿›è¡Œäº†é¢„æµ‹ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„ä½“ç´ éƒ½å‚ä¸ç”Ÿæˆç‚¹äº‘ã€‚éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li>åœ¨ç”ŸæˆåŒºåŸŸå†…çš„ä½“ç´  generation areaã€‚ç”ŸæˆåŒºåŸŸå®šä¹‰ä¸ºåŸå§‹éç©ºä½“ç´ é™„è¿‘çš„åŒºåŸŸ</li><li>ç½®ä¿¡åº¦å¤§äºé˜ˆå€¼çš„ä½“ç´ </li></ol><h4 id="SPG-trainning-targets"><a href="#SPG-trainning-targets" class="headerlink" title="SPG trainning targets"></a>SPG trainning targets</h4><p>å‰é¢å¯¹äº SPG çš„ç›®çš„å·²ç»ä»‹ç»äº†ä¸€éƒ¨åˆ†ã€‚æ ‡ç­¾è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨äº†åŸå§‹ç‚¹äº‘ä¸­çš„éç©ºä½“ç´ ä»¥åŠåœ¨é€‰æ¡†å†…çš„ä½“ç´ ä½œä¸ºå‰æ™¯ä½“ç´ æ ‡ç­¾ï¼Œè¿›è¡Œè®­ç»ƒ</p><h4 id="Model-structure"><a href="#Model-structure" class="headerlink" title="Model structure"></a>Model structure</h4><p>æ¨¡å‹æ˜¯åŸºäº PointPillarsï¼Œä¸è¿‡åœ¨æœ€åå°† Pillars è¿˜åŸæˆä¸ºäº†ä½“ç´ ï¼Œè¿›è¡Œäº†ä¸¤éƒ¨åˆ†çš„é¢„æµ‹</p><p><img src="/archives/199de5de/image-20220316211604579.png" alt="image-20220316211604579" style="zoom: 50%;"></p><h4 id="Hide-and-predict"><a href="#Hide-and-predict" class="headerlink" title="Hide and predict"></a>Hide and predict</h4><p>è¿™æ˜¯è®ºæ–‡ä¸­çš„ä¸€ä¸ªè®­ç»ƒç­–ç•¥ï¼šå°†ä¸€éƒ¨åˆ†çš„ä½“ç´ ç§»é™¤ï¼Œä½†æ˜¯å…¶æ ‡ç­¾ä»ç„¶ä¿æŒã€‚è¿™æ ·å¤©ç„¶å½¢æˆäº†ä¸€äº›ç©ºä½“ç´ ï¼Œå¸Œæœ›ç½‘ç»œå»å­¦ä¹ ç”Ÿæˆç‚¹</p><p>ä¸ªäººè®¤ä¸ºï¼Œè¿™é‡Œä»æœ‰æ”¹è¿›ç©ºé—´ï¼šè¿™å¹¶æ²¡æœ‰æ˜ç¡®è®©ç½‘ç»œå»å­¦ä¹ ç¨€ç– -&gt; å¯†é›†è¿™æ ·çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚ä»…ä»…æ˜¯ç®€å•çš„ä¸‹é‡‡æ ·ï¼Œä¸èƒ½å¤Ÿæ¨¡æ‹Ÿå‡ºç‚¹äº‘ä¸­çš„ç¨€ç–åœºæ™¯ï¼Œæ›´éš¾ä»¥è¡¨è¾¾ç¨€ç–ç‰¹å¾å’Œå¯†é›†ç‰¹å¾ä¹‹é—´çš„å…³ç³»ã€‚å½“ç„¶è¿™æ ·çš„æ“ä½œè‚¯å®šæ˜¯å¯¹ç½‘ç»œæœ‰ç›Šçš„ï¼Œå¢åŠ äº† robustness</p><h4 id="Loss-functions"><a href="#Loss-functions" class="headerlink" title="Loss functions"></a>Loss functions</h4><p>å¯¹äºåˆ†ç±»çš„æŸå¤±å‡½æ•°ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†çš„æœ‰ä¸¤éƒ¨åˆ†ï¼š1. $V_e^f$ empty foreground voxel; 2. hidden voxel ç»™å®ƒä»¬åŠ ä¸Šäº†ä¸åŒçš„æƒé‡å³å¯ã€‚å…¶ä»–çš„ observed voxel &amp; empty background voxel ç…§å¸¸å¤„ç†</p><script type="math/tex; mode=display">\begin{aligned}L_{c l s} &=\frac{1}{\left|V_{o} \cup V_{e}^{b}\right|} \sum_{V_{o} \cup V_{e}^{b}} L_{\text {focal }} \\&+\frac{\alpha}{\left|V_{e}^{f}\right|} \sum_{V_{e}^{f}} L_{\text {focal }}+\frac{\beta}{\left|V_{\text {hide }}\right|} \sum_{V_{\text {hide }}} L_{\text {focal }}\end{aligned}</script><p>å¯¹äºå›å½’çš„æŸå¤±å‡½æ•°ï¼Œä»…å¯¹ observed voxel &amp; hidden voxel åšå›å½’æŸå¤±</p><script type="math/tex; mode=display">\begin{aligned}L_{r e g} &=\frac{1}{\left|V_{o}^{f}\right|} \sum_{V_{o}^{f}} L_{\text {smooth-L1 }}(\tilde{\psi}, \psi) \\&+\frac{\beta}{\left|V_{h i d e}^{f}\right|} \sum_{V_{\text {hide }}^{f}} L_{\text {smooth }-L 1}(\tilde{\psi}, \psi)\end{aligned}</script><p>å…¶ä¸­ $\alpha = 0.5, \beta =2.0$ï¼Œå¹¶ä¸”<strong>æ‰€æœ‰çš„ä½“ç´ éƒ½å¿…é¡»æ˜¯ generation area ä¹‹å†…çš„ä½“ç´ </strong></p><h3 id="Experiments"><a href="#Experiments" class="headerlink" title="Experiments"></a>Experiments</h3><p>è®­ç»ƒæ˜¯åœ¨ Waymo Open Dataset ä¸Šè®­ç»ƒçš„ï¼Œå¹¶åœ¨ Waymo Open Dataset &amp; KirK ä¸Šéƒ½è¿›è¡Œäº†æµ‹è¯•</p><p><img src="/archives/199de5de/image-20220316214602575.png" alt="image-20220316214602575" style="zoom: 50%;"></p><p>åœ¨ KITTI æµ‹è¯•é›†ä¸Šä¹Ÿè¿›è¡Œäº†å®éªŒ</p><p><img src="/archives/199de5de/image-20220316214637192.png" alt="image-20220316214637192" style="zoom:50%;"></p><p>KITTI éªŒè¯é›†</p><p><img src="/archives/199de5de/image-20220316214808815.png" alt="image-20220316214808815" style="zoom:50%;"></p><p>SPG ä¸å„ç§ç­–ç•¥çš„æ¯”è¾ƒ</p><p><img src="/archives/199de5de/image-20220316214710727.png" alt="image-20220316214710727" style="zoom:50%;"></p><p>å…¶ä¸­ k-frames æ˜¯å°† k å¸§ç‚¹äº‘è¿›è¡Œå åŠ ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç¨³å®šæ¶¨ç‚¹æŠ€å·§ä½†æ˜¯éœ€è¦å¤§é‡çš„å†…å­˜å’Œå¤„ç†æ—¶é—´ã€‚SPG å¾ˆè½»é‡ï¼ŒåªåŠ å…¥äº† 8k ä¸ªç‚¹ï¼Œå¹¶ä¸”å‚æ•°å°‘é€Ÿåº¦å¿«</p><h2 id="BtcDet"><a href="#BtcDet" class="headerlink" title="BtcDet"></a>BtcDet</h2><p>è¿™ç¯‡è®ºæ–‡ç›¸å¯¹äº SPG æ„Ÿè§‰æ›´æ™¦æ¶©æ›´ç»†è‡´ï¼Œä½†æ˜¯å‡ºå‘ç‚¹ä¾ç„¶æ˜¯å¯¹äºæ¶ˆå¤±ç‚¹äº‘çš„è¡¥å¿ã€‚æœ¬æ–‡æ›´è¿›ä¸€æ­¥å¯¹æ¶ˆå¤±ç‚¹äº‘ä»¥åŠ<strong>æ¶ˆå¤±å½¢çŠ¶</strong>è¿›è¡Œå­¦ä¹ </p><h3 id="Causes-of-shape-miss"><a href="#Causes-of-shape-miss" class="headerlink" title="Causes of shape miss"></a>Causes of shape miss</h3><ol><li>Signal missï¼Œä¿¡å·æ¶ˆå¤±ã€‚è¿™é‡Œæˆ‘ç†è§£ä¸ºæ¿€å…‰ç©¿è¿‡äº†ç»ç’ƒç±»ä¼¼çš„ç‰©è´¨ï¼Œæˆ–è€…åå°„è§’å¤ªå¤§ï¼Œæˆ–è€…è¢«ç‰©è´¨å¸æ”¶ï¼Œæ²¡åŠæ³•è¿›è¡Œè¿”å›</li><li>Occlusionï¼Œé®æŒ¡ã€‚åæ–¹ç‰©ä½“è¢«å‰æ–¹ç‰©ä½“é®æŒ¡</li><li>ä¿¡å·å‘æ•£ã€‚è¿™æ˜¯ç‚¹äº‘è‡ªèº«ç‰¹ç‚¹é€ æˆï¼Œè¶Šè¿œå¤„çš„åœ°æ–¹ï¼Œç‚¹äº‘å°†è¶Šç¨€ç–</li></ol><p>è®ºæ–‡æŒ‡å‡ºï¼Œåœ¨ç‚¹äº‘å¯†é›†çš„åœ°æ–¹ï¼Œç°åœ¨çš„ SOTA æ£€æµ‹å™¨èƒ½å¤Ÿéå¸¸éå¸¸ç²¾å‡†åœ°è¯†åˆ«å‡ºæ¥ï¼Œè¿™ä¹Ÿæ˜¯å¯¹ç‚¹äº‘è¡¥å¿çš„å‡ºå‘ç‚¹</p><h3 id="Learning-shapes-for-3D-object-detection"><a href="#Learning-shapes-for-3D-object-detection" class="headerlink" title="Learning shapes for 3D object detection"></a>Learning shapes for 3D object detection</h3><p>åœ¨ä¹‹å‰çš„è®ºæ–‡å¦‚ SA-SSD &amp; PV-RCNN å·²ç»è¯æ˜å­¦ä¹ ç»“æ„ä¿¡æ¯ï¼ˆå‰æ™¯ç‚¹åˆ†å‰²ï¼Œä¸­å¿ƒç‚¹é¢„æµ‹ï¼‰å¯¹äºç›®æ ‡æ£€æµ‹æ˜¯æœ‰æå‡çš„ã€‚ä½†æ˜¯å®ƒä»¬å¿½ç•¥äº†æ¶ˆå¤±å½¢çŠ¶çš„å½±å“</p><h3 id="Learning-shapes-in-occlusion"><a href="#Learning-shapes-in-occlusion" class="headerlink" title="Learning shapes in occlusion"></a>Learning shapes in occlusion</h3><h4 id="Approximate-the-complete-shapes"><a href="#Approximate-the-complete-shapes" class="headerlink" title="Approximate the complete shapes"></a>Approximate the complete shapes</h4><p>é¦–å…ˆæˆ‘ä»¬å¾—çŸ¥é“å®Œæ•´çš„å½¢çŠ¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°å­¦ä¹ ã€‚è®ºæ–‡é‡‡å–çš„ç­–ç•¥æœ‰ä¸¤ä¸ª</p><ol><li><p>é•œåƒã€‚å› ä¸ºå¤§å¤šæ•°ç›®æ ‡éƒ½æ˜¯é•œåƒå¯¹ç§°çš„ï¼Œå¯¹ç§°å°†è¡¥å……éƒ¨åˆ†ç‚¹äº‘</p></li><li><p>å‘å…¶ä»–åŒç±» object â€œå€Ÿâ€ã€‚è®ºæ–‡æ„é€ äº†ä¸€ä¸ªå‡½æ•° $H(A,B)$ æ¥è¯„ä¼°B ç‰©ä½“æ˜¯å¦å°½å¯èƒ½è¡¥å…¨ A ç‰©ä½“</p><script type="math/tex; mode=display">\begin{aligned}\mathcal{H}(A, B) &=\sum_{x \in P_{A}} \min _{y \in P_{B}}\|x-y\|-\alpha \operatorname{IoU}\left(\mathcal{D}_{A}, \mathcal{D}_{B}\right) \\&+\beta /\left|\left\{x: x \in \operatorname{Vox}\left(P_{B}\right), x \notin \operatorname{Vox}\left(P_{A}\right)\right\}\right|\end{aligned}</script><p>ç¬¬ä¸€é¡¹å¸Œæœ› B çš„ç‚¹å°½é‡è¦†ç›– A çš„ç‚¹</p><p>ç¬¬äºŒé¡¹å¸Œæœ›äºŒè€…çš„ IoU å°½é‡å¤§</p><p>ç¬¬ä¸‰é¡¹å¸Œæœ› B ä¸­çš„ voxel å°½é‡å¤šçš„ä¸å±äº A</p><p>å¯å‘å¼å‡½æ•°è¶Šä½è¶Šå¥½ï¼Œä»£è¡¨ B æ›´èƒ½è¦†ç›–å’Œå¡«è¡¥ Aã€‚å¯¹ A ç‰©ä½“ï¼Œé€‰æ‹©å¾—åˆ†æœ€é«˜çš„3ä¸ªç‰©ä½“ï¼Œå¹¶å°†å®ƒä»¬çš„ç‚¹äº‘å€Ÿç»™ A ä½œä¸ºè¡¥å……</p></li></ol><h4 id="Identify-R-oc-cup-R-sm-in-spherical-coordinate"><a href="#Identify-R-oc-cup-R-sm-in-spherical-coordinate" class="headerlink" title="Identify $R_{oc} \cup R_{sm}$ in spherical coordinate"></a>Identify $R_{oc} \cup R_{sm}$ in spherical coordinate</h4><p>è¿™ä¸ªæåæ ‡ç³»ä¹Ÿæ˜¯æœ¬æ–‡æœ‰ç‚¹éš¾ä»¥ç†è§£çš„ã€‚å¯¹äº occlusion åŒºåŸŸï¼Œæ˜¯æŒ‡æŸä¸ªéç©ºå¼§å½¢ä½“ç´ åŠå…¶ä¹‹åçš„å¼§å½¢ä½“ç´ åŒºåŸŸã€‚å¯¹äº signal missing åŒºåŸŸéœ€è¦ä½¿ç”¨ range view æ¥ç†è§£ã€‚ç†è®ºä¸Šæ¥è®² Lidar çš„ range view åº”è¯¥æ˜¯é“ºæ»¡æ•´ä¸ªå¹³é¢çš„ï¼Œä½†ç”±äº signal missingï¼Œrange view ä¼šç¼ºå¤±ã€‚å¦‚æœ spherical voxel æ˜ å°„åˆ°ç¼ºå¤±åŒºåŸŸä¸­ï¼Œå°±è®¤å®šè¯¥ spherical voxel å±äº signal missing åŒºåŸŸ</p><p><img src="/archives/199de5de/image-20220317000714947.png" alt="image-20220317000714947" style="zoom:50%;"></p><h4 id="Training-targets"><a href="#Training-targets" class="headerlink" title="Training targets"></a>Training targets</h4><p>æ­¤æ—¶ targets å°±ä¸æ˜¯ç®€å•çš„ä½¿ç”¨åŸå§‹ç‚¹äº‘åœºæ™¯äº†ã€‚è€Œæ˜¯ä½¿ç”¨ç»è¿‡ç›®æ ‡è¡¥å…¨çš„ç‚¹äº‘åœºæ™¯</p><h4 id="Estimate-the-shape-occupancy"><a href="#Estimate-the-shape-occupancy" class="headerlink" title="Estimate the shape occupancy"></a>Estimate the shape occupancy</h4><p>BtcDet å°†é¢„æµ‹åœ¨é®æŒ¡å’Œæ¶ˆå¤±åŒºåŸŸçš„ spherical voxel å«æœ‰ç‚¹äº‘çš„æ¦‚ç‡ã€‚å®ƒä¸ä½œä»»ä½•çš„ç‚¹äº‘ç”Ÿæˆï¼Œè¿™ä¹Ÿæ˜¯ä¸ SPG çš„ä¸€ä¸ªåŒºåˆ«ã€‚SPG å…³æ³¨çš„æ˜¯åœ¨ç©ºä½“ç´ å¤„æ˜¯å¦å«æœ‰å‰æ™¯ç‚¹ï¼ˆåœ¨ bbox ä¸­å³å¯ï¼‰ï¼Œè€Œæœ¬æ–‡å…³æ³¨çš„æ˜¯åœ¨é®æŒ¡å’Œä¿¡å·æ¶ˆå¤±çš„åŒºåŸŸæ˜¯å¦å«æœ‰ç›®æ ‡ç‚¹ï¼ˆæ›´ç²¾ç»†ï¼‰</p><p>æŸå¤±å‡½æ•°å¦‚ä¸‹ï¼Œä»…å…³æ³¨é®æŒ¡å’Œä¿¡å·æ¶ˆå¤±çš„åŒºåŸŸ</p><script type="math/tex; mode=display">\mathcal{L}_{\text {shape }}=\frac{\sum_{v \in \mathcal{R}_{\mathcal{O C}} \cup \mathcal{R}_{\mathcal{S M}}} w_{v} \cdot \mathcal{L}_{\text {focal }}\left(p_{v}\right)}{\left|\mathcal{R}_{\mathcal{O C}} \cup \mathcal{R}_{\mathcal{S M}}\right|} \text {, }\\where\  w_{v}=\left\{\begin{array}{ll}\delta & \text { if } v \in \text { regions of shape miss } \\ 1 & \text { otherwise. }\end{array}\right.</script><p> å¯¹äºå€Ÿæ¥çš„ç‚¹ä»¥åŠç©ºçš„ voxel éƒ½ä½¿ç”¨æƒé‡ Î´</p><p>è¿˜å€¼å¾—æåˆ°æ˜¯ï¼Œè®ºæ–‡ä½¿ç”¨çš„æ˜¯æåæ ‡ç³»ä¸‹çš„ 3d ç¨€ç–å·ç§¯æ¥æå–æ¯ä¸€ä¸ªä½“ç´ çš„ç‰¹å¾</p><h3 id="Shape-Occupancy-Probability-Integration"><a href="#Shape-Occupancy-Probability-Integration" class="headerlink" title="Shape Occupancy Probability Integration"></a>Shape Occupancy Probability Integration</h3><p>å¾—åˆ°äº†ä¸€ä¸ª spherical coordinate feature map $P(Occupancy)$ï¼Œè¡¨ç¤ºäº†å„ä¸ªå¼§å½¢ä½“ç´ ä¸­æ˜¯å¦åŒ…å«ç›®æ ‡ç‚¹</p><p>å…ˆæŠŠæåæ ‡ç³»è½¬æ¢åˆ°ç¬›å¡å°”åæ ‡ç³»ï¼Œè¿™æ ·æ–¹ä¾¿å’Œå…¶ä»–ç‰¹å¾å›¾è°±è¿›è¡Œèåˆï¼Œé€šè¿‡ä¸‹é‡‡æ ·å¯ä»¥å¾—åˆ°å’Œå…¶ä»–ç‰¹å¾å›¾è°±ç›¸åŒåˆ†è¾¨ç‡</p><p><img src="/archives/199de5de/image-20220317003143105.png" alt="image-20220317003143105" style="zoom:50%;"></p><h3 id="Experiments-1"><a href="#Experiments-1" class="headerlink" title="Experiments"></a>Experiments</h3><p>åœ¨ KITTI æ•°æ®é›†ä¸Šæ¨ªæ‰«</p><p><img src="/archives/199de5de/image-20220317003314223.png" alt="image-20220317003314223" style="zoom:50%;"></p><p>åœ¨ waymo æ•°æ®é›†ä¸Šæ¨ªæ‰«</p><p><img src="/archives/199de5de/image-20220317003337540.png" alt="image-20220317003337540" style="zoom:50%;"></p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SPG </tag>
            
            <tag> BtcDet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python Useful Packages</title>
      <link href="/archives/d99f910b.html"/>
      <url>/archives/d99f910b.html</url>
      
        <content type="html"><![CDATA[<h1 id="Python-Useful-Packages"><a href="#Python-Useful-Packages" class="headerlink" title="Python Useful Packages"></a>Python Useful Packages</h1><h2 id="pathlib"><a href="#pathlib" class="headerlink" title="pathlib"></a>pathlib</h2><h3 id="å–è·¯å¾„"><a href="#å–è·¯å¾„" class="headerlink" title="å–è·¯å¾„"></a>å–è·¯å¾„</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path<span class="token comment"># å½“å‰å·¥ä½œç›®å½•</span>Path<span class="token punctuation">.</span>cwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># å½“å‰æ–‡ä»¶è·¯å¾„</span>Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token comment"># ä»»æ„å­—ç¬¦ä¸²è·¯å¾„</span>Path<span class="token punctuation">(</span><span class="token string">'abc/file.py'</span><span class="token punctuation">)</span><span class="token comment"># è·å–ç»å¯¹è·¯å¾„</span>Path<span class="token punctuation">(</span><span class="token string">'abc/file.py'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·å–è·¯å¾„ç»„æˆéƒ¨åˆ†"><a href="#è·å–è·¯å¾„ç»„æˆéƒ¨åˆ†" class="headerlink" title="è·å–è·¯å¾„ç»„æˆéƒ¨åˆ†"></a>è·å–è·¯å¾„ç»„æˆéƒ¨åˆ†</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">file</span> <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'abc/file.py'</span><span class="token punctuation">)</span><span class="token comment"># æ–‡ä»¶å</span><span class="token builtin">file</span><span class="token punctuation">.</span>name<span class="token comment"># æ–‡ä»¶åï¼Œä¸å«åç¼€</span><span class="token builtin">file</span><span class="token punctuation">.</span>stem<span class="token comment"># åç¼€</span><span class="token builtin">file</span><span class="token punctuation">.</span>suffix<span class="token comment"># çˆ¶çº§ç›®å½•</span><span class="token builtin">file</span><span class="token punctuation">.</span>parent<span class="token comment"># è·å¾—æ‰€æœ‰çˆ¶çº§ç›®å½•</span><span class="token builtin">file</span><span class="token punctuation">.</span>parents<span class="token builtin">file</span><span class="token punctuation">.</span>parents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token comment"># ä¸Šçº§ abc</span><span class="token builtin">file</span><span class="token punctuation">.</span>parents<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment"># ä¸Šä¸Šçº§ .</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹ <code>file</code> è·å¾—çˆ¶çº§ç›®å½•æ—¶ï¼Œä»…å¯¹æ‰€è¾“å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œ <code>abc/file.py</code>ï¼Œå¦‚æœæƒ³è¦è·å¾—ç»å¯¹è·¯å¾„ä¸‹çš„çˆ¶çº§ç›®å½•ï¼Œè¯·å…ˆä½¿ç”¨ <code>.resolve()</code> è·å¾—ç»å¯¹ç›®å½•</p><h3 id="å­è·¯å¾„æ‰«æ"><a href="#å­è·¯å¾„æ‰«æ" class="headerlink" title="å­è·¯å¾„æ‰«æ"></a>å­è·¯å¾„æ‰«æ</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">path <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token comment"># éå†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶/å­ç›®å½•, ä½†ä¸ä¼šé€’å½’éå†å­ç›®å½•</span>files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> path<span class="token punctuation">.</span>iterdir<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment"># æŸ¥æ‰¾ç›®å½•ä¸‹çš„æŒ‡å®šæ–‡ä»¶, é€šå¸¸æŸ¥æ‰¾æŸåç¼€åæ–‡ä»¶</span>files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> path<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'*.txt'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment"># å­ç›®å½•é€’å½’æŸ¥è¯¢</span>files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> path<span class="token punctuation">.</span>rglob<span class="token punctuation">(</span><span class="token string">'*.txt'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·¯å¾„æ‹¼æ¥"><a href="#è·¯å¾„æ‹¼æ¥" class="headerlink" title="è·¯å¾„æ‹¼æ¥"></a>è·¯å¾„æ‹¼æ¥</h3><p>é‡è½½é™¤æ³•ç®—ç¬¦ï¼Œéå¸¸å¥½ç”¨ğŸ‘</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">path <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>new_file <span class="token operator">=</span> <span class="token builtin">file</span> <span class="token operator">/</span> <span class="token string">'dir'</span> <span class="token operator">/</span> <span class="token string">'file.txt'</span><span class="token keyword">print</span><span class="token punctuation">(</span>new_file<span class="token punctuation">)</span><span class="token comment"># ./dir/file.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·¯å¾„åˆ¤æ–­"><a href="#è·¯å¾„åˆ¤æ–­" class="headerlink" title="è·¯å¾„åˆ¤æ–­"></a>è·¯å¾„åˆ¤æ–­</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">file</span> <span class="token operator">=</span> Path<span class="token punctuation">(</span>any_str<span class="token punctuation">)</span><span class="token comment"># æ˜¯å¦ä¸ºæ–‡ä»¶</span><span class="token builtin">file</span><span class="token punctuation">.</span>is_file<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># æ˜¯å¦ä¸ºç›®å½•</span><span class="token builtin">file</span><span class="token punctuation">.</span>is_dir<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># æ˜¯å¦å­˜åœ¨</span><span class="token builtin">file</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">file</span> <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'hello.txt'</span><span class="token punctuation">)</span><span class="token comment"># åˆ›å»ºæ–‡ä»¶ touch</span><span class="token builtin">file</span><span class="token punctuation">.</span>touch<span class="token punctuation">(</span>exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment"># exist_ok = False æ–‡ä»¶ä¸å­˜åœ¨æ—¶æ‰èƒ½åˆ›å»º, å¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™æŠ¥é”™</span><span class="token builtin">file</span><span class="token punctuation">.</span>touch<span class="token punctuation">(</span>exist_ok<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token comment"># è¯»å–ä¸å†™å…¥æ–‡æœ¬</span><span class="token comment"># pathlib å¯¹è¯»å–å’Œå†™å…¥è¿›è¡Œäº†ç®€å•å°è£…, ä¸ç”¨ open æ“ä½œ</span><span class="token builtin">file</span><span class="token punctuation">.</span>read_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token builtin">file</span><span class="token punctuation">.</span>write_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># æ‰“å¼€æ–‡ä»¶</span><span class="token keyword">with</span> <span class="token builtin">file</span><span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token comment"># é‡å‘½åæ–‡ä»¶</span><span class="token builtin">file</span><span class="token punctuation">.</span>rename<span class="token punctuation">(</span>new_name<span class="token punctuation">)</span><span class="token comment"># åˆ›å»ºç›®å½•</span>path <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'dir/'</span><span class="token punctuation">)</span><span class="token comment"># parents = True å¯ä»¥åˆ›å»ºå¤šçº§ç›®å½•</span>path<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>parents<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment"># åˆ é™¤ç›®å½•</span><span class="token comment"># ä¸€æ¬¡åªèƒ½åˆ é™¤ä¸€çº§ç›®å½•, ä¸”ç›®å½•å¿…é¡»ä¸ºç©º</span>path<span class="token punctuation">.</span>rmdir<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># å…¶å® pathlib çš„åŠŸèƒ½å¹¶ä¸æ˜¯ä¸ºäº†åˆ é™¤æ–‡ä»¶</span><span class="token comment"># å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•åˆ é™¤æ–‡ä»¶å’Œç›®å½•</span><span class="token keyword">import</span> shutil<span class="token keyword">import</span> osos<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>dir_path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„ä»£ç ï¼Œå› ä¸ºæœ‰æ—¶å€™æƒ³è¦åˆ é™¤ pycache &amp; gnu.so æ–‡ä»¶ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åœ¨ root dir å°±å¯ä»¥äº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># clean pycache &amp; gnu.so</span><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path<span class="token keyword">import</span> shutil<span class="token punctuation">,</span> osdelete_file <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'__pycache__'</span><span class="token punctuation">,</span> <span class="token string">'*gnu.so'</span><span class="token punctuation">]</span>root_dir <span class="token operator">=</span> Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>parent<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'root dir: </span><span class="token interpolation"><span class="token punctuation">{</span>root_dir<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> delete_file<span class="token punctuation">:</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> root_dir<span class="token punctuation">.</span>rglob<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> item<span class="token punctuation">.</span>is_dir<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>item<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>item<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'deleting </span><span class="token interpolation"><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tqdm"><a href="#tqdm" class="headerlink" title="tqdm"></a>tqdm</h2><p>å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/163613814">zhihu</a></p><p>tqdm ä¸»è¦æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š</p><ol><li><p>åŸºäºè¿­ä»£å¯¹è±¡ï¼Œä½ å¯ä»¥æŠŠ tqdm å½“æˆæ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œä¸å½±å“åŸæ¥è¿­ä»£å¯¹è±¡çš„ä½¿ç”¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm<span class="token keyword">import</span> timedic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">]</span><span class="token keyword">for</span> item <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>dic<span class="token punctuation">)</span><span class="token punctuation">:</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ‰‹åŠ¨è¿›è¡Œæ›´æ–°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">pbar <span class="token operator">=</span> tqdm<span class="token punctuation">(</span>dic<span class="token punctuation">)</span><span class="token keyword">for</span> item <span class="token keyword">in</span> dic<span class="token punctuation">:</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>    pbar<span class="token punctuation">.</span>update<span class="token punctuation">(</span>n<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰‹åŠ¨æ›´æ–°è¿˜èƒ½æœ‰æ›´å¤šçš„åŠŸèƒ½</p><ol><li><code>pbar.set_description(desc)</code></li><li><code>pbat.set_postfix(dict)</code></li><li><code>pbar.refresh()</code> å¼ºåˆ¶æ›´æ–°</li></ol></li></ol><p>é™¤æ­¤ä¹‹å¤–è¿˜ç»å¸¸ä½¿ç”¨ trange æ¥å¿«é€Ÿåˆ›å»º</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> tqdm <span class="token keyword">import</span> trangepbar <span class="token operator">=</span> trange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>tbar <span class="token operator">=</span> tqdm<span class="token punctuation">(</span>total<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment"># ä¸å¯è¿­ä»£ï¼Œä»…æ”¯æŒæ‰‹åŠ¨æ›´æ–°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶å¦‚æœæœ‰åµŒå¥—è¿›åº¦æ¡çš„è¯éœ€è¦æŒ‡å®š <code>leave</code> å‚æ•°ï¼Œè¿™æ ·åœ¨å¾ªç¯å®Œæˆåè¿›åº¦æ¡ä¸ä¼šç•™åœ¨ shell è¾“å‡º</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> trange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> leave<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tbar<span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> tbar<span class="token punctuation">:</span>        pbar <span class="token operator">=</span> trange<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> leave<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> t <span class="token keyword">in</span> pbar<span class="token punctuation">:</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="tensorboard"><a href="#tensorboard" class="headerlink" title="tensorboard"></a>tensorboard</h2><p>TODO</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Package </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SVM</title>
      <link href="/archives/75378e04.html"/>
      <url>/archives/75378e04.html</url>
      
        <content type="html"><![CDATA[<h2 id="SVM"><a href="#SVM" class="headerlink" title="SVM"></a>SVM</h2><p>æ”¯æ’‘å‘é‡æœºï¼ˆSVMï¼‰ç®—æ³•åœ¨åˆ†ç±»é—®é¢˜ä¸­æœ‰ç€é‡è¦åœ°ä½ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯æœ€å¤§åŒ–ä¸¤ç±»ä¹‹é—´çš„é—´éš”</p><p>æ•°æ®é›†å¯åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š</p><ol><li>çº¿æ€§å¯åˆ†</li><li>çº¿æ€§ä¸å¯åˆ†ï¼Œä½†åœ¨å»æ‰å°‘é‡å™ªå£°ç‚¹åçº¿æ€§å¯åˆ†</li><li>çº¿æ€§ä¸å¯åˆ†ï¼Œå®Œå…¨ä¸å¯åˆ†ï¼</li></ol><p>é’ˆå¯¹ä»¥ä¸Šä¸‰ç§æ•°æ®é›†ï¼Œå‘å±•å‡ºæ¥ä¸‰ç§ SVMï¼š</p><ol><li>Hard-margin SVM</li><li>Soft-margin SVM</li><li>Kernel method</li></ol><p>SVM çš„æ±‚è§£ä¸­ï¼Œå¤§é‡ç”¨åˆ°äº† Lagrange ä¹˜å­æ³•ï¼Œé¦–å…ˆå¯¹è¿™ç§æ–¹æ³•è¿›è¡Œä»‹ç»</p><h2 id="ä¼˜åŒ–é—®é¢˜"><a href="#ä¼˜åŒ–é—®é¢˜" class="headerlink" title="ä¼˜åŒ–é—®é¢˜"></a>ä¼˜åŒ–é—®é¢˜</h2><h3 id="çº¦æŸä¼˜åŒ–ä¸æ— çº¦æŸä¼˜åŒ–"><a href="#çº¦æŸä¼˜åŒ–ä¸æ— çº¦æŸä¼˜åŒ–" class="headerlink" title="çº¦æŸä¼˜åŒ–ä¸æ— çº¦æŸä¼˜åŒ–"></a>çº¦æŸä¼˜åŒ–ä¸æ— çº¦æŸä¼˜åŒ–</h3><p>ä¸€èˆ¬åœ°ï¼Œçº¦æŸä¼˜åŒ–é—®é¢˜ï¼ˆåŸé—®é¢˜ï¼‰å¯ä»¥å†™æˆ</p><script type="math/tex; mode=display">\begin{align}&\min_{x\in\mathbb{R^p}}f(x)\\&s.t.\ m_i(x)\le0,i=1,2,\cdots,M\\&\ \ \ \ \ \ \ \ n_j(x)=0,j=1,2,\cdots,N\end{align}</script><p>å®šä¹‰ Lagrange å‡½æ•°ï¼š</p><script type="math/tex; mode=display">L(x,\lambda,\eta)=f(x)+\sum\limits_{i=1}^M\lambda_im_i(x)+\sum\limits_{i=1}^N\eta_in_i(x)</script><p>é‚£ä¹ˆåŸé—®é¢˜å¯ä»¥ç­‰ä»·äºæ— çº¦æŸå½¢å¼ï¼š</p><script type="math/tex; mode=display">\min_{x\in\mathbb{R}^p}\max_{\lambda,\eta}L(x,\lambda,\eta)\ s.t.\ \lambda_i\ge0</script><p>è¿™äºŒè€…ç­‰ä»·çš„è¯æ˜ï¼Œå¯ä»¥å»çœ‹ä¸€ä¸‹åŸè§†é¢‘ï¼Œè®²å¾—éå¸¸æ¸…æ¥šã€‚å¦‚æœå¯ä»¥å°†å‡½æ•°å›¾åƒç”»å‡ºæ¥ï¼Œå¯ä»¥å‘ç°ï¼Œå½“çº¦æŸæ¡ä»¶ä¸æ»¡è¶³çš„æ—¶å€™ï¼Œä¸‹é¢è¿™ä¸ªå‡½æ•°å°†å¯ä»¥è¶‹è¿‘äºæ— ç©·å¤§ğŸ‘‡</p><script type="math/tex; mode=display">f'(x) = \max_{\lambda,\eta}L(x,\lambda,\eta)\ s.t.\ \lambda_i\ge0</script><p>å†å¯¹ä¸Šé¢è¿™ä¸ªå‡½æ•°å–æœ€å°å€¼æ—¶ï¼Œæ˜¾ç„¶æˆ‘ä»¬ä¸ä¼šå–åˆ°ä¸æ»¡è¶³çº¦æŸæ¡ä»¶çš„ $x$ï¼Œè¿™å°±å¤©ç„¶è¿‡æ»¤äº†ä¸ç¬¦åˆçº¦æŸæ¡ä»¶çš„ $x$ã€‚é‚£ä¹ˆæ­¤æ—¶å¯ä»¥è®¤ä¸º</p><script type="math/tex; mode=display">f'(x) = \max_{\lambda,\eta}L(x,\lambda,\eta)=f(x)\\s.t.\lambda_i\ge0,m(x_i) \le 0</script><p>å› ä¸ºä¸€ä¸ªæ•°å‡å»ä¸€ä¸ªéè´Ÿå‡½æ•°è‚¯å®šå°äºç­‰äºå…¶æœ¬èº«ï¼Œä½†æ˜¯ç­‰å·æ˜¯å¯ä»¥å–å¾—çš„ï¼Œæ‰€ä»¥å…¶æœ€å¤§å€¼å¿…å®šç­‰äºå…¶æœ¬èº«ã€‚å†å¯¹ä»¥ä¸Šæ±‚æœ€å°å€¼å°±å¾—åˆ°äº†åŸé—®é¢˜äº†ï¼Œå¯ä»¥è®¤ä¸ºä»¥ä¸Šçš„æ¨å¯¼æ˜¯åŒç®­å¤´ï¼Œæ‰€ä»¥åŸé—®é¢˜å’Œæ— çº¦æŸé—®é¢˜ç­‰ä»·</p><h3 id="åŸé—®é¢˜ä¸å¯¹å¶é—®é¢˜"><a href="#åŸé—®é¢˜ä¸å¯¹å¶é—®é¢˜" class="headerlink" title="åŸé—®é¢˜ä¸å¯¹å¶é—®é¢˜"></a>åŸé—®é¢˜ä¸å¯¹å¶é—®é¢˜</h3><p>åŸé—®é¢˜</p><script type="math/tex; mode=display">\min_{x\in\mathbb{R}^p}\max_{\lambda,\eta}L(x,\lambda,\eta)\ s.t.\ \lambda_i\ge0</script><p>å¯¹å¶é—®é¢˜</p><script type="math/tex; mode=display">\max_{\lambda,\eta}\min_{x\in\mathbb{R}^p}L(x,\lambda,\eta)\ s.t.\ \lambda_i\ge0</script><p>å¯ä»¥çœ‹åˆ°æŠŠ max &amp; min çš„ä½ç½®äº¤æ¢äº†ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯éå¸¸ç®€å•ï¼</p><p>å¯ä»¥è¯æ˜å¯¹å¶é—®é¢˜çš„è§£ â‰¤ åŸé—®é¢˜çš„è§£ï¼ŒåŸè§†é¢‘ç”¨äº†é¸¡å¤´å‡¤å°¾å½¢è±¡çš„æ¯”å–»ï¼Œæ•°å­¦è¯­è¨€ä¹Ÿå¾ˆç®€å•</p><blockquote><p>æ˜¾ç„¶æœ‰ $\min\limits_{x}L\le L\le\max\limits_{\lambda,\eta}L$ï¼Œäºæ˜¯æ˜¾ç„¶æœ‰ $\max\limits_{\lambda,\eta}\min\limits_{x}L\le L$ï¼Œä¸” $\min\limits_{x}\max\limits_{\lambda,\eta}L\ge L$ã€‚</p></blockquote><h3 id="å¼ºå¼±å¯¹å¶æ€§"><a href="#å¼ºå¼±å¯¹å¶æ€§" class="headerlink" title="å¼ºå¼±å¯¹å¶æ€§"></a>å¼ºå¼±å¯¹å¶æ€§</h3><p>å®šä¹‰å¼ºå¼±å¯¹å¶æ€§å¦‚ä¸‹ï¼š</p><ol><li>å¼±å¯¹å¶æ€§ï¼šå¯¹å¶é—®é¢˜çš„è§£ â‰¤ åŸé—®é¢˜çš„è§£</li><li>å¼ºå¯¹å¶æ€§ï¼šå¯¹å¶é—®é¢˜çš„è§£ = åŸé—®é¢˜çš„è§£</li></ol><p>å¼±å¯¹å¶æ€§ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ç§å‡ ä½•æ–¹æ³•è¡¨ç¤º</p><p><img src="/archives/75378e04/image-20220311215838515.png" alt="image-20220311215838515">å¯¹äºä¸€ä¸ªå‡¸ä¼˜åŒ–é—®é¢˜ï¼Œå¦‚æœæ»¡è¶³ Slater æ¡ä»¶ï¼Œåˆ™å¼ºå¯¹å¶æ€§æ»¡è¶³</p><blockquote><p>  Slater æ¡ä»¶ä¸ºï¼š</p><script type="math/tex; mode=display">  \exist\hat{x}\in Relint\mathcal{D}\ s.t.\ \forall i=1,2,\cdots,M,m_i(x)\lt0</script><p>  å…¶ä¸­ Relint è¡¨ç¤ºç›¸å¯¹å†…éƒ¨ï¼ˆä¸åŒ…å«è¾¹ç•Œçš„å†…éƒ¨ï¼‰</p></blockquote><p>å¯¹äºå¤§å¤šæ•°å‡¸ä¼˜åŒ–é—®é¢˜ï¼ŒSlater æ¡ä»¶éƒ½æ˜¯æˆç«‹çš„ï¼Œä½†æ˜¯ Slater æ¡ä»¶ä¹Ÿåªæ˜¯ä¸€ä¸ªå……åˆ†æ¡ä»¶ã€‚å¸¸ç”¨çš„å¦ä¸€ä¸ªå……åˆ†æ¡ä»¶æ˜¯ Linearity constraint qualificationï¼Œå³çº¦æŸç­‰å¼å’Œä¸ç­‰å¼éƒ½æ˜¯çº¿æ€§çš„</p><h3 id="KKT-æ¡ä»¶"><a href="#KKT-æ¡ä»¶" class="headerlink" title="KKT æ¡ä»¶"></a>KKT æ¡ä»¶</h3><p>åœ¨å‡¸ä¼˜åŒ–æƒ…å†µä¸‹ï¼Œå¼ºå¯¹å¶æ€§æ»¡è¶³å’Œ KKT æ¡ä»¶æˆç«‹æ˜¯ç­‰ä»·å…³ç³»ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ KKT æ¡ä»¶è¿›è¡ŒåŸé—®é¢˜çš„æ•°å€¼æ±‚è§£ã€‚<a href="https://www.zhihu.com/question/49754458">KKTæ¡ä»¶åœ¨ä½¿ç”¨çš„æ—¶å€™æœ‰ä»€ä¹ˆè¦æ±‚å—ï¼Ÿæ˜¯å¦è¦æ±‚å¼ºå¯¹å¶</a></p><blockquote><p>KKT æ¡ä»¶å¯åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†</p><ol><li><p>å¯è¡ŒåŸŸï¼š</p><script type="math/tex; mode=display">\begin{align}m_i(x^*)\le0\\n_j(x^*)=0\\\lambda^*\ge0\end{align}</script></li><li><p>äº’è¡¥æ¾å¼› $\lambda^<em>m_i(x^</em>)=0,\forall m_i$ï¼Œå¯¹å¶é—®é¢˜çš„æœ€ä½³å€¼ä¸º $d^<em>$ï¼ŒåŸé—®é¢˜ä¸º $p^</em>$</p></li><li><p>æ¢¯åº¦ä¸º0ï¼š$\frac{\partial L(x,\lambda^<em>,\eta^</em>)}{\partial x}|_{x=x^*}=0$</p></li></ol><p>ç²—ç³™è¯æ˜å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\begin{align}d^*&=\max_{\lambda,\eta}g(\lambda,\eta)=g(\lambda^*,\eta^*)\nonumber\\&=\min_{x}L(x,\lambda^*,\eta^*)\nonumber\\&\le L(x^*,\lambda^*,\eta^*)\nonumber\\&=f(x^*)+\sum\limits_{i=1}^M\lambda^*m_i(x^*)\nonumber\\&\le f(x^*)=p^*\end{align}</script><p>ç”±å¼ºå¯¹å¶æ€§å¾—ï¼Œä¸¤ä¸ªä¸ç­‰å¼å¿…é¡»æˆç«‹ï¼Œäºæ˜¯ï¼Œå¯¹äºç¬¬ä¸€ä¸ªä¸ç­‰äºå·ï¼Œå¯å¾—åœ¨ $x^*$ å¤„æœ‰æ¢¯åº¦ä¸º0æˆç«‹ï¼Œå¯¹äºç¬¬äºŒä¸ªä¸ç­‰äºå·éœ€è¦æ»¡è¶³äº’è¡¥æ¾å¼›æ¡ä»¶</p></blockquote><h2 id="Hard-margin-SVM"><a href="#Hard-margin-SVM" class="headerlink" title="Hard-margin SVM"></a>Hard-margin SVM</h2><p>ç°åœ¨æ­£å¼æå‡º SVM æ¨¡å‹å¹¶è®¡ç®—å‡ºæœ€ä¼˜è§£ï¼åœ¨ SVM ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥<strong>æœ€å¤§åŒ–é—´éš”</strong>è¿™ä¸ªæ¦‚å¿µï¼Œ<strong>é—´éš”æŒ‡çš„æ˜¯æ•°æ®å’Œç›´çº¿çš„è·ç¦»çš„æœ€å°å€¼</strong></p><p>é‚£ä¹ˆæœ€å¤§åŒ–é—´éš”çš„è¡¨è¾¾å¦‚ä¸‹</p><script type="math/tex; mode=display">\mathop{argmax}_{w,b}[\min_i\frac{|w^Tx_i+b|}{||w||}]\ s.t.\ y_i(w^Tx_i+b)>0\\\Longrightarrow\mathop{argmax}_{w,b}[\min_i\frac{y_i(w^Tx_i+b)}{||w||}]\ s.t.\ y_i(w^Tx_i+b)>0</script><p>å¯¹äºçº¦æŸ  $y_i(w^Tx_i+b)&gt;0$ï¼Œä¸å¦¨å›ºå®šå…¶æœ€å°å€¼ä¸º1ï¼Œå³</p><script type="math/tex; mode=display">\min y_i(w^Tx_i+b)=1>0</script><p>åŸå› åœ¨äºç»™è¶…å¹³é¢ $w^Tx + b = 0$ ä¹˜ä»¥ä¸€ä¸ªå¸¸æ•°è¿›è¡Œç¼©æ”¾æ˜¯ä¸ä¼šæ”¹å˜è¶…å¹³é¢çš„ã€‚å‡½æ•°çš„è§’åº¦æ¥è®²ï¼Œ$g(w,b) = \min_i\frac{y_i(w^Tx_i+b)}{||w||}$ è¿™ä¸ªå‡½æ•°åœ¨è¶…å¹³é¢ç¼©æ”¾è¿‡åæ˜¯æ²¡æœ‰æ”¹å˜çš„ï¼Œæ‰€ä»¥å›ºå®šä¸Šå¼çš„æœ€å°å€¼ä¸º1å¹¶ä¸æ”¹å˜åŸå§‹é—®é¢˜çš„æœ€ä¼˜è§£ã€‚äºæ˜¯çº¦æŸé—®é¢˜è½¬åŒ–ä¸º</p><script type="math/tex; mode=display">\mathop{argmin}_{w,b}\frac{1}{2}w^Tw\ s.t.\ \min_iy_i(w^Tx_i+b)=1\\\Rightarrow\mathop{argmin}_{w,b}\frac{1}{2}w^Tw\ s.t.\ y_i(w^Tx_i+b)\ge1,i=1,2,\cdots,N</script><p>è¿™å°±æ˜¯ä¸€ä¸ªåŒ…å« $N$ ä¸ªçº¦æŸçš„å‡¸ä¼˜åŒ–é—®é¢˜ï¼Œæœ‰å¾ˆå¤šæ±‚è§£è¿™ç§é—®é¢˜çš„è½¯ä»¶ã€‚ç°åœ¨æˆ‘ä»¬é€šè¿‡å¼•å…¥ Lagrange å‡½æ•°å¹¶ä½¿ç”¨ KKT æ¡ä»¶è¿›è¡Œæ±‚è§£ï¼ŒåŸé—®é¢˜ç­‰ä»·äº</p><script type="math/tex; mode=display">L(w,b,\lambda)=\frac{1}{2}w^Tw+\sum\limits_{i=1}^N\lambda_i(1-y_i(w^Tx_i+b))\\\mathop{argmin}_{w,b}\max_{\lambda}L(w,b,\lambda_i)\ s.t.\ \lambda_i\ge0</script><p>è¯¥é—®é¢˜æ»¡è¶³å¼ºå¯¹å¶æ€§ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ±‚å¯¹å¶é—®é¢˜çš„æœ€ä¼˜è§£ã€‚å› ä¸ºå¼ºå¯¹å¶æ€§å’Œ KKT æ¡ä»¶ç­‰ä»·ï¼Œæ‰€ä»¥æœ€ä¼˜è§£ä¹Ÿå¿…å®šæ»¡è¶³ KKT æ¡ä»¶</p><blockquote><script type="math/tex; mode=display">\begin{align}&\frac{\partial L}{\partial w}=0,\frac{\partial L}{\partial b}=0\\&\lambda_k(1-y_k(w^Tx_k+b))=0\\&\lambda_i\ge0\\&1-y_i(w^Tx_i+b)\le0\end{align}</script></blockquote><p>æ ¹æ®ä»¥ä¸Šæ¡ä»¶è·å¾—æœ€ä½³å‚æ•°çš„è¡¨è¾¾å¼</p><script type="math/tex; mode=display">\hat{w}=\sum\limits_{i=1}^N\lambda_iy_ix_i\\\hat{b}=y_k-w^Tx_k=y_k-\sum\limits_{i=1}^N\lambda_iy_ix_i^Tx_k\\\exist k,1-y_k(w^Tx_k+b)=0</script><p>æ¯”è¾ƒéš¾ä»¥ç†è§£çš„æ˜¯å‚æ•° $\hat b$ çš„è¡¨è¾¾å¼ã€‚é¦–å…ˆè¦ç†è§£ä¸ºä»€ä¹ˆå¿…å®šå­˜åœ¨æ”¯æ’‘å‘é‡ $x_k$ï¼ˆä¹Ÿå°±æ˜¯ç¦»è¶…å¹³é¢æœ€è¿‘çš„å‘é‡ï¼‰ã€‚è¿™æ˜¯å› ä¸ºå¿…å®šå­˜åœ¨ä¸€ä¸ªè¶…å¹³é¢å°†å‘é‡åˆ†ç¦»ï¼Œå¦åˆ™åŸé—®é¢˜å°±ä¸æ˜¯çº¿æ€§å¯åˆ†äº†ã€‚æ‰€ä»¥ç»™å®šå‚æ•° $w$ å¿…ç„¶èƒ½å¤Ÿæ‰¾åˆ°å…¶æ”¯æ’‘å‘é‡ï¼Œå¹¶è®¡ç®— $b$</p><p>å°† KKT æ¡ä»¶å¾—åˆ°çš„è¡¨è¾¾å¼ä»£å…¥åˆ°å¯¹å¶é—®é¢˜ä¸­æœ‰</p><script type="math/tex; mode=display">\max_{\lambda}-\frac{1}{2}\sum\limits_{i=1}^N\sum\limits_{j=1}^N\lambda_i\lambda_jy_iy_jx_i^Tx_j+\sum\limits_{i=1}^N\lambda_i,\ s.t.\ \lambda_i\ge0</script><p>æ¥ä¸‹æ¥æ€ä¹ˆè§£è¿™ä¸ªé—®é¢˜ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥å¯¹å‡¸ä¼˜åŒ–è¿›è¡Œå­¦ä¹ â€¦æš‚æ—¶æ”¾åœ¨è¿™é‡Œï¼Œæˆ‘å°±æ˜¯æŒ–å‘çš„ç¥ğŸ˜</p><p>æœ€åå†æ‹”é«˜ä¸€ä¸‹å¯¹ SVM è¶…å¹³é¢çš„ç†è§£ï¼šè¯¥è¶…å¹³é¢å°±æ˜¯æ”¯æ’‘å‘é‡çš„çº¿æ€§ç»„åˆ</p><h2 id="Soft-margin-SVM"><a href="#Soft-margin-SVM" class="headerlink" title="Soft-margin SVM"></a>Soft-margin SVM</h2><p>å½“æœ‰å°‘é‡æ•°æ®ä¸å¯åˆ†çš„æ—¶å€™åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬çš„åŸºæœ¬æƒ³æ³•æ˜¯åœ¨æŸå¤±å‡½æ•°ä¸­åŠ å…¥é”™è¯¯åˆ†ç±»çš„æƒ©ç½šé¡¹ã€‚çº¿æ€§ä¸å¯åˆ†æ„å‘³ç€æŸäº›ç‚¹ï¼Œä¸èƒ½æ»¡è¶³å‡½æ•°é—´éš”å¤§äºç­‰äº1çš„çº¦æŸæ¡ä»¶ï¼Œæ‰€ä»¥å¯¹æ¯ä¸ªæ ·æœ¬ç‚¹å¼•å…¥ä¸€ä¸ªæ¾å¼›å˜é‡ $\xi_i$ï¼Œæ­¤æ—¶å°†çº¦æŸå˜ä¸º $y_i(w^Tx+b)\ge1-\xi_i$ã€‚å¯¹äºæ¯ä¸€ä¸ªæ¾å¼›å˜é‡ï¼Œå°†æ”¯ä»˜ä¸€ä¸ªä»£ä»· $\xi_i$ï¼Œæ‰€ä»¥åŸé—®é¢˜å˜ä¸º</p><script type="math/tex; mode=display">\mathop{argmin}_{w,b}\frac{1}{2}w^Tw+C\sum\limits_{i=1}^N\xi_i\\s.t.\ y_i(w^Tx_i+b)\ge1-\xi_i\\\xi_i\ge0,i=1,2,\cdots,N</script><p>åŸé—®é¢˜ä¾ç„¶æ˜¯ä¸€ä¸ªå‡¸äºŒæ¬¡è§„åˆ’é—®é¢˜ï¼Œå¯ä»¥æŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•å†è¿›è¡Œåˆ†æï¼Œä½† $b$ å¯èƒ½æ²¡æœ‰å”¯ä¸€è§£</p><p>æ¾å¼›å˜é‡å¯è¡¨è¾¾ä¸ºï¼š$\xi_i = 1-y_i(w^Tx_i+b)$ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ hinge loss function æ¥è¡¨ç¤ºæŸå¤± $loss = max(0, \xi_i)$</p><h2 id="Kernel-Method"><a href="#Kernel-Method" class="headerlink" title="Kernel Method"></a>Kernel Method</h2><p>æ ¸æ–¹æ³•å¯ä»¥åº”ç”¨åœ¨å¾ˆå¤šé—®é¢˜ä¸Šï¼Œåœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œå¯¹äºä¸¥æ ¼ä¸å¯åˆ†é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªç‰¹å¾è½¬æ¢å‡½æ•°å°†åŸæ¥çš„ä¸å¯åˆ†çš„æ•°æ®é›†å˜ä¸ºå¯åˆ†çš„æ•°æ®é›†ï¼Œç„¶åå†æ¥åº”ç”¨å·²æœ‰çš„æ¨¡å‹ã€‚å¾€å¾€å°†ä½ç»´ç©ºé—´çš„æ•°æ®é›†å˜ä¸ºé«˜ç»´ç©ºé—´çš„æ•°æ®é›†åï¼Œæ•°æ®ä¼šå˜å¾—å¯åˆ†ï¼ˆæ•°æ®å˜å¾—æ›´ä¸ºç¨€ç–ï¼‰ï¼š</p><blockquote><p>  Cover THï¼šé«˜ç»´ç©ºé—´æ¯”ä½ç»´ç©ºé—´æ›´æ˜“çº¿æ€§å¯åˆ†ã€‚</p></blockquote><p>TODO</p><h2 id="TODO-è¡¥å……ï¼šå‡¸ä¼˜åŒ–åŸºç¡€"><a href="#TODO-è¡¥å……ï¼šå‡¸ä¼˜åŒ–åŸºç¡€" class="headerlink" title="TODO è¡¥å……ï¼šå‡¸ä¼˜åŒ–åŸºç¡€"></a>TODO è¡¥å……ï¼šå‡¸ä¼˜åŒ–åŸºç¡€</h2><p>å»ºè®®æŸ¥çœ‹åŸæ¥åšçš„ç¬”è®°ã€Šæœ€ä¼˜åŒ–åŸç†ã€‹çº¦æŸä¼˜åŒ–éƒ¨åˆ†</p><ol><li>KKT æ¡ä»¶ä¸ºä»€ä¹ˆè¦åŠ å…¥åŸå§‹å®šä¹‰åŸŸ</li><li>KKT æ¡ä»¶æ˜¯å……åˆ†æ¡ä»¶è¿˜æ˜¯å¿…è¦æ¡ä»¶ï¼Œè¿˜æ˜¯å……è¦æ¡ä»¶</li><li>KKT æ¡ä»¶åœ¨è§£é¢˜ä¸­å……å½“äº†ä»€ä¹ˆæ ·çš„è§’è‰²ï¼Ÿå› ä¸ºä½¿ç”¨ KKT æ¡ä»¶å¹¶ä¸èƒ½å®Œå…¨å°†æœ€ä¼˜è§£å¾—å‡º</li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> ç™½æ¿æœºå™¨å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenPCDet loss utils</title>
      <link href="/archives/d4954eb6.html"/>
      <url>/archives/d4954eb6.html</url>
      
        <content type="html"><![CDATA[<h1 id="OpenPCDet-loss-utils"><a href="#OpenPCDet-loss-utils" class="headerlink" title="OpenPCDet loss utils"></a>OpenPCDet loss utils</h1><h2 id="SigmoidFocalClassificationLoss"><a href="#SigmoidFocalClassificationLoss" class="headerlink" title="SigmoidFocalClassificationLoss"></a>SigmoidFocalClassificationLoss</h2><p>è¿™ä¸ªç±»å®ç°äº† focal lossï¼Œå…³äº focal loss å¯ä»¥çœ‹è¿™ç¯‡ <a href="https://zhuanlan.zhihu.com/p/80594704">çŸ¥ä¹</a>ï¼Œç™½è¯æ¥è¯´ï¼šfocal loss ä½¿ç”¨äº†ä¸¤ä¸ªæŠ€å·§æ”¹å˜ loss function çš„åˆ†å¸ƒï¼š</p><ol><li>alpha å¯ä»¥è°ƒèŠ‚æ­£è´Ÿæ ·æœ¬ loss åˆ†å¸ƒ </li><li>gamma å¯ä»¥æ¡ä»¶éš¾æ˜“æ ·æœ¬ loss åˆ†å¸ƒ</li></ol><p>ä¸Šé¢çŸ¥ä¹ä¸­çš„æœ‰ä¸€æ¡è¯„è®ºä¹Ÿè§£å†³äº†æˆ‘çš„ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆæ­£æ ·æœ¬è¿œå°äºè´Ÿæ ·æœ¬æ—¶ alpha è¿˜å–å¾—è¾ƒå°ï¼šå› ä¸º gamma çš„æ•ˆåº”å¤ªå¤§äº†ï¼Œåè€Œéœ€è¦æå‡ä¸€ç‚¹è´Ÿæ ·æœ¬çš„æ¯”é‡ã€‚æ€»ä¹‹å°±æ˜¯å®è·µå‡ºæ¥çš„ï¼</p><blockquote><p>é‡æ–°å»æŸ¥äº†ä¸‹focal lossè®ºæ–‡ï¼Œåœ¨gamma=0æ—¶ï¼Œalpha=0.75æ•ˆæœæ›´å¥½ï¼Œä½†å½“gamma=2æ—¶ï¼Œalpha=0.25æ•ˆæœæ›´å¥½ï¼Œä¸ªäººçš„è§£é‡Šä¸ºè´Ÿæ ·æœ¬(IOU&lt;=0.5)è™½ç„¶è¿œæ¯”æ­£æ ·æœ¬(IOU&gt;0.5)è¦å¤šï¼Œä½†å¤§éƒ¨åˆ†ä¸ºIOUå¾ˆå°ï¼ˆå¦‚&lt;0.1ï¼‰ä»¥è‡³äºåœ¨gammaä½œç”¨åæŸç§ç¨‹åº¦ä¸Šè´¡çŒ®è¾ƒå¤§æŸå¤±çš„è´Ÿæ ·æœ¬ç”šè‡³æ¯”æ­£æ ·æœ¬è¿˜è¦å°‘ï¼Œæ‰€ä»¥alpha=0.25è¦åè¿‡æ¥é‡æ–°å¹³è¡¡è´Ÿæ­£æ ·æœ¬</p></blockquote><p>å…ˆæ¥çœ‹ forward å‡½æ•°çš„è¾“å…¥è¾“å‡º</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> target<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> weights<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        input: (B, #anchors, #classes) float tensor.            Predicted logits for each class        target: (B, #anchors, #classes) float tensor.            One-hot encoded classification targets        weights: (B, #anchors) float tensor.            Anchor-wise weights.    Returns:        weighted_loss: (B, #anchors, #classes) float tensor after weighting.    """</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¾“å…¥è¾“å‡º"><a href="#è¾“å…¥è¾“å‡º" class="headerlink" title="è¾“å…¥è¾“å‡º"></a>è¾“å…¥è¾“å‡º</h3><p>è¾“å…¥ä¸ºï¼š</p><ol><li><p>input æ˜¯ logitsï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç»è¿‡ sigmoid çš„çº¿æ€§å±‚è¾“å‡º</p></li><li><p>target æ˜¯ one-hot å‘é‡</p></li><li><p>weights æ˜¯æ¯ä¸ª anchor çš„æƒé‡ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç”¨äºå½’ä¸€åŒ–çš„é‡ï¼Œå¦‚ 1 / num_foreground_anchor</p></li></ol><p>è¾“å‡ºä¸ºï¼š</p><ol><li>weighted_lossï¼Œç»è¿‡ focal weights å’Œè¾“å…¥ä¸­ weights åŠ æƒè¿‡åå¾—åˆ°çš„ binary cross entropy loss</li></ol><h3 id="å…³é”®å‡½æ•°å®ç°"><a href="#å…³é”®å‡½æ•°å®ç°" class="headerlink" title="å…³é”®å‡½æ•°å®ç°"></a>å…³é”®å‡½æ•°å®ç°</h3><p>é¦–å…ˆéœ€è¦è®¡ç®—æ¯ä¸ª anchor çš„æ¯ä¸ªç±»åˆ«é¢„æµ‹çš„ lossï¼Œè¿™æ˜¯ç”± <code>sigmoid_cross_entropy_with_logits</code> å®ç°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">sigmoid_cross_entropy_with_logits</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> target<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">""" PyTorch Implementation for tf.nn.sigmoid_cross_entropy_with_logits:        max(x, 0) - x * z + log(1 + exp(-abs(x))) in        https://www.tensorflow.org/api_docs/python/tf/nn/sigmoid_cross_entropy_with_logits    Args:        input: (B, #anchors, #classes) float tensor.            Predicted logits for each class        target: (B, #anchors, #classes) float tensor.            One-hot encoded classification targets    Returns:        loss: (B, #anchors, #classes) float tensor.            Sigmoid cross entropy loss without reduction    """</span>    loss <span class="token operator">=</span> torch<span class="token punctuation">.</span>clamp<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">input</span> <span class="token operator">*</span> target <span class="token operator">+</span> \           torch<span class="token punctuation">.</span>log1p<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>torch<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> loss<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ pytorch ä¸­ä¸ä¹‹åŠŸèƒ½å‡ ä¹ä¸€æ ·çš„æ˜¯ <code>nn.BCEWithLogitsLoss</code> æˆ–è€… <code>F.binary_cross_entropy_with_logits</code>ï¼ŒäºŒè€…çš„å…³ç³»å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç è¡¨ç¤ºï¼Œ<a href="https://pytorch.org/docs/stable/generated/torch.nn.BCEWithLogitsLoss.html#torch.nn.BCEWithLogitsLoss">pytorch link</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">sigmoid_cross_entropy_with_logits<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token operator">=</span> F<span class="token punctuation">.</span>binary_cross_entropy_with_logits<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> reduction<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token comment"># å¦‚æœæ²¡æœ‰ reduction åˆ™é»˜è®¤ä¸º reduction = 'mean'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å®Œæ•´å®ç°"><a href="#å®Œæ•´å®ç°" class="headerlink" title="å®Œæ•´å®ç°"></a>å®Œæ•´å®ç°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SigmoidFocalClassificationLoss</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Sigmoid focal cross entropy loss.    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> gamma<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">,</span> alpha<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Args:            gamma: Weighting parameter to balance loss for hard and easy examples.            alpha: Weighting parameter to balance loss for positive and negative examples.        """</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>SigmoidFocalClassificationLoss<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> alpha        self<span class="token punctuation">.</span>gamma <span class="token operator">=</span> gamma    <span class="token decorator annotation punctuation">@staticmethod</span>    <span class="token keyword">def</span> <span class="token function">sigmoid_cross_entropy_with_logits</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> target<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å¦‚ä¸Šä¸€èŠ‚æ‰€ç¤º</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> target<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> weights<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Args:            input: (B, #anchors, #classes) float tensor.                Predicted logits for each class            target: (B, #anchors, #classes) float tensor.                One-hot encoded classification targets            weights: (B, #anchors) float tensor.                Anchor-wise weights.        Returns:            weighted_loss: (B, #anchors, #classes) float tensor after weighting.        """</span>         pred_sigmoid <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>        alpha_weight <span class="token operator">=</span> target <span class="token operator">*</span> self<span class="token punctuation">.</span>alpha <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> target<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>alpha<span class="token punctuation">)</span>        pt <span class="token operator">=</span> target <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> pred_sigmoid<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> target<span class="token punctuation">)</span> <span class="token operator">*</span> pred_sigmoid        focal_weight <span class="token operator">=</span> alpha_weight <span class="token operator">*</span> torch<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> self<span class="token punctuation">.</span>gamma<span class="token punctuation">)</span>        bce_loss <span class="token operator">=</span> self<span class="token punctuation">.</span>sigmoid_cross_entropy_with_logits<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span>        loss <span class="token operator">=</span> focal_weight <span class="token operator">*</span> bce_loss        <span class="token comment"># reshape weights to broadcast</span>        <span class="token keyword">if</span> weights<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">or</span> \                <span class="token punctuation">(</span>weights<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> target<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            weights <span class="token operator">=</span> weights<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">assert</span> weights<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> loss<span class="token punctuation">.</span>shape<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> loss <span class="token operator">*</span> weights<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="WeightedSmoothL1Loss"><a href="#WeightedSmoothL1Loss" class="headerlink" title="WeightedSmoothL1Loss"></a>WeightedSmoothL1Loss</h2><p>è¿™é‡Œåšä¸€ä¸‹ç²¾ç®€çš„ç†è§£ï¼ŒæŠŠä¸€äº›æå‡çµæ´»æ€§å’Œç¨³å®šæ€§çš„ä»£ç å»æ‰ï¼Œä»…çœ‹ SmoothL1Loss çš„æ ¸å¿ƒå°±ä¼šéå¸¸ç®€æ´</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">WeightedSmoothL1Loss</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Code-wise Weighted Smooth L1 Loss modified based on fvcore.nn.smooth_l1_loss    https://github.com/facebookresearch/fvcore/blob/master/fvcore/nn/smooth_l1_loss.py                  | 0.5 * x ** 2 / beta   if abs(x) &lt; beta    smoothl1(x) = |                  | abs(x) - 0.5 * beta   otherwise,    where x = input - target.    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> beta<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">9.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>WeightedSmoothL1Loss<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>beta <span class="token operator">=</span> beta    <span class="token decorator annotation punctuation">@staticmethod</span>    <span class="token keyword">def</span> <span class="token function">smooth_l1_loss</span><span class="token punctuation">(</span>diff<span class="token punctuation">,</span> beta<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> beta <span class="token operator">&lt;</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span>            <span class="token comment"># å¦‚æœ beta å¤ªå°åˆ™æ²¡æœ‰æ„ä¹‰ï¼Œé€€åŒ–ä¸ºæ™®é€š L1 loss</span>            loss <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            n <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>diff<span class="token punctuation">)</span>            loss <span class="token operator">=</span> torch<span class="token punctuation">.</span>where<span class="token punctuation">(</span>n <span class="token operator">&lt;</span> beta<span class="token punctuation">,</span> <span class="token number">0.5</span> <span class="token operator">*</span> n <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">/</span> beta<span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> beta<span class="token punctuation">)</span>        <span class="token keyword">return</span> loss    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> target<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> weights<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Args:            input: (B, #anchors, #codes) float tensor.                Ecoded predicted locations of objects.            target: (B, #anchors, #codes) float tensor.                Regression targets.            weights: (B, #anchors) float tensor if not None.        Returns:            loss: (B, #anchors) float tensor.                Weighted smooth l1 loss without reduction.        """</span>        diff <span class="token operator">=</span> <span class="token builtin">input</span> <span class="token operator">-</span> target        loss <span class="token operator">=</span> self<span class="token punctuation">.</span>smooth_l1_loss<span class="token punctuation">(</span>diff<span class="token punctuation">,</span> self<span class="token punctuation">.</span>beta<span class="token punctuation">)</span>        <span class="token comment"># anchor-wise weighting</span>        loss <span class="token operator">=</span> loss <span class="token operator">*</span> weights<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> loss<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€è°“çš„ weighted ä¹Ÿå°±æ˜¯å¯¹æ¯ä¸ª anchor å–æƒé‡ï¼Œåœ¨ SigmoidFocalClassificationLoss ä¸­ weights ä¸€èˆ¬æ˜¯ä¸€ä¸ªå½’ä¸€åŒ–çš„å¸¸é‡ï¼Œè¿™æ˜¯å› ä¸ºæ­£è´Ÿæ ·æœ¬éƒ½éœ€è¦è¿›è¡ŒæŸå¤±è®¡ç®—ã€‚WeightedSmoothL1Loss é€šå¸¸ç”¨äºè®¡ç®— bbox regression çš„æŸå¤±ï¼Œé€šå¸¸ä»…å¯¹æ­£æ ·æœ¬è®¡ç®—æŸå¤±ï¼Œæ‰€ä»¥è¿™é‡Œçš„ weights æœ‰ä¸€ç‚¹ç‚¹çš„åŒºåˆ«ï¼šnegative anchor çš„æƒé‡ä¸ºé›¶ï¼Œpositive anchor çš„æƒé‡ä¸º 1 / nums_positive_anchor</p><p><code>torch.where(condition, x, y)</code> æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ï¼Œä¹‹åå¯ä»¥ç»å¸¸ä½¿ç”¨ï¼šcondition æ˜¯æ¡ä»¶ï¼Œx å’Œ y æ˜¯åŒ shape çš„çŸ©é˜µ, é’ˆå¯¹çŸ©é˜µä¸­çš„æŸä¸ªä½ç½®çš„å…ƒç´ , æ»¡è¶³æ¡ä»¶å°±è¿”å› xï¼Œä¸æ»¡è¶³å°±è¿”å› y</p><p>ç•™ä¸ªå‘ï¼Œä¹‹åæ€»ç»“ä¸€ä¸‹ torch çš„å¸¸ç”¨æ“ä½œ</p><h2 id="WeightedCrossEntropyLoss"><a href="#WeightedCrossEntropyLoss" class="headerlink" title="WeightedCrossEntropyLoss"></a>WeightedCrossEntropyLoss</h2><p>è¿™ä¸€å‡½æ•°çš„å®ç°å°±æ›´åŠ ç®€å•äº†ï¼Œæ ¸å¿ƒå‡½æ•°ä¸‰è¡Œè§£å†³</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> target<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> weights<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        input: (B, #anchors, #classes) float tensor.            Predited logits for each class.        target: (B, #anchors, #classes) float tensor.            One-hot classification targets.        weights: (B, #anchors) float tensor.            Anchor-wise weights.    Returns:        loss: (B, #anchors) float tensor.            Weighted cross entropy loss without reduction    """</span>    <span class="token builtin">input</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    target <span class="token operator">=</span> target<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    loss <span class="token operator">=</span> F<span class="token punctuation">.</span>cross_entropy<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> reduction<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">)</span> <span class="token operator">*</span> weights    <span class="token keyword">return</span> loss<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CrossEntropyLoss-amp-BCEWithLogitsLoss"><a href="#CrossEntropyLoss-amp-BCEWithLogitsLoss" class="headerlink" title="CrossEntropyLoss &amp; BCEWithLogitsLoss"></a>CrossEntropyLoss &amp; BCEWithLogitsLoss</h2><p>å…³äº pytorch å®ç°çš„ CrossEntropyLoss: <a href="https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html#torch.nn.CrossEntropyLoss">pytorch link</a>ã€‚è¿™é‡Œä¸ç¦è®©æˆ‘æ€è€ƒè¿™ä¸ BCEWithLogitsLoss çš„åŒºåˆ«ï¼š</p><ol><li><p>äºŒè€…éƒ½æ˜¯ä½¿ç”¨ logits ä½œä¸ºè¾“å…¥ä»¥ç»´æŠ¤æ•°å€¼ç¨³å®šæ€§</p></li><li><p>äºŒè€…çš„ target å½¢çŠ¶æœ‰åŒºåˆ«ï¼ŒCE é€šå¸¸è¦å°‘ä¸€ä¸ªç»´åº¦ï¼Œå› ä¸º CE ä½¿ç”¨ target çš„ index ä½œä¸ºæ ‡ç­¾ã€‚è€Œ BCE ä¸­ targe å’Œ input å½¢çŠ¶æ˜¯ä¿æŒä¸€è‡´çš„ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ª point wise äº¤å‰ç†µè®¡ç®—</p></li><li><p>CrossEntropyLoss ä½¿ç”¨çš„æ˜¯ softmax è®¡ç®—æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡å¾—åˆ†ï¼Œ<strong>æ˜¯å½’ä¸€åŒ–çš„</strong>ï¼Œè¯¥å½’ä¸€åŒ–æ“ä½œå°†åœ¨ softmax åˆ†æ¯ä½“ç°ï¼Œèƒ½å¤Ÿè·å¾—å…¨å±€çš„ä¿¡æ¯ã€‚è€Œ BCEWithLogitsLoss ä½¿ç”¨çš„æ˜¯ sigmoid è®¡ç®—å¾—åˆ†ï¼Œå¹¶ä¸æ˜¯å½’ä¸€åŒ–çš„</p></li><li><p>å½“ BCE æ‹“å±•åˆ°å¤šä¸ªç±»åˆ«è¿‡åï¼Œå…¶æŸå¤±ä¸ä»…åŒ…æ‹¬<strong>æ˜¯</strong>è¯¥ç±»åˆ«çš„æŸå¤±ï¼Œä¹ŸåŒ…æ‹¬<strong>ä¸æ˜¯</strong>è¯¥ç±»åˆ«çš„æŸå¤±ã€‚è€Œ Cross Entropy å°±ä»…ä»…è®¡ç®—<strong>æ˜¯</strong>è¯¥ç±»çš„æŸå¤±ï¼ˆå®é™…ä¸Šé€šè¿‡å½’ä¸€åŒ–ï¼Œä¹Ÿèƒ½æœ‰å…¶ä»–è´Ÿé¢åé¦ˆçš„ä¿¡æ¯ï¼‰</p><p>ä¸‹é¢æ˜¯ BCE çš„æŸå¤±å‡½æ•°ï¼ˆå¯ä»¥æš‚æ—¶å¿½ç•¥ $w_n$ ä»¥ä¾¿ç†è§£ï¼‰ï¼Œ$x, y$ ä¸ºå½¢çŠ¶ç›¸åŒçš„å‘é‡ï¼Œå¯ä»¥æš‚æ—¶å‡è®¾ä¸º N x Cï¼ŒN ä»£è¡¨æ ·æœ¬æ•°é‡</p><p><img src="/archives/d4954eb6/image-20220304171501966.png" alt="image-20220304171501966"></p><p>è¿™æ˜¯ CE çš„æŸå¤±å‡½æ•°ï¼ˆå¯ä»¥æš‚æ—¶å¿½ç•¥ $w_n$ ä»¥ä¾¿ç†è§£ï¼‰ï¼Œ$x, y$ å½¢çŠ¶ä¸åŒï¼Œå¯ä»¥å…ˆæš‚æ—¶å‡è®¾ <code>x.shape = (N, C) &amp; y.shape = (N,)</code></p><p><img src="/archives/d4954eb6/image-20220304171428696.png" alt="image-20220304171428696"></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenPCDet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 11 ä¼˜åŒ–ç®—æ³•</title>
      <link href="/archives/15b3ab53.html"/>
      <url>/archives/15b3ab53.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-11-ä¼˜åŒ–ç®—æ³•"><a href="#D2L-11-ä¼˜åŒ–ç®—æ³•" class="headerlink" title="D2L 11 ä¼˜åŒ–ç®—æ³•"></a>D2L 11 ä¼˜åŒ–ç®—æ³•</h1><h2 id="ä¼˜åŒ–å’Œæ·±åº¦å­¦ä¹ "><a href="#ä¼˜åŒ–å’Œæ·±åº¦å­¦ä¹ " class="headerlink" title="ä¼˜åŒ–å’Œæ·±åº¦å­¦ä¹ "></a>ä¼˜åŒ–å’Œæ·±åº¦å­¦ä¹ </h2><p>ç»éªŒé£é™©æ˜¯è®­ç»ƒæ•°æ®é›†çš„å¹³å‡æŸå¤±ï¼Œè€Œé£é™©åˆ™æ˜¯æ•´ä¸ªæ•°æ®ç¾¤çš„é¢„æœŸæŸå¤±</p><p>æ·±åº¦å­¦ä¹ ä¼˜åŒ–å­˜åœ¨è®¸å¤šæŒ‘æˆ˜ã€‚å…¶ä¸­ä¸€äº›æœ€ä»¤äººçƒ¦æ¼çš„æ˜¯<strong>å±€éƒ¨æœ€å°å€¼ã€éç‚¹å’Œæ¢¯åº¦æ¶ˆå¤±</strong></p><p>éç‚¹ï¼ˆsaddle pointï¼‰æ˜¯æŒ‡å‡½æ•°çš„æ‰€æœ‰æ¢¯åº¦éƒ½æ¶ˆå¤±ä½†æ—¢ä¸æ˜¯å…¨å±€æœ€å°å€¼ä¹Ÿä¸æ˜¯å±€éƒ¨æœ€å°å€¼çš„ä»»ä½•ä½ç½®</p><h2 id="å‡¸æ€§"><a href="#å‡¸æ€§" class="headerlink" title="å‡¸æ€§"></a>å‡¸æ€§</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><ol><li><p>å‡¸é›†</p><p> ç®€å•åœ°è¯´ï¼Œå¦‚æœå¯¹äºä»»ä½• $aï¼ŒbâˆˆX$ï¼Œè¿æ¥ a å’Œ b çš„çº¿æ®µä¹Ÿä½äº X ä¸­ï¼Œåˆ™å‘é‡ç©ºé—´ä¸­çš„ä¸€ä¸ªé›†åˆ X æ˜¯å‡¸ï¼ˆconvexï¼‰çš„</p></li><li><p>å‡¸å‡½æ•°</p><p>ç»™å®šä¸€ä¸ªå‡¸é›† Xï¼Œå¦‚æœå¯¹äºæ‰€æœ‰ $x,xâ€²âˆˆX$ å’Œæ‰€æœ‰ $Î»âˆˆ[0,1$ï¼Œä¸€ä¸ªå‡½æ•° $f:Xâ†’R$ æ˜¯å‡¸çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°</p><script type="math/tex; mode=display">\lambda f(x)+(1-\lambda) f\left(x^{\prime}\right) \geq f\left(\lambda x+(1-\lambda) x^{\prime}\right)</script></li><li><p><strong>ç´æ£®ä¸ç­‰å¼ï¼ˆJensenâ€™s inequalityï¼‰</strong></p><script type="math/tex; mode=display">\sum_{i} \alpha_{i} f\left(x_{i}\right) \geq f\left(\sum_{i} \alpha_{i} x_{i}\right) \text { and } E_{X}[f(X)] \geq f\left(E_{X}[X]\right)</script><p>æ¢å¥è¯è¯´ï¼Œå‡¸å‡½æ•°çš„æœŸæœ›ä¸å°äºæœŸæœ›çš„å‡¸å‡½æ•°</p></li></ol><h3 id="æ€§è´¨"><a href="#æ€§è´¨" class="headerlink" title="æ€§è´¨"></a>æ€§è´¨</h3><ol><li><p>å±€éƒ¨æœ€å°å€¼å°±æ˜¯å…¨å±€æœ€å°å€¼ã€‚è¯æ˜é€šè¿‡åè¯æ³•ï¼Œå‡è®¾å­˜åœ¨æ›´å°å€¼ï¼Œåˆ™ä¸å±€éƒ¨æœ€å°å€¼çŸ›ç›¾</p></li><li><p>æ°´å¹³é›†ä¸å‡¸å‡½æ•°ã€‚å¯¹äºå‡¸å‡½æ•°å®šäºå¦‚ä¸‹é›†åˆ</p><script type="math/tex; mode=display">\mathcal{S}_{b}:=\{x \mid x \in \mathcal{X} \text { and } f(x) \leq b\}</script><p>å¯ä»¥è¯æ˜è¯¥é›†åˆæ˜¯å‡¸é›†ï¼Œä¹Ÿç§°å…¶ä¸ºæ°´å¹³é›†ã€‚è¯æ˜ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥æŒ‰ç…§å®šä¹‰è¿›è¡Œè¯æ˜ï¼šé›†åˆå†…ä»»æ„ä¸¤ç‚¹è¿çº¿ä¸Šçš„æ‰€æœ‰çš„ç‚¹éƒ½åœ¨é›†åˆå†…</p></li><li><p>å‡¸æ€§å’ŒäºŒé˜¶å¯¼æ•°ã€‚Hessian çŸ©é˜µåŠæ­£å®šä¸å‡¸å‡½æ•°æ˜¯ç­‰ä»·çš„ï¼Œå½“ç„¶è¿˜è¦äºŒé˜¶å¯å¾®çš„æ¡ä»¶</p></li></ol><h3 id="çº¦æŸ"><a href="#çº¦æŸ" class="headerlink" title="çº¦æŸ"></a>çº¦æŸ</h3><p>è¿™é‡Œéœ€è¦æ›´å¤šå‡¸ä¼˜åŒ–çš„çŸ¥è¯†â€¦æš‚ç•¥</p><p>å‡¸çº¦æŸå¯ä»¥é€šè¿‡æ‹‰æ ¼æœ—æ—¥å‡½æ•°æ¥æ·»åŠ ã€‚åœ¨å®è·µä¸­ï¼Œåªéœ€åœ¨ç›®æ ‡å‡½æ•°ä¸­åŠ ä¸Šä¸€ä¸ªæƒ©ç½šå°±å¯ä»¥äº†</p><p>æŠ•å½±æ˜ å°„åˆ°å‡¸é›†ä¸­æœ€æ¥è¿‘åŸå§‹ç‚¹çš„ç‚¹</p><h2 id="æ¢¯åº¦ä¸‹é™"><a href="#æ¢¯åº¦ä¸‹é™" class="headerlink" title="æ¢¯åº¦ä¸‹é™"></a>æ¢¯åº¦ä¸‹é™</h2><h3 id="å¤šå…ƒæ¢¯åº¦ä¸‹é™"><a href="#å¤šå…ƒæ¢¯åº¦ä¸‹é™" class="headerlink" title="å¤šå…ƒæ¢¯åº¦ä¸‹é™"></a>å¤šå…ƒæ¢¯åº¦ä¸‹é™</h3><p>å¤šå…ƒæ³°å‹’å±•å¼€çš„ä¸€é˜¶å…¬å¼</p><script type="math/tex; mode=display">f(\mathbf{x}+\boldsymbol{\epsilon})=f(\mathbf{x})+\boldsymbol{\epsilon}^{\top} \nabla f(\mathbf{x})+\mathcal{O}\left(\|\boldsymbol{\epsilon}\|^{2}\right)</script><p>ä½¿ç”¨ä¸€é˜¶è¿‘ä¼¼å‡½æ•°ï¼Œåªéœ€è¦æ²¿ç€æ¢¯åº¦çš„è´Ÿæ–¹å‘èµ°åˆé€‚çš„æ­¥é•¿ï¼Œå°±èƒ½å¤Ÿä½¿å¾—å‡½æ•°å€¼ä¸‹é™</p><script type="math/tex; mode=display">\mathbf{x} \leftarrow \mathbf{x}-\eta \nabla f(\mathbf{x})</script><h3 id="ç‰›é¡¿æ³•"><a href="#ç‰›é¡¿æ³•" class="headerlink" title="ç‰›é¡¿æ³•"></a>ç‰›é¡¿æ³•</h3><p>å¤šå…ƒæ³°å‹’å±•å¼€çš„äºŒé˜¶å…¬å¼</p><script type="math/tex; mode=display">f(\mathbf{x}+\boldsymbol{\epsilon})=f(\mathbf{x})+\boldsymbol{\epsilon}^{\top} \nabla f(\mathbf{x})+\frac{1}{2} \boldsymbol{\epsilon}^{\top} \nabla^{2} f(\mathbf{x}) \boldsymbol{\epsilon}+\mathcal{O}\left(\|\boldsymbol{\epsilon}\|^{3}\right)</script><p>å…¶ä¸­ï¼Œå®šä¹‰æµ·æ£®çŸ©é˜µ Hessian Matrix</p><script type="math/tex; mode=display">\mathbf H = \nabla^{2} f(\mathbf{x})</script><p>å¯¹äºå…³äº Îµ çš„äºŒæ¬¡å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ±‚å¾—å…¶æå€¼ï¼Œç›´æ¥æ±‚å¯¼ä¸ºé›¶</p><script type="math/tex; mode=display">\nabla f(\mathbf{x})+\mathbf{H} \boldsymbol{\epsilon}=0 \text { and hence } \boldsymbol{\epsilon}=-\mathbf{H}^{-1} \nabla f(\mathbf{x})</script><p>ç‰›é¡¿æ³•åœ¨å‡¸é—®é¢˜ä¸­é€Ÿåº¦å¾ˆå¿«ï¼Œä½†åœ¨éå‡¸é—®é¢˜ä¸­æ˜¾å¾—ä¸é‚£ä¹ˆå¥½ç”¨</p><p>å› ä¸ºåœ¨ç‰›é¡¿æ³•ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆå°†é™¤ä»¥ Hessianã€‚ è¿™æ„å‘³ç€å¦‚æœäºŒé˜¶å¯¼æ•°æ˜¯è´Ÿçš„ï¼Œå‡½æ•°çš„å€¼å¯èƒ½ä¼šè¶‹äºå¢åŠ ã€‚ è¿™æ˜¯è¿™ä¸ªç®—æ³•çš„è‡´å‘½ç¼ºé™·ï¼</p><h2 id="éšæœºæ¢¯åº¦ä¸‹é™"><a href="#éšæœºæ¢¯åº¦ä¸‹é™" class="headerlink" title="éšæœºæ¢¯åº¦ä¸‹é™"></a>éšæœºæ¢¯åº¦ä¸‹é™</h2><p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œç›®æ ‡å‡½æ•°é€šå¸¸æ˜¯è®­ç»ƒæ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬çš„æŸå¤±å‡½æ•°çš„å¹³å‡å€¼</p><p>å¦‚æœä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•ï¼Œåˆ™æ¯ä¸ªè‡ªå˜é‡è¿­ä»£çš„è®¡ç®—ä»£ä»·ä¸º O(n)ï¼Œå®ƒéš n çº¿æ€§å¢é•¿ã€‚å› æ­¤ï¼Œå½“è®­ç»ƒæ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œæ¯æ¬¡è¿­ä»£çš„æ¢¯åº¦ä¸‹é™è®¡ç®—ä»£ä»·å°†è¾ƒé«˜</p><p>åœ¨éšæœºæ¢¯åº¦ä¸‹é™çš„æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å¯¹æ•°æ®æ ·æœ¬éšæœºå‡åŒ€é‡‡æ ·ä¸€ä¸ªç´¢å¼• iï¼Œå…¶ä¸­ iâˆˆ{1,â€¦,n}ï¼Œå¹¶è®¡ç®—æ¢¯åº¦ä»¥æ›´æ–° x</p><h3 id="å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™"><a href="#å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™" class="headerlink" title="å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™"></a>å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™</h3><p>éšæœºæ¢¯åº¦ä¸‹é™çš„â€œç»Ÿè®¡æ•ˆç‡â€ä¸å¤§æ‰¹é‡ä¸€æ¬¡å¤„ç†æ•°æ®çš„â€œè®¡ç®—æ•ˆç‡â€ä¹‹é—´å­˜åœ¨æƒè¡¡ã€‚å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™æä¾›äº†ä¸¤å…¨å…¶ç¾çš„ç­”æ¡ˆï¼šè®¡ç®—å’Œç»Ÿè®¡æ•ˆç‡</p><p>äº‹å®ä¸Šæˆ‘ä»¬å¯èƒ½ä¼šé—®ï¼šå‡è®¾æœ‰è¶³å¤Ÿçš„ç¡¬ä»¶æ¡ä»¶ï¼Œbatch size çœŸçš„è¶Šå¤§è¶Šå¥½å—ï¼Ÿé€šå¸¸æ¥è®² batch size æ˜¯è®­ç»ƒç½‘ç»œçš„ä¸€ä¸ªé‡è¦è¶…å‚æ•°ï¼Œè€Œ batch size å¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œ<a href="https://blog.csdn.net/ytusdc/article/details/107746786">CSDN</a></p><blockquote><p><strong>è¾ƒå¤§çš„ batch size å®¹æ˜“ä½¿æ¨¡å‹æ”¶æ•›åœ¨å±€éƒ¨æœ€ä¼˜ç‚¹ï¼Œè€Œä½¿ç”¨ mini batchï¼Œç”šè‡³å•ä¸ªæ•°æ®è®­ç»ƒæ—¶ï¼Œç›¸å½“äºäººä¸ºç»™è®­ç»ƒåŠ å…¥äº†å™ªå£°ï¼Œä½¿æ¨¡å‹èµ°å‡ºå±€éƒ¨æœ€ä¼˜ï¼ˆéç‚¹ï¼‰ï¼Œä»è€Œåœ¨æ›´å¤§çš„èŒƒå›´å†…å¯»æ‰¾æ”¶æ•›ç‚¹</strong></p></blockquote><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨æ›´å¤§çš„ batch size å¾€å¾€ä¼šé‡‡ç”¨æ›´å¤§çš„å­¦ä¹ ç‡çš„åŸå› ä¹‹ä¸€ï¼Œå¸®åŠ©èµ°å‡ºå±€éƒ¨æœ€ä¼˜</p><h2 id="åŠ¨é‡æ³•"><a href="#åŠ¨é‡æ³•" class="headerlink" title="åŠ¨é‡æ³•"></a>åŠ¨é‡æ³•</h2><p>ä½¿ç”¨åŠ¨é‡ Momentum æ›¿ä»£æ¢¯åº¦ï¼Œå‚æ•°æ›´æ–°æ–¹ç¨‹å¦‚ä¸‹</p><script type="math/tex; mode=display">\begin{array}{l}\mathbf{v}_{t} \leftarrow \beta \mathbf{v}_{t-1}+\mathbf{g}_{t, t-1} \\\mathbf{x}_{t} \leftarrow \mathbf{x}_{t-1}-\eta_{t} \mathbf{v}_{t}\end{array}</script><ul><li>åŠ¨é‡æ³•ç”¨è¿‡å»æ¢¯åº¦çš„å¹³å‡å€¼æ¥æ›¿æ¢æ¢¯åº¦ï¼Œè¿™å¤§å¤§åŠ å¿«äº†æ”¶æ•›é€Ÿåº¦</li><li>åŠ¨é‡æ³•å¯ä»¥é˜²æ­¢åœ¨éšæœºæ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–è¿‡ç¨‹åœæ»çš„é—®é¢˜</li><li>ç”±äºå¯¹è¿‡å»çš„æ•°æ®è¿›è¡Œäº†æŒ‡æ•°é™æƒï¼Œæœ‰æ•ˆæ¢¯åº¦æ•°ä¸º1 / (1 - Î²)</li></ul><p>å¦‚æœäº†è§£<a href="https://zhuanlan.zhihu.com/p/29895933">æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡</a> EWMAï¼Œèƒ½å¤Ÿå¾ˆå¿«åœ°ç†è§£è¿™ä¸ªå¹³å‡çš„æ¦‚å¿µï¼ŒEWA çš„æ›´æ–°å…¬å¼å¦‚ä¸‹</p><script type="math/tex; mode=display">\begin{array}{l}\mathbf{v}_{t} \leftarrow \beta \mathbf{v}_{t-1}+ (1 - \beta)\mathbf{g}_{t, t-1} \\\end{array}</script><p>ä» pytorch ä¸­å¯¹ <a href="https://pytorch.org/docs/stable/generated/torch.optim.SGD.html">SGD</a> çš„ä»‹ç»æ¥çœ‹ï¼Œæ˜¯ä½¿ç”¨çš„æ•™æä¸­çš„æ›´æ–°å…¬å¼ï¼Œå¦‚éœ€è¦ç±»ä¼¼ EWA çš„åŠŸèƒ½å¯è®¾ç½® dampening å‚æ•°</p><p>è¿™é‡Œå†è¡¥å……ä¸€ä¸‹å¯¹äº EWMA çš„ç†è§£ï¼Œæ¥è‡ª <a href="https://www.bilibili.com/video/BV1bP4y1p7Gq">æ²ç¥</a> pptã€‚ä¸‹é¢è¿™ä¸ªå±•å¼€å¼å°±å®Œå…¨å‘Šè¯‰æˆ‘ä»¬åŠ æƒä½“ç°åœ¨ä»€ä¹ˆåœ°æ–¹</p><p><img src="/archives/15b3ab53/image-20220306160047526.png" alt="image-20220306160047526" style="zoom: 33%;"></p><h2 id="AdaGrad"><a href="#AdaGrad" class="headerlink" title="AdaGrad"></a>AdaGrad</h2><p>æ›´æ–°å…¬å¼å¦‚ä¸‹</p><script type="math/tex; mode=display">\begin{aligned}\mathbf{g}_{t} &=\partial_{\mathbf{w}} l\left(y_{t}, f\left(\mathbf{x}_{t}, \mathbf{w}\right)\right) \\\mathbf{s}_{t} &=\mathbf{s}_{t-1}+\mathbf{g}_{t}^{2} \\\mathbf{w}_{t} &=\mathbf{w}_{t-1}-\frac{\eta}{\sqrt{\mathbf{s}_{t}+\epsilon}} \cdot \mathbf{g}_{t}\end{aligned}</script><p>è¿™é‡Œæˆ‘å°†é‡‡ç”¨ cs231n ä¸­åšçš„ç¬”è®°</p><blockquote><p>Added element-wise <strong>scaling of the gradient</strong> based on the historical sum of squares in each dimension</p></blockquote><p>AdaGrad èƒ½å¤Ÿå¯¹æ¢¯åº¦çš„æ¯ä¸€ç»´è¿›è¡Œç¼©æ”¾ï¼Œè¯¥ä¼˜åŒ–æ–¹æ³•èƒ½å¤Ÿè§£å†³ zigzag å‰è¿›é—®é¢˜ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›èµ°é™¡å³­çš„è·¯å¾„ï¼Œè€Œæ˜¯æƒ³èµ°åˆ°æ›´å¹³æ»‘çš„å…¨å±€æœ€ä¼˜ç‚¹ï¼Œå¯¹äºç¨€ç–ç‰¹å¾æ¯”è¾ƒæœ‰æ•ˆã€‚ä½†æˆ‘ä»¬é€šå¸¸ä¸ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œç†ç”±ï¼šéšç€ä¸æ–­åœ°æ›´æ–°ï¼Œç´¯è®¡é‡ $s_t$ ä¼šè¶Šæ¥è¶Šå¤§ï¼Œæ­¥é•¿å˜çŸ­å¯èƒ½è¿‡äºè¿…é€Ÿï¼Œè¿™å¯¹äºéå‡¸é—®é¢˜æ¥è¯´æ˜¯ä¸åˆé€‚çš„</p><h2 id="RMSProp"><a href="#RMSProp" class="headerlink" title="RMSProp"></a>RMSProp</h2><p>RootMeanSquareProp æ›´æ–°å…¬å¼å¦‚ä¸‹</p><script type="math/tex; mode=display">\begin{array}{l}\mathbf{s}_{t} \leftarrow \gamma \mathbf{s}_{t-1}+(1-\gamma) \mathbf{g}_{t}^{2} \\\mathbf{x}_{t} \leftarrow \mathbf{x}_{t-1}-\frac{\eta}{\sqrt{\mathbf{s}_{t}+\epsilon}} \odot \mathbf{g}_{t}\end{array}</script><p>æ—¢ç„¶ç´¯è®¡é‡ä¸åˆé€‚ï¼Œé‚£ä¹ˆå°±é‡‡å–å¹³å‡é‡æ¥å¯¹æ¢¯åº¦çš„æ¯ä¸€ç»´è¿›è¡Œç¼©æ”¾ã€‚é‡‡ç”¨ EWA å¹³å‡å†åˆé€‚ä¸è¿‡äº†ï¼Œå› ä¸º EWA å¹³å‡åœ¨å®ç°ä¸Šéå¸¸ç®€å•ï¼Œä»£ç ç®€æ´ä¸”ç©ºé—´å¤æ‚åº¦ä½</p><h2 id="Adam"><a href="#Adam" class="headerlink" title="Adam"></a>Adam</h2><p>ç°åœ¨æˆ‘ä»¬è¦å°† RMSProp å’Œ Momentum ç»“åˆèµ·æ¥ï¼Œå…¶å®äºŒè€…ä¸€ä¸ªæ˜¯å¯¹æ–¹å‘çš„å¹³æ»‘/å¹³å‡ï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹æ¨¡çš„å¹³æ»‘/å¹³å‡</p><script type="math/tex; mode=display">\begin{array}{l}\mathbf{v}_{t} \leftarrow \beta_{1} \mathbf{v}_{t-1}+\left(1-\beta_{1}\right) \mathbf{g}_{t} \\\mathbf{s}_{t} \leftarrow \beta_{2} \mathbf{s}_{t-1}+\left(1-\beta_{2}\right) \mathbf{g}_{t}^{2}\end{array}</script><p>æˆ‘ä»¬åŒæ—¶æ›´æ–°åŠ¨é‡/ä¸€é˜¶çŸ© $v_t$ å’ŒäºŒé˜¶çŸ© $s_t$ï¼ˆéšæœºå˜é‡ x çš„ n é˜¶çŸ©ä¸º $E[x^n]$ï¼‰ã€‚å½“ t æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¸€é˜¶çŸ©å’ŒäºŒé˜¶çŸ©ä¼šä¸å…¶ä¼°è®¡å‡ºç°è¾ƒå¤§çš„åå·®ï¼Œåœ¨æ›´æ–°é€šè¿‡ä»¥ä¸‹å¼å­è¿›è¡Œä¿®æ­£</p><script type="math/tex; mode=display">\hat{\mathbf{v}}_{t}=\frac{\mathbf{v}_{t}}{1-\beta_{1}^{t}} \text { and } \hat{\mathbf{s}}_{t}=\frac{\mathbf{s}_{t}}{1-\beta_{2}^{t}}</script><p>æœ€åæ›´æ–°å‚æ•°ï¼Œæ³¨æ„ Îµ æ˜¯åœ¨æ ¹å·å¤–é¢çš„ï¼Œä¸ RMSProp ä¸åŒï¼Œåœ¨å®è·µä¸­æ•ˆæœç•¥å¥½ï¼Œæ·±å±‚åŸå› ä¸æ˜â€¦</p><script type="math/tex; mode=display">\mathbf{g}_{t}^{\prime}=\frac{\eta \hat{\mathbf{v}}_{t}}{\sqrt{\hat{\mathbf{s}}_{t}}+\epsilon}\\\mathbf{x}_{t} \leftarrow \mathbf{x}_{t-1}-\eta_{t} \mathbf{g}_{t}^{\prime}</script><p>å¯ä»¥çœ‹ pytorch ä¸Šçš„ <a href="https://pytorch.org/docs/stable/generated/torch.optim.Adam.html">Adam</a> æ–‡æ¡£ï¼Œå…¶ç®—æ³•æµç¨‹ä¹Ÿå†™çš„å¾ˆæ¸…æ¥š</p><h2 id="å­¦ä¹ ç‡è°ƒåº¦å™¨"><a href="#å­¦ä¹ ç‡è°ƒåº¦å™¨" class="headerlink" title="å­¦ä¹ ç‡è°ƒåº¦å™¨"></a>å­¦ä¹ ç‡è°ƒåº¦å™¨</h2><p>ç”¨ä¸æ—¶é—´ç›¸å…³çš„å­¦ä¹ ç‡ $Î·(t)$ å–ä»£ $Î·$ å¢åŠ äº†æ§åˆ¶ä¼˜åŒ–ç®—æ³•æ”¶æ•›çš„å¤æ‚æ€§ï¼Œé€šå¸¸å­¦ä¹ ç‡ä¼šéšç€æ—¶é—´è¡°å‡ï¼Œå¸¸ç”¨ä»¥ä¸‹è¡°å‡ç­–ç•¥ï¼š</p><ol><li><p>åˆ†æ®µå¸¸æ•°</p></li><li><p>æŒ‡æ•°è¡°å‡</p></li><li><p>å¤šé¡¹å¼è¡°å‡</p></li><li><p>ä½™å¼¦è¡°å‡</p><script type="math/tex; mode=display">\eta_{t}=\eta_{T}+\frac{\eta_{0}-\eta_{T}}{2}(1+\cos (\pi t / T))</script></li><li><p>å…ˆ<strong>é¢„çƒ­</strong>åè¡°å‡ï¼Œåœ¨ OpenPCDet ä¸­é‡åˆ°çš„ one cycle policyï¼Œå‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/xys430381_1/article/details/89102866">CSDN-æ·±åº¦å­¦ä¹ ä¼˜åŒ–ç­–ç•¥â€”-ä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡è°ƒèŠ‚one cycle policy</a></p></li></ol><p><img src="/archives/15b3ab53/image-20220306161702531.png" alt="image-20220306161702531" style="zoom:50%;"></p><h2 id="è¡¥å……ï¼šä¿¡æ¯è®ºåŸºç¡€"><a href="#è¡¥å……ï¼šä¿¡æ¯è®ºåŸºç¡€" class="headerlink" title="è¡¥å……ï¼šä¿¡æ¯è®ºåŸºç¡€"></a>è¡¥å……ï¼šä¿¡æ¯è®ºåŸºç¡€</h2><p>TODO</p>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode-diary å‰‘æŒ‡offer</title>
      <link href="/archives/ff9614a6.html"/>
      <url>/archives/ff9614a6.html</url>
      
        <content type="html"><![CDATA[<h1 id="leetcode-diary-å‰‘æŒ‡offer"><a href="#leetcode-diary-å‰‘æŒ‡offer" class="headerlink" title="leetcode-diary å‰‘æŒ‡offer"></a>leetcode-diary å‰‘æŒ‡offer</h1><p>å› ä¸ºè¿™ä¸ªé¢˜åº“æ˜¯å¤§å®¶å¼ºæ¨çš„ï¼Œæ‰€ä»¥å…ˆåˆ·æ¯”è¾ƒé‡è¦çš„æ‰æ˜¯æ›´æœ‰æ•ˆç‡çš„ç­–ç•¥ï¼Œä¹‹åå†æ·±å…¥å„ä¸ªæ¿å—ï¼Œ<a href="https://leetcode-cn.com/problem-list/xb9nqhhg/">leetcode å‰‘æŒ‡offer</a></p><p>ç°åœ¨å¼€å§‹æ¯å¤©å¤ä¹  offerï¼Œæ—¨åœ¨èƒ½å¤Ÿé‡åˆ°åŸé¢˜æ—¶å¿«é€Ÿå†™å‡ºæœ€ä¼˜çš„ç­”æ¡ˆã€‚ä¼šåœ¨é¢˜ç›®ä¹‹å mark åšäº†å‡ æ¬¡</p><h4 id="Offer-07-é‡å»ºäºŒå‰æ ‘-MARK-2"><a href="#Offer-07-é‡å»ºäºŒå‰æ ‘-MARK-2" class="headerlink" title="Offer 07. é‡å»ºäºŒå‰æ ‘ MARK 2"></a><a href="https://leetcode-cn.com/problems/zhong-jian-er-cha-shu-lcof/">Offer 07. é‡å»ºäºŒå‰æ ‘</a> MARK 2</h4><p>å‰åº/ååº + ä¸­åºèƒ½æ„å»ºäºŒå‰æ ‘ï¼Œä½†å‰åº + åç»­ä¸èƒ½å¤Ÿæ„å»ºäºŒå‰æ ‘ï¼Œä»…èƒ½æ˜ç¡®çˆ¶å­å…³ç³»ã€‚è¿™ä¸€é¢˜ä½¿ç”¨é€’å½’çš„æ–¹æ³•è¿›è¡Œï¼šç”±å‰åºç¡®å®šæ ¹èŠ‚ç‚¹ï¼Œå·¦å­æ ‘å‰åºï¼Œå³å­æ ‘å‰åºï¼›ç”±ä¸­åºç¡®å®šæ ¹èŠ‚ç‚¹ï¼Œå·¦å­æ ‘ä¸­åºï¼Œå³å­æ ‘ä¸­åºï¼Œç”±æ­¤å°±èƒ½å¤Ÿæ„å»ºé€’å½’ç®—æ³•ã€‚åŸºç¡€æƒ…å†µå°±æ˜¯ä»…æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼ˆå¦‚æœä½¿ç”¨ index å°±ç›´æ¥è€ƒè™‘ index ä¸æ»¡è¶³æ—¶çš„æƒ…å†µï¼‰</p><h4 id="Offer-09-ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—"><a href="#Offer-09-ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="Offer 09. ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—"></a><a href="https://leetcode-cn.com/problems/yong-liang-ge-zhan-shi-xian-dui-lie-lcof/">Offer 09. ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—</a></h4><p>ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªç”¨äºè¿›ï¼Œä¸€ä¸ªç”¨äºå‡º</p><p>åœ¨ <code>append</code> çš„æ—¶å€™æ“ä½œå’Œæ ˆæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œåœ¨ <code>pop</code> çš„æ—¶å€™è¦åˆ†ä¸¤ç§æƒ…å†µè®¨è®ºï¼š1. å½“å‡ºæ ˆä¸ä¸ºç©ºï¼Œåˆ™ <code>pop</code> å‡ºæ ˆï¼›2. å½“å‡ºæ ˆä¸ºç©ºï¼Œåˆ™æŠŠè¿›æ ˆçš„æ•°å­—æ”¾å…¥å‡ºæ ˆï¼Œå† <code>pop</code>ï¼›3. å½“ä¸¤ä¸ªæ ˆéƒ½ä¸ºç©ºï¼Œåˆ™è¿”å› -1</p><h4 id="Offer-10-I-æ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#Offer-10-I-æ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="Offer 10- I. æ–æ³¢é‚£å¥‘æ•°åˆ—"></a><a href="https://leetcode-cn.com/problems/fei-bo-na-qi-shu-lie-lcof/">Offer 10- I. æ–æ³¢é‚£å¥‘æ•°åˆ—</a></h4><p>æœ‰å¤šç§è§£æ³•ï¼š1. é€’å½’ï¼›2. å…¬å¼æ³•ï¼›3. è¿­ä»£/åŠ¨æ€è§„åˆ’ï¼›4. çŸ©é˜µå¿«é€Ÿå¹‚</p><p>ç®€å•è¯´ä¸€ä¸‹æ‰€è°“å¿«é€Ÿå¹‚çš„æ€æƒ³ï¼šæ±‚ä¸€ä¸ªæ•° a çš„ N æ¬¡æ–¹ï¼Œç›¸å½“äºç”¨ä¸¤ä¸ª a çš„ N/2 æ¬¡æ–¹ç›¸ä¹˜ã€‚ä½¿ç”¨é€’å½’çš„æ–¹æ³•æ±‚è§£å³å¯ï¼Œå½“é‡åˆ° N ä¸ºå¥‡æ•°çš„æ—¶å€™ï¼Œæ‹†åˆ†ä¸º a ä¹˜ä»¥ a çš„ N - 1 æ¬¡æ–¹å³å¯</p><h4 id="Offer-11-æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—"><a href="#Offer-11-æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—" class="headerlink" title="Offer 11. æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—"></a><a href="https://leetcode-cn.com/problems/xuan-zhuan-shu-zu-de-zui-xiao-shu-zi-lcof/">Offer 11. æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—</a></h4><p>è¿™æ˜¯ä¹‹å‰åšçš„ä¸€ä¸ªå›°éš¾é¢˜ï¼Œè¿™é‡Œåˆå·©å›ºäº†ä¸€ä¸‹ã€‚åˆé‡æ–°ç†è§£äº†ä¸€ä¸‹äºŒåˆ†æŸ¥æ‰¾ï¼Œmid å€¼å¹¶ä¸æ˜¯ç”¨äºæœç´¢ç›®æ ‡çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªç¡®å®šèŒƒå›´çš„â€œæ¢é’ˆâ€ï¼Œèƒ½å¤Ÿè¿…é€Ÿè®©æœç´¢èŒƒå›´ç¼©å°ä¸€åŠï¼Œä½†éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è¾¹ç•Œé—®é¢˜ï¼Œéœ€è¦ä¿è¯ä¸‰ç‚¹ï¼š</p><ol><li>åœ¨è¾¹ç•Œçš„æƒ…å†µï¼Œå·¦æŒ‡é’ˆä¸€å®šè¦ä¸æ–­å‘å‰ï¼Œæˆ–è€…å³æŒ‡é’ˆä¸€å®šè¦ä¸æ–­å‘åï¼Œè¿™æ ·æ‰èƒ½ä½¿å¾— left &gt; rightï¼Œé¿å…æ­»å¾ªç¯</li><li>æœ€ä¼˜è§£ä¸€å®šè¦åœ¨å·¦å³æŒ‡é’ˆçš„èŒƒå›´ä¹‹å†…ã€‚å³ï¼šåœ¨äºŒåˆ†æœç´¢çš„æ—¶å€™ left = mid + 1 or right = mid - 1 ä¸­çš„ 1 æœ‰æ—¶æ˜¯éœ€è¦è€ƒè™‘çš„</li><li>å¯¹ç‰¹æ®Šæƒ…å†µçš„è®¨è®ºï¼Œå¦‚ï¼šå¯¹è§£ä¸å†æœç´¢èŒƒå›´ä¹‹å†…çš„æƒ…å†µï¼Œåº”è¯¥è¿”å›ä»€ä¹ˆ</li></ol><h4 id="Offer-12-çŸ©é˜µä¸­çš„è·¯å¾„"><a href="#Offer-12-çŸ©é˜µä¸­çš„è·¯å¾„" class="headerlink" title="Offer 12. çŸ©é˜µä¸­çš„è·¯å¾„"></a><a href="https://leetcode-cn.com/problems/ju-zhen-zhong-de-lu-jing-lcof/">Offer 12. çŸ©é˜µä¸­çš„è·¯å¾„</a></h4><p>ä¸€å¼€å§‹æƒ³ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œç®€å•ç®—äº†ä¸€ä¸‹å…¶å¤æ‚åº¦ï¼Œåº”è¯¥ä¼šæ¯”è¾ƒç¦»è°±ï¼Œæ‰€ä»¥æ”¹ä¸ºæ·±åº¦æœç´¢ï¼Œå³å¯¹æ¯ä¸ªä½ç½®è¿›è¡Œæ·±åº¦æœç´¢ï¼Œè¿™æ ·çš„å¤æ‚åº¦ä¼šæ›´åŠ åˆç†ã€‚è¿™é‡Œä¹Ÿè¦ä½¿ç”¨å›æº¯çš„æŠ€å·§ï¼Œæ˜¾ç„¶æˆ‘å·²ç»æŒæ¡äº†</p><h4 id="Offer-14-I-å‰ªç»³å­"><a href="#Offer-14-I-å‰ªç»³å­" class="headerlink" title="Offer 14- I. å‰ªç»³å­"></a><a href="https://leetcode-cn.com/problems/jian-sheng-zi-lcof/">Offer 14- I. å‰ªç»³å­</a></h4><p>è¿™ä¸€é¢˜ç›´æ¥å¥—ç”¨æ•°å­¦ä¸Šçš„ç›´è§‰ï¼Œå½“åˆ†å¾—è¶Šå‡åŒ€è¶Šå¥½ã€‚æ›´ç›´æ¥çš„ç­”æ¡ˆæ˜¯ï¼Œæ‹†åˆ†æˆå°½é‡å¤šçš„é•¿åº¦3ï¼Œå¦‚æœä½™æ•°ä¸º1åˆ™è¦æ‹†åˆ†æˆä¸¤ä¸ª2  </p><h4 id="Offer-15-äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"><a href="#Offer-15-äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°" class="headerlink" title="Offer 15. äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°"></a><a href="https://leetcode-cn.com/problems/er-jin-zhi-zhong-1de-ge-shu-lcof/">Offer 15. äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°</a></h4><p>è¿™ä¸€é¢˜æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œæ¯”è¾ƒå¥½ç†è§£çš„æ˜¯å¯¹æ¯ä¸€ä½è¿›è¡Œæ£€æŸ¥ã€‚å¦ä¸€ä¸ªæ˜¯ n &amp; (n - 1) ç›´åˆ° n ä¸º0</p><p>å¯¹äº2çš„è¿ç®—å¯ä»¥è½¬åŒ–ä¸ºä½è¿ç®—ï¼š</p><ol><li><p>å‘ä¸‹æ•´é™¤2ç­‰ä»·äºå³ç§»ä¸€ä½ n &gt;&gt; 1ã€‚åŒæ ·çš„ä¹˜ä»¥2ç­‰ä»·äºå‘å·¦ç§»åŠ¨ä¸€ä½ï¼Œè¿™æ ·è¿˜å¯ä»¥æ›´æ–¹ä¾¿åœ°è®¡ç®—2çš„ N æ¬¡æ–¹</p></li><li><p>å–2çš„ä½™æ•°ç­‰ä»·äºåˆ¤æ–­äºŒè¿›åˆ¶æœ€å³ä¸€ä½å€¼ n &amp; 1</p></li></ol><h4 id="Offer-18-åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹"><a href="#Offer-18-åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹" class="headerlink" title="Offer 18. åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹"></a><a href="https://leetcode-cn.com/problems/shan-chu-lian-biao-de-jie-dian-lcof/">Offer 18. åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹</a></h4><p>ä½¿ç”¨åŒæŒ‡é’ˆæ¯”è¾ƒåˆç†ä¸€äº›ï¼Œå¿…é¡»è¦è®°å½•å‰ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡ã€‚è¿™æ ·çš„è¯è¿˜éœ€è¦å¯¹ head æƒ…å†µè¿›è¡Œç‰¹æ®Šå¤„ç†</p><h4 id="Offer-20-è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²"><a href="#Offer-20-è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²" class="headerlink" title="Offer 20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/biao-shi-shu-zhi-de-zi-fu-chuan-lcof/">Offer 20. è¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²</a></h4><p>è¿™ä¸€é¢˜çš„è‡ªåŠ¨æœºè¿˜æ˜¯ç¬¬ä¸€æ¬¡è§åˆ°ï¼Œå…·ä½“æƒ…å†µè¯·ç›´æ¥çœ‹é¢˜è§£</p><h4 id="Offer-21-è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢"><a href="#Offer-21-è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢" class="headerlink" title="Offer 21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢"></a><a href="https://leetcode-cn.com/problems/diao-zheng-shu-zu-shun-xu-shi-qi-shu-wei-yu-ou-shu-qian-mian-lcof/">Offer 21. è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢</a></h4><p>ä½¿ç”¨åŒæŒ‡é’ˆè¿›è¡ŒåŸåœ°ä¿®æ”¹</p><h4 id="Offer-24-åè½¬é“¾è¡¨"><a href="#Offer-24-åè½¬é“¾è¡¨" class="headerlink" title="Offer 24. åè½¬é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/fan-zhuan-lian-biao-lcof/">Offer 24. åè½¬é“¾è¡¨</a></h4><p>ç”¨äº†ä¸¤ç§æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯åŸåœ°ä¿®æ”¹ï¼ˆè¿­ä»£ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯å–å‡ºæ¥å†åˆ›å»ºï¼Œå†æœ‰ä¸€ä¸ªå°±æ˜¯é€’å½’ï¼Œæœ€å¥½å°è¯•ä¸€ä¸‹å†™ä¸€ä¸ªæ–°çš„é€’å½’å‡½æ•°è¿”å›å¤´å°¾    </p><h4 id="Offer-25-åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨"><a href="#Offer-25-åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨" class="headerlink" title="Offer 25. åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/he-bing-liang-ge-pai-xu-de-lian-biao-lcof/">Offer 25. åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨</a></h4><p>é¦–å…ˆæƒ³åˆ°çš„å½“ç„¶å°±æ˜¯é€’å½’ã€‚å¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªç©ºèŠ‚ç‚¹ä½œä¸ºå¼€å¤´ï¼Œä½¿ç”¨è¿­ä»£çš„æ–¹æ³•å°†ä¸¤ä¸ªé“¾è¡¨ç©¿èµ·æ¥ï¼Œè¿™æ ·å°±èƒ½å¤Ÿé¿å…ä¸€äº›è¾¹ç•Œæƒ…å†µå¤„ç†ï¼Œæ¯”å¦‚ head èŠ‚ç‚¹ã€‚å¦ä¸€ä¸ªå­¦ä¹ ç‚¹æ˜¯ None å¯ä»¥ç”¨ä½œ False è¿›è¡Œåˆ¤æ–­</p><h4 id="Offer-26-æ ‘çš„å­ç»“æ„"><a href="#Offer-26-æ ‘çš„å­ç»“æ„" class="headerlink" title="Offer 26. æ ‘çš„å­ç»“æ„"></a><a href="https://leetcode-cn.com/problems/shu-de-zi-jie-gou-lcof/">Offer 26. æ ‘çš„å­ç»“æ„</a></h4><p>æ˜¾ç„¶éœ€è¦é€’å½’è¿›è¡Œåˆ¤æ–­æ˜¯å¦æ˜¯å­ç»“æ„ï¼Œå¹¶é€’å½’è¿›è¡Œéå†æ¯ä¸€ä¸ªå­èŠ‚ç‚¹</p><h4 id="Offer-27-äºŒå‰æ ‘çš„é•œåƒ"><a href="#Offer-27-äºŒå‰æ ‘çš„é•œåƒ" class="headerlink" title="Offer 27. äºŒå‰æ ‘çš„é•œåƒ"></a><a href="https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/">Offer 27. äºŒå‰æ ‘çš„é•œåƒ</a></h4><p>æ–¹æ³•ä¸€ä½¿ç”¨é€’å½’ï¼Œè¿™æ˜¯æœ€æ˜æ˜¾çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é˜Ÿåˆ—æ¥è¿›è¡Œå±‚åºéå†</p><h4 id="Offer-28-å¯¹ç§°çš„äºŒå‰æ ‘"><a href="#Offer-28-å¯¹ç§°çš„äºŒå‰æ ‘" class="headerlink" title="Offer 28. å¯¹ç§°çš„äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/dui-cheng-de-er-cha-shu-lcof/">Offer 28. å¯¹ç§°çš„äºŒå‰æ ‘</a></h4><p>æ–¹æ³•ä¸€ä½¿ç”¨é€’å½’ï¼Œåˆ¤æ–­å·¦å³ä¸¤ä¸ªå­æ ‘æ˜¯å¦å¯¹ç§°ï¼›æ–¹æ³•äºŒä½¿ç”¨åˆ¤æ–­æ¯ä¸€å±‚æ˜¯å¦æ˜¯ä¸­å¿ƒå¯¹ç§°ï¼ˆè¿™ä¸ªæ„Ÿè§‰æ¯”è¾ƒéº»çƒ¦ï¼‰</p><h4 id="Offer-29-é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ"><a href="#Offer-29-é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ" class="headerlink" title="Offer 29. é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ"></a><a href="https://leetcode-cn.com/problems/shun-shi-zhen-da-yin-ju-zhen-lcof/">Offer 29. é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ</a></h4><p>è¿™ä¸€é¢˜å¤ªè¿·äº†â€¦å¾ˆæ˜æ˜¾ä¸åº”è¯¥æ˜¯ç®€å•é¢˜ï¼Œå› ä¸ºä¸èƒ½ä½¿ç”¨ç®€å•çš„ä»£ç è¿›è¡Œè¿­ä»£ï¼Œè€Œéœ€è¦å¯¹æ¯ä¸€æ¬¡è¿åŠ¨è¿›è¡Œç»†èŠ‚åˆ¤å®šï¼Œæ‰€ä»¥ä»£ç å°±éš¾çœ‹äº†</p><h4 id="Offer-30-åŒ…å«minå‡½æ•°çš„æ ˆ"><a href="#Offer-30-åŒ…å«minå‡½æ•°çš„æ ˆ" class="headerlink" title="Offer 30. åŒ…å«minå‡½æ•°çš„æ ˆ"></a><a href="https://leetcode-cn.com/problems/bao-han-minhan-shu-de-zhan-lcof/">Offer 30. åŒ…å«minå‡½æ•°çš„æ ˆ</a></h4><p>è·Ÿéšæ ˆçš„ pop and push ç»´æŠ¤ä¸€ä¸ªæœ€å°æ ˆå³å¯</p><h4 id="Offer-31-æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"><a href="#Offer-31-æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—" class="headerlink" title="Offer 31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"></a><a href="https://leetcode-cn.com/problems/zhan-de-ya-ru-dan-chu-xu-lie-lcof/">Offer 31. æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—</a></h4><p>è¿™é‡Œé‡‡ç”¨æ¨¡æ‹Ÿå‡ºå…¥æ ˆçš„æ–¹å¼è¿›è¡Œï¼šåˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿæ ˆï¼Œç„¶åå…ˆå…¥æ ˆï¼Œç„¶åçœ‹èƒ½ä¸èƒ½å‡ºæ ˆï¼Œç›´åˆ°ä¸èƒ½å‡ºæ ˆï¼›æ¥ç€è¿›å…¥ä¸‹ä¸€æ¬¡å…¥æ ˆçš„å¾ªç¯ã€‚è¦æ³¨æ„çš„æ˜¯åœ¨åˆ¤æ–­èƒ½ä¸èƒ½å‡ºæ ˆæ—¶æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>æ ˆä¸ä¸ºç©ºï¼Œä¸”æ ˆæœ€åä¸€ä½æ­£å¥½æ˜¯æˆ‘ä»¬è¦å‡ºæ ˆçš„å…ƒç´ </li><li>æ ˆä¸ºç©º or æœ€åä¸€ä½ä¸æ˜¯æˆ‘ä»¬è¦å‡ºæ ˆçš„å…ƒç´ </li></ol><h4 id="Offer-32-II-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘-II"><a href="#Offer-32-II-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘-II" class="headerlink" title="Offer 32 - II. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ II"></a><a href="https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-ii-lcof/">Offer 32 - II. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ II</a></h4><p>å±‚åºéå†ï¼Œä½¿ç”¨é˜Ÿåˆ—ã€‚ç”±äºå¾ªç¯ç»ˆæ­¢çš„æ¡ä»¶æ˜¯é˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰€ä»¥éœ€è¦å…ˆåŠ å…¥ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œç„¶åå†å¼€å§‹å¾ªç¯</p><h4 id="Offer-33-äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—"><a href="#Offer-33-äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—" class="headerlink" title="Offer 33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—"></a><a href="https://leetcode-cn.com/problems/er-cha-sou-suo-shu-de-hou-xu-bian-li-xu-lie-lcof/">Offer 33. äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—</a></h4><p>åˆ¤æ–­åç»­éå†è¾“å‡ºæ˜¯å¦æ˜¯æŸ<strong>äºŒå‰æœç´¢æ ‘</strong>çš„è¾“å‡ºã€‚ä¸€èˆ¬ååºéå†æ˜¯ä¸èƒ½ç¡®å®šä¸€æ£µæ ‘çš„ï¼Œä½†å¦‚æœæ˜¯äºŒå‰æœç´¢æ ‘é‚£å°±å¯ä»¥ï¼åŒç†ï¼Œå‰åºéå†ä¹Ÿèƒ½å¤Ÿç¡®å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘ï¼Œä½†ä¸­åºéå†ä¼¼ä¹ä¸è¡Œâ€¦å› ä¸ºä¸­åºéå†æ— æ³•ç¡®å®šæ ¹èŠ‚ç‚¹çš„ä½ç½®</p><p>è¿™ä¸€é¢˜çš„æ•°æ®å˜åŒ–æ­£å¥½æœ‰å•è°ƒçš„æ„Ÿè§‰ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘ä½¿ç”¨å•è°ƒæ ˆï¼Œå»ºè®®çœ‹ä¸€ä¸‹é¢˜è§£ï¼Œé€»è¾‘è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å€’åºæ¥çœ‹ã€‚æ¯”è¾ƒå½“å‰èŠ‚ç‚¹å’Œæ ˆé¡¶èŠ‚ç‚¹çš„å¤§å°ï¼š</p><ol><li>å¦‚æœå½“å‰èŠ‚ç‚¹å¤§äºæ ˆé¡¶èŠ‚ç‚¹ï¼Œåˆ™å½“å‰èŠ‚ç‚¹ä¸ºæ ˆé¡¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹</li><li>å¦‚æœå½“å‰èŠ‚ç‚¹å°äºæ ˆé¡¶èŠ‚ç‚¹ï¼Œåˆ™å½“å‰èŠ‚ç‚¹ä¸ºæ ˆä¸­<strong>æŸä¸€èŠ‚ç‚¹</strong>çš„å·¦èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹æ˜¯è·ç¦»å½“å‰èŠ‚ç‚¹æœ€è¿‘çš„ç‚¹</li></ol><p>è¿™æ˜¯ä¸¤ä¸ªåŸºæœ¬æ€§è´¨ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªåŸºæœ¬æ€§è´¨å•è°ƒæ ˆçš„ä½¿ç”¨æ–¹æ³•å°±å‡ºæ¥äº†ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ¤å®šäºŒå‰æœç´¢æ ‘ï¼Œè¿™ä¸»è¦çœ‹ç¬¬ä¸€æ¡æ€§è´¨ã€‚å› ä¸ºå½“å‰èŠ‚ç‚¹çš„å¤§å°å¯ä»¥å¾ˆå¤§ï¼Œæœ‰å¯èƒ½å¤§å‡ºäº†æ ¹èŠ‚ç‚¹çš„å¤§å°ï¼Œä¾‹å¦‚æŸå€’åºä¸º <code>[5, 2, 3, 6 ,1]</code>ï¼Œè¿™æ ·å°±ä¸æ˜¯äºŒå‰æœç´¢æ ‘äº†ï¼Œæ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“å½“å‰æ ˆçš„æ ¹èŠ‚ç‚¹æ˜¯è°</p><h4 id="Offer-34-äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„"><a href="#Offer-34-äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„" class="headerlink" title="Offer 34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„"></a><a href="https://leetcode-cn.com/problems/er-cha-shu-zhong-he-wei-mou-yi-zhi-de-lu-jing-lcof/">Offer 34. äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„</a></h4><p>æ·±åº¦æœç´¢é¢„å®šï¼Œä¸€å¼€å§‹è¯»é¢˜çš„æ—¶å€™åˆå®¡é”™äº†ã€‚æ˜¯è¦æ‰¾ä»<strong>æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹</strong>çš„æƒ…å†µï¼è¿™æ ·å¯¹äºå‰ªæçš„æƒ…å†µåªèƒ½æ˜¯åˆ°è¾¾æ ¹èŠ‚ç‚¹åå†è¿›è¡Œåˆ¤æ–­ï¼ŒåŒæ—¶è¿›è¡Œæœç´¢æ—¶ä¹Ÿè¦åˆ¤æ–­ä¸€ä¸‹å·¦å³èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º</p><h4 id="Offer-35-å¤æ‚é“¾è¡¨çš„å¤åˆ¶"><a href="#Offer-35-å¤æ‚é“¾è¡¨çš„å¤åˆ¶" class="headerlink" title="Offer 35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶"></a><a href="https://leetcode-cn.com/problems/fu-za-lian-biao-de-fu-zhi-lcof/">Offer 35. å¤æ‚é“¾è¡¨çš„å¤åˆ¶</a></h4><p>è¿™ä¸€é¢˜æœ‰ä¸¤ç§è§£æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨æ—§è¡¨èŠ‚ç‚¹ä½œä¸º keyï¼Œå…¶ value ä¸ºå¤åˆ¶çš„æ–°èŠ‚ç‚¹ï¼Œç„¶åå¯¹æ—§è¡¨è¿›è¡Œå¾ªç¯ï¼Œé€šè¿‡å¯¹å“ˆå¸Œè¡¨çš„æŸ¥è¯¢æŠŠæ–°è¡¨è¿æ¥èµ·æ¥ã€‚å¦ä¸€ç§æ˜¯æ‹¼æ¥å’Œæ‹†åˆ†ï¼Œæ„Ÿè§‰æ¯”è¾ƒæ™¦æ¶©</p><h4 id="Offer-36-äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨"><a href="#Offer-36-äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨" class="headerlink" title="Offer 36. äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨"></a><a href="https://leetcode-cn.com/problems/er-cha-sou-suo-shu-yu-shuang-xiang-lian-biao-lcof/">Offer 36. äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨</a></h4><p><strong>ä¸­åºéå†èƒ½å¤Ÿé¡ºåºè¾“å‡ºäºŒå‰æœç´¢æ ‘</strong>ä¸­çš„å€¼ï¼Œæ‰€ä»¥è¿™ä¸€é¢˜åº”å½“ä¼˜å…ˆè€ƒè™‘ä¸­åºéå†ï¼ˆç„¶è€Œæˆ‘ä¸€å¼€å§‹å¹¶ä¸çŸ¥é“è¿™ä¸€ç‚¹ï¼Œç›´æ¥è½äº†é€’å½’ï¼Œè°ƒè¯•å¤ªç—›è‹¦äº†ï¼ŒæŒ‡é’ˆçš„å˜åŒ–å¾ˆéš¾å¼„æ¸…æ¥šï¼Œæœ€å¥½ä½¿ç”¨ tempt å˜é‡å­˜å‚¨èŠ‚ç‚¹ï¼Œç„¶åå†è¿›è¡ŒæŒ‡é’ˆè¿æ¥ï¼‰</p><p>ä¸€äº›å…³é”®çš„æŠ€å·§ä¸ºï¼šä½¿ç”¨ä¸€ä¸ªå˜é‡ <code>pre, head</code> æ¥è®°å½•æ¯ä¸€ä¸ªèŠ‚ç‚¹å‰èŠ‚ç‚¹å’Œæœ€ç»ˆè¾“å‡ºçš„å¤´èŠ‚ç‚¹ï¼Œåœ¨æ¯æ¬¡ä¸­åºéå†çš„æ—¶å€™å°†è¯¥èŠ‚ç‚¹ä¸å‰èŠ‚ç‚¹è¿›è¡Œè¿æ¥ï¼Œç„¶åæ›´æ–°å‰èŠ‚ç‚¹ã€‚åœ¨éå†ç»“æŸåå†å°†å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹è¿æ¥</p><h4 id="Offer-37-åºåˆ—åŒ–äºŒå‰æ ‘"><a href="#Offer-37-åºåˆ—åŒ–äºŒå‰æ ‘" class="headerlink" title="Offer 37. åºåˆ—åŒ–äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/xu-lie-hua-er-cha-shu-lcof/">Offer 37. åºåˆ—åŒ–äºŒå‰æ ‘</a></h4><p>å±‚åºéå†çš„æµç¨‹ï¼š1. éœ€è¦å…ˆåœ¨é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªå…ƒç´ ï¼›2. å¾ªç¯ä¸­ï¼Œå…ˆ pop å† pop å‡ºçš„èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œç„¶å appen å…¶å­èŠ‚ç‚¹</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ deque çš„ popleft é€Ÿåº¦æ¯”åˆ—è¡¨çš„ pop(0) è¦å¿«å¾—å¤š</p><h4 id="Offer-38-å­—ç¬¦ä¸²çš„æ’åˆ—"><a href="#Offer-38-å­—ç¬¦ä¸²çš„æ’åˆ—" class="headerlink" title="Offer 38. å­—ç¬¦ä¸²çš„æ’åˆ—"></a><a href="https://leetcode-cn.com/problems/zi-fu-chuan-de-pai-lie-lcof/">Offer 38. å­—ç¬¦ä¸²çš„æ’åˆ—</a></h4><p>ä¸€å¼€å§‹æƒ³åˆ°çš„æ˜¯ç›´æ¥è§£å†³ï¼Œæ‰¾å‡ºæ‰€æœ‰çš„å¯èƒ½æ’åˆ—ï¼Œè¿˜æƒ³äº†ä¸€ä¸‹é€æ¸å¢åŠ å­—ç¬¦çš„é€’å½’æ–¹æ³•ã€‚ç„¶è€Œè¿™äº›æ€è·¯ä¸å¤Ÿç®€æ´ï¼Œå¯¹äºæ’åˆ—æœ€å¥½è¿˜æ˜¯ä½¿ç”¨æ·±åº¦æœç´¢çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¸ºäº†è§£å†³é‡å¤æ€§çš„é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œå‰ªæï¼Œå³æŸä¸ªä½ç½®çš„å­—ç¬¦ä¸ä¼šé‡å¤æœç´¢</p><p>å¦‚æœæ—¥å¸¸ä¸­éœ€è¦å·æ‡’çš„è¯å°±ç›´æ¥ä½¿ç”¨ Python åº“ <code>itertools.permutations()</code></p><h4 id="Offer-39-æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—"><a href="#Offer-39-æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—" class="headerlink" title="Offer 39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-chu-xian-ci-shu-chao-guo-yi-ban-de-shu-zi-lcof/">Offer 39. æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­—</a></h4><p>è¿™ä¸€é¢˜è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æœ‰å¤šç§ä¸åŒçš„æ–¹æ³•ï¼š1. ä½¿ç”¨ Counter or hash table æ‰¾åˆ°æœ€å¤šçš„æ•°å­—å¹¶è¿›è¡Œåˆ¤æ–­ï¼›2. å°†æ•°ç»„è¿›è¡Œæ’åºï¼Œåªè¦ç¬¬ä¸€ä½å’Œä¸­ä½æ•°æ˜¯ä¸€æ ·çš„å³å¯ï¼›3. æŠ•ç¥¨æ³•ï¼šå‡è®¾ç¥¨æ•°ä¸ºé›¶åˆ™å½“å‰æ•°ä½œä¸ºä¼—æ•°ï¼Œå¹¶ä¸æ¥ä¸‹æ¥çš„æ•°è¿›è¡Œæ¯”è¾ƒï¼Œé‡åˆ°ä¸è¯¥æ•°ç›¸ç­‰çš„åˆ™ç¥¨æ•°åŠ ä¸€ï¼Œé‡åˆ°ä¸ç›¸ç­‰çš„ç¥¨æ•°å‡ä¸€ï¼Œå¦‚æ­¤è¿›è¡Œå¾ªç¯ã€‚å…¶åŸç†æ˜¯ï¼šå½“ç¥¨æ•°ä¸ºé›¶æ—¶ï¼Œä¹‹åçš„è®¡ç®—å¾—åˆ°çš„ä¼—æ•°å°±æ˜¯å…¨å±€çš„ä¼—æ•°ï¼Œæœ€åè¿˜å¯ä»¥åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœ count å¤§äºä¸€èˆ¬åˆ™ä¸ºçœŸä¼—æ•°ï¼Œå¦åˆ™ä¼—æ•°ä¸å­˜åœ¨</p><h4 id="Offer-40-æœ€å°çš„kä¸ªæ•°"><a href="#Offer-40-æœ€å°çš„kä¸ªæ•°" class="headerlink" title="Offer 40. æœ€å°çš„kä¸ªæ•°"></a><a href="https://leetcode-cn.com/problems/zui-xiao-de-kge-shu-lcof/">Offer 40. æœ€å°çš„kä¸ªæ•°</a></h4><p>ä¸‰ä¸ªæ€è·¯ï¼š1. æ’åºï¼›2. å †ï¼›3. å¿«æ’æ€æƒ³ï¼šå¯»æ‰¾ç¬¬ k å° or ç¬¬ k + 1 å°çš„æ•°ï¼Œæ‰¾åˆ°è¿‡åæŠŠå…¶å·¦è¾¹çš„æ•°ä¸€åŒè¾“å‡ºå³ä¸ºç­”æ¡ˆï¼ŒæœŸæœ›æ—¶é—´ä¸º O(N)</p><p>åˆå­¦ä¹ åˆ°äº†ä¸€ä¸ªæ–°æ–¹æ³•ï¼špython çš„äº¤æ¢å€¼è¯­æ³•å¯ä»¥ç”¨ä¸€è¡Œå†™å®Œï¼Œä¸éœ€è¦ tempt å€¼ã€‚åŒæ—¶è¿™ä¸€é¢˜è®©æˆ‘å¯¹å¿«æ’çš„ä»£ç å®Œå…¨äº†è§£äº†ï¼Œå®ç°äº†åŸåœ°ä¿®æ”¹å’ŒéåŸåœ°ä¿®æ”¹ä¸¤ç§ç‰ˆæœ¬</p><h4 id="Offer-41-æ•°æ®æµä¸­çš„ä¸­ä½æ•°"><a href="#Offer-41-æ•°æ®æµä¸­çš„ä¸­ä½æ•°" class="headerlink" title="Offer 41. æ•°æ®æµä¸­çš„ä¸­ä½æ•°"></a><a href="https://leetcode-cn.com/problems/shu-ju-liu-zhong-de-zhong-wei-shu-lcof/">Offer 41. æ•°æ®æµä¸­çš„ä¸­ä½æ•°</a></h4><p>è¿™é‡Œä»‹ç» python æœ‰å…³å †çš„åº“ heapq å †é˜Ÿåˆ—ï¼Œéœ€è¦äº†è§£çš„æœ‰å‡ ç‚¹ï¼š</p><ol><li>å»ºå †æ˜¯ O(N) æ—¶é—´å¤æ‚åº¦ï¼›</li><li>å †æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼Œä½†æ˜¯å®Œå…¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥å®ç°ï¼Œå› ä¸ºå®Œå…¨äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ä¹‹é—´çš„ index å…³ç³»æ˜¯ç¡®å®šçš„ï¼š<code>left = root * 2 + 1</code> &amp; <code>right = root * 2 + 2</code></li><li>insert &amp; pop çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logN)</li></ol><p>python é‡Œé¢åªå®ç°äº†æœ€å°å †ï¼Œæœ€å¤§å †å¯ä»¥é€šè¿‡æŠŠå€¼å–è´Ÿæ•°å®ç°ã€‚å»ºå †å¯ä»¥ä½¿ç”¨ <code>heapify(list)</code> or ç›´æ¥å‘ä¸€ä¸ªåˆ—è¡¨æ’å…¥å³å¯è‡ªåŠ¨å»ºå † <code>heappush(list, num)</code>ï¼Œåˆ é™¤å †é¡¶æ“ä½œä¸º <code>heappop</code>ï¼Œè·å¾—å †é¡¶ç›´æ¥å–åˆ‡ç‰‡ <code>list[0]</code></p><p>è¿™ä¸€é¢˜é€šè¿‡å»ºç«‹ä¸¤ä¸ªå †ï¼Œä¸€ä¸ªæœ€å¤§å †å’Œä¸€ä¸ªæœ€å°å †ã€‚å…¶ä¸­æœ€å¤§å † B ä¿ç•™è¾ƒå°çš„æ•°ï¼Œæœ€å°å † A ä¿ç•™è¾ƒå¤§çš„æ•°ï¼Œè¿™å°†ä½¿å¾— A &gt;= B ä»¥ä¸¤ä¸ªå †çš„æ•°é‡æ˜¯å¦ç›¸ç­‰ä¸ºåˆ¤æ–­ï¼š</p><ol><li>å½“ä¸¤ä¸ªå †æ•°é‡ç›¸ç­‰æ—¶ï¼ŒæŠŠæ•°å­—æ’å…¥æœ€å¤§å † Bï¼Œç„¶å pop å‡º B å †ä¸­çš„æœ€å¤§å€¼ï¼Œå°†å…¶æ’å…¥ A ä¸­</li><li>å½“ä¸¤ä¸ªå †æ•°é‡ä¸ç­‰æ—¶ï¼ˆå‡†ç¡®æ¥è¯´å½“ A å †æ¯” B å †å¤šä¸€ä¸ªæ•°æ—¶ï¼‰ï¼ŒæŠŠæ•°å­—æ’å…¥æœ€å°å † Bï¼Œç„¶å pop å‡º A å †ä¸­çš„æœ€å°å€¼ï¼Œå°†å…¶æ’å…¥ B ä¸­</li></ol><p>ä»¥ä¸Šçš„ä¸¤ä¸ªæ–¹æ³•å°†ç»´æŠ¤è¿™ä¸¤ä¸ªå †ï¼Œä¿æŒè¾“å…¥çš„æ•°ç»„å‡åŒ€åˆ†æˆä¸¤ä»½</p><h4 id="Offer-42-è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ"><a href="#Offer-42-è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ" class="headerlink" title="Offer 42. è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ"></a><a href="https://leetcode-cn.com/problems/lian-xu-zi-shu-zu-de-zui-da-he-lcof/">Offer 42. è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ</a></h4><p>å¾ˆæ˜æ˜¾çš„åŠ¨æ€è§„åˆ’é¢˜ç›®ï¼Œä»¥ç¬¬ i ä¸ªæ•°ä¸ºç»“å°¾çš„è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œä¸ºçŠ¶æ€è¿›è¡Œæ„å»º</p><h4 id="Offer-43-1ï½n-æ•´æ•°ä¸­-1-å‡ºç°çš„æ¬¡æ•°"><a href="#Offer-43-1ï½n-æ•´æ•°ä¸­-1-å‡ºç°çš„æ¬¡æ•°" class="headerlink" title="Offer 43. 1ï½n æ•´æ•°ä¸­ 1 å‡ºç°çš„æ¬¡æ•°"></a><a href="https://leetcode-cn.com/problems/1nzheng-shu-zhong-1chu-xian-de-ci-shu-lcof/">Offer 43. 1ï½n æ•´æ•°ä¸­ 1 å‡ºç°çš„æ¬¡æ•°</a></h4><p>è¿™æ˜¯ä¸€ä¸ªå›°éš¾é¢˜ï¼Œè¿™ä¸€é¢˜æ²¡æœ‰ä»€ä¹ˆå¥—è·¯å¯è¨€ã€‚å®Œå…¨æ˜¯é€šè¿‡é€»è¾‘çš„æ¨æ¼”å¾—å‡ºçš„è§£é¢˜æ€è·¯ï¼Œå…¶ä¸»æ€è·¯æ˜¯è®¡ç®—æ¯ä¸€ä½ä¸Šå‡ºç°1çš„æ¬¡æ•°ï¼Œè€Œæ¯ä¸€ä½å‡ºç°1çš„æ¬¡æ•°è¦åˆ†ä¸‰ç§æƒ…å†µè®¨è®ºï¼š</p><ol><li>è¯¥ä½æ˜¯0ï¼Œåˆ™å‡ºç°æ¬¡æ•°ä»…ä¸é«˜ä½ç›¸å…³ï¼š<code>high * 10 ** i</code></li><li>è¯¥ä½æ˜¯1ï¼Œåˆ™å‡ºç°æ¬¡æ•°ä¸é«˜ä½å’Œåœ°ä½ç›¸å…³ï¼š<code>high * 10 ** i + low + 1</code></li><li>è¯¥ä½æ˜¯é™¤0ï¼Œ1ä¹‹å¤–çš„å…¶ä»–æ•°å­—ï¼Œåˆ™å‡ºç°æ¬¡æ•°ä»…ä¸é«˜ä½ç›¸å…³ï¼š<code>(high + 1) * 10 ** i</code></li></ol><h4 id="Offer-44-æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—"><a href="#Offer-44-æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—" class="headerlink" title="Offer 44. æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/shu-zi-xu-lie-zhong-mou-yi-wei-de-shu-zi-lcof/">Offer 44. æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—</a></h4><p>è¿™ä¸€é¢˜å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œä¹Ÿæ˜¯éœ€è¦é€šè¿‡é¢˜ç›®æœ¬èº«çš„é€»è¾‘æ¨æ¼”å‡ºè¿­ä»£æ€è·¯ï¼Œä¸èƒ½å¤Ÿé€šè¿‡é€’å½’çš„æ–¹æ³•è¿›è¡Œã€‚ä¹Ÿæ˜¯æ ¹æ®æ•°çš„ä½æ•°ä½œä¸ºçªç ´å£ï¼Œå…ˆå¯»æ‰¾è¿™æ˜¯å‡ ä½æ•°ï¼Œç„¶åå†çœ‹æ•°å­—æ˜¯å‡ ï¼Œæœ€åå†å¾—å‡ºç­”æ¡ˆ</p><h4 id="Offer-45-æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°"><a href="#Offer-45-æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°" class="headerlink" title="Offer 45. æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°"></a><a href="https://leetcode-cn.com/problems/ba-shu-zu-pai-cheng-zui-xiao-de-shu-lcof/">Offer 45. æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•°</a></h4><p>è¿™ä¸€é¢˜æœ¬è´¨æ˜¯ä¸€ä¸ªæ’åºé—®é¢˜ï¼Œå¦‚ä½•æ¯”è¾ƒä¸¤ä¸ªæ•° x, y çš„å¤§å°å®šä¹‰ä¸ºå‰åä¸¤ç§ä¸åŒæ‹¼æ¥çš„å­—ç¬¦ä¸²å¤§å°ï¼šè‹¥ xy &lt; yx åˆ™ x &lt; y åä¹‹ x &gt; y</p><p>python ä¸­è‡ªå®šä¹‰æ’åºéœ€è¦ä½¿ç”¨ <code>functools.cmp_to_key(cmp_func)</code>ï¼Œè¯¥å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥  <code>sorted(,key=)</code>ï¼Œæ›´å¤šåŸç†å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/26546486">çŸ¥ä¹</a>ï¼Œå…¶æ ¸å¿ƒæ˜¯é€šè¿‡é‡è½½ç®—ç¬¦è¿”å›ä¸€ä¸ªå¯æ¯”è¾ƒçš„ç±»</p><h4 id="Offer-46-æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²"><a href="#Offer-46-æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²" class="headerlink" title="Offer 46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/ba-shu-zi-fan-yi-cheng-zi-fu-chuan-lcof/">Offer 46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸²</a></h4><p>æ¯”è¾ƒæ˜æ˜¾ä¸€é“æ·±åº¦æœç´¢çš„é¢˜ç›®ï¼Œå¾ˆå¿«å°±è§£å‡ºæ¥äº†ï¼Œè¿™é¢˜å­¦åˆ°çš„æ˜¯ç­”æ¡ˆä¸€èˆ¬åœ¨å®Œæˆä¸€æ¡æœç´¢è·¯å¾„åå†æ·»åŠ ï¼Œåœ¨ä¸­é€”æ˜¯ä¸æ·»åŠ çš„</p><h4 id="Offer-47-ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼"><a href="#Offer-47-ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼" class="headerlink" title="Offer 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼"></a><a href="https://leetcode-cn.com/problems/li-wu-de-zui-da-jie-zhi-lcof/">Offer 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼</a></h4><p>å…ˆå°è¯•äº†æ·±åº¦æœç´¢ï¼Œä½†è¶…æ—¶äº†ï¼Œå†åšäº†åŠ¨æ€è§„åˆ’</p><h4 id="Offer-48-æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²"><a href="#Offer-48-æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²" class="headerlink" title="Offer 48. æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²"></a><a href="https://leetcode-cn.com/problems/zui-chang-bu-han-zhong-fu-zi-fu-de-zi-zi-fu-chuan-lcof/">Offer 48. æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸²</a></h4><p>è¿™ä¸€é¢˜ä¹‹å‰åšè¿‡ï¼Œä½¿ç”¨åŒæŒ‡é’ˆ + ä¸€ä¸ªå“ˆå¸Œè¡¨å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨åŠ¨æ€è§„åˆ’è§£å†³ä½†æ€è·¯å°±æ¯”è¾ƒå¤æ‚ä¸€ç‚¹</p><h4 id="Offer-49-ä¸‘æ•°"><a href="#Offer-49-ä¸‘æ•°" class="headerlink" title="Offer 49. ä¸‘æ•°"></a><a href="https://leetcode-cn.com/problems/chou-shu-lcof/">Offer 49. ä¸‘æ•°</a></h4><p>è¿™ä¸€é¢˜æ¯”è¾ƒå¥½ç†è§£çš„æ˜¯å †æ–¹æ³•ï¼ŒåŠ¨æ€è§„åˆ’æ–¹æ³•ä¸å¤ªå¥½ç†è§£ï¼Œå¦‚æœæ¨å¯¼å‡ºä¸‹ä¸€ä¸ªä¸‘æ•°çš„è¿‡ç¨‹ï¼ˆä¸‰æŒ‡é’ˆé€æ¸å¾€å‰æ»šåŠ¨ï¼‰ï¼Œä¸‹é¢å¼•ç”¨é¢˜è§£ä¸­çš„è¯„è®º</p><blockquote><p>è®¾ç½®3ä¸ªç´¢å¼•a, b, cï¼Œåˆ†åˆ«è®°å½•å‰å‡ ä¸ªæ•°å·²ç»è¢«ä¹˜2ï¼Œ ä¹˜3ï¼Œ ä¹˜5äº†ï¼Œæ¯”å¦‚aè¡¨ç¤ºå‰(a-1)ä¸ªæ•°éƒ½å·²ç»ä¹˜è¿‡ä¸€æ¬¡2äº†ï¼Œä¸‹æ¬¡åº”è¯¥ä¹˜2çš„æ˜¯ç¬¬aä¸ªæ•°ï¼›bè¡¨ç¤ºå‰(b-1)ä¸ªæ•°éƒ½å·²ç»ä¹˜è¿‡ä¸€æ¬¡3äº†ï¼Œä¸‹æ¬¡åº”è¯¥ä¹˜3çš„æ˜¯ç¬¬bä¸ªæ•°ï¼›cè¡¨ç¤ºå‰(c-1)ä¸ªæ•°éƒ½å·²ç»ä¹˜è¿‡ä¸€æ¬¡5äº†ï¼Œä¸‹æ¬¡åº”è¯¥ä¹˜5çš„æ˜¯ç¬¬cä¸ªæ•°</p></blockquote><h4 id="Offer-50-ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦"><a href="#Offer-50-ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦" class="headerlink" title="Offer 50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦"></a><a href="https://leetcode-cn.com/problems/di-yi-ge-zhi-chu-xian-yi-ci-de-zi-fu-lcof/">Offer 50. ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦</a></h4><p>ç›´æ¥è°ƒç”¨ counter æ€æ­»æ¯”èµ›ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ç§è§£æ³•æ˜¯ä½¿ç”¨æœ‰åºå­—å…¸ OrderedDictï¼Œå®é™…ä¸Š python åœ¨ 3.6 ä¹‹åå…¶å­—å…¸å°±æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥ä¸å¿…ä½¿ç”¨ collections åº“</p><h4 id="Offer-51-æ•°ç»„ä¸­çš„é€†åºå¯¹"><a href="#Offer-51-æ•°ç»„ä¸­çš„é€†åºå¯¹" class="headerlink" title="Offer 51. æ•°ç»„ä¸­çš„é€†åºå¯¹"></a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-de-ni-xu-dui-lcof/">Offer 51. æ•°ç»„ä¸­çš„é€†åºå¯¹</a></h4><p>å…ˆæ€è€ƒäº†å„ç§æ–¹æ³•ï¼Œå…¶å…³é”®åœ¨äºæ±‚å‡ºå½“å‰æ•°å­—ä¹‹åæ¯”å…¶å°çš„æ•°å­—æœ‰å¤šå°‘ï¼Œæ€è·¯å…¶å®å·²ç»å‡ºæ¥äº†ï¼Œåªéœ€è¦ç»´æŠ¤ä¹‹å‰çš„æ•°ç»„æœ‰åºå³å¯ã€‚è¿™é‡Œæˆ‘å…ˆä½¿ç”¨äº† python ä¸­çš„ä¸€ä¸ªåº“è¿›è¡Œå®ç° bisectï¼Œç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªåº“çš„ä¸¤ä¸ªæ–¹æ³• <code>inosrt_left(list, num) &amp; bisect_left(list, num)</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«ä»£è¡¨æ’å…¥å’ŒæŸ¥æ‰¾ï¼Œleft ä»£è¡¨å½“æœ‰ç›¸åŒæ•°å­—çš„æ—¶å€™ï¼Œå°†æ’å…¥åœ¨å…¶å·¦ä¾§ã€‚å…¶å®æ’å…¥æ—¶æ’åœ¨å“ªè¾¹éƒ½æ²¡æœ‰å½±å“ï¼Œæœ‰å½±å“çš„æ˜¯åœ¨å¯»æ‰¾æ—¶è¿”å›çš„ indexï¼Œè¯¥ index æ˜¯è¯¥æ•°å­—æ’å…¥ååœ¨æ•°ç»„ä¸­çš„ index</p><p>å®é™…ä¸Š Python ä¸­çš„ insert æ“ä½œéƒ½æ˜¯ O(N) çš„ï¼Œä¸¤ä¸ªåˆ—è¡¨ç›¸åŠ çš„é€Ÿåº¦ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œæ­¤é¢˜çœŸæ­£çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨å½’å¹¶æ’åºè¾¾åˆ° O(NlogN) æ—¶é—´å¤æ‚åº¦</p><h4 id="Offer-52-ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹"><a href="#Offer-52-ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹" class="headerlink" title="Offer 52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹"></a><a href="https://leetcode-cn.com/problems/liang-ge-lian-biao-de-di-yi-ge-gong-gong-jie-dian-lcof/">Offer 52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹</a></h4><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯å“ˆå¸Œè¡¨è§£å†³ï¼Œæ¯”è¾ƒä¼˜é›…çš„æ–¹æ³•æ˜¯ä¸¤ä¸ªæŒ‡é’ˆéƒ½å‘å‰èµ° (a + b - c) æ­¥ä¸€å®šèƒ½å¤Ÿå¾—åˆ°å…¶äº¤ç‚¹ or Noneï¼Œå…¶ä¸­ a, b åˆ†åˆ«ä¸ºé“¾è¡¨çš„é•¿åº¦ï¼Œc ä¸ºå…¬å…±é“¾è¡¨çš„é•¿åº¦ï¼Œå…·ä½“æ“ä½œä¸ºå½“äºŒè€…çš„æŒ‡é’ˆä¸ç›¸ç­‰æ—¶åˆ™ä¸€ç›´å¾ªç¯ï¼Œè‹¥äºŒè€…çš„æŒ‡é’ˆä¸º None åˆ™å°†å…¶æŒ‡å‘å¯¹æ–¹çš„å¤´èŠ‚ç‚¹</p><h4 id="Offer-53-I-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­—-I"><a href="#Offer-53-I-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­—-I" class="headerlink" title="Offer 53 - I. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­— I"></a><a href="https://leetcode-cn.com/problems/zai-pai-xu-shu-zu-zhong-cha-zhao-shu-zi-lcof/">Offer 53 - I. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­— I</a></h4><p>æ˜¾ç„¶ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œè¿™é‡Œå†é‡æ–°è‡ªå·±å†™ä¸€é</p><h4 id="Offer-53-II-0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—"><a href="#Offer-53-II-0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—" class="headerlink" title="Offer 53 - II. 0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/que-shi-de-shu-zi-lcof/">Offer 53 - II. 0ï½n-1ä¸­ç¼ºå¤±çš„æ•°å­—</a></h4><p>æ˜¾ç„¶ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œå†é‡æ–°æ€»ç»“ä¸€ä¸‹å¥—è·¯ï¼šé¦–å…ˆæ ‡å®š left &amp; rightï¼Œç„¶åè¿›å…¥å¾ªç¯ï¼š1. äºŒåˆ†ï¼›2. æœç´¢åŒºé—´çš„ç•Œå®šï¼›3. è¾¹ç•Œæƒ…å†µçš„åˆ¤æ–­ï¼ˆleft &amp; right ç›¸é‚»ï¼Œåˆ¤æ–­æœ€ç»ˆè¿”å›å€¼çš„å…·ä½“ä½ç½®ï¼‰</p><h4 id="Offer-54-äºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹"><a href="#Offer-54-äºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹" class="headerlink" title="Offer 54. äºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹"></a><a href="https://leetcode-cn.com/problems/er-cha-sou-suo-shu-de-di-kda-jie-dian-lcof/">Offer 54. äºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹</a></h4><p>ä¸­åºéå†ï¼Œå¹¶åœ¨ count &gt;= k æ—¶è¿›è¡Œå‰ªæï¼Œå‰ªæçš„æŠ€å·§é€šå¸¸åœ¨æœç´¢å‡½æ•°çš„å¼€å¤´ï¼Œå¯ä»¥æŠŠå…¶ä½œä¸º basic cases</p><h4 id="Offer-55-I-äºŒå‰æ ‘çš„æ·±åº¦"><a href="#Offer-55-I-äºŒå‰æ ‘çš„æ·±åº¦" class="headerlink" title="Offer 55 - I. äºŒå‰æ ‘çš„æ·±åº¦"></a><a href="https://leetcode-cn.com/problems/er-cha-shu-de-shen-du-lcof/">Offer 55 - I. äºŒå‰æ ‘çš„æ·±åº¦</a></h4><p>å¯ä»¥ç”¨ä»»ä¸€åºçš„éå†è§£é¢˜ï¼Œæˆ‘é‡‡ç”¨äº†å…ˆåºï¼ŒåŒæ ·ä¸ºäº†çœå»å›æº¯çš„éº»çƒ¦ï¼Œæˆ‘å°† path / depth ä½œä¸ºå‚æ•°æ”¾å…¥äº†æœç´¢å‡½æ•°å½“ä¸­ï¼Œè¿™ä¹Ÿæ˜¯é€’å½’çš„æ€æƒ³</p><h4 id="Offer-55-II-å¹³è¡¡äºŒå‰æ ‘"><a href="#Offer-55-II-å¹³è¡¡äºŒå‰æ ‘" class="headerlink" title="Offer 55 - II. å¹³è¡¡äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/ping-heng-er-cha-shu-lcof/">Offer 55 - II. å¹³è¡¡äºŒå‰æ ‘</a></h4><p>è¿™ä¸€é¢˜çš„è¿·æƒ‘ä¸»è¦æ˜¯åœ¨äºå‰ªææ–¹é¢ã€‚é¦–å…ˆæˆ‘å®šä¹‰äº†ä¸€ä¸ªé€’å½’çš„è§£æ³•ï¼Œåœ¨é€’å½’çš„è¿‡ç¨‹ä¸­ä¸€æ—¦å‘ç°ä¸ç¬¦åˆå°±å¯ä»¥ä¸ç”¨ç»§ç»­é€’å½’äº†ï¼Œä½†æ˜¯é€’å½’çš„è¿”å›å€¼æ˜¯æ ‘çš„æ·±åº¦ï¼Œè€Œåœ¨è®¡ç®—ä¸­ä¼šä½¿ç”¨è¿™ä¸ªæ·±åº¦ï¼Œå…¶ä¸­å°±å®¹æ˜“å‡ºé”™äº†ã€‚ç²—æš´çš„å‰ªæå¯ä»¥åœ¨æ‰€æœ‰é€’å½’ç»“æŸçš„åœ°æ–¹éƒ½è¿›è¡Œï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨å¼€å¤´</p><h4 id="Offer-56-I-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°"><a href="#Offer-56-I-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°" class="headerlink" title="Offer 56 - I. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°"></a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-lcof/">Offer 56 - I. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°</a></h4><p>è¿™ä¸€é¢˜æ˜¯æƒ³ç ´å¤´éƒ½æ²¡ç›¸å‡ºæ¥ï¼Œç›´æ¥çœ‹ç­”æ¡ˆå§ï¼ç­”æ¡ˆé¦–å…ˆæå‡ºä½¿ç”¨ä½è¿ç®—ï¼šå¼‚æˆ–ã€‚é¦–å…ˆæå‡ºäº†å¼‚æˆ–çš„æ€§è´¨ï¼š</p><ol><li>äº¤æ¢å¾‹ï¼ša + b = b + a</li><li>å¯ç§»åŠ¨æ€§ï¼ša + b = c, a + c = b, b + c = a</li><li>è‡ªåæ€§ï¼ša + 0 = a æˆ–è¡¨è¾¾ä¸º a + b + b = a</li></ol><p>ç­”æ¡ˆé¦–å…ˆæå‡ºäº†ç®€å•ä¾‹å­ï¼šåªå«æœ‰ä¸€ä¸ªä¸ä¸€æ ·çš„æ•°å­—æ€ä¹ˆæ‰¾å‡ºæ¥ï¼Œå°±æ˜¯ç›´æ¥æŠŠæ‰€æœ‰æ•°å­—å–å¼‚æˆ–æ“ä½œå³å¯ã€‚é‚£ä¹ˆä¸¤ä¸ªä¸ä¸€æ ·çš„æ•°å­—ï¼Œå°±å¯ä»¥æŠŠä¸¤ä¸ªæ•°å­—åˆ†åˆ°ä¸åŒçš„ç»„ï¼Œè€Œå…¶ä»–ä¸€æ ·çš„æ•°å­—åˆ†åˆ°åŒä¸€ä¸ªç»„å³å¯ã€‚ç¬¦åˆåˆ†ç»„çš„æ–¹æ³•ï¼šæ‰¾åˆ° c (= a + b) ä¸­æŸä¸€ä½ä¸º 1 çš„æ•°ï¼Œè®©å…¶ä»–æ‰€æœ‰æ•°å­—å¯¹åº”ä½ä¸Šçš„æ•°å­—ä¸å…¶å·¦å¼‚æˆ–æ“ä½œï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¾¾åˆ°ä¸Šè¿°çš„åˆ†ç»„æ•ˆæœ</p><h4 id="Offer-56-II-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°-II"><a href="#Offer-56-II-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°-II" class="headerlink" title="Offer 56 - II. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II"></a><a href="https://leetcode-cn.com/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-ii-lcof/">Offer 56 - II. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II</a></h4><p>è¿™ä¸€é¢˜æ²¡æœ‰è¦æ±‚ç©ºé—´å¤æ‚åº¦ O(1) æ‰€ä»¥å…ˆè€ƒè™‘ç®€å•åšæ³•ï¼Œä½¿ç”¨ Counter ä¸€è¡Œéªšæ“ä½œè§£å†³ã€‚è€Œä»ä½è¿ç®—çš„è§’åº¦æ¥æ€è€ƒï¼Œå¦‚æœå…¨æ˜¯é‡å¤çš„æ•°å­—ï¼Œåˆ™æ¯ä¸€ä½0å’Œ1å‡ºç°çš„æ¬¡æ•°å‡ä½3çš„å€æ•°ï¼Œè€Œå¤šäº†ä¸€ä¸ªå•ç‹¬çš„æ•°å­—åˆ™ä¼šæ‰“ç ´3çš„å€æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®å®šè¿™ä¸€ä½æ˜¯å¤šå°‘å³å¯ï¼Œè¿™å°±æ˜¯ä½è¿ç®—çš„ç¥å¥‡é­”åŠ›ï¼Œä¸éœ€è¦ç¡®å®šæ˜¯å“ªä¸€ä¸ªï¼Œè€Œæ˜¯ç®—å‡ºæ¥å“ªä¸€ä¸ªè¯¥æ˜¯ä»€ä¹ˆå€¼ã€‚äº‹å®ä¸Šä»é¢˜ç›®ä¸‹æ–¹çš„æ•°å­—èŒƒå›´æœ‰æ—¶ä¹Ÿèƒ½çŒœæµ‹è¿™é¢˜æ˜¯å¦ä½¿ç”¨ä½è¿ç®—ï¼Œæ¯”å¦‚0~2^31</p><h4 id="Offer-57-å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—"><a href="#Offer-57-å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—" class="headerlink" title="Offer 57. å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—"></a><a href="https://leetcode-cn.com/problems/he-wei-sde-liang-ge-shu-zi-lcof/">Offer 57. å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—</a></h4><p>å…ˆç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ–¹æ³•è¯•äº†ä¸€ä¸‹ï¼Œå¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆæˆ‘ç¬¬ä¸€æƒ³æ³•ä¸æ˜¯ä½¿ç”¨å“ˆå¸ŒæŸ¥æ‰¾å‘¢ï¼Ÿä½†å®é™…ä¸Šå“ˆå¸ŒæŸ¥æ‰¾çš„ç©ºé—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œæˆ‘æ²¡æœ‰ä½¿ç”¨é€’å¢è¿™ä¸ªæ¡ä»¶ã€‚ä½¿ç”¨åŒæŒ‡é’ˆå¯å°†ç©ºé—´å¤æ‚åº¦é™ä¸º O(1)</p><h4 id="Offer-57-II-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"><a href="#Offer-57-II-å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—" class="headerlink" title="Offer 57 - II. å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—"></a><a href="https://leetcode-cn.com/problems/he-wei-sde-lian-xu-zheng-shu-xu-lie-lcof/">Offer 57 - II. å’Œä¸ºsçš„è¿ç»­æ­£æ•°åºåˆ—</a></h4><p>é¦–å…ˆä½¿ç”¨äº†ä¸€ä¸ªæ ˆä½œä¸ºæ»‘çª—ã€‚å¦ä¸€ç§æ–¹å¼ä¸ºï¼Œä½œä¸ºè¿ç»­æ­£æ•°çš„å’Œï¼Œå¯ä»¥ä½¿ç”¨æ±‚å’Œå…¬å¼ç®€åŒ–æœæœ</p><h4 id="Offer-58-I-ç¿»è½¬å•è¯é¡ºåº"><a href="#Offer-58-I-ç¿»è½¬å•è¯é¡ºåº" class="headerlink" title="Offer 58 - I. ç¿»è½¬å•è¯é¡ºåº"></a><a href="https://leetcode-cn.com/problems/fan-zhuan-dan-ci-shun-xu-lcof/">Offer 58 - I. ç¿»è½¬å•è¯é¡ºåº</a></h4><p>ä½¿ç”¨äº† split æ–¹æ³•ç›´æ¥ä¸€è¡Œå¸¦èµ°ï¼Œå½“ç„¶ä¹Ÿè¦ç”¨ä¸ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å®ç°ä¸€æ¬¡</p><h4 id="Offer-59-I-æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"><a href="#Offer-59-I-æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼" class="headerlink" title="Offer 59 - I. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/hua-dong-chuang-kou-de-zui-da-zhi-lcof/">Offer 59 - I. æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼</a></h4><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä½¿ç”¨å †æ¥ç»´æŠ¤æ»‘çª—çš„æœ€å¤§å€¼ï¼Œä½†æ˜¯è¿™ä¸ªå †é¡¶å…ƒç´ å¯èƒ½ä¸å†æ»‘åŠ¨çª—å£ä¸­ä¹‹ä¸­ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œåˆ¤å®šï¼Œè¿™æ ·è¿˜éœ€è¦æ»‘åŠ¨çª—å£çš„èŒƒå›´å’Œè¯¥å †é¡¶å…ƒç´ çš„ Indexã€‚è¿™é‡Œæ’å…¥å †ä¸­çš„æ˜¯ä¸€ä¸ªå…ƒç»„ <code>(number, index)</code>ï¼Œæ³¨æ„ï¼šæ’å…¥å †ä¸­çš„å…ƒç´ å¿…é¡»å¯ä»¥æ¯”è¾ƒï¼Œå…ƒç»„å’Œé˜Ÿåˆ—éƒ½è¡Œï¼Œä½†å­—å…¸ä¸å¯ä»¥ã€‚ä½†è¿™å¹¶ä¸æ˜¯è¿™ä¸€é¢˜çš„æœ€ä¼˜è§£ï¼Œæœ€ä¼˜åº”è¯¥ä½¿ç”¨å•è°ƒï¼ˆåŒç«¯ï¼‰é˜Ÿåˆ—æ¥ç»´æŠ¤æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼ï¼š</p><ol><li>è·å¾—å…ƒç´  i</li><li>è‹¥å°†æ­¤å…ƒç´ å…¥é˜Ÿï¼Œåˆ¤æ–­æ­¤æ—¶é•¿åº¦æ˜¯å¦å¤§äºæ»‘åŠ¨çª—å£ï¼Œå¦‚æœå¤§äºåˆ™å·¦ä¾§å‡ºé˜Ÿ</li><li>åˆ¤æ–­æ˜¯å¦å¤§äºé˜Ÿåˆ—å°¾éƒ¨å…ƒç´ ï¼Œå¦‚æœå¤§äºåˆ™åº•éƒ¨å…ƒç´ å‡ºåˆ—ï¼Œå› ä¸ºè¯¥å…ƒç´ å°†ä¸ä¼šè¢«ä½œä¸ºæœ€å¤§å€¼å–åˆ°ï¼Œå¦‚æ­¤å¾ªç¯ï¼ŒçŸ¥é“ç¢°åˆ°å¤§äºå…ƒç´  i çš„æ•°</li><li>å…ƒç´ å…¥é˜Ÿï¼Œå¹¶è¿”å›é˜Ÿåˆ—å¤´éƒ¨ä½œä¸ºæœ€å¤§å€¼</li></ol><h4 id="Offer-59-II-é˜Ÿåˆ—çš„æœ€å¤§å€¼"><a href="#Offer-59-II-é˜Ÿåˆ—çš„æœ€å¤§å€¼" class="headerlink" title="Offer 59 - II. é˜Ÿåˆ—çš„æœ€å¤§å€¼"></a><a href="https://leetcode-cn.com/problems/dui-lie-de-zui-da-zhi-lcof/">Offer 59 - II. é˜Ÿåˆ—çš„æœ€å¤§å€¼</a></h4><p>è¿™ä¸€é¢˜å°±æ˜¯ä¸Šé¢æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼çš„ç¿»ç‰ˆï¼ŒæŒ‰ç…§ä¹‹å‰çš„ç®—æ³•è¿›è¡Œå³å¯ï¼Œåªæ˜¯å°‘äº†æ»‘åŠ¨çª—å£çš„é•¿åº¦è¿™ä¸€åˆ¤æ–­æ¡ä»¶</p><h4 id="Offer-60-nä¸ªéª°å­çš„ç‚¹æ•°"><a href="#Offer-60-nä¸ªéª°å­çš„ç‚¹æ•°" class="headerlink" title="Offer 60. nä¸ªéª°å­çš„ç‚¹æ•°"></a><a href="https://leetcode-cn.com/problems/nge-tou-zi-de-dian-shu-lcof/">Offer 60. nä¸ªéª°å­çš„ç‚¹æ•°</a></h4><p>å…ˆå†™äº†ä¸€ä¸ªç®€å•çš„æœç´¢ï¼Œå‘ç°æ—¶é—´å¤ªé•¿äº†ï¼Œèµ¶ç´§ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œè¿™é‡Œä¾ç„¶è¦æ‹“å±•ç»´åº¦ï¼Œå› ä¸ºæ·»åŠ éª°å­èƒ½å¤Ÿè®©çŠ¶æ€æ›´å¥½æŠŠæ¡</p><h4 id="Offer-61-æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­"><a href="#Offer-61-æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­" class="headerlink" title="Offer 61. æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­"></a><a href="https://leetcode-cn.com/problems/bu-ke-pai-zhong-de-shun-zi-lcof/">Offer 61. æ‰‘å…‹ç‰Œä¸­çš„é¡ºå­</a></h4><p>å…³é”®è€ƒè™‘é¡ºå­çš„å……è¦æ¡ä»¶ï¼š1. éé›¶å…ƒç´ ä¸é‡å¤ï¼›2. éé›¶å…ƒç´ çš„æœ€å¤§æœ€å°å€¼ç›¸å·®å°äº5</p><h4 id="Offer-62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—"><a href="#Offer-62-åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—" class="headerlink" title="Offer 62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—"></a><a href="https://leetcode-cn.com/problems/yuan-quan-zhong-zui-hou-sheng-xia-de-shu-zi-lcof/">Offer 62. åœ†åœˆä¸­æœ€åå‰©ä¸‹çš„æ•°å­—</a></h4><p>è¿™ä¸€é¢˜ä¸åº”è¯¥æ˜¯ä¸ªç®€å•é¢˜ï¼Œè¿˜æ˜¯æŒºéš¾çš„ï¼ä¸€å¼€å§‹ä½¿ç”¨æš´åŠ›è§£æ³•ï¼Œæ˜¾ç„¶å› ä¸ºåˆ é™¤å¤æ‚åº¦å¤ªé«˜è€Œè¶…æ—¶äº†ã€‚æƒ³äº†åŠ¨æ€è§„åˆ’ï¼Œä½†æ˜¯æ²¡æƒ³æ˜ç™½æ€ä¹ˆæ¨å¯¼çŠ¶æ€æ–¹ç¨‹â€¦ç„¶åå¼€å§‹æ€è€ƒé€’å½’ï¼Œæœ€åè·å¾—äº†é€’å½’çš„ç­”æ¡ˆï¼Œæ—¢ç„¶é€’å½’èƒ½å¤Ÿå®Œæˆï¼Œé‚£ä¹ˆè¿­ä»£ï¼ˆåŠ¨æ€è§„åˆ’ï¼‰å°±ä¸€å®šèƒ½å¤Ÿå®Œæˆï¼Œæœ€ç»ˆåæ¨è¿­ä»£æ–¹ç¨‹è§£å†³</p><p>å¼€å§‹æ€è€ƒé€’å½’å’ŒåŠ¨æ€è§„åˆ’ä¹‹é—´çš„è”ç³»â€¦æˆ‘æ„Ÿè§‰äºŒè€…åº”è¯¥æ˜¯ç­‰ä»·çš„ï¼Œä¸è¿‡é€’å½’å¯èƒ½å‘æ•£å‡ºå»çš„çŠ¶æ€æ˜¯å¾ˆå¤šçš„ï¼ˆä¾‹å¦‚æ·±åº¦æœç´¢ï¼‰ï¼Œä½†æ˜¯åŠ¨æ€è§„åˆ’æœ€ç»ˆçš„çŠ¶æ€æ˜¯æ›´æ¸…æ™°çš„</p><h4 id="Offer-64-æ±‚1-2-â€¦-n"><a href="#Offer-64-æ±‚1-2-â€¦-n" class="headerlink" title="Offer 64. æ±‚1+2+â€¦+n"></a><a href="https://leetcode-cn.com/problems/qiu-12n-lcof/">Offer 64. æ±‚1+2+â€¦+n</a></h4><p>è¿™ä¸€é¢˜ä½¿ç”¨äº†é€»è¾‘è¿ç®—çš„çŸ­è·¯åŠŸèƒ½ï¼Œåˆ©ç”¨é€’å½’æ¥ä»£æ›¿å¾ªç¯</p><h4 id="Offer-65-ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•"><a href="#Offer-65-ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•" class="headerlink" title="Offer 65. ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•"></a><a href="https://leetcode-cn.com/problems/bu-yong-jia-jian-cheng-chu-zuo-jia-fa-lcof/">Offer 65. ä¸ç”¨åŠ å‡ä¹˜é™¤åšåŠ æ³•</a></h4><p>è¿™ä¸€é¢˜è¡¥å……ä¸€ä¸‹æ•´æ•°åœ¨è®¡ç®—æœºä¸­çš„è¡¨è¾¾çš„ç›¸å…³çŸ¥è¯†ï¼Œå‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/376848035">çŸ¥ä¹</a>ï¼š</p><ol><li><p>0b, 0o, 0x åˆ†åˆ«è¡¨ç¤ºäºŒè¿›åˆ¶å’Œåå…­è¿›åˆ¶ï¼Œå¯èƒ½å–çš„æ˜¯ binary, octal, hexadecimal çš„æŸä¸ªå­—æ¯</p></li><li><p>å…³äºåŸç ï¼Œåç ï¼Œè¡¥ç ï¼š</p><ol><li><p>åŸç ï¼šæœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼Œ0è¡¨ç¤ºæ­£æ•°ï¼Œ1è¡¨ç¤ºè´Ÿæ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># = 0x1 è¡¥ç </span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># = -0x1 è´Ÿå· + åŸç  ï¼ˆ Python ç‰¹è‰²ï¼ŒJava ä¼šç›´æ¥è¾“å‡ºè¡¥ç  1111 1101ï¼‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>åç ï¼šæœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼Œæ­£æ•°çš„åç ç­‰äºæœ¬èº«ï¼Œè´Ÿæ•°çš„åç ä¸ºé™¤ç¬¦å·ä½å¤–ï¼Œå¯¹åº”æ­£æ•°å„ä½å–å</p></li><li><p>è¡¥ç ï¼šæœ€é«˜ä½ä¸ºç¬¦å·ä½ï¼Œæ­£æ•°çš„è¡¥ç ç­‰äºæœ¬èº«ï¼Œè´Ÿæ•°çš„è¡¥ç ä¸ºåç  + 1</p><p>æˆ‘ä»¬å¯ä»¥æŠŠè¡¥ç å½“ä½œä¸€ä¸ªä¸€èˆ¬çš„æ“ä½œï¼ˆå–å + 1ï¼Œä¸éœ€è¦ç‰¹æ®Šè€ƒè™‘ç¬¦å·ä½ï¼‰ï¼Œå¯¹æ­£æ•°æˆ‘ä»¬ä¸åšæ“ä½œï¼Œå¯¹è´Ÿæ•°è¿›è¡Œè¡¥ç æ“ä½œã€‚ç›¸å½“äºç”¨è¡¥ç æ¥è¡¨ç¤ºæ­£æ•°çš„ç›¸åæ•°ï¼Œåœ¨è¿›è¡Œè®¡ç®—æ—¶ï¼Œæˆ‘ä»¬ç”¨è¡¥ç ä»£æ›¿è´Ÿæ•°ï¼Œä¹Ÿå³å°†å‡æ³•è½¬ä¸ºä¸ºåŠ æ³•ã€‚å¾—çŸ¥è´Ÿæ•°çš„è¡¥ç ï¼Œåœ¨å¯¹å…¶å–è¡¥ç ï¼Œå°±å¯å¾—åˆ°æ­£æ•°ï¼Œä¹Ÿå³è¡¥ç çš„è¡¥ç å°±æ˜¯åŸç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å‡è®¾ a ä¸ºè´Ÿæ•°ï¼Œa çš„è¡¥ç ä¸º b + 1ï¼Œå…¶ä¸­ b ä¸º a çš„åç </span><span class="token comment"># æ ¹æ®åç çš„å®šä¹‰æœ‰</span>a <span class="token operator">+</span> b <span class="token operator">=</span> <span class="token number">0xffffffff</span><span class="token comment"># f ä»£è¡¨4ä¸ª1</span>a <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0x00000000</span><span class="token comment"># ç”±ä»¥ä¸Šç­‰å¼å¾—å‡º</span>x <span class="token operator">-</span> a <span class="token operator">=</span> x <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token comment"># è¿™æ ·å°±å°†å‡æ³•å’ŒåŠ æ³•ç»Ÿä¸€èµ·æ¥äº†</span><span class="token comment"># ç”¨4ä¸ª bit æ¥åšä¸€ä¸ªç¤ºèŒƒ</span><span class="token builtin">bin</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0b0101</span><span class="token comment"># 3 çš„åç å’Œè¡¥ç ç­‰äºå…¶æœ¬èº«</span><span class="token builtin">bin</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0b1101</span><span class="token comment"># å°†æœ€é«˜ä½å˜ä¸º 1ï¼ˆè¿™é‡Œä»…ç”¨äºç¤ºèŒƒï¼Œä¸ python å®é™…çš„é€»è¾‘ä¸ç¬¦ï¼ï¼ï¼ï¼</span><span class="token comment"># -3 çš„åç </span><span class="token number">0b1010</span><span class="token comment"># -3 çš„è¡¥ç </span><span class="token number">0b1011</span><span class="token comment"># ä» -3 çš„è¡¥ç æ¨æµ‹å…¶æºç ï¼Œå…ˆç¡®å®šç¬¦å·ä½ï¼Œç„¶åå–åç  + 1</span><span class="token number">0b0100</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0b0101</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li><li><p>ç”±äº python çš„ç‰¹æ®Šè¡¨ç¤ºï¼Œå³å…¶æ²¡æœ‰æœ€é«˜ä½çš„æ¦‚å¿µï¼Œè¾“å…¥ä¸€ä¸ªè¡¥ç çš„äºŒè¿›åˆ¶ä¼šè¾“å‡ºä¸€ä¸ªæ­£æ•°ï¼Œæ‰€ä»¥éœ€è¦ç‰¹æ®Šå¤„ç†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åŒæ ·ä»¥ -3 ä¸¾ä¾‹</span><span class="token builtin">bin</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0b1101</span><span class="token comment"># -3 çš„ç†è®ºè¡¥ç è¡¨ç¤º</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0b1101</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">13</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">3</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># -3 åœ¨ python ä¸­å®é™…çš„è¡¨ç¤º</span><span class="token comment"># ç°åœ¨è¦æƒ³æŠŠ 13 è½¬æ¢ä¸º -3ï¼Œæ€è·¯æ˜¯å…ˆè½¬å›åŸç ï¼Œå†ä½¿ç”¨ ~ å–åå¾—åˆ°è¡¥ç </span><span class="token comment"># ä¸ºäº†è½¬å›åŸç ä¸èƒ½ä½¿ç”¨ ~ï¼Œå› ä¸º python æ²¡æœ‰æœ€é«˜ä½çš„æ¦‚å¿µï¼Œ~13 = -14</span><span class="token comment"># åªèƒ½ä½¿ç”¨å¼‚æˆ–æ“ä½œè¿›è¡Œå–å</span><span class="token number">0b1101</span> <span class="token operator">^</span> <span class="token number">0b1111</span><span class="token operator">=</span> <span class="token number">0b0010</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token comment"># ~x åœ¨ python ä¸­ç­‰ä»·äº -x - 1</span><span class="token operator">~</span><span class="token number">0b0010</span> <span class="token operator">=</span> <span class="token operator">-</span>x <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="Offer-66-æ„å»ºä¹˜ç§¯æ•°ç»„"><a href="#Offer-66-æ„å»ºä¹˜ç§¯æ•°ç»„" class="headerlink" title="Offer 66. æ„å»ºä¹˜ç§¯æ•°ç»„"></a><a href="https://leetcode-cn.com/problems/gou-jian-cheng-ji-shu-zu-lcof/">Offer 66. æ„å»ºä¹˜ç§¯æ•°ç»„</a></h4><p>æ²¡åŠæ³•ä½¿ç”¨é™¤æ³•ï¼Œé‚£å°±åªèƒ½é«˜æ•ˆä½¿ç”¨ä¹˜æ³•ï¼Œé€šè¿‡æ„å»ºä¸Šä¸‹ä¸‰è§’æ¥é‡å¤åˆ©ç”¨å·²æ±‚å¾—çš„ç»“æœ</p><h4 id="Offer-67-æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°"><a href="#Offer-67-æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°" class="headerlink" title="Offer 67. æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°"></a><a href="https://leetcode-cn.com/problems/ba-zi-fu-chuan-zhuan-huan-cheng-zheng-shu-lcof/">Offer 67. æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°</a></h4><p>æ²¡ä»€ä¹ˆç‰¹åˆ«çš„æ–¹æ³•ï¼Œå°±æ˜¯è·Ÿç€é€»è¾‘ç¡¬åˆ¤æ–­ï¼Œä½†æ˜¯å…¶å®æ–‡å­—æè¿°å¹¶ä¸å¤Ÿæ¸…æ™°â€¦è¿™ä¸€é¢˜å°±è¿™æ ·å§ï¼Œç›´æ¥æŠ„çš„ç­”æ¡ˆ</p><h4 id="Offer-68-I-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ-MARK2"><a href="#Offer-68-I-äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ-MARK2" class="headerlink" title="Offer 68 - I. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ MARK2"></a><a href="https://leetcode-cn.com/problems/er-cha-sou-suo-shu-de-zui-jin-gong-gong-zu-xian-lcof/">Offer 68 - I. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a> MARK2</h4><p>æˆ‘å…ˆæ˜¯æ²¡æœ‰åˆ©ç”¨äºŒå‰æœç´¢æ ‘çš„æ€§è´¨å®Œæˆäº†è¿™ä¸€é¢˜ã€‚å°±æ˜¯ç›´æ¥æŠŠè·¯å¾„æ‰¾å‡ºæ¥ï¼Œç„¶åçœ‹ç›¸åŒç¥–å…ˆã€‚<strong>å½“ç„¶ç®€å•çš„å†™æ³•æ˜¯é€’å½’ï¼Œå½“å·¦ä¾§æ²¡æœ‰æ—¶ï¼Œå°±åœ¨å³ä¾§ï¼›å½“å³ä¾§æ²¡æœ‰æ—¶ï¼Œå°±åœ¨å·¦ä¾§ï¼›å½“ä¸¤ä¾§å„æœ‰ä¸€ä¸ªæ—¶ï¼Œå°±è¿”å›æ ¹èŠ‚ç‚¹</strong></p><p>åˆ©ç”¨äºŒå‰æœç´¢æ ‘çš„æ€§è´¨èƒ½å¤ŸåŠ é€Ÿæœç´¢ï¼Œå¦‚æœä¸æ˜¯äºŒå‰æœç´¢æ ‘åˆ™å…ˆå°†è·¯å¾„æœç´¢å‡ºæ¥ï¼Œç„¶åæŸ¥è¯¢å…¬å…±èŠ‚ç‚¹ã€‚ä½¿ç”¨ append &amp; pop èƒ½å¤Ÿæå¤§åŠ é€Ÿæœç´¢é€Ÿåº¦å¹¶å‡å°‘å†…å­˜ï¼Œè€Œä¸ä½¿ç”¨ + æ–¹æ³•çœå»å‰ªæçš„æµç¨‹</p><h4 id="é¢è¯•é¢˜32-I-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘"><a href="#é¢è¯•é¢˜32-I-ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘" class="headerlink" title="é¢è¯•é¢˜32 - I. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘"></a><a href="https://leetcode-cn.com/problems/cong-shang-dao-xia-da-yin-er-cha-shu-lcof/">é¢è¯•é¢˜32 - I. ä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘</a></h4><p>å±‚åºéå†</p><h4 id="é¢è¯•é¢˜19-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"><a href="#é¢è¯•é¢˜19-æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…" class="headerlink" title="é¢è¯•é¢˜19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…"></a><a href="https://leetcode-cn.com/problems/zheng-ze-biao-da-shi-pi-pei-lcof/">é¢è¯•é¢˜19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</a></h4><p>æ¯”è¾ƒå¤æ‚çš„ä¸€é“åŠ¨æ€è§„åˆ’ï¼Œè°ƒè¯•äº†å¾ˆä¹…å¾ˆä¹…ï¼Œæˆ‘å…¶å®ä¹Ÿä¸èƒ½ç¡®å®šè¿™æ ·çš„çŠ¶æ€è½¬ç§»èƒ½å¤Ÿæ¨ç†å‡ºå…¨éƒ¨çš„è§£ï¼Œæˆ‘å°½å¯èƒ½çš„å†™å‡ºäº†ä¸º true çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œæ˜¾ç„¶æˆ‘å†™å‡ºçš„æ–¹ç¨‹å·²ç»è¦†ç›–äº†æ‰€æœ‰ä¸º true çš„æƒ…å†µï¼Œä¸æ»¡è¶³çš„è‡ªç„¶ä¸º false</p><h2 id="è¡¥å……ï¼šå¸¸è§è¾“å…¥è¾“å‡º"><a href="#è¡¥å……ï¼šå¸¸è§è¾“å…¥è¾“å‡º" class="headerlink" title="è¡¥å……ï¼šå¸¸è§è¾“å…¥è¾“å‡º"></a>è¡¥å……ï¼šå¸¸è§è¾“å…¥è¾“å‡º</h2><p>å› ä¸ºåœ¨è¿›è¡Œç¬”è¯•çš„æ—¶å€™ï¼Œä¸åƒ leetcode æä¾›äº†è¾“å…¥è¾“å‡ºï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨æ ‡å‡†è¾“å…¥è¾“å‡º input &amp; printã€‚è¿™é‡Œæ€»ç»“ä¸€ä¸‹ python çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæ¨¡æ¿ã€‚è¦ç‚¹å°±æ˜¯ï¼š</p><ol><li>æ‰€æœ‰çš„è¾“å…¥å¯ä»¥çœ‹ä½œä¸ºä¸€ä¸ªæ–‡ä»¶</li><li>æ¯ä¸€è¡Œçš„è¾“å…¥éƒ½è¦ç”¨ input æ¥å—ï¼Œé€šå¸¸ä½¿ç”¨ try &amp; except å¤„ç†å¾ªç¯ç»“æŸ end of file</li></ol><h3 id="ä¸€è¡Œè¾“å…¥"><a href="#ä¸€è¡Œè¾“å…¥" class="headerlink" title="ä¸€è¡Œè¾“å…¥"></a>ä¸€è¡Œè¾“å…¥</h3><p>æ¯ä¸ªæ ·ä¾‹åªæœ‰ä¸€è¡Œè¾“å…¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>a <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        function<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¤šè¡Œè¾“å…¥"><a href="#å¤šè¡Œè¾“å…¥" class="headerlink" title="å¤šè¡Œè¾“å…¥"></a>å¤šè¡Œè¾“å…¥</h3><p>æ¯ä¸ªæ ·ä¾‹æœ‰å¤šä¸ªè¾“å…¥ï¼Œè¿™ä¸ªæ—¶å€™é€šå¸¸ä¼šå‘Šè¯‰ä½ æœ‰å¤šå°‘è¡Œï¼Œä½¿ç”¨å¾ªç¯æ¥æ”¶å³å¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        n<span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>            a <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode-diary 4 String</title>
      <link href="/archives/984b9f00.html"/>
      <url>/archives/984b9f00.html</url>
      
        <content type="html"><![CDATA[<h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><p>å¯¹ string ç±»çš„é¢˜ç›®è¿›è¡Œæ·±åº¦å­¦ä¹ ï¼Œé‡ç‚¹æ€»ç»“æ–¹æ³•ï¼Œè¿‡å¤šçš„ä»£ç å°±ä¸æ”¾å‡ºæ¥äº†</p><h3 id="556-Next-Greater-Element"><a href="#556-Next-Greater-Element" class="headerlink" title="556 Next Greater Element |||"></a>556 Next Greater Element |||</h3><p><a href="https://leetcode-cn.com/problems/next-greater-element-iii/">leetcode link</a></p><p>è¿™ä¸€é¢˜çš„ä»£ç å†™çš„ä¹Ÿæ˜¯ç›¸å½“ä¸‘ï¼Œé¢˜ç›®ä¸­å…¶å®æœ‰ä¸¤ä¸ªè¦æ±‚ï¼Œç›¸å½“äºæ˜¯æ±‚æœ€å¤§ä¸­çš„æœ€å°ï¼Œæˆ‘åœ¨è§£é¢˜çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘å…¨ï¼Œæ‰€ä»¥ä¿®æ”¹äº†è¾ƒé•¿çš„æ—¶é—´ã€‚è¿™ç§æœ€å¤§ä¸­çš„æœ€å°åŸºæœ¬ä¸Šéƒ½æœ‰ä¸€ä¸ªå•è°ƒæ ˆçš„æ„Ÿè§‰åœ¨é‡Œé¢ï¼šæ•°åˆ—å¿…é¡»æ˜¯å•å¢çš„ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªå‡å°‘çš„æ•°å­—åˆ™æ˜¯å…³é”®ç‚¹ï¼</p><p>å­¦ä¹ ç‚¹ï¼šç®€æ˜“çš„å°†å­—ç¬¦ä¸²åˆ—è¡¨è½¬ä¸ºæ•°å­—çš„æ–¹æ³•</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>list_of_str<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="395-Longest-Substring-with-At-Least-K-Repeating-Characters"><a href="#395-Longest-Substring-with-At-Least-K-Repeating-Characters" class="headerlink" title="395 Longest Substring with At Least K Repeating Characters"></a>395 Longest Substring with At Least K Repeating Characters</h3><p><a href="https://leetcode-cn.com/problems/longest-substring-with-at-least-k-repeating-characters/">leetcode link</a></p><p>åˆæ˜¯ä¸€ä¸ªä¸å­åºåˆ—ç›¸å…³çš„é—®é¢˜ï¼Œä¸€èˆ¬æœ‰å‡ ç§æ€è·¯ï¼šé€’å½’ï¼ŒåŠ¨æ€è§„åˆ’ï¼Œé€šè¿‡æ¡ä»¶ä¸æ–­åœ°æ‰©å……è§£æˆ–è€…å‰”é™¤ä¸æ»¡è¶³çš„æˆå‘˜ï¼ˆè¿™å‡ ç§æ€è·¯ä¹Ÿå¯èƒ½ç›¸äº’é‡å ï¼‰ã€‚ä¸€å¼€å§‹é€‰æ‹©äº†ä¸æ–­æ‰©å……çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¼šé—æ¼éƒ¨åˆ†çš„è§£ã€‚åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šå¾ˆå¿«å°±å»¶ç”³å‡ºäº†é€’å½’çš„æ€è·¯è¿…é€Ÿæ±‚è§£äº†ï¼šé€’å½’åœ°å‰”é™¤ä¸æ»¡è¶³çš„æ•°å­—</p><h3 id="419-Battleships-in-a-Board"><a href="#419-Battleships-in-a-Board" class="headerlink" title="419 Battleships in a Board"></a>419 Battleships in a Board</h3><p><a href="https://leetcode-cn.com/problems/battleships-in-a-board/">leetcode link</a></p><p>è¿™ä¸€é¢˜æˆ‘ä½¿ç”¨äº†è¿é€šçš„æƒ³æ³•ï¼Œæ—¢ç„¶ä¸ç›¸é‚»ï¼Œé‚£ä¹ˆè¿é€šçš„ X å°±æ˜¯ä¸€ä¸ªæˆ˜èˆ°ã€‚å¦ä¸€ä¸ªè¿›é˜¶çš„æƒ³æ³•æ˜¯ç»Ÿè®¡å·¦ä¸Šè§’ X çš„ä¸ªæ•°</p><h3 id="151-Reverse-Words-in-a-String"><a href="#151-Reverse-Words-in-a-String" class="headerlink" title="151 Reverse Words in a String"></a>151 Reverse Words in a String</h3><p><a href="https://leetcode-cn.com/problems/reverse-words-in-a-string/">leetcode link</a></p><p>ä¸¤è¡Œä»£ç å†™å®Œï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">reverseWords</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯ <code>split()</code> è€Œä¸æ˜¯ <code>split(' ')</code>ï¼ŒäºŒè€…æœ‰ç€ç»†å¾®çš„å·®åˆ«ï¼Œå¦‚æœæœ‰å¤šä¸ªç©ºæ ¼å­˜åœ¨çš„è¯ï¼Œåè€…åˆ†éš”åä¼šå¤šå‡ºä¸€äº›ç©ºå­—ç¬¦ä¸²æˆå‘˜ <code>''</code>ï¼Œè€Œå‰è€…ä¸ä¼š</p><h3 id="5-Longest-Palindromic-Substring"><a href="#5-Longest-Palindromic-Substring" class="headerlink" title="5 Longest Palindromic Substring"></a>5 Longest Palindromic Substring</h3><p><a href="https://leetcode-cn.com/problems/longest-palindromic-substring/">leetcode link</a></p><p>è¿™ä¸€é¢˜ç»™äº†æˆ‘ä¸€ä¸ªæ•™è®­ï¼Œå¦‚æœé•¿æ—¶é—´æƒ³ä¸åˆ°å¥½çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¹³æ–¹æ—¶é—´å¤æ‚åº¦çš„æƒ³æ³•ä¹Ÿåº”è¯¥å°½å¿«å®ç°ï¼è¿™ä¸€é¢˜é‡‡ç”¨ä¸­å¿ƒæ‰©å±•æ³•</p><h3 id="516-Longest-Palindromic-Subsequence"><a href="#516-Longest-Palindromic-Subsequence" class="headerlink" title="516 Longest Palindromic Subsequence"></a>516 Longest Palindromic Subsequence</h3><p><a href="https://leetcode-cn.com/problems/longest-palindromic-subsequence/">leetcode link</a></p><p>åŠ¨æ€è§„åˆ’åˆç»™æˆ‘ä¸Šäº†ä¸€è¯¾ï¼š</p><ol><li>ä»€ä¹ˆæ˜¯çŠ¶æ€ï¼šåœ¨ç¡®å®šæ¡ä»¶ä¸‹çš„é—®é¢˜çš„è§£ï¼ˆå³å­é—®é¢˜çš„è§£ï¼‰ï¼Œå¹¶ä¸”çŠ¶æ€éœ€è¦æ˜¯å”¯ä¸€çš„ï¼ˆæˆ–è€…è¯´æœ€ä¼˜çš„ï¼‰</li><li>çŠ¶æ€è½¬ç§»ï¼šä¸åŒæ¡ä»¶ä¸‹çš„å­é—®é¢˜ä¹‹é—´çš„å…³è”ï¼Œè¿™å°±æ˜¯è¿™ä¸€é¢˜çš„éš¾ç‚¹ã€‚çŠ¶æ€è½¬ç§»çš„æ–¹å‘æˆ‘ä¹ æƒ¯æ€§åœ°è®¤ä¸ºæ˜¯ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬ç§»ï¼Œå®é™…ä¸Šï¼Œä¸€ä¸ªå¤æ‚çŠ¶æ€æ˜¯ç”±å¤šä¸ªå¯èƒ½çš„å­çŠ¶æ€è½¬ç§»è€Œæ¥</li><li>çŠ¶æ€è½¬ç§»çš„ç€åŠ›ç‚¹åœ¨äºï¼šä»ç®€å•åˆ°å¤æ‚çš„æ¨æ¼”è¿‡ç¨‹ï¼Œæˆ–è€…ä»å¤æ‚åˆ°ç®€å•çš„é€€åŒ–è¿‡ç¨‹</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">longestPalindromeSubseq</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>        dp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> n <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token comment"># ä¸èƒ½ç”¨ [[0] * n] * n å› ä¸ºè¿™æ ·åˆ—è¡¨ä¸­çš„æˆå‘˜æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ª</span>        <span class="token comment"># æ³¨æ„éå†é¡ºåºï¼Œéœ€è¦ä»çŸ­åˆ°é•¿çš„éå†ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå€’åº</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>            dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>                    dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> dp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">2</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="647-Palindromic-Substrings"><a href="#647-Palindromic-Substrings" class="headerlink" title="647 Palindromic Substrings"></a>647 Palindromic Substrings</h3><p><a href="https://leetcode-cn.com/problems/palindromic-substrings/">leetcode link</a></p><p>è¿™ä¸€é¢˜å°±æ˜¯æ±‚å‡ºå­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„å›æ–‡å­—ç¬¦ä¸²ï¼Œè¿™ä¸€é¢˜ç›¸å½“äºç¬¬5é¢˜ã€‚æˆ‘é¡ºä¾¿ä½¿ç”¨åŠ¨æ€è§„åˆ’æŠŠè¿™ä¸€é¢˜ç»™å®Œæˆäº†ï¼Œå³åˆ¤æ–­æŸä¸ªå­—ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ç¬¦ä¸²</p><h3 id="336-Palindrome-Pairs"><a href="#336-Palindrome-Pairs" class="headerlink" title="336 Palindrome Pairs"></a>336 Palindrome Pairs</h3><p><a href="https://leetcode-cn.com/problems/palindrome-pairs/">leetcode link</a></p><p>æ˜¾ç„¶ä¸å¯èƒ½ä½¿ç”¨å¹³æ–¹æ—¶é—´å»åšï¼Œè¿™æ ·çš„è¯å¤§æ¦‚ç‡éœ€è¦åš N æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹æ¯ä¸€ä¸ªæˆå‘˜è¿›è¡Œåˆ†æï¼Œæ ¹æ®åˆ†æç»“æœå°†å…¶åˆ†é…åˆ°å…¶å±äºçš„åœ°æ–¹ï¼Œè€Œè¿™ä¸ªåˆ†é…è¿‡ç¨‹æ˜¯ä¸€ä¸ª O(1) çš„æ—¶é—´ï¼Œè¿™æ˜¾ç„¶å°±éœ€è¦ç”¨åˆ°å­—å…¸ï¼Œå› ä¸ºåªæœ‰å­—å…¸çš„æŸ¥è¯¢æ—¶é—´æ‰æ˜¯æœ€å¿«çš„</p><p>è¿™ä¸€é¢˜çš„è™½ç„¶å¤§ä½“æ€è·¯å¾ˆå¿«å°±æ‹¿å‡ºæ¥äº†ï¼Œä½†æ˜¯å…¶ä¸­çš„ç»†èŠ‚å¤ªå¤šäº†ï¼Œæ¯”å¦‚ï¼šå¦‚ä½•æ‰¾åˆ°éœ€è¦çš„å­—ä¸²ï¼Œä½¿ç”¨å‰ç¼€åç¼€çš„æ€æƒ³æœ€å¿«ï¼›é‡åˆ°ç›¸åŒé•¿åº¦çš„ä¼šé‡å¤è®¡ç®—â€¦</p><h3 id="115-Distinct-Subsequences"><a href="#115-Distinct-Subsequences" class="headerlink" title="115 Distinct Subsequences"></a>115 Distinct Subsequences</h3><p><a href="https://leetcode-cn.com/problems/distinct-subsequences/">leetcode link</a></p><p>ä½¿ç”¨äº†ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯é€’å½’çš„æ€è·¯ï¼Œå¾ˆå¿«å°±å®ç°å‡ºæ¥äº†ï¼Œä½†æ˜¯å¤æ‚åº¦æ²¡æœ‰ç»è¿‡ä»”ç»†è€ƒè™‘ï¼Œç­”æ¡ˆè¶…æ—¶ã€‚é©¬ä¸Šå¼€å§‹åŠ¨æ€è§„åˆ’çš„æ€è·¯ï¼Œå¾ˆå¿«å°±è”æƒ³åˆ°äº†å¢åŠ çŠ¶æ€çš„æ€è·¯ï¼Œä¹Ÿå¾ˆå¿«å®ç°å‡ºæ¥äº†ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰ä¸€äº›è¾¹ç•Œæ¡ä»¶éœ€è¦è¿›è¡Œè€ƒè™‘ï¼Œæ²¡æœ‰è€ƒè™‘æ¸…æ¥šã€‚è¿™é‡Œä¾ç„¶ä½¿ç”¨äº†ä¸ä¹‹å‰ç›¸åŒçš„ç­–ç•¥ï¼šä½¿å¾—è¡¨æ ¼ä¸­çš„æœ€å·¦ä¾§åˆå§‹åŒ–ä¸º1</p><h3 id="334-Increasing-Triplet-Subsequence"><a href="#334-Increasing-Triplet-Subsequence" class="headerlink" title="334 Increasing Triplet Subsequence"></a>334 Increasing Triplet Subsequence</h3><p><a href="https://leetcode-cn.com/problems/increasing-triplet-subsequence/">leetcode link</a></p><p>è¿™ä¸€é¢˜å¹¶ä¸æ˜¯ç‰¹åˆ«å¸¸è§„ï¼Œä¸€å¼€å§‹æƒ³ç”¨å•è°ƒæ ˆï¼Œä½†åé¢å‘ç°å•è°ƒæ ˆå¹¶ä¸å¥½ç»´æŠ¤ã€‚ä¹‹åç›´æ¥é€šè¿‡ä¸‰å…ƒç»„çš„ç‰¹æ€§è§£å†³äº†</p><h3 id="32-Longest-Valid-Parenthese"><a href="#32-Longest-Valid-Parenthese" class="headerlink" title="32 Longest Valid Parenthese"></a>32 Longest Valid Parenthese</h3><p><a href="https://leetcode-cn.com/problems/longest-valid-parentheses/">leetcode link</a></p><p>è¿™ä¸€é¢˜é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ç”¨åŠ¨æ€è§„åˆ’æ¥åšï¼Œä½†æ˜¯è½¬ç§»æ–¹ç¨‹çš„è®¨è®ºæ¯”è¾ƒåˆ«æ‰­ï¼Œæœ€ç»ˆä½¿ç”¨æ ˆçš„æ–¹æ³•æ¥åŒ¹é…æ‹¬å·ï¼Œç•™ä¸‹æœªåŒ¹é…çš„æ‹¬å·ï¼Œæœ€åæ±‚å¾—æœ€é•¿é—´éš”å³å¯</p><h3 id="301-Remove-Invalid-Parentheses"><a href="#301-Remove-Invalid-Parentheses" class="headerlink" title="301 Remove Invalid Parentheses"></a>301 Remove Invalid Parentheses</h3><p><a href="https://leetcode-cn.com/problems/remove-invalid-parentheses/">leetcode link</a></p><p>è¿™ä¸€é¢˜ç«Ÿç„¶æ˜¯ç›´æ¥ç”¨çš„æœç´¢ç®—æ³•ï¼å¤§å¤±è¯¯å¤§å¤±è¯¯ï¼Œå› ä¸ºé¢˜ç›®ç»™çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯æ¯”è¾ƒå°çš„ï¼Œå‡ ä¹åªèƒ½ç©·ä¸¾ï¼Œæœ€ç»ˆä½¿ç”¨æ·±åº¦æœç´¢å®Œæˆ</p><p>æ·±åº¦æœç´¢åˆæœ‰äº†æ–°çš„è§£é¢˜æ¡†æ¶ï¼šåœ¨è®¡ç®—å„ç§è·¯å¾„çš„æ—¶å€™ï¼Œä¸€ä¸ªç›´è§‚è€ƒè™‘æ˜¯æŸä¸ªæ•°å­—æ˜¯å¦è¢«é€‰è¿›è·¯å¾„å½“ä¸­ï¼Œè¿™æ ·å°±çœä¸‹ä¸€äº›å¾ªç¯ï¼Œåªéœ€è¦è®°å½•æœç´¢ä½ç½®å’Œè·¯å¾„å³å¯</p><h3 id="443-String-Compression"><a href="#443-String-Compression" class="headerlink" title="443 String Compression"></a>443 String Compression</h3><p><a href="https://leetcode-cn.com/problems/string-compression/">leetcode link</a></p><p>è¿™ä¸€é¢˜å¥½åƒæœåŠ¡å™¨çš„åˆ¤å®šæ–¹æ³•æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œéœ€è¦ç‚¹å‡»å³ä¸‹è§’çš„æ‰§è¡Œä»£ç èƒ½å¤Ÿçœ‹åˆ°ç»“æœã€‚å¥½åƒä¹Ÿéœ€è¦åŸåœ°ä¿®æ”¹æ•°ç»„</p><h3 id="820-Short-Encoding-of-Words"><a href="#820-Short-Encoding-of-Words" class="headerlink" title="820 Short Encoding of Words"></a>820 Short Encoding of Words</h3><p><a href="https://leetcode-cn.com/problems/short-encoding-of-words/">leetcode link</a></p><p>è¿™ä¸€é¢˜çš„é¢˜ç›®æè¿°çœŸçš„å¾ˆç³Ÿç³•ï¼Œç†è§£äº†å¥½å‡ æ¬¡æ‰å‘ç°ä¸é¡ºåºæ— å…³ï¼Œå¦‚æœå‘ç°ç†è§£é”™è¯¯è¿‡ååº”å½“ä»å¤´æ¥è¿‡ï¼Œçœ‹æœ‰æ²¡æœ‰æ›´ç®€å•çš„è§£æ³•</p><p>æœ€åé€šè¿‡æ€»ç»“å…¶èåˆçš„è§„å¾‹ï¼Œçœ‹ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦èƒ½å¦è¢«èåˆ</p><h3 id="49-Group-Anagrams"><a href="#49-Group-Anagrams" class="headerlink" title="49 Group Anagrams"></a>49 Group Anagrams</h3><p><a href="https://leetcode-cn.com/problems/group-anagrams/">leetcode link</a></p><p>è¿™ä¸€é¢˜å·®ä¸€ç‚¹åˆè¢«è¿™ä¸ªå¼‚ä½è¯çš„æ¦‚å¿µç»™è¯¯å¯¼äº†ã€‚å­¦ä¹ ç‚¹ï¼š</p><ol><li>å­—ç¬¦ä¸²æ˜¯å¯ä»¥è¢« <code>sorted</code> çš„ï¼Œè¿”å›ä¸€ä¸ªæ’å¥½åºçš„åˆ—è¡¨</li><li>å­—å…¸å’Œåˆ—è¡¨ç­‰å¯å˜ç±»å‹æ˜¯ä¸å¯ä»¥ä½œä¸ºå…³é”®å­—çš„</li><li><code>collection.defualtdict</code> å¯ä»¥è§£å†³ç”±äºä¸å­˜åœ¨å…³é”®å­—äº§ç”Ÿçš„æŠ¥é”™ï¼Œå½“å…³é”®å­—ä¸å­˜åœ¨æ—¶ç›´æ¥åˆ›å»ºå®šä¹‰å¥½çš„æ•°æ®ç±»å‹</li></ol><h3 id="3-Longest-Substring-Without-Repeating-Characters"><a href="#3-Longest-Substring-Without-Repeating-Characters" class="headerlink" title="3 Longest Substring Without Repeating Characters"></a>3 Longest Substring Without Repeating Characters</h3><p><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">leetcode link</a></p><p>åŒæŒ‡é’ˆæ»‘åŠ¨çª—å£ï¼Œæ²¡å•¥å¥½è¯´çš„</p><h3 id="76-Minimum-Window-Substring"><a href="#76-Minimum-Window-Substring" class="headerlink" title="76 Minimum Window Substring"></a>76 Minimum Window Substring</h3><p><a href="76 Minimum Window Substring">leetcode link</a></p><p>è¿™ä¹Ÿæ˜¯å…¸å‹çš„æ€è·¯ç®€å•ï¼Œä½†æ˜¯å†™èµ·æ¥æœ‰æ¯”è¾ƒå¤šçš„ç»†èŠ‚çš„å›°éš¾é¢˜ã€‚å¾ˆå®¹æ˜“å°±æƒ³åˆ°äº†åŒæŒ‡é’ˆæ»‘åŠ¨çª—å£çš„å†™æ³•ï¼Œä½†æ˜¯ä¾ç„¶çŠ¯äº†å¾ˆå¤šé”™</p><h3 id="1004-Max-Consecutive-Ones"><a href="#1004-Max-Consecutive-Ones" class="headerlink" title="1004 Max Consecutive Ones |||"></a>1004 Max Consecutive Ones |||</h3><p><a href="https://leetcode-cn.com/problems/max-consecutive-ones-iii/">leetcode link</a></p><p>ä¾ç„¶æ˜¯åŒæŒ‡é’ˆæ»‘åŠ¨çª—å£ï¼Œæ»‘åŠ¨æ»‘åŠ¨ï¼ä¼¼ä¹åŒæŒ‡é’ˆçš„ç‰¹ç‚¹ï¼šå·¦å³ä¸¤ç«¯èƒ½å¤Ÿä»¥æ¸…æ™°çš„æ¡ä»¶è¿›è¡Œç§»åŠ¨ï¼Œåœ¨è¿‡ç¨‹ä¸­èƒ½å¤Ÿéå†å‡ºæ‰€æœ‰å€¼ï¼Œå¹¶æ±‚å¾—æœ€ä¼˜</p><p>ä¸€è·¯æ•´ä¸‹æ¥è¿˜æ˜¯æŒºä¼¤çš„â€¦ä¹‹åä¸å¤ªèƒ½æŠŠæ¯ä¸ªæ¿å—éƒ½åˆ·äº†â€¦è¿˜æ˜¯é‡ç‚¹çªå‡»ä¸€ä¸‹å‰‘æŒ‡offerå§ï¼ä¹‹åçš„ç§‹æ‹›æœ‰æ—¶é—´å†ç»§ç»­å¼„å¼„</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode-diary 2</title>
      <link href="/archives/65138f4a.html"/>
      <url>/archives/65138f4a.html</url>
      
        <content type="html"><![CDATA[<h1 id="leetcode-diary-2"><a href="#leetcode-diary-2" class="headerlink" title="leetcode-diary 2"></a>leetcode-diary 2</h1><p>diary 1 &amp; diary 2 çš„ç›®çš„æ˜¯äº†è§£å¤šç§é¢˜å‹ï¼Œæ²¡æœ‰æ·±å…¥</p><h2 id="DFS-amp-BFS"><a href="#DFS-amp-BFS" class="headerlink" title="DFS &amp; BFS"></a>DFS &amp; BFS</h2><p>åœ¨è¿›è¡Œåˆ·é¢˜ä¹‹å‰ï¼Œæœ‰å¿…è¦å°å°æ€»ç»“ä¸€ä¸‹æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDepth First Search, DFSï¼‰å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBroad First Search, BFSï¼‰</p><p>ä¸¤ä¸ªæœç´¢é™¤äº†æ·±åº¦å’Œå¹¿åº¦ä¸¤ä¸ªé‡è¦æ¦‚å¿µå¤–ï¼Œè¿˜éœ€è¦æ›´å¤šçš„å…³é”®æ¦‚å¿µï¼š</p><ol><li>å€™é€‰å…ƒç´  candidatesï¼Œå­˜å‚¨ä¸èŠ‚ç‚¹è”ç³»çš„å…¶ä»–èŠ‚ç‚¹ã€‚è¿™äº›èŠ‚ç‚¹å°†ä½œä¸º candidates åœ¨æœªæ¥è¿›è¡Œéå†</li><li>è®¿é—®çŠ¶æ€ visitedï¼Œå­˜å‚¨èŠ‚ç‚¹æ˜¯å¦è¢«ç»è¿‡çš„çŠ¶æ€</li><li>ç›®æ ‡ target</li></ol><p><strong>æ·±åº¦ä¼˜å…ˆ</strong>æˆ‘è‡ªå·±æ€»ç»“ä¸ºï¼šé€å±‚å¾ªç¯ä¸­åµŒå¥—é€’å½’ï¼ˆé€’å½’+å›æº¯ï¼Ÿ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># grpah[v] å­˜å‚¨èŠ‚ç‚¹ v çš„ç›¸é‚»èŠ‚ç‚¹</span><span class="token keyword">def</span> <span class="token function">DFS</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> visited<span class="token punctuation">)</span><span class="token punctuation">:</span>    visited<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> neighbour <span class="token keyword">in</span> graph<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> visited<span class="token punctuation">[</span>neighbour<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>            DFS<span class="token punctuation">(</span>neighbour<span class="token punctuation">,</span> visited<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å¹¿åº¦ä¼˜å…ˆ</strong>æ€»ç»“ä¸ºï¼šä½¿ç”¨å®¹å™¨ï¼Œé€å±‚å¾ªç¯ï¼Œç›´è‡³å®¹å™¨ä¸ºç©º</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># graph[v] å­˜å‚¨èŠ‚ç‚¹ v çš„ç›¸é‚»èŠ‚ç‚¹</span><span class="token keyword">def</span> <span class="token function">BFS</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> graph<span class="token punctuation">,</span> visited<span class="token punctuation">)</span><span class="token punctuation">:</span>    container <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    container<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v<span class="token punctuation">)</span>    visited<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>    <span class="token keyword">while</span> container<span class="token punctuation">:</span>        v <span class="token operator">=</span> container<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> v_ <span class="token keyword">in</span> graph<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> visited<span class="token punctuation">[</span>v_<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>                container<span class="token punctuation">.</span>append<span class="token punctuation">(</span>v_<span class="token punctuation">)</span>                visited<span class="token punctuation">[</span>v_<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šçš„ä»£ç ä»…ä½“ç°æ€æƒ³ï¼Œå¹¶æ²¡æœ‰ return ä»»ä½•å€¼ï¼Œè€Œä¸”ä»…ä»…æ˜¯ä½¿ç”¨äº†éå†å›¾çš„ç‰¹ä¾‹ï¼Œå…·ä½“æƒ…å†µéœ€è¦å…·ä½“åˆ†æ</p><h3 id="40-Combination-Sum-ii"><a href="#40-Combination-Sum-ii" class="headerlink" title="40 Combination Sum ii"></a>40 Combination Sum ii</h3><p><a href="https://leetcode-cn.com/problems/combination-sum-ii/">leetcode link</a></p><p>è¿™ä¸€é¢˜å‡ºäº†æ·±åº¦æœç´¢æ˜¯è§£é¢˜å…³é”®å¤–ï¼Œå¦ä¸€ä¸ªå…³é”®åœ¨äºå‰ªæã€‚å¯¹äºé‡å¤æ•°å­— x é‡å¤äº† m æ¬¡ï¼Œåº”å½“ä½¿ç”¨ m ä¸ªå¾ªç¯å»ºç«‹çŠ¶æ€çš„è½¬ç§»ï¼Œè€Œä¸æ˜¯é‡‡ç”¨æ¯”è¾ƒåŸå§‹çš„æ·±åº¦æœç´¢æ€æƒ³ï¼Œå³ 2^m æ¬¡æœç´¢ï¼Œè¿™ä¼šæµªè´¹å¾ˆå¤šæ—¶é—´</p><p>è¿™ä¸€é¢˜å…¶å®æœ‰å¾ˆå¤šçš„ä¸œè¥¿éœ€è¦å­¦ä¹ ã€‚æˆ‘è¿™é‡Œç®€è¦æ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li><p>python çš„ nonlocal &amp; global å…³é”®å­—ä½œç”¨ã€‚äºŒè€…çš„ä½œç”¨æ˜¯ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥å°†å˜é‡çš„å‘½åç©ºé—´å»¶é•¿åˆ°â€œå±€éƒ¨â€ï¼Œ<a href="https://zhuanlan.zhihu.com/p/341378844">çŸ¥ä¹</a></p></li><li><p>copy æ˜¯ shallow copyï¼Œå¯¹äºåˆ—è¡¨æ¥è®²åªæ‹·è´é¡¶å±‚ï¼Œè€ƒè™‘ä½¿ç”¨å‰¯æœ¬çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼Œ<a href="https://www.runoob.com/python3/python3-att-list-copy.html">èœé¸Ÿæ•™ç¨‹</a></p></li><li><p>åˆ—è¡¨çš„ + è¿ç®—ç¬¦ä¸€èˆ¬ä¼šåˆ›é€ ä¸€ä¸ªæ–°çš„åˆ—è¡¨å¯¹è±¡ï¼Œå¦‚æœæƒ³è¦åŸåœ°ä¿®æ”¹åˆ—è¡¨æœ‰å‡ ä¸ªé€‰æ‹©ï¼š</p><ol><li>append</li><li>+= è¿ç®—ä¹Ÿèƒ½å¤ŸåŸåœ°ä¿®æ”¹</li><li>List[:] åˆ‡ç‰‡ä¿®æ”¹</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 2588593621952</span>a <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 2588593621952</span>a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 2588593875520</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>æ›´éœ€è¦å­¦ä¹ çš„å…¶å®æ˜¯æ·±åº¦æœç´¢çš„æ€æƒ³ï¼š</p><ol><li>ç»™ä¸€ä¸ªæ¸…æ™°çš„å®šä¹‰ï¼šä»æŸä¸ªèŠ‚ç‚¹å¼€å§‹éå†æ‰€æœ‰çš„</li><li>å‰ªææ˜¯ä¸€ä¸ªèŠ‚çœè®¡ç®—èµ„æºçš„é‡è¦æ“ä½œï¼Œä¸ä»…æ˜¯ visited è®°å½•çŠ¶æ€ï¼Œè¿˜æ’é™¤ä¸å¯èƒ½çš„æœç´¢ç©ºé—´</li></ol><p>æ·±åº¦æœç´¢çš„æ€æƒ³ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥çš„ç†è§£ï¼Œå°¤å…¶æ˜¯å¯¹äº<strong>å›æº¯</strong>æ—¶å€™çš„æ“ä½œ<strong>ï¼ˆå›æº¯ä»…åœ¨ç©ºé—´å¤æ‚åº¦å¾ˆå¤§çš„ä½¿ç”¨ï¼Œä¸ç„¶ç›´æ¥åˆ›å»ºå¤šæ¡è·¯å¾„å°±å¯ä»¥äº†ï¼‰</strong></p><ol><li><p>ä¹‹å‰å…³äº copy çš„çŸ›ç›¾æ¥è‡ªäºä¸€ä¸ªèµ‹å€¼æ“ä½œï¼ˆå®é™…ä¸Šæ˜¯è®©æŒ‡é’ˆæŒ‡å‘äº† copy å¯¹è±¡ï¼Œä»è€Œä¹‹åéƒ½ä¿®æ”¹äº† copy å¯¹è±¡ï¼‰</p><p>å¦‚æœéœ€è¦ä¿®æ”¹åŸå¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨æ–¹æ³• <code>sub_ans[:] = sub_ans[:-r_]</code> å¦åˆ™ä¼šè¿”å›æ–°çš„å¯¹è±¡/æ–°çš„ idï¼Œ<code>a = sub_ans[:]</code> å’Œ <code>a = sub_ans.copy()</code> æ˜¯ç­‰æ•ˆçš„</p></li><li><p>åŠ å· + å’Œ append å¯¹äº list çš„åŒºåˆ«ï¼š+ ä¸€èˆ¬ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè€Œ append ä¸ä¼šï¼Œå¹¶ä¸” append é€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯ += æ–¹æ³•ä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡</p></li><li><p>nonlocal å’Œ global æ˜¯ç›¸ä¼¼çš„ï¼Œåªæ˜¯ä½¿ç”¨åœºåˆä¸åŒ</p></li></ol><h2 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h2><h3 id="225-amp-232-Implement-Stack-using-Queues-amp-vice-versa"><a href="#225-amp-232-Implement-Stack-using-Queues-amp-vice-versa" class="headerlink" title="225 &amp; 232 Implement Stack using Queues &amp; vice versa"></a>225 &amp; 232 Implement Stack using Queues &amp; vice versa</h3><p><a href="https://leetcode-cn.com/problems/implement-stack-using-queues/solution/yong-dui-lie-shi-xian-zhan-by-leetcode-solution/">leetcode link</a></p><h3 id="150-Evaluate-Reverse-Polish-Notation"><a href="#150-Evaluate-Reverse-Polish-Notation" class="headerlink" title="150 Evaluate Reverse Polish Notation"></a>150 Evaluate Reverse Polish Notation</h3><p><a href="https://leetcode-cn.com/problems/evaluate-reverse-polish-notation/">leetcode link</a></p><p>ä¹‹å‰æ¥è§¦è¿‡ç±»ä¼¼çš„é¢˜ï¼Œæ‰€ä»¥åšèµ·æ¥å¾ˆå¿«ï¼Œä½¿ç”¨æ ˆæ¥è®¡ç®—ã€‚æ³¨æ„ä½¿ç”¨ int æ¥è¿›è¡Œæ•´æ•°è½¬æ¢</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">evalRPN</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tokens<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        symbol <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">]</span>        stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> <span class="token builtin">input</span> <span class="token keyword">in</span> tokens<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">input</span> <span class="token keyword">in</span> symbol<span class="token punctuation">:</span>                b <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>                a <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token builtin">input</span> <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">:</span>                    c <span class="token operator">=</span> a <span class="token operator">+</span> b                <span class="token keyword">elif</span> <span class="token builtin">input</span> <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">:</span>                    c <span class="token operator">=</span> a <span class="token operator">-</span> b                <span class="token keyword">elif</span> <span class="token builtin">input</span> <span class="token operator">==</span> <span class="token string">'*'</span><span class="token punctuation">:</span>                    c <span class="token operator">=</span> a <span class="token operator">*</span> b                <span class="token keyword">else</span><span class="token punctuation">:</span>                    c <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span>                stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> stack<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a>PriorityQueue</h2><h3 id="347-Top-K-Frequent-Elements"><a href="#347-Top-K-Frequent-Elements" class="headerlink" title="347 Top K Frequent Elements"></a>347 Top K Frequent Elements</h3><p><a href="https://leetcode-cn.com/problems/top-k-frequent-elements/submissions/">leetcode link</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">topKFrequent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter        counter <span class="token operator">=</span> Counter<span class="token punctuation">(</span>nums<span class="token punctuation">)</span>        top_k <span class="token operator">=</span> counter<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span>k<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>obj<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> obj <span class="token keyword">in</span> top_k<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="973-K-Closest-Points-to-Origin"><a href="#973-K-Closest-Points-to-Origin" class="headerlink" title="973 K Closest Points to Origin"></a>973 K Closest Points to Origin</h3><p><a href="https://leetcode-cn.com/problems/k-closest-points-to-origin/">leetcode link</a></p><p>äº†è§£ sorted çš„ key æ€ä¹ˆç”¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">kClosest</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">:</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        sort <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>        top_k <span class="token operator">=</span> <span class="token punctuation">[</span>sort<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> top_k<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨<strong>å †</strong>æ•°æ®ç»“æ„å¯ä»¥é™ä½å¤æ‚åº¦ï¼Œåˆ° O(nlogk)ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹å †ï¼š</p><ul><li>å †æ€»æ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘</li><li>å †ä¸­æŸä¸ªç»“ç‚¹çš„å€¼æ€»æ˜¯ä¸å¤§äºæˆ–ä¸å°äºå…¶çˆ¶ç»“ç‚¹çš„å€¼</li></ul><p>å †æœ‰3ä¸ªå¸¸ç”¨æ“ä½œï¼š1. æ’å…¥æ•°æ® insert 2. åˆ é™¤å †é¡¶ pop 3. è·å¾—å †é¡¶ peak</p><h2 id="DP"><a href="#DP" class="headerlink" title="DP"></a>DP</h2><h3 id="120-Triangle"><a href="#120-Triangle" class="headerlink" title="120 Triangle"></a>120 Triangle</h3><p><a href="https://leetcode-cn.com/problems/triangle/">leetcode link</a></p><p>å‡½æ•°çš„è‡ªè°ƒç”¨å¯ä»¥æœ‰ä¸¤ä¸ªä¸åŒçš„ä½œç”¨ï¼š</p><ol><li>å½¢æˆé€’å½’ï¼Œä»¥æ•°å­¦å½’çº³æ³•çš„æ–¹å¼ã€‚éœ€è¦è§£å†³æœ€ç®€å•çš„æƒ…å†µ</li><li>å½¢æˆæ·±åº¦æœç´¢ï¼Œè¿›è¡ŒçŠ¶æ€è½¬ç§»</li></ol><p>æ•°å­¦å½’çº³æ³•çš„å½¢å¼æ¯”è¾ƒç›´è§‚ï¼Œæ·±åº¦æœç´¢çš„ä»£ç å°±æ²¡æœ‰é‚£ä¹ˆç›´è§‰äº†ã€‚è¿™é‡Œæ€»ç»“ä¸€äº›æ·±åº¦æœç´¢ä¸­çš„é‡è¦å…ƒç´ ï¼š</p><ol><li>å½“å‰çŠ¶æ€ statusã€‚é€šå¸¸åŒ…æ‹¬å½“å‰èŠ‚ç‚¹ï¼Œå½“å‰æœç´¢è·¯å¾„ path ç­‰å»ºæ¨¡å½“å‰ç¯å¢ƒçš„æ¡ä»¶</li><li>ç›®æ ‡ targetï¼Œæœç´¢çš„ç›®æ ‡ï¼Œä¹Ÿæ˜¯åœæ­¢æœç´¢çš„æ¡ä»¶</li><li>å‰ªææ¡ä»¶ conditions (optional)ï¼Œé€šå¸¸ç”¨äºå‡å°‘è®¡ç®—é‡</li><li>çŠ¶æ€è½¬ç§»ï¼Œä»å½“å‰çŠ¶æ€è½¬ç§»åˆ°å…¶ä»–çŠ¶æ€</li></ol><p>ä½†æ˜¯åŠ¨æ€è§„åˆ’ä¸€èˆ¬ä¸éœ€è¦è‡ªè°ƒç”¨ï¼Œåªéœ€è¦å¾ªç¯ã€‚å› ä¸ºè‡ªè°ƒç”¨å½¢æˆé€’å½’è¢« memoization æ›¿ä»£ï¼Œå…·ä½“æ¥è¯´æ˜¯è¢«ä¸€ä¸ªæ•°ç»„æ›¿ä»£ï¼Œè¿™ä¸ªæ•°ç»„å­˜å‚¨äº†æœ€ä¼˜å­é—®é¢˜çš„ç­”æ¡ˆã€‚è¿™æ ·çœ‹æ¥åŠ¨æ€è§„åˆ’æ›´åƒæ˜¯ä¸€ç§è¿­ä»£</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">minimumTotal</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> triangle<span class="token punctuation">:</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>triangle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                    right <span class="token operator">=</span> triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> triangle<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>                    triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> right                <span class="token keyword">elif</span> j <span class="token operator">==</span> i <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>                    left <span class="token operator">=</span> triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> triangle<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                    triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> left                <span class="token keyword">else</span><span class="token punctuation">:</span>                    triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>triangle<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> triangle<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token builtin">min</span><span class="token punctuation">(</span>triangle<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="518-Coin-Change-2"><a href="#518-Coin-Change-2" class="headerlink" title="518 Coin Change 2"></a>518 Coin Change 2</h3><p><a href="https://leetcode-cn.com/problems/coin-change-2/">leetcode link</a></p><p>çœ‹åˆ°è¿™ä¸€é¢˜ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ 40 é¢˜ï¼Œå…ˆç”¨æœç´¢çš„æ–¹æ³•å®ç°äº†ä¸€éï¼Œé¡ºä¾¿å¤ä¹ äº†ä¸€ä¸‹æ·±åº¦æœç´¢</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">change</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> coins<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        num <span class="token operator">=</span> <span class="token number">0</span>        n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>coins<span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">nonlocal</span> num            <span class="token keyword">if</span> target <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token comment"># åˆ¤å®š target</span>                num <span class="token operator">+=</span> <span class="token number">1</span>                <span class="token keyword">return</span>            <span class="token keyword">if</span> pos <span class="token operator">==</span> n <span class="token keyword">or</span> coins<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">&gt;</span> target<span class="token punctuation">:</span>                <span class="token comment"># å‰ªæ</span>                <span class="token keyword">return</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment"># å­æœç´¢ç©ºé—´</span>                times <span class="token operator">=</span> target <span class="token operator">//</span> coins<span class="token punctuation">[</span>i<span class="token punctuation">]</span>                <span class="token keyword">for</span> r_ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> times <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token comment"># å­æœç´¢ç©ºé—´ä¸­çš„çŠ¶æ€è½¬ç§»</span>                    search<span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> target <span class="token operator">-</span> r_ <span class="token operator">*</span> coins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        search<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span>        <span class="token keyword">return</span> num<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆæ—¶é—´è¶…æ—¶ï¼Œæƒ³äº†å¾ˆä¹…éƒ½æ²¡æœ‰ç»“æœï¼Œäºæ˜¯ä¹åªèƒ½çœ‹è§£ç­”ï¼Œè¿™æ ·æ‰èƒ½æ„Ÿå—åŠ¨æ€è§„åˆ’çš„é­”åŠ›å•Š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">change</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> coins<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>                dp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>amount<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>        dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>coins<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>coins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> amount<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> dp<span class="token punctuation">[</span>j <span class="token operator">-</span> coins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> dp<span class="token punctuation">[</span>amount<span class="token punctuation">]</span>    <span class="token comment"># small case looks like this</span>        <span class="token comment">#       amount 1 2 3 4 5</span>        <span class="token comment"># coin1        1 1 1 1 1</span>        <span class="token comment"># coin2        1 2 2 3 3</span>        <span class="token comment"># coin5        1 2 2 3 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç®€çŸ­çš„å‡ è¡Œä»£ç ç›´æ¥ç§’æ€é€šå…³â€¦å½“ç„¶æ€æƒ³å’±è¿˜æ˜¯è¦å­¦ä¸€å­¦ï¼Œé¦–å…ˆçœ‹çœ‹è‡ªå·±çš„æ€è·¯å·®åœ¨å“ªé‡Œï¼šå½“æ”¾å¼ƒä½¿ç”¨æ·±åº¦æœç´¢é‡‡ç”¨åŠ¨æ€è§„åˆ’æ—¶ï¼Œæˆ‘éœ€è¦å…ˆå®šä¹‰çŠ¶æ€ï¼Œå¾ˆè‡ªç„¶åœ°å°±æƒ³åˆ°ä»¥ coins ä¸ºçŠ¶æ€ï¼Œä½†æ˜¯è¿™ä¸ªæ€è·¯å¾ˆå¿«å°±è¢«å¦å®šäº†â€¦å› ä¸ºå‡è®¾å·²çŸ¥å­é—®é¢˜ coinsâ€™ çš„ç­”æ¡ˆï¼ŒåŸºäºæ­¤å†æ·»åŠ ä¸€ä¸ªæ–°çš„é¢é¢ï¼Œä¹Ÿå¾ˆéš¾å¾—åˆ°é—®é¢˜çš„ç­”æ¡ˆã€‚äº‹å®ä¸Šé—®é¢˜å°±å‡ºåœ¨å¯¹äºçŠ¶æ€çš„å®šä¹‰ï¼Œä¼¼ä¹ä¸å¤Ÿè¯¦ç»†ï¼Œå·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Šï¼å¦‚æœçŸ¥é“ coinsâ€™ åœ¨ 1~amount æ‰€æœ‰æ•°å€¼çš„ç»„åˆæ•°ï¼Œæ˜¯å¦å¯ä»¥å¾—åˆ°é—®é¢˜çš„ç­”æ¡ˆå‘¢ï¼Ÿè¿™æ˜¯å¯ä»¥çš„</p><p>å‡è®¾æœ‰ <code>amount = 500, coins = [3,5,7,8,9,10]</code>ï¼Œå·²çŸ¥ <code>coins' = [3,5,7,8,9]</code> ä» 1~500 çš„æ‰€æœ‰ amount çš„ç»„åˆæ•°ï¼Œè®°ä¸º <code>dp, len(dp) = 500</code>ã€‚å…ˆä»ç®€å•çš„æƒ…å†µå¼€å§‹ï¼Œç„¶åé€æ­¥é€’è¿›ï¼š</p><ol><li>ç¡¬å¸é¢å€¼åªä½¿ç”¨ä¸€æ¬¡ï¼šç»“æœä¸º <code>result = dp[490] + dp[500]</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å’Œä¸º500çš„ç»„åˆæ•°ï¼ŒåŠ ä¸Šå’Œä¸º490çš„ç»„åˆæ•°ï¼ˆå› ä¸ºæ–°åŠ å…¥äº†é¢å€¼ä¸º10çš„ç¡¬å¸ï¼‰</li><li>æ¥ä¸‹æ¥å°±æœ‰çµæ„Ÿäº†ï¼Œå¦‚æœç¡¬å¸é¢å€¼èƒ½ä½¿ç”¨ä¸¤æ¬¡ï¼šç»“æœä¸º <code>result = dp[480] + dp[490] + dp[500]</code></li><li>å¦‚æœç¡¬å¸é¢å€¼èƒ½ä¸é™æ¬¡æ•°çš„ä½¿ç”¨ï¼šç»“æœä¸º <code>result = dp[10] + ... + dp[500]</code></li><li>ä¸ºäº†è®©æ‰€æœ‰çš„çŠ¶æ€éƒ½è¿›è¡Œæ›´æ–°ï¼Œé™¤äº†è®¡ç®— <code>amount = 500</code> çš„ç»“æœï¼Œè¿˜éœ€è¦è®¡ç®— <code>amount = 1~499</code> çš„ç»“æœ</li></ol><p>è¿™é‡Œçš„çŠ¶æ€å’Œä¹‹å‰çš„ä¸å¤ªä¸€æ ·ï¼Œæ„Ÿè§‰å¤šäº†ä¸€ä¸ª<strong>ç»´åº¦</strong>ï¼Œæ‹“å±•äº†å¯ä½¿ç”¨çš„å­ç»“æ„</p><h3 id="64-Minimum-Path-Sum"><a href="#64-Minimum-Path-Sum" class="headerlink" title="64 Minimum Path Sum"></a>64 Minimum Path Sum</h3><p><a href="https://leetcode-cn.com/problems/minimum-path-sum/">leetcode link</a></p><p>æ²¡å•¥å¥½è¯´çš„ï¼Œè·Ÿ120é¢˜ä¸€æ ·çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">minPathSum</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> grid<span class="token punctuation">:</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        m <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span>        n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> j <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                    <span class="token keyword">continue</span>                up<span class="token punctuation">,</span> left <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span>                <span class="token keyword">if</span> up <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>                    grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>left<span class="token punctuation">]</span>                <span class="token keyword">elif</span> left <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>                    grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> grid<span class="token punctuation">[</span>up<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>grid<span class="token punctuation">[</span>up<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> grid<span class="token punctuation">[</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Bit-Manipulation"><a href="#Bit-Manipulation" class="headerlink" title="Bit Manipulation"></a>Bit Manipulation</h2><h3 id="421-Maximum-XOR-of-Two-Numbers-in-an-Array"><a href="#421-Maximum-XOR-of-Two-Numbers-in-an-Array" class="headerlink" title="421 Maximum XOR of Two Numbers in an Array"></a>421 Maximum XOR of Two Numbers in an Array</h3><p><a href="https://leetcode-cn.com/problems/maximum-xor-of-two-numbers-in-an-array/">leetcode link</a></p><p>è¿™å—çŸ¥è¯†çœŸå¿ƒä¸ä¼šï¼Œè™½ç„¶å®ç°äº†æš´åŠ›è§£æ³•ï¼Œä½†æ—¶é—´è¶…å¤ªå¤šäº†ï¼Œç›´æ¥ä¸Šå‚è€ƒé“¾æ¥ï¼š<a href="https://leetcode-cn.com/problems/maximum-xor-of-two-numbers-in-an-array/solution/li-yong-yi-huo-yun-suan-de-xing-zhi-tan-xin-suan-f/">leetcode</a>, <a href="https://www.bilibili.com/video/BV15q4y1L7n9?from=search&amp;seid=1379165254846016152">bilibili</a></p><p>å…³äº python ä½è¿ç®—ï¼š<a href="https://www.bilibili.com/video/BV16K41137ZM?from=search&amp;seid=1575516065609888964">bilibili</a>ï¼Œ<code>&lt;&lt;, &gt;&gt;, ~, &amp;, |, ^</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">findMaximumXOR</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> <span class="token number">0</span>        mask <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            mask <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span>            <span class="token comment"># å½“å‰å¾—åˆ°çš„æ‰€æœ‰å‰ç¼€éƒ½æ”¾åœ¨è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­</span>            s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> num <span class="token keyword">in</span> nums<span class="token punctuation">:</span>                s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>mask <span class="token operator">&amp;</span> num<span class="token punctuation">)</span>            <span class="token comment"># å…ˆâ€œè´ªå¿ƒåœ°â€å‡è®¾è¿™ä¸ªæ•°ä½ä¸Šæ˜¯ â€œ1â€ ï¼Œå¦‚æœå…¨éƒ¨å‰ç¼€éƒ½çœ‹å®Œï¼Œéƒ½ä¸ç¬¦åˆæ¡ä»¶ï¼Œè¿™ä¸ªæ•°ä½ä¸Šå°±æ˜¯ â€œ0â€ </span>            temp <span class="token operator">=</span> res <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span>            <span class="token keyword">for</span> prefix <span class="token keyword">in</span> s<span class="token punctuation">:</span>                <span class="token keyword">if</span> temp <span class="token operator">^</span> prefix <span class="token keyword">in</span> s<span class="token punctuation">:</span>                    res <span class="token operator">=</span> temp                    <span class="token keyword">break</span>        <span class="token keyword">return</span> res<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="89-Gray-Code"><a href="#89-Gray-Code" class="headerlink" title="89 Gray Code"></a>89 Gray Code</h3><p><a href="https://leetcode-cn.com/problems/gray-code/">leetcode link</a></p><p>è¿™ä¸€é¢˜æœ‰ä¸¤ç§æ€è·¯ï¼Œä¸€ä¸ªæ˜¯è‡ªå·±æƒ³çš„é€æ­¥æ’å…¥æ¨å¯¼ï¼Œå¦ä¸€ä¸ªå°±æ˜¯å‚è€ƒç­”æ¡ˆä¸­çš„é•œåƒæ³•</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">grayCode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">def</span> <span class="token function">expand</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> idx <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token punctuation">[</span>num <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>num <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> num <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span>        sub <span class="token operator">=</span> self<span class="token punctuation">.</span>grayCode<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            ret <span class="token operator">+=</span> expand<span class="token punctuation">(</span>i<span class="token punctuation">,</span> sub<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦ä¸€ä¸ªæ€è·¯ï¼Œé€Ÿåº¦ä¸€æ ·ï¼Œä½†æ˜¯ä»£ç æ›´ç®€å•</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">        <span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">grayCode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>        sub <span class="token operator">=</span> self<span class="token punctuation">.</span>grayCode<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        rev <span class="token operator">=</span> <span class="token punctuation">[</span>num <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> num <span class="token keyword">in</span> sub<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> sub <span class="token operator">+</span> rev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„å…¶ä¸­çš„ä½è¿ç®—åªæ˜¯è®¡ç®—äº† $2^{n-1}$ï¼Œä½†é€Ÿåº¦æ›´å¿«</p><h3 id="190-Reverse-Bits"><a href="#190-Reverse-Bits" class="headerlink" title="190 Reverse Bits"></a>190 Reverse Bits</h3><p><a href="https://leetcode-cn.com/problems/reverse-bits/">leetcode link</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">reverseBits</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        ret <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment"># è·å¾—ç¬¬ i ä½ç½®çš„æ•°</span>            <span class="token keyword">if</span> n <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>                ret <span class="token operator">=</span> ret <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">31</span> <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> retn <span class="token operator">=</span> <span class="token number">0b00000010100101000001111010011100</span><span class="token comment"># python è¡¨ç¤ºäºŒè¿›åˆ¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="191-Number-of-1-Bits"><a href="#191-Number-of-1-Bits" class="headerlink" title="191 Number of 1 Bits"></a>191 Number of 1 Bits</h3><p><a href="https://leetcode-cn.com/problems/number-of-1-bits/">leetcode link</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">hammingWeight</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        ret <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> n <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>               ret <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">return</span> ret <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="201-Bitwise-AND-of-Numbers-Range"><a href="#201-Bitwise-AND-of-Numbers-Range" class="headerlink" title="201 Bitwise AND of Numbers Range"></a>201 Bitwise AND of Numbers Range</h3><p><a href="https://leetcode-cn.com/problems/bitwise-and-of-numbers-range/">leetcode link</a></p><p>ä¸¤ä¸ªæ€è·¯ï¼š</p><ol><li>æ‰¾ left å’Œ right çš„å…¬å…±å‰ç¼€</li><li>æŸ¥çœ‹æ¯ä¸€ä½æ˜¯å¦æœ‰å¯èƒ½ä¸º0</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">rangeBitwiseAnd</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> m<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        shift <span class="token operator">=</span> <span class="token number">0</span>           <span class="token comment"># æ‰¾åˆ°å…¬å…±å‰ç¼€</span>        <span class="token keyword">while</span> m <span class="token operator">&lt;</span> n<span class="token punctuation">:</span>            m <span class="token operator">=</span> m <span class="token operator">&gt;&gt;</span> <span class="token number">1</span>            n <span class="token operator">=</span> n <span class="token operator">&gt;&gt;</span> <span class="token number">1</span>            shift <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">return</span> m <span class="token operator">&lt;&lt;</span> shift<span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">rangeBitwiseAnd</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> left<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        <span class="token comment"># é€ä¸ªæŸä¸ªä½æ˜¯å¦ä¼šç»è¿‡é›¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å‡å®šè¿™ä¸ªä½ä¸º0ï¼Œæ¥çœ‹çœ‹ä»€ä¹ˆä¼šå‘ç”Ÿ</span>        <span class="token comment"># å¦‚æœè¿™ä¸ªä½é«˜äº right åˆ™å¿…å®šä¸º0ï¼Œå¦‚æœä½äº rightï¼Œåˆ™éœ€è¦çœ‹ left å†³å®šæ˜¯å¦èƒ½ç»è¿‡ 0</span>        <span class="token comment"># å®é™…ä¸Šå°† right è¿™ä¸€ä½æ•°å­—å˜ä¸º0ï¼Œåé¢çš„æ•°å­—å…¨ä¸º 1ï¼Œå¦‚æœè¿™ä¸ªæ•°å­—å°äº left åˆ™è¿™ä¸€ä½ä¸èƒ½ç»è¿‡0ï¼Œåä¹‹ä¸€å®šèƒ½ç»è¿‡0</span>        ret <span class="token operator">=</span> <span class="token number">0</span>        mask <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">32</span> <span class="token operator">-</span> <span class="token number">1</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            mask <span class="token operator">=</span> mask <span class="token operator">&gt;&gt;</span> <span class="token number">1</span>            <span class="token keyword">if</span> right <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> left <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>            <span class="token keyword">if</span> right <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                tempt <span class="token operator">=</span> right <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                tempt <span class="token operator">=</span> tempt <span class="token operator">|</span> mask                <span class="token keyword">if</span> tempt <span class="token operator">&lt;</span> left<span class="token punctuation">:</span>                    ret <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h2><h3 id="785-Is-Graph-Bipartite"><a href="#785-Is-Graph-Bipartite" class="headerlink" title="785 Is Graph Bipartite?"></a>785 Is Graph Bipartite?</h3><p><a href="https://leetcode-cn.com/problems/is-graph-bipartite/">leetcode link</a></p><p>è¿™é¢˜ä¸€çœ‹å°±æ˜¯éœ€è¦ä½¿ç”¨å¹¶æŸ¥é›†çš„æ€æƒ³ï¼Œå†åŠ ä¸Šæ·±åº¦æœç´¢å°±è§£å†³äº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">isBipartite</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> graph<span class="token punctuation">:</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>        n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span>        status <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">]</span>        ret <span class="token operator">=</span> <span class="token boolean">True</span>        <span class="token keyword">def</span> <span class="token function">dfs</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">nonlocal</span> ret            <span class="token keyword">for</span> neighbor <span class="token keyword">in</span> graph<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> status<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> status<span class="token punctuation">[</span>neighbor<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>                        <span class="token keyword">return</span> <span class="token boolean">False</span>                    <span class="token keyword">elif</span> status<span class="token punctuation">[</span>neighbor<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                        status<span class="token punctuation">[</span>neighbor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>                        ret <span class="token operator">=</span> dfs<span class="token punctuation">(</span>neighbor<span class="token punctuation">,</span> status<span class="token punctuation">)</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> status<span class="token punctuation">[</span>neighbor<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                        <span class="token keyword">return</span> <span class="token boolean">False</span>                    <span class="token keyword">elif</span> status<span class="token punctuation">[</span>neighbor<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>                        status<span class="token punctuation">[</span>neighbor<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>                        ret <span class="token operator">=</span> dfs<span class="token punctuation">(</span>neighbor<span class="token punctuation">,</span> status<span class="token punctuation">)</span>            <span class="token keyword">return</span> ret        <span class="token keyword">while</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">in</span> status<span class="token punctuation">:</span>            node <span class="token operator">=</span> status<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>            status<span class="token punctuation">[</span>node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>            ret <span class="token operator">=</span> dfs<span class="token punctuation">(</span>node<span class="token punctuation">,</span> status<span class="token punctuation">)</span> <span class="token keyword">and</span> ret        <span class="token keyword">return</span> ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è™½ç„¶ä»£ç æ¯”è¾ƒä¸‘ï¼Œä½†æ˜¯ç®¡ç”¨â€¦</p><p>è‡³æ­¤å®Œæˆäº†å‡ ä¹æ‰€æœ‰ç±»å‹çš„é¢˜ç›®ï¼Œä¸‹é¢çš„ä»»åŠ¡å°±æ˜¯å¢åŠ é¢˜é‡äº†ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode-diary 1</title>
      <link href="/archives/fc1adef0.html"/>
      <url>/archives/fc1adef0.html</url>
      
        <content type="html"><![CDATA[<h1 id="Leetcode-diary-1"><a href="#Leetcode-diary-1" class="headerlink" title="Leetcode-diary 1"></a>Leetcode-diary 1</h1><p>diary 1 &amp; diary 2 çš„ç›®çš„æ˜¯äº†è§£å¤šç§é¢˜å‹ï¼Œæ²¡æœ‰æ·±å…¥</p><h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><h3 id="14-Longest-Common-prefix"><a href="#14-Longest-Common-prefix" class="headerlink" title="14 Longest Common prefix"></a>14 Longest Common prefix</h3><p>æœ€çŸ­å†™æ³•ï¼Œå¦™ç”¨ zip å‡½æ•°</p><p>æˆ‘çš„å†™æ³•ï¼Œä½¿ç”¨ä¸¤ä¸ªå¾ªç¯</p><h3 id="58-Length-Of-Last-Word"><a href="#58-Length-Of-Last-Word" class="headerlink" title="58 Length Of Last Word"></a>58 Length Of Last Word</h3><p>æ²¡æœ‰ç‰¹åˆ«å¥½æ³¨æ„çš„</p><h3 id="387-First-Unique-Character-in-a-String"><a href="#387-First-Unique-Character-in-a-String" class="headerlink" title="387 First Unique Character in a String"></a>387 First Unique Character in a String</h3><p><a href="https://leetcode-cn.com/problems/first-unique-character-in-a-string/">leetcode link</a></p><p>å®é™…æµ‹è¯•æ˜¯å¯ä»¥ä½¿ç”¨ collections åº“ï¼ŒCounter: Dict subclass for counting hashable items. </p><h3 id="383-Ransom-Note"><a href="#383-Ransom-Note" class="headerlink" title="383 Ransom Note"></a>383 Ransom Note</h3><p><a href="https://leetcode-cn.com/problems/ransom-note/">leetcode link</a></p><h3 id="415-Add-Strings"><a href="#415-Add-Strings" class="headerlink" title="415 Add Strings"></a>415 Add Strings</h3><p><a href="https://leetcode-cn.com/problems/add-strings/">leetcode link</a></p><h3 id="205-Isomorphic-Strings"><a href="#205-Isomorphic-Strings" class="headerlink" title="205 Isomorphic Strings"></a>205 Isomorphic Strings</h3><p><a href="https://leetcode-cn.com/problems/isomorphic-strings/">leetcode link</a></p><p>æˆ‘çš„è§£æ³•æ˜¯å…ˆå»ºç«‹ä¸¤ä¸ªå­—å…¸ï¼Œç„¶åé€å¯¹åŒ¹é…ï¼Œå¦‚æœä¸¤è€…éç©ºï¼Œåˆ™è¿›è¡ŒåŒ¹é…ï¼›å¦‚æœä¸¤è€…å‡ä»¥åŒ¹é…ï¼Œåˆ™çœ‹åŒ¹é…æ˜¯å¦ä¸€è‡´ï¼›å¦‚æœä»…ä¸€ä¸ªåŒ¹é…åˆ™é…å¯¹å¤±è´¥</p><p>å¦ä¸€ç§è§£æ³•æ˜¯å•å‘åŒ¹é…åšä¸¤æ¬¡ï¼Œä¹Ÿèƒ½æˆ</p><p>è¿˜æœ‰ä¸€ç§æ›´ç®€æ´çš„å†™æ³•æ˜¯ä½¿ç”¨ map å‡½æ•°ï¼Œ<strong>ä¸€è¡Œè§£å†³</strong> <code>return list(map(s.index, s)) == list(map(t.index, t))</code></p><h3 id="451-Sort-Characters-By-Frequency"><a href="#451-Sort-Characters-By-Frequency" class="headerlink" title="451 Sort Characters By Frequency"></a>451 Sort Characters By Frequency</h3><p><a href="https://leetcode-cn.com/problems/sort-characters-by-frequency/">leetcode link</a></p><p>ä½¿ç”¨ <code>most_common()</code> å°†å…¶æŒ‰ç…§å‡ºç°é¢‘ç‡é¡ºåºæ’åˆ—ï¼Œè¿˜å¯ä»¥æŒ‡å®šå‚æ•°èƒ½å¤Ÿè¾“å‡º Top k ä¸ªè¯</p><h3 id="294-Flip-Game-ii"><a href="#294-Flip-Game-ii" class="headerlink" title="294 Flip Game ii"></a>294 Flip Game ii</h3><p>è¿™ä¸€é¢˜ç«Ÿæ˜¯ä¼šå‘˜é¢˜â€¦é‚£å°±åªèƒ½çœ‹çœ‹é¢˜ç›®ï¼Œå†çœ‹çœ‹å…¶ä»–è§£ç­”äº†ï¼æœ‰è¶£çš„æ˜¯è¿™ä¸€é¢˜éœ€è¦ä¸€ç‚¹ç‚¹åšå¼ˆè®ºçš„çŸ¥è¯†ï¼Œèƒ½æ›´å¥½çš„ç†è§£ <a href="https://zhuanlan.zhihu.com/p/21300536">çŸ¥ä¹</a>ã€‚ä»£ç å‚è€ƒ <a href="https://blog.csdn.net/qq_32424059/article/details/100765272">CSDN</a>ï¼Œæ—¢ç„¶æ¯ä¸€ç§çŠ¶æ€éƒ½æœ‰ç¡®å®šçš„è¾“èµ¢ï¼Œé‚£ä¹ˆä½¿ç”¨é€’å½’å»æ±‚è§£æ˜¯å†é€‚åˆä¸è¿‡çš„äº†ã€‚å®šä¹‰é€’å½’é—®é¢˜ï¼šå½“å‰çŠ¶æ€ä¸ºå¿…èƒœçŠ¶æ€ </p><h3 id="290-Word-Pattern"><a href="#290-Word-Pattern" class="headerlink" title="290 Word Pattern"></a>290 Word Pattern</h3><p><a href="https://leetcode-cn.com/problems/word-pattern/">leetcode link</a></p><p>è¿™ä¸€é¢˜å’Œä¹‹å‰çš„ 205 åŒè´¨å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„é¢˜ï¼Œè€ƒå¯Ÿä¸€ä¸ªä¸€ä¸€å¯¹åº”çš„é—®é¢˜ï¼Œ<strong>æœ€çŸ­å†™æ³•ï¼šå¦™ç”¨ map å‡½æ•°</strong></p><p>è‡ªå·±çš„å†™æ³•ã€‚åŒºåˆ«åœ¨äº 205 æœ‰ä¸€ä¸ªæ¡ä»¶ï¼šä¸¤ä¸ªå­—ç¬¦å‡ºä¸²çš„é•¿åº¦ç›¸ç­‰ï¼Œè¿™ä¸€é¢˜æ²¡æœ‰ï¼Œåœ¨ä¸€å¼€å§‹åˆ¤æ–­å³å¯ï¼Œå¦‚æœä¸æ»¡è¶³ç›´æ¥åˆ¤è´Ÿ</p><h3 id="38-Count-and-Say"><a href="#38-Count-and-Say" class="headerlink" title="38 Count and Say"></a>38 Count and Say</h3><p><a href="https://leetcode-cn.com/problems/count-and-say/submissions/">leetcode link</a></p><p>ç”¨è¿­ä»£æ€ç»´æ±‚è§£</p><p>ç”¨é€’å½’æ€ç»´æ±‚è§£ï¼š</p><h3 id="316-Remove-Duplicate-Letters"><a href="#316-Remove-Duplicate-Letters" class="headerlink" title="316 Remove Duplicate Letters"></a>316 Remove Duplicate Letters</h3><p><a href="https://leetcode-cn.com/problems/remove-duplicate-letters/">leetcode link</a></p><p>ä¸€å¼€å§‹è¿˜æ˜¯æƒ³ä½¿ç”¨åŠ¨æ€è§„åˆ’æ¥åšè¿™ä¸€é¢˜ï¼Œä½†å‘ç°è¿™é¢˜å¹¶ä¸é€‚åˆä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œå› ä¸ºå…¶æœ€ä¼˜å­ç»“æ„ä¹‹é—´å¹¶ä¸å­˜åœ¨å…³ç³»ï¼Œä¹Ÿå°±æ˜¯æ— åæ•ˆæ€§ã€‚è¿™é¢˜çš„æœ¬è´¨åœ¨äºï¼šéå†æ—¶èˆå¼ƒä¸ä¿ç•™æ•°å­—çš„æ¡ä»¶ï¼š</p><ol><li>ä¸ºä¿è¯é¡ºåºæ€§é‡‡ç”¨é¡ºåºéå†</li><li>ä¸ºä¿è¯ä¸é‡å¤æ€§ï¼Œå½“å½“å‰æ•°å­—å·²å­˜åœ¨äºå·²ä¿ç•™çš„æ•°å­—ä¸­æ—¶èˆå¼ƒå½“å‰æ•°å­—ï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¿ç•™å½“å‰æ•°å­—</li><li>å½“å‰æ•°å­—å°äºå‰ä¸€ä¸ªä¿ç•™æ•°å­—ï¼Œå¹¶ä¸”ä¹‹åä»ä¼šå‡ºå‰ä¸€ä¸ªä¿ç•™æ•°å­—æ—¶ï¼Œåˆ™èˆå¼ƒå‰ä¸€ä¸ªä¿ç•™æ•°å­—ã€‚è¿™ä¸€æ­¥éª¤æ˜¯æ•´ä¸ªé¢˜çš„æ ¸å¿ƒï¼Œå› ä¸ºè¿™ä¿è¯äº†é€’å‡</li><li>å¾ªç¯2ï¼Œè‡³åˆ°ä¸èˆå¼ƒå‰ä¸€ä¸ªä¿ç•™æ•°å­—ï¼Œæ­¤æ—¶ä¿ç•™å½“å‰æ•°å­—ï¼Œå¹¶éå†ä¸‹ä¸€ä¸ªæ•°</li></ol><p>è¿™æ ·çš„æ¡ä»¶æ˜¯å¦èƒ½å¤Ÿè·æˆ‘ä»¬æƒ³è¦çš„ç»“æœå‘¢ï¼Ÿå¾ˆå¤šç®—æ³•é¢˜å¹¶æ²¡æœ‰ç»™å‡ºå„ç§ç®—æ³•çš„æ•°å­¦è¯æ˜ï¼Œåªæ˜¯ä¸€ç§ç›´è§‰æ€§çš„ä»‹ç»ï¼Œæˆ‘è®¤ä¸ºéœ€è¦è¯æ˜åœ¨è¿™æ ·æ¡ä»¶ä¹‹ä¸‹æ‰€ä¿ç•™çš„ç­”æ¡ˆå°±æ˜¯æœ€ç»ˆç­”æ¡ˆã€‚ä½¿ç”¨åè¯æ³•ï¼Œè¯¥æ¡ä»¶æ»¡è¶³é¡ºåºæ€§ï¼Œä¹Ÿæ»¡è¶³ä¸é‡å¤æ€§ï¼Œåªéœ€è¦è¯æ˜æœ€å°å³å¯ï¼š</p><p>å‡è®¾åŸåºåˆ—ä¸º $a=\{a_1, a_2,â€¦,a_n\}$ ä½¿ç”¨è¯¥æ–¹æ³•è·å¾—çš„å­åºåˆ—ä¸º $z=\{z_1,z_2,â€¦,z_k\}$ï¼Œè‹¥å­˜åœ¨æ›´å°çš„åºåˆ— $zâ€™=\{z_1,z_2,â€¦,z_j,z_i,â€¦\}$ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯å°†æ•°å­— $z_j$ æ”¾åˆ°æ•°å­— $z_i$ ä¹‹å‰ï¼Œæ˜¾ç„¶æœ‰ $z_i&gt;z_j\ (i&lt;j)$ï¼Œä¸ºä¿è¯è¿™ä¸ªåºåˆ— $zâ€™$ çš„ä»»æ„æ€§ï¼Œ$z_i$ ä¹‹åçš„æ•°å­—å¯ä»¥æ—¶ä»»æ„æ’åˆ—çš„ã€‚ä¸‹é¢è¯æ˜è¿™æ ·çš„åºåˆ—æ˜¯ä¸å­˜åœ¨çš„ï¼š</p><p>å‡è®¾ $z_{i-1},z_i,z_j$ åœ¨åŸåºåˆ—ä¸­åˆ†åˆ«å¯¹åº” $a_p,a_q,a_m\ (p&lt;q&lt;m)$ã€‚è€ƒè™‘ä½¿ç”¨ç®—æ³•è·å¾—çš„å­åºåˆ—å¾—å‡ºï¼šæˆ‘ä»¬èˆå¼ƒäº† $p, q$ ä¹‹é—´çš„åŸåºåˆ— $\{a_p,a_{p+1},â€¦,a_q\}$ï¼›å†ç”±å‡è®¾åºåˆ—å¾—å‡ºï¼š$a_m$ å­˜åœ¨äº $p,q$ ä¹‹é—´ã€‚<strong>ç”±ä¸¤ä¸ªæ¨è®ºå¾—å‡ºï¼š$a_m$ å­˜åœ¨äº $p,q$ ä¹‹é—´å¹¶è¢«èˆå¼ƒ</strong>ï¼Œè¿™ä¸ªç»“è®ºæ˜¯ä¸æˆç«‹çš„ï¼</p><p> å› ä¸º $a_m$ å¹¶ä¸å±äºä¹‹å‰æ‰€ä¿ç•™çš„é›†åˆ $\{â€¦,z_{i-1}\}$ï¼Œå½“ $a_m$ ç¬¬ä¸€æ¬¡å‡ºç°æ—¶ï¼Œä¸€å®šä¼šè¢«ä½œä¸ºä¿ç•™æ•°å­—ç•™ä¸‹æ¥ï¼Œæ‰€ä»¥è¦åœ¨ä¹‹åèˆå¼ƒ $a_m$ åˆ™ä¹‹åå¿…é¡»å‡ºç°ä¿ç•™æ•°å­— $a_x$ï¼Œè¯¥æ•°å­—æ»¡è¶³ $a_x &lt; a_m$ ä¸” $a_x \notin \{â€¦,z_i\}$ï¼Œè€Œ $a_x$ ä¹Ÿå¿…é¡»è¢«èˆå¼ƒï¼Œå¦‚æ­¤å¾€å¤å½“éå†åˆ° $a_q(=z_i)$ æ—¶ï¼Œæœ€åä¸€ä¸ª $a_x$ å°†æ— æ³•è¢«èˆå¼ƒï¼Œå› ä¸º $a_x &lt; a_m = z_j &lt; z_i=a_q$ ä¸æ¨è®ºçŸ›ç›¾ï¼Œæ‰€ä»¥è¿™æ ·çš„åºåˆ— $zâ€™$ ä¸å­˜åœ¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># empty</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="539-Minimum-Time-Difference"><a href="#539-Minimum-Time-Difference" class="headerlink" title="539 Minimum Time Difference"></a>539 Minimum Time Difference</h3><p><a href="https://leetcode-cn.com/problems/minimum-time-difference/">leetcode link</a></p><p>å…ˆè¿›è¡Œå‡åºæ’åºå³å¯</p><h2 id="Binary-Search"><a href="#Binary-Search" class="headerlink" title="Binary Search"></a>Binary Search</h2><h3 id="704-Binary-Search"><a href="#704-Binary-Search" class="headerlink" title="704 Binary Search"></a>704 Binary Search</h3><p><a href="https://leetcode-cn.com/problems/binary-search/">leetcode link</a></p><p>å†™äº†ä¸¤ç§å†™æ³•ï¼Œä¸€ç§æ˜¯ç›´æ¥ç”¨åˆ—è¡¨è‡ªå¸¦çš„åŠŸèƒ½ï¼Œå¦ä¸€ç§å°±æ˜¯æœ´ç´ çš„äºŒåˆ†æŸ¥æ‰¾</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> nums<span class="token punctuation">.</span>index<span class="token punctuation">(</span>target<span class="token punctuation">)</span>        <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        begin <span class="token operator">=</span> <span class="token number">0</span>        end <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>        <span class="token comment"># ç»ˆæ­¢æ¡ä»¶</span>        <span class="token keyword">while</span> begin <span class="token operator">&lt;=</span> end<span class="token punctuation">:</span>            <span class="token comment"># äºŒåˆ†</span>            mid <span class="token operator">=</span> <span class="token punctuation">(</span>begin <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>            <span class="token comment"># åˆ¤å®š</span>            <span class="token keyword">if</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">==</span> target<span class="token punctuation">:</span>                <span class="token keyword">return</span> mid            <span class="token comment"># æ›´æ”¹æœç´¢èŒƒå›´</span>            <span class="token keyword">if</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&gt;</span> target<span class="token punctuation">:</span>            end <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token keyword">else</span><span class="token punctuation">:</span>            begin <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»ç»“ï¼š</p><ol><li>æœç´¢èŒƒå›´ä¸€å®šè¦åŒ…å«ç›®æ ‡å€¼ï¼Œä¸”è¦ä¸æ–­åœ°ç¼©å°ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿæ»¡è¶³ç»ˆæ­¢æ¡ä»¶è€Œä¸é™·å…¥æ­»å¾ªç¯</li><li>å½“ç›®æ ‡è¶…å‡ºäº†æ•´ä¸ªæ•°ç»„èŒƒå›´ï¼ŒäºŒåˆ†æœç´¢å¯èƒ½éœ€è¦è¦ç‰¹æ®Šå¤„ç†çš„</li><li>å½“ begin &amp; end ç›¸é‚»çš„æ—¶å€™ï¼Œæƒ…å†µä¼šå˜å¾—å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹éœ€è¦æ›´æ¸…æ™°æ‰èƒ½å†™å¥½ä»£ç ã€‚ä»¥æ­¤é¢˜ä¸ºä¾‹ï¼Œæ­¤æ—¶ target æœ‰ä¸¤ç§æƒ…å†µï¼šbegin &amp; end çš„äºŒè€…ä¹‹ä¸€æˆ–è€…äºŒè€…ä¹‹é—´ã€‚ä¸‹é¢å…·ä½“åˆ†æä¸€ä¸‹æœ€åçš„ç»†èŠ‚ï¼š<ol><li>ç»§ç»­äºŒåˆ†è®¡ç®—ï¼Œmid ä¼šå› ä¸ºæ•´é™¤æ“ä½œè€Œç­‰äº begin</li><li>å¦‚æœ begin å°±æ˜¯ target åˆ™ç»“æŸ</li><li>å¦‚æœ begin ä¸æ˜¯ target åˆ™è¯´æ˜ <code>nums[mid] &lt; target</code> å³ <code>nums[begin] &lt; target</code>ï¼Œæ‰§è¡Œ <code>begin = mid + 1</code></li><li>ç»§ç»­äºŒåˆ†è®¡ç®—ï¼Œmid ä¼šå› ä¸ºæ•´é™¤æ“ä½œè€Œç­‰äº end</li><li>å¦‚æœ end å°±æ˜¯ target åˆ™ç»“æŸ</li><li>å¦‚æœ end ä¸æ˜¯ target åˆ™è¯´æ˜ <code>nums[mid] &gt; target</code> å³ <code>nums[end] &gt; target</code>ï¼Œæ‰§è¡Œ <code>end = mid - 1</code></li><li>æ­¤æ—¶ begin &gt; endï¼Œå¾ªç¯ç»“æŸ</li></ol></li><li>åˆ¤å®šæ¡ä»¶ä¸€å®šè¦æ¸…æ™°</li></ol><h3 id="278-First-Bad-Version"><a href="#278-First-Bad-Version" class="headerlink" title="278 First Bad Version"></a>278 First Bad Version</h3><p><a href="https://leetcode-cn.com/problems/first-bad-version/">leetcode link</a></p><p>ä¸çŸ¥é“ <code>isBadVersion()</code> èƒ½ä¸èƒ½åˆ¤æ–­ 0 ç‰ˆæœ¬ï¼Œæ‰€ä»¥å…ˆåˆ¤æ–­ä¸€ä¸‹åˆå§‹ç‰ˆæœ¬ï¼Œå¥½åœ¨ä¹‹åç»Ÿä¸€å†™èµ·æ¥</p><h3 id="35-Search-Insert-Position"><a href="#35-Search-Insert-Position" class="headerlink" title="35 Search Insert Position"></a>35 Search Insert Position</h3><p><a href="https://leetcode-cn.com/problems/search-insert-position/">leetcode link</a></p><p>æ³¨æ„å¤„ç†ä¸€ä¸‹åˆå§‹å€¼é—®é¢˜ï¼ˆè¾¹ç•Œï¼‰å°±å¥½</p><h3 id="33-Search-in-Rotated-Sorted-Array"><a href="#33-Search-in-Rotated-Sorted-Array" class="headerlink" title="33 Search in Rotated Sorted Array"></a>33 Search in Rotated Sorted Array</h3><p><a href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array/">leetcode link</a></p><p>æˆ‘é¦–å…ˆçš„æƒ³æ³•æ˜¯ä½¿ç”¨3æ¬¡äºŒåˆ†æœç´¢è§£å†³é—®é¢˜ï¼Œä½†æˆ‘å…ˆå·ä¸ªæ‡’ï¼Œå†™äº†ç¬¬ä¸€ç§å†™æ³•ğŸ¤£æ•ˆæœä¹Ÿè¿˜ä¸é”™ï¼Œå¯èƒ½æ˜¯å› ä¸º N ä¸å¤Ÿå¤§ï¼Œæ‰€ä»¥äºŒå‰æœç´¢çš„ä¼˜åŠ¿æ˜¾ç°ä¸å‡ºæ¥</p><p>é¢˜è§£ä½¿ç”¨äº†æ›´ç®€æ´çš„ä»£ç ï¼Œæ€æƒ³å°±æ˜¯å°†èŒƒå›´è½¬ç§»è®¨è®ºå¾—æ›´åŠ æ¸…æ™°ï¼Œæ ¹æ® target &amp; nums[mid] å’Œ nums[0] çš„å…³ç³»åˆ¤æ–­</p><h3 id="153-Find-Minimum-in-Rotated-Sorted-Array"><a href="#153-Find-Minimum-in-Rotated-Sorted-Array" class="headerlink" title="153 Find Minimum in Rotated Sorted Array"></a>153 Find Minimum in Rotated Sorted Array</h3><p><a href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array/">leetcode link</a></p><p>è°ƒç”¨ä¸Šä¸€é¢˜å†™çš„å‡½æ•°å°±å¯ä»¥äº†ï¼Œå½“ç„¶æœ€æš´åŠ›çš„è¿˜æ˜¯æ’åºå•¦</p><h3 id="154-Find-Minimum-in-Rotated-Sorted-Array-ii"><a href="#154-Find-Minimum-in-Rotated-Sorted-Array-ii" class="headerlink" title="154 Find Minimum in Rotated Sorted Array ii"></a>154 Find Minimum in Rotated Sorted Array ii</h3><p><a href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array-ii/">leetcode link</a></p><p>è¿™é‡Œéœ€è¦å¤„ç†çš„æ˜¯é‡å¤å€¼ï¼Œå½“æœ‰é‡å¤å€¼å­˜åœ¨æ—¶ï¼Œåˆ™ä¸èƒ½ç›²ç›®ç¼©å°ä¸€èˆ¬æœç´¢èŒƒå›´ï¼Œè€Œæ˜¯è®©ä»…å¾€å‰èµ°ä¸€æ­¥å³å¯ã€‚æˆ‘è®© begin å‘å³èµ°ä¸€æ­¥ï¼Œä½†è¿™å¯èƒ½ä¼šå¯¼è‡´ begin è½å…¥å³ä¾§èŒƒå›´ï¼Œè¿™æ—¶è¯´æ˜ begin å³ä¸ºæ‰€æ±‚å€¼ index</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">findMin</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>        <span class="token keyword">def</span> <span class="token function">find_point</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            begin<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>            <span class="token comment"># è¾¹ç•Œå¤„ç†ï¼Œå¦åˆ™ç›®æ ‡è¶…å‡ºæœç´¢èŒƒå›´</span>            <span class="token keyword">if</span> nums<span class="token punctuation">[</span>begin<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token number">0</span>            <span class="token keyword">while</span> begin <span class="token operator">&lt;=</span> end<span class="token punctuation">:</span>                mid <span class="token operator">=</span> <span class="token punctuation">(</span>begin <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>                <span class="token keyword">if</span> mid <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">and</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&gt;</span> nums<span class="token punctuation">[</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> mid <span class="token operator">+</span> <span class="token number">1</span>                <span class="token keyword">if</span> mid <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> mid                <span class="token comment"># åˆ¤æ–­åœ¨å“ªä¸€è¾¹</span>                <span class="token keyword">if</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&gt;</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    begin <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>                <span class="token keyword">elif</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    end <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token comment"># å¦‚æœ begin ä»ç„¶åœ¨å·¦ä¾§</span>                    <span class="token keyword">if</span> nums<span class="token punctuation">[</span>begin<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                        begin <span class="token operator">+=</span> <span class="token number">1</span>                <span class="token comment"># å¦‚æœ begin åœ¨å³ä¾§</span>                    <span class="token keyword">else</span><span class="token punctuation">:</span>                        <span class="token keyword">return</span> begin            <span class="token comment"># åªæœ‰ä¸€ä¸ªæ•°çš„æƒ…å†µ</span>            <span class="token keyword">return</span> <span class="token number">0</span>        <span class="token keyword">return</span> nums<span class="token punctuation">[</span>find_point<span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h2><h3 id="876-Middle-of-the-Linked-List"><a href="#876-Middle-of-the-Linked-List" class="headerlink" title="876 Middle of the Linked List"></a>876 Middle of the Linked List</h3><p><a href="https://leetcode-cn.com/problems/middle-of-the-linked-list/">leetcode link</a></p><h3 id="21-Merge-Two-Sorted-Lists"><a href="#21-Merge-Two-Sorted-Lists" class="headerlink" title="21 Merge Two Sorted Lists"></a>21 Merge Two Sorted Lists</h3><p><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">leetcoke link</a></p><p>ç«Ÿç„¶æ²¡æœ‰é©¬ä¸Šæƒ³åˆ°é€’å½’ï¼Œè¿˜æ˜¯ç»ƒä¹ å¾—ä¸å¤Ÿå•Š</p><h3 id="160-Intersection-of-Two-Linked-Lists"><a href="#160-Intersection-of-Two-Linked-Lists" class="headerlink" title="160 Intersection of Two Linked Lists"></a>160 Intersection of Two Linked Lists</h3><p><a href="https://leetcode-cn.com/problems/intersection-of-two-linked-lists/">leetcode link</a></p><p>ä»å°¾éƒ¨å¼€å§‹éå†ï¼Œæ¯”è¾ƒå¥½åˆ¤æ–­</p><h3 id="24-Swap-Nodes-in-Pairs"><a href="#24-Swap-Nodes-in-Pairs" class="headerlink" title="24 Swap Nodes in Pairs"></a>24 Swap Nodes in Pairs</h3><p><a href="https://leetcode-cn.com/problems/swap-nodes-in-pairs/">leetcode link</a></p><p>ä¾ç„¶æ˜¯é€’å½’æ€æƒ³</p><h3 id="2-Add-Two-Numbers"><a href="#2-Add-Two-Numbers" class="headerlink" title="2 Add Two Numbers"></a>2 Add Two Numbers</h3><p><a href="https://leetcode-cn.com/problems/add-two-numbers/submissions/">leetcode link</a></p><p>æ¯”è¾ƒç¬¨çš„æ–¹æ³•å°±æ˜¯æŒ‰ç…§ä¸€èˆ¬æ€ç»´ï¼Œå…ˆå¾—åˆ°æ•°å­—å†ç›¸åŠ ï¼Œå†åˆ›å»ºé“¾è¡¨</p><p>æ›´å¥½çš„åŠæ³•è¿˜æ˜¯ç”¨é€’å½’çš„æ–¹æ³•ï¼Œè¿™å…¶å®æ‰æ˜¯æˆ‘çœ‹åˆ°è¿™é¢˜çš„ç¬¬ä¸€æƒ³æ³•</p><h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><h3 id="27-Remove-Element"><a href="#27-Remove-Element" class="headerlink" title="27 Remove Element"></a>27 Remove Element</h3><p><a href="https://leetcode-cn.com/problems/remove-element/">leetcode link</a></p><p>ä½¿ç”¨åŒæŒ‡é’ˆçš„æ€æƒ³ï¼Œâ€œåˆ é™¤â€ä¸ä¸€å®šæ˜¯çœŸçš„åˆ é™¤ã€‚å› ä¸ºåˆ é™¤æ˜¯å¾ˆè€—æ—¶çš„ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨æ¥çœ‹ï¼Œæˆ‘ç”¨ remove ä¹Ÿèƒ½å¤Ÿè¾¾åˆ°åŒæ ·çš„é€Ÿåº¦ã€‚leetcode çš„æœåŠ¡å™¨å¤šæ¬¡è¿è¡Œå¯èƒ½æœ‰ä¸åŒçš„ç»“æœ</p><h3 id="26-Remove-Duplicate-from-Sorted-Array"><a href="#26-Remove-Duplicate-from-Sorted-Array" class="headerlink" title="26 Remove Duplicate from Sorted Array"></a>26 Remove Duplicate from Sorted Array</h3><p><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/">leetcode link</a></p><h3 id="53-Maximum-Subarray"><a href="#53-Maximum-Subarray" class="headerlink" title="53 Maximum Subarray"></a>53 Maximum Subarray</h3><p><a href="https://leetcode-cn.com/problems/maximum-subarray/">leetcode link</a></p><p>è¿™é¢˜ä¸€å¼€å§‹æˆ‘æƒ³è¦ä½¿ç”¨é€’å½’çš„æ€æƒ³æ¥è§£å†³ï¼Œé€’å½’çš„æ•°å­¦æ¨¡å‹å…¶å®å°±æ˜¯æ•°å­¦å½’çº³æ³•ï¼šä¸­æ­¢æ¡ä»¶ï¼ˆæ¨å€’ç¬¬ä¸€å—ç§¯æœ¨ï¼‰ + åˆ©ç”¨å‡è®¾è§£å†³é—®é¢˜ï¼ˆå¤šç±³è¯ºæ•ˆåº”ï¼‰</p><p>ä½†æ˜¯ä¼¼ä¹ä¸èƒ½å¤Ÿé€šè¿‡å½’çº³æ³•ç®€å•åœ°å¾—å‡ºç»“è®ºï¼Œæˆ‘å®šä¹‰å‡è®¾ï¼šå·²çŸ¥åºåˆ— nums[:k] çš„å’ŒåŠå…¶å¼€å§‹ä½ç½®ï¼Œé‚£ä¹ˆåºåˆ— nums[:k+1] çš„è¿ç»­æœ€å¤§å’ŒåŠå…¶å¼€å§‹ä½ç½®åœ¨å“ªé‡Œã€‚<strong>è§£æï¼šä½¿ç”¨åŠ¨æ€è§„åˆ’</strong></p><p>åŠ¨æ€è§„åˆ’å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç ”ç©¶é¢†åŸŸï¼Œæˆ‘è®¤ä¸ºä¹‹åæœ‰å¿…è¦å¥½å¥½æ€»ç»“è¿™ä¸ªæ€æƒ³ï¼ˆrecursive + momoizationï¼‰ã€‚åŠ¨æ€è§„åˆ’æœ‰å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ol><li><p>çŠ¶æ€</p></li><li><p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</p></li><li><p>åˆå§‹åŒ–</p></li><li><p>æ— åæ•ˆæ€§ï¼šå¦‚æœä¹‹å‰çš„é˜¶æ®µæ±‚è§£çš„å­é—®é¢˜çš„ç»“æœåŒ…å«äº†ä¸€äº›ä¸ç¡®å®šçš„ä¿¡æ¯ï¼Œå¯¼è‡´äº†åé¢çš„é˜¶æ®µæ±‚è§£çš„å­é—®é¢˜æ— æ³•å¾—åˆ°ï¼Œæˆ–è€…å¾ˆéš¾å¾—åˆ°ï¼Œè¿™å«ã€Œæœ‰åæ•ˆæ€§ã€</p><p>è§£å†³ã€Œæœ‰åæ•ˆæ€§ã€çš„åŠæ³•æ˜¯å›ºå®šä½éœ€è¦åˆ†ç±»è®¨è®ºçš„åœ°æ–¹ï¼Œé€šå¸¸æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ³•ï¼š</p><ol><li>çŠ¶æ€æ•°ç»„å¢åŠ ç»´åº¦</li><li>æŠŠçŠ¶æ€å®šä¹‰å¾—æ›´ç»†è‡´ã€å‡†ç¡®</li></ol></li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># empty</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Matrix"><a href="#Matrix" class="headerlink" title="Matrix"></a>Matrix</h2><h3 id="74-Search-a-2D-Matrix"><a href="#74-Search-a-2D-Matrix" class="headerlink" title="74 Search a 2D Matrix"></a>74 Search a 2D Matrix</h3><p><a href="https://leetcode-cn.com/problems/reconstruct-a-2-row-binary-matrix/">leetcode link</a></p><p>è¿™ä¸€é¢˜æƒ³ä½¿ç”¨ numpy æ¥åšï¼Œä½†é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå¯èƒ½å› ä¸º import çš„åŸå› </p><h3 id="240-Search-a-2D-Matrix-ii"><a href="#240-Search-a-2D-Matrix-ii" class="headerlink" title="240 Search a 2D Matrix ii"></a>240 Search a 2D Matrix ii</h3><p><a href="https://leetcode-cn.com/problems/search-a-2d-matrix-ii/submissions/">leetcode link</a></p><p>ç¬¬ä¸€ä¸ªç›´è§‚çš„æƒ³æ³•å°±æ˜¯äºŒåˆ†æŸ¥æ‰¾</p><p>ä½†ç›´è§‰æ„Ÿè§‰å¤æ‚åº¦åº”è¯¥åœ¨ O(m + n) æ‰€ä»¥è¿˜æœ‰æ›´å¥½çš„æœç´¢æ–¹æ³•ï¼Œåˆæƒ³åˆ°ä¸€ä¸ªæ–¹æ³•ï¼šé‡è§†å¯¹è§’ã€‚å› ä¸ºå¯¹è§’æ˜¯æœ€å°å’Œæœ€å¤§å€¼ï¼Œå…ˆçœ‹ target å€¼åœ¨å“ªä¸ªåŒºé—´ï¼Œç„¶åå°±å»å¯¹åº”çš„åŒºåŸŸæœç´¢ã€‚ä½†å®ç°èµ·æ¥è¿‡äºå¤æ‚ï¼Œçœ‹é¢˜è§£æ˜¯ä»å³ä¸Šè§’å¼€å§‹æœç´¢ï¼Œè¿™çš„ç¡®æ›´å¥½</p><h2 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h2><h3 id="15-3Sum"><a href="#15-3Sum" class="headerlink" title="15 3Sum"></a>15 3Sum</h3><p><a href="https://leetcode-cn.com/problems/power-of-three/">leetcode link</a></p><p>ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œæˆ–è€…ä½¿ç”¨ log é€†è¿ç®—</p><h3 id="18-4Sum"><a href="#18-4Sum" class="headerlink" title="18 4Sum"></a>18 4Sum</h3><p><a href="https://leetcode-cn.com/problems/power-of-four/">leetcode link</a></p><p>ç±»ä¼¼äº 3sum</p><h3 id="560-Subarray-Sum-Equals-K"><a href="#560-Subarray-Sum-Equals-K" class="headerlink" title="560 Subarray Sum Equals K"></a>560 Subarray Sum Equals K</h3><p><a href="https://leetcode-cn.com/problems/subarray-sum-equals-k/submissions/">leetcode link</a></p><p>å‰ç¼€å’Œ + å“ˆå¸Œè¡¨æŸ¥æ‰¾</p><h2 id="Tree"><a href="#Tree" class="headerlink" title="Tree"></a>Tree</h2><h4 id="95-ä¸åŒçš„äºŒå‰æœç´¢æ ‘-II-MARK-2"><a href="#95-ä¸åŒçš„äºŒå‰æœç´¢æ ‘-II-MARK-2" class="headerlink" title="95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II MARK 2"></a><a href="https://leetcode-cn.com/problems/unique-binary-search-trees-ii/">95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II</a> MARK 2</h4><p>é‡æ–°åšäº†è¿™ä¸€é¢˜ï¼Œæ„Ÿè§‰è¿˜æ˜¯æŒºéš¾çš„ã€‚ä¸€å¼€å§‹å¡åœ¨äº†ä½¿ç”¨æ·±åº¦æœç´¢çš„æ–¹æ³•ä¸Šï¼Œå¦‚ä½•å»ç»´æŠ¤ä¸€ä¸ªæœç´¢çš„è·¯å¾„ï¼Œè¿™å°†ä¼šå˜å¾—æ¯”è¾ƒè‹¦éš¾ã€‚ä¸€æ®µæ—¶é—´è¿‡åæ”¾å¼ƒï¼Œè¿˜æ˜¯é€‰æ‹©ä½¿ç”¨é€’å½’çš„æ–¹æ³•ï¼Œåˆ©ç”¨äºŒå‰æœç´¢æ ‘çš„ç‰¹æ€§ï¼šçŸ¥é“äº†å·¦ä¾§å­æ ‘å’Œå³ä¾§å­æ ‘çš„æ‰€æœ‰äºŒå‰æœç´¢æ ‘ï¼Œå°±èƒ½å¤Ÿé€šè¿‡ä¸¤ä¸¤ç»„åˆè·å¾—æœ€ç»ˆçš„äºŒå‰æœç´¢æ ‘ã€‚è¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯ï¼Œéœ€è¦åœ¨å¾ªç¯ä¹‹å†…åˆ›å»ºæ–°çš„æ ¹èŠ‚ç‚¹ï¼Œæˆ‘ä¸¤æ¬¡éƒ½çŠ¯äº†è¿™ä¸ªé”™è¯¯ï¼Œé‡å¤ä½¿ç”¨äº†æ ¹èŠ‚ç‚¹</p><h4 id="144-äºŒå‰æ ‘çš„å‰åºéå†-MARK-2"><a href="#144-äºŒå‰æ ‘çš„å‰åºéå†-MARK-2" class="headerlink" title="144. äºŒå‰æ ‘çš„å‰åºéå† MARK 2"></a><a href="https://leetcode-cn.com/problems/binary-tree-preorder-traversal/">144. äºŒå‰æ ‘çš„å‰åºéå†</a> MARK 2</h4><p>å‰åºéå†ï¼šæ ¹èŠ‚ç‚¹ï¼Œå·¦ï¼Œå³</p><p>ä¸­åºéå†ï¼šå·¦ï¼Œæ ¹èŠ‚ç‚¹ï¼Œå³</p><p>ååºéå†ï¼šå·¦ï¼Œå³ï¼Œæ ¹èŠ‚ç‚¹</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenPCDet VoxelRCNN</title>
      <link href="/archives/c3e4f95d.html"/>
      <url>/archives/c3e4f95d.html</url>
      
        <content type="html"><![CDATA[<h1 id="Voxel-R-CNN"><a href="#Voxel-R-CNN" class="headerlink" title="Voxel R-CNN"></a>Voxel R-CNN</h1><h2 id="VoxelRCNN"><a href="#VoxelRCNN" class="headerlink" title="VoxelRCNN"></a>VoxelRCNN</h2><p>æ¥çœ‹çœ‹ Voxel R-CNN çš„å®ç°ï¼Œç”±äºé«˜åº¦çš„æŠ½è±¡åŒ–å’Œè‰¯å¥½çš„å°è£…ï¼Œå…¶æ¨¡å‹ä»£ç å’Œ SECOND ç›¸æ¯”ï¼Œä»…å¤šä¸€è¡Œ <code>loss_rcnn, tb_dict = self.roi_head.get_loss(tb_dict)</code> ä¸ roi ç›¸å…³</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">VoxelRCNN</span><span class="token punctuation">(</span>Detector3DTemplate<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_cfg<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>model_cfg<span class="token operator">=</span>model_cfg<span class="token punctuation">,</span> num_class<span class="token operator">=</span>num_class<span class="token punctuation">,</span> dataset<span class="token operator">=</span>dataset<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>module_list <span class="token operator">=</span> self<span class="token punctuation">.</span>build_networks<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> cur_module <span class="token keyword">in</span> self<span class="token punctuation">.</span>module_list<span class="token punctuation">:</span>            batch_dict <span class="token operator">=</span> cur_module<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>            loss<span class="token punctuation">,</span> tb_dict<span class="token punctuation">,</span> disp_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>get_training_loss<span class="token punctuation">(</span><span class="token punctuation">)</span>            ret_dict <span class="token operator">=</span> <span class="token punctuation">{</span>                <span class="token string">'loss'</span><span class="token punctuation">:</span> loss            <span class="token punctuation">}</span>            <span class="token keyword">return</span> ret_dict<span class="token punctuation">,</span> tb_dict<span class="token punctuation">,</span> disp_dict        <span class="token keyword">else</span><span class="token punctuation">:</span>            pred_dicts<span class="token punctuation">,</span> recall_dicts <span class="token operator">=</span> self<span class="token punctuation">.</span>post_processing<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>            <span class="token keyword">return</span> pred_dicts<span class="token punctuation">,</span> recall_dicts    <span class="token keyword">def</span> <span class="token function">get_training_loss</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        disp_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        loss <span class="token operator">=</span> <span class="token number">0</span>                loss_rpn<span class="token punctuation">,</span> tb_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>dense_head<span class="token punctuation">.</span>get_loss<span class="token punctuation">(</span><span class="token punctuation">)</span>        loss_rcnn<span class="token punctuation">,</span> tb_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>roi_head<span class="token punctuation">.</span>get_loss<span class="token punctuation">(</span>tb_dict<span class="token punctuation">)</span>        loss <span class="token operator">=</span> loss <span class="token operator">+</span> loss_rpn <span class="token operator">+</span> loss_rcnn        <span class="token keyword">return</span> loss<span class="token punctuation">,</span> tb_dict<span class="token punctuation">,</span> disp_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="MeanVFE-VFE"><a href="#MeanVFE-VFE" class="headerlink" title="MeanVFE (VFE)"></a>MeanVFE (VFE)</h2><p>å°†ä½“ç´ ä¸­æ¯ä¸ªç‚¹çš„ç‰¹å¾è¿›è¡Œå¹³å‡ï¼Œbatch_dict æ·»åŠ äº† vfe_features å…³é”®å­—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_dict<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token string">""</span>"    Args<span class="token punctuation">:</span>        batch_dict<span class="token punctuation">:</span>            voxels<span class="token punctuation">:</span> <span class="token punctuation">(</span>num_voxels<span class="token punctuation">,</span> max_points_per_voxel<span class="token punctuation">,</span> C<span class="token punctuation">)</span>            voxel_num_points<span class="token punctuation">:</span> optional <span class="token punctuation">(</span>num_voxels<span class="token punctuation">)</span>        <span class="token operator">**</span>kwargs<span class="token punctuation">:</span>    Returns<span class="token punctuation">:</span>        vfe_features<span class="token punctuation">:</span> <span class="token punctuation">(</span>num_voxels<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="VoxelBackBone8x-BACKBONE-3D"><a href="#VoxelBackBone8x-BACKBONE-3D" class="headerlink" title="VoxelBackBone8x (BACKBONE_3D)"></a>VoxelBackBone8x (BACKBONE_3D)</h2><h3 id="Spconv"><a href="#Spconv" class="headerlink" title="Spconv"></a>Spconv</h3><p>é¦–å…ˆæ€»ç»“ä¸€ä¸‹ spconv1.2 çš„æ“ä½œé€»è¾‘</p><ol><li><p>ç”Ÿæˆ <code>SparseConvTensor</code> </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> spconvfeatures <span class="token operator">=</span> <span class="token comment"># [N, num_channels]</span>indices <span class="token operator">=</span> <span class="token comment"># your indices/coordinates with shape [N, ndim + 1] (in 3D ndim=3), batch index must be put in indices[:, 0]</span>spatial_shape <span class="token operator">=</span> <span class="token comment"># spatial shape of your sparse tensor, (in 3D its shape=[3]) .</span>batch_size <span class="token operator">=</span> <span class="token comment"># batch size of your sparse tensor.</span>x <span class="token operator">=</span> spconv<span class="token punctuation">.</span>SparseConvTensor<span class="token punctuation">(</span>features<span class="token punctuation">,</span> indices<span class="token punctuation">,</span> spatial_shape<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åƒ Pytorch ä¸€æ ·ä½¿ç”¨å·ç§¯ï¼Œå¸¸ç”¨ä¸¤ç§å·ç§¯ <code>SparseConv3d &amp; SubMconv3d</code>ï¼Œå¸¸ç”¨ä¸€ä¸ªå®¹å™¨æ¨¡å— <code>spconv.SparseSequential</code>ï¼Œ<code>indice_key</code> å¯ä»¥ç”¨äºèŠ‚çœç›¸åŒå½¢çŠ¶/ç›¸åŒç´¢å¼•çš„ç¨€ç–å·ç§¯å±‚å»ºç«‹æ—¶é—´</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>net <span class="token operator">=</span> spconv<span class="token punctuation">.</span>SparseSequential<span class="token punctuation">(</span>            spconv<span class="token punctuation">.</span>SparseConv3d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># just like nn.Conv3d but don't support group</span>            nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># non-spatial layers can be used directly in SparseSequential.</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            spconv<span class="token punctuation">.</span>SubMConv3d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> indice_key<span class="token operator">=</span><span class="token string">"subm0"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment"># when use submanifold convolutions, their indices can be shared to save indices generation time.</span>            spconv<span class="token punctuation">.</span>SubMConv3d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> indice_key<span class="token operator">=</span><span class="token string">"subm0"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            spconv<span class="token punctuation">.</span>SparseConvTranspose3d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            spconv<span class="token punctuation">.</span>ToDense<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># convert spconv tensor to dense and convert it to NCHW format.</span>            nn<span class="token punctuation">.</span>Conv3d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å°† <code>SparseConvTensor</code> è½¬å˜ä¸ºæ­£å¸¸çš„ dense tensor</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x_dense_NCHW <span class="token operator">=</span> x<span class="token punctuation">.</span>dense<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># convert sparse tensor to dense (N,C,D,H,W) tensor.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h3 id="VoxelBackBone8x"><a href="#VoxelBackBone8x" class="headerlink" title="VoxelBackBone8x"></a>VoxelBackBone8x</h3><p>è¿™éƒ¨åˆ†ç›´æ¥çœ‹å‰å‘æ–¹ç¨‹ä¼šæœ‰æ›´ç›´è§‚çš„ç†è§£ï¼Œæœ€ç»ˆè¿”å›äº†ä¸€ä¸ªå­—å…¸ï¼Œä¸ä»…åŒ…å«äº†è¾“å‡ºçš„ç‰¹å¾å›¾è°±ï¼Œè¿˜æœ‰åœ¨å·ç§¯è¿‡ç¨‹ä¸­æ¯ä¸€ä¸ªåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾è°±ä¹Ÿä¿å­˜ä¸‹æ¥äº† <code>encoded_spconv_tensor &amp; multi_scale_3d_features</code>ï¼Œå·ç§¯å±‚çš„å…·ä½“è®¾ç½®è¯·ç›´æ¥çœ‹æºç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        batch_dict:            batch_size: int            vfe_features: (num_voxels, C)            voxel_coords: (num_voxels, 4), [batch_idx, z_idx, y_idx, x_idx]    Returns:        batch_dict:            - encoded_spconv_tensor: sparse tensor                To be exact: in KITTI, spatial shape is [200, 176, 2], channel num is 128                But haven't converted to dense format yet            - encoded_spconv_tensor_stride            - multi_scale_3d_features            - multi_scale_3d_strides    """</span>    voxel_features<span class="token punctuation">,</span> voxel_coords <span class="token operator">=</span> batch_dict<span class="token punctuation">[</span><span class="token string">'voxel_features'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> batch_dict<span class="token punctuation">[</span><span class="token string">'voxel_coords'</span><span class="token punctuation">]</span>    batch_size <span class="token operator">=</span> batch_dict<span class="token punctuation">[</span><span class="token string">'batch_size'</span><span class="token punctuation">]</span>    input_sp_tensor <span class="token operator">=</span> spconv<span class="token punctuation">.</span>SparseConvTensor<span class="token punctuation">(</span>        features<span class="token operator">=</span>voxel_features<span class="token punctuation">,</span>        indices<span class="token operator">=</span>voxel_coords<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        spatial_shape<span class="token operator">=</span>self<span class="token punctuation">.</span>sparse_shape<span class="token punctuation">,</span>        batch_size<span class="token operator">=</span>batch_size    <span class="token punctuation">)</span>    x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv_input<span class="token punctuation">(</span>input_sp_tensor<span class="token punctuation">)</span>    x_conv1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>    x_conv2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x_conv1<span class="token punctuation">)</span>    x_conv3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x_conv2<span class="token punctuation">)</span>    x_conv4 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>x_conv3<span class="token punctuation">)</span>    <span class="token comment"># for detection head</span>    <span class="token comment"># [200, 176, 5] -&gt; [200, 176, 2]</span>    out <span class="token operator">=</span> self<span class="token punctuation">.</span>conv_out<span class="token punctuation">(</span>x_conv4<span class="token punctuation">)</span>    batch_dict<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token string">'encoded_spconv_tensor'</span><span class="token punctuation">:</span> out<span class="token punctuation">,</span>        <span class="token string">'encoded_spconv_tensor_stride'</span><span class="token punctuation">:</span> <span class="token number">8</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    batch_dict<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token string">'multi_scale_3d_features'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>            <span class="token string">'x_conv1'</span><span class="token punctuation">:</span> x_conv1<span class="token punctuation">,</span>            <span class="token string">'x_conv2'</span><span class="token punctuation">:</span> x_conv2<span class="token punctuation">,</span>            <span class="token string">'x_conv3'</span><span class="token punctuation">:</span> x_conv3<span class="token punctuation">,</span>            <span class="token string">'x_conv4'</span><span class="token punctuation">:</span> x_conv4<span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    batch_dict<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token string">'multi_scale_3d_strides'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>            <span class="token string">'x_conv1'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token string">'x_conv2'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token string">'x_conv3'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>            <span class="token string">'x_conv4'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> batch_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°ä»£ç åº“é‡Œå®ç°äº†æ®‹å·®æ¨¡å— <code>VoxelResBackBone8x</code>ï¼Œä½†æ˜¯åœ¨è®ºæ–‡å½“ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨æ®‹å·®ç½‘ç»œ</p><h2 id="HeightCompression-MAP-TO-BEV"><a href="#HeightCompression-MAP-TO-BEV" class="headerlink" title="HeightCompression (MAP_TO_BEV)"></a>HeightCompression (MAP_TO_BEV)</h2><p>è¿™éƒ¨åˆ†å°±æ˜¯å°† <code>SparseConvTensor</code> è½¬ä¸º dense tensor å¹¶å°†é«˜åº¦çš„ç‰¹å¾å †å </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        batch_dict:            encoded_spconv_tensor: sparse tensor    Returns:        batch_dict:            - spatial_features: shape is (N, C * D, H, W)            - spatial_feature_stride: encoded_spconv_tensor_stride    """</span>    encoded_spconv_tensor <span class="token operator">=</span> batch_dict<span class="token punctuation">[</span><span class="token string">'encoded_spconv_tensor'</span><span class="token punctuation">]</span>    spatial_features <span class="token operator">=</span> encoded_spconv_tensor<span class="token punctuation">.</span>dense<span class="token punctuation">(</span><span class="token punctuation">)</span>    N<span class="token punctuation">,</span> C<span class="token punctuation">,</span> D<span class="token punctuation">,</span> H<span class="token punctuation">,</span> W <span class="token operator">=</span> spatial_features<span class="token punctuation">.</span>shape    spatial_features <span class="token operator">=</span> spatial_features<span class="token punctuation">.</span>view<span class="token punctuation">(</span>N<span class="token punctuation">,</span> C <span class="token operator">*</span> D<span class="token punctuation">,</span> H<span class="token punctuation">,</span> W<span class="token punctuation">)</span>    batch_dict<span class="token punctuation">[</span><span class="token string">'spatial_features'</span><span class="token punctuation">]</span> <span class="token operator">=</span> spatial_features    batch_dict<span class="token punctuation">[</span><span class="token string">'spatial_features_stride'</span><span class="token punctuation">]</span> <span class="token operator">=</span> batch_dict<span class="token punctuation">[</span><span class="token string">'encoded_spconv_tensor_stride'</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> batch_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="BaseBEVBackbone-BACKBONE-2D"><a href="#BaseBEVBackbone-BACKBONE-2D" class="headerlink" title="BaseBEVBackbone (BACKBONE_2D)"></a>BaseBEVBackbone (BACKBONE_2D)</h2><p>æ¥ä¸‹æ¥è¿›å…¥ 2D å·ç§¯ç½‘ç»œï¼Œå¯¹ <code>encoded_spconv_tensor</code> è¿›è¡Œç‰¹å¾æå–ï¼Œè¿™é‡Œç”¨é…ç½®æ–‡ä»¶è¿›è¡Œè¯´æ˜æ¯”è¾ƒæ–¹ä¾¿</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">BACKBONE_2D</span><span class="token punctuation">:</span>    <span class="token key atrule">NAME</span><span class="token punctuation">:</span> BaseBEVBackbone    <span class="token comment"># 5 convolution layers, input channel == output channel == num_filters[idx], stride = 1</span>    <span class="token key atrule">LAYER_NUMS</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>    <span class="token key atrule">LAYER_STRIDES</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>    <span class="token key atrule">NUM_FILTERS</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">]</span>    <span class="token key atrule">UPSAMPLE_STRIDES</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>    <span class="token key atrule">NUM_UPSAMPLE_FILTERS</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨äº†ä¸¤ä¸ªå·ç§¯å—ï¼Œæ¯ä¸ªå·ç§¯å—ç”± (5 + 1) ä¸ªå·ç§¯å±‚ç»„æˆï¼Œ+1 ä»£è¡¨çš„å·ç§¯å±‚ç”¨äºé€šé“æ•°çš„è½¬æ¢ï¼Œä¸¤ä¸ªå·ç§¯å—æœ‰ä¸åŒçš„ stride ä»¥è·å¾—ä¸åŒåˆ†è¾¨ç‡ã€‚ä¹‹åä½¿ç”¨ä¸Šé‡‡æ ·å°†ä¸¤ä¸ªä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾è°±è½¬æ¢æˆç›¸åŒçš„ç‰¹å¾å›¾è°±ï¼Œç„¶åå°†äºŒè€…è¿›è¡Œé€šé“è¿æ¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        data_dict:            spatial_features: shape is (N, C * D, H, W)    Returns:        data_dict: spatial_features_2d (N, channels, H, W)    """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="AnchorHeadSingle-DENSE-HEAD"><a href="#AnchorHeadSingle-DENSE-HEAD" class="headerlink" title="AnchorHeadSingle (DENSE_HEAD)"></a>AnchorHeadSingle (DENSE_HEAD)</h2><p>è¿™å°†ä¼šæ¯”è¾ƒå¤æ‚çš„éƒ¨åˆ†ã€‚anchor ç”Ÿæˆï¼Œtarget åˆ†é…ï¼ŒæŸå¤±å‡½æ•°çš„è®¡ç®—ï¼Œé¢„æµ‹ç»“æœï¼Œéƒ½å°†åœ¨è¿™ä¸ª <code>DENSE_HEAD</code> ä¸­å®Œæˆã€‚è¯¥ç±»çš„å®ç°ä¹Ÿæ˜¯æœ‰åŸºç±»çš„ <code>AnchorHeadTemplate</code></p><h3 id="AnchorHeadTemplate"><a href="#AnchorHeadTemplate" class="headerlink" title="AnchorHeadTemplate"></a>AnchorHeadTemplate</h3><p>è¿™ä¸ªåŸºç±»åŠŸèƒ½ä¹Ÿéå¸¸å¤šï¼Œæˆ‘æš‚ä¸”æŠŠå®ƒçš„åŠŸèƒ½åˆ†ä¸ºä¸¤å¤§ç±»ï¼šanchor ç›¸å…³å’Œ loss ç›¸å…³</p><h4 id="Anchor-ç›¸å…³"><a href="#Anchor-ç›¸å…³" class="headerlink" title="Anchor ç›¸å…³"></a>Anchor ç›¸å…³</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">AnchorHeadTemplate</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_cfg<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> class_names<span class="token punctuation">,</span> grid_size<span class="token punctuation">,</span> point_cloud_range<span class="token punctuation">,</span> predict_boxes_when_training<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Attributes:        - self.anchors            - self.box_coder            - self.target_assigner            - self.forward_ret_dict        """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p><code>anchors</code>ï¼šä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªæˆå‘˜å¯¹ä¸€ä¸ªç±»åˆ«ï¼Œä¸€èˆ¬æˆå‘˜çš„å¼ é‡å½¢çŠ¶éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ<code>anchors[0].shape = (z, y, x, num_anchor_size, num_anchor_rotation, 7)</code>ï¼Œanchors çš„ç”Ÿæˆå°±ä¸è¿‡å¤šä»‹ç»äº†</p></li><li><p><code>box_encoder</code>ï¼šå¯ä»¥çœ‹ä½œç”Ÿæˆå›å½’ç›®æ ‡çš„ç±»ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ï¼šè¾“å…¥ anchors å’Œ gt_boxesï¼Œå°†è¿”å›äºŒè€…çš„æ®‹å·®ï¼›è¾“å…¥æ®‹å·®å’Œ anchors è¿”å›çœŸå®çš„ boxes</p></li><li><p><code>target_assigner</code>ï¼šå…¶ <code>assign_targets</code> æ–¹æ³•è¿”å›ä¸€ä¸ªå­—å…¸</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">all_targets_dict <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'box_cls_labels'</span><span class="token punctuation">:</span> cls_labels<span class="token punctuation">,</span>   <span class="token comment"># shape is (4, 211200) in KITTI, bg box is 0, fg box is int like (1, 2, 3)</span>    <span class="token comment"># those don't care is -1</span>            <span class="token string">'box_reg_targets'</span><span class="token punctuation">:</span> bbox_targets<span class="token punctuation">,</span>    <span class="token comment"># (4, 211200, 7) to be exact, (4, 200*176*2*3, 7)</span>            <span class="token string">'reg_weights'</span><span class="token punctuation">:</span> reg_weights<span class="token comment"># 1 or 1 / positive_anchors (if normalize), negative anchors are 0</span>    <span class="token comment"># regression weights åœ¨ä¹‹åä¼¼ä¹å¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œè€Œæ˜¯ç›´æ¥ä» cls_label é‡Œè¿›è¡Œåˆ¤æ–­</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‘ç°è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ $sin(\Delta \theta)$ å¯¹ target è¿›è¡Œç¼–ç ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ $\Delta \theta$ è¡¨ç¤ºæ–¹å‘æ®‹å·®ï¼Œä¹‹åå•ç‹¬ç”¨ <code>add_sin_difference</code> å¤„ç†ã€‚assign targets æ˜¯<strong>åˆ†æ‰¹åˆ†ç±»</strong>è¿›è¡Œå¤„ç†çš„ï¼Œè¿™é‡Œè´´ä¸€ä¸‹å…¶ä¸­çš„æ ¸å¿ƒä»£ç ï¼Œäº†è§£å¤„ç†ä¸€ä¸ª sample ä¸€ä¸ªç±»è¯¥æ€ä¹ˆåšï¼Œå› ä¸ºåˆ¶ä½œ targets çš„è¿‡ç¨‹æ¯”è¾ƒç»†ï¼Œä¸å¥½å¥½çœ‹ä¸€ä¸‹çœŸçš„ä¸æ¸…æ™°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">labels <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>num_anchors<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>int32<span class="token punctuation">,</span> device<span class="token operator">=</span>anchors<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span>gt_ids <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>num_anchors<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>int32<span class="token punctuation">,</span> device<span class="token operator">=</span>anchors<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token operator">-</span><span class="token number">1</span><span class="token comment"># è¿”å›ä¸ gt é‡å æœ€å¤§çš„ anchor index ä¸€èˆ¬å½¢çŠ¶ä¸º (num_gt,)</span>anchors_with_max_overlap <span class="token operator">=</span> <span class="token punctuation">(</span>anchor_by_gt_overlap <span class="token operator">==</span> gt_to_anchor_max<span class="token punctuation">)</span><span class="token punctuation">.</span>nonzero<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token comment"># è¿”å›è¢«é€‰ä¸­çš„ gt index, anchor_to_gt_argmax.shape = (num_anchors,)</span>gt_inds_force <span class="token operator">=</span> anchor_to_gt_argmax<span class="token punctuation">[</span>anchors_with_max_overlap<span class="token punctuation">]</span><span class="token comment"># æ ‡è®° max_overlap anchor å¹¶è®°å½•å…¶ gt index</span>labels<span class="token punctuation">[</span>anchors_with_max_overlap<span class="token punctuation">]</span> <span class="token operator">=</span> gt_classes<span class="token punctuation">[</span>gt_inds_force<span class="token punctuation">]</span>gt_ids<span class="token punctuation">[</span>anchors_with_max_overlap<span class="token punctuation">]</span> <span class="token operator">=</span> gt_inds_force<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># éœ€è¦æ³¨æ„çš„æ˜¯ positive anchor ä¸ anchors_with_max_overlap æ˜¯ä¸¤ä¸ªä¸åŒçš„é›†åˆ</span>pos_inds <span class="token operator">=</span> anchor_to_gt_max <span class="token operator">&gt;=</span> matched_thresholdgt_inds_over_thresh <span class="token operator">=</span> anchor_to_gt_argmax<span class="token punctuation">[</span>pos_inds<span class="token punctuation">]</span><span class="token comment"># æ ‡è®° positive anchor å¹¶è®°å½•å…¶ gt index</span>labels<span class="token punctuation">[</span>pos_inds<span class="token punctuation">]</span> <span class="token operator">=</span> gt_classes<span class="token punctuation">[</span>gt_inds_over_thresh<span class="token punctuation">]</span>gt_ids<span class="token punctuation">[</span>pos_inds<span class="token punctuation">]</span> <span class="token operator">=</span> gt_inds_over_thresh<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># éœ€è¦æ³¨æ„çš„æ˜¯ negative thres å’Œ positive thres ä¹‹é—´æ˜¯æœ‰é—´éš™çš„ï¼ŒäºŒè€…ä¸ç›¸ç­‰</span>bg_inds <span class="token operator">=</span> <span class="token punctuation">(</span>anchor_to_gt_max <span class="token operator">&lt;</span> unmatched_threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>nonzero<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token comment"># æ ‡è®° background anchor</span>labels<span class="token punctuation">[</span>bg_inds<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token comment"># ç»¼ä¸Š fg_inds æ˜¯ positive_inds | anchors_with_max_overlap - bg_inds</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é‡è¦çš„æ€»ç»“å†è¯´ä¸€éï¼šç»¼ä¸Š <code>fg_inds</code> æ˜¯ <code>positive_inds | anchors_with_max_overlap - bg_inds</code></strong></p></li><li><p><code>forward_ret_dict</code>: è™½ç„¶è¿™æ˜¯ä¸ loss ç›¸å…³çš„éƒ¨åˆ†ï¼Œæš‚ä¸”å…ˆæ”¾åœ¨è¿™é‡Œã€‚è¯¥å­—å…¸å­˜å‚¨å‘å‰ä¼ æ’­ä¸­çš„é¢„æµ‹ç»“æœåŠå…¶æ ‡ç­¾ï¼Œç”¨äºä¹‹åè®¡ç®— loss</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">cls_predsbox_predsdir_cls_predsbox_cls_labelsbox_reg_targetsreg_weights<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="Loss-ç›¸å…³"><a href="#Loss-ç›¸å…³" class="headerlink" title="Loss ç›¸å…³"></a>Loss ç›¸å…³</h4><p>æœ‰äº† anchor å’Œå¯¹åº”çš„ target è¿˜éœ€è¦é¢„æµ‹ç»“æœ prediction æ‰èƒ½å¤Ÿè®¡ç®—ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šé¢„æµ‹çš„ç»“æœæ˜¯é€‰æ¡†æ®‹å·®ï¼Œè¿˜éœ€è¦ <code>generate_predicted_boxes</code> äº§ç”Ÿå®é™…çš„é€‰æ¡†ç»“æœã€‚</p><p><code>get_loss</code> å°†è·å¾—æ¯ä¸ª batch çš„æŸå¤±å‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œloss ç›¸å…³çš„æ–¹æ³•ä¸€èˆ¬ä¸ä¼šåœ¨ AnchorHeadSingle çš„å‰å‘æ–¹ç¨‹ä¸­ä½¿ç”¨ï¼Œ<strong>è€Œæ˜¯åœ¨æ€»æ¨¡å‹çš„å‰å‘æ–¹ç¨‹ä¸­è°ƒç”¨ï¼ˆå³ï¼šåœ¨ VoxelRCNN ç±»ä¸­ï¼‰</strong>ã€‚ä¸‹é¢å…·ä½“çœ‹çœ‹å…¶ç»„æˆå†…å®¹ï¼Œä¹Ÿä¸åšç»†èŠ‚äº†è§£</p><ol><li><p><code>get_loss</code> å°†è¿”å›åˆ†ç±»æŸå¤±å’Œå›å½’æŸå¤±ï¼Œå…¶ä¸­æ–¹å‘åˆ†ç±»æŸå¤±æ˜¯åœ¨å›å½’æŸå¤±ä¸­è®¡ç®—çš„ã€‚<code>get_loss</code> çš„è°ƒç”¨ä¸€èˆ¬æ˜¯åœ¨æ¨¡å‹çš„ <code>get_training_loss</code> ä¸­ï¼Œè¯·æŸ¥çœ‹è¯¥ç¬”è®°ä¹‹å‰è®°å½•çš„ <code>SECOND</code> éƒ¨åˆ†ä¸­çš„ <code>forward</code> ä»£ç  </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_loss</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># è·å¾—åˆ†ç±»æŸå¤± (batch, num_anchors_all)</span>    cls_loss<span class="token punctuation">,</span> tb_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>get_cls_layer_loss<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># è·å¾—å›å½’æŸå¤±</span>    box_loss<span class="token punctuation">,</span> tb_dict_box <span class="token operator">=</span> self<span class="token punctuation">.</span>get_box_reg_layer_loss<span class="token punctuation">(</span><span class="token punctuation">)</span>    tb_dict<span class="token punctuation">.</span>update<span class="token punctuation">(</span>tb_dict_box<span class="token punctuation">)</span>    rpn_loss <span class="token operator">=</span> cls_loss <span class="token operator">+</span> box_loss    tb_dict<span class="token punctuation">[</span><span class="token string">'rpn_loss'</span><span class="token punctuation">]</span> <span class="token operator">=</span> rpn_loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> rpn_loss<span class="token punctuation">,</span> tb_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯å­¦ä¹ çš„æŠ€å·§ï¼šä½¿ç”¨ weight æ¥è¿›è¡Œç­›é€‰ï¼Œå› ä¸ºåœ¨å¹¶è¡Œè¿ç®—çš„æƒ…å†µä¸‹ï¼Œä¹˜æ³•æ¯”ç´¢å¼•ç­›é€‰æ›´å¿«</p></li><li><p><code>generate_predicted_boxes</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_predicted_boxes</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> cls_preds<span class="token punctuation">,</span> box_preds<span class="token punctuation">,</span> dir_cls_preds<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token triple-quoted-string string">"""   Args:       batch_size:       cls_preds: (N, H, W, C1)       box_preds: (N, H, W, C2)       dir_cls_preds: (N, H, W, C3)      Returns:       batch_cls_preds: (B, num_boxes, num_classes)       batch_box_preds: (B, num_boxes, 7+C)   """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸º target æ˜¯æ®‹å·®ï¼Œæ‰€ä»¥åœ¨é¢„æµ‹äº†ç»“æœè¿‡åéœ€è¦ <code>box_coder</code> è¿›è¡Œè§£ç ï¼Œå˜ä¸ºçœŸå®çš„ box</p></li></ol><h3 id="AnchorHeadSingle"><a href="#AnchorHeadSingle" class="headerlink" title="AnchorHeadSingle"></a>AnchorHeadSingle</h3><p>æœ‰äº†åŸºç±»çš„åŠŸèƒ½ï¼Œ<code>AnchorHeadSingle</code> å°±å¯ä»¥æŠŠä¸­å¿ƒæ”¾åœ¨ç½‘ç»œçš„æ­å»ºä¹‹ä¸Šäº†ï¼Œæ¨¡å—åœ¨ <code>__init__</code> ä¸­å®šä¹‰äº†ä¸‰ä¸ªå·ç§¯å±‚ï¼š<code>conv_cls &amp; conv_box &amp; conv_dir_cls</code> åˆ†åˆ«å¯¹ç±»åˆ«ï¼Œbboxï¼Œæœå‘è¿›è¡Œé¢„æµ‹ï¼Œæ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰å…¨è¿æ¥å±‚çš„å­˜åœ¨ï¼Œç›´æ¥æŠŠå„ä¸ª channel ä¸­çš„ç»“æœä½œä¸ºé¢„æµ‹ç»“æœã€‚è·å¾—é¢„æµ‹ç»“æœè¿‡åï¼š</p><ol><li>å¦‚æœæ˜¯å•é˜¶æ®µæ£€æµ‹å™¨åŸºæœ¬å‰å‘æ–¹ç¨‹å°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥å›åˆ° <code>Detector</code> æ¨¡å—ä¸­è®¡ç®—æŸå¤±å‡½æ•°ã€‚å¦‚æœæ˜¯æµ‹è¯•é˜¶æ®µï¼Œéœ€è¦å°†é¢„æµ‹ç»“æœè¿›ä¸€æ­¥ç”Ÿæˆæœ€ç»ˆé€‰æ¡†ï¼ˆå› ä¸ºé¢„æµ‹çš„ç»“æœæ˜¯æ®‹å·®ï¼‰ï¼Œç„¶åè¿›è¡Œ NMS åå¤„ç†</li><li>å¦‚æœæ˜¯ä¸¤é˜¶æ®µæ£€æµ‹å™¨ï¼Œä¹Ÿæ˜¯å°†é¢„æµ‹ç»“æœè¿›ä¸€æ­¥ç”Ÿæˆé€‰æ¡†ï¼Œç„¶åç»§ç»­å‘å‰è®¡ç®—</li></ol><h4 id="forward"><a href="#forward" class="headerlink" title="forward"></a>forward</h4><p>ä¸‹é¢æ¥çœ‹çœ‹å‰å‘æ–¹ç¨‹ï¼Œæœ‰ä¸€ä¸ªå…·ä½“æ„Ÿå—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># è·å¾— BEV ç‰¹å¾å›¾è°±</span>    spatial_features_2d <span class="token operator">=</span> data_dict<span class="token punctuation">[</span><span class="token string">'spatial_features_2d'</span><span class="token punctuation">]</span>    <span class="token comment"># åˆ†ç±»å’Œå›å½’å›¾è°±</span>    cls_preds <span class="token operator">=</span> self<span class="token punctuation">.</span>conv_cls<span class="token punctuation">(</span>spatial_features_2d<span class="token punctuation">)</span>    box_preds <span class="token operator">=</span> self<span class="token punctuation">.</span>conv_box<span class="token punctuation">(</span>spatial_features_2d<span class="token punctuation">)</span>    <span class="token comment"># æŠŠ channel ç§»åŠ¨åˆ°æœ€åä¸€ä¸ªç»´åº¦ï¼Œä¾¿äºä¹‹åè®¡ç®—æŸå¤±å‡½æ•°</span>    cls_preds <span class="token operator">=</span> cls_preds<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># [N, H, W, C]</span>    box_preds <span class="token operator">=</span> box_preds<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># [N, H, W, C]</span>    self<span class="token punctuation">.</span>forward_ret_dict<span class="token punctuation">[</span><span class="token string">'cls_preds'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cls_preds    self<span class="token punctuation">.</span>forward_ret_dict<span class="token punctuation">[</span><span class="token string">'box_preds'</span><span class="token punctuation">]</span> <span class="token operator">=</span> box_preds    <span class="token comment"># æ–¹å‘åˆ†ç±»å›¾è°±</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>conv_dir_cls <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        dir_cls_preds <span class="token operator">=</span> self<span class="token punctuation">.</span>conv_dir_cls<span class="token punctuation">(</span>spatial_features_2d<span class="token punctuation">)</span>        dir_cls_preds <span class="token operator">=</span> dir_cls_preds<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>forward_ret_dict<span class="token punctuation">[</span><span class="token string">'dir_cls_preds'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dir_cls_preds    <span class="token keyword">else</span><span class="token punctuation">:</span>        dir_cls_preds <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token comment"># targets_dict è¿”å›å€¼åœ¨ anchor ç›¸å…³éƒ¨åˆ†é‡Œ</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>        targets_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>assign_targets<span class="token punctuation">(</span>            gt_boxes<span class="token operator">=</span>data_dict<span class="token punctuation">[</span><span class="token string">'gt_boxes'</span><span class="token punctuation">]</span>        <span class="token punctuation">)</span>        self<span class="token punctuation">.</span>forward_ret_dict<span class="token punctuation">.</span>update<span class="token punctuation">(</span>targets_dict<span class="token punctuation">)</span>    <span class="token comment"># å¦‚æœæ˜¯æµ‹è¯•æˆ–è€…æ˜¯ä¸¤é˜¶æ®µæ£€æµ‹å™¨ï¼Œåˆ™éœ€è¦ç”Ÿæˆé€‰æ¡†é¢„æµ‹</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>training <span class="token keyword">or</span> self<span class="token punctuation">.</span>predict_boxes_when_training<span class="token punctuation">:</span>        batch_cls_preds<span class="token punctuation">,</span> batch_box_preds <span class="token operator">=</span> self<span class="token punctuation">.</span>generate_predicted_boxes<span class="token punctuation">(</span>            batch_size<span class="token operator">=</span>data_dict<span class="token punctuation">[</span><span class="token string">'batch_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            cls_preds<span class="token operator">=</span>cls_preds<span class="token punctuation">,</span> box_preds<span class="token operator">=</span>box_preds<span class="token punctuation">,</span> dir_cls_preds<span class="token operator">=</span>dir_cls_preds        <span class="token punctuation">)</span>        data_dict<span class="token punctuation">[</span><span class="token string">'batch_cls_preds'</span><span class="token punctuation">]</span> <span class="token operator">=</span> batch_cls_preds        data_dict<span class="token punctuation">[</span><span class="token string">'batch_box_preds'</span><span class="token punctuation">]</span> <span class="token operator">=</span> batch_box_preds        data_dict<span class="token punctuation">[</span><span class="token string">'cls_preds_normalized'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">return</span> data_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="VoxelRCNNHead-ROI-HEAD"><a href="#VoxelRCNNHead-ROI-HEAD" class="headerlink" title="VoxelRCNNHead (ROI_HEAD)"></a>VoxelRCNNHead (ROI_HEAD)</h2><p>ä»é…ç½®æ–‡ä»¶çœ‹ï¼Œè¿™ä¸€éƒ¨åˆ†ä¹Ÿæ˜¯æœ€å¤æ‚çš„ã€‚ä¸è¿‡ä¸è¦æ‹…å¿ƒï¼Œæœ‰äº†è¶³å¤Ÿçš„ç†è®ºçŸ¥è¯†å’Œå¯¹ä¹‹å‰ä»£ç çš„è§£è¯»ï¼Œå’±ä¹Ÿèƒ½å¤§è‡´æŒæ¡å…¶ä¸­çš„é‡è¦çš„æµç¨‹ğŸ¤¨å…ˆæ¥çœ‹åŸºç±» <code>RoIHeadTemplate</code> å®ç°</p><h3 id="RoIHeadTemplate"><a href="#RoIHeadTemplate" class="headerlink" title="RoIHeadTemplate"></a>RoIHeadTemplate</h3><p>è¿˜æ˜¯æŒ‰ç…§ä¹‹å‰ AnchorHeadTemplate çš„æ€»ç»“æ–¹å¼ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼šproposal ç›¸å…³å’Œ loss ç›¸å…³</p><h4 id="Proposal-ç›¸å…³"><a href="#Proposal-ç›¸å…³" class="headerlink" title="Proposal ç›¸å…³"></a>Proposal ç›¸å…³</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">RoIHeadTemplate</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> model_cfg<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Attribute:            - self.box_coder: ResidualCoder            - self.proposal_target_layer            - self.forward_ret_dict        """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šæ˜¯åˆå§‹åŒ–å‡½æ•°ï¼š</p><ol><li><code>box_coder</code> å’Œä¹‹å‰çš„æ˜¯ä¸€æ ·çš„ <code>ResidualCoder</code></li><li>æ¯”è¾ƒé‡è¦çš„æ˜¯ <code>proposal_target_layer</code>ï¼Œè¿™éƒ¨åˆ†å¯¹åº”çš„é…ç½®æ˜¯ <code>TARGET_CONFIG</code>ï¼Œå…¶åŠŸèƒ½æ˜¯å¯¹ NMS ç­›é€‰è¿‡åçš„ proposalï¼ˆæ­¤æ—¶åº”è¯¥å« roisï¼‰è¿›è¡Œé‡‡æ ·å¹¶åˆ¶ä½œå…¶æ ‡ç­¾</li><li><code>forward_ret_dict</code> ç”¨äºå­˜å‚¨å‘å‰ä¼ æ’­ä¸­çš„é¢„æµ‹ç»“æœåŠå…¶æ ‡ç­¾ï¼Œç”¨äºä¹‹åè®¡ç®— loss</li></ol><p>ä¸‹é¢è¿›è¡Œè¿›ä¸€æ­¥ä»‹ç» <code>RoIHeadTemplate</code> çš„ç›¸å…³æ–¹æ³•ï¼š</p><ol><li><code>proposal_layer</code> æ–¹æ³•ã€‚ä½¿ç”¨ NMSï¼Œï¼ˆé€šå¸¸ï¼‰è¿”å› 512 ä¸ª roisï¼ˆä¸è¶³çš„ç”¨0å¡«ä¸Šï¼‰</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        batch_dict:            batch_size:            rois: (B, num_rois, 7 + C)            roi_scores: (B, num_rois)            gt_boxes: (B, N, 7 + C + 1)            roi_labels: (B, num_rois)    Returns:        batch_dict:            rois: (B, M, 7 + C)            gt_of_rois: (B, M, 7 + C)            gt_iou_of_rois: (B, M)            roi_scores: (B, M)            roi_labels: (B, M) cls-based label            reg_valid_mask: (B, M) positive bbox            rcnn_cls_labels: (B, M) iou-based label    """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p><code>assign_targets</code> æ–¹æ³•ã€‚é€šå¸¸åœ¨è°ƒç”¨ <code>proposal_layer</code> æ–¹æ³•åä½¿ç”¨ï¼Œè¯¥æ–¹æ³•å®Œæˆäº†ä¸¤ä¸ªäº‹æƒ…ï¼š</p><ol><li><p>å†åœ¨ rois é‡‡æ · M ä¸ª roiï¼Œå¹¶è·å¾—å…¶å¯¹åº”çš„ gt æ ‡ç­¾ã€iou æ ‡ç­¾ã€æ­£æ ·æœ¬ maskç­‰ã€‚é€šå¸¸é‡‡æ · 128 ä¸ª roiï¼Œä»¥ 1:1 æ­£è´Ÿæ¯”ä¾‹è¿›è¡Œé‡‡æ ·ï¼Œæ­£è´Ÿåˆ¤å®šæ¡ä»¶ä¾ç„¶ä¸º iou ç›¸å…³é˜ˆå€¼ï¼Œè´Ÿé‡‡æ ·ä»…å‚ä¸ç½®ä¿¡åº¦æŸå¤±çš„è®¡ç®—ï¼Œä¸å‚ä¸å›å½’æŸå¤±çš„è®¡ç®—ã€‚Target çš„åˆ†é…æ˜¯é€šè¿‡ <code>ProposalTargetLayer</code> ç±»çš„å‰å‘æ–¹ç¨‹å®Œæˆï¼Œä¹Ÿå³ <code>self.proposal_target_layer</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">targets_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>proposal_target_layer<span class="token punctuation">.</span>forward<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span><span class="token triple-quoted-string string">"""Args:    batch_dict:        batch_size:        rois: (B, num_rois, 7 + C)        roi_scores: (B, num_rois)        gt_boxes: (B, N, 7 + C + 1)        roi_labels: (B, num_rois)Returns:    batch_dict:        rois: (B, M, 7 + C)        gt_of_rois: (B, M, 7 + C)        gt_iou_of_rois: (B, M)        roi_scores: (B, M) cls-based score        roi_labels: (B, M) cls-based label        reg_valid_mask: (B, M) positive bbox        rcnn_cls_labels: (B, M) iou-based label"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å°† gt è½¬æ¢åˆ°å¯¹åº”çš„ roi åæ ‡ç³»å½“ä¸­ï¼ˆå¹³ç§»+æ—‹è½¬ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿˜å¯¹æ–¹å‘ç›¸åçš„ gt è¿›è¡Œäº† flip orientation å¤„ç†ï¼Œä»¥å‡å°‘é”™è¯¯é¢„æµ‹çš„æŸå¤±ã€‚è™½ç„¶è¿™ä¸æ˜¯çœŸå®çš„æ ‡ç­¾ï¼Œä½†æŸå¤±å¤ªå¤§å¯èƒ½ä¸åˆ©äºç»´æŠ¤ R-CNN è®­ç»ƒçš„ç¨³å®š</p></li><li><p>è¿™é‡Œæä¸€ä¸‹ï¼Œæ‰€æœ‰è·å¾—çš„ target éƒ½ä½¿ç”¨ detach ä»è®¡ç®—å›¾ä¸­åˆ†ç¦»ï¼Œä¹Ÿå°±æ˜¯ä¸å¸Œæœ›æ›´æ–°ç”¨äºé¢„æµ‹ roi éƒ¨åˆ†çš„ç½‘ç»œå‚æ•°ï¼Œä»…å…³æ³¨ç”¨äºé¢„æµ‹æ®‹å·®ä»¥åŠ backbone ä¸­çš„ç½‘ç»œå‚æ•°ã€‚å»ºè®®ç”»ä¸€ä¸‹è®¡ç®—å›¾</p></li></ol></li></ol><h4 id="Loss-ç›¸å…³-1"><a href="#Loss-ç›¸å…³-1" class="headerlink" title="Loss ç›¸å…³"></a>Loss ç›¸å…³</h4><p>ä¸ AnchorHeadTemplate ä¸€æ ·ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š</p><ol><li><code>get_loss</code> è®¡ç®—åˆ†ç±»æŸå¤±å’Œå›å½’æŸå¤±ï¼Œæœ‰è¶£çš„æ˜¯åœ¨å›å½’æŸå¤±ä¸­è¿˜ä½¿ç”¨äº†ä¸€ä¸ª <code>corner_loss</code>ï¼Œè¿™æ˜¯è®ºæ–‡ä¸­æ²¡æœ‰æåˆ°çš„ï¼Œè€Œä¸”åœ¨ä»£ç çš„æ³¨é‡Šä¸­ä¹Ÿå†™äº† <code>TODO: NEED TO BE CHECK</code></li><li><code>generate_predicted_boxes</code>ï¼Œå°†é¢„æµ‹çš„æ®‹å·®ç»“æœï¼Œè¿˜åŸä¸ºçœŸå®é€‰æ¡†</li></ol><p>è¿™ä¹ˆä¸€çœ‹æ˜¯ä¸æ˜¯ç»“æ„å°±æ¸…æ™°å¾ˆå¤šäº†å‘¢ï¼Ÿä¸‹é¢å°±çœ‹çœ‹ VoxelRCNNHead å¹²äº†äº›ä»€ä¹ˆå§ï¼</p><h3 id="VoxelRCNNHead"><a href="#VoxelRCNNHead" class="headerlink" title="VoxelRCNNHead"></a>VoxelRCNNHead</h3><p>å½“æœ‰äº†åŸºç±» RoiHeadTemplate è¿‡åå°±å¯ä»¥ä¸“æ³¨å®ç° R-CNN çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå³ roi pooling æå–ç‰¹å¾</p><h4 id="init"><a href="#init" class="headerlink" title="init"></a>init</h4><p>åœ¨æ­å»ºè¯¥éƒ¨åˆ†çš„ç½‘ç»œä¹‹å‰ï¼Œå…ˆæ¥çœ‹çœ‹éœ€è¦å“ªäº›å­æ¨¡å—éœ€è¦å®šä¹‰</p><ol><li><code>pool_layer</code>ï¼Œè¿™æ˜¯é€šè¿‡å¦ä¸€ä¸ªç±»å®ç° <code>NeighborVoxelSAModuleMSG</code>ã€‚è¿™ä¸ªå±‚ç”¨äº voxel query å¯»æ‰¾é™„è¿‘çš„éç©ºä½“ç´ ï¼Œå¹¶å¯¹ grouping ç‰¹å¾è¿›è¡Œç‰¹å¾æå–</li><li><code>shared_fc_layer</code>ï¼Œè¿‡æ¸¡å…¨è¿æ¥å±‚ï¼Œ<code>nn.Linear + nn.BatchNorm1d + nn.ReLU</code></li><li><code>cls_fc_layer</code>ï¼Œåˆ†ç±»å…¨è¿æ¥å±‚ï¼Œ<code>nn.Linear + nn.BatchNorm1d + nn.ReLU</code></li><li><code>reg_fc_layer</code>ï¼Œé¢„æµ‹å…¨è¿æ¥å±‚ï¼Œ<code>nn.Linear + nn.BatchNorm1d + nn.ReLU</code></li></ol><h4 id="roi-grid-pooling"><a href="#roi-grid-pooling" class="headerlink" title="roi_grid_pooling"></a>roi_grid_pooling</h4><p>è¿™ä¸ªåŠŸèƒ½å‡½æ•°åŸºæœ¬ä¸Šå°±æ˜¯ roi grid pooling çš„æ ¸å¿ƒï¼Œå…¶ä½œç”¨ç®€å•å™è¿°ä¸ºï¼šåœ¨ä¸åŒåˆ†è¾¨ç‡ feature source ä¸‹ï¼Œå¯¹æ¯ä¸ª grid point è¿›è¡Œ roi poolingï¼Œå¹¶å°†ä¸åŒåˆ†è¾¨ç‡çš„ç»“æœè¿æ¥èµ·æ¥ã€‚ä¸‹é¢å…·ä½“åˆ†æå…¶ä¸­çš„æ­¥éª¤ï¼š</p><ol><li><p>è·å¾— roi ä¸­çš„ grid point åœ¨å½“å‰ feature source ç‰¹å¾å›¾è°±çš„ voxel åæ ‡ (B, x, y, z) ä»¥åŠ lidar åæ ‡ (BxN, 6x6x6, 3)ï¼Œç”¨äºä¹‹åçš„ groupingã€‚æˆ‘ä¸€ç›´æœ‰ä¸€ä¸ªç–‘é—®ï¼šå¦‚æœ roi ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„é€‰æ¡†åº”è¯¥æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚é•¿å®½é«˜ä¸ºè´Ÿæ•°ã€‚å®é™…ä¸Šè¿™æ ·çš„é—®é¢˜ä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºå¾—åˆ°çš„é€‰æ¡†æ˜¯åŸºäº anchor è¿›è¡Œå˜æ¢çš„ï¼Œä¿è¯äº†é¢„æµ‹é€‰æ¡†çš„åˆæ³•æ€§</p></li><li><p>è·å¾— <code>pooled_feature_list</code>ï¼Œå³å¯¹æ¯ä¸ªåˆ†è¾¨ç‡çš„ feature sourceï¼Œä½¿ç”¨ <code>pool_layer</code> å¯¹æ¯ä¸ª grid point è¿›è¡Œ roi poolingã€‚ç„¶åå°†æ‰€æœ‰åˆ†è¾¨ç‡çš„ç‰¹å¾è¿æ¥èµ·æ¥ <code>torch.concat</code> å¾—åˆ°æ¯ä¸ª grid point æœ€ç»ˆçš„ç‰¹å¾ã€‚<code>pool_layer</code> æ˜¯æ¯”è¾ƒå¤æ‚çš„ä¸€ä¸ªå±‚ï¼Œæ˜¯ç±» <code>NeighborVoxelSAModuleMSG</code> çš„å¯¹è±¡ï¼Œå…¶æœ‰å››ä¸ªå­æ¨¡å—</p><ol><li><p><code>mlp_in</code>ï¼Œå¯¹æ‰€æœ‰çš„ grid point è¿›è¡Œç»Ÿä¸€ç‰¹å¾æå–ï¼Œç”± kernel size = 1 çš„ <code>Conv1d</code> å®Œæˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">##################### Note ########################</span><span class="token comment"># Ni æ˜¯ç¬¬ i ä¸ªæ ·æœ¬çš„éç©ºä½“ç´ çš„ä¸ªæ•°</span><span class="token comment"># å¹¶ä¸”æœ¬ç¬”è®°ä¸­æ²¡æœ‰å¯¹ channel æ•°é‡è¿›è¡ŒåŒºåˆ†ï¼Œéƒ½ç”¨ C è¡¨ç¤º</span><span class="token comment"># k è¡¨ç¤º k ä¸ªä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾è°±</span><span class="token comment">##################### Note ########################</span><span class="token comment"># features_in: (1, C, N1+N2+...)</span>features_in <span class="token operator">=</span> self<span class="token punctuation">.</span>mlps_in<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">(</span>features_in<span class="token punctuation">)</span>features_in <span class="token operator">=</span> features_in<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># features_in: (1, M1+M2+..., C)</span>features_in <span class="token operator">=</span> features_in<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> features_in<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># features_in: (M1+M2+..., C)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·å¾—äº† <code>features_in</code> ä¹‹åå°†ä¼šè¾“å…¥åˆ° <code>self.groupers</code> å½“ä¸­</p></li><li><p><code>self.groupers</code>ï¼Œæ‰§è¡Œ grouping æ“ä½œï¼Œç”±ç±» <code>VoxelQueryAndGrouping</code> å®ç°ã€‚å½“é‚»å±…æ•°é‡æ²¡æœ‰ nsample è¿™ä¹ˆå¤šæ—¶ä½¿ç”¨ç¬¬ä¸€ä¸ª sample grid è¿›è¡Œè¡¥ä½ã€‚å†é€šè¿‡æ ‡æ³¨ <code>empty_ball_mask</code> å¾—çŸ¥è¯¥ grid point æ˜¯å¦æœ‰é‚»å±…ï¼Œåœ¨ä¹‹åä½¿ç”¨ MLP æå–ç‰¹å¾æ—¶æŠŠç©º grid point çš„ç‰¹å¾è®¾ç½®ä¸º 0 å³å¯ã€‚è¯¥ç±»çš„å‰å‘æ–¹ç¨‹è·å¾—çš„ç»“æœå¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> new_coords<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> xyz<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> xyz_batch_cnt<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>            new_xyz<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> new_xyz_batch_cnt<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span>            features<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> voxel2point_indices<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        # voxel data        xyz: (N1 + N2 ..., 3) xyz coordinates of the features        xyz_batch_cnt: (batch_size), [N1, N2, ...]        features: (N1 + N2 ..., C) tensor of features to group        voxel2point_indices: (B, Z, Y, X) tensor of points indices of feature source voxels              # grid point data        new_coords: (M1 + M2 ..., 3) centers voxel indices of the ball query        new_xyz: (M1 + M2 ..., 3) centers of the ball query        new_xyz_batch_cnt: (batch_size), [M1, M2, ...] Mi = 128x6x6x6          Returns:        grouped_xyz: (M1 + M2 ..., 3, nsample)        empty_ball_mask: (M1 + M2 ...,)        grouped_features: (M1 + M2 ..., C, nsample)    """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>mlp_pos</code>ï¼Œå¯¹ group å¾—åˆ°çš„ nsample ä¸ª voxel positions è¿›è¡Œç‰¹å¾æå–ï¼Œç”± kernel size = 1 çš„  <code>Conv2d</code> å®Œæˆ <code>grouped_xyz: (1, 3, M1+M2+..., nsample)</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># grouped_xyz: (1, 3, M1+M2+..., nsample)</span>position_features <span class="token operator">=</span> self<span class="token punctuation">.</span>mlps_pos<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">(</span>grouped_xyz<span class="token punctuation">)</span><span class="token comment"># position_features: (1, C, M1+M2+..., nsample)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>mlp_out</code>ï¼Œåœ¨ä½¿ç”¨è¯¥ MLP ä¹‹å‰ï¼Œéœ€è¦å°†å‰ä¸¤ä¸ª MLP æå–çš„ç‰¹å¾åŠ èµ·æ¥ <code>mlp_in + mpl_pos</code>ï¼Œç„¶åä½¿ç”¨ max pooling æ¶ˆé™¤ nsample ç»´åº¦ï¼Œå¾—åˆ°æ±‡èšç‰¹å¾ (1, C, M1+M2+â€¦)ã€‚ç„¶åå†è¿›è¡Œç‰¹å¾æå–ï¼Œç”± <code>Conv1d</code> å®Œæˆ</p></li></ol><p><strong>ä¸‹é¢æ•´ä½“æ¥çœ‹çœ‹ <code>pool_layer</code> å±‚çš„è¾“å…¥å’Œè¾“å‡º</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"> pooled_features <span class="token operator">=</span> pool_layer<span class="token punctuation">(</span>                xyz<span class="token operator">=</span>cur_voxel_xyz<span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                xyz_batch_cnt<span class="token operator">=</span>cur_voxel_xyz_batch_cnt<span class="token punctuation">,</span>                new_xyz<span class="token operator">=</span>roi_grid_xyz<span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                new_xyz_batch_cnt<span class="token operator">=</span>roi_grid_batch_cnt<span class="token punctuation">,</span>                new_coords<span class="token operator">=</span>cur_roi_grid_coords<span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                features<span class="token operator">=</span>cur_sp_tensors<span class="token punctuation">.</span>features<span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                voxel2point_indices<span class="token operator">=</span>v2p_ind_tensor            <span class="token punctuation">)</span><span class="token comment"># return:</span><span class="token comment"># new_xyz: (M1 + M2 ..., 3) tensor of the new features' xyz</span><span class="token comment"># new_features: (M1 + M2 ..., C) tensor of the new_features descriptors</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¿æ¥ä¸åŒçš„ feature source ä¸‹å¾—åˆ°çš„ roi pooling ç‰¹å¾å¹¶æ”¹å˜å…¶ç»´åº¦å¾—åˆ° (BxMi, 6x6x6, C)</p></li></ol><h4 id="forward-1"><a href="#forward-1" class="headerlink" title="forward"></a>forward</h4><p>çœ‹å®Œäº†ä¹‹å‰çš„å¤æ‚æ¨¡å—ï¼Œæ„Ÿè§‰å¤´éƒ½è¦æ™•äº†â€¦å¥½æ¶ˆæ¯æ˜¯åˆ°äº†è¿™ä¸€æ­¥ï¼ŒåŸºæœ¬ä¸Šå°±æ²¡æœ‰å…¶ä»–å¤æ‚æ¨¡å—äº†ï¼Œäº‹æƒ…å˜æˆäº†ç®€å•çš„ç»„åˆã€‚æœ‰äº†åŸºç±»å¤„ç† proposal &amp; target &amp; lossï¼Œæœ‰äº† roi grid pooling è·å¾— grid point featuresï¼Œç›´æ¥ä½¿ç”¨å®šä¹‰å¥½çš„ MLP è¿›è¡Œé¢„æµ‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    :param input_data: input dict    :return:    """</span>    <span class="token comment"># æ ¹æ® NMS è·å¾— 512 ä¸ªå¾—åˆ†æœ€é«˜çš„é€‰æ¡†</span>    targets_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>proposal_layer<span class="token punctuation">(</span>        batch_dict<span class="token punctuation">,</span> nms_config<span class="token operator">=</span>self<span class="token punctuation">.</span>model_cfg<span class="token punctuation">.</span>NMS_CONFIG<span class="token punctuation">[</span><span class="token string">'TRAIN'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>training <span class="token keyword">else</span> <span class="token string">'TEST'</span><span class="token punctuation">]</span>    <span class="token punctuation">)</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>        <span class="token comment"># é‡‡æ · 128 ä¸ª rois å¹¶è·å¾— gtï¼Œå¹¶å°† gt ç§»åŠ¨åˆ°å¯¹åº” rois çš„åæ ‡ç³»å½“ä¸­</span>        targets_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>assign_targets<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>        batch_dict<span class="token punctuation">[</span><span class="token string">'rois'</span><span class="token punctuation">]</span> <span class="token operator">=</span> targets_dict<span class="token punctuation">[</span><span class="token string">'rois'</span><span class="token punctuation">]</span>        batch_dict<span class="token punctuation">[</span><span class="token string">'roi_labels'</span><span class="token punctuation">]</span> <span class="token operator">=</span> targets_dict<span class="token punctuation">[</span><span class="token string">'roi_labels'</span><span class="token punctuation">]</span>    <span class="token comment"># RoI aware pooling</span>    pooled_features <span class="token operator">=</span> self<span class="token punctuation">.</span>roi_grid_pool<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>  <span class="token comment"># (BxN, 6x6x6, C)</span>    <span class="token comment"># Box Refinement</span>    pooled_features <span class="token operator">=</span> pooled_features<span class="token punctuation">.</span>view<span class="token punctuation">(</span>pooled_features<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># (BxN, -1)</span>    shared_features <span class="token operator">=</span> self<span class="token punctuation">.</span>shared_fc_layer<span class="token punctuation">(</span>pooled_features<span class="token punctuation">)</span>    rcnn_cls <span class="token operator">=</span> self<span class="token punctuation">.</span>cls_pred_layer<span class="token punctuation">(</span>self<span class="token punctuation">.</span>cls_fc_layers<span class="token punctuation">(</span>shared_features<span class="token punctuation">)</span><span class="token punctuation">)</span>    rcnn_reg <span class="token operator">=</span> self<span class="token punctuation">.</span>reg_pred_layer<span class="token punctuation">(</span>self<span class="token punctuation">.</span>reg_fc_layers<span class="token punctuation">(</span>shared_features<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>        batch_cls_preds<span class="token punctuation">,</span> batch_box_preds <span class="token operator">=</span> self<span class="token punctuation">.</span>generate_predicted_boxes<span class="token punctuation">(</span>            batch_size<span class="token operator">=</span>batch_dict<span class="token punctuation">[</span><span class="token string">'batch_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rois<span class="token operator">=</span>batch_dict<span class="token punctuation">[</span><span class="token string">'rois'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cls_preds<span class="token operator">=</span>rcnn_cls<span class="token punctuation">,</span> box_preds<span class="token operator">=</span>rcnn_reg        <span class="token punctuation">)</span>        batch_dict<span class="token punctuation">[</span><span class="token string">'batch_cls_preds'</span><span class="token punctuation">]</span> <span class="token operator">=</span> batch_cls_preds        batch_dict<span class="token punctuation">[</span><span class="token string">'batch_box_preds'</span><span class="token punctuation">]</span> <span class="token operator">=</span> batch_box_preds        batch_dict<span class="token punctuation">[</span><span class="token string">'cls_preds_normalized'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        targets_dict<span class="token punctuation">[</span><span class="token string">'rcnn_cls'</span><span class="token punctuation">]</span> <span class="token operator">=</span> rcnn_cls        targets_dict<span class="token punctuation">[</span><span class="token string">'rcnn_reg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> rcnn_reg        self<span class="token punctuation">.</span>forward_ret_dict <span class="token operator">=</span> targets_dict    <span class="token keyword">return</span> batch_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ„Ÿè¨€"><a href="#æ„Ÿè¨€" class="headerlink" title="æ„Ÿè¨€"></a>æ„Ÿè¨€</h2><p>è‡³æ­¤ï¼ŒVoxel R-CNN çš„æ¡†æ¶å°±æ€»ç»“å®Œäº†ğŸ˜­ä¸€è·¯ä¸ŠçœŸçš„æœ‰å¤ªå¤šçš„å›°éš¾äº†ï¼Œä½†æ˜¯æ•´ä¸ªä»£ç çœ‹ä¸‹æ¥æ„Ÿè§‰è‡ªå·±è¿˜æ˜¯æ”¶è·ä¸å°‘ï¼è™½ç„¶è·¯è¿˜å¾ˆé•¿ï¼Œä½†æ˜¯è‡³å°‘è¿ˆå‡ºäº†ç¬¬ä¸€æ­¥</p><p>è¿‡ç¨‹ä¸­é‡åˆ°äº†ä»£ç ä¹‹å¤–çš„é—®é¢˜ï¼Œä¾‹å¦‚ localhost:10.0 é—®é¢˜ï¼Œä¸€èˆ¬æ˜¯å› ä¸ºæ²¡èƒ½æ‰¾åˆ°æœ¬æœºçš„æ˜¾ç¤ºå™¨ï¼ŒæŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½é‡å¯ä¸€éï¼ŒåŒ…æ‹¬ä½ è‡ªå·±çš„ç”µè„‘ï¼</p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ol><li>æ•´ç†æŸå¤±å‡½æ•°</li><li>æ•´ç†å¸¸ç”¨åŠŸèƒ½å‡½æ•° utils ä»¥åŠä¸‰æ–¹åº“</li><li>pytorch æŠ€å·§æ€»ç»“</li><li>Summary SPG, Lidar R-CNN</li><li>SA-SSD ä»£ç é˜…è¯»</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenPCDet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenPCDet review</title>
      <link href="/archives/6b4af7d3.html"/>
      <url>/archives/6b4af7d3.html</url>
      
        <content type="html"><![CDATA[<h1 id="OpenPCDet-review"><a href="#OpenPCDet-review" class="headerlink" title="OpenPCDet review"></a>OpenPCDet review</h1><p>ç°åœ¨æƒ³è¦æ‰“é€ è‡ªå·±çš„ç½‘ç»œäº†ï¼Œå°±è¦å¯¹è¿™ä¸ªæ¡†æ¶å®Œå…¨çš„ç†Ÿæ‚‰ã€‚è™½ç„¶ä¹‹å‰æŠŠä»£ç éƒ½è¿‡äº†ä¸€éï¼Œä½†æ˜¯ç†Ÿæ‚‰åº¦è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰“ç®—é‡æ–°æ•´ç†è¿‡ã€‚ç›®æ ‡å°±æ˜¯å®Œæˆ SA-SSD åœ¨ OpenPCDet æ¡†æ¶ä¸‹çš„å¤ç°ã€‚è´´ä¸€ä¸ª <a href="https://www.zhihu.com/people/yilu-kuang-shuai">Shaoshuai Shi</a> æœ¬äººåœ¨çŸ¥ä¹çš„è§£è¯» <a href="https://zhuanlan.zhihu.com/p/152120636">OpenPCDet: Open-MMLab é¢å‘LiDARç‚¹äº‘è¡¨å¾çš„3Dç›®æ ‡æ£€æµ‹ä»£ç åº“</a></p><h2 id="é›¶ç¢çš„çŸ¥è¯†"><a href="#é›¶ç¢çš„çŸ¥è¯†" class="headerlink" title="é›¶ç¢çš„çŸ¥è¯†"></a>é›¶ç¢çš„çŸ¥è¯†</h2><h3 id="åº“"><a href="#åº“" class="headerlink" title="åº“"></a>åº“</h3><p>ä¹‹å‰åœ¨çœ‹ä»£ç çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›æœ‰ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œç®€å•åˆ—ä¸¾å¦‚ä¸‹ï¼ˆä¹‹åæ…¢æ…¢å¡«å‘æ€»ç»“ï¼‰ï¼š</p><ol><li><p>loggingï¼Œ <a href="https://zhuanlan.zhihu.com/p/360306588">çŸ¥ä¹</a></p></li><li><p>tensorboardï¼Œ<a href="https://www.bilibili.com/video/BV1Qf4y1C7kz">bilibili</a> <a href="https://pytorch.org/docs/stable/tensorboard.html">pytorch</a></p></li><li><p>pdbï¼Œ<a href="https://zhuanlan.zhihu.com/p/37294138">çŸ¥ä¹</a></p></li><li><p>collections</p></li><li><p>screenï¼Œç”¨äºæ–°å»ºçª—å£ï¼Œè®©å‘½ä»¤åœ¨åå°è¿è¡Œï¼Œå³ä½¿é€€å‡ºä¼šè¯ç¨‹åºä¹Ÿä¸ä¼šåœæ­¢</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">screen</span> -ls              <span class="token comment"># æŸ¥çœ‹æ‰€æœ‰screen</span><span class="token function">screen</span> -S <span class="token operator">&lt;</span>screen-name<span class="token operator">&gt;</span> <span class="token comment"># åˆ›å»ºscreenï¼Œå¹¶å‘½å</span><span class="token function">screen</span> -d<span class="token comment"># detach or Ctrl + A + D</span><span class="token function">screen</span> -r <span class="token operator">&lt;</span>screen-name<span class="token operator">&gt;</span> <span class="token comment"># è¿›å…¥screen</span><span class="token function">screen</span> -X quit          <span class="token comment"># åˆ é™¤screenï¼Œä½†æ²¡æœ‰æŒ‡å®šä¼šè¯</span><span class="token function">screen</span> -X -S <span class="token punctuation">[</span>session you want to kill<span class="token punctuation">]</span> quit <span class="token comment">#åˆ é™¤screenï¼ŒæŒ‡å®šä¼šè¯</span><span class="token function">screen</span> -wipe            <span class="token comment"># æ¸…é™¤dead screens</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>tmux æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tmux new -s <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>tmux detach<span class="token comment"># or ctrl + B + D, or crtl + B + :detach</span>tmux attach -t <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>tmux <span class="token function">ls</span>tmux kill-session -t <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span><span class="token comment"># or enter session &amp; exit</span><span class="token comment"># æ‰“å¼€é¼ æ ‡æ»šåŠ¨åŠŸèƒ½</span>ctrl + B + :set -g mouse on<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ‰ç‚¹ç±»ä¼¼äº vimï¼ŒæŒ‰ä¸‹ ctrl + B + : è¿‡åå¯ä»¥è¾“å…¥ä¸€äº›å‘½ä»¤</p></li></ol><h3 id="é‡è¦çš„å‚æ•°"><a href="#é‡è¦çš„å‚æ•°" class="headerlink" title="é‡è¦çš„å‚æ•°"></a>é‡è¦çš„å‚æ•°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span><span class="token operator">-</span>cfg_file<span class="token operator">-</span><span class="token operator">-</span>batch_size<span class="token operator">-</span><span class="token operator">-</span>workers<span class="token operator">-</span><span class="token operator">-</span>ckpt<span class="token operator">-</span><span class="token operator">-</span>start_epoch<span class="token operator">-</span><span class="token operator">-</span>save_to_file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­å¯¹äº <code>--workers</code> çš„ä½œç”¨éœ€è¦æ›´å¤šçš„ç†è§£ï¼Œå‚è€ƒ <a href="https://blog.csdn.net/jiongjiongxia123/article/details/112850223">CSDN</a>ï¼Œä¸ªäººç†è§£å°±æ˜¯ CPU ä½œä¸ºæ¬è¿å·¥ workers æå‰å°†éœ€è¦çš„ batch æ”¾å…¥å†…å­˜ RAM ä¸­ï¼ˆéæ˜¾å­˜ï¼‰ï¼Œç„¶å GPU å¤„ç†å®Œä¸€ä¸ª batch è¿‡åæ¥å–</p><h3 id="EasyDict"><a href="#EasyDict" class="headerlink" title="EasyDict"></a>EasyDict</h3><p>é¡¹ç›®ç”¨äº†ä¸€ä¸ª <code>EasyDict</code> ç±»ä½œä¸ºæ›´å¥½ç”¨çš„å­—å…¸ï¼Œèƒ½å¤Ÿå°† <code>key</code> ç›´æ¥ä½œä¸º <code>attribute</code> è¿›è¡Œè°ƒç”¨</p><h3 id="Yaml"><a href="#Yaml" class="headerlink" title="Yaml"></a>Yaml</h3><p>æ¨¡å‹çš„å‚æ•°æ˜¯ä»¥ <a href="https://www.runoob.com/w3cnote/yaml-intro.html">yaml</a> æ ¼å¼ï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å¯¼å…¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> yaml<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    cfg_dict <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">,</span> Loader<span class="token operator">=</span>FullLoader<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><ol><li><p>å…³äº python ç±»ä¸­çš„å†…ç½®å±æ€§ï¼š<a href="https://luobuda.github.io/2015/01/16/python-class/">class</a> <a href="https://www.jianshu.com/p/c390d591ce65">dict</a></p></li><li><p>å…³äº  <a href="https://stackoverflow.com/questions/44834/can-someone-explain-all-in-python">all &amp; init</a>ï¼š<code>__all__</code> å®šä¹‰åœ¨ <code>__init__.py</code> ä¸­ï¼Œä»£è¡¨ç€åœ¨è¿™ä¸€ä¸ª packageï¼Œä½ æƒ³è¦æš´éœ²çš„æ¥å£/å‡½æ•°/ç±»ï¼ˆä½†ä¹Ÿè¦å…ˆå¯¼å…¥åˆ° package ä¸­ï¼‰ï¼Œå¤–éƒ¨å¦‚æœä»è¿™ä¸ªåŒ…é‡Œ importï¼Œåªèƒ½ import <code>__all__</code> åˆ—è¡¨ä¸­åŒ…å«çš„æ¥å£ã€‚å¦‚æœç¡®å®å¸Œæœ›å¯¼å…¥æŸä¸ªæ¥å£ï¼Œä½†è¯¥æ¨¡å—ä¸åœ¨ <code>__all__</code> ä¸­ï¼Œå¯ä»¥é€šè¿‡å…·ä½“çš„è·¯å¾„è¿›è¡Œå¯¼å…¥ </p><p>å¦‚æœæ˜¯åµŒå¥—çš„åŒ…å†…è°ƒç”¨ï¼Œéœ€è¦ä»åŒ…çš„æ ¹è·¯å¾„å¼€å§‹è°ƒç”¨</p></li></ol><h2 id="KITTI-Dataset"><a href="#KITTI-Dataset" class="headerlink" title="KITTI Dataset"></a>KITTI Dataset</h2><h3 id="kitti-infos-train-pkl"><a href="#kitti-infos-train-pkl" class="headerlink" title="kitti_infos_train.pkl"></a>kitti_infos_train.pkl</h3><p>è¿™é‡Œåº”è¯¥è¿˜æœ‰2ä¸ª pkl æ–‡ä»¶ <code>kitti_infos_val.pkl &amp; kitti_dbinfos_train.pkl</code> ä¹Ÿå¾ˆé‡è¦ï¼Œè¿™äº› pkl æ–‡ä»¶ä¿å­˜äº† KITTI çš„æ•°æ®ä¿¡æ¯ä¾¿äºä½¿ç”¨ python è¿›è¡Œæ“ä½œï¼Œä¸‹é¢çœ‹çœ‹å…¶ä¸­å­˜å‚¨äº†ä»€ä¹ˆ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># kitti_infos_train.pkl &amp; kitti_infos_val.pkl éƒ½ä»¥å¦‚ä¸‹å½¢å¼å­˜å‚¨</span>point_cloud         num_features         lidar_idx image         image_idx         image_shape <span class="token punctuation">(</span><span class="token number">2</span>,<span class="token punctuation">)</span>calib         P2 <span class="token punctuation">(</span><span class="token number">4</span>, <span class="token number">4</span><span class="token punctuation">)</span>        R0_rect <span class="token punctuation">(</span><span class="token number">4</span>, <span class="token number">4</span><span class="token punctuation">)</span>        Tr_velo_to_cam <span class="token punctuation">(</span><span class="token number">4</span>, <span class="token number">4</span><span class="token punctuation">)</span>annos         name <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span>        truncated <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span>        occluded <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span>        alpha <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span>        bbox <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">4</span><span class="token punctuation">)</span>        dimensions <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span><span class="token punctuation">)</span>        location <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span><span class="token punctuation">)</span>        rotation_y <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span>        score <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span>        difficulty <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span>        index <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span>        gt_boxes_lidar <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">7</span><span class="token punctuation">)</span>        num_points_in_gt <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¯ä¸€ä¸ª pkl æ–‡ä»¶æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨çš„æˆå‘˜æ˜¯ä¸€ä¸ªå±‚çº§å­—å…¸ï¼Œä¿å­˜äº†å¯¹åº”æ ·æœ¬çš„ä¿¡æ¯ï¼ˆå°† <code>ndarray</code> çš„å½¢çŠ¶åœ¨å…³é”®å­—åæ ‡å‡ºï¼‰</p><p><code>kitti_dbinfos_train.pkl</code> æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå…³é”®å­—å°±æ˜¯æ ‡ç­¾ç±»åˆ«</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Pedestrian Car Cyclist Van Truck Tram Misc Person_sitting<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¯ä¸€ä¸ªå­—å…¸åˆå¯¹åº”äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨çš„æˆå‘˜åˆæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä»¥ Pedestrian ä¸ºä¾‹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">name Pedestrian-------------------------------------path gt_database/000000_Pedestrian_0.bin-------------------------------------image_idx 000000-------------------------------------gt_idx <span class="token number">0</span>-------------------------------------box3d_lidar <span class="token punctuation">(</span><span class="token number">7</span>,<span class="token punctuation">)</span><span class="token punctuation">[</span> <span class="token number">8.7</span> -1.9 -0.7  <span class="token number">1.2</span>  <span class="token number">0.5</span>  <span class="token number">1.9</span> -1.6<span class="token punctuation">]</span>-------------------------------------num_points_in_gt <span class="token number">383</span>-------------------------------------difficulty <span class="token number">0</span>-------------------------------------bbox <span class="token punctuation">(</span><span class="token number">4</span>,<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">712.4</span> <span class="token number">143</span>.  <span class="token number">810.7</span> <span class="token number">307.9</span><span class="token punctuation">]</span>-------------------------------------score -1.0-------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="DatasetTemplate"><a href="#DatasetTemplate" class="headerlink" title="DatasetTemplate"></a>DatasetTemplate</h3><p>è¿™æ˜¯ä¸€ä¸ªæ•°æ®é›†çš„åŸºç¡€ç±»ï¼Œå…ˆçœ‹å…¶å‚æ•°å’ŒåŸºæœ¬å±æ€§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DatasetTemplate</span><span class="token punctuation">(</span>torch_data<span class="token punctuation">.</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset_cfg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> class_names<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> root_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> logger<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Args:            root_path: ä¸€èˆ¬ä¸º None            dataset_cfg: cfg.DATA_CONFIG            class_names: pedestrian car cyclist            training: True            logger:        Attributes:            - dataset config            - training            - class_names            - root_path é€šå¸¸ä¸º dataset config ä¸­çš„æŒ‡å®š DATA_PATH            - logger            - point cloud range ç‚¹äº‘èŒƒå›´             - point_feature_encoder ç‚¹äº‘ç‰¹å¾ç¼–ç å™¨             - data_augmentor æ•°æ®å¢å¼ºå™¨ sampling &amp; rotation            - data_processor æ•°æ®å¤„ç†å™¨ voxelization        """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰åœ¨ <code>data_augmentor</code> ä¸­çš„ <code>gt_sampling</code> å®é™…å¤„ç†äº†æ•°æ®ï¼Œå³å¯¹ gt database è¿›è¡Œç­›é€‰ï¼Œå»é™¤ç‚¹å°‘çš„å’Œå›°éš¾çš„æ ·æœ¬</p><p>è¯¥ç±»ä¸­è¿˜å®šä¹‰äº†ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œåœ¨ä¹‹åè°ƒç”¨ï¼š1. <code>prepare_data(self, data_dict)</code> 2. <code>collate_batch(batch_list)</code> </p><h4 id="prepare-data"><a href="#prepare-data" class="headerlink" title="prepare_data"></a>prepare_data</h4><p><code>prepare_data(self, data_dict)</code> é€šè¿‡è¯¥æ–¹æ³•å‡†å¤‡æ•°æ®ã€‚æ•°æ®çš„é‡‡æ ·ã€å¢å¼ºå’Œä½“ç´ åŒ–éƒ½æ˜¯åœ¨è¿™ä¸€æ–¹æ³•ä¸­è¿›è¡Œè°ƒç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿”å›çš„ voxel åæ ‡æ’åˆ—ä¸º zyx è€Œä¸æ˜¯ xyzï¼Œè¿™æ˜¯ç”±äº spconv çš„è®¾è®¡å¯¼è‡´çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">prepare_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment">################# IMPORTANT #################</span>        <span class="token triple-quoted-string string">"""        Args:            data_dict:                points: optional, (N, 3 + C_in)                gt_boxes: optional, (N, 7 + C) [x, y, z, dx, dy, dz, heading, ...]                gt_names: optional, (N), string                ...        Returns:            data_dict:                frame_id: string                points: (N, 3 + C_in)                gt_boxes: optional, (N, 7 + C) [x, y, z, dx, dy, dz, heading, ...]                (poped) gt_names: optional, (N), string                use_lead_xyz: bool                voxels: optional (num_voxels, max_points_per_voxel, 3 + C)                voxel_coords: optional (num_voxels, 3)                voxel_num_points: optional (num_voxels)                ...                batch_size: åœ¨ dataloader collate_fn ä¸­åŠ å…¥        """</span><span class="token comment"># voxels: [M, max_points, ndim] float tensor. only contain points.</span>        <span class="token comment"># coordinates: [M, 3] int32 tensor. zyx format. #### note zyx not xyz !!!####</span>        <span class="token comment"># num_points_per_voxel: [M] int32 tensor.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="collate-batch"><a href="#collate-batch" class="headerlink" title="collate_batch"></a>collate_batch</h4><p><code>collate_batch(batch_list)</code> ç”¨äºä¼ å…¥ <code>DataLoader</code> ä¸­çš„ <code>collate_fn</code>ï¼Œè¿™æ ·å°±èƒ½å®šä¹‰æ¯ä¸€ä¸ª batch è¿”å›çš„å…·ä½“å½¢å¼ï¼ˆä¸ºä¸€ä¸ªå­—å…¸ï¼‰ï¼Œå…³äº <a href="https://zhuanlan.zhihu.com/p/361830892">collate_fn</a>ï¼Œæ ¸å¿ƒçš„å·¥ä½œå¦‚ä¸‹ï¼š</p><ol><li>å°† batch æ¯ä¸ª sample çš„æ•°æ® concat</li><li>åœ¨ points, voxel_coordsâ€¦ ä¸­å¢åŠ  batch ç»´åº¦ä»¥åŒºåˆ†æ˜¯æ¥è‡ªå“ªä¸ª sample</li><li>batch ä¸­æ¯ä¸ª sample çš„ boxes æ•°é‡ä¸ä¸€æ ·ï¼Œéœ€è¦å°†å½¢çŠ¶ç»Ÿä¸€ç„¶ååˆå¹¶èµ·æ¥</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python">frame_id <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">)</span>gt_boxes <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token comment"># åœ¨ prepare_data ä¸­åŠ å…¥äº†ç±»åˆ«ç‰¹å¾</span>points <span class="token punctuation">(</span><span class="token number">94168</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>use_lead_xyz <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">)</span>voxels <span class="token punctuation">(</span><span class="token number">64000</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>voxel_coords <span class="token punctuation">(</span><span class="token number">64000</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment"># bzyx order</span>voxel_num_points <span class="token punctuation">(</span><span class="token number">64000</span><span class="token punctuation">,</span><span class="token punctuation">)</span>image_shape <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ç„¶ä½œä¸ºä¸€ä¸ª <code>Dataset</code> çš„å­ç±»ï¼Œéœ€è¦å®šä¹‰ <code>__len__ &amp; __getitem__</code> æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ²¡æœ‰åœ¨ <code>DatasetTemplate</code> ä¸­å®ç°ï¼Œè€Œæ˜¯åœ¨æ›´å…·ä½“çš„ç±»ä¸­å®ç°æ¯”å¦‚ <code>KittiDataset</code></p><h3 id="kitti-dataset-py"><a href="#kitti-dataset-py" class="headerlink" title="kitti_dataset.py"></a>kitti_dataset.py</h3><p>è¿™ä¸ªæ–‡ä»¶ç”¨äºå®šä¹‰ <code>KittiDataset</code> ç±»ï¼Œè¿™ä¸ªç±»æ¯”è¾ƒå¤§ï¼Œå› ä¸ºè¯¥ç±»å®ç°äº†å¯¹åŸå§‹ KITTI æ•°æ®é›†çš„å¤„ç†å‡½æ•°ï¼Œ<code>kitti_infos_train.pkl</code> å°±æ˜¯ä½¿ç”¨è¿™äº›å‡½æ•°ç”Ÿæˆçš„ã€‚å…ˆçœ‹çœ‹è¯¥ç±»çš„åˆå§‹åŒ–</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">KittiDataset</span><span class="token punctuation">(</span>DatasetTemplate<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset_cfg<span class="token punctuation">,</span> class_names<span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> root_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> logger<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Args:            root_path:            dataset_cfg:            class_names:            training:            logger:        Attributes:        - split_dir &amp; sample_id_list: æ ¹æ®è®­ç»ƒé›†/éªŒè¯é›†ç¡®å®š sample åˆ—è¡¨            - kitti_infos: æ¥è‡ª train/test pkl æ–‡ä»¶ï¼ŒåŠ è½½åä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ ä¸ºå½¢å¦‚ä¸‹é¢çš„å­—å…¸            ### å½“ç„¶è¿˜æœ‰åŸºç±»ä¸­çš„å±æ€§ï¼Œè¿™é‡Œä¸å†é‡å¤ ###        """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="getitem"><a href="#getitem" class="headerlink" title="getitem"></a>getitem</h4><p>å…¶æ ¸å¿ƒå‡½æ•° <code>__getitem__</code>ï¼Œè¿”å›ä¸€ä¸ªå­—å…¸ï¼Œå…¶å®å¤§éƒ¨åˆ†éƒ½æ˜¯è¿”å›äº† <code>kitti_infos_train.pkl</code> ä¸­çš„ä¿¡æ¯ï¼Œç‰¹åˆ«çš„æ“ä½œå°±æ˜¯å¢åŠ äº†ç‚¹äº‘ä¿¡æ¯ï¼Œå¹¶é€‰å–äº†è§†åœºè§’ä¸­çš„ç‚¹ <code>get_fov_flag</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># è·å¾—åŸå§‹ç‚¹äº‘ points (N, 4)</span><span class="token keyword">if</span> <span class="token string">"points"</span> <span class="token keyword">in</span> get_item_list<span class="token punctuation">:</span>    points <span class="token operator">=</span> self<span class="token punctuation">.</span>get_lidar<span class="token punctuation">(</span>sample_idx<span class="token punctuation">)</span>    <span class="token comment"># ä»…å–è§†è§’ä¸­çš„ç‚¹ï¼Œå…¶ä½™ç‚¹æ”¾å¼ƒ</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>dataset_cfg<span class="token punctuation">.</span>FOV_POINTS_ONLY<span class="token punctuation">:</span>        pts_rect <span class="token operator">=</span> calib<span class="token punctuation">.</span>lidar_to_rect<span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        fov_flag <span class="token operator">=</span> self<span class="token punctuation">.</span>get_fov_flag<span class="token punctuation">(</span>pts_rect<span class="token punctuation">,</span> img_shape<span class="token punctuation">,</span> calib<span class="token punctuation">)</span>        points <span class="token operator">=</span> points<span class="token punctuation">[</span>fov_flag<span class="token punctuation">]</span>        input_dict<span class="token punctuation">[</span><span class="token string">'points'</span><span class="token punctuation">]</span> <span class="token operator">=</span> points<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>__getitem__</code> ä¸­åœ¨æœ€åè°ƒç”¨äº†åŸºç±» <code>prepare_data</code> æ–¹æ³•ï¼Œå¯¹ç‚¹äº‘è¿›è¡Œé‡‡æ ·ã€å¢å¼ºå’Œä½“ç´ åŒ–ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªå­—å…¸åŒ…å«äº†æ¯ä¸ªæ ·æœ¬çš„ä¿¡æ¯</p><p>å…³äº calib æ˜¯ä»€ä¹ˆä½œç”¨ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸€ç¯‡åšå®¢ <a href="https://medium.com/test-ttile/kitti-3d-object-detection-dataset-d78a762b5a4">Kitti Calib</a>ã€‚å¯¹äºåæ ‡è½¬æ¢çš„çŸ©é˜µè¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ï¼Œéš¾ä»¥ç†è§£çš„æ˜¯ä¿®æ­£çŸ©é˜µï¼Œé€šè¿‡è§‚å¯Ÿæˆ‘å‘ç°ä¿®æ­£çŸ©é˜µçš„å€¼éå¸¸æ¥è¿‘äºä¸€ä¸ªå•ä½çŸ©é˜µï¼Œæ‰€ä»¥æˆ‘çŒœæµ‹è¿™æ˜¯ä¸ºäº†ä¿®æ­£ç”±äºè·¯å†µé¢ ç°¸è€Œå¯¼è‡´çš„ç›¸æœºå¾®å°æŠ–åŠ¨/æ—‹è½¬</p><h4 id="generate-prediction-results"><a href="#generate-prediction-results" class="headerlink" title="generate_prediction_results"></a>generate_prediction_results</h4><p>é™¤äº†æ ¸å¿ƒå‡½æ•°å¤–ï¼Œè¯¥ç±»è¿˜å®ç°äº†ä¸€ä¸ªé™æ€æ–¹æ³• <code>generate_prediction_results</code>ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç›®çš„æ˜¯å°†é¢„æµ‹çš„ bbox, scores, label ç­‰ç»“æœè½¬åŒ–ä¸º kitti åŸå§‹æ ‡ç­¾æ ¼å¼ï¼Œç”¨äºä¹‹åçš„è¯„ä¼°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">generate_prediction_dicts</span><span class="token punctuation">(</span>batch_dict<span class="token punctuation">,</span> pred_dicts<span class="token punctuation">,</span> class_names<span class="token punctuation">,</span> output_path<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Args:        batch_dict:            frame_id:        pred_dicts: list of pred_dicts            pred_boxes: (N, 7), Tensor            pred_scores: (N), Tensor            pred_labels: (N), Tensor        class_names:        output_path:    Returns:    - annos: a list, contains batch prediction results, consists of dict            pred_dict['name'] = np.array(class_names)[pred_labels - 1]            pred_dict['alpha'] = -np.arctan2(-pred_boxes[:, 1], pred_boxes[:, 0]) + pred_boxes_camera[:, 6]            pred_dict['bbox'] = pred_boxes_img            pred_dict['dimensions'] = pred_boxes_camera[:, 3:6]            pred_dict['location'] = pred_boxes_camera[:, 0:3]            pred_dict['rotation_y'] = pred_boxes_camera[:, 6]            pred_dict['score'] = pred_scores            pred_dict['boxes_lidar'] = pred_boxes    """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="evaluation"><a href="#evaluation" class="headerlink" title="evaluation"></a>evaluation</h4><p>ä½¿ç”¨ kitti çš„è¯„ä»·æ ‡å‡†å¯¹é¢„æµ‹ç»“æœè¿›è¡Œè¯„ä¼°ï¼Œè¿”å›ä¸€ä¸ªå…ƒç»„ <code>ap_result_str, ap_dict</code> å…¶å®äºŒè€…çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œå‰è€…å°†ä¿å­˜åˆ°æ—¥å¿—ä¸­æ–¹ä¾¿æŸ¥çœ‹ï¼Œåè€…å°†è®°å½•åˆ° tensorboard ä¸­</p><p>ä¹‹åæœ‰éœ€è¦å¯ä»¥æ•´ç†ä¸€ä¸‹å…¶ä¸­çš„ <code>box_utils &amp; common_utils &amp; calib</code> ï¼Œé‡Œé¢æœ‰å“ªäº›æ“ä½œæ˜¯å¸¸ç”¨çš„ï¼Œä¸ç”¨è‡ªå·±é€ è½®å­ </p><h2 id="Detector"><a href="#Detector" class="headerlink" title="Detector"></a>Detector</h2><p>ä¸‹é¢æ€»ç»“å¦‚ä½•å»ºé€ ä¸€ä¸ªæ¨¡å‹ï¼Œä»£ç ä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°ï¼šæ¨¡å‹é…ç½®ï¼Œç±»åˆ«ï¼Œæ•°æ®é›†ï¼ˆKittiDataset instanceï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">__all__ <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'Detector3DTemplate'</span><span class="token punctuation">:</span> Detector3DTemplate<span class="token punctuation">,</span>    <span class="token string">'SECONDNet'</span><span class="token punctuation">:</span> SECONDNet<span class="token punctuation">,</span>    <span class="token string">'PartA2Net'</span><span class="token punctuation">:</span> PartA2Net<span class="token punctuation">,</span>    <span class="token string">'PVRCNN'</span><span class="token punctuation">:</span> PVRCNN<span class="token punctuation">,</span>    <span class="token string">'PointPillar'</span><span class="token punctuation">:</span> PointPillar<span class="token punctuation">,</span>    <span class="token string">'PointRCNN'</span><span class="token punctuation">:</span> PointRCNN<span class="token punctuation">,</span>    <span class="token string">'SECONDNetIoU'</span><span class="token punctuation">:</span> SECONDNetIoU<span class="token punctuation">,</span>    <span class="token string">'CaDDN'</span><span class="token punctuation">:</span> CaDDN<span class="token punctuation">,</span>    <span class="token string">'VoxelRCNN'</span><span class="token punctuation">:</span> VoxelRCNN<span class="token punctuation">}</span><span class="token keyword">def</span> <span class="token function">build_network</span><span class="token punctuation">(</span>model_cfg<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>    model <span class="token operator">=</span> build_detector<span class="token punctuation">(</span>        model_cfg<span class="token operator">=</span>model_cfg<span class="token punctuation">,</span> num_class<span class="token operator">=</span>num_class<span class="token punctuation">,</span> dataset<span class="token operator">=</span>dataset    <span class="token punctuation">)</span>    <span class="token keyword">return</span> model<span class="token keyword">def</span> <span class="token function">build_detector</span><span class="token punctuation">(</span>model_cfg<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>    model <span class="token operator">=</span> __all__<span class="token punctuation">[</span>model_cfg<span class="token punctuation">.</span>NAME<span class="token punctuation">]</span><span class="token punctuation">(</span>        model_cfg<span class="token operator">=</span>model_cfg<span class="token punctuation">,</span> num_class<span class="token operator">=</span>num_class<span class="token punctuation">,</span> dataset<span class="token operator">=</span>dataset    <span class="token punctuation">)</span>    <span class="token keyword">return</span> model<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡æ¨¡å‹é…ç½®ä¸­çš„å…³é”®å­—æ®µåˆ›å»ºæ¨¡å‹å®ä¾‹ï¼Œä¾‹å¦‚ï¼š<code>SECONDNet</code>ã€‚æ£€æµ‹å™¨éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„åŸºç±» <code>Detector3DTemplate</code>  ä¸‹é¢çœ‹çœ‹å®ƒå…·æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œç„¶åå†ç»“åˆå…·ä½“æ¨¡å‹å­¦ä¹ </p><h3 id="Detector3DTemplate"><a href="#Detector3DTemplate" class="headerlink" title="Detector3DTemplate"></a>Detector3DTemplate</h3><p>å…ˆçœ‹åˆå§‹åŒ–å‡½æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Detector3DTemplate</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_cfg<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>model_cfg <span class="token operator">=</span> model_cfg        self<span class="token punctuation">.</span>num_class <span class="token operator">=</span> num_class        self<span class="token punctuation">.</span>dataset <span class="token operator">=</span> dataset        self<span class="token punctuation">.</span>class_names <span class="token operator">=</span> dataset<span class="token punctuation">.</span>class_names        <span class="token comment"># ç”¨äºè®°å½• epoch</span>        self<span class="token punctuation">.</span>register_buffer<span class="token punctuation">(</span><span class="token string">'global_step'</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>LongTensor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>module_topology <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string">'vfe'</span><span class="token punctuation">,</span> <span class="token string">'backbone_3d'</span><span class="token punctuation">,</span> <span class="token string">'map_to_bev_module'</span><span class="token punctuation">,</span> <span class="token string">'pfe'</span><span class="token punctuation">,</span>            <span class="token string">'backbone_2d'</span><span class="token punctuation">,</span> <span class="token string">'dense_head'</span><span class="token punctuation">,</span>  <span class="token string">'point_head'</span><span class="token punctuation">,</span> <span class="token string">'roi_head'</span>        <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯¥ç±»çš„æ ¸å¿ƒæ–¹æ³•æœ‰ä¸‰ä¸ªä¸»è¦åŠŸèƒ½ï¼š</p><ol><li>æ„é€ ç½‘ç»œç»“æ„æ–¹æ³•</li><li>åå¤„ç†æ–¹æ³•ï¼Œå¯¹ NMS ç®—æ³•å’Œ recall æ•°æ®éƒ½åœ¨è¿™ä¸ªéƒ¨åˆ†å®ç°</li><li>è½½å…¥å‚æ•°æ–¹æ³•ï¼Œå°† checkpoint ä¸­çš„å‚æ•°è½½å…¥æ¨¡å‹ä¸­</li></ol><p>è¿™é‡Œä¸»è¦å¯¹å‰ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œæ•´ç†</p><h4 id="build-networks"><a href="#build-networks" class="headerlink" title="build_networks"></a>build_networks</h4><p>è¯¥æ–¹æ³•æœ€ç»ˆè¿”å›ä¸€ä¸ª <code>module_list</code> ä¿å­˜å„ä¸ªç»“æ„çš„æ¨¡å—ï¼Œåœ¨ä¹‹åçš„å‘å‰ä¼ æ’­è·¯å¾„ä¸­ï¼Œæ•°æ®å°†æŒ‰é¡ºåºç»è¿‡å„ä¸ªæ¨¡å—ã€‚<code>model_info_dict</code> è¿˜ç”¨äºè®°å½•æ¯ä¸ªæ¨¡å—è¾“å‡ºçš„ç‰¹å¾æ•°/é€šé“æ•°ä¹‹ç±»çš„ä¿¡æ¯ï¼Œä»¥ä¾¿äºä¼ å…¥ä¸‹ä¸€ä¸ªæ¨¡å—è¿›è¡Œåˆå§‹åŒ–ï¼Œå½“ç„¶åˆå§‹åŒ–è¿‡ç¨‹è¿˜è¦ç»“åˆ <code>self.model_cfg</code> ä¼ å…¥å¿…è¦å‚æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">build_networks</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># åˆ›å»ºä¸€ä¸ª module info dict å‚¨å­˜æ¨¡å‹ä¸­çš„å„ä¸ªæ¨¡å—ä¸æ¨¡å‹ä¿¡æ¯</span>    model_info_dict <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">'module_list'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token comment"># ä¸‹é¢ä¸¤ä¸ª featrue åˆå§‹åŒ–éƒ½æ˜¯ 4 (x, y, z, intensity)</span>        <span class="token string">'num_rawpoint_features'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>point_feature_encoder<span class="token punctuation">.</span>num_point_features<span class="token punctuation">,</span>        <span class="token string">'num_point_features'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>point_feature_encoder<span class="token punctuation">.</span>num_point_features<span class="token punctuation">,</span>        <span class="token string">'grid_size'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>grid_size<span class="token punctuation">,</span>        <span class="token string">'point_cloud_range'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>point_cloud_range<span class="token punctuation">,</span>        <span class="token string">'voxel_size'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>voxel_size<span class="token punctuation">,</span>        <span class="token comment"># æœ‰çš„æ²¡æœ‰ downsample ä¸º None</span>        <span class="token string">'depth_downsample_factor'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>depth_downsample_factor    <span class="token punctuation">}</span>    <span class="token keyword">for</span> module_name <span class="token keyword">in</span> self<span class="token punctuation">.</span>module_topology<span class="token punctuation">:</span>        module<span class="token punctuation">,</span> model_info_dict <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'build_%s'</span> <span class="token operator">%</span> module_name<span class="token punctuation">)</span><span class="token punctuation">(</span>            model_info_dict<span class="token operator">=</span>model_info_dict        <span class="token punctuation">)</span>        self<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span>module_name<span class="token punctuation">,</span> module<span class="token punctuation">)</span>        <span class="token keyword">return</span> model_info_dict<span class="token punctuation">[</span><span class="token string">'module_list'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="post-processing"><a href="#post-processing" class="headerlink" title="post_processing"></a>post_processing</h4><p>è¯¥æ–¹æ³•ä»…åœ¨æµ‹è¯•çš„æ—¶å€™è¢«è°ƒç”¨ï¼Œå…¶åŠŸèƒ½æ˜¯ä½¿ç”¨ NMS ç®—æ³•ç­›é€‰å‡ºæœ€ç»ˆçš„é€‰æ¡†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">post_processing</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token string">""</span>"        Args<span class="token punctuation">:</span>            batch_dict<span class="token punctuation">:</span>                batch_size<span class="token punctuation">:</span>                batch_cls_preds<span class="token punctuation">:</span> <span class="token punctuation">(</span>B<span class="token punctuation">,</span> num_boxes<span class="token punctuation">,</span> num_classes <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span>N1<span class="token operator">+</span>N2<span class="token operator">+</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> num_classes <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">)</span>                                <span class="token keyword">or</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span> num_boxes<span class="token punctuation">,</span> num_class1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>B<span class="token punctuation">,</span> num_boxes<span class="token punctuation">,</span> num_class2<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>                <span class="token punctuation">(</span><span class="token keyword">not</span> often<span class="token punctuation">)</span> multihead_label_mapping<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>num_class1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>num_class2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>                batch_box_preds<span class="token punctuation">:</span> <span class="token punctuation">(</span>B<span class="token punctuation">,</span> num_boxes<span class="token punctuation">,</span> <span class="token number">7</span><span class="token operator">+</span>C<span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span>N1<span class="token operator">+</span>N2<span class="token operator">+</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token operator">+</span>C<span class="token punctuation">)</span>                cls_preds_normalized<span class="token punctuation">:</span> indicate whether batch_cls_preds <span class="token keyword">is</span> normalized                batch_index<span class="token punctuation">:</span> optional <span class="token punctuation">(</span>N1<span class="token operator">+</span>N2<span class="token operator">+</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>                has_class_labels<span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token operator">/</span><span class="token boolean">False</span>                roi_labels<span class="token punctuation">:</span> <span class="token punctuation">(</span>B<span class="token punctuation">,</span> num_rois<span class="token punctuation">)</span>  <span class="token number">1</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> num_classes                batch_pred_labels<span class="token punctuation">:</span> <span class="token punctuation">(</span>B<span class="token punctuation">,</span> num_boxes<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        Returns<span class="token punctuation">:</span>        <span class="token operator">-</span> pred_dicts<span class="token punctuation">:</span> å®é™…æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶æˆå‘˜æ˜¯å­—å…¸                <span class="token operator">-</span> pred_boxes                    <span class="token operator">-</span> pred_scores                    <span class="token operator">-</span> pred_labels<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šå°±æ˜¯æ¨¡æ¿æ£€æµ‹å™¨çš„ä¸»è¦åŠŸèƒ½ï¼Œä¸‹é¢çœ‹çœ‹ SECOND ç±»æ˜¯æ€ä¹ˆåœ¨åŸºç±»ä¸Šåˆ›å»ºçš„</p><h3 id="SECOND"><a href="#SECOND" class="headerlink" title="SECOND"></a>SECOND</h3><p>å…¶å® SECOND ç±»çš„å®ç°åœ¨åŸºç±»ä¹‹ä¸Šæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸»è¦éœ€è¦å®šä¹‰ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ol><li>è°ƒç”¨åŸºç±»çš„ <code>build_networks</code> å®ç°æ¨¡å‹æ„å»º</li><li>å®šä¹‰å‰å‘æ–¹ç¨‹</li></ol><p>æ¨¡å‹çš„æ„å»ºåœ¨åˆå§‹åŒ–ä¸­å®Œæˆï¼Œåªç”¨ä¸¤è¡Œä»£ç å°±å®Œæˆäº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SECONDNet</span><span class="token punctuation">(</span>Detector3DTemplate<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_cfg<span class="token punctuation">,</span> num_class<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>model_cfg<span class="token operator">=</span>model_cfg<span class="token punctuation">,</span> num_class<span class="token operator">=</span>num_class<span class="token punctuation">,</span> dataset<span class="token operator">=</span>dataset<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>module_list <span class="token operator">=</span> self<span class="token punctuation">.</span>build_networks<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="forward"><a href="#forward" class="headerlink" title="forward"></a>forward</h4><p>å‰å‘æ–¹ç¨‹ <code>forward</code> ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æ•°æ®æŒ‰é¡ºåºè¾“å…¥å„ä¸ªæ¨¡å—ä¸­ï¼Œæœ€åæ ¹æ®æ¨¡å¼è¿”å›æŸå¤±å‡½æ•°æˆ–è€…é¢„æµ‹ç»“æœï¼Œå…¶ä¸­æŸå¤±å‡½æ•°ä¸€èˆ¬å®šä¹‰åœ¨ </p><p><code>dense_head</code> å½“ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_dict<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> cur_module <span class="token keyword">in</span> self<span class="token punctuation">.</span>module_list<span class="token punctuation">:</span>        batch_dict <span class="token operator">=</span> cur_module<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>    <span class="token comment"># æ¯ä¸€ä¸ª batch çš„ loss (cls_loss + reg_loss +...)</span>    <span class="token comment"># tb_dict æ˜¯ tensor.item() ç”¨äº tensorboard å¯è§†åŒ–</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>        loss<span class="token punctuation">,</span> tb_dict<span class="token punctuation">,</span> disp_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>get_training_loss<span class="token punctuation">(</span><span class="token punctuation">)</span>        ret_dict <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'loss'</span><span class="token punctuation">:</span> loss        <span class="token punctuation">}</span>        <span class="token keyword">return</span> ret_dict<span class="token punctuation">,</span> tb_dict<span class="token punctuation">,</span> disp_dict    <span class="token keyword">else</span><span class="token punctuation">:</span>        pred_dicts<span class="token punctuation">,</span> recall_dicts <span class="token operator">=</span> self<span class="token punctuation">.</span>post_processing<span class="token punctuation">(</span>batch_dict<span class="token punctuation">)</span>        <span class="token keyword">return</span> pred_dicts<span class="token punctuation">,</span> recall_dicts <span class="token keyword">def</span> <span class="token function">get_training_loss</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    disp_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    loss_rpn<span class="token punctuation">,</span> tb_dict <span class="token operator">=</span> self<span class="token punctuation">.</span>dense_head<span class="token punctuation">.</span>get_loss<span class="token punctuation">(</span><span class="token punctuation">)</span>    tb_dict <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">'loss_rpn'</span><span class="token punctuation">:</span> loss_rpn<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">**</span>tb_dict    <span class="token punctuation">}</span>    loss <span class="token operator">=</span> loss_rpn    <span class="token keyword">return</span> loss<span class="token punctuation">,</span> tb_dict<span class="token punctuation">,</span> disp_dict<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦æ·±å…¥å­¦ä¹ è¿˜å¾—çœ‹æ¯ä¸ªå­æ¨¡å—çš„å…·ä½“å®ç°ï¼Œç»§ç»­ç—›è‹¦çš„æºç é˜…è¯»ï¼ŒVoxel R-CNN æˆ‘æ¥äº†â€¦</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenPCDet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 10 æ³¨æ„åŠ›æœºåˆ¶</title>
      <link href="/archives/b7d04b34.html"/>
      <url>/archives/b7d04b34.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-10-æ³¨æ„åŠ›æœºåˆ¶"><a href="#D2L-10-æ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="D2L 10 æ³¨æ„åŠ›æœºåˆ¶"></a>D2L 10 æ³¨æ„åŠ›æœºåˆ¶</h1><p>555ç»ˆäºå¯ä»¥å¼€å§‹çœ‹æ³¨æ„åŠ›æœºåˆ¶äº†ğŸ˜†Transformer æˆ‘æ¥å•¦ï¼</p><h2 id="æ³¨æ„åŠ›æç¤º"><a href="#æ³¨æ„åŠ›æç¤º" class="headerlink" title="æ³¨æ„åŠ›æç¤º"></a>æ³¨æ„åŠ›æç¤º</h2><h3 id="ç”Ÿç‰©å­¦ä¸­çš„æ³¨æ„åŠ›æç¤º"><a href="#ç”Ÿç‰©å­¦ä¸­çš„æ³¨æ„åŠ›æç¤º" class="headerlink" title="ç”Ÿç‰©å­¦ä¸­çš„æ³¨æ„åŠ›æç¤º"></a>ç”Ÿç‰©å­¦ä¸­çš„æ³¨æ„åŠ›æç¤º</h3><p>ä¸»è¦æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>éè‡ªä¸»æ€§æç¤º/ééšæ„çº¿ç´¢</strong>ï¼ˆnon-volitional cueï¼‰ï¼ŒåŸºäºç¯å¢ƒä¸­ç‰©ä½“çš„çªå‡ºæ€§å’Œæ˜“è§æ€§</li><li><strong>è‡ªä¸»æ€§æç¤º/éšæ„çº¿ç´¢</strong>ï¼ˆvolitional cueï¼‰ï¼Œå—ä¸»è§‚æ„æ„¿æ¨åŠ¨</li></ol><h3 id="æŸ¥è¯¢ã€é”®å’Œå€¼"><a href="#æŸ¥è¯¢ã€é”®å’Œå€¼" class="headerlink" title="æŸ¥è¯¢ã€é”®å’Œå€¼"></a>æŸ¥è¯¢ã€é”®å’Œå€¼</h3><p>æ•™æå¯¹äºè¿™ä¸‰ä¸ªæ¦‚å¿µçš„è§£é‡Šå¹¶ä¸æ¸…æ™°ï¼Œè¿˜æ˜¯çœ‹æ²ç¥çš„è®²è§£å§ <a href="https://www.bilibili.com/video/BV1264y1i7R1?p=1&amp;t=447">bilibili</a></p><p>å·ç§¯ã€å…¨è¿æ¥ã€æ± åŒ–å±‚éƒ½åªè€ƒè™‘ä¸éšæ„çº¿ç´¢ï¼Œæ³¨æ„åŠ›æœºåˆ¶åˆ™æ˜¾å¼åœ°è€ƒè™‘éšæ„çº¿ç´¢ï¼š</p><ol><li>éšæ„çº¿ç´¢è¢«ç§°ä¹‹ä¸ºæŸ¥è¯¢ï¼ˆqueryï¼‰</li><li>æ¯ä¸ª<strong>è¾“å…¥</strong>æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ (key, value)ï¼Œå…¶ä¸­ key å¯è§†ä¸ºééšæ„çº¿ç´¢ï¼Œï¼ˆä¸‹é¢è¿™å¥æ˜¯æˆ‘è‡ªå·±ä¹±æƒ³çš„ï¼‰value å¯ä»¥è§†ä¸ºè¯¥çº¿ç´¢çš„ç›¸å…³å±æ€§</li><li>é€šè¿‡æ³¨æ„åŠ›æ± åŒ–å±‚æ¥æœ‰åå‘æ€§çš„é€‰æ‹©æŸäº›è¾“å…¥</li></ol><h3 id="éå‚æ•°æ³¨æ„åŠ›æ±‡èšï¼šNadaraya-Watson-æ ¸å›å½’"><a href="#éå‚æ•°æ³¨æ„åŠ›æ±‡èšï¼šNadaraya-Watson-æ ¸å›å½’" class="headerlink" title="éå‚æ•°æ³¨æ„åŠ›æ±‡èšï¼šNadaraya-Watson æ ¸å›å½’"></a>éå‚æ•°æ³¨æ„åŠ›æ±‡èšï¼šNadaraya-Watson æ ¸å›å½’</h3><p>å®é™…ä¸Šä¸€ä¸ªæ•°å­¦è¡¨è¾¾çš„ä¾‹å­èƒ½å¤Ÿæ›´æ¸…æ¥šå±•ç¤ºè¿™ä¸‰ä¸ªæ¦‚å¿µã€‚ç»™å®šæ•°æ® $(x_i, y_i), i=1,â€¦,n$</p><p>ç»™å®šæŸ¥è¯¢ $x$ï¼Œå¹³å‡æ± åŒ–å°†è·å¾—è¾“å‡º</p><script type="math/tex; mode=display">f(x) = \frac{1}{n}\sum_{i}{y_i}</script><p>è¿™å°±æ˜¯æ²¡æœ‰æ³¨æ„åŠ›æœºåˆ¶çš„æƒ…å†µï¼Œä¸æŸ¥è¯¢å€¼æ— å…³ï¼Œå…¨å‡­ééšæ„çº¿ç´¢è·å¾—è¾“å‡ºã€‚è€Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯60å¹´ä»£æå‡ºæ¥çš„ Nadaraya-Waston æ ¸å›å½’</p><script type="math/tex; mode=display">f(x)=\sum_{i=1}^{n} \frac{K\left(x-x_{i}\right)}{\sum_{j=1}^{n} K\left(x-x_{j}\right)} y_{i}</script><p>å…¶ä¸­ K å¯ä»¥çœ‹ä½œä¸€ä¸ªæ ¸å‡½æ•°ï¼Œä¾‹å¦‚ä¸€ä¸ªé«˜æ–¯æ ¸ï¼Œç”¨äºè¡¡é‡ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»</p><script type="math/tex; mode=display">K(u)=\frac{1}{\sqrt{2 \pi}} \exp \left(-\frac{u^{2}}{2}\right)</script><p>è¿™å°±å°†æ³¨æ„åŠ›æœºåˆ¶æ˜¾å¼åœ°ç”¨äºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯ç»™å„ä¸ª value åŠ å…¥ç›¸å…³æƒé‡ã€‚ç°åœ¨å†æ¥çœ‹è¿™ä¸ªå›¾ç¤ºå¯èƒ½ä¼šæ›´å¥½</p><p><img src="/archives/b7d04b34/image-20211210215054690.png" style="zoom:80%;"></p><h3 id="å¸¦å‚æ•°æ³¨æ„åŠ›æ±‡èš"><a href="#å¸¦å‚æ•°æ³¨æ„åŠ›æ±‡èš" class="headerlink" title="å¸¦å‚æ•°æ³¨æ„åŠ›æ±‡èš"></a>å¸¦å‚æ•°æ³¨æ„åŠ›æ±‡èš</h3><p>éå‚æ•°çš„Nadaraya-Watsonæ ¸å›å½’å…·æœ‰ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰çš„ä¼˜ç‚¹ï¼šå¦‚æœæœ‰è¶³å¤Ÿçš„æ•°æ®ï¼Œæ­¤æ¨¡å‹ä¼šæ”¶æ•›åˆ°æœ€ä¼˜ç»“æœã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥è½»æ¾åœ°å°†å¯å­¦ä¹ çš„å‚æ•°é›†æˆåˆ°æ³¨æ„åŠ›æ±‡èšä¸­</p><script type="math/tex; mode=display">\begin{aligned}f(x) &=\sum_{i=1}^{n} \alpha\left(x, x_{i}\right) y_{i} \\&=\sum_{i=1}^{n} \frac{\exp \left(-\frac{1}{2}\left(\left(x-x_{i}\right) w\right)^{2}\right)}{\sum_{j=1}^{n} \exp \left(-\frac{1}{2}\left(\left(x-x_{j}\right) w\right)^{2}\right)} y_{i} \\&=\sum_{i=1}^{n} \operatorname{softmax}\left(-\frac{1}{2}\left(\left(x-x_{i}\right) w\right)^{2}\right) y_{i} .\end{aligned}</script><p>æ³¨æ„è¿™é‡Œ $w$ åªæ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œå¦‚æœ $w$ è¶Šå¤§è¯´æ˜è¶Šæ³¨æ„è¿‘è·ç¦»çš„é”®å€¼ã€‚è¿™é‡Œæä¸€ä¸‹ï¼Œä¸€ä¸ªè®­ç»ƒæ ·æœ¬çš„è¾“å…¥éƒ½ä¼šå’Œ<strong>é™¤è‡ªå·±ä»¥å¤–</strong>çš„æ‰€æœ‰è®­ç»ƒæ ·æœ¬çš„â€œé”®ï¼å€¼â€å¯¹è¿›è¡Œè®¡ç®—ï¼Œå¦‚æœåŠ å…¥è‡ªå·±çš„ key é‚£ä¹ˆè®­ç»ƒç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œå°±æ˜¯ç»™è‡ªå·±çš„ key åŠ å…¥å¾ˆå¤§çš„æƒé‡</p><h3 id="æ³¨æ„åŠ›å¯è§†åŒ–"><a href="#æ³¨æ„åŠ›å¯è§†åŒ–" class="headerlink" title="æ³¨æ„åŠ›å¯è§†åŒ–"></a>æ³¨æ„åŠ›å¯è§†åŒ–</h3><p>å¹³å‡æ± åŒ–å¯ä»¥è¢«è§†ä¸ºè¾“å…¥çš„åŠ æƒå¹³å‡å€¼ï¼Œåªæ˜¯æƒé‡ç›¸ç­‰ã€‚è€Œæ³¨æ„åŠ›æ± åŒ–åˆ™æ˜¯çœŸæ­£çš„åŠ æƒå¹³å‡ï¼Œå…¶ä¸­æƒé‡æ˜¯åœ¨ç»™å®šçš„æŸ¥è¯¢ query å’Œä¸åŒçš„é”® key ä¹‹é—´è®¡ç®—å¾—å‡ºçš„ã€‚æ•™æè¿™é‡Œå†™äº†ä¸€äº›ä»£ç ï¼Œåœ¨ä¹‹åç”¨äºæ³¨æ„åŠ›å¯è§†åŒ–ï¼Œä»¥æç»˜å›¾åƒ $weight = f(query, key)$ ï¼Œè¿™é‡Œç›´æ¥çœ‹çœ‹ä¸Šä¸€å°èŠ‚ä¸­çš„éå‚ N-W æ ¸å›å½’ï¼ˆå·¦ä¾§ï¼‰ &amp; å¸¦å‚ N-W æ ¸å›å½’ï¼ˆå³ä¾§ï¼‰çš„å›¾åƒ</p><p><img src="/archives/b7d04b34/image-20211212175647738.png" style="zoom:80%;"></p><p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°æ³¨æ„åŠ›æƒé‡åœ¨ $query = key$ çš„æ—¶å€™åŠ é‡äº†</p><h2 id="æ³¨æ„åŠ›è¯„åˆ†å‡½æ•°"><a href="#æ³¨æ„åŠ›è¯„åˆ†å‡½æ•°" class="headerlink" title="æ³¨æ„åŠ›è¯„åˆ†å‡½æ•°"></a>æ³¨æ„åŠ›è¯„åˆ†å‡½æ•°</h2><p>æˆ‘ä»¬å¯ä»¥å°†ä¸Šä¸€èŠ‚ä¸­çš„é«˜æ–¯æ ¸æŒ‡æ•°éƒ¨åˆ†è§†ä¸ºæ³¨æ„åŠ›è¯„åˆ†å‡½æ•°ï¼ˆattention scoring functionï¼‰ï¼Œç®€ç§°è¯„åˆ†å‡½æ•°ï¼ˆscoring functionï¼‰ï¼Œç„¶åæŠŠè¿™ä¸ªå‡½æ•°çš„è¾“å‡ºç»“æœè¾“å…¥åˆ° softmax å‡½æ•°ä¸­è¿›è¡Œè¿ç®—ï¼ˆè¿™æ ·å°±èƒ½ä½¿è¯„åˆ†ä»¥æ¦‚ç‡åˆ†å¸ƒå½¢å¼å±•ç°ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½¿æƒé‡çš„å’Œä¸ºä¸€ï¼‰</p><p>è®© score function è¡¨ç¤ºæ›´åŠ æ•°å­¦åŒ–</p><script type="math/tex; mode=display">\alpha\left(\mathbf{q}, \mathbf{k}_{i}\right)=\operatorname{softmax}\left(a\left(\mathbf{q}, \mathbf{k}_{i}\right)\right)=\frac{\exp \left(a\left(\mathbf{q}, \mathbf{k}_{i}\right)\right)}{\sum_{j=1}^{m} \exp \left(a\left(\mathbf{q}, \mathbf{k}_{j}\right)\right)} \in \mathbb{R}</script><p>æ­¤æ—¶æ³¨æ„åŠ›æ±‡èšå‡½æ•° $f$ å°±è¢«è¡¨ç¤ºä¸º</p><script type="math/tex; mode=display">f\left(\mathbf{q},\left(\mathbf{k}_{1}, \mathbf{v}_{1}\right), \ldots,\left(\mathbf{k}_{m}, \mathbf{v}_{m}\right)\right)=\sum_{i=1}^{m} \alpha\left(\mathbf{q}, \mathbf{k}_{i}\right) \mathbf{v}_{i} \in \mathbb{R}^{v}</script><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸¤ä¸ªæµè¡Œçš„è¯„åˆ†å‡½æ•°ï¼Œç¨åå°†ç”¨ä»–ä»¬æ¥å®ç°æ›´å¤æ‚çš„æ³¨æ„åŠ›æœºåˆ¶</p><h3 id="æ©è”½-softmax-æ“ä½œ"><a href="#æ©è”½-softmax-æ“ä½œ" class="headerlink" title="æ©è”½ softmax æ“ä½œ"></a>æ©è”½ softmax æ“ä½œ</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¹¶éæ‰€æœ‰çš„å€¼éƒ½åº”è¯¥è¢«çº³å…¥åˆ°æ³¨æ„åŠ›æ±‡èšä¸­ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†é«˜æ•ˆå¤„ç†å°æ‰¹é‡æ•°æ®é›†ï¼ŒæŸäº›æ–‡æœ¬åºåˆ—è¢«å¡«å……äº†æ²¡æœ‰æ„ä¹‰çš„ç‰¹æ®Šè¯å…ƒã€‚ä¸ºäº†ä»…å°†æœ‰æ„ä¹‰çš„è¯å…ƒä½œä¸ºå€¼æ¥è·å–æ³¨æ„åŠ›æ±‡èšï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªæœ‰æ•ˆåºåˆ—é•¿åº¦ï¼Œä»¥ä¾¿åœ¨è®¡ç®—softmaxæ—¶è¿‡æ»¤æ‰è¶…å‡ºæŒ‡å®šèŒƒå›´çš„ä½ç½®ã€‚çœ‹çœ‹å¤§æ¦‚æ•ˆæœæ˜¯ä»€ä¹ˆæ ·å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># (batch, num_query, num_key)</span>masked_softmax<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.4527</span><span class="token punctuation">,</span> <span class="token number">0.5473</span><span class="token punctuation">,</span> <span class="token number">0.0000</span><span class="token punctuation">,</span> <span class="token number">0.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token number">0.3458</span><span class="token punctuation">,</span> <span class="token number">0.6542</span><span class="token punctuation">,</span> <span class="token number">0.0000</span><span class="token punctuation">,</span> <span class="token number">0.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.4151</span><span class="token punctuation">,</span> <span class="token number">0.3528</span><span class="token punctuation">,</span> <span class="token number">0.2321</span><span class="token punctuation">,</span> <span class="token number">0.0000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token number">0.2604</span><span class="token punctuation">,</span> <span class="token number">0.2631</span><span class="token punctuation">,</span> <span class="token number">0.4765</span><span class="token punctuation">,</span> <span class="token number">0.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŠ æ€§æ³¨æ„åŠ›"><a href="#åŠ æ€§æ³¨æ„åŠ›" class="headerlink" title="åŠ æ€§æ³¨æ„åŠ›"></a>åŠ æ€§æ³¨æ„åŠ›</h3><p>å½“æŸ¥è¯¢å’Œé”®æ˜¯ä¸åŒé•¿åº¦çš„çŸ¢é‡æ—¶ï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ æ€§æ³¨æ„åŠ›ï¼ˆadditive attentionï¼‰ä½œä¸ºè¯„åˆ†å‡½æ•°</p><script type="math/tex; mode=display">a(\mathbf{q}, \mathbf{k})=\mathbf{w}_{v}^{\top} \tanh \left(\mathbf{W}_{q} \mathbf{q}+\mathbf{W}_{k} \mathbf{k}\right) \in \mathbb{R}</script><p>ä¸Šä»£ç ï¼Œæ³¨æ„ä»£ç ä¸­å¯¹ query, key, value çš„æ•°é‡ï¼ˆsequence length / time stepï¼‰å…·æœ‰ä¸€èˆ¬æ€§ï¼Œå®ƒä»¬çš„å½¢çŠ¶è¡¨ç¤ºä¸º (batch_size, seq_len, feature)ï¼Œæ•™æä¸­ä½¿ç”¨çš„ query, key, value å…·ä½“å½¢çŠ¶ä¸ºï¼š(2, 1, 20)ï¼Œ(2, 10, 2) å’Œ (2, 10, 4)ï¼Œå…·ä½“èµ°ä¸€éä¼šæ¯”è¾ƒæ¸…æ™°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">AdditiveAttention</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""åŠ æ€§æ³¨æ„åŠ›"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>AdditiveAttention<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        <span class="token comment"># æ— åç½®</span>        <span class="token comment"># nn.Linear çš„ input ä¸º (*,H_in) * ä»£è¡¨ä»»æ„æ•°é‡çš„ç»´åº¦ï¼ŒåŒ…æ‹¬ none </span>        self<span class="token punctuation">.</span>W_k <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>key_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>W_q <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>query_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>w_v <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queries<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> values<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span class="token punctuation">:</span>        queries<span class="token punctuation">,</span> keys <span class="token operator">=</span> self<span class="token punctuation">.</span>W_q<span class="token punctuation">(</span>queries<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>W_k<span class="token punctuation">(</span>keys<span class="token punctuation">)</span>        <span class="token comment"># åœ¨ç»´åº¦æ‰©å±•åï¼Œ</span>        <span class="token comment"># queriesçš„å½¢çŠ¶ï¼š(batch_sizeï¼ŒæŸ¥è¯¢çš„ä¸ªæ•°ï¼Œ1ï¼Œnum_hidden)</span>        <span class="token comment"># keyçš„å½¢çŠ¶ï¼š(batch_sizeï¼Œ1ï¼Œâ€œé”®ï¼å€¼â€å¯¹çš„ä¸ªæ•°ï¼Œnum_hiddens)</span>        <span class="token comment"># ä½¿ç”¨å¹¿æ’­æ–¹å¼è¿›è¡Œæ±‚å’Œ</span>        features <span class="token operator">=</span> queries<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> keys<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        features <span class="token operator">=</span> torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>features<span class="token punctuation">)</span>        <span class="token comment"># self.w_vä»…æœ‰ä¸€ä¸ªè¾“å‡ºï¼Œå› æ­¤ä»å½¢çŠ¶ä¸­ç§»é™¤æœ€åé‚£ä¸ªç»´åº¦ã€‚</span>        <span class="token comment"># scoresçš„å½¢çŠ¶ï¼š(batch_sizeï¼ŒæŸ¥è¯¢çš„ä¸ªæ•°ï¼Œâ€œé”®-å€¼â€å¯¹çš„ä¸ªæ•°)</span>        scores <span class="token operator">=</span> self<span class="token punctuation">.</span>w_v<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>attention_weights <span class="token operator">=</span> masked_softmax<span class="token punctuation">(</span>scores<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span>        <span class="token comment"># valuesçš„å½¢çŠ¶ï¼š(batch_sizeï¼Œâ€œé”®ï¼å€¼â€å¯¹çš„ä¸ªæ•°ï¼Œå€¼çš„ç»´åº¦)</span>        <span class="token comment"># ä½¿ç”¨ batch matrix multiplicationï¼ˆ@ é‡è½½ç¬¦æ—¢å¯ä»¥è®¡ç®— mm åˆå¯ä»¥è®¡ç®— bmmï¼‰</span>        <span class="token comment"># ä½¿ç”¨ dropout è¿›è¡Œæ­£åˆ™åŒ–</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>attention_weights<span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œä¸‹é¢çš„ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python">queries<span class="token punctuation">,</span> keys <span class="token operator">=</span> torch<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># valuesçš„å°æ‰¹é‡ï¼Œä¸¤ä¸ªå€¼çŸ©é˜µæ˜¯ç›¸åŒçš„</span>values <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span>    <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>valid_lens <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>attention <span class="token operator">=</span> AdditiveAttention<span class="token punctuation">(</span>key_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> query_size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> num_hiddens<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>                              dropout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>attention<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>attention<span class="token punctuation">(</span>queries<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> values<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœå¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">2.0000</span><span class="token punctuation">,</span>  <span class="token number">3.0000</span><span class="token punctuation">,</span>  <span class="token number">4.0000</span><span class="token punctuation">,</span>  <span class="token number">5.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10.0000</span><span class="token punctuation">,</span> <span class="token number">11.0000</span><span class="token punctuation">,</span> <span class="token number">12.0000</span><span class="token punctuation">,</span> <span class="token number">13.0000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>BmmBackward0<span class="token operator">&gt;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›"><a href="#ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›" class="headerlink" title="ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›"></a>ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›</h3><p>ä½¿ç”¨ç‚¹ç§¯å¯ä»¥å¾—åˆ°è®¡ç®—æ•ˆç‡æ›´é«˜çš„è¯„åˆ†å‡½æ•°ï¼Œä½†æ˜¯ç‚¹ç§¯æ“ä½œè¦æ±‚æŸ¥è¯¢å’Œé”®å…·æœ‰ç›¸åŒçš„é•¿åº¦ d</p><p>å‡è®¾æŸ¥è¯¢å’Œé”®çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ç‹¬ç«‹çš„éšæœºå˜é‡ï¼Œ å¹¶ä¸”éƒ½æ»¡è¶³é›¶å‡å€¼å’Œå•ä½æ–¹å·®ï¼Œ é‚£ä¹ˆä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯çš„å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º dã€‚ä¸ºç¡®ä¿æ— è®ºå‘é‡é•¿åº¦å¦‚ä½•ï¼Œç‚¹ç§¯çš„æ–¹å·®åœ¨ä¸è€ƒè™‘å‘é‡é•¿åº¦çš„æƒ…å†µä¸‹ä»ç„¶æ˜¯1ï¼Œæˆ‘ä»¬å°†ç‚¹ç§¯é™¤ä»¥ $\sqrt d$</p><script type="math/tex; mode=display">a(\mathbf{q}, \mathbf{k})=\mathbf{q}^{\top} \mathbf{k} / \sqrt{d}</script><p>æŸ¥è¯¢ $Q\in R^{n\times d}$ï¼Œé”® $K \in R^{m \times d}$ ï¼Œå€¼ $V \in R^{m \times v}$ çš„ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼ˆscaled dot-product attentionï¼‰æ˜¯ï¼š</p><script type="math/tex; mode=display">\operatorname{softmax}\left(\frac{\mathbf{Q K}^{\top}}{\sqrt{d}}\right) \mathbf{V} \in \mathbb{R}^{n \times v}</script><p>å®ƒçš„ä»£ç å°±ç›¸å¯¹ç®€å•ä¸€äº›</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">DotProductAttention</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>DotProductAttention<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>    <span class="token comment"># queriesçš„å½¢çŠ¶ï¼š(batch_sizeï¼ŒæŸ¥è¯¢çš„ä¸ªæ•°ï¼Œd)</span>    <span class="token comment"># keysçš„å½¢çŠ¶ï¼š(batch_sizeï¼Œâ€œé”®ï¼å€¼â€å¯¹çš„ä¸ªæ•°ï¼Œd)</span>    <span class="token comment"># valuesçš„å½¢çŠ¶ï¼š(batch_sizeï¼Œâ€œé”®ï¼å€¼â€å¯¹çš„ä¸ªæ•°ï¼Œå€¼çš„ç»´åº¦)</span>    <span class="token comment"># valid_lensçš„å½¢çŠ¶:(batch_sizeï¼Œ)æˆ–è€…(batch_sizeï¼ŒæŸ¥è¯¢çš„ä¸ªæ•°)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queries<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> values<span class="token punctuation">,</span> valid_lens<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        d <span class="token operator">=</span> queries<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token comment"># è®¾ç½®transpose_b=Trueä¸ºäº†äº¤æ¢keysçš„æœ€åä¸¤ä¸ªç»´åº¦</span>        scores <span class="token operator">=</span> torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>queries<span class="token punctuation">,</span> keys<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>d<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>attention_weights <span class="token operator">=</span> masked_softmax<span class="token punctuation">(</span>scores<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>bmm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>self<span class="token punctuation">.</span>attention_weights<span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Bahdanau-æ³¨æ„åŠ›"><a href="#Bahdanau-æ³¨æ„åŠ›" class="headerlink" title="Bahdanau æ³¨æ„åŠ›"></a>Bahdanau æ³¨æ„åŠ›</h2><p>ä¹‹å‰æ•™æè®¨è®ºäº†æœºå™¨ç¿»è¯‘é—®é¢˜ï¼šé€šè¿‡ç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼Œç”¨äºåºåˆ—åˆ°åºåˆ—å­¦ä¹ ã€‚å…·ä½“æ¥è¯´ï¼Œç¼–ç å™¨å°†é•¿åº¦å¯å˜çš„åºåˆ—è½¬æ¢ä¸ºå›ºå®šå½¢çŠ¶çš„ä¸Šä¸‹æ–‡å˜é‡ï¼Œç„¶åè§£ç å™¨æ ¹æ®ç”Ÿæˆçš„è¯å…ƒå’Œä¸Šä¸‹æ–‡å˜é‡æŒ‰è¯å…ƒç”Ÿæˆè¾“å‡ºï¼ˆç›®æ ‡ï¼‰åºåˆ—è¯å…ƒã€‚ç„¶è€Œï¼Œå³ä½¿å¹¶éæ‰€æœ‰è¾“å…¥ï¼ˆæºï¼‰è¯å…ƒéƒ½å¯¹è§£ç æŸä¸ªè¯å…ƒéƒ½æœ‰ç”¨ï¼Œä½†æˆ‘ä»¬åœ¨æ¯ä¸ªè§£ç æ­¥éª¤ä¸­ä»ä½¿ç”¨ç¼–ç ç›¸åŒçš„ä¸Šä¸‹æ–‡å˜é‡</p><p>æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½åœ¨ä¸åŒè§£ç æ­¥éª¤ä¸­ï¼Œ<strong>ä½¿ç”¨ä¸åŒçš„ä¸Šä¸‹æ–‡å˜é‡</strong>å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ Bahdanau æ³¨æ„åŠ›æœºåˆ¶å°±ç™»åœºäº†ï¼Œä¸‹é¢å…·ä½“æ¥çœ‹çœ‹å§</p><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>ä¸Šä¸‹æ–‡å˜é‡ä»»æ„è§£ç æ—¶é—´æ­¥ $tâ€™$ ä¼šè¢«æ›¿æ¢ä¸º $c_{tâ€™}$</p><script type="math/tex; mode=display">\mathbf{c}_{t^{\prime}}=\sum_{t=1}^{T} \alpha\left(\mathbf{s}_{t^{\prime}-1}, \mathbf{h}_{t}\right) \mathbf{h}_{t}</script><p>å…¶ä¸­ï¼Œ$h_t$ ä¸º<strong>ç¼–ç å™¨</strong> t æ—¶é—´æ­¥çš„éšçŠ¶æ€ï¼Œå®ƒå³ä½¿ key åˆæ˜¯ valueï¼›$s_{tâ€™-1}$ ä¸º<strong>è§£ç å™¨</strong> $tâ€™-1$ æ—¶åˆ»æ­¥çš„éšçŠ¶æ€ï¼›æ³¨æ„åŠ›æƒé‡ $\alpha$ æ˜¯ä¹‹å‰å®šä¹‰çš„åŠ æ€§æ³¨æ„åŠ›æ‰“åˆ†å‡½æ•°ã€‚çœ‹ä¸€ä¸‹æ¨¡å‹ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Seq2SeqAttentionDecoder</span><span class="token punctuation">(</span>AttentionDecoder<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> embed_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span>                 dropout<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Seq2SeqAttentionDecoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>attention <span class="token operator">=</span> d2l<span class="token punctuation">.</span>AdditiveAttention<span class="token punctuation">(</span>            num_hiddens<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embed_size<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>rnn <span class="token operator">=</span> nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>            embed_size <span class="token operator">+</span> num_hiddens<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span>            dropout<span class="token operator">=</span>dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dense <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> vocab_size<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">init_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> enc_outputs<span class="token punctuation">,</span> enc_valid_lens<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># outputsçš„å½¢çŠ¶ä¸º(batch_sizeï¼Œnum_stepsï¼Œnum_hiddens).</span>        <span class="token comment"># hidden_stateçš„å½¢çŠ¶ä¸º(num_layersï¼Œbatch_sizeï¼Œnum_hiddens)</span>        outputs<span class="token punctuation">,</span> hidden_state <span class="token operator">=</span> enc_outputs        <span class="token keyword">return</span> <span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hidden_state<span class="token punctuation">,</span> enc_valid_lens<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># X.shape = (num_batch, num_steps) å­˜å‚¨è¯å…ƒçš„ç´¢å¼•</span>        <span class="token comment"># enc_outputsçš„å½¢çŠ¶ä¸º(batch_size,num_steps,num_hiddens).</span>        <span class="token comment"># hidden_stateçš„å½¢çŠ¶ä¸º(num_layers,batch_size,</span>        <span class="token comment"># num_hiddens)</span>        enc_outputs<span class="token punctuation">,</span> hidden_state<span class="token punctuation">,</span> enc_valid_lens <span class="token operator">=</span> state        <span class="token comment"># è¾“å‡ºXçš„å½¢çŠ¶ä¸º(num_steps,batch_size,embed_size)</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        outputs<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_attention_weights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> x <span class="token keyword">in</span> X<span class="token punctuation">:</span>            <span class="token comment"># queryçš„å½¢çŠ¶ä¸º(batch_size,1,num_hiddens)</span>            query <span class="token operator">=</span> torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>hidden_state<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment"># contextçš„å½¢çŠ¶ä¸º(batch_size,1,num_hiddens)</span>            context <span class="token operator">=</span> self<span class="token punctuation">.</span>attention<span class="token punctuation">(</span>                query<span class="token punctuation">,</span> enc_outputs<span class="token punctuation">,</span> enc_outputs<span class="token punctuation">,</span> enc_valid_lens<span class="token punctuation">)</span>            <span class="token comment"># åœ¨ç‰¹å¾ç»´åº¦ä¸Šè¿ç»“</span>            x <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>x<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment"># å°†xå˜å½¢ä¸º(1,batch_size,embed_size+num_hiddens)</span>            out<span class="token punctuation">,</span> hidden_state <span class="token operator">=</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">(</span>x<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hidden_state<span class="token punctuation">)</span>            outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>out<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>_attention_weights<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>attention<span class="token punctuation">.</span>attention_weights<span class="token punctuation">)</span>        <span class="token comment"># å…¨è¿æ¥å±‚å˜æ¢åï¼Œoutputsçš„å½¢çŠ¶ä¸º</span>        <span class="token comment"># (num_steps,batch_size,vocab_size)</span>        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> outputs<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>enc_outputs<span class="token punctuation">,</span> hidden_state<span class="token punctuation">,</span>                                          enc_valid_lens<span class="token punctuation">]</span>    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">attention_weights</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_attention_weights<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³äº <code>nn.Embedding</code>ï¼Œå…¶å®åœ¨ä¹‹å‰ seq2seq ä¸­çš„ä»£ç ä¹Ÿæœ‰ä½¿ç”¨ï¼Œæ•´ç†å‡ ä¸ªç‚¹ï¼š</p><ol><li>Embedding å±‚å°†æ¯ä¸ªè¯å…ƒè½¬åŒ–ä¸º embed_size ç»´åº¦çš„å‘é‡ï¼ˆä¹Ÿç§°ä¸ºè¯å‘é‡ï¼‰</li><li>Embedding layer å­˜å‚¨äº†ä¸€ä¸ªå‚æ•°çŸ©é˜µ (vocab_size, embed_size) æ˜¯å¯ä»¥éšç€è®­ç»ƒæ›´æ–°çš„</li><li>ç»è¿‡è®­ç»ƒä¹‹åç›¸ä¼¼è¯å…ƒçš„è¯å‘é‡å¯èƒ½ä¼šå˜å¾—æ›´æ¥è¿‘</li></ol><p>æ¥çœ‹çœ‹å…¶ä¸­çš„æƒé‡æ˜¯ä»€ä¹ˆæ ·å­çš„å§ï¼Œè¾“å…¥å’Œè¾“å‡ºåˆ†åˆ«ä¸ºï¼š <code>i'm home . =&gt; je suis chez moi .</code></p><p><img src="/archives/b7d04b34/image-20211213155221786.png" alt="image-20211213155221786"></p><p>åº”è¯¥æ˜¯åŠ å…¥äº† <code>&lt;eos&gt;</code> ç‰¹æ®Šè¯å…ƒï¼Œæ‰€ä»¥ (key positions, Query positions) = (3+1, 5+1)</p><h2 id="å¤šå¤´æ³¨æ„åŠ›"><a href="#å¤šå¤´æ³¨æ„åŠ›" class="headerlink" title="å¤šå¤´æ³¨æ„åŠ›"></a>å¤šå¤´æ³¨æ„åŠ›</h2><p>å¤šå¤´æ³¨æ„åŠ›è¿™ä¸€éƒ¨åˆ†çš„è§†é¢‘è®²è§£æ˜¯åœ¨ Transformer ä¸­è¿›è¡Œçš„ <a href="https://www.bilibili.com/video/BV1Kq4y1H7FL?p=1&amp;t=1256">bilibili</a></p><p>åœ¨å®è·µä¸­ï¼Œå½“ç»™å®šç›¸åŒçš„æŸ¥è¯¢ã€é”®å’Œå€¼çš„é›†åˆæ—¶ï¼Œ æˆ‘ä»¬å¸Œæœ›æ¨¡å‹å¯ä»¥<strong>åŸºäºç›¸åŒçš„æ³¨æ„åŠ›æœºåˆ¶å­¦ä¹ åˆ°ä¸åŒçš„è¡Œä¸º</strong>ï¼Œç„¶åå°†ä¸åŒçš„è¡Œä¸ºä½œä¸ºçŸ¥è¯†ç»„åˆèµ·æ¥ï¼Œæ•è·åºåˆ—å†…å„ç§èŒƒå›´çš„ä¾èµ–å…³ç³»ï¼ˆä¾‹å¦‚ï¼ŒçŸ­è·ç¦»ä¾èµ–å’Œé•¿è·ç¦»ä¾èµ–å…³ç³»ï¼‰</p><p>å¯¹äºå…¶ä¸­ä¸€ä¸ªå¤´ $i$ çš„æ“ä½œç®€è¿°å¦‚ä¸‹ï¼šæ˜¯å¯¹ query, key, value å…ˆä½¿ç”¨å…¨è¿æ¥å±‚è¿›è¡Œç»´åº¦è½¬æ¢ï¼Œè½¬æ¢åˆ°ä¸€ä¸ªç›¸åŒçš„ç»´åº¦ $p_v$ï¼Œç„¶åå†ä½¿ç”¨ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ã€‚æ¯ä¸€ä¸ªå¤´éƒ½å°†è¿›è¡Œè¿™æ ·çš„æ“ä½œï¼Œå‡è®¾æœ‰ $m$ ä¸ªå¤´ï¼Œé‚£ä¹ˆå°±ä¼šå¾—åˆ° $m$ ä¸ªæ³¨æ„åŠ›æ±‡èšè¾“å‡º $h_i, i=1,â€¦,m$ï¼Œæœ€åå°†æ‰€æœ‰çš„ $h_i$ è¿æ¥èµ·æ¥ï¼Œä½¿ç”¨ä¸€ä¸ªå…¨è¿æ¥å±‚è¿›è¡Œç‰¹å¾ç»„åˆå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºï¼Œæ•°å­¦å½¢å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\mathbf{h}_{i}=f\left(\mathbf{W}_{i}^{(q)} \mathbf{q}, \mathbf{W}_{i}^{(k)} \mathbf{k}, \mathbf{W}_{i}^{(v)} \mathbf{v}\right) \in \mathbb{R}^{p_{v}}\\\mathbf{W}_{o}\left[\begin{array}{c}\mathbf{h}_{1} \\\vdots \\\mathbf{h}_{h}\end{array}\right] \in \mathbb{R}^{p_{o}}</script><p>è¿™é‡Œ $W_0$ æ˜¯ä¸€ä¸ª $p_0 \times p_0$ çš„çŸ©é˜µï¼Œ$p_0 = \text{number of heads} \times p_v$ï¼Œå›¾ç¤ºå¦‚ä¸‹</p><p><img src="/archives/b7d04b34/image-20211213235228429.png" style="zoom:80%;"></p><p>åœ¨ä½¿ç”¨ä»£ç å®ç°çš„æ—¶å€™å‘ç°ï¼Œå¯ä»¥æŠŠ <code>num_heads</code> ä¸ª $W_{i}q$ ä½¿ç”¨ä¸€ä¸ªå¤§çš„ $W_q$ ä»£æ›¿ï¼Œç„¶åå°†å˜æ¢åçš„ç‰¹å¾è¿›è¡Œåˆ†å‰²å³å¯ã€‚å…¶ä»–ä¸¤ä¸ªçŸ©é˜µåŒç†ï¼Œè¿™æ ·ä¾¿äºå¹¶è¡Œå¤„ç†ï¼Œå¹¶ä¸”ä»£ç æ›´ç®€æ´</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">MultiHeadAttention</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""å¤šå¤´æ³¨æ„åŠ›"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span>                 num_heads<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>MultiHeadAttention<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_heads <span class="token operator">=</span> num_heads        self<span class="token punctuation">.</span>attention <span class="token operator">=</span> d2l<span class="token punctuation">.</span>DotProductAttention<span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>W_q <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>query_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>W_k <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>key_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>W_v <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>W_o <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> bias<span class="token operator">=</span>bias<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queries<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> values<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span class="token punctuation">:</span>        queries <span class="token operator">=</span> transpose_qkv<span class="token punctuation">(</span>self<span class="token punctuation">.</span>W_q<span class="token punctuation">(</span>queries<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">)</span>        keys <span class="token operator">=</span> transpose_qkv<span class="token punctuation">(</span>self<span class="token punctuation">.</span>W_k<span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">)</span>        values <span class="token operator">=</span> transpose_qkv<span class="token punctuation">(</span>self<span class="token punctuation">.</span>W_v<span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">)</span>        <span class="token keyword">if</span> valid_lens <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token comment"># åœ¨è½´0ï¼Œå°†ç¬¬ä¸€é¡¹ï¼ˆæ ‡é‡æˆ–è€…çŸ¢é‡ï¼‰å¤åˆ¶num_headsæ¬¡</span>            valid_lens <span class="token operator">=</span> torch<span class="token punctuation">.</span>repeat_interleave<span class="token punctuation">(</span>                valid_lens<span class="token punctuation">,</span> repeats<span class="token operator">=</span>self<span class="token punctuation">.</span>num_heads<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment"># outputçš„å½¢çŠ¶:(batch_size*num_headsï¼Œnum_query,</span>        <span class="token comment"># num_hiddens/num_heads)</span>        output <span class="token operator">=</span> self<span class="token punctuation">.</span>attention<span class="token punctuation">(</span>queries<span class="token punctuation">,</span> keys<span class="token punctuation">,</span> values<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span>        output_concat <span class="token operator">=</span> transpose_output<span class="token punctuation">(</span>output<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_heads<span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>W_o<span class="token punctuation">(</span>output_concat<span class="token punctuation">)</span><span class="token comment">#@save</span><span class="token keyword">def</span> <span class="token function">transpose_qkv</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> num_heads<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""ä¸ºäº†å¤šæ³¨æ„åŠ›å¤´çš„å¹¶è¡Œè®¡ç®—è€Œå˜æ¢å½¢çŠ¶"""</span>    X <span class="token operator">=</span> X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    X <span class="token operator">=</span> X<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>    <span class="token comment"># æœ€ç»ˆè¾“å‡ºçš„å½¢çŠ¶:(batch_size*num_heads, num_query or num_keys,</span>    <span class="token comment"># num_hiddens/num_heads)</span>    <span class="token keyword">return</span> X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">#@save</span><span class="token keyword">def</span> <span class="token function">transpose_output</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> num_heads<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""é€†è½¬transpose_qkvå‡½æ•°çš„æ“ä½œ"""</span>    X <span class="token operator">=</span> X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    X <span class="token operator">=</span> X<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> X<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è‡ªæ³¨æ„åŠ›å’Œä½ç½®ç¼–ç "><a href="#è‡ªæ³¨æ„åŠ›å’Œä½ç½®ç¼–ç " class="headerlink" title="è‡ªæ³¨æ„åŠ›å’Œä½ç½®ç¼–ç "></a>è‡ªæ³¨æ„åŠ›å’Œä½ç½®ç¼–ç </h2><p>ç»ˆäºè¿›å…¥è‡ªæ³¨æ„åŠ›éƒ¨åˆ†äº†ï¼Œç¦» transformer åªæœ‰ä¸€æ­¥ä¹‹é¥ï¼</p><p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æˆ–å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰å¯¹åºåˆ—è¿›è¡Œç¼–ç ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰äº†æ³¨æ„åŠ›æœºåˆ¶ä¹‹åï¼Œæˆ‘ä»¬å°†è¯å…ƒåºåˆ—è¾“å…¥æ³¨æ„åŠ›æ± åŒ–å±‚ä¸­ï¼ŒåŒä¸€ç»„è¯å…ƒåŒæ—¶å……å½“æŸ¥è¯¢ã€é”®å’Œå€¼ã€‚æ¯ä¸ªæŸ¥è¯¢éƒ½ä¼šå…³æ³¨æ‰€æœ‰çš„é”®ï¼å€¼å¯¹å¹¶ç”Ÿæˆä¸€ä¸ªæ³¨æ„åŠ›è¾“å‡ºã€‚ç”±äºæŸ¥è¯¢ã€é”®å’Œå€¼æ¥è‡ªåŒä¸€ç»„è¾“å…¥ï¼Œå› æ­¤è¢«ç§°ä¸º è‡ªæ³¨æ„åŠ›ï¼ˆself-attentionï¼‰åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è‡ªæ³¨æ„åŠ›è¿›è¡Œåºåˆ—ç¼–ç ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨åºåˆ—çš„é¡ºåºä½œä¸ºè¡¥å……ä¿¡æ¯</p><h3 id="è‡ªæ³¨æ„åŠ›"><a href="#è‡ªæ³¨æ„åŠ›" class="headerlink" title="è‡ªæ³¨æ„åŠ›"></a>è‡ªæ³¨æ„åŠ›</h3><p>ç»™å®šä¸€ä¸ªç”±è¯å…ƒç»„æˆçš„è¾“å…¥åºåˆ—ï¼Œå…¶ä¸­ä»»æ„ $x_i \in R^ d$ã€‚è¯¥åºåˆ—çš„è‡ªæ³¨æ„åŠ›è¾“å‡ºä¸ºä¸€ä¸ªé•¿åº¦ç›¸åŒçš„åºåˆ—ï¼š</p><script type="math/tex; mode=display">\mathbf{y}_{i}=f\left(\mathbf{x}_{i},\left(\mathbf{x}_{1}, \mathbf{x}_{1}\right), \ldots,\left(\mathbf{x}_{n}, \mathbf{x}_{n}\right)\right) \in \mathbb{R}^{d}</script><h3 id="æ¯”è¾ƒå·ç§¯ç¥ç»ç½‘ç»œã€å¾ªç¯ç¥ç»ç½‘ç»œå’Œè‡ªæ³¨æ„åŠ›"><a href="#æ¯”è¾ƒå·ç§¯ç¥ç»ç½‘ç»œã€å¾ªç¯ç¥ç»ç½‘ç»œå’Œè‡ªæ³¨æ„åŠ›" class="headerlink" title="æ¯”è¾ƒå·ç§¯ç¥ç»ç½‘ç»œã€å¾ªç¯ç¥ç»ç½‘ç»œå’Œè‡ªæ³¨æ„åŠ›"></a>æ¯”è¾ƒå·ç§¯ç¥ç»ç½‘ç»œã€å¾ªç¯ç¥ç»ç½‘ç»œå’Œè‡ªæ³¨æ„åŠ›</h3><p>ä¸‹å›¾ä¸ºä¸‰è€…è®¡ç®—çš„å›¾ç¤º</p><p><img src="/archives/b7d04b34/image-20211213171227551.png" style="zoom:80%;"></p><p>ç°åœ¨è®©æˆ‘ä»¬æ¯”è¾ƒè¿™ä¸‰ä¸ªæ¶æ„ï¼Œç›®æ ‡éƒ½æ˜¯å°†ç”± n ä¸ªè¯å…ƒç»„æˆçš„åºåˆ—æ˜ å°„åˆ°å¦ä¸€ä¸ªé•¿åº¦ç›¸ç­‰çš„åºåˆ—ï¼Œå…¶ä¸­çš„æ¯ä¸ªè¾“å…¥è¯å…ƒæˆ–è¾“å‡ºè¯å…ƒéƒ½ç”± d ç»´å‘é‡è¡¨ç¤ºã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†æ¯”è¾ƒçš„æ˜¯å·ç§¯ç¥ç»ç½‘ç»œã€å¾ªç¯ç¥ç»ç½‘ç»œå’Œè‡ªæ³¨æ„åŠ›è¿™å‡ ä¸ªæ¶æ„çš„è®¡ç®—å¤æ‚æ€§ã€é¡ºåºæ“ä½œå’Œæœ€å¤§è·¯å¾„é•¿åº¦ã€‚è¯·æ³¨æ„ï¼Œ<strong>é¡ºåºæ“ä½œä¼šå¦¨ç¢å¹¶è¡Œè®¡ç®—ï¼Œè€Œä»»æ„çš„åºåˆ—ä½ç½®ç»„åˆä¹‹é—´çš„è·¯å¾„è¶ŠçŸ­ï¼Œåˆ™èƒ½æ›´è½»æ¾åœ°å­¦ä¹ åºåˆ—ä¸­çš„è¿œè·ç¦»ä¾èµ–å…³ç³»</strong></p><p>ä¸‹é¢è¿™ä¸ªè¡¨ä¾ç„¶æ¥è‡ªäºæ²ç¥è§†é¢‘ <a href="https://www.bilibili.com/video/BV19o4y1m7mo">bilibili</a>ï¼Œéå¸¸æ¸…æ™°åœ°å¯¹æ¯”äº†ä¸‰è€…çš„å…³ç³»ï¼Œå…¶ä¸­ k æ˜¯ä¸€ç»´å·ç§¯æ ¸çš„ kernel size</p><p><img src="/archives/b7d04b34/image-20211213172102475.png" style="zoom: 50%;"></p><p>ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼š</p><ol><li>æœ€é•¿è·¯å¾„ä¸­çš„è·¯å¾„ä¸ºï¼šä¸¤ä¸ªè¯å…ƒè¿›è¡Œä¿¡æ¯ä¼ é€’çš„è®¡ç®—æ¬¡æ•°</li><li>å¾ªç¯ç¥ç»ç½‘ç»œçš„éšçŠ¶æ€æ—¶ï¼Œ dÃ—d æƒé‡çŸ©é˜µå’Œ d ç»´éšçŠ¶æ€çš„ä¹˜æ³•è®¡ç®—å¤æ‚åº¦ä¸º $O(d^2)$</li><li>åœ¨è‡ªæ³¨æ„åŠ›ä¸­ï¼ŒæŸ¥è¯¢ã€é”®å’Œå€¼éƒ½æ˜¯ nÃ—d çŸ©é˜µã€‚ å¹¶ä¸”ä½¿ç”¨ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼Œæ•…è‡ªæ³¨æ„åŠ›è®¡ç®—å¤æ‚åº¦ä¸º $O(n^2d)$ï¼Œå¹¶ä¸”ç”±äºä½¿ç”¨çš„æ˜¯çŸ©é˜µä¹˜æ³•ï¼Œè€ŒçŸ©é˜µä¹˜æ³•çš„å¹¶è¡Œåº¦ä¸º $O(n)$</li></ol><p>æ€»è€Œè¨€ä¹‹ï¼Œå·ç§¯ç¥ç»ç½‘ç»œå’Œè‡ªæ³¨æ„åŠ›éƒ½æ‹¥æœ‰å¹¶è¡Œè®¡ç®—çš„ä¼˜åŠ¿ï¼Œè€Œä¸”è‡ªæ³¨æ„åŠ›çš„æœ€å¤§è·¯å¾„é•¿åº¦æœ€çŸ­ã€‚ä½†æ˜¯å› ä¸ºå…¶è®¡ç®—å¤æ‚åº¦æ˜¯å…³äºåºåˆ—é•¿åº¦çš„äºŒæ¬¡æ–¹ï¼Œæ‰€ä»¥åœ¨å¾ˆé•¿çš„åºåˆ—ä¸­è®¡ç®—ä¼šéå¸¸æ…¢</p><h3 id="ä½ç½®ç¼–ç "><a href="#ä½ç½®ç¼–ç " class="headerlink" title="ä½ç½®ç¼–ç "></a>ä½ç½®ç¼–ç </h3><p>ä¸åŒäº CNN å’Œ RNNï¼Œä»¥ä¸Šå¾—åˆ°çš„è‡ªæ³¨æ„åŠ›è®¡ç®—ç»“æœæ˜¯ä¸åŒ…å«ä½ç½®ï¼ˆé¡ºåºï¼‰ä¿¡æ¯çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æ¢ä¸ªè¾“å…¥é¡ºåºï¼Œå¾—åˆ°çš„ç»“æœè¿˜æ˜¯é‚£äº›ç»“æœï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æè¿°çš„æ˜¯åŸºäºæ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°çš„å›ºå®šä½ç½®ç¼–ç ï¼ˆä¸å¾—ä¸åæ§½ä¸€ä¸‹è¿™ä¸ªç¼–ç çœŸçš„ç•¥å¾®æŠ½è±¡</p><p>ä»¥ä¸‹æ˜¯æˆ‘çš„ä¸ªäººç†è§£ï¼šå¯¹äºä¸€ä¸ªåºåˆ— <code>range(n)</code>ï¼Œæˆ‘éœ€è¦ä½¿ç”¨ d ä¸ªç»´åº¦å¯¹å…¶ä½ç½®è¿›è¡Œç¼–ç ï¼Œé‡‡å–å¦‚ä¸‹ç¼–ç å½¢å¼ï¼Œ $p_{i,j}$ å³æ˜¯ç¬¬ i ä¸ªä½ç½®çš„ç¬¬ j ä¸ªç»´åº¦çš„ç¼–ç æ•°</p><script type="math/tex; mode=display">\begin{aligned}p_{i, 2 j} &=\sin \left(\frac{i}{10000^{2 j / d}}\right) \\p_{i, 2 j+1} &=\cos \left(\frac{i}{10000^{2 j / d}}\right)\end{aligned}</script><p>ç¬¬ä¸€æ¬¡çœ‹è¿™ä¸ªç¼–ç çœŸçš„å¤ªè’™åœˆäº†ï¼Œä¸è¿‡æ•™æä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼šç»å¯¹ä½ç½®ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ d ä½äºŒè¿›åˆ¶å¯¹åºåˆ— <code>range(n)</code> çš„ä½ç½®è¿›è¡Œç¼–ç ï¼Œè¿™æ ·æ¥çœ‹æ˜¯ä¸æ˜¯å°±ç®€å•ä¸å°‘äº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># d = 5</span><span class="token number">0</span>çš„äºŒè¿›åˆ¶æ˜¯ï¼š<span class="token number">00000</span><span class="token number">1</span>çš„äºŒè¿›åˆ¶æ˜¯ï¼š<span class="token number">00001</span><span class="token number">2</span>çš„äºŒè¿›åˆ¶æ˜¯ï¼š<span class="token number">00010</span><span class="token number">3</span>çš„äºŒè¿›åˆ¶æ˜¯ï¼š<span class="token number">00011</span><span class="token number">4</span>çš„äºŒè¿›åˆ¶æ˜¯ï¼š<span class="token number">00100</span><span class="token number">5</span>çš„äºŒè¿›åˆ¶æ˜¯ï¼š<span class="token number">00101</span><span class="token number">6</span>çš„äºŒè¿›åˆ¶æ˜¯ï¼š<span class="token number">00110</span><span class="token number">7</span>çš„äºŒè¿›åˆ¶æ˜¯ï¼š<span class="token number">00111</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¶Šé«˜ä½çš„æ•°å­—å˜åŒ–å¾—è¶Šæ…¢ï¼Œä¸€å…±èƒ½å¤Ÿç¼–ç  $2^n$ ä¸ªæ•°ã€‚é‚£å¦‚æœæˆ‘ä»¬ç”¨ d ç»´ (0, 1) ä¹‹é—´çš„æ•°å»å¯¹ä½ç½®è¿›è¡Œç¼–ç æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å‘¢ï¼Ÿæ•™æä¸­çš„ä½ç½®ç¼–ç å°±å±äºå…¶ä¸­ä¸€ç§ã€‚è¿˜å¯ä»¥ä»å¹³é¢ç©ºé—´çš„è§’åº¦æ¥è¿›è¡Œç†è§£ï¼Œå‡è®¾æœ‰ d ä¸ªç»´åº¦ï¼Œæ­¤æ—¶æˆ‘ä»¬ç”»å‡º d/2 ä¸ªå¹³é¢</p><p><img src="/archives/b7d04b34/image-20211213201150635.png" alt="image-20211213201150635"></p><p>æ—‹è½¬è§’åº¦å°±æ˜¯å¯¹åº”ç€ (cos, sin)ï¼Œéšç€ä½æ•°è¶Šé«˜æ¯æ¬¡ i è¿›ä¸€æ—¶ï¼Œæ—‹è½¬çš„å¹…åº¦è¶Šå°ã€‚ä¸‹é¢æ˜¯ position å’Œ endoding dimension çš„çƒ­åŠ›å›¾</p><p><img src="/archives/b7d04b34/image-20211213201335149.png" style="zoom:80%;"></p><p>æˆ‘å·²ç»å°½åŠ›å»ç†è§£äº†â€¦ä½†æ˜¯è¿˜æ˜¯æœ‰ç‚¹äº‘é‡Œé›¾é‡Œï¼Œä¸è¿‡è¿˜æ˜¯å…ˆç»§ç»­å‰è¡Œå§</p><h2 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h2><p>ä¸ CNN å’Œ RNN æ¯”è¾ƒï¼Œè‡ªæ³¨æ„åŠ›åŒæ—¶å…·æœ‰å¹¶è¡Œè®¡ç®—å’Œæœ€çŸ­çš„æœ€å¤§è·¯å¾„é•¿åº¦è¿™ä¸¤ä¸ªä¼˜åŠ¿ï¼Œå› æ­¤ï¼Œä½¿ç”¨è‡ªæ³¨æ„åŠ›æ¥è®¾è®¡æ·±åº¦æ¶æ„æ˜¯å¾ˆæœ‰å¸å¼•åŠ›çš„ã€‚å°½ç®¡ transformer æœ€åˆæ˜¯åº”ç”¨äºåœ¨æ–‡æœ¬æ•°æ®ä¸Šçš„åºåˆ—åˆ°åºåˆ—å­¦ä¹ ï¼Œä½†ç°åœ¨å·²ç»æ¨å¹¿åˆ°å„ç§ç°ä»£çš„æ·±åº¦å­¦ä¹ ä¸­ï¼Œä¾‹å¦‚è¯­è¨€ã€è§†è§‰ã€è¯­éŸ³å’Œå¼ºåŒ–å­¦ä¹ é¢†åŸŸ</p><p>æˆ‘è®¤ä¸ºè¿™é‡Œè´´è‹±æ–‡çš„å›¾ç¤ºæ¯”è¾ƒå¥½ï¼Œç¬¬ä¸€æ¬¡çœ‹è¿™ä¸ªå›¾è‚¯å®šæ˜¯ä¸€å¤´é›¾æ°´ï¼Œå¯ä»¥å…ˆçœ‹ä»£ç ï¼Œäº†è§£æ¯ä¸ªæ¨¡å—çš„ç»“æ„ï¼Œç„¶åå†æ‹¼èµ·æ¥</p><p><img src="/archives/b7d04b34/image-20211213212144723.png" style="zoom:80%;"></p><h3 id="åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ-ï¼ˆPositionwise-FFNï¼‰"><a href="#åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ-ï¼ˆPositionwise-FFNï¼‰" class="headerlink" title="åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ ï¼ˆPositionwise FFNï¼‰"></a>åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ ï¼ˆPositionwise FFNï¼‰</h3><p>åå­—å¾ˆé…·ï¼Œå®é™…ä¸Šæ˜¯ä¸¤ä¸ªå…¨è¿æ¥å±‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">PositionWiseFFN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span> ffn_num_outputs<span class="token punctuation">,</span>                 <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>PositionWiseFFN<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dense1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>relu <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dense2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>ffn_num_hiddens<span class="token punctuation">,</span> ffn_num_outputs<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>dense2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dense1<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ®‹å·®è¿æ¥å’Œå±‚è§„èŒƒåŒ–ï¼ˆadd-amp-normï¼‰"><a href="#æ®‹å·®è¿æ¥å’Œå±‚è§„èŒƒåŒ–ï¼ˆadd-amp-normï¼‰" class="headerlink" title="æ®‹å·®è¿æ¥å’Œå±‚è§„èŒƒåŒ–ï¼ˆadd &amp; normï¼‰"></a>æ®‹å·®è¿æ¥å’Œå±‚è§„èŒƒåŒ–ï¼ˆadd &amp; normï¼‰</h3><p>æ®‹å·®è¿æ¥æ˜¯å¾ˆå¸¸è§çš„ç½‘ç»œç»“æ„ï¼Œè¿™é‡Œä¸»è¦è®²è®²è§„èŒƒåŒ–ä½¿ç”¨çš„æ˜¯ LayerNormã€‚å‡è®¾æ•°æ® $X$ çš„å½¢çŠ¶ä¸º (batch, num_steps, channels)ï¼ŒBatchNorm é’ˆå¯¹çš„æ˜¯ batch ç»´åº¦ï¼Œæœ€åå¾—åˆ°çš„å‡å€¼å’Œæ–¹å·®å½¢çŠ¶æ˜¯ (num_steps, channels)</p><p>ä½†é—®é¢˜æ¥äº†ï¼Œåœ¨è®¡ç®—æœºè§†è§‰ä¸­ num_steps ä¸€èˆ¬ä»£è¡¨çš„æ˜¯å›¾ç‰‡çš„å½¢çŠ¶ (H, W) æ‰€ä»¥æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œè€Œåœ¨åºåˆ—æ¨¡å‹ä¸­ï¼Œç”±äºæ¯ä¸ªæ ·æœ¬çš„æ—¶é—´æ­¥å¯èƒ½ä¸ä¸€æ ·</p><p>æ‰€ä»¥ LayerNorm é’ˆå¯¹çš„æ˜¯ num_steps ç»´åº¦ï¼ˆæ›´å®½æ³›çš„è®²å¯ä»¥æ˜¯é™¤äº† batch ä»¥å¤–çš„å…¶ä»–ç»´åº¦ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°çš„å‡å€¼å’Œæ–¹å·®å½¢çŠ¶æ˜¯ (batch, channels) or (batch,)ï¼Œè¿™å°±ä¿è¯äº†ç»Ÿä¸€æ€§ï¼Œå› ä¸º batch &amp; channel ä¸€èˆ¬æ˜¯ä¸€ä¸ªå›ºå®šå€¼ã€‚</p><p>é™¤äº†ä½¿ç”¨ LayerNorm è¿˜ä½¿ç”¨äº† dropout æ­£åˆ™åŒ–ï¼Œä¸‹é¢æ¥çœ‹çœ‹æ ¸å¿ƒä»£ç ï¼ˆ<a href="https://pytorch.org/docs/stable/generated/torch.nn.LayerNorm.html">LayerNorm</a> è¾“å…¥æ˜¯ normalized_shapeï¼Œæˆ‘ç†è§£ä¸ºè®¡ç®—å•ä¸ªç»Ÿè®¡å€¼ï¼Œæ•°æ®æ‰€éœ€çš„å½¢çŠ¶ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">AddNorm</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""æ®‹å·®è¿æ¥åè¿›è¡Œå±‚è§„èŒƒåŒ–"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> normalized_shape<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>AddNorm<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>ln <span class="token operator">=</span> nn<span class="token punctuation">.</span>LayerNorm<span class="token punctuation">(</span>normalized_shape<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>ln<span class="token punctuation">(</span>self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>Y<span class="token punctuation">)</span> <span class="token operator">+</span> X<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç¼–ç å™¨"><a href="#ç¼–ç å™¨" class="headerlink" title="ç¼–ç å™¨"></a>ç¼–ç å™¨</h3><h4 id="EncoderBlock"><a href="#EncoderBlock" class="headerlink" title="EncoderBlock"></a>EncoderBlock</h4><p>æœ‰äº†ä»¥ä¸Šä¸¤ä¸ªæ¨¡å—ï¼šFFN &amp; AddNormï¼Œå†åŠ ä¸Šä¹‹å‰ä»‹ç»çš„å¤šå¤´æ³¨æ„åŠ›æ¨¡å—ï¼Œå°±èƒ½å¤Ÿæ„å»ºä¸€ä¸ªå®Œæ•´çš„ transformer ç¼–ç å™¨æ¨¡å—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">EncoderBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""transformerç¼–ç å™¨å—"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span>                 norm_shape<span class="token punctuation">,</span> ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span>                 dropout<span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>EncoderBlock<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>attention <span class="token operator">=</span> d2l<span class="token punctuation">.</span>MultiHeadAttention<span class="token punctuation">(</span>            key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span>            use_bias<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>addnorm1 <span class="token operator">=</span> AddNorm<span class="token punctuation">(</span>norm_shape<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>ffn <span class="token operator">=</span> PositionWiseFFN<span class="token punctuation">(</span>            ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>addnorm2 <span class="token operator">=</span> AddNorm<span class="token punctuation">(</span>norm_shape<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span class="token punctuation">:</span>        Y <span class="token operator">=</span> self<span class="token punctuation">.</span>addnorm1<span class="token punctuation">(</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>attention<span class="token punctuation">(</span>X<span class="token punctuation">,</span> X<span class="token punctuation">,</span> X<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>addnorm2<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ffn<span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>transformer ä¸€ä¸ªå¾ˆå¥½çš„æ€§è´¨æ˜¯ï¼š<strong>ç¼–ç å™¨ä¸­çš„ä»»ä½•å±‚éƒ½ä¸ä¼šæ”¹å˜å…¶è¾“å…¥çš„å½¢çŠ¶ï¼</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">X <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span>valid_lens <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>encoder_blk <span class="token operator">=</span> EncoderBlock<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>encoder_blk<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>encoder_blk<span class="token punctuation">(</span>X<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token comment"># torch.Size([2, 100, 24])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="TransformerEncoder"><a href="#TransformerEncoder" class="headerlink" title="TransformerEncoder"></a>TransformerEncoder</h4><p>æœ‰äº†å•ä¸ªæ¨¡å—ä¹‹åï¼Œå°±å¯ä»¥å°†å®ƒä»¬å †å èµ·æ¥è·å¾—æ›´å¼ºå¤§ç¼–ç å™¨ï¼Œå½“ç„¶è¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ol><li>Positional encodingï¼Œç»™æ¯ä¸€ä¸ªåºåˆ—ä½¿ç”¨ä¹‹å‰æ‰€å°†çš„ä¸‰è§’å‡½æ•°ä½ç½®ç¼–ç </li><li>ç”±äº embedding çš„æ•°å€¼æ˜¯ç»è¿‡å½’ä¸€åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤ä»¥äº† $\sqrt{d}$ï¼Œè€Œ Positional encoding çš„å€¼æ˜¯ (-1, 1) ä¹‹é—´çš„ä¸‰è§’å‡½æ•°ï¼Œä¸ºäº†è®©ä¸¤ä¸ªæ•°ç›¸åŠ ï¼ˆåŠ å…¥ä½ç½®ä¿¡æ¯ï¼‰ï¼Œå¹¶ä¸”è®©äºŒè€…çš„æ•°å€¼å¤§å°ç›¸å·®æ›´å°ï¼Œåˆ™éœ€è¦å°† embedding å†ä¹˜ä»¥é•¿åº¦ $\sqrt{d}$ ä»¥è¿˜åŸ</li></ol><p>ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">TransformerEncoder</span><span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>Encoder<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""transformerç¼–ç å™¨"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span>                 num_hiddens<span class="token punctuation">,</span> norm_shape<span class="token punctuation">,</span> ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span>                 num_heads<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>TransformerEncoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_hiddens <span class="token operator">=</span> num_hiddens        self<span class="token punctuation">.</span>embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>pos_encoding <span class="token operator">=</span> d2l<span class="token punctuation">.</span>PositionalEncoding<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>blks <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_layers<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>blks<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"block"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>                EncoderBlock<span class="token punctuation">(</span>key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span>                             norm_shape<span class="token punctuation">,</span> ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span>                             num_heads<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> use_bias<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> valid_lens<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å› ä¸ºä½ç½®ç¼–ç å€¼åœ¨-1å’Œ1ä¹‹é—´ï¼Œ</span>        <span class="token comment"># å› æ­¤åµŒå…¥å€¼ä¹˜ä»¥åµŒå…¥ç»´åº¦çš„å¹³æ–¹æ ¹è¿›è¡Œç¼©æ”¾ï¼Œ</span>        <span class="token comment"># ç„¶åå†ä¸ä½ç½®ç¼–ç ç›¸åŠ ã€‚</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>pos_encoding<span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_hiddens<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>attention_weights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>blks<span class="token punctuation">)</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span> blk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>blks<span class="token punctuation">)</span><span class="token punctuation">:</span>            X <span class="token operator">=</span> blk<span class="token punctuation">(</span>X<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>attention_weights<span class="token punctuation">[</span>                i<span class="token punctuation">]</span> <span class="token operator">=</span> blk<span class="token punctuation">.</span>attention<span class="token punctuation">.</span>attention<span class="token punctuation">.</span>attention_weights        <span class="token keyword">return</span> X<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹é¢æˆ‘ä»¬æŒ‡å®šäº†è¶…å‚æ•°æ¥åˆ›å»ºä¸€ä¸ªä¸¤å±‚çš„ transformer ç¼–ç å™¨ã€‚Transformer ç¼–ç å™¨è¾“å‡ºçš„å½¢çŠ¶æ˜¯ï¼ˆæ‰¹é‡å¤§å°ï¼Œæ—¶é—´æ­¥æ•°ç›®ï¼Œ<code>num_hiddens</code>ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">encoder <span class="token operator">=</span> TransformerEncoder<span class="token punctuation">(</span>    <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>encoder<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>encoder<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token comment"># torch.Size([2, 100, 24])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è§£ç å™¨"><a href="#è§£ç å™¨" class="headerlink" title="è§£ç å™¨"></a>è§£ç å™¨</h3><h4 id="DecoderBlock"><a href="#DecoderBlock" class="headerlink" title="DecoderBlock"></a>DecoderBlock</h4><p>åŒæ ·çš„ï¼Œå…ˆå®ç°å•ä¸ªè§£ç å™¨æ¨¡å—ã€‚å…¶å®åŸºæœ¬çš„æ¨¡å—ä¹‹å‰å·²ç»å…¨éƒ¨å®ç°äº†ï¼Œç»†èŠ‚ä¸Šçš„ä¸åŒæ˜¯ï¼š</p><ol><li>ä¸ encoder ç›¸æ¯”ï¼Œdecoder å…ˆä½¿ç”¨è‡ªæ³¨æ„åŠ›æ±‡èšå¯¹ targets è¾“å…¥è¿›è¡Œç¼–ç ã€‚ç„¶åå°†è¯¥ç¼–ç ä½œä¸º queryã€å°† encoder çš„è¾“å‡ºä½œä¸º key &amp; valueï¼Œè¾“å…¥åˆ°å¤šå¤´æ³¨æ„åŠ›æ±‡èšä¸­</li><li>åŒ seq2seq ä¸€æ ·ï¼Œåœ¨è¿›è¡Œè§£ç æ—¶ä¸åº”è¯¥çœ‹åˆ°è¯¥æ—¶é—´æ­¥åŠå…¶ä¹‹åçš„ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦æ©ç  <code>dec_valid_lens</code>ï¼Œä»¥ä¿æŒå…¶è‡ªå›å½’å±æ€§</li></ol><p>å…·ä½“ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DecoderBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""è§£ç å™¨ä¸­ç¬¬ i ä¸ªå—"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span>                 norm_shape<span class="token punctuation">,</span> ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span>                 dropout<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>DecoderBlock<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>i <span class="token operator">=</span> i        self<span class="token punctuation">.</span>attention1 <span class="token operator">=</span> d2l<span class="token punctuation">.</span>MultiHeadAttention<span class="token punctuation">(</span>            key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>addnorm1 <span class="token operator">=</span> AddNorm<span class="token punctuation">(</span>norm_shape<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>attention2 <span class="token operator">=</span> d2l<span class="token punctuation">.</span>MultiHeadAttention<span class="token punctuation">(</span>            key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_heads<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>addnorm2 <span class="token operator">=</span> AddNorm<span class="token punctuation">(</span>norm_shape<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>ffn <span class="token operator">=</span> PositionWiseFFN<span class="token punctuation">(</span>ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span>                                   num_hiddens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>addnorm3 <span class="token operator">=</span> AddNorm<span class="token punctuation">(</span>norm_shape<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>        enc_outputs<span class="token punctuation">,</span> enc_valid_lens <span class="token operator">=</span> state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token comment"># è®­ç»ƒé˜¶æ®µï¼Œè¾“å‡ºåºåˆ—çš„æ‰€æœ‰è¯å…ƒéƒ½åœ¨åŒä¸€æ—¶é—´å¤„ç†ï¼Œ</span>        <span class="token comment"># å› æ­¤ `state[2][self.i]` åˆå§‹åŒ–ä¸º `None`ã€‚</span>        <span class="token comment"># é¢„æµ‹é˜¶æ®µï¼Œè¾“å‡ºåºåˆ—æ˜¯é€šè¿‡è¯å…ƒä¸€ä¸ªæ¥ç€ä¸€ä¸ªè§£ç çš„ï¼Œ</span>        <span class="token comment"># å› æ­¤ `state[2][self.i]` åŒ…å«ç€ç›´åˆ°å½“å‰æ—¶é—´æ­¥ç¬¬ `i` ä¸ªå—è§£ç çš„è¾“å‡ºè¡¨ç¤º</span>        <span class="token keyword">if</span> state<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>i<span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            key_values <span class="token operator">=</span> X        <span class="token keyword">else</span><span class="token punctuation">:</span>            key_values <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        state<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> key_values        <span class="token keyword">if</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>            batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">,</span> _ <span class="token operator">=</span> X<span class="token punctuation">.</span>shape            <span class="token comment"># `dec_valid_lens` çš„å¼€å¤´: (`batch_size`, `num_steps`),</span>            <span class="token comment"># å…¶ä¸­æ¯ä¸€è¡Œæ˜¯ [1, 2, ..., `num_steps`]</span>            dec_valid_lens <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>                <span class="token number">1</span><span class="token punctuation">,</span> num_steps <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> device<span class="token operator">=</span>X<span class="token punctuation">.</span>device<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            dec_valid_lens <span class="token operator">=</span> <span class="token boolean">None</span>        <span class="token comment"># è‡ªæ³¨æ„åŠ›</span>        X2 <span class="token operator">=</span> self<span class="token punctuation">.</span>attention1<span class="token punctuation">(</span>X<span class="token punctuation">,</span> key_values<span class="token punctuation">,</span> key_values<span class="token punctuation">,</span> dec_valid_lens<span class="token punctuation">)</span>        Y <span class="token operator">=</span> self<span class="token punctuation">.</span>addnorm1<span class="token punctuation">(</span>X<span class="token punctuation">,</span> X2<span class="token punctuation">)</span>        <span class="token comment"># ç¼–ç å™¨ï¼è§£ç å™¨æ³¨æ„åŠ›ã€‚</span>        <span class="token comment"># `enc_outputs` çš„å¼€å¤´: (`batch_size`, `num_steps`, `num_hiddens`)</span>        Y2 <span class="token operator">=</span> self<span class="token punctuation">.</span>attention2<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> enc_outputs<span class="token punctuation">,</span> enc_outputs<span class="token punctuation">,</span> enc_valid_lens<span class="token punctuation">)</span>        Z <span class="token operator">=</span> self<span class="token punctuation">.</span>addnorm2<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> Y2<span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>addnorm3<span class="token punctuation">(</span>Z<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ffn<span class="token punctuation">(</span>Z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†ä¾¿äºåœ¨â€œç¼–ç å™¨ï¼è§£ç å™¨â€æ³¨æ„åŠ›ä¸­è¿›è¡Œç¼©æ”¾ç‚¹ç§¯è®¡ç®—å’Œæ®‹å·®è¿æ¥ä¸­è¿›è¡ŒåŠ æ³•è®¡ç®—ï¼Œç¼–ç å™¨å’Œè§£ç å™¨çš„ç‰¹å¾ç»´åº¦éƒ½æ˜¯ <code>num_hiddens</code>ï¼Œæ‰€ä»¥è¯´ decoder ä¹Ÿæ˜¯ä¸æ”¹å˜æ•°æ®å½¢çŠ¶çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">decoder_blk <span class="token operator">=</span> DecoderBlock<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>decoder_blk<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>X <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span>state <span class="token operator">=</span> <span class="token punctuation">[</span>encoder_blk<span class="token punctuation">(</span>X<span class="token punctuation">,</span> valid_lens<span class="token punctuation">)</span><span class="token punctuation">,</span> valid_lens<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">]</span>decoder_blk<span class="token punctuation">(</span>X<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token comment"># torch.Size([2, 100, 24])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="TransformerDecoder"><a href="#TransformerDecoder" class="headerlink" title="TransformerDecoder"></a>TransformerDecoder</h4><p>ä¸‹é¢å°†å¤šä¸ª decoder ç»„åˆèµ·æ¥ï¼Œå¹¶ä¿å­˜æ³¨æ„åŠ›æƒé‡ç”¨äºå¯è§†åŒ–</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TransformerDecoder</span><span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>AttentionDecoder<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span>                 num_hiddens<span class="token punctuation">,</span> norm_shape<span class="token punctuation">,</span> ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span>                 num_heads<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>TransformerDecoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>num_hiddens <span class="token operator">=</span> num_hiddens        self<span class="token punctuation">.</span>num_layers <span class="token operator">=</span> num_layers        self<span class="token punctuation">.</span>embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>pos_encoding <span class="token operator">=</span> d2l<span class="token punctuation">.</span>PositionalEncoding<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>blks <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_layers<span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>blks<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"block"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>                DecoderBlock<span class="token punctuation">(</span>key_size<span class="token punctuation">,</span> query_size<span class="token punctuation">,</span> value_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span>                             norm_shape<span class="token punctuation">,</span> ffn_num_input<span class="token punctuation">,</span> ffn_num_hiddens<span class="token punctuation">,</span>                             num_heads<span class="token punctuation">,</span> dropout<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dense <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> vocab_size<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">init_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> enc_outputs<span class="token punctuation">,</span> enc_valid_lens<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>enc_outputs<span class="token punctuation">,</span> enc_valid_lens<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>num_layers<span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>pos_encoding<span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_hiddens<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_attention_weights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>blks<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i<span class="token punctuation">,</span> blk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>blks<span class="token punctuation">)</span><span class="token punctuation">:</span>            X<span class="token punctuation">,</span> state <span class="token operator">=</span> blk<span class="token punctuation">(</span>X<span class="token punctuation">,</span> state<span class="token punctuation">)</span>            <span class="token comment"># è§£ç å™¨è‡ªæ³¨æ„åŠ›æƒé‡</span>            self<span class="token punctuation">.</span>_attention_weights<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>                i<span class="token punctuation">]</span> <span class="token operator">=</span> blk<span class="token punctuation">.</span>attention1<span class="token punctuation">.</span>attention<span class="token punctuation">.</span>attention_weights            <span class="token comment"># â€œç¼–ç å™¨ï¼è§£ç å™¨â€è‡ªæ³¨æ„åŠ›æƒé‡</span>            self<span class="token punctuation">.</span>_attention_weights<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>                i<span class="token punctuation">]</span> <span class="token operator">=</span> blk<span class="token punctuation">.</span>attention2<span class="token punctuation">.</span>attention<span class="token punctuation">.</span>attention_weights        <span class="token keyword">return</span> self<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> state    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">attention_weights</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_attention_weights<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸‹é¢æ¥çœ‹çœ‹ä¸‰ä¸ª Multi-attention çš„å¯è§†åŒ–ç»“æœï¼Œä¸»è¦æ˜¯ä½“ä¼š valid_len çš„æ•ˆæœ</p><ol><li><p>Encoder self-attention weights</p><p><img src="/archives/b7d04b34/image-20211215153222782.png" style="zoom: 67%;"></p><p>å¯ä»¥çœ‹åˆ°åœ¨æŸä¸ª key positions è¿‡åæ˜¯æ²¡æœ‰æ³¨æ„åŠ›æƒé‡çš„ï¼Œæ˜¯å› ä¸ºä¹‹åçš„ key éƒ½æ˜¯ <pad> è¯å…ƒï¼Œä¸éœ€è¦è¿›è¡Œæ³¨æ„åŠ›è®¡ç®—</pad></p></li><li><p>Decoder self-attention weights</p><p><img src="/archives/b7d04b34/image-20211215153713172.png" alt="image-20211215153713172" style="zoom: 67%;"></p><p>ç”±äº decoder çš„æ¯ä¸ª valid_len æ˜¯éšç€æ—¶é—´æ­¥é€æ¸å¢åŠ çš„ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ° self-attention weights ä¼¼ä¹æ•´ä½“æ˜¯å‘ˆä¸‹ä¸‰è§’å½¢çŠ¶</p></li><li><p>Encoder-decoder attention weights</p><p><img src="/archives/b7d04b34/image-20211215154614074.png" alt="image-20211215154614074" style="zoom:67%;"></p><p>åˆå‡ºç°äº† encoder self-attention ä¸­çš„æƒ…å†µï¼Œè¶…è¿‡æŸä¸ª key position å°±æ²¡æœ‰æƒé‡äº†ï¼Œå› ä¸ºåªæœ‰è¿™ä¹ˆå¤šä¸ª key (source time step)</p></li></ol><h3 id="æ„Ÿè¨€"><a href="#æ„Ÿè¨€" class="headerlink" title="æ„Ÿè¨€"></a>æ„Ÿè¨€</h3><p>å¯ç®—æ˜¯å®Œæˆäº†æ€»ç»“ğŸ˜­ğŸ˜­è™½ç„¶çœ‹å¾—è¿˜æ˜¯æ¯”è¾ƒç²—ç³™ï¼Œä½†æ˜¯æ€»å½’æ˜¯æœ‰äº›æ¦‚å¿µäº†ã€‚åœ¨æ²ç¥è¯»è®ºæ–‡çš„è§†é¢‘ <a href="https://www.bilibili.com/video/BV1pu411o7BE">bilibili</a> ä¸­è®²åˆ°ï¼šè™½ç„¶ transformer è®ºæ–‡å«åš <code>Attention Is All You Need</code>ï¼Œä½†äº‹å®ä¸Šå„ä¸ªç»“æ„éƒ½æ˜¯å¾ˆé‡è¦çš„ï¼Œä¾‹å¦‚ï¼šæ®‹å·®è¿æ¥å’Œå±‚è§„è§„èŒƒåŒ–åœ¨è®­ç»ƒæ·±åº¦ç½‘ç»œæ—¶æ˜¯éå¸¸é‡è¦çš„ã€‚Transformer (attention) æ•´ä½“æ¥çœ‹ä»æ˜¯ä¸€ä¸ªå‘å±•åˆæœŸçš„æ¶æ„ï¼Œåœ¨æœªæ¥æˆ–è®¸æœ‰æ›´å¤šçš„æ¶æ„å‡ºç°ï¼Œä¸€èµ·æœŸå¾…å§</p>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 09 ç°ä»£å¾ªç¯ç¥ç»ç½‘ç»œ</title>
      <link href="/archives/5c4d4ee5.html"/>
      <url>/archives/5c4d4ee5.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-09-ç°ä»£å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#D2L-09-ç°ä»£å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="D2L 09 ç°ä»£å¾ªç¯ç¥ç»ç½‘ç»œ"></a>D2L 09 ç°ä»£å¾ªç¯ç¥ç»ç½‘ç»œ</h1><p>å¾ªç¯ç¥ç»ç½‘ç»œåœ¨å®è·µä¸­ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯æ•°å€¼ä¸ç¨³å®šæ€§ã€‚ å°½ç®¡æˆ‘ä»¬å·²ç»åº”ç”¨äº†æ¢¯åº¦è£å‰ªç­‰æŠ€å·§æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼Œ ä½†æ˜¯ä»éœ€è¦é€šè¿‡è®¾è®¡æ›´å¤æ‚çš„åºåˆ—æ¨¡å‹å¯ä»¥è¿›ä¸€æ­¥å¤„ç†å®ƒã€‚ å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†å¼•å…¥ä¸¤ä¸ªå¹¿æ³›ä½¿ç”¨çš„ç½‘ç»œï¼Œ å³é—¨æ§å¾ªç¯å•å…ƒï¼ˆgated recurrent unitsï¼ŒGRUï¼‰å’Œ é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆlong short-term memoryï¼ŒLSTMï¼‰ã€‚ ç„¶åï¼Œæˆ‘ä»¬å°†åŸºäºä¸€ä¸ªå•å‘éšè—å±‚æ¥æ‰©å±•å¾ªç¯ç¥ç»ç½‘ç»œæ¶æ„ã€‚ æˆ‘ä»¬å°†æè¿°å…·æœ‰å¤šä¸ªéšè—å±‚çš„æ·±å±‚æ¶æ„ï¼Œ å¹¶è®¨è®ºåŸºäºå‰å‘å’Œåå‘å¾ªç¯è®¡ç®—çš„åŒå‘è®¾è®¡ã€‚ ç°ä»£å¾ªç¯ç½‘ç»œç»å¸¸é‡‡ç”¨è¿™ç§æ‰©å±•</p><p>äº‹å®ä¸Šï¼Œè¯­è¨€å»ºæ¨¡åªæ­ç¤ºäº†åºåˆ—å­¦ä¹ èƒ½åŠ›çš„å†°å±±ä¸€è§’ã€‚ åœ¨å„ç§åºåˆ—å­¦ä¹ é—®é¢˜ä¸­ï¼Œå¦‚è‡ªåŠ¨è¯­éŸ³è¯†åˆ«ã€æ–‡æœ¬åˆ°è¯­éŸ³è½¬æ¢å’Œæœºå™¨ç¿»è¯‘ï¼Œ è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ä»»æ„é•¿åº¦çš„åºåˆ—ã€‚ ä¸ºäº†é˜è¿°å¦‚ä½•æ‹Ÿåˆè¿™ç§ç±»å‹çš„æ•°æ®ï¼Œ æˆ‘ä»¬å°†ä»¥æœºå™¨ç¿»è¯‘ä¸ºä¾‹ä»‹ç»åŸºäºå¾ªç¯ç¥ç»ç½‘ç»œçš„ â€œç¼–ç å™¨ï¼è§£ç å™¨â€æ¶æ„å’ŒæŸæœç´¢ï¼Œå¹¶ç”¨å®ƒä»¬æ¥ç”Ÿæˆåºåˆ—</p><p><strong>ç”±äºæˆ‘å¯¹äº RNN çš„ç ”ç©¶ç”šå°‘ï¼Œæ‰€ä»¥è¿™äº›ç« èŠ‚æ•´ç†å°†ä¼šæ¯”è¾ƒç²—ç³™</strong></p><h2 id="é—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰"><a href="#é—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰" class="headerlink" title="é—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰"></a>é—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰</h2><p>å¯¹äºä¸€ä¸ªç³»åˆ—æ¥è¯´ï¼Œä¸æ˜¯æ¯ä¸€ä¸ªè§‚å¯Ÿå€¼éƒ½æ˜¯åŒç­‰é‡è¦ï¼Œæˆ‘ä»¬å¸Œæœ›å¾ªç¯ç¥ç»ç½‘ç»œèƒ½å¤Ÿè®°ä½æƒ³è¦çš„è§‚å¯Ÿï¼Œå¿½ç•¥ä¸é‡è¦è§‚å¯Ÿã€‚GRU ä½¿ç”¨äº†ä¸¤ä¸ªé—¨ï¼šæ›´æ–°é—¨å’Œé‡ç½®é—¨æ¥è¾¾åˆ°è¿™æ ·çš„ç›®çš„ï¼Œä¸¤ä¸ªé—¨å…·æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ˜¾è‘—ç‰¹å¾ï¼š</p><ul><li>é‡ç½®é—¨æœ‰åŠ©äºæ•è·åºåˆ—ä¸­çš„çŸ­æœŸä¾èµ–å…³ç³»</li><li>æ›´æ–°é—¨æœ‰åŠ©äºæ•è·åºåˆ—ä¸­çš„é•¿æœŸä¾èµ–å…³ç³»</li></ul><p>è¿™æ„å‘³ç€æ¨¡å‹æœ‰ä¸“é—¨çš„æœºåˆ¶æ¥ç¡®å®šåº”è¯¥ä½•æ—¶æ›´æ–°éšçŠ¶æ€ï¼Œ ä»¥åŠåº”è¯¥ä½•æ—¶é‡ç½®éšçŠ¶æ€ã€‚ è¿™äº›æœºåˆ¶æ˜¯å¯å­¦ä¹ çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿè§£å†³äº†ä¸Šé¢åˆ—å‡ºçš„é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç¬¬ä¸€ä¸ªè¯å…ƒéå¸¸é‡è¦ï¼Œ æ¨¡å‹å°†å­¦ä¼šåœ¨ç¬¬ä¸€æ¬¡è§‚æµ‹ä¹‹åä¸æ›´æ–°éšçŠ¶æ€ã€‚ åŒæ ·ï¼Œæ¨¡å‹ä¹Ÿå¯ä»¥å­¦ä¼šè·³è¿‡ä¸ç›¸å…³çš„ä¸´æ—¶è§‚æµ‹</p><h3 id="é—¨æ§éšçŠ¶æ€"><a href="#é—¨æ§éšçŠ¶æ€" class="headerlink" title="é—¨æ§éšçŠ¶æ€"></a>é—¨æ§éšçŠ¶æ€</h3><h4 id="é‡ç½®é—¨å’Œæ›´æ–°é—¨"><a href="#é‡ç½®é—¨å’Œæ›´æ–°é—¨" class="headerlink" title="é‡ç½®é—¨å’Œæ›´æ–°é—¨"></a>é‡ç½®é—¨å’Œæ›´æ–°é—¨</h4><p>å…ˆçœ‹ä¸€ä¸ªç®€å•å›¾è§£</p><p><img src="/archives/5c4d4ee5/image-20211209195253434.png" style="zoom:80%;"></p><p>å†æ¥çœ‹å…¶æ•°å­¦è¡¨è¾¾ï¼Œå¯¹äºç»™å®šçš„æ—¶é—´æ­¥ tï¼Œå‡è®¾è¾“å…¥æ˜¯ä¸€ä¸ªå°æ‰¹é‡ $X_tâˆˆR^{nÃ—d}$ï¼Œ ä¸Šä¸€ä¸ªæ—¶é—´æ­¥çš„éšçŠ¶æ€æ˜¯ $H_{tâˆ’1}âˆˆR^{nÃ—h}$ ï¼Œé‡ç½®é—¨ $R_tâˆˆR^{nÃ—h}$å’Œæ›´æ–°é—¨ $Z_tâˆˆR^{nÃ—h}$</p><script type="math/tex; mode=display">\begin{aligned}\mathbf{R}_{t} &=\sigma\left(\mathbf{X}_{t} \mathbf{W}_{x r}+\mathbf{H}_{t-1} \mathbf{W}_{h r}+\mathbf{b}_{r}\right), \\\mathbf{Z}_{t} &=\sigma\left(\mathbf{X}_{t} \mathbf{W}_{x z}+\mathbf{H}_{t-1} \mathbf{W}_{h z}+\mathbf{b}_{z}\right),\end{aligned}</script><p>ä½¿ç”¨ sigmoid å‡½æ•°å°†è¾“å…¥å€¼è½¬æ¢åˆ°åŒºé—´ (0,1)ï¼Œæƒé‡å°† $X_t$ å’Œ $H_{t-1}$ è½¬åŒ–åˆ°ç»´åº¦ä¸º $h$ çš„éšçŠ¶æ€</p><h4 id="å€™é€‰éšçŠ¶æ€"><a href="#å€™é€‰éšçŠ¶æ€" class="headerlink" title="å€™é€‰éšçŠ¶æ€"></a>å€™é€‰éšçŠ¶æ€</h4><p>å°†é‡ç½®é—¨ $R_t$ ä¸å¸¸è§„éšçŠ¶æ€æ›´æ–°æœºåˆ¶é›†æˆï¼Œ å¾—åˆ°åœ¨æ—¶é—´æ­¥ t çš„å€™é€‰éšçŠ¶æ€ï¼ˆcandidate hidden stateï¼‰ $\tilde{H}_t \in R^{n \times h}$</p><script type="math/tex; mode=display">\tilde{\mathbf{H}}_{t}=\tanh \left(\mathbf{X}_{t} \mathbf{W}_{x h}+\left(\mathbf{R}_{t} \odot \mathbf{H}_{t-1}\right) \mathbf{W}_{h h}+\mathbf{b}_{h}\right)</script><p>ç¬¦å· âŠ™ æ˜¯ Hadamard ç§¯ï¼ˆæŒ‰å…ƒç´ ä¹˜ç§¯ï¼‰è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬ä½¿ç”¨ tanh éçº¿æ€§æ¿€æ´»å‡½æ•°æ¥ç¡®ä¿å€™é€‰éšçŠ¶æ€ä¸­çš„å€¼ä¿æŒåœ¨åŒºé—´ (âˆ’1,1) ä¸­</p><p>å½“é‡ç½®é—¨æ¥è¿‘ä¸º1å°±å›åˆ°æ™®é€šçš„å¾ªç¯ç¥ç»ç½‘ç»œï¼Œè‹¥é‡ç½®é—¨ä¸º0åˆ™æ”¾å¼ƒä¹‹å‰çš„éšçŠ¶æ€</p><h4 id="éšçŠ¶æ€"><a href="#éšçŠ¶æ€" class="headerlink" title="éšçŠ¶æ€"></a>éšçŠ¶æ€</h4><p>æ›´æ–°é—¨å°† $H_{t-1}$ å’Œ $\tilde{H}_t$ ä¹‹é—´è¿›è¡ŒæŒ‰å…ƒç´ çš„å‡¸ç»„åˆï¼Œä»¥ç¡®å®šä¿ç•™å¤šå°‘ä¸Šä¸€æ­¥çš„éšçŠ¶æ€ï¼Œåˆ°æ­¤å°±å¾—å‡ºäº†é—¨æ§å¾ªç¯å•å…ƒçš„æœ€ç»ˆæ›´æ–°å…¬å¼</p><script type="math/tex; mode=display">\mathbf{H}_{t}=\mathbf{Z}_{t} \odot \mathbf{H}_{t-1}+\left(1-\mathbf{Z}_{t}\right) \odot \tilde{\mathbf{H}}_{t}</script><p>æœ€åæ”¾ä¸€ä¸ªâ€œèŠ±å“¨â€çš„å›¾ç¤ºï¼Œæ¥è¡¨ç¤ºæ•´ä¸ªæµç¨‹ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰æ•°å­¦è¡¨è¾¾çœ‹èµ·æ¥æ¸…æ™°</p><p><img src="/archives/5c4d4ee5/image-20211209202833640.png" style="zoom: 80%;"></p><p>åˆ°ç°åœ¨æˆ‘éƒ½æŒºéš¾ä»¥ç†è§£è¿™ä¸¤ä¸ªé—¨çš„ä½œç”¨ï¼Œåªèƒ½è‡ªå·±ç”Ÿç¡¬ç†è§£äº†ï¼š</p><ol><li>é‡ç½®é—¨ï¼Œå†³å®šå½“å‰å€™é€‰éšçŠ¶æ€å¯¹äºå½“å‰è¾“å…¥çš„å½±å“ç¨‹åº¦ï¼ˆåŠæ—¶ï¼‰ï¼Œèƒ½å¤Ÿè®©ç½‘ç»œæ›´è½»æ¾åœ°å…³æ³¨å½“ä¸‹</li><li>æ›´æ–°é—¨ï¼Œæœ‰ç‚¹åƒæ®‹å·®ä¸€æ ·ï¼Œå†³å®šä¿ç•™å¤šå°‘å‰ä¸€æ—¶åˆ»éšçŠ¶æ€çš„ç‰¹å¾ï¼ˆé•¿æœŸï¼‰ï¼Œèƒ½å¤Ÿè®©ç½‘ç»œæ›´è½»æ¾åœ°è®°ä½ä¹‹å‰</li></ol><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>ä»¥ä¸Šå››ä¸ªå…¬å¼å°±æ˜¯ GRU çš„æ ¸å¿ƒï¼Œè´´ä¸€ä¸‹ä»é›¶å®ç°çš„ GRU æ ¸å¿ƒä»£ç ï¼Œç•¥å»æ•°æ®çš„åˆå§‹åŒ–å’ŒéšçŠ¶æ€çš„åˆå§‹åŒ–</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gru</span><span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> state<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">:</span>    W_xz<span class="token punctuation">,</span> W_hz<span class="token punctuation">,</span> b_z<span class="token punctuation">,</span> W_xr<span class="token punctuation">,</span> W_hr<span class="token punctuation">,</span> b_r<span class="token punctuation">,</span> W_xh<span class="token punctuation">,</span> W_hh<span class="token punctuation">,</span> b_h<span class="token punctuation">,</span> W_hq<span class="token punctuation">,</span> b_q <span class="token operator">=</span> params    H<span class="token punctuation">,</span> <span class="token operator">=</span> state    outputs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> X <span class="token keyword">in</span> inputs<span class="token punctuation">:</span>        Z <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">(</span>X @ W_xz<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>H @ W_hz<span class="token punctuation">)</span> <span class="token operator">+</span> b_z<span class="token punctuation">)</span>        R <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">(</span>X @ W_xr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>H @ W_hr<span class="token punctuation">)</span> <span class="token operator">+</span> b_r<span class="token punctuation">)</span>        H_tilda <span class="token operator">=</span> torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span><span class="token punctuation">(</span>X @ W_xh<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>R <span class="token operator">*</span> H<span class="token punctuation">)</span> @ W_hh<span class="token punctuation">)</span> <span class="token operator">+</span> b_h<span class="token punctuation">)</span>        H <span class="token operator">=</span> Z <span class="token operator">*</span> H <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> Z<span class="token punctuation">)</span> <span class="token operator">*</span> H_tilda        Y <span class="token operator">=</span> H @ W_hq <span class="token operator">+</span> b_q        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Y<span class="token punctuation">)</span>    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>H<span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç®€æ´å®ç° GRU åªéœ€è¦ä¸€è¡Œï¼Œå°†å…¶æ›¿æ¢ä¸Šä¸€èŠ‚çš„ RNN å•å…ƒï¼Œå³å¯å¾—åˆ°æ–°çš„ RNN æ¨¡å‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">num_inputs <span class="token operator">=</span> vocab_sizegru_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span>model <span class="token operator">=</span> d2l<span class="token punctuation">.</span>RNNModel<span class="token punctuation">(</span>gru_layer<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">)</span>model <span class="token operator">=</span> model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>d2l<span class="token punctuation">.</span>train_ch8<span class="token punctuation">(</span>model<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰"><a href="#é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰" class="headerlink" title="é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰"></a>é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼‰</h2><p>é•¿æœŸä»¥æ¥ï¼Œéšå˜é‡æ¨¡å‹å­˜åœ¨ç€é•¿æœŸä¿¡æ¯ä¿å­˜å’ŒçŸ­æœŸè¾“å…¥ç¼ºå¤±çš„é—®é¢˜ã€‚ è§£å†³è¿™ä¸€é—®é¢˜çš„æœ€æ—©æ–¹æ³•ä¹‹ä¸€æ˜¯é•¿çŸ­æœŸå­˜å‚¨å™¨ï¼ˆlong short-term memoryï¼ŒLSTMï¼‰ï¼Œæœ‰è¶£çš„æ˜¯ï¼Œé•¿çŸ­æœŸè®°å¿†ç½‘ç»œçš„è®¾è®¡æ¯”é—¨æ§å¾ªç¯å•å…ƒç¨å¾®å¤æ‚ä¸€äº›ï¼Œ å´æ¯”é—¨æ§å¾ªç¯å•å…ƒæ—©è¯ç”Ÿäº†è¿‘20å¹´</p><h3 id="é—¨æ§è®°å¿†å…ƒ"><a href="#é—¨æ§è®°å¿†å…ƒ" class="headerlink" title="é—¨æ§è®°å¿†å…ƒ"></a>é—¨æ§è®°å¿†å…ƒ</h3><p>è¯¥è®°å¿†å…ƒçš„å®ç°æ¯” GRU ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä¸‹é¢å…·ä½“æ¥çœ‹çœ‹</p><h4 id="è¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨"><a href="#è¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨" class="headerlink" title="è¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨"></a>è¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨</h4><p>åŒæ ·å…ˆçœ‹ä¸€ä¸ªç®€å•å›¾è§£</p><p><img src="/archives/5c4d4ee5/image-20211209203459078.png" style="zoom:80%;"></p><p>å†æ¥çœ‹å…¶æ•°å­¦è¡¨è¾¾å¼</p><script type="math/tex; mode=display">\begin{aligned}\mathbf{I}_{t} &=\sigma\left(\mathbf{X}_{t} \mathbf{W}_{x i}+\mathbf{H}_{t-1} \mathbf{W}_{h i}+\mathbf{b}_{i}\right) \\\mathbf{F}_{t} &=\sigma\left(\mathbf{X}_{t} \mathbf{W}_{x f}+\mathbf{H}_{t-1} \mathbf{W}_{h f}+\mathbf{b}_{f}\right) \\\mathbf{O}_{t} &=\sigma\left(\mathbf{X}_{t} \mathbf{W}_{x o}+\mathbf{H}_{t-1} \mathbf{W}_{h o}+\mathbf{b}_{o}\right)\end{aligned}</script><p>å°±æ˜¯å’Œ GRU çš„æ›´æ–°é—¨å’Œé‡ç½®é—¨ä¸€æ ·çš„å…¬å¼</p><h4 id="å€™é€‰è®°å¿†å…ƒ"><a href="#å€™é€‰è®°å¿†å…ƒ" class="headerlink" title="å€™é€‰è®°å¿†å…ƒ"></a>å€™é€‰è®°å¿†å…ƒ</h4><p>ç±»ä¼¼äº GRU çš„å€™é€‰éšçŠ¶æ€ï¼Œä¹Ÿæ˜¯å—ç”¨ tanh ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯æ²¡æœ‰å…¶ä»–é—¨æ§çš„å‚ä¸</p><script type="math/tex; mode=display">\tilde{\mathbf{C}}_{t}=\tanh \left(\mathbf{X}_{t} \mathbf{W}_{x c}+\mathbf{H}_{t-1} \mathbf{W}_{h c}+\mathbf{b}_{c}\right)</script><h4 id="è®°å¿†å…ƒ"><a href="#è®°å¿†å…ƒ" class="headerlink" title="è®°å¿†å…ƒ"></a>è®°å¿†å…ƒ</h4><p>ç°åœ¨åŸºç¡€çš„ææ–™å‡†å¤‡å®Œæ¯•ï¼Œå¼€å§‹è¿›è¡Œç»„åˆæ§åˆ¶ã€‚ç±»ä¼¼äº GRU çš„æœ€åéšçŠ¶æ€æ›´æ–°ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯è®°å¿†å…ƒå’Œä¸¤ä¸ªé—¨ï¼Œå…¶è¡¨è¾¾å¼å¦‚ä¸‹</p><script type="math/tex; mode=display">\mathbf{C}_{t}=\mathbf{F}_{t} \odot \mathbf{C}_{t-1}+\mathbf{I}_{t} \odot \tilde{\mathbf{C}}_{t}</script><h4 id="éšçŠ¶æ€-1"><a href="#éšçŠ¶æ€-1" class="headerlink" title="éšçŠ¶æ€"></a>éšçŠ¶æ€</h4><p>æœ€ç»ˆçš„éšçŠ¶æ€æ›´æ–°å…¬å¼ä¸º</p><script type="math/tex; mode=display">\mathbf{H}_{t}=\mathbf{O}_{t} \odot \tanh \left(\mathbf{C}_{t}\right)</script><h3 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>ä»é›¶å®ç°çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼ŒåŒæ ·è¿™é‡Œå¿½ç•¥æ•°æ®åˆå§‹åŒ–å’ŒéšçŠ¶æ€åˆå§‹åŒ–</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">lstm</span><span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> state<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token punctuation">[</span>W_xi<span class="token punctuation">,</span> W_hi<span class="token punctuation">,</span> b_i<span class="token punctuation">,</span> W_xf<span class="token punctuation">,</span> W_hf<span class="token punctuation">,</span> b_f<span class="token punctuation">,</span> W_xo<span class="token punctuation">,</span> W_ho<span class="token punctuation">,</span> b_o<span class="token punctuation">,</span> W_xc<span class="token punctuation">,</span> W_hc<span class="token punctuation">,</span> b_c<span class="token punctuation">,</span>     W_hq<span class="token punctuation">,</span> b_q<span class="token punctuation">]</span> <span class="token operator">=</span> params    <span class="token punctuation">(</span>H<span class="token punctuation">,</span> C<span class="token punctuation">)</span> <span class="token operator">=</span> state    outputs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> X <span class="token keyword">in</span> inputs<span class="token punctuation">:</span>        I <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">(</span>X @ W_xi<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>H @ W_hi<span class="token punctuation">)</span> <span class="token operator">+</span> b_i<span class="token punctuation">)</span>        F <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">(</span>X @ W_xf<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>H @ W_hf<span class="token punctuation">)</span> <span class="token operator">+</span> b_f<span class="token punctuation">)</span>        O <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">(</span>X @ W_xo<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>H @ W_ho<span class="token punctuation">)</span> <span class="token operator">+</span> b_o<span class="token punctuation">)</span>        C_tilda <span class="token operator">=</span> torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span><span class="token punctuation">(</span>X @ W_xc<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>H @ W_hc<span class="token punctuation">)</span> <span class="token operator">+</span> b_c<span class="token punctuation">)</span>        C <span class="token operator">=</span> F <span class="token operator">*</span> C <span class="token operator">+</span> I <span class="token operator">*</span> C_tilda        H <span class="token operator">=</span> O <span class="token operator">*</span> torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>C<span class="token punctuation">)</span>        Y <span class="token operator">=</span> <span class="token punctuation">(</span>H @ W_hq<span class="token punctuation">)</span> <span class="token operator">+</span> b_q        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Y<span class="token punctuation">)</span>    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>H<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹å¯ä»¥çœ‹åˆ° LSTM é™¤äº†éšçŠ¶æ€ $H_t$ éœ€è¦ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ï¼Œè¿˜éœ€è¦ä¼ é€’è®°å¿†å…ƒ $C_t$ï¼Œç®€æ´å®ç°å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">num_inputs <span class="token operator">=</span> vocab_sizelstm_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span>model <span class="token operator">=</span> d2l<span class="token punctuation">.</span>RNNModel<span class="token punctuation">(</span>lstm_layer<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">)</span>model <span class="token operator">=</span> model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>d2l<span class="token punctuation">.</span>train_ch8<span class="token punctuation">(</span>model<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ•™æä»…ä»…æ˜¯ç®€å•ä»‹ç»äº†è¿™äº›ç»“æ„ï¼Œå¯¹äºè¿™äº›ç»“æ„ä¸ºä»€ä¹ˆæœ‰ç”¨å¹¶æ²¡æœ‰æ·±å…¥åˆ†æã€‚åœ¨å´æ©è¾¾è®²è§£çš„ <a href="https://www.bilibili.com/video/BV1FT4y1E74V?p=159">GRU</a> è®²è§£äº†ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ï¼Œå³æ²¡æœ‰é‡ç½®é—¨çš„ç‰ˆæœ¬ï¼Œè¿™å°±è®©é‡ç½®é—¨çš„ä½œç”¨å˜å¾—æ›´åŠ æ¨¡ç³Šäº†ã€‚ä»¥æˆ‘æ„šè ¢çš„è§è§£æ¥çœ‹ï¼ŒGRU çš„ä¸¤ä¸ªé—¨æ§ä½œç”¨å¯èƒ½æ¥è‡ªä»¥ä¸‹ç›´è§‰ï¼š</p><ol><li>ä»¥æ®‹å·®ç½‘ç»œçš„è§‚ç‚¹æ¥ç†è§£æ›´æ–°é—¨ï¼Œèƒ½å¤Ÿè®©ç½‘ç»œæ›´å¥½å­¦ä¹ æ’ç­‰å˜æ¢ï¼Œå³æ–¹ä¾¿ä¿ç•™å†å²ä¿¡æ¯</li><li>é‡ç½®é—¨è¿›ä¸€æ­¥å¢åŠ ç½‘ç»œçµæ´»æ€§ï¼Œå¯¹éšçŠ¶æ€åŠ ä»¥æƒé‡ï¼Œæ˜¯å¦æ”¾å¼ƒå†å²çŠ¶æ€ä»¥ä¸“æ³¨å½“å‰è¾“å…¥</li></ol><h2 id="æ·±åº¦å¾ªç¯ç¥ç»ç½‘è·¯"><a href="#æ·±åº¦å¾ªç¯ç¥ç»ç½‘è·¯" class="headerlink" title="æ·±åº¦å¾ªç¯ç¥ç»ç½‘è·¯"></a>æ·±åº¦å¾ªç¯ç¥ç»ç½‘è·¯</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªè®¨è®ºäº†å…·æœ‰ä¸€ä¸ªå•å‘éšè—å±‚çš„å¾ªç¯ç¥ç»ç½‘ç»œï¼Œ è€Œåœ¨å¾ªç¯ç¥ç»ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®å®šå¦‚ä½•æ·»åŠ æ›´å¤šçš„å±‚ï¼Œ ä»¥åŠåœ¨å“ªé‡Œæ·»åŠ é¢å¤–çš„éçº¿æ€§</p><p>ä¸‹é¢æè¿°äº†ä¸€ä¸ªå…·æœ‰ L ä¸ªéšè—å±‚çš„æ·±åº¦å¾ªç¯ç¥ç»ç½‘ç»œï¼Œ æ¯ä¸ªéšçŠ¶æ€éƒ½è¿ç»­åœ°ä¼ é€’åˆ°å½“å‰å±‚çš„ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥å’Œä¸‹ä¸€å±‚çš„å½“å‰æ—¶é—´æ­¥</p><p><img src="/archives/5c4d4ee5/image-20211210150421071.png" style="zoom:80%;"></p><p>æ•°å­¦è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\mathbf{H}_{t}^{(l)}=\phi_{l}\left(\mathbf{H}_{t}^{(l-1)} \mathbf{W}_{x h}^{(l)}+\mathbf{H}_{t-1}^{(l)} \mathbf{W}_{h h}^{(l)}+\mathbf{b}_{h}^{(l)}\right)\\\mathbf{O}_{t}=\mathbf{H}_{t}^{(L)} \mathbf{W}_{h q}+\mathbf{b}_{q}</script><p>ä¸å¤šå±‚æ„ŸçŸ¥æœºä¸€æ ·ï¼Œéšè—å±‚æ•°ç›® L å’Œéšè—å•å…ƒæ•°ç›® h éƒ½æ˜¯è¶…å‚æ•°</p><h3 id="ç®€ä»‹å®ç°"><a href="#ç®€ä»‹å®ç°" class="headerlink" title="ç®€ä»‹å®ç°"></a>ç®€ä»‹å®ç°</h3><p>åªéœ€è¦å¤šåŠ ä¸€ä¸ªå‚æ•° <code>num_layers</code> å°±å¯ä»¥æå®šäº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">vocab_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_layers <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">2</span>num_inputs <span class="token operator">=</span> vocab_sizedevice <span class="token operator">=</span> d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span>lstm_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_layers<span class="token punctuation">)</span>model <span class="token operator">=</span> d2l<span class="token punctuation">.</span>RNNModel<span class="token punctuation">(</span>lstm_layer<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">)</span>model <span class="token operator">=</span> model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºä½¿ç”¨äº†é•¿çŸ­æœŸè®°å¿†ç½‘ç»œæ¨¡å‹æ¥å®ä¾‹åŒ–ä¸¤ä¸ªå±‚ï¼Œå› æ­¤è®­ç»ƒé€Ÿåº¦è¢«å¤§å¤§é™ä½äº†ï¼ˆå·¦ä¾§ä¸ºå•å±‚ GRUï¼Œå³ä¾§ä¸ºä¸¤å±‚ GRUï¼‰</p><p><img src="/archives/5c4d4ee5/image-20211210151851947.png" style="zoom:80%;"></p><h2 id="åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ"></a>åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ</h2><p>åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œçš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯ï¼šä½¿ç”¨æ¥è‡ªåºåˆ—ä¸¤ç«¯çš„ä¿¡æ¯æ¥ä¼°è®¡è¾“å‡ºã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬<strong>ä½¿ç”¨æ¥è‡ªè¿‡å»å’Œæœªæ¥çš„è§‚æµ‹ä¿¡æ¯æ¥é¢„æµ‹å½“å‰çš„è§‚æµ‹</strong>ã€‚ ä½†æ˜¯åœ¨å¯¹ä¸‹ä¸€ä¸ªè¯å…ƒè¿›è¡Œé¢„æµ‹çš„æƒ…å†µä¸­ï¼Œè¿™æ ·çš„æ¨¡å‹å¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€éœ€çš„</p><p>åŒå‘å±‚çš„ä½¿ç”¨åœ¨å®è·µä¸­éå¸¸å°‘ï¼Œå¹¶ä¸”ä»…ä»…åº”ç”¨äºéƒ¨åˆ†åœºåˆã€‚ ä¾‹å¦‚ï¼Œå¡«å……ç¼ºå¤±çš„å•è¯ã€è¯å…ƒæ³¨é‡Šï¼ˆä¾‹å¦‚ï¼Œç”¨äºå‘½åå®ä½“è¯†åˆ«ï¼‰ ä»¥åŠä½œä¸ºåºåˆ—å¤„ç†æµæ°´çº¿ä¸­çš„ä¸€ä¸ªæ­¥éª¤å¯¹åºåˆ—è¿›è¡Œç¼–ç ï¼ˆ<strong>ä¾‹å¦‚ï¼Œç”¨äºæœºå™¨ç¿»è¯‘</strong>ï¼‰</p><p><img src="/archives/5c4d4ee5/image-20211210154429643.png" style="zoom: 80%;"></p><script type="math/tex; mode=display">\begin{array}{l}\overrightarrow{\mathbf{H}}_{t}=\phi\left(\mathbf{X}_{t} \mathbf{W}_{x h}^{(f)}+\overrightarrow{\mathbf{H}}_{t-1} \mathbf{W}_{h h}^{(f)}+\mathbf{b}_{h}^{(f)}\right) \\\overleftarrow{\mathbf{H}}_{t}=\phi\left(\mathbf{X}_{t} \mathbf{W}_{x h}^{(b)}+\overleftarrow{\mathbf{H}}_{t+1} \mathbf{W}_{h h}^{(b)}+\mathbf{b}_{h}^{(b)}\right)\end{array}</script><p>å°†ä¸¤ä¸ªæ–¹å‘çš„éšçŠ¶æ€è¿æ¥èµ·æ¥è¿›è¡Œå¯¹è¾“å‡ºçš„é¢„æµ‹</p><script type="math/tex; mode=display">\mathbf{O}_{t}=\mathbf{H}_{t} \mathbf{W}_{h q}+\mathbf{b}_{q}</script><h2 id="æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›†"><a href="#æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›†" class="headerlink" title="æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›†"></a>æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›†</h2><p>éœ€è¦äº†è§£çš„ç‚¹ï¼š</p><ol><li><p>æœºå™¨ç¿»è¯‘çš„æ•°æ®é›†æ˜¯ç”±æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„æ–‡æœ¬åºåˆ—å¯¹ç»„æˆçš„</p></li><li><p>åœ¨æœºå™¨ç¿»è¯‘ä¸­ï¼Œæˆ‘ä»¬æ›´å–œæ¬¢å•è¯çº§è¯å…ƒåŒ– ï¼ˆæœ€å…ˆè¿›çš„æ¨¡å‹å¯èƒ½ä½¿ç”¨æ›´é«˜çº§çš„è¯å…ƒåŒ–æŠ€æœ¯ï¼‰å…¶ä¸­æ¯ä¸ªè¯å…ƒè¦ä¹ˆæ˜¯ä¸€ä¸ªè¯ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªæ ‡ç‚¹ç¬¦å·</p></li><li><p>ç”±äºæœºå™¨ç¿»è¯‘æ•°æ®é›†ç”±è¯­è¨€å¯¹ç»„æˆï¼Œ å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä¸ºæºè¯­è¨€å’Œç›®æ ‡è¯­è¨€æ„å»ºä¸¤ä¸ªè¯è¡¨</p></li><li><p>æˆ‘ä»¬è¿˜æŒ‡å®šäº†é¢å¤–çš„ç‰¹å®šè¯å…ƒï¼Œ ä¾‹å¦‚åœ¨å°æ‰¹é‡æ—¶ç”¨äºå°†åºåˆ—å¡«å……åˆ°ç›¸åŒé•¿åº¦çš„å¡«å……è¯å…ƒï¼ˆâ€œ<pad>â€ï¼‰ï¼Œ ä»¥åŠåºåˆ—çš„å¼€å§‹è¯å…ƒï¼ˆâ€œ<bos>â€ï¼‰å’Œç»“æŸè¯å…ƒï¼ˆâ€œ<eos>â€ï¼‰ã€‚ è¿™äº›ç‰¹æ®Šè¯å…ƒåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­æ¯”è¾ƒå¸¸ç”¨</eos></bos></pad></p></li><li><p>åœ¨æœºå™¨ç¿»è¯‘ä¸­ï¼Œæ¯ä¸ªæ ·æœ¬éƒ½æ˜¯ç”±æºå’Œç›®æ ‡ç»„æˆçš„æ–‡æœ¬åºåˆ—å¯¹ï¼Œ å…¶ä¸­çš„æ¯ä¸ªæ–‡æœ¬åºåˆ—å¯èƒ½å…·æœ‰ä¸åŒçš„é•¿åº¦ã€‚ä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡æˆªæ–­ï¼ˆtruncationï¼‰å’Œ å¡«å……ï¼ˆpaddingï¼‰æ–¹å¼å®ç°ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªå°æ‰¹é‡çš„æ–‡æœ¬åºåˆ—</p></li></ol><h2 id="ç¼–ç å™¨-è§£ç å™¨æ¶æ„"><a href="#ç¼–ç å™¨-è§£ç å™¨æ¶æ„" class="headerlink" title="ç¼–ç å™¨-è§£ç å™¨æ¶æ„"></a>ç¼–ç å™¨-è§£ç å™¨æ¶æ„</h2><p> ä¸ºäº†å¤„ç†è¿™ç§ç±»å‹çš„è¾“å…¥å’Œè¾“å‡ºï¼Œ æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªä¸»è¦ç»„ä»¶çš„æ¶æ„ï¼š ç¬¬ä¸€ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ªç¼–ç å™¨ï¼ˆencoderï¼‰ï¼š å®ƒæ¥å—ä¸€ä¸ªé•¿åº¦å¯å˜çš„åºåˆ—ä½œä¸ºè¾“å…¥ï¼Œ å¹¶å°†å…¶è½¬æ¢ä¸ºå…·æœ‰å›ºå®šå½¢çŠ¶çš„ç¼–ç çŠ¶æ€ã€‚ ç¬¬äºŒä¸ªç»„ä»¶æ˜¯è§£ç å™¨ï¼ˆdecoderï¼‰ï¼š å®ƒå°†å›ºå®šå½¢çŠ¶çš„ç¼–ç çŠ¶æ€æ˜ å°„åˆ°é•¿åº¦å¯å˜çš„åºåˆ—ã€‚ è¿™è¢«ç§°ä¸ºç¼–ç å™¨-è§£ç å™¨ï¼ˆencoder-decoderï¼‰æ¶æ„</p><p><img src="/archives/5c4d4ee5/image-20211210160641142.png" style="zoom:80%;"></p><h2 id="åºåˆ—åˆ°åºåˆ—å­¦ä¹ ï¼ˆseq2seqï¼‰"><a href="#åºåˆ—åˆ°åºåˆ—å­¦ä¹ ï¼ˆseq2seqï¼‰" class="headerlink" title="åºåˆ—åˆ°åºåˆ—å­¦ä¹ ï¼ˆseq2seqï¼‰"></a>åºåˆ—åˆ°åºåˆ—å­¦ä¹ ï¼ˆseq2seqï¼‰</h2><p> æœ¬èŠ‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªå¾ªç¯ç¥ç»ç½‘ç»œçš„ç¼–ç å™¨å’Œè§£ç å™¨ï¼Œ å¹¶å°†å…¶åº”ç”¨äºåºåˆ—åˆ°åºåˆ—ï¼ˆsequence to sequenceï¼Œseq2seqï¼‰ç±»çš„å­¦ä¹ ä»»åŠ¡</p><p>å¾ªç¯ç¥ç»ç½‘ç»œ<strong>ç¼–ç å™¨</strong>ä½¿ç”¨é•¿åº¦å¯å˜çš„åºåˆ—ä½œä¸ºè¾“å…¥ï¼Œ å°†å…¶è½¬æ¢ä¸ºå›ºå®šå½¢çŠ¶çš„éšçŠ¶æ€ã€‚ ä¸ºäº†è¿ç»­ç”Ÿæˆè¾“å‡ºåºåˆ—çš„è¯å…ƒï¼Œ ç‹¬ç«‹çš„å¾ªç¯ç¥ç»ç½‘ç»œ<strong>è§£ç å™¨</strong>æ˜¯åŸºäºè¾“å…¥åºåˆ—çš„ç¼–ç ä¿¡æ¯å’Œè¾“å‡ºåºåˆ—å·²ç»çœ‹è§çš„ï¼ˆtrain modeï¼‰æˆ–è€…ç”Ÿæˆçš„è¯å…ƒï¼ˆtest modeï¼‰æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªè¯å…ƒ</p><p><img src="/archives/5c4d4ee5/image-20211210164750436.png" style="zoom:80%;"></p><p>éœ€è¦äº†è§£çš„ç‚¹ï¼š</p><ol><li><p>å›¾ç¤ºç»“æ„ä¸­ï¼Œç¼–ç å™¨æœ€ç»ˆçš„éšçŠ¶æ€åœ¨æ¯ä¸€ä¸ªæ—¶é—´æ­¥éƒ½ä½œä¸ºè§£ç å™¨çš„è¾“å…¥åºåˆ—çš„ä¸€éƒ¨åˆ†ã€‚å…·ä½“æ¥è¯´æ˜¯å’Œ input è¿›è¡Œç»´åº¦è¿æ¥ <code>torch.cat</code></p></li><li><p>ç¼–ç å™¨ RNN æ˜¯æ²¡æœ‰è¾“å‡ºå±‚çš„ï¼Œå¹¶ä¸”å¯ä»¥æ˜¯åŒå‘ RNN</p></li><li><p>åœ¨è®­ç»ƒæ—¶è§£ç å™¨ä½¿ç”¨æ ‡ç­¾ä½œä¸ºè¾“å…¥ï¼›æ¨ç†æ—¶è§£ç å™¨ä½¿ç”¨ä¸Šä¸€æ—¶é—´æ­¥çš„è¾“å‡ºä½œä¸ºè¾“å…¥</p></li><li><p>è¡¡é‡ç”Ÿæˆåºåˆ—çš„å¥½åä½¿ç”¨ BLEU (bilingual evaluation understudy)</p><script type="math/tex; mode=display">\exp \left(\min \left(0,1-\frac{\text { len }_{\text {label }}}{\text { len }_{\text {pred }}}\right)\right) \prod_{n=1}^{k} p_{n}^{1 / 2^{n}}</script><p>å…³äº BLEU:</p><ol><li><p>BLEU å€¼è¶Šå¤§è¡¨ç¤ºç»“æœè¶Šå¥½</p></li><li><p>å…¶ä¸­ len è¡¨ç¤ºè¯å…ƒæ•°ï¼Œk æ˜¯ç”¨äºåŒ¹é…çš„æœ€é•¿çš„ n å…ƒè¯­æ³•ã€‚ å¦å¤–ï¼Œç”¨ $p_n$ è¡¨ç¤º n å…ƒè¯­æ³•çš„ç²¾ç¡®åº¦ï¼Œå®ƒæ˜¯ä¸¤ä¸ªæ•°é‡çš„æ¯”å€¼ï¼š</p><script type="math/tex; mode=display">\frac{\text{matched n-gram number}}{\text{total predicted n-gram number}}</script><p>ç¬¬ä¸€ä¸ªæ˜¯é¢„æµ‹åºåˆ—ä¸æ ‡ç­¾åºåˆ—ä¸­åŒ¹é…çš„ n å…ƒè¯­æ³•çš„æ•°é‡ï¼Œ ç¬¬äºŒä¸ªæ˜¯é¢„æµ‹åºåˆ—ä¸­ n å…ƒè¯­æ³•çš„æ•°é‡ã€‚çœ‹ä¸ªå°ä¾‹å­ï¼Œæ¥è‡ªæ•™æçš„è®²è§£è§†é¢‘ <a href="https://www.bilibili.com/video/BV16g411L7FG?p=1">bilibili</a></p><p><img src="/archives/5c4d4ee5/image-20211210173916201.png" style="zoom: 33%;"></p></li><li><p>n-gram è¯­æ³•ä¸­ï¼Œn è¶Šå¤§å¯¹å…¶è¶Šé‡è§†ï¼ˆBLEU ä¸­æŒ‡æ•°çš„åŸå› ï¼‰</p></li></ol></li></ol><p>çœ‹çœ‹ç¼–ç å™¨å’Œè§£ç å™¨çš„ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">Seq2SeqEncoder</span><span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>Encoder<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""ç”¨äºåºåˆ—åˆ°åºåˆ—å­¦ä¹ çš„å¾ªç¯ç¥ç»ç½‘ç»œç¼–ç å™¨"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> embed_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span>                 dropout<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Seq2SeqEncoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        <span class="token comment"># åµŒå…¥å±‚</span>        self<span class="token punctuation">.</span>embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embed_size<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>rnn <span class="token operator">=</span> nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>embed_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span>                          dropout<span class="token operator">=</span>dropout<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># è¾“å‡º'X'çš„å½¢çŠ¶ï¼š(batch_size,num_steps,embed_size)</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        <span class="token comment"># åœ¨å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ä¸­ï¼Œç¬¬ä¸€ä¸ªè½´å¯¹åº”äºæ—¶é—´æ­¥</span>        X <span class="token operator">=</span> X<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token comment"># å¦‚æœæœªæåŠçŠ¶æ€ï¼Œåˆ™é»˜è®¤ä¸º0</span>        output<span class="token punctuation">,</span> state <span class="token operator">=</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        <span class="token comment"># outputçš„å½¢çŠ¶:(num_steps,batch_size,num_hiddens)</span>        <span class="token comment"># state[0]çš„å½¢çŠ¶:(num_layers,batch_size,num_hiddens)</span>        <span class="token keyword">return</span> output<span class="token punctuation">,</span> state<span class="token keyword">class</span> <span class="token class-name">Seq2SeqDecoder</span><span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>Decoder<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""ç”¨äºåºåˆ—åˆ°åºåˆ—å­¦ä¹ çš„å¾ªç¯ç¥ç»ç½‘ç»œè§£ç å™¨"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> embed_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span>                 dropout<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Seq2SeqDecoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>vocab_size<span class="token punctuation">,</span> embed_size<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>rnn <span class="token operator">=</span> nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>embed_size <span class="token operator">+</span> num_hiddens<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> num_layers<span class="token punctuation">,</span>                          dropout<span class="token operator">=</span>dropout<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>dense <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_hiddens<span class="token punctuation">,</span> vocab_size<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">init_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> enc_outputs<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> enc_outputs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># è¾“å‡º'X'çš„å½¢çŠ¶ï¼š(batch_size,num_steps,embed_size)</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token comment"># å¹¿æ’­contextï¼Œä½¿å…¶å…·æœ‰ä¸Xç›¸åŒçš„num_steps</span>        context <span class="token operator">=</span> state<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        X_and_context <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        output<span class="token punctuation">,</span> state <span class="token operator">=</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">(</span>X_and_context<span class="token punctuation">,</span> state<span class="token punctuation">)</span>        output <span class="token operator">=</span> self<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token comment"># outputçš„å½¢çŠ¶:(batch_size,num_steps,vocab_size)</span>        <span class="token comment"># state[0]çš„å½¢çŠ¶:(num_layers,batch_size,num_hiddens)</span>        <span class="token keyword">return</span> output<span class="token punctuation">,</span> state<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŸæœç´¢ï¼ˆbeam-searchï¼‰"><a href="#æŸæœç´¢ï¼ˆbeam-searchï¼‰" class="headerlink" title="æŸæœç´¢ï¼ˆbeam searchï¼‰"></a>æŸæœç´¢ï¼ˆbeam searchï¼‰</h2><h3 id="è´ªå¿ƒæœç´¢"><a href="#è´ªå¿ƒæœç´¢" class="headerlink" title="è´ªå¿ƒæœç´¢"></a>è´ªå¿ƒæœç´¢</h3><p>å¯¹äºè¾“å‡ºåºåˆ—çš„æ¯ä¸€æ—¶é—´æ­¥ tâ€²ï¼Œ æˆ‘ä»¬éƒ½å°†åŸºäºè´ªå¿ƒæœç´¢ä»è¾“å‡ºä¸­æ‰¾åˆ°å…·æœ‰æœ€é«˜æ¡ä»¶æ¦‚ç‡çš„è¯å…ƒ</p><script type="math/tex; mode=display">y_{t^{\prime}}=\underset{y \in \mathcal{Y}}{\operatorname{argmax}} P\left(y \mid y_{1}, \ldots, y_{t^{\prime}-1}, \mathbf{c}\right)</script><p>é‚£ä¹ˆè´ªå¿ƒæœç´¢å­˜åœ¨çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ç°å®ä¸­ï¼Œæœ€ä¼˜åºåˆ—ï¼ˆoptimal sequenceï¼‰åº”è¯¥æ˜¯æœ€å¤§åŒ–</p><script type="math/tex; mode=display">\prod_{t^{\prime}=1}^{T^{\prime}} P\left(y_{t^{\prime}} \mid y_{1}, \ldots, y_{t^{\prime}-1}, \mathbf{c}\right)</script><p>è¿™æ˜¯åŸºäºè¾“å…¥åºåˆ—ç”Ÿæˆè¾“å‡ºåºåˆ—çš„æ¡ä»¶æ¦‚ç‡ã€‚ ç„¶è€Œï¼Œè´ªå¿ƒæœç´¢æ— æ³•ä¿è¯å¾—åˆ°æœ€ä¼˜åºåˆ—</p><h3 id="ç©·ä¸¾æœç´¢"><a href="#ç©·ä¸¾æœç´¢" class="headerlink" title="ç©·ä¸¾æœç´¢"></a>ç©·ä¸¾æœç´¢</h3><p>è™½ç„¶ç©·ä¸¾æœç´¢èƒ½ä¿è¯æœ€ä¼˜è§£ï¼Œä½†å…¶è®¡ç®—é‡æ˜¯ä¸å¯æ¥å—çš„ï¼Œä¸º $O(|Y|^{Tâ€™})$ å…¶ä¸­ Y ä¸ºè¯è¡¨é•¿åº¦ï¼ŒTâ€™ ä¸ºè¾“å‡ºæœ€å¤§é•¿åº¦</p><h3 id="æŸæœç´¢"><a href="#æŸæœç´¢" class="headerlink" title="æŸæœç´¢"></a>æŸæœç´¢</h3><p>æŸæœç´¢ï¼ˆbeam searchï¼‰æ˜¯è´ªå¿ƒæœç´¢çš„ä¸€ä¸ªæ”¹è¿›ç‰ˆæœ¬ã€‚ å®ƒæœ‰ä¸€ä¸ªè¶…å‚æ•°ï¼Œåä¸ºæŸå®½ï¼ˆbeam sizeï¼‰kã€‚ åœ¨æ—¶é—´æ­¥1ï¼Œæˆ‘ä»¬é€‰æ‹©å…·æœ‰æœ€é«˜æ¡ä»¶æ¦‚ç‡çš„ k ä¸ªè¯å…ƒã€‚ åœ¨éšåçš„æ¯ä¸ªæ—¶é—´æ­¥ï¼ŒåŸºäºä¸Šä¸€æ—¶é—´æ­¥çš„ k ä¸ªå€™é€‰è¾“å‡ºåºåˆ—ï¼Œ æˆ‘ä»¬å°†ç»§ç»­ä» k|Y| ä¸ªå¯èƒ½çš„é€‰æ‹©ä¸­æŒ‘å‡ºå…·æœ‰æœ€é«˜æ¡ä»¶æ¦‚ç‡çš„ k ä¸ªå€™é€‰è¾“å‡ºåºåˆ—ï¼Œå›¾ç¤ºå¦‚ä¸‹</p><p><img src="/archives/5c4d4ee5/image-20211210180349192.png" style="zoom:80%;"></p><p>æŸæœç´¢çš„è®¡ç®—é‡ä¸º $O(k|Y|Tâ€™)$</p><p>å¯¹äºæˆ‘ä»¬è·å¾—æœ€ç»ˆå€™é€‰è¾“å‡ºåºåˆ—é›†åˆï¼ˆä¸ä»…ä»…æ˜¯æœ€å k ä¸ªé›†åˆï¼Œè¿˜å¯ä»¥åŒ…å«ä¹‹å‰çš„å€™é€‰ç³»åˆ—ï¼‰ï¼Œé€‰æ‹©å…¶ä¸­æ¡ä»¶æ¦‚ç‡ä¹˜ç§¯æœ€é«˜çš„åºåˆ—ä½œä¸ºè¾“å‡ºåºåˆ—</p><script type="math/tex; mode=display">\frac{1}{L^{\alpha}} \log P\left(y_{1}, \ldots, y_{L} \mid \mathbf{c}\right)=\frac{1}{L^{\alpha}} \sum_{t^{\prime}=1}^{L} \log P\left(y_{t^{\prime}} \mid y_{1}, \ldots, y_{t^{\prime}-1}, \mathbf{c}\right)</script><p>å…¶ä¸­ L éƒ¨åˆ†æ˜¯å¯¹é•¿å¥çš„å¥–åŠ±ï¼Œå°±åƒ BLEU ä¸€æ ·</p>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 08 å¾ªç¯ç¥ç»ç½‘ç»œ</title>
      <link href="/archives/a67a203a.html"/>
      <url>/archives/a67a203a.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-08-å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#D2L-08-å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="D2L 08 å¾ªç¯ç¥ç»ç½‘ç»œ"></a>D2L 08 å¾ªç¯ç¥ç»ç½‘ç»œ</h1><h2 id="åºåˆ—æ¨¡å‹"><a href="#åºåˆ—æ¨¡å‹" class="headerlink" title="åºåˆ—æ¨¡å‹"></a>åºåˆ—æ¨¡å‹</h2><p>å¤„ç†åºåˆ—æ•°æ®éœ€è¦ç»Ÿè®¡å·¥å…·å’Œæ–°çš„æ·±åº¦ç¥ç»ç½‘ç»œæ¶æ„</p><h3 id="ç»Ÿè®¡å·¥å…·"><a href="#ç»Ÿè®¡å·¥å…·" class="headerlink" title="ç»Ÿè®¡å·¥å…·"></a>ç»Ÿè®¡å·¥å…·</h3><p>æ•™æä»¥è‚¡ç¥¨çš„ä¾‹å­ä½œä¸ºä¾‹å­ï¼Œå‡è®¾ä¸€ä¸ªäº¤æ˜“å‘˜æƒ³åœ¨ç¬¬ $t$ æ—¥çš„è‚¡å¸‚ä¸­è¡¨ç°è‰¯å¥½ï¼Œäºæ˜¯é€šè¿‡ä»¥ä¸‹é€”å¾„é¢„æµ‹å½“å¤©çš„ä»·æ ¼ $x_t$</p><script type="math/tex; mode=display">x_{t} \sim P\left(x_{t} \mid x_{t-1}, \ldots, x_{1}\right)</script><h4 id="è‡ªå›å½’æ¨¡å‹"><a href="#è‡ªå›å½’æ¨¡å‹" class="headerlink" title="è‡ªå›å½’æ¨¡å‹"></a>è‡ªå›å½’æ¨¡å‹</h4><p>æœ¬ç« åé¢çš„å¤§éƒ¨åˆ†å†…å®¹å°†å›´ç»•ç€å¦‚ä½•æœ‰æ•ˆä¼°è®¡ $P(x_tâˆ£x_{tâˆ’1},â€¦,x_1)$ å±•å¼€ï¼Œç®€å•åœ°è¯´ï¼Œå®ƒå½’ç»“ä¸ºä»¥ä¸‹ä¸¤ç§ç­–ç•¥ï¼š</p><ol><li><p>å‡è®¾åœ¨ç°å®æƒ…å†µä¸‹ç›¸å½“é•¿çš„åºåˆ— $x_{tâˆ’1},â€¦,x_1$ å¯èƒ½æ˜¯ä¸å¿…è¦çš„ï¼Œ å› æ­¤æˆ‘ä»¬åªéœ€è¦æ»¡è¶³æŸä¸ªé•¿åº¦ä¸º $\tau$ çš„æ—¶é—´è·¨åº¦ï¼Œ å³ä½¿ç”¨è§‚æµ‹åºåˆ— $x_{tâˆ’1},â€¦,x_{tâˆ’Ï„}$ è¿™ç§ï¼Œæ¨¡å‹è¢«ç§°ä¸ºè‡ªå›å½’æ¨¡å‹ï¼ˆautoregressive modelsï¼‰ï¼Œ å› ä¸ºå®ƒä»¬æ˜¯å¯¹è‡ªå·±æ‰§è¡Œå›å½’</p></li><li><p>ä¿ç•™ä¸€äº›å¯¹è¿‡å»è§‚æµ‹çš„æ€»ç»“ $h_t$ï¼Œå¹¶ä¸”åŒæ—¶æ›´æ–°é¢„æµ‹ $\hat {x}_t$ å’Œæ€»ç»“ $h_t$ ï¼Œç”±äº $ht$ ä»æœªè¢«è§‚æµ‹åˆ°ï¼Œè¿™ç±»æ¨¡å‹ä¹Ÿè¢«ç§°ä¸ºéšå˜é‡è‡ªå›å½’æ¨¡å‹ï¼ˆlatent autoregressive modelsï¼‰</p></li></ol><h4 id="é©¬å°”å¯å¤«æ¨¡å‹"><a href="#é©¬å°”å¯å¤«æ¨¡å‹" class="headerlink" title="é©¬å°”å¯å¤«æ¨¡å‹"></a>é©¬å°”å¯å¤«æ¨¡å‹</h4><p>åœ¨è‡ªå›å½’æ¨¡å‹çš„è¿‘ä¼¼æ³•ä¸­ï¼Œ æˆ‘ä»¬ä½¿ç”¨ $x_{tâˆ’1},â€¦,x_{tâˆ’Ï„}$ è€Œä¸æ˜¯ $x_{tâˆ’1},â€¦,x_1$ æ¥ä¼°è®¡ $x_t$ã€‚ åªè¦è¿™ç§æ˜¯è¿‘ä¼¼ç²¾ç¡®çš„ï¼Œæˆ‘ä»¬å°±è¯´åºåˆ—æ»¡è¶³é©¬å°”å¯å¤«æ¡ä»¶ï¼ˆMarkov conditionï¼‰ï¼Œç‰¹åˆ«æ˜¯ï¼Œå¦‚æœ $\tau =1$ï¼Œå¾—åˆ°ä¸€ä¸ªä¸€é˜¶é©¬å°”å¯å¤«æ¨¡å‹ï¼ˆfirst-order Markov modelï¼‰ï¼Œ $P(x)$ ç”±ä¸‹å¼ç»™å‡º</p><script type="math/tex; mode=display">P\left(x_{1}, \ldots, x_{T}\right)=\prod_{t=1}^{T} P\left(x_{t} \mid x_{t-1}\right) ,\ where\ P\left(x_{1} \mid x_{0}\right)=P\left(x_{1}\right) \text {. }</script><p>åŠ¨æ€è§„åˆ’è¿™äº›è®¡ç®—å·¥å…·å·²ç»åœ¨æ§åˆ¶ç®—æ³•å’Œå¼ºåŒ–å­¦ä¹ ç®—æ³•å¹¿æ³›ä½¿ç”¨</p><h3 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><p>æ¥ä¸‹æ¥æ•™æå¼€å§‹äº†ä¸€ä¸ªå°å®è·µï¼é¦–å…ˆï¼Œç”Ÿæˆä¸€äº›æ•°æ®ï¼šä½¿ç”¨æ­£å¼¦å‡½æ•°å’Œä¸€äº›å¯åŠ æ€§å™ªå£°æ¥ç”Ÿæˆåºåˆ—æ•°æ®ï¼Œ æ—¶é—´æ­¥ä¸º1,2,â€¦,1000ï¼Œå¹¶ä¸”å°†è¿™ä¸ªåºåˆ—è½¬æ¢ä¸ºæ¨¡å‹çš„â€œç‰¹å¾ï¼æ ‡ç­¾â€ï¼ˆfeature-labelï¼‰å¯¹ã€‚ åŸºäºåµŒå…¥ç»´åº¦ $\tau$ï¼Œæˆ‘ä»¬å°†æ•°æ®æ˜ å°„ä¸ºæ•°æ®å¯¹ $y_t=x_t$ å’Œ $x_t=[x_{tâˆ’Ï„},â€¦,x_{tâˆ’1}]$</p><p><img src="/archives/a67a203a/image-20211206231256583.png" style="zoom:80%;"></p><p>æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æƒ³è¦å¹²è¿™ä¹ˆä¸€ä¸ªäº‹æƒ…ï¼šåœ¨æ—¶åˆ» $t$ï¼Œæ ¹æ®ä¹‹å‰çš„ $\tau$ ä¸ªæ•°æ® $[x_{tâˆ’Ï„},â€¦,x_{tâˆ’1}]$ï¼Œå»é¢„æµ‹ $x_t$ çš„æ•°æ®æ˜¯ä»€ä¹ˆã€‚æ•™æä½¿ç”¨äº†ä¸€ä¸ª MLP å»åšè¿™ä¸ªé¢„æµ‹ï¼Œæ•ˆæœè¿˜ä¸é”™</p><p><img src="/archives/a67a203a/image-20211206231852458.png" style="zoom:80%;"></p><h3 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h3><p>é€šå¸¸ï¼Œå¯¹äºç›´åˆ° $x_t$ çš„è§‚æµ‹åºåˆ—ï¼Œå…¶åœ¨æ—¶é—´æ­¥ $t+k$ å¤„çš„é¢„æµ‹è¾“å‡º $x_{t+k}$ ç§°ä¸º $k$ æ­¥é¢„æµ‹ï¼ˆk-step-ahead-predictionï¼‰ï¼Œä¸Šé¢å±•ç¤ºçš„å°±æ˜¯å•æ­¥é¢„æµ‹ç»“æœï¼Œå½“ä½¿è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œå¤šæ­¥é¢„æµ‹æ—¶ï¼Œä¼šå‘ç°é¢„æµ‹ç»“æœå¾ˆå¿«å°±å˜å¾—ç¦»è°±èµ·æ¥ï¼Œä¸€ä¸ªåŸå› æ˜¯è¯¯å·®çš„ç´¯è®¡å¯¼è‡´é¢„æµ‹ç»“æœä¸çœŸå®æ ‡ç­¾ç›¸å·®ç”šè¿œ</p><h2 id="æ–‡æœ¬é¢„å¤„ç†"><a href="#æ–‡æœ¬é¢„å¤„ç†" class="headerlink" title="æ–‡æœ¬é¢„å¤„ç†"></a>æ–‡æœ¬é¢„å¤„ç†</h2><p>åºåˆ—æ•°æ®å­˜åœ¨è®¸å¤šç§å½¢å¼ï¼Œæ–‡æœ¬æ˜¯æœ€å¸¸è§ä¾‹å­ä¹‹ä¸€ï¼Œæœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£ææ–‡æœ¬çš„å¸¸è§é¢„å¤„ç†æ­¥éª¤ã€‚ è¿™äº›æ­¥éª¤é€šå¸¸åŒ…æ‹¬ï¼š</p><ol><li>å°†æ–‡æœ¬ä½œä¸ºå­—ç¬¦ä¸²åŠ è½½åˆ°å†…å­˜ä¸­</li><li>å°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºè¯å…ƒï¼ˆå¦‚å•è¯å’Œå­—ç¬¦ï¼‰</li><li>å»ºç«‹ä¸€ä¸ªè¯è¡¨ï¼Œå°†æ‹†åˆ†çš„è¯å…ƒæ˜ å°„åˆ°æ•°å­—ç´¢å¼•</li><li>å°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—ç´¢å¼•åºåˆ—ï¼Œæ–¹ä¾¿æ¨¡å‹æ“ä½œ</li></ol><h3 id="è¯»å–æ•°æ®é›†"><a href="#è¯»å–æ•°æ®é›†" class="headerlink" title="è¯»å–æ•°æ®é›†"></a>è¯»å–æ•°æ®é›†</h3><p>æ•™æä½¿ç”¨äº†ä¸€ä¸ª time machine æ–‡æœ¬ä½œä¸ºæ•°æ®é›†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data_path <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'./d2l_data/timemachine.txt'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read_time_machine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""å°†æ—¶é—´æœºå™¨æ•°æ®é›†åŠ è½½åˆ°æ–‡æœ¬è¡Œçš„åˆ—è¡¨ä¸­"""</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>data_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'[^A-Za-z]+'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">]</span>lines <span class="token operator">=</span> read_time_machine<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'# æ–‡æœ¬æ€»è¡Œæ•°: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>lines<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¯å…ƒåŒ–"><a href="#è¯å…ƒåŒ–" class="headerlink" title="è¯å…ƒåŒ–"></a>è¯å…ƒåŒ–</h3><p>ä¸‹é¢çš„ <code>tokenize</code> å‡½æ•°å°†æ–‡æœ¬è¡Œåˆ—è¡¨ï¼ˆ<code>lines</code>ï¼‰ä½œä¸ºè¾“å…¥ï¼Œæ¯ä¸ªæ–‡æœ¬åºåˆ—åˆè¢«æ‹†åˆ†æˆä¸€ä¸ªè¯å…ƒåˆ—è¡¨ï¼Œè¯å…ƒï¼ˆtokenï¼‰æ˜¯æ–‡æœ¬çš„åŸºæœ¬å•ä½ï¼ˆä¾‹å¦‚ï¼Œå¯ä»¥é€‰æ‹©å•è¯æˆ–å­—æ¯ä½œä¸ºåŸºæœ¬å•ä½ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">tokenize</span><span class="token punctuation">(</span>lines<span class="token punctuation">,</span> token<span class="token operator">=</span><span class="token string">'word'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""å°†æ–‡æœ¬è¡Œæ‹†åˆ†ä¸ºå•è¯æˆ–å­—ç¬¦è¯å…ƒ"""</span>    <span class="token keyword">if</span> token <span class="token operator">==</span> <span class="token string">'word'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">]</span>    <span class="token keyword">elif</span> token <span class="token operator">==</span> <span class="token string">'char'</span><span class="token punctuation">:</span>        <span class="token comment"># æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå•ä¸ªå­—æ¯å¯ä»¥ç”¨ list æ–¹æ³•</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">]</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'é”™è¯¯ï¼šæœªçŸ¥è¯å…ƒç±»å‹ï¼š'</span> <span class="token operator">+</span> token<span class="token punctuation">)</span>tokens <span class="token operator">=</span> tokenize<span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¯è¡¨"><a href="#è¯è¡¨" class="headerlink" title="è¯è¡¨"></a>è¯è¡¨</h3><p>è¯å…ƒçš„ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ¨¡å‹éœ€è¦çš„è¾“å…¥æ˜¯æ•°å­—ï¼Œå› æ­¤è¿™ç§ç±»å‹ä¸æ–¹ä¾¿æ¨¡å‹ä½¿ç”¨ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªå­—å…¸ï¼Œé€šå¸¸ä¹Ÿå«åšè¯è¡¨ï¼ˆvocabularyï¼‰ï¼Œ ç”¨æ¥å°†å­—ç¬¦ä¸²ç±»å‹çš„è¯å…ƒæ˜ å°„åˆ°ä»0å¼€å§‹çš„æ•°å­—ç´¢å¼•ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Vocab</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""æ–‡æœ¬è¯è¡¨"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tokens<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> min_freq<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> reserved_tokens<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> tokens <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> reserved_tokens <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            reserved_tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment"># æŒ‰å‡ºç°é¢‘ç‡æ’åº</span>        counter <span class="token operator">=</span> count_corpus<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_token_freqs <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                                   reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token comment"># åˆå§‹åŒ–æœªçŸ¥è¯å…ƒ &amp; reserved_tokens</span>        self<span class="token punctuation">.</span>idx_to_token <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&lt;unk&gt;'</span><span class="token punctuation">]</span> <span class="token operator">+</span> reserved_tokens        self<span class="token punctuation">.</span>token_to_idx <span class="token operator">=</span> <span class="token punctuation">{</span>token<span class="token punctuation">:</span> idx                             <span class="token keyword">for</span> idx<span class="token punctuation">,</span> token <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">)</span><span class="token punctuation">}</span>        <span class="token comment"># ä¸‹é¢è¿™å¥è¯æ˜¯å¤šä½™çš„ï¼Œæ˜¯æ•™æä¸­çš„ä¸€ä¸ªå°å¤±è¯¯</span>        <span class="token comment"># self.idx_to_token, self.token_to_idx = [], dict()</span>        <span class="token keyword">for</span> token<span class="token punctuation">,</span> freq <span class="token keyword">in</span> self<span class="token punctuation">.</span>_token_freqs<span class="token punctuation">:</span>            <span class="token comment"># å»é™¤å‡ºç°é¢‘ç‡ä½çš„è¯å…ƒ</span>            <span class="token keyword">if</span> freq <span class="token operator">&lt;</span> min_freq<span class="token punctuation">:</span>                <span class="token keyword">break</span>            <span class="token keyword">if</span> token <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>token_to_idx<span class="token punctuation">:</span>                self<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">.</span>append<span class="token punctuation">(</span>token<span class="token punctuation">)</span>                <span class="token comment"># æ ¸å¿ƒæ˜¯ç”Ÿæˆäº† {token: idx} å­—å…¸</span>                self<span class="token punctuation">.</span>token_to_idx<span class="token punctuation">[</span>token<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tokens<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>token_to_idx<span class="token punctuation">.</span>get<span class="token punctuation">(</span>tokens<span class="token punctuation">,</span> self<span class="token punctuation">.</span>unk<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token keyword">for</span> token <span class="token keyword">in</span> tokens<span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">to_tokens</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> indices<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>indices<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">[</span>indices<span class="token punctuation">]</span>        <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token keyword">for</span> index <span class="token keyword">in</span> indices<span class="token punctuation">]</span>    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">unk</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># æœªçŸ¥è¯å…ƒçš„ç´¢å¼•ä¸º0</span>        <span class="token keyword">return</span> <span class="token number">0</span>    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">token_freqs</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_token_freqs<span class="token keyword">def</span> <span class="token function">count_corpus</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""ç»Ÿè®¡è¯å…ƒçš„é¢‘ç‡"""</span>    <span class="token comment"># è¿™é‡Œçš„ `tokens` æ˜¯ 1D åˆ—è¡¨æˆ– 2D åˆ—è¡¨</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å°†è¯å…ƒåˆ—è¡¨å±•å¹³æˆä¸€ä¸ªåˆ—è¡¨</span>        tokens <span class="token operator">=</span> <span class="token punctuation">[</span>token <span class="token keyword">for</span> line <span class="token keyword">in</span> tokens <span class="token keyword">for</span> token <span class="token keyword">in</span> line<span class="token punctuation">]</span>    <span class="token keyword">return</span> collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œçš„ä»£ç æ¯”è¾ƒå¤æ‚ï¼Œä¸ºäº†è®© vocab çš„æ¦‚å¿µæ›´æ¸…æ™°ï¼Œå†æ€»ç»“ä¸€ä¸‹å®ƒçš„åŠŸèƒ½ï¼š</p><ol><li><p>index to tokenï¼Œç»™å®šä¸€ä¸ª index è¿”å›å…¶ token</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">vocab<span class="token punctuation">.</span>to_tokens<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>token to indexï¼Œç»™å®šä¸€ä¸ª token è¿”å›å…¶ index</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ç”± __getitem__ å®ç°</span>vocab<span class="token punctuation">[</span>token<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>token_freqs</code> è¿”å›ä¸€ä¸ª list of tupleï¼Œç”¨äºå­˜å‚¨ token å‡ºç°çš„æ¬¡æ•° (token, freqs)ï¼Œè¯¥åŠŸèƒ½æ˜¯ç”± <code>collections.Counter + sorted</code> å®ç°</p></li></ol><h3 id="è¯­æ–™åº“"><a href="#è¯­æ–™åº“" class="headerlink" title="è¯­æ–™åº“"></a>è¯­æ–™åº“</h3><p>å°†å¦‚ä¸‹å‡ ä¸ªåŠŸèƒ½æ•´åˆèµ·æ¥ï¼šå°†æ•°æ®å¯¼å…¥ï¼Œç”Ÿæˆè¯è¡¨ï¼Œç”Ÿæˆè¯­æ–™åº“ï¼ˆæ‰€è°“è¯­æ–™åº“ï¼Œå°±æ˜¯ä¸€ä¸ª list of indexï¼Œå­˜å‚¨äº†æ–‡æœ¬ä¸­æ¯ä¸€ä¸ª token å¯¹åº”çš„ indexï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">load_corpus_time_machine</span><span class="token punctuation">(</span>max_tokens<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""è¿”å›æ—¶å…‰æœºå™¨æ•°æ®é›†çš„è¯å…ƒç´¢å¼•åˆ—è¡¨å’Œè¯è¡¨"""</span>    lines <span class="token operator">=</span> read_time_machine<span class="token punctuation">(</span><span class="token punctuation">)</span>    tokens <span class="token operator">=</span> tokenize<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> <span class="token string">'char'</span><span class="token punctuation">)</span>    vocab <span class="token operator">=</span> Vocab<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span>    <span class="token comment"># å› ä¸ºæ—¶å…‰æœºå™¨æ•°æ®é›†ä¸­çš„æ¯ä¸ªæ–‡æœ¬è¡Œä¸ä¸€å®šæ˜¯ä¸€ä¸ªå¥å­æˆ–ä¸€ä¸ªæ®µè½ï¼Œ</span>    <span class="token comment"># æ‰€ä»¥å°†æ‰€æœ‰æ–‡æœ¬è¡Œå±•å¹³åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œå¹¶åˆ©ç”¨ vocab æŸ¥è¯¢å…¶ index</span>    <span class="token comment"># è¿™é‡Œçš„è¯­æ³•éå¸¸çš„ç®€æ´ï¼Œæ¬£èµä¸€ä¸‹</span>    corpus <span class="token operator">=</span> <span class="token punctuation">[</span>vocab<span class="token punctuation">[</span>token<span class="token punctuation">]</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> tokens <span class="token keyword">for</span> token <span class="token keyword">in</span> line<span class="token punctuation">]</span>    <span class="token keyword">if</span> max_tokens <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>        corpus <span class="token operator">=</span> corpus<span class="token punctuation">[</span><span class="token punctuation">:</span>max_tokens<span class="token punctuation">]</span>    <span class="token keyword">return</span> corpus<span class="token punctuation">,</span> vocab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¯­è¨€æ¨¡å‹å’Œæ•°æ®é›†"><a href="#è¯­è¨€æ¨¡å‹å’Œæ•°æ®é›†" class="headerlink" title="è¯­è¨€æ¨¡å‹å’Œæ•°æ®é›†"></a>è¯­è¨€æ¨¡å‹å’Œæ•°æ®é›†</h2><p> ä¸€ä¸ªç†æƒ³çš„è¯­è¨€æ¨¡å‹å°±èƒ½å¤ŸåŸºäºæ¨¡å‹æœ¬èº«ç”Ÿæˆè‡ªç„¶æ–‡æœ¬</p><h3 id="é©¬å°”å¯å¤«æ¨¡å‹ä¸-n-å…ƒè¯­æ³•"><a href="#é©¬å°”å¯å¤«æ¨¡å‹ä¸-n-å…ƒè¯­æ³•" class="headerlink" title="é©¬å°”å¯å¤«æ¨¡å‹ä¸ n å…ƒè¯­æ³•"></a>é©¬å°”å¯å¤«æ¨¡å‹ä¸ n å…ƒè¯­æ³•</h3><p>é©¬å°”å¯å¤«æ€§è´¨æ¨å¯¼å‡ºäº†è®¸å¤šå¯ä»¥åº”ç”¨äºåºåˆ—å»ºæ¨¡çš„è¿‘ä¼¼å…¬å¼ï¼š</p><p><img src="/archives/a67a203a/image-20211207164553989.png" style="zoom:80%;"></p><p>é€šå¸¸ï¼Œæ¶‰åŠä¸€ä¸ªã€ä¸¤ä¸ªå’Œä¸‰ä¸ªå˜é‡çš„æ¦‚ç‡å…¬å¼åˆ†åˆ«è¢«ç§°ä¸º â€œä¸€å…ƒè¯­æ³•â€ï¼ˆunigramï¼‰ã€â€œäºŒå…ƒè¯­æ³•â€ï¼ˆbigramï¼‰å’Œâ€œä¸‰å…ƒè¯­æ³•â€ï¼ˆtrigramï¼‰æ¨¡å‹ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å»è®¾è®¡æ›´å¥½çš„æ¨¡å‹</p><h3 id="è‡ªç„¶è¯­è¨€ç»Ÿè®¡"><a href="#è‡ªç„¶è¯­è¨€ç»Ÿè®¡" class="headerlink" title="è‡ªç„¶è¯­è¨€ç»Ÿè®¡"></a>è‡ªç„¶è¯­è¨€ç»Ÿè®¡</h3><p>è‡ªç„¶è¯­è¨€ä¸­è¯é¢‘çš„åˆ†å¸ƒæ˜¯ä¸å‡åŒ€çš„ï¼Œå°‘éƒ¨åˆ†çš„è¯ä¼šå¤§é‡å‡ºç°ï¼Œè€Œå¤§éƒ¨åˆ†çš„è¯å‡ºç°çš„é¢‘ç‡ä¼šæ¯”è¾ƒå°‘</p><p><img src="/archives/a67a203a/image-20211207164901392.png" style="zoom:80%;"></p><p> è¿™å‘Šè¯‰æˆ‘ä»¬æƒ³è¦é€šè¿‡è®¡æ•°ç»Ÿè®¡å’Œå¹³æ»‘æ¥å»ºæ¨¡å•è¯æ˜¯ä¸å¯è¡Œçš„ï¼Œ å› ä¸ºè¿™æ ·å»ºæ¨¡çš„ç»“æœä¼šå¤§å¤§é«˜ä¼°å°¾éƒ¨å•è¯çš„é¢‘ç‡ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ä¸å¸¸ç”¨å•è¯ã€‚é‚£ä¹ˆå…¶ä»–çš„è¯å…ƒç»„åˆï¼Œæ¯”å¦‚äºŒå…ƒè¯­æ³•ã€ä¸‰å…ƒè¯­æ³•ç­‰ç­‰ï¼Œåˆä¼šå¦‚ä½•å‘¢ï¼Ÿ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># äºŒå…ƒè¯­æ³•ç¤ºä¾‹</span>bigram_tokens <span class="token operator">=</span> <span class="token punctuation">[</span>pair <span class="token keyword">for</span> pair <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>corpus<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corpus<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>bigram_vocab <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Vocab<span class="token punctuation">(</span>bigram_tokens<span class="token punctuation">)</span>bigram_vocab<span class="token punctuation">.</span>token_freqs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/a67a203a/image-20211207165753406.png" style="zoom:80%;"></p><p>è¿™å¼ å›¾éå¸¸ä»¤äººæŒ¯å¥‹ï¼åŸå› æœ‰å¾ˆå¤šï¼š é¦–å…ˆï¼Œé™¤äº†ä¸€å…ƒè¯­æ³•è¯ï¼Œå•è¯åºåˆ—ä¼¼ä¹ä¹Ÿéµå¾ªé½æ™®å¤«å®šå¾‹</p><script type="math/tex; mode=display">\begin{array}{c}n_{i} \propto \frac{1}{i^{\alpha}}, \\\log n_{i}=-\alpha \log i+c,\end{array}</script><p>å…¶æ¬¡ï¼Œè¯è¡¨ä¸­ n å…ƒç»„çš„æ•°é‡å¹¶æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œè¿™è¯´æ˜è¯­è¨€ä¸­å­˜åœ¨ç›¸å½“å¤šçš„ç»“æ„ï¼Œ è¿™äº›ç»“æ„ç»™äº†æˆ‘ä»¬åº”ç”¨æ¨¡å‹çš„å¸Œæœ›</p><h3 id="è¯»å–é•¿åºåˆ—æ•°æ®"><a href="#è¯»å–é•¿åºåˆ—æ•°æ®" class="headerlink" title="è¯»å–é•¿åºåˆ—æ•°æ®"></a>è¯»å–é•¿åºåˆ—æ•°æ®</h3><p>å‡è®¾æˆ‘ä»¬å°†ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼Œ æ¨¡å‹ä¸­çš„ç½‘ç»œä¸€æ¬¡å¤„ç†å…·æœ‰é¢„å®šä¹‰é•¿åº¦ ï¼ˆä¾‹å¦‚ n ä¸ªæ—¶é—´æ­¥ï¼‰çš„ä¸€ä¸ªå°æ‰¹é‡åºåˆ—ã€‚ ç°åœ¨çš„é—®é¢˜æ˜¯å¦‚ä½•éšæœºç”Ÿæˆä¸€ä¸ªå°æ‰¹é‡æ•°æ®çš„ç‰¹å¾å’Œæ ‡ç­¾ä»¥ä¾›è¯»å–</p><h4 id="éšæœºé‡‡æ ·"><a href="#éšæœºé‡‡æ ·" class="headerlink" title="éšæœºé‡‡æ ·"></a>éšæœºé‡‡æ ·</h4><p>åœ¨éšæœºé‡‡æ ·ä¸­ï¼Œæ¯ä¸ªæ ·æœ¬éƒ½æ˜¯åœ¨åŸå§‹çš„é•¿åºåˆ—ä¸Šä»»æ„æ•è·çš„å­åºåˆ—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">seq_data_iter_random</span><span class="token punctuation">(</span>corpus<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""ä½¿ç”¨éšæœºæŠ½æ ·ç”Ÿæˆä¸€ä¸ªå°æ‰¹é‡å­åºåˆ—"""</span>    <span class="token comment"># ä»éšæœºåç§»é‡å¼€å§‹å¯¹åºåˆ—è¿›è¡Œåˆ†åŒºï¼ŒéšæœºèŒƒå›´åŒ…æ‹¬`num_steps - 1`</span>    corpus <span class="token operator">=</span> corpus<span class="token punctuation">[</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num_steps <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token comment"># å‡å»1ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦è€ƒè™‘æ ‡ç­¾</span>    num_subseqs <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>corpus<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> num_steps    <span class="token comment"># é•¿åº¦ä¸º`num_steps`çš„å­åºåˆ—çš„èµ·å§‹ç´¢å¼•</span>    initial_indices <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num_subseqs <span class="token operator">*</span> num_steps<span class="token punctuation">,</span> num_steps<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># åœ¨éšæœºæŠ½æ ·çš„è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œ</span>    <span class="token comment"># æ¥è‡ªä¸¤ä¸ªç›¸é‚»çš„ã€éšæœºçš„ã€å°æ‰¹é‡ä¸­çš„å­åºåˆ—ä¸ä¸€å®šåœ¨åŸå§‹åºåˆ—ä¸Šç›¸é‚»</span>    random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>initial_indices<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">data</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># è¿”å›ä»`pos`ä½ç½®å¼€å§‹çš„é•¿åº¦ä¸º`num_steps`çš„åºåˆ—</span>        <span class="token keyword">return</span> corpus<span class="token punctuation">[</span>pos<span class="token punctuation">:</span> pos <span class="token operator">+</span> num_steps<span class="token punctuation">]</span>    num_batches <span class="token operator">=</span> num_subseqs <span class="token operator">//</span> batch_size    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> batch_size <span class="token operator">*</span> num_batches<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># åœ¨è¿™é‡Œï¼Œ`initial_indices`åŒ…å«å­åºåˆ—çš„éšæœºèµ·å§‹ç´¢å¼•</span>        initial_indices_per_batch <span class="token operator">=</span> initial_indices<span class="token punctuation">[</span>i<span class="token punctuation">:</span> i <span class="token operator">+</span> batch_size<span class="token punctuation">]</span>        X <span class="token operator">=</span> <span class="token punctuation">[</span>data<span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> initial_indices_per_batch<span class="token punctuation">]</span>        Y <span class="token operator">=</span> <span class="token punctuation">[</span>data<span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> initial_indices_per_batch<span class="token punctuation">]</span>        <span class="token keyword">yield</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é¡ºåºåˆ†åŒº"><a href="#é¡ºåºåˆ†åŒº" class="headerlink" title="é¡ºåºåˆ†åŒº"></a>é¡ºåºåˆ†åŒº</h4><p>åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œé™¤äº†å¯¹åŸå§‹åºåˆ—å¯ä»¥éšæœºæŠ½æ ·å¤–ï¼Œ æˆ‘ä»¬è¿˜å¯ä»¥ä¿è¯ä¸¤ä¸ªç›¸é‚»çš„å°æ‰¹é‡ä¸­çš„å­åºåˆ—åœ¨åŸå§‹åºåˆ—ä¸Šä¹Ÿæ˜¯ç›¸é‚»çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">seq_data_iter_sequential</span><span class="token punctuation">(</span>corpus<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""ä½¿ç”¨é¡ºåºåˆ†åŒºç”Ÿæˆä¸€ä¸ªå°æ‰¹é‡å­åºåˆ—"""</span>    <span class="token comment"># ä»éšæœºåç§»é‡å¼€å§‹åˆ’åˆ†åºåˆ—</span>    offset <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num_steps<span class="token punctuation">)</span>    num_tokens <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>corpus<span class="token punctuation">)</span> <span class="token operator">-</span> offset <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> batch_size<span class="token punctuation">)</span> <span class="token operator">*</span> batch_size    Xs <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>corpus<span class="token punctuation">[</span>offset<span class="token punctuation">:</span> offset <span class="token operator">+</span> num_tokens<span class="token punctuation">]</span><span class="token punctuation">)</span>    Ys <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>corpus<span class="token punctuation">[</span>offset <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> offset <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> num_tokens<span class="token punctuation">]</span><span class="token punctuation">)</span>    Xs<span class="token punctuation">,</span> Ys <span class="token operator">=</span> Xs<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Ys<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    num_batches <span class="token operator">=</span> Xs<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">//</span> num_steps    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num_steps <span class="token operator">*</span> num_batches<span class="token punctuation">,</span> num_steps<span class="token punctuation">)</span><span class="token punctuation">:</span>        X <span class="token operator">=</span> Xs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> i <span class="token operator">+</span> num_steps<span class="token punctuation">]</span>        Y <span class="token operator">=</span> Ys<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> i <span class="token operator">+</span> num_steps<span class="token punctuation">]</span>        <span class="token keyword">yield</span> X<span class="token punctuation">,</span> Y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ç»“æœä¸Šç›´è§‚æ„Ÿå—ä¸€ä¸‹é¡ºåºåˆ†åŒºå’Œéšæœºé‡‡æ ·çš„åŒºåˆ«</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># my_seq = list(range(35))</span><span class="token comment"># éšæœºé‡‡æ · batch_size=2, num_steps=5</span>X<span class="token punctuation">:</span>  tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Y<span class="token punctuation">:</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>X<span class="token punctuation">:</span>  tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Y<span class="token punctuation">:</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># é¡ºåºåˆ†åŒº</span>X<span class="token punctuation">:</span>  tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Y<span class="token punctuation">:</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>X<span class="token punctuation">:</span>  tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">,</span>  <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Y<span class="token punctuation">:</span> tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œ"></a>å¾ªç¯ç¥ç»ç½‘ç»œ</h2><p>æˆ‘ä»¬ä»‹ç»äº† n å…ƒè¯­æ³•æ¨¡å‹ï¼Œ å…¶ä¸­å•è¯ $x_t$ åœ¨æ—¶é—´æ­¥ t çš„æ¡ä»¶æ¦‚ç‡ä»…å–å†³äºå‰é¢ nâˆ’1 ä¸ªå•è¯ã€‚å¦‚æœè¦å¢åŠ  nï¼Œæ¨¡å‹å‚æ•°çš„æ•°é‡ä¹Ÿä¼šéšä¹‹å‘ˆæŒ‡æ•°å¢é•¿ï¼Œé¢ä¸´çš„æ¬¡å…ƒç»„åˆæ•°ä¸º $|V|^n$</p><p>å› æ­¤ä¸å…¶å°† $P(x_tâˆ£x_{tâˆ’1},â€¦,x_{tâˆ’n+1})$ æ¨¡å‹åŒ–ï¼Œ ä¸å¦‚ä½¿ç”¨éšå˜é‡æ¨¡å‹</p><script type="math/tex; mode=display">P\left(x_{t} \mid x_{t-1}, \ldots, x_{1}\right) \approx P\left(x_{t} \mid h_{t-1}\right)</script><p>å…¶ä¸­ $h_{tâˆ’1}$ æ˜¯éšçŠ¶æ€ï¼ˆhidden stateï¼‰ï¼Œ ä¹Ÿç§°ä¸ºéšè—å˜é‡ï¼ˆhidden variableï¼‰ï¼Œ å®ƒå­˜å‚¨äº†åˆ°æ—¶é—´æ­¥ tâˆ’1 çš„åºåˆ—ä¿¡æ¯ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºå½“å‰è¾“å…¥å’Œå…ˆå‰éšçŠ¶æ€æ¥è®¡ç®—æ—¶é—´æ­¥ t å¤„çš„ä»»ä½•æ—¶é—´çš„éšçŠ¶æ€</p><script type="math/tex; mode=display">h_{t}=f\left(x_{t}, h_{t-1}\right)</script><h3 id="æœ‰éšçŠ¶æ€çš„å¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#æœ‰éšçŠ¶æ€çš„å¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="æœ‰éšçŠ¶æ€çš„å¾ªç¯ç¥ç»ç½‘ç»œ"></a>æœ‰éšçŠ¶æ€çš„å¾ªç¯ç¥ç»ç½‘ç»œ</h3><p>å‡è®¾æˆ‘ä»¬åœ¨æ—¶é—´æ­¥ t æœ‰å°æ‰¹é‡è¾“å…¥ $X_tâˆˆR^{nÃ—d}$ï¼Œä¸å¤šå±‚æ„ŸçŸ¥æœºä¸åŒçš„æ˜¯ï¼Œ æˆ‘ä»¬åœ¨è¿™é‡Œä¿å­˜äº†å‰ä¸€ä¸ªæ—¶é—´æ­¥çš„éšè—å˜é‡ $H_{tâˆ’1}$ï¼Œ å¹¶å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æƒé‡å‚æ•° $W_{hh}âˆˆR^{hÃ—h}$ï¼Œ æ¥æè¿°å¦‚ä½•åœ¨å½“å‰æ—¶é—´æ­¥ä¸­ä½¿ç”¨å‰ä¸€ä¸ªæ—¶é—´æ­¥çš„éšè—å˜é‡ã€‚ å…·ä½“åœ°è¯´ï¼Œå½“å‰æ—¶é—´æ­¥éšè—å˜é‡ç”±å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ä¸å‰ä¸€ä¸ªæ—¶é—´æ­¥çš„éšè—å˜é‡ä¸€èµ·è®¡ç®—å¾—å‡ºï¼š</p><script type="math/tex; mode=display">\mathbf{H}_{t}=\phi\left(\mathbf{X}_{t} \mathbf{W}_{x h}+\mathbf{H}_{t-1} \mathbf{W}_{h h}+\mathbf{b}_{h}\right)</script><p>å…¶ä¸­ $\phi$ ä¸ºæ¿€æ´»å‡½æ•°ã€‚è¾“å‡ºå±‚çš„è¾“å‡ºç±»ä¼¼äºå¤šå±‚æ„ŸçŸ¥æœºä¸­çš„è®¡ç®—</p><script type="math/tex; mode=display">\mathbf{O}_{t}=\mathbf{H}_{t} \mathbf{W}_{h q}+\mathbf{b}_{q}</script><p><strong>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå³ä½¿åœ¨ä¸åŒçš„æ—¶é—´æ­¥ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œä¹Ÿæ€»æ˜¯ä½¿ç”¨è¿™äº›æ¨¡å‹å‚æ•°</strong>ã€‚ å› æ­¤ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œçš„å‚æ•°å¼€é”€ä¸ä¼šéšç€æ—¶é—´æ­¥çš„å¢åŠ è€Œå¢åŠ ï¼Œä¸‹é¢æ¥çœ‹ä¸€ä¸‹å›¾ç¤ºå¯¹æ•´ä¸ªè®¡ç®—è¿‡ç¨‹æœ‰æ›´æ¸…æ™°çš„è®¤è¯†</p><p><img src="/archives/a67a203a/image-20211208212259258.png" style="zoom:80%;"></p><h3 id="å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰"><a href="#å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰" class="headerlink" title="å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰"></a>å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰</h3><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºå±‚çš„è¾“å‡ºè¿›è¡Œsoftmaxæ“ä½œï¼Œ ç„¶ååˆ©ç”¨äº¤å‰ç†µæŸå¤±è®¡ç®—æ¨¡å‹è¾“å‡ºå’Œæ ‡ç­¾ä¹‹é—´çš„è¯¯å·®</p><script type="math/tex; mode=display">\frac{1}{n} \sum_{t=1}^{n}-\log P\left(x_{t} \mid x_{t-1}, \ldots, x_{1}\right)</script><p>ç”±äºå†å²åŸå› ï¼Œè‡ªç„¶è¯­è¨€å¤„ç†çš„ç§‘å­¦å®¶æ›´å–œæ¬¢ä½¿ç”¨ä¸€ä¸ªå«åšå›°æƒ‘åº¦ï¼ˆperplexityï¼‰çš„é‡ï¼Œå®ƒæ˜¯ä¸Šå¼çš„æŒ‡æ•°</p><script type="math/tex; mode=display">exp(\frac{1}{n} \sum_{t=1}^{n}-\log P\left(x_{t} \mid x_{t-1}, \ldots, x_{1}\right))</script><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å®ç°"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å®ç°" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å®ç°"></a>å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å®ç°</h2><p>è¿™é‡Œä»…è®°å½•ä¸€äº›å€¼å¾—æ³¨æ„çš„çŸ¥è¯†ç‚¹ï¼Œè¯¦ç»†çš„ä»é›¶å®ç°ä¸åšç¬”è®°</p><h3 id="One-hot-ç¼–ç "><a href="#One-hot-ç¼–ç " class="headerlink" title="One-hot ç¼–ç "></a>One-hot ç¼–ç </h3><p>æ¯ä¸ªè¯å…ƒéƒ½è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°å­—ç´¢å¼•ï¼Œ å°†è¿™äº›ç´¢å¼•ç›´æ¥è¾“å…¥ç¥ç»ç½‘ç»œå¯èƒ½ä¼šä½¿å­¦ä¹ å˜å¾—å›°éš¾ã€‚ æˆ‘ä»¬é€šå¸¸å°†æ¯ä¸ªè¯å…ƒè¡¨ç¤ºä¸ºæ›´å…·è¡¨ç°åŠ›çš„ç‰¹å¾å‘é‡ã€‚ æœ€ç®€å•çš„è¡¨ç¤ºç§°ä¸ºç‹¬çƒ­ç¼–ç ï¼ˆone-hot encodingï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">F<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘ä»¬æ¯æ¬¡é‡‡æ ·çš„å°æ‰¹é‡æ•°æ®å½¢çŠ¶æ˜¯äºŒç»´å¼ é‡ï¼š ï¼ˆæ‰¹é‡å¤§å°ï¼Œæ—¶é—´æ­¥æ•°ï¼‰ã€‚ <code>one_hot</code>å‡½æ•°å°†è¿™æ ·ä¸€ä¸ªå°æ‰¹é‡æ•°æ®è½¬æ¢æˆä¸‰ç»´å¼ é‡ï¼Œ å¼ é‡çš„æœ€åä¸€ä¸ªç»´åº¦ç­‰äºè¯è¡¨å¤§å° <code>len(vocab)</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">X <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>F<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>X<span class="token punctuation">.</span>T<span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token comment"># torch.Size([5, 2, 28])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="é¢„æµ‹-1"><a href="#é¢„æµ‹-1" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h3><p>è®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰é¢„æµ‹å‡½æ•°æ¥ç”Ÿæˆ <code>prefix</code> ä¹‹åçš„æ–°å­—ç¬¦ï¼Œ å…¶ä¸­çš„ <code>prefix</code> æ˜¯ä¸€ä¸ªç”¨æˆ·æä¾›çš„åŒ…å«å¤šä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚ åœ¨å¾ªç¯éå† <code>prefix</code> ä¸­çš„å¼€å§‹å­—ç¬¦æ—¶ï¼Œ æˆ‘ä»¬ä¸æ–­åœ°å°†éšçŠ¶æ€ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ï¼Œä½†æ˜¯ä¸ç”Ÿæˆä»»ä½•è¾“å‡ºã€‚ è¿™è¢«ç§°ä¸ºé¢„çƒ­ï¼ˆwarm-upï¼‰æœŸï¼Œ å› ä¸ºåœ¨æ­¤æœŸé—´æ¨¡å‹ä¼šè‡ªæˆ‘æ›´æ–°ï¼ˆä¾‹å¦‚ï¼Œæ›´æ–°éšçŠ¶æ€ï¼‰ï¼Œ ä½†ä¸ä¼šè¿›è¡Œé¢„æµ‹ã€‚ é¢„çƒ­æœŸç»“æŸåï¼ŒéšçŠ¶æ€çš„å€¼é€šå¸¸æ¯”åˆšå¼€å§‹çš„åˆå§‹å€¼æ›´é€‚åˆé¢„æµ‹ï¼Œ ä»è€Œé¢„æµ‹å­—ç¬¦å¹¶è¾“å‡ºå®ƒä»¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">predict_ch8</span><span class="token punctuation">(</span>prefix<span class="token punctuation">,</span> num_preds<span class="token punctuation">,</span> net<span class="token punctuation">,</span> vocab<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""åœ¨prefixåé¢ç”Ÿæˆæ–°å­—ç¬¦"""</span>    state <span class="token operator">=</span> net<span class="token punctuation">.</span>begin_state<span class="token punctuation">(</span>batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>device<span class="token punctuation">)</span>    outputs <span class="token operator">=</span> <span class="token punctuation">[</span>vocab<span class="token punctuation">[</span>prefix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    get_input <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>outputs<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctx<span class="token operator">=</span>device<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> y <span class="token keyword">in</span> prefix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># é¢„çƒ­æœŸ</span>        _<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>get_input<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token comment"># ä¸å…³å¿ƒè¾“å‡ºï¼Œåªå…³å¿ƒéšçŠ¶æ€</span>        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>vocab<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_preds<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># é¢„æµ‹num_predsæ­¥</span>        y<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>get_input<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>vocab<span class="token punctuation">.</span>idx_to_token<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> outputs<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¢¯åº¦å‰ªè£"><a href="#æ¢¯åº¦å‰ªè£" class="headerlink" title="æ¢¯åº¦å‰ªè£"></a>æ¢¯åº¦å‰ªè£</h3><p>å¯¹äºé•¿åº¦ä¸º T çš„åºåˆ—ï¼Œæˆ‘ä»¬åœ¨è¿­ä»£ä¸­è®¡ç®—è¿™ T ä¸ªæ—¶é—´æ­¥ä¸Šçš„æ¢¯åº¦ï¼Œ å°†ä¼šåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­äº§ç”Ÿé•¿åº¦ä¸º O(T) çš„çŸ©é˜µä¹˜æ³•é“¾ï¼Œå½“ T è¾ƒå¤§æ—¶ï¼Œå®ƒå¯èƒ½å¯¼è‡´æ•°å€¼ä¸ç¨³å®šï¼Œ ä¾‹å¦‚å¯èƒ½å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸æˆ–æ¢¯åº¦æ¶ˆå¤±ã€‚å¯¹äºæ¢¯åº¦çˆ†ç‚¸ï¼Œ ä¸€ä¸ªæµè¡Œçš„æ›¿ä»£æ–¹æ¡ˆæ˜¯é€šè¿‡å°†æ¢¯åº¦ggæŠ•å½±å›ç»™å®šåŠå¾„ ï¼ˆä¾‹å¦‚ Î¸ï¼‰çš„çƒæ¥è£å‰ªæ¢¯åº¦ gã€‚ å¦‚ä¸‹å¼</p><script type="math/tex; mode=display">\mathbf{g} \leftarrow \min \left(1, \frac{\theta}{\|\mathbf{g}\|}\right) \mathbf{g}</script><h3 id="è®­ç»ƒ-1"><a href="#è®­ç»ƒ-1" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><p>å¾ªç¯ç¥ç»ç½‘ç»œçš„è®­ç»ƒä¸æ™®é€šçš„ç¥ç»ç½‘ç»œè®­ç»ƒæœ‰å‡ ç‚¹ä¸åŒï¼š</p><ol><li>åºåˆ—æ•°æ®çš„ä¸åŒé‡‡æ ·æ–¹æ³•ï¼ˆéšæœºé‡‡æ ·å’Œé¡ºåºåˆ†åŒºï¼‰å°†å¯¼è‡´éšçŠ¶æ€åˆå§‹åŒ–çš„å·®å¼‚</li><li>æˆ‘ä»¬åœ¨æ›´æ–°æ¨¡å‹å‚æ•°ä¹‹å‰è£å‰ªæ¢¯åº¦ã€‚ è¿™æ ·çš„æ“ä½œçš„ç›®çš„æ˜¯ï¼šå³ä½¿è®­ç»ƒè¿‡ç¨‹ä¸­æŸä¸ªç‚¹ä¸Šå‘ç”Ÿäº†æ¢¯åº¦çˆ†ç‚¸ï¼Œä¹Ÿèƒ½ä¿è¯æ¨¡å‹ä¸ä¼šå‘æ•£</li><li>æˆ‘ä»¬ç”¨å›°æƒ‘åº¦æ¥è¯„ä»·æ¨¡å‹</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯éšçŠ¶æ€çš„ä¼ é€’ä¼šå¯¼è‡´æ¢¯åº¦é“¾çš„å¢é•¿ï¼Œè¿™å¸¦æ¥çš„å¥½å¤„æ˜¯å†å²ä¿¡æ¯çš„ä¼ é€’ï¼Œå¸¦æ¥çš„åå¤„æ˜¯è¿‡é•¿çš„è®¡ç®—å›¾ä½¿å¾—æ¢¯åº¦è®¡ç®—å˜å¾—å¤æ‚ï¼Œä¸‹é¢æ˜¯æ•™æä¸­çš„åŸè¯ï¼š</p><blockquote><p>å…·ä½“æ¥è¯´ï¼Œå½“ä½¿ç”¨é¡ºåºåˆ†åŒºæ—¶ï¼Œ æˆ‘ä»¬åªåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸï¼ˆepochï¼‰çš„å¼€å§‹ä½ç½®åˆå§‹åŒ–éšçŠ¶æ€ã€‚ ç”±äºä¸‹ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ä¸­çš„ç¬¬ i ä¸ªå­åºåˆ—æ ·æœ¬ä¸å½“å‰ç¬¬ i ä¸ªå­åºåˆ—æ ·æœ¬ç›¸é‚»ï¼Œ å› æ­¤å½“å‰å°æ‰¹é‡æ•°æ®æœ€åä¸€ä¸ªæ ·æœ¬çš„éšçŠ¶æ€ï¼Œ å°†ç”¨äºåˆå§‹åŒ–ä¸‹ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ç¬¬ä¸€ä¸ªæ ·æœ¬çš„éšçŠ¶æ€ã€‚ è¿™æ ·ï¼Œå­˜å‚¨åœ¨éšçŠ¶æ€ä¸­çš„åºåˆ—çš„å†å²ä¿¡æ¯å¯ä»¥åœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸå†…æµç»ç›¸é‚»çš„å­åºåˆ—ã€‚ ç„¶è€Œï¼Œåœ¨ä»»ä½•ä¸€ç‚¹éšçŠ¶æ€çš„è®¡ç®—ï¼Œ éƒ½ä¾èµ–äºåŒä¸€è¿­ä»£å‘¨æœŸä¸­å‰é¢æ‰€æœ‰çš„å°æ‰¹é‡æ•°æ®ï¼Œ è¿™ä½¿å¾—æ¢¯åº¦è®¡ç®—å˜å¾—å¤æ‚ã€‚ ä¸ºäº†é™ä½è®¡ç®—é‡ï¼Œåœ¨å¤„ç†ä»»ä½•ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ä¹‹å‰ï¼ˆiterationï¼‰ï¼Œ æˆ‘ä»¬å…ˆåˆ†ç¦»æ¢¯åº¦ï¼Œä½¿å¾—éšçŠ¶æ€çš„æ¢¯åº¦è®¡ç®—æ€»æ˜¯é™åˆ¶åœ¨ä¸€ä¸ªå°æ‰¹é‡æ•°æ®çš„æ—¶é—´æ­¥å†…</p></blockquote><p>è§£å†³æ–¹å¼å°±æ˜¯åœ¨æ¯ä¸ª iteration å‰ï¼ŒæŠŠéšçŠ¶æ€ä½œä»è®¡ç®—å›¾ä¸­åˆ†ç¦» detach_ï¼Œä¹Ÿå°±æ˜¯å°†å…¶çœ‹ä½œä¸€ä¸ªå¸¸æ•°è¾“å…¥ï¼Œä¸‹é¢æ˜¯è®­ç»ƒçš„ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">def</span> <span class="token function">train_epoch_ch8</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> loss<span class="token punctuation">,</span> updater<span class="token punctuation">,</span> device<span class="token punctuation">,</span> use_random_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""è®­ç»ƒç½‘ç»œä¸€ä¸ªè¿­ä»£å‘¨æœŸï¼ˆå®šä¹‰è§ç¬¬8ç« ï¼‰"""</span>    state<span class="token punctuation">,</span> timer <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token punctuation">)</span>    metric <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Accumulator<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># è®­ç»ƒæŸå¤±ä¹‹å’Œ,è¯å…ƒæ•°é‡</span>    <span class="token keyword">for</span> X<span class="token punctuation">,</span> Y <span class="token keyword">in</span> train_iter<span class="token punctuation">:</span>        <span class="token keyword">if</span> state <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> use_random_iter<span class="token punctuation">:</span>            <span class="token comment"># åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£æˆ–ä½¿ç”¨éšæœºæŠ½æ ·æ—¶åˆå§‹åŒ–state</span>            state <span class="token operator">=</span> net<span class="token punctuation">.</span>begin_state<span class="token punctuation">(</span>batch_size<span class="token operator">=</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token comment"># stateå¯¹äºnn.GRUæ˜¯ä¸ªå¼ é‡</span>                state<span class="token punctuation">.</span>detach_<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token comment"># stateå¯¹äºnn.LSTMæˆ–å¯¹äºæˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°çš„æ¨¡å‹æ˜¯ä¸ªå…ƒç»„</span>                <span class="token keyword">for</span> s <span class="token keyword">in</span> state<span class="token punctuation">:</span>                    s<span class="token punctuation">.</span>detach_<span class="token punctuation">(</span><span class="token punctuation">)</span>        y <span class="token operator">=</span> Y<span class="token punctuation">.</span>T<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>        y_hat<span class="token punctuation">,</span> state <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">,</span> state<span class="token punctuation">)</span>        l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>updater<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Optimizer<span class="token punctuation">)</span><span class="token punctuation">:</span>            updater<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            grad_clipping<span class="token punctuation">(</span>net<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>            updater<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            grad_clipping<span class="token punctuation">(</span>net<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token comment"># å› ä¸ºå·²ç»è°ƒç”¨äº†meanå‡½æ•°</span>            updater<span class="token punctuation">(</span>batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        metric<span class="token punctuation">.</span>add<span class="token punctuation">(</span>l <span class="token operator">*</span> y<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> math<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>metric<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> metric<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metric<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> timer<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œçš„ç®€æ´å®ç°"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œçš„ç®€æ´å®ç°" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œçš„ç®€æ´å®ç°"></a>å¾ªç¯ç¥ç»ç½‘ç»œçš„ç®€æ´å®ç°</h2><h3 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><p>é«˜çº§APIæä¾›äº†å¾ªç¯ç¥ç»ç½‘ç»œçš„å®ç°ã€‚ æˆ‘ä»¬æ„é€ ä¸€ä¸ªå…·æœ‰256ä¸ªéšè—å•å…ƒçš„å•éšè—å±‚çš„å¾ªç¯ç¥ç»ç½‘ç»œå±‚ <code>rnn_layer</code>ã€‚ äº‹å®ä¸Šï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºå¤šå±‚å¾ªç¯ç¥ç»ç½‘ç»œçš„æ„ä¹‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F<span class="token keyword">from</span> d2l <span class="token keyword">import</span> torch <span class="token keyword">as</span> d2lbatch_size<span class="token punctuation">,</span> num_steps <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">35</span>train_iter<span class="token punctuation">,</span> vocab <span class="token operator">=</span> d2l<span class="token punctuation">.</span>load_data_time_machine<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> num_steps<span class="token punctuation">)</span>num_hiddens <span class="token operator">=</span> <span class="token number">256</span><span class="token comment"># å¯ä»¥çœ‹åˆ° rnn_layer çš„å®šä¹‰æ˜¯ä¸éœ€è¦æ—¶é—´æ­¥çš„ï¼Œåº”è¯¥æ˜¯åœ¨è¾“å…¥æ•°æ®ä¸Šè¿›è¡Œå®šä¹‰</span><span class="token comment"># è¿™é‡Œåº”è¯¥èƒ½ä½“ä¼šåˆ°â€œå¾ªç¯â€çš„æ„Ÿè§‰äº†ï¼Œå³æ•°æ®ä¸æ–­åœ°æµå…¥æµå‡ºåŒä¸€ä¸ªç½‘ç»œ</span>rnn_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>RNN<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬ä½¿ç”¨å¼ é‡æ¥åˆå§‹åŒ–éšçŠ¶æ€ï¼Œå®ƒçš„å½¢çŠ¶æ˜¯ï¼ˆéšè—å±‚æ•°ï¼Œæ‰¹é‡å¤§å°ï¼Œéšè—å•å…ƒæ•°ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">state <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># [1, 32, 256]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šè¿‡ä¸€ä¸ªéšçŠ¶æ€å’Œä¸€ä¸ªè¾“å…¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æ›´æ–°åçš„éšçŠ¶æ€è®¡ç®—è¾“å‡ºã€‚ éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œ<code>rnn_layer</code>çš„â€œè¾“å‡ºâ€ï¼ˆ<code>Y</code>ï¼‰ä¸æ¶‰åŠè¾“å‡ºå±‚çš„è®¡ç®—ï¼š å®ƒæ˜¯æŒ‡æ¯ä¸ªæ—¶é—´æ­¥çš„éšçŠ¶æ€ï¼Œè¿™äº›éšçŠ¶æ€å¯ä»¥ç”¨ä½œåç»­è¾“å‡ºå±‚çš„è¾“å…¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åŒºåˆ«äºå·ç§¯ç¥ç»ç½‘ç»œæŠŠ batch_size çš„ç»´åº¦æ”¾åœ¨ç¬¬ä¸€ä¸ªï¼Œrnn çš„è¾“å…¥å°†æ—¶é—´æ­¥ç»´åº¦æ”¾åœ¨ç¬¬ä¸€ä¸ª</span>X <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">(</span>num_steps<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vocab<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Y<span class="token punctuation">,</span> state_new <span class="token operator">=</span> rnn_layer<span class="token punctuation">(</span>X<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token comment"># Y.shape = [35, 32, 256]</span><span class="token comment"># state_new.shape = [1, 32, 256] æ˜¯ Y çš„ç»„åä¸€ä¸ªè¾“å‡ºï¼Œå³ï¼šY[34] or Y[num_steps-1]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>rnn_layer</code>åªåŒ…å«éšè—çš„å¾ªç¯å±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¾“å‡ºå±‚ï¼Œè¿™é‡Œç”¨ <code>nn.Linear(num_hidden, len(vocab))</code> å®ç°ï¼Œä¸‹é¢å®Œæ•´å®ç°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#@save</span><span class="token keyword">class</span> <span class="token class-name">RNNModel</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹"""</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> rnn_layer<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>RNNModel<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>rnn <span class="token operator">=</span> rnn_layer        self<span class="token punctuation">.</span>vocab_size <span class="token operator">=</span> vocab_size        self<span class="token punctuation">.</span>num_hiddens <span class="token operator">=</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>hidden_size        <span class="token comment"># å¦‚æœRNNæ˜¯åŒå‘çš„ï¼ˆä¹‹åå°†ä»‹ç»ï¼‰ï¼Œnum_directionsåº”è¯¥æ˜¯2ï¼Œå¦åˆ™åº”è¯¥æ˜¯1</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>bidirectional<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>num_directions <span class="token operator">=</span> <span class="token number">1</span>            self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_hiddens<span class="token punctuation">,</span> self<span class="token punctuation">.</span>vocab_size<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>num_directions <span class="token operator">=</span> <span class="token number">2</span>            self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_hiddens <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>vocab_size<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># input.shape = (batch_size, num_steps) éœ€è¦è½¬ç½®ä¸€ä¸‹å¹¶ç”Ÿæˆ onehot ç‰¹å¾</span>        X <span class="token operator">=</span> F<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>T<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>vocab_size<span class="token punctuation">)</span>        X <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>        Y<span class="token punctuation">,</span> state <span class="token operator">=</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">(</span>X<span class="token punctuation">,</span> state<span class="token punctuation">)</span>        <span class="token comment"># å…¨è¿æ¥å±‚é¦–å…ˆå°†Yçš„å½¢çŠ¶æ”¹ä¸º(æ—¶é—´æ­¥æ•°*æ‰¹é‡å¤§å°,éšè—å•å…ƒæ•°)</span>        <span class="token comment"># å®ƒçš„è¾“å‡ºå½¢çŠ¶æ˜¯(æ—¶é—´æ­¥æ•°*æ‰¹é‡å¤§å°,è¯è¡¨å¤§å°)ã€‚</span>        output <span class="token operator">=</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>Y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> output<span class="token punctuation">,</span> state    <span class="token keyword">def</span> <span class="token function">begin_state</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> device<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>rnn<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment"># nn.GRUä»¥å¼ é‡ä½œä¸ºéšçŠ¶æ€</span>            <span class="token keyword">return</span>  torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>num_directions <span class="token operator">*</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>num_layers<span class="token punctuation">,</span>                                 batch_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_hiddens<span class="token punctuation">)</span><span class="token punctuation">,</span>                                device<span class="token operator">=</span>device<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># nn.LSTMä»¥å…ƒç»„ä½œä¸ºéšçŠ¶æ€</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>                self<span class="token punctuation">.</span>num_directions <span class="token operator">*</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>num_layers<span class="token punctuation">,</span>                batch_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_hiddens<span class="token punctuation">)</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span>                    torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>                        self<span class="token punctuation">.</span>num_directions <span class="token operator">*</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>num_layers<span class="token punctuation">,</span>                        batch_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_hiddens<span class="token punctuation">)</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€šè¿‡æ—¶é—´åå‘ä¼ æ’­"><a href="#é€šè¿‡æ—¶é—´åå‘ä¼ æ’­" class="headerlink" title="é€šè¿‡æ—¶é—´åå‘ä¼ æ’­"></a>é€šè¿‡æ—¶é—´åå‘ä¼ æ’­</h2><p>è¿™ä¸€èŠ‚è¯¦ç»†ä¸ºäº†è®¡ç®—å¾ªç¯ç¥ç»ç½‘ç»œçš„æ¢¯åº¦ï¼Œå‘æˆ‘ä»¬å±•ç¤ºäº†å¾ªç¯ç¥ç»ç½‘ç»œä¸­å­˜åœ¨çš„æ¢¯åº¦æ•°å€¼ä¸ç¨³å®š</p><h3 id="æ¢¯åº¦ç­–ç•¥"><a href="#æ¢¯åº¦ç­–ç•¥" class="headerlink" title="æ¢¯åº¦ç­–ç•¥"></a>æ¢¯åº¦ç­–ç•¥</h3><p>æ•™ææåˆ°äº†ä¸‰ç§ç­–ç•¥ï¼šéšæœºé˜¶æ®µï¼Œå¸¸è§„æˆªæ–­ï¼Œå®Œæ•´è®¡ç®—</p><p><img src="/archives/a67a203a/image-20211209164325936.png" style="zoom:80%;"></p><ul><li>ç¬¬ä¸€è¡Œé‡‡ç”¨éšæœºæˆªæ–­ï¼Œæ–¹æ³•æ˜¯å°†æ–‡æœ¬åˆ’åˆ†ä¸ºä¸åŒé•¿åº¦çš„ç‰‡æ–­</li><li>ç¬¬äºŒè¡Œé‡‡ç”¨å¸¸è§„æˆªæ–­ï¼Œæ–¹æ³•æ˜¯å°†æ–‡æœ¬åˆ†è§£ä¸ºç›¸åŒé•¿åº¦çš„å­åºåˆ—ã€‚ è¿™ä¹Ÿæ˜¯æ•™æåœ¨å¾ªç¯ç¥ç»ç½‘ç»œå®éªŒä¸­ä¸€ç›´åœ¨åšçš„ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ä½¿ç”¨ <code>detach_()</code> æ–¹æ³•å°†æ¯ä¸€ä¸ª iteration è¾“å…¥çš„åˆå§‹éšçŠ¶æ€ä»è®¡ç®—å›¾ä¸­åˆ†ç¦»å¼€</li><li>ç¬¬ä¸‰è¡Œé‡‡ç”¨é€šè¿‡æ—¶é—´çš„å®Œå…¨åå‘ä¼ æ’­ï¼Œç»“æœæ˜¯äº§ç”Ÿäº†åœ¨è®¡ç®—ä¸Šä¸å¯è¡Œçš„è¡¨è¾¾å¼ï¼ˆè¿­ä»£é“¾å¾ˆé•¿ï¼Œè®¡ç®—å¤æ‚ï¼‰</li></ul><p>é—æ†¾çš„æ˜¯ï¼Œè™½ç„¶éšæœºæˆªæ–­åœ¨ç†è®ºä¸Šå…·æœ‰å¸å¼•åŠ›ï¼Œ ä½†å¾ˆå¯èƒ½æ˜¯ç”±äºå¤šç§å› ç´ åœ¨å®è·µä¸­å¹¶ä¸æ¯”å¸¸è§„æˆªæ–­æ›´å¥½</p><h3 id="åå‘ä¼ æ’­ç»†èŠ‚"><a href="#åå‘ä¼ æ’­ç»†èŠ‚" class="headerlink" title="åå‘ä¼ æ’­ç»†èŠ‚"></a>åå‘ä¼ æ’­ç»†èŠ‚</h3><p>é¦–å…ˆå†™æ¯ä¸ªæ—¶é—´æ­¥çš„æ–¹ç¨‹</p><script type="math/tex; mode=display">\begin{array}{l}\mathbf{h}_{t}=\mathbf{W}_{h x} \mathbf{x}_{t}+\mathbf{W}_{h h} \mathbf{h}_{t-1}, \\\mathbf{o}_{t}=\mathbf{W}_{q h} \mathbf{h}_{t},\end{array}</script><p>å†™å‡ºæŸå¤±å‡½æ•°</p><script type="math/tex; mode=display">L=\frac{1}{T} \sum_{t=1}^{T} l\left(\mathbf{o}_{t}, y_{t}\right)</script><p>ç”»å‡ºè®¡ç®—å›¾</p><p><img src="/archives/a67a203a/image-20211209171043562.png" style="zoom:80%;"></p><p>åœ¨ä»»æ„æ—¶é—´æ­¥ttï¼Œ ç›®æ ‡å‡½æ•°å…³äºæ¨¡å‹è¾“å‡ºçš„å¾®åˆ†è®¡ç®—æ˜¯ç›¸å½“ç®€å•çš„</p><script type="math/tex; mode=display">\frac{\partial L}{\partial \mathbf{o}_{t}}=\frac{\partial l\left(\mathbf{o}_{t}, y_{t}\right)}{T \cdot \partial \mathbf{o}_{t}} \in \mathbb{R}^{q}</script><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—ç›®æ ‡å‡½æ•°å…³äºè¾“å‡ºå±‚ä¸­å‚æ•° $W_{qh}$ çš„æ¢¯åº¦</p><script type="math/tex; mode=display">\frac{\partial L}{\partial \mathbf{W}_{q h}}=\sum_{t=1}^{T} \operatorname{prod}\left(\frac{\partial L}{\partial \mathbf{o}_{t}}, \frac{\partial \mathbf{o}_{t}}{\partial \mathbf{W}_{q h}}\right)=\sum_{t=1}^{T} \frac{\partial L}{\partial \mathbf{o}_{t}} \mathbf{h}_{t}^{\top},</script><p>æ ¹æ®è®¡ç®—å›¾ï¼Œè¦è®¡ç®—å…³äºéšçŠ¶æ€çš„æ¢¯åº¦ã€‚æˆ‘ä»¬ä¸èƒ½å¤ŸåŒæ—¶å¾—åˆ°æ‰€æœ‰æ—¶é—´æ­¥çš„æ¢¯åº¦ï¼Œè€Œæ˜¯ä»æœ€åä¸€ä¸ªæ—¶é—´æ­¥ T å€’æ¨</p><script type="math/tex; mode=display">\frac{\partial L}{\partial \mathbf{h}_{T}}=\operatorname{prod}\left(\frac{\partial L}{\partial \mathbf{o}_{T}}, \frac{\partial \mathbf{o}_{T}}{\partial \mathbf{h}_{T}}\right)=\mathbf{W}_{q h}^{\top} \frac{\partial L}{\partial \mathbf{o}_{T}}</script><p>è¿›è¡Œè¿­ä»£è®¡ç®—ï¼Œæœ€ç»ˆå¾—åˆ°æ‰€æœ‰æ—¶é—´æ­¥çš„è¡¨è¾¾å¼</p><script type="math/tex; mode=display">\frac{\partial L}{\partial \mathbf{h}_{t}}=\operatorname{prod}\left(\frac{\partial L}{\partial \mathbf{h}_{t+1}}, \frac{\partial \mathbf{h}_{t+1}}{\partial \mathbf{h}_{t}}\right)+\operatorname{prod}\left(\frac{\partial L}{\partial \mathbf{o}_{t}}, \frac{\partial \mathbf{o}_{t}}{\partial \mathbf{h}_{t}}\right)=\mathbf{W}_{h h}^{\top} \frac{\partial L}{\partial \mathbf{h}_{t+1}}+\mathbf{W}_{q h}^{\top} \frac{\partial L}{\partial \mathbf{o}_{t}}</script><p>ä¸ºäº†è¿›è¡Œåˆ†æï¼Œå¯¹äºä»»ä½•æ—¶é—´æ­¥ 1â‰¤tâ‰¤T å±•å¼€é€’å½’è®¡ç®—å¾—</p><script type="math/tex; mode=display">\frac{\partial L}{\partial \mathbf{h}_{t}}=\sum_{i=t}^{T}\left(\mathbf{W}_{h h}^{\top}\right)^{T-i} \mathbf{W}_{q h}^{\top} \frac{\partial L}{\partial \mathbf{o}_{T+t-i}}</script><p>è¿™ä¸ªç®€å•çš„çº¿æ€§ä¾‹å­å·²ç»å±•ç°äº†é•¿åºåˆ—æ¨¡å‹çš„ä¸€äº›å…³é”®é—®é¢˜ï¼š ç”±äºè¿ç»­çŸ©é˜µç›¸ä¹˜ï¼Œå®ƒå¯èƒ½é™·å…¥åˆ°æ½œåœ¨çš„éå¸¸å¤§çš„å¹‚ã€‚ è¿™åœ¨æ•°å€¼ä¸Šæ˜¯ä¸ç¨³å®šçš„ï¼Œè¡¨ç°å½¢å¼ä¸ºæ¢¯åº¦æ¶ˆå¤±æˆ–æ¢¯åº¦çˆ†ç‚¸ï¼Œè§£å†³æ–¹æ³•é€šå¸¸ä¸ºæ¢¯åº¦æˆªæ–­ï¼Œæˆ–è€…ä½¿ç”¨ï¼ˆåœ¨ä¹‹åå­¦ä¹ çš„ï¼‰æ›´å¤æ‚çš„åºåˆ—æ¨¡å‹ï¼Œå¦‚ï¼šLSTM/GRU</p><p>æœ€åæˆ‘ä»¬å¾—åˆ°æƒé‡çŸ©é˜µçš„æ¢¯åº¦</p><script type="math/tex; mode=display">\begin{array}{c}\frac{\partial L}{\partial \mathbf{W}_{h x}}=\sum_{t=1}^{T} \operatorname{prod}\left(\frac{\partial L}{\partial \mathbf{h}_{t}}, \frac{\partial \mathbf{h}_{t}}{\partial \mathbf{W}_{h x}}\right)=\sum_{t=1}^{T} \frac{\partial L}{\partial \mathbf{h}_{t}} \mathbf{x}_{t}^{\top}, \\\frac{\partial L}{\partial \mathbf{W}_{h h}}=\sum_{t=1}^{T} \operatorname{prod}\left(\frac{\partial L}{\partial \mathbf{h}_{t}}, \frac{\partial \mathbf{h}_{t}}{\partial \mathbf{W}_{h h}}\right)=\sum_{t=1}^{T} \frac{\partial L}{\partial \mathbf{h}_{t}} \mathbf{h}_{t-1}^{\top},\end{array}</script>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 07 ç°ä»£å·ç§¯ç¥ç»ç½‘ç»œ</title>
      <link href="/archives/d08db5b4.html"/>
      <url>/archives/d08db5b4.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-07-ç°ä»£å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#D2L-07-ç°ä»£å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="D2L 07 ç°ä»£å·ç§¯ç¥ç»ç½‘ç»œ"></a>D2L 07 ç°ä»£å·ç§¯ç¥ç»ç½‘ç»œ</h1><p>è™½ç„¶æ·±åº¦ç¥ç»ç½‘ç»œçš„æ¦‚å¿µéå¸¸ç®€å•â€”â€”å°†ç¥ç»ç½‘ç»œå †å åœ¨ä¸€èµ·ã€‚ä½†ç”±äºä¸åŒçš„ç½‘ç»œç»“æ„å’Œè¶…å‚æ•°é€‰æ‹©ï¼Œè¿™äº›ç¥ç»ç½‘ç»œçš„æ€§èƒ½ä¼šå‘ç”Ÿå¾ˆå¤§å˜åŒ–ã€‚ æœ¬ç« ä»‹ç»çš„ç¥ç»ç½‘ç»œæ˜¯å°†äººç±»ç›´è§‰å’Œç›¸å…³æ•°å­¦è§è§£ç»“åˆåï¼Œç»è¿‡å¤§é‡ç ”ç©¶è¯•é”™åçš„ç»“æ™¶ã€‚ æˆ‘ä»¬ä¼šæŒ‰æ—¶é—´é¡ºåºä»‹ç»è¿™äº›æ¨¡å‹ï¼Œ<strong>åœ¨è¿½å¯»å†å²çš„è„‰ç»œçš„åŒæ—¶ï¼Œå¸®åŠ©ä½ åŸ¹å…»å¯¹è¯¥é¢†åŸŸå‘å±•çš„ç›´è§‰</strong>ã€‚è¿™å°†æœ‰åŠ©äºä½ ç ”ç©¶å¼€å‘è‡ªå·±çš„ç»“æ„ã€‚ ä¾‹å¦‚ï¼Œæœ¬ç« ä»‹ç»çš„æ‰¹é‡å½’ä¸€åŒ–ï¼ˆbatch normalizationï¼‰å’Œæ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰ä¸ºè®¾è®¡å’Œè®­ç»ƒæ·±åº¦ç¥ç»ç½‘ç»œæä¾›äº†é‡è¦æ€æƒ³æŒ‡å¯¼</p><h2 id="ä¸€ç‚¹å†å²"><a href="#ä¸€ç‚¹å†å²" class="headerlink" title="ä¸€ç‚¹å†å²"></a>ä¸€ç‚¹å†å²</h2><p>åœ¨ä¼ ç»Ÿæœºå™¨å­¦ä¹ æ–¹æ³•ä¸­ï¼Œè®¡ç®—æœºè§†è§‰æµæ°´çº¿æ˜¯ç”±ç»è¿‡äººçš„æ‰‹å·¥ç²¾å¿ƒè®¾è®¡çš„ç‰¹å¾æµæ°´çº¿ç»„æˆçš„ï¼ˆSIFT, SURF, HOGï¼‰ã€‚å°†æå–çš„ç‰¹å¾æ”¾åˆ°æœ€å–œæ¬¢çš„åˆ†ç±»å™¨ä¸­ï¼ˆä¾‹å¦‚çº¿æ€§æ¨¡å‹æˆ–å…¶å®ƒæ ¸æ–¹æ³•ï¼‰ï¼Œä»¥è®­ç»ƒåˆ†ç±»å™¨</p><p>å¯¹äºè¿™äº›ä¼ ç»Ÿæ–¹æ³•ï¼Œå¤§éƒ¨åˆ†çš„è¿›å±•éƒ½æ¥è‡ªäºå¯¹ç‰¹å¾æœ‰äº†æ›´èªæ˜çš„æƒ³æ³•ï¼Œå¹¶ä¸”å­¦ä¹ åˆ°çš„ç®—æ³•å¾€å¾€å½’äºäº‹åçš„è§£é‡Š</p><p>æœºå™¨å­¦ä¹ æ˜¯ä¸€ä¸ªæ­£åœ¨è“¬å‹ƒå‘å±•ã€ä¸¥è°¨ä¸”éå¸¸æœ‰ç”¨çš„é¢†åŸŸã€‚ç„¶è€Œï¼Œå¦‚æœä½ å’Œè®¡ç®—æœºè§†è§‰ç ”ç©¶äººå‘˜äº¤è°ˆï¼Œ<strong>ä»–ä»¬ä¼šå‘Šè¯‰ä½ å›¾åƒè¯†åˆ«çš„è¯¡å¼‚äº‹å®â€”â€”æ¨åŠ¨é¢†åŸŸè¿›æ­¥çš„æ˜¯æ•°æ®ç‰¹å¾ï¼Œè€Œä¸æ˜¯å­¦ä¹ ç®—æ³•</strong>ã€‚è®¡ç®—æœºè§†è§‰ç ”ç©¶äººå‘˜ç›¸ä¿¡ï¼Œä»å¯¹æœ€ç»ˆæ¨¡å‹ç²¾åº¦çš„å½±å“æ¥è¯´ï¼Œæ›´å¤§æˆ–æ›´å¹²å‡€çš„æ•°æ®é›†ã€æˆ–æ˜¯ç¨å¾®æ”¹è¿›çš„ç‰¹å¾æå–ï¼Œæ¯”ä»»ä½•å­¦ä¹ ç®—æ³•å¸¦æ¥çš„è¿›æ­¥è¦å¤§å¾—å¤š</p><p>ä¸€ç»„ç ”ç©¶äººå‘˜ï¼ŒåŒ…æ‹¬ Yann LeCun, Geoff Hinton, Yoshua Bengio, Andrew Ng, Shun ichi Amari å’Œ Juergen Schmidhuberï¼Œä»–ä»¬è®¤ä¸ºç‰¹å¾æœ¬èº«åº”è¯¥è¢«å­¦ä¹ </p><p>æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œçš„çªç ´å‡ºç°åœ¨2012å¹´ã€‚çªç ´å¯å½’å› äºä¸¤ä¸ªå…³é”®å› ç´ ï¼š</p><ol><li>æ•°æ®ï¼šåŒ…å«è®¸å¤šç‰¹å¾çš„æ·±åº¦æ¨¡å‹éœ€è¦å¤§é‡çš„æœ‰æ ‡ç­¾æ•°æ®ï¼Œæ‰èƒ½æ˜¾è‘—ä¼˜äºåŸºäºå‡¸ä¼˜åŒ–çš„ä¼ ç»Ÿæ–¹æ³•</li><li>GPUï¼šå¹¶è¡Œè®¡ç®—ä»¥åŠé«˜å†…å­˜å¸¦å®½å®ç°å¿«é€Ÿå·ç§¯è¿ç®—</li></ol><h2 id="AlexNet"><a href="#AlexNet" class="headerlink" title="AlexNet"></a>AlexNet</h2><p>2012å¹´ï¼ŒAlexNet æ¨ªç©ºå‡ºä¸–ã€‚å®ƒé¦–æ¬¡è¯æ˜äº†å­¦ä¹ åˆ°çš„ç‰¹å¾å¯ä»¥è¶…è¶Šæ‰‹å·¥è®¾è®¡çš„ç‰¹å¾ã€‚AlexNet ä½¿ç”¨äº†8å±‚å·ç§¯ç¥ç»ç½‘ç»œï¼Œå¹¶ä»¥å¾ˆå¤§çš„ä¼˜åŠ¿èµ¢å¾—äº†2012å¹´ ImageNet (224x224) å›¾åƒè¯†åˆ«æŒ‘æˆ˜èµ›</p><p>æœ‰è¶£çš„æ˜¯ï¼Œåœ¨ç½‘ç»œçš„æœ€åº•å±‚ï¼ŒAlexNet å­¦ä¹ åˆ°äº†ä¸€äº›ç±»ä¼¼äºä¼ ç»Ÿæ»¤æ³¢å™¨çš„ç‰¹å¾æŠ½å–å™¨ã€‚AlexNet çš„æ›´é«˜å±‚å»ºç«‹åœ¨è¿™äº›åº•å±‚è¡¨ç¤ºçš„åŸºç¡€ä¸Šï¼Œä»¥è¡¨ç¤ºæ›´å¤§çš„ç‰¹å¾</p><p>å°½ç®¡ä¸€ç›´æœ‰ä¸€ç¾¤æ‰§ç€çš„ç ”ç©¶è€…ä¸æ–­é’»ç ”ï¼Œè¯•å›¾å­¦ä¹ è§†è§‰æ•°æ®çš„é€çº§è¡¨å¾ï¼Œç„¶è€Œå¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œè¿™äº›å°è¯•éƒ½æœªæœ‰çªç ´</p><h3 id="AlexNet-amp-LeNet"><a href="#AlexNet-amp-LeNet" class="headerlink" title="AlexNet &amp; LeNet"></a>AlexNet &amp; LeNet</h3><p><img src="/archives/d08db5b4/image-20211128151502022.png" style="zoom:80%;"></p><p>AlexNetå’ŒLeNetçš„è®¾è®¡ç†å¿µéå¸¸ç›¸ä¼¼ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›å·®å¼‚ï¼Œé™¤äº†å±‚æ•°æ›´æ·±ï¼Œé€šé“æ›´å¤šï¼Œå…¶ä»–å…³é”®çš„æ”¹å˜è¿˜æœ‰ï¼š</p><ol><li>æ¿€æ´»å‡½æ•°ä» sigmoid æ”¹ä¸º ReLU</li><li>ä½¿ç”¨äº† dropout æ­£åˆ™åŒ–</li><li>ä½¿ç”¨äº†æ•°æ®å¢å¼º</li></ol><p>ä¸‹é¢çœ‹çœ‹æ¨¡å‹çš„ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nnnet <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>    <span class="token comment"># è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª11*11çš„æ›´å¤§çª—å£æ¥æ•æ‰å¯¹è±¡ã€‚</span>    <span class="token comment"># åŒæ—¶ï¼Œæ­¥å¹…ä¸º4ï¼Œä»¥å‡å°‘è¾“å‡ºçš„é«˜åº¦å’Œå®½åº¦ã€‚</span>    <span class="token comment"># å¦å¤–ï¼Œè¾“å‡ºé€šé“çš„æ•°ç›®è¿œå¤§äºLeNet</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># å‡å°å·ç§¯çª—å£ï¼Œä½¿ç”¨å¡«å……ä¸º2æ¥ä½¿å¾—è¾“å…¥ä¸è¾“å‡ºçš„é«˜å’Œå®½ä¸€è‡´ï¼Œä¸”å¢å¤§è¾“å‡ºé€šé“æ•°</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># ä½¿ç”¨ä¸‰ä¸ªè¿ç»­çš„å·ç§¯å±‚å’Œè¾ƒå°çš„å·ç§¯çª—å£ã€‚</span>    <span class="token comment"># é™¤äº†æœ€åçš„å·ç§¯å±‚ï¼Œè¾“å‡ºé€šé“çš„æ•°é‡è¿›ä¸€æ­¥å¢åŠ ã€‚</span>    <span class="token comment"># åœ¨å‰ä¸¤ä¸ªå·ç§¯å±‚ä¹‹åï¼Œæ±‡èšå±‚ä¸ç”¨äºå‡å°‘è¾“å…¥çš„é«˜åº¦å’Œå®½åº¦</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># è¿™é‡Œï¼Œå…¨è¿æ¥å±‚çš„è¾“å‡ºæ•°é‡æ˜¯LeNetä¸­çš„å¥½å‡ å€ã€‚ä½¿ç”¨dropoutå±‚æ¥å‡è½»è¿‡åº¦æ‹Ÿåˆ</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">6400</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># æœ€åæ˜¯è¾“å‡ºå±‚ã€‚ç”±äºè¿™é‡Œä½¿ç”¨Fashion-MNISTï¼Œæ‰€ä»¥ç”¨ç±»åˆ«æ•°ä¸º10ï¼Œè€Œéè®ºæ–‡ä¸­çš„1000</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»Šå¤©ï¼ŒAlexNetå·²ç»è¢«æ›´æœ‰æ•ˆçš„ç»“æ„æ‰€è¶…è¶Šï¼Œä½†å®ƒæ˜¯ä»æµ…å±‚ç½‘ç»œåˆ°æ·±å±‚ç½‘ç»œçš„å…³é”®ä¸€æ­¥ã€‚å°½ç®¡AlexNetçš„ä»£ç åªæ¯”LeNetå¤šå‡ºå‡ è¡Œï¼Œä½†å­¦æœ¯ç•ŒèŠ±äº†å¾ˆå¤šå¹´æ‰æ¥å—æ·±åº¦å­¦ä¹ è¿™ä¸€æ¦‚å¿µï¼Œå¹¶åº”ç”¨å…¶å‡ºè‰²çš„å®éªŒç»“æœ</p><h2 id="VGG"><a href="#VGG" class="headerlink" title="VGG"></a>VGG</h2><p>VGG è®©ç½‘ç»œçš„ç»“æ„æ›´åŠ æ¨¡å—åŒ–ï¼Œä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª vgg_block æ¥å®ç°ä¸€ä¸ªç»„åˆï¼šConvolution + Activation + Pooling</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">def</span> <span class="token function">vgg_block</span><span class="token punctuation">(</span>num_convs<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>    layers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_convs<span class="token punctuation">)</span><span class="token punctuation">:</span>        layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span>                                kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        in_channels <span class="token operator">=</span> out_channels    layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>layers<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨å®šä¹‰å¥½çš„æ¨¡å—å’Œå„ç§è¶…å‚æ•°ï¼Œæ­å»º VGG ç½‘ç»œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å®šä¹‰ (num_conv, out_channels)</span>conv_arch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">vgg</span><span class="token punctuation">(</span>conv_arch<span class="token punctuation">)</span><span class="token punctuation">:</span>    conv_blks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    in_channels <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment"># å·ç§¯å±‚éƒ¨åˆ†</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>num_convs<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span> <span class="token keyword">in</span> conv_arch<span class="token punctuation">:</span>        conv_blks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>vgg_block<span class="token punctuation">(</span>num_convs<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>        in_channels <span class="token operator">=</span> out_channels    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>        <span class="token operator">*</span>conv_blks<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment"># å…¨è¿æ¥å±‚éƒ¨åˆ†</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>out_channels <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net <span class="token operator">=</span> vgg<span class="token punctuation">(</span>conv_arch<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ VGG è®ºæ–‡ä¸­ï¼ŒSimonyan å’Œ Ziserman å°è¯•äº†å„ç§æ¶æ„ã€‚ç‰¹åˆ«æ˜¯ä»–ä»¬å‘ç°æ·±å±‚ä¸”çª„çš„å·ç§¯ï¼ˆå³3Ã—3ï¼‰æ¯”è¾ƒæµ…å±‚ä¸”å®½çš„å·ç§¯æ›´æœ‰æ•ˆ</p><h2 id="NiN"><a href="#NiN" class="headerlink" title="NiN"></a>NiN</h2><p>å…¨è¿æ¥å±‚çš„è¾“å…¥å’Œè¾“å‡ºé€šå¸¸æ˜¯åˆ†åˆ«å¯¹åº”äºæ ·æœ¬å’Œç‰¹å¾çš„äºŒç»´å¼ é‡ï¼Œè¿™ä¸ªå‚æ•°æ•°é‡ç›¸æ¯”å·ç§¯æ ¸æ˜¯éå¸¸å¤§çš„ï¼ŒNiN å’Œ AlexNet ä¹‹é—´çš„ä¸€ä¸ªæ˜¾è‘—åŒºåˆ«æ˜¯ NiN å®Œå…¨å–æ¶ˆäº†å…¨è¿æ¥å±‚ã€‚NiN çš„æƒ³æ³•æ˜¯åœ¨æ¯ä¸ªåƒç´ ä½ç½®ï¼ˆé’ˆå¯¹æ¯ä¸ªé«˜åº¦å’Œå®½åº¦ï¼‰åº”ç”¨ä¸€ä¸ª 1x1 çš„å·ç§¯ï¼ˆå¯è§†ä¸ºåƒç´ çº§å…¨è¿æ¥å±‚ï¼‰ä»¥æ›¿ä»£å…¨è¿æ¥å±‚ï¼Œä¸‹é¢ç›´æ¥ä¸Šå›¾ç¤ºå’Œä»£ç </p><p><img src="/archives/d08db5b4/image-20211128165154091.png" style="zoom:80%;"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">def</span> <span class="token function">nin_block</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token punctuation">,</span> strides<span class="token punctuation">,</span> padding<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token punctuation">,</span> strides<span class="token punctuation">,</span> padding<span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>    nin_block<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nin_block<span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nin_block<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># æ ‡ç­¾ç±»åˆ«æ•°æ˜¯10</span>    nin_block<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># æœ€åæ”¾ä¸€ä¸ª å…¨å±€å¹³å‡æ±‡èšå±‚ï¼ˆglobal average pooling layerï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªå¤šå…ƒé€»è¾‘å‘é‡ï¼ˆlogitsï¼‰</span>    <span class="token comment"># å°†å››ç»´çš„è¾“å‡ºè½¬æˆäºŒç»´çš„è¾“å‡ºï¼Œå…¶å½¢çŠ¶ä¸º(æ‰¹é‡å¤§å°, 10)</span>    nn<span class="token punctuation">.</span>AdaptiveAvgPool2d<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>NiN è®¾è®¡çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒæ˜¾è‘—å‡å°‘äº†æ¨¡å‹æ‰€éœ€å‚æ•°çš„æ•°é‡ï¼Œè¿™ä¹Ÿå‡å°‘äº†è¿‡æ‹Ÿåˆã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œè¿™ç§è®¾è®¡æœ‰æ—¶ä¼šå¢åŠ è®­ç»ƒæ¨¡å‹çš„æ—¶é—´</p><h2 id="GoogLeNet"><a href="#GoogLeNet" class="headerlink" title="GoogLeNet"></a>GoogLeNet</h2><p>åœ¨ GoogLeNet ä¸­ï¼ŒåŸºæœ¬çš„å·ç§¯å—è¢«ç§°ä¸º Inception å—ï¼ˆInception blockï¼‰è®ºæ–‡çš„ä¸€ä¸ªè§‚ç‚¹æ˜¯ï¼Œæœ‰æ—¶ä½¿ç”¨ä¸åŒå¤§å°çš„å·ç§¯æ ¸ç»„åˆæ˜¯æœ‰åˆ©çš„ã€‚å…¶ä¸­ Google ä¸­çš„ L ä¸ºå¤§å†™ï¼Œä»¥è‡´æ•¬ LeNet </p><p><img src="/archives/d08db5b4/image-20211128173254328.png" style="zoom:80%;"></p><p>è¿™å››æ¡è·¯å¾„éƒ½ä½¿ç”¨åˆé€‚çš„å¡«å……æ¥ä½¿è¾“å…¥ä¸è¾“å‡ºçš„é«˜å’Œå®½ä¸€è‡´ï¼Œæœ€åæˆ‘ä»¬å°†æ¯æ¡çº¿è·¯çš„è¾“å‡ºåœ¨é€šé“ç»´åº¦ä¸Šè¿ç»“ï¼Œå¹¶æ„æˆ Inception å—çš„è¾“å‡ºã€‚åœ¨ Inception å—ä¸­ï¼Œé€šå¸¸è°ƒæ•´çš„è¶…å‚æ•°æ˜¯æ¯å±‚è¾“å‡ºé€šé“çš„æ•°é‡ï¼ˆå¾ˆéš¾è°ƒï¼Œè¿™ä¹Ÿæ˜¯ GoogLeNet éš¾ä»¥å¤ç°çš„åŸå› ä¹‹ä¸€ï¼‰ã€‚ä¸‹é¢æ˜¯  Inception å—çš„ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F<span class="token keyword">class</span> <span class="token class-name">Inception</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># `c1`--`c4` æ˜¯æ¯æ¡è·¯å¾„çš„è¾“å‡ºé€šé“æ•°</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> c3<span class="token punctuation">,</span> c4<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Inception<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        <span class="token comment"># çº¿è·¯1ï¼Œå•1 x 1å·ç§¯å±‚</span>        self<span class="token punctuation">.</span>p1_1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># çº¿è·¯2ï¼Œ1 x 1å·ç§¯å±‚åæ¥3 x 3å·ç§¯å±‚</span>        self<span class="token punctuation">.</span>p2_1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> c2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>p2_2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>c2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># çº¿è·¯3ï¼Œ1 x 1å·ç§¯å±‚åæ¥5 x 5å·ç§¯å±‚</span>        self<span class="token punctuation">.</span>p3_1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> c3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>p3_2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>c3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token comment"># çº¿è·¯4ï¼Œ3 x 3æœ€å¤§æ±‡èšå±‚åæ¥1 x 1å·ç§¯å±‚</span>        self<span class="token punctuation">.</span>p4_1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>p4_2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> c4<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        p1 <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>p1_1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        p2 <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>p2_2<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>p2_1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        p3 <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>p3_2<span class="token punctuation">(</span>F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>p3_1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        p4 <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>p4_2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>p4_1<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># åœ¨é€šé“ç»´åº¦ä¸Šè¿ç»“è¾“å‡º</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">,</span> p4<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ•´ä¸ªæ¨¡å‹å›¾ç¤º</p><p><img src="/archives/d08db5b4/image-20211128173520258.png" style="zoom:80%;"></p><p>Inception å—ä¹‹é—´çš„æœ€å¤§æ±‡èšå±‚å¯é™ä½ç»´åº¦ï¼Œ1x1 å·ç§¯å—çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯ç»´åº¦è½¬æ¢ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡å‡å°‘é€šé“æ•°é™ä½ç½‘ç»œå‚æ•°</p><h2 id="Batch-Normalization"><a href="#Batch-Normalization" class="headerlink" title="Batch Normalization"></a>Batch Normalization</h2><p><strong>è¿™æ˜¯ä¸€ç§æµè¡Œä¸”æœ‰æ•ˆçš„æŠ€æœ¯ï¼Œå¯æŒç»­åŠ é€Ÿæ·±å±‚ç½‘ç»œçš„æ”¶æ•›é€Ÿåº¦</strong>ï¼Œç›´è§‚å½¢å¼æ˜¯ï¼šæ§åˆ¶æ¯ä¸€å±‚çš„è¾“å‡ºåˆ†å¸ƒã€‚ç°åœ¨å…·ä½“æ¥çœ‹æ‰¹é‡å½’ä¸€åŒ–ï¼ˆbatch normalizationï¼‰çš„å½¢å¼ï¼Œç”¨ $xâˆˆ\mathcal B$ è¡¨ç¤ºä¸€ä¸ªæ¥è‡ªå°æ‰¹é‡çš„è¾“å…¥</p><script type="math/tex; mode=display">\mathrm{BN}(\mathbf{x})=\gamma \odot \frac{\mathbf{x}-\hat{\boldsymbol{\mu}}_{\mathcal{B}}}{\hat{\boldsymbol{\sigma}}_{\mathcal{B}}}+\boldsymbol{\beta}\\\begin{aligned}\hat{\boldsymbol{\mu}}_{\mathcal{B}} &=\frac{1}{|\mathcal{B}|} \sum_{\mathbf{x} \in \mathcal{B}} \mathbf{x} \\\hat{\boldsymbol{\sigma}}_{\mathcal{B}}^{2} &=\frac{1}{|\mathcal{B}|} \sum_{\mathbf{x} \in \mathcal{B}}\left(\mathbf{x}-\hat{\boldsymbol{\mu}}_{\mathcal{B}}\right)^{2}+\epsilon\end{aligned}</script><p>åº”ç”¨æ ‡å‡†åŒ–åï¼Œç”Ÿæˆçš„å°æ‰¹é‡çš„å¹³å‡å€¼ä¸º0å’Œå•ä½æ–¹å·®ä¸º1ï¼Œ$\gamma, \beta$ æ˜¯éœ€è¦å­¦ä¹ çš„å‚æ•°ï¼Œé€šå¸¸è¢«è®¤ä¸ºæ˜¯æ‹‰ä¼¸å‚æ•°å’Œåç§»å‚æ•°ï¼Œ$\epsilon$ ä¸ºä¸€ä¸ªå°é‡ä»¥ç¡®ä¿ä¸é™¤ä»¥é›¶</p><h3 id="æ‰¹é‡å½’ä¸€åŒ–å±‚"><a href="#æ‰¹é‡å½’ä¸€åŒ–å±‚" class="headerlink" title="æ‰¹é‡å½’ä¸€åŒ–å±‚"></a>æ‰¹é‡å½’ä¸€åŒ–å±‚</h3><p>æ‰¹é‡å½’ä¸€åŒ–æ˜¯ä¸€ç§çº¿æ€§å˜æ¢ï¼Œé€šå¸¸ä½œç”¨åœ¨è¾“å‡ºå’Œæ¿€æ´»å‡½æ•°ä¹‹é—´ï¼Œå¯¹äºå…¨è¿æ¥å±‚å’Œå·ç§¯å±‚çš„æ‰¹é‡å½’ä¸€åŒ–ç•¥æœ‰ä¸åŒï¼ˆ<a href="https://pytorch.org/docs/stable/generated/torch.nn.BatchNorm1d.html">BatchNorm1d</a>-&gt;<a href="https://pytorch.org/docs/stable/generated/torch.nn.BatchNorm2d.html#torch.nn.BatchNorm2d">BatchNorm2d</a>ï¼‰</p><p>æ‰¹é‡å½’ä¸€åŒ–ä¹Ÿå¯ä»¥çœ‹ä½œä¸€ç§æ­£åˆ™åŒ–æŠ€æœ¯ï¼Œå®ƒåœ¨è®­ç»ƒå’Œæµ‹è¯•é˜¶æ®µçš„è¡¨ç°æ˜¯ä¸ä¸€æ ·çš„ã€‚é€šå¸¸åœ¨é¢„æµ‹é˜¶æ®µï¼Œé€šè¿‡ç§»åŠ¨å¹³å‡ä¼°ç®—æ•´ä¸ªè®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬å‡å€¼å’Œæ–¹å·®ï¼Œå¹¶åœ¨é¢„æµ‹æ—¶ä½¿ç”¨å®ƒä»¬ä»¥æ›¿ä»£è®­ç»ƒè¿‡ç¨‹ä¸­çš„å°æ‰¹é‡å‡å€¼å’Œæ–¹å·®</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>æ•™æç»™å‡ºäº†ä¸€ä¸ªä»é›¶å®ç°ç‰ˆæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">def</span> <span class="token function">batch_norm</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> gamma<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> moving_mean<span class="token punctuation">,</span> moving_var<span class="token punctuation">,</span> eps<span class="token punctuation">,</span> momentum<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># é€šè¿‡ `is_grad_enabled` æ¥åˆ¤æ–­å½“å‰æ¨¡å¼æ˜¯è®­ç»ƒæ¨¡å¼è¿˜æ˜¯é¢„æµ‹æ¨¡å¼</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> torch<span class="token punctuation">.</span>is_grad_enabled<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å¦‚æœæ˜¯åœ¨é¢„æµ‹æ¨¡å¼ä¸‹ï¼Œç›´æ¥ä½¿ç”¨ä¼ å…¥çš„ç§»åŠ¨å¹³å‡æ‰€å¾—çš„å‡å€¼å’Œæ–¹å·®</span>        X_hat <span class="token operator">=</span> <span class="token punctuation">(</span>X <span class="token operator">-</span> moving_mean<span class="token punctuation">)</span> <span class="token operator">/</span> torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>moving_var <span class="token operator">+</span> eps<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>            <span class="token comment"># ä½¿ç”¨å…¨è¿æ¥å±‚çš„æƒ…å†µï¼Œè®¡ç®—ç‰¹å¾ç»´ä¸Šçš„å‡å€¼å’Œæ–¹å·®</span>            mean <span class="token operator">=</span> X<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>            var <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># ä½¿ç”¨äºŒç»´å·ç§¯å±‚çš„æƒ…å†µï¼Œè®¡ç®—é€šé“ç»´ä¸Šï¼ˆaxis=1ï¼‰çš„å‡å€¼å’Œæ–¹å·®ã€‚</span>            <span class="token comment"># è¿™é‡Œæˆ‘ä»¬éœ€è¦ä¿æŒXçš„å½¢çŠ¶ä»¥ä¾¿åé¢å¯ä»¥åšå¹¿æ’­è¿ç®—</span>            mean <span class="token operator">=</span> X<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>            var <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keepdim<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token comment"># è®­ç»ƒæ¨¡å¼ä¸‹ï¼Œç”¨å½“å‰çš„å‡å€¼å’Œæ–¹å·®åšæ ‡å‡†åŒ–</span>        X_hat <span class="token operator">=</span> <span class="token punctuation">(</span>X <span class="token operator">-</span> mean<span class="token punctuation">)</span> <span class="token operator">/</span> torch<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>var <span class="token operator">+</span> eps<span class="token punctuation">)</span>        <span class="token comment"># æ›´æ–°ç§»åŠ¨å¹³å‡çš„å‡å€¼å’Œæ–¹å·®</span>        moving_mean <span class="token operator">=</span> momentum <span class="token operator">*</span> moving_mean <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> momentum<span class="token punctuation">)</span> <span class="token operator">*</span> mean        moving_var <span class="token operator">=</span> momentum <span class="token operator">*</span> moving_var <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> momentum<span class="token punctuation">)</span> <span class="token operator">*</span> var    Y <span class="token operator">=</span> gamma <span class="token operator">*</span> X_hat <span class="token operator">+</span> beta  <span class="token comment"># ç¼©æ”¾å’Œç§»ä½</span>    <span class="token keyword">return</span> Y<span class="token punctuation">,</span> moving_mean<span class="token punctuation">.</span>data<span class="token punctuation">,</span> moving_var<span class="token punctuation">.</span>data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢ä»…å®ç°äº†æ ¸å¿ƒåŠŸèƒ½ï¼Œå¦‚æœè¦ç»“åˆåˆ° pytorch æ¨¡å—ä¸­è¿˜éœ€è¦ç”¨ Module ç±»æ¥åŒ…è£…ä¸€ä¸‹ï¼Œè¿™é‡Œå°±ä¸è®°å½•äº†ã€‚ç›´æ¥ä½¿ç”¨ pytorch çš„ API åªéœ€è¦æŒ‡å®šè¾“å…¥çš„ channel æ•°å³å¯ï¼Œä¸‹é¢æ˜¯åœ¨åŸå§‹çš„ LeNet ä¸Šä½¿ç”¨ batch normalization çš„ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰¹é‡å½’ä¸€åŒ–åšäº†ä»€ä¹ˆ"><a href="#æ‰¹é‡å½’ä¸€åŒ–åšäº†ä»€ä¹ˆ" class="headerlink" title="æ‰¹é‡å½’ä¸€åŒ–åšäº†ä»€ä¹ˆ"></a>æ‰¹é‡å½’ä¸€åŒ–åšäº†ä»€ä¹ˆ</h3><ol><li>å›ºå®šå°æ‰¹é‡ä¸­çš„å‡å€¼å’Œæ–¹å·®ï¼Œç»´æŠ¤æ•°å€¼çš„ç›¸å¯¹ç¨³å®šï¼Œèƒ½åŠ é€Ÿæ”¶æ•›ï¼Œå‡ç¼“äº†æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸çš„æƒ…å†µï¼Œä½†ä¸€èˆ¬ä¸æ”¹å˜æ¨¡å‹ç²¾åº¦</li><li>å›ºå®šå°æ‰¹é‡ä¸­çš„å‡å€¼å’Œæ–¹å·®ï¼Œå¼•å…¥äº†å™ªå£°ï¼Œèµ·åˆ°äº†æ­£åˆ™åŒ–çš„ä½œç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„â€œå‰¯ä½œç”¨â€</li></ol><p>å®é™…ä¸Šå¯¹äºæ‰¹é‡å½’ä¸€åŒ–çš„åŸç†å¹¶æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„ç­”æ¡ˆï¼ŒåŸè®ºæ–‡æåˆ°çš„â€œå‡å°‘å†…éƒ¨åå˜é‡åç§»â€çš„åŠ¨æœºä¼¼ä¹ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è§£é‡Šã€‚å¦‚æœéè¦ç»™è¿™ä¸ªé—®é¢˜ç»™å‡ºè‡ªå·±çš„èƒ¡ä¹±ç†è§£ï¼Œæˆ‘è®¤ä¸ºæ˜¯æ§åˆ¶è¾“å‡ºåˆ†å¸ƒèƒ½å¤Ÿè®©æ•°å€¼æ›´ç¨³å®šï¼Œåœ¨ä¸€ä¸ªç»Ÿä¸€æ ‡å‡†ä¸‹çš„ç©ºé—´è¶…å¹³é¢çš„åˆ†å‰²åˆ†ä¼šæ›´å¥½ï¼Œæˆ–è®¸è¿™ç§æ•°å€¼ç¨³å®šå¯¹äºæ¢¯åº¦çˆ†ç‚¸å’Œæ¢¯åº¦æ¶ˆå¤±ä¹Ÿæœ‰ä¸€å®šä½œç”¨</p><h2 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h2><p>åŠ æ·±ç½‘ç»œä¸€å®šèƒ½æå‡æ¨¡å‹çš„è¡¨ç°å—ï¼Ÿç­”æ¡ˆä¸æ˜¯è‚¯å®šçš„ï¼Œä¸‹é¢è¿™å¼ å›¾å½¢è±¡åœ°å±•ç¤ºåŸå› </p><p><img src="/archives/d08db5b4/image-20211128194609417.png" style="zoom:80%;"></p><p>åªæœ‰å½“è¾ƒå¤æ‚çš„å‡½æ•°ç±»åŒ…å«è¾ƒå°çš„å‡½æ•°ç±»æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½ç¡®ä¿å¢å¤§æœç´¢èŒƒå›´æ—¶ï¼Œæœç´¢å¾—åˆ°çš„ç»“æœèƒ½æ›´æ¥è¿‘æœ€ä¼˜è§£ã€‚å¯¹äºæ·±åº¦ç¥ç»ç½‘ç»œï¼Œå¦‚æœæˆ‘ä»¬èƒ½å°†æ–°æ·»åŠ çš„å±‚è®­ç»ƒæˆæ’ç­‰æ˜ å°„ï¼ˆidentity functionï¼‰$f(x)=x$ï¼Œæ–°æ¨¡å‹å’ŒåŸæ¨¡å‹å°†åŒæ ·æœ‰æ•ˆ</p><p>é’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œä½•æºæ˜ç­‰äººæå‡ºäº†æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰ï¼Œå®ƒåœ¨2015å¹´çš„ ImageNet å›¾åƒè¯†åˆ«æŒ‘æˆ˜èµ›å¤ºé­ï¼Œ<strong>å¹¶æ·±åˆ»å½±å“äº†åæ¥çš„æ·±åº¦ç¥ç»ç½‘ç»œçš„è®¾è®¡</strong></p><h3 id="æ®‹å·®å—"><a href="#æ®‹å·®å—" class="headerlink" title="æ®‹å·®å—"></a>æ®‹å·®å—</h3><p>å‡è®¾æˆ‘ä»¬çš„åŸå§‹è¾“å…¥ä¸º $x$ ï¼Œè€Œå¸Œæœ›å­¦å‡ºçš„ç†æƒ³æ˜ å°„ä¸º $f(x)$ï¼Œæ™®é€šçš„å—å’Œæ®‹å·®å—çš„è¡¨ç°å½¢å¼å¦‚ä¸‹</p><p> <img src="/archives/d08db5b4/image-20211128200154146.png" style="zoom:80%;"></p><p>é‡ç‚¹å…³æ³¨å³ä¾§çš„ç»“æ„ï¼Œåœ¨è¯¥ç»“æ„ä¸‹ï¼Œè™šçº¿æ¡†å†…æ‰€å­¦åˆ°çš„æ˜ å°„å°†æ˜¯ä¸€ä¸ªæ®‹å·® $g(x) = f(x) - x$ï¼ˆå‡è®¾æˆ‘ä»¬èƒ½å¤Ÿå­¦åˆ°ç†æƒ³æ˜ å°„ï¼‰ï¼Œæ‰€ä»¥å–åä¸ºæ®‹å·®å—ã€‚è¿™æ ·çš„æ¨¡å—å°†å¾ˆå®¹æ˜“å­¦ä¹ æ’ç­‰å˜æ¢ï¼Œåªéœ€è¦å°†æ‰€æœ‰çš„æƒé‡ç½®é›¶å³å¯</p><p>ä¸ºäº†è®©è¾“å‡ºå’Œè¾“å…¥èƒ½å¤Ÿç›¸åŠ ï¼Œæ˜¾ç„¶è¦æ±‚è¾“å…¥å’Œè¾“å‡ºæ˜¯å…·æœ‰ç›¸åŒå½¢çŠ¶å’Œç›¸åŒé€šé“æ•°ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨ 1x1 å·ç§¯å±‚è§£å†³ã€‚ResNet ä¸­çš„æ®‹å·®å—å›¾ç¤ºå¦‚ä¸‹</p><p><img src="/archives/d08db5b4/image-20211128202426360.png" style="zoom:80%;"></p><p>ä»£ç å°†æ›´æ¸…æ™°åœ°å±•ç¤ºå…¶ä¸­çš„ç»†èŠ‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> F<span class="token keyword">class</span> <span class="token class-name">Residual</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input_channels<span class="token punctuation">,</span> num_channels<span class="token punctuation">,</span>                 use_1x1conv<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>input_channels<span class="token punctuation">,</span> num_channels<span class="token punctuation">,</span>                               kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span>strides<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>num_channels<span class="token punctuation">,</span> num_channels<span class="token punctuation">,</span>                               kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> use_1x1conv<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>input_channels<span class="token punctuation">,</span> num_channels<span class="token punctuation">,</span>                                   kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span>strides<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>num_channels<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>num_channels<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>relu <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        Y <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        Y <span class="token operator">=</span> self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">:</span>            X <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        Y <span class="token operator">+=</span> X        <span class="token keyword">return</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ResNet-æ¨¡å‹"><a href="#ResNet-æ¨¡å‹" class="headerlink" title="ResNet æ¨¡å‹"></a>ResNet æ¨¡å‹</h3><p>ResNet çš„å‰ä¸¤å±‚è·Ÿä¹‹å‰ä»‹ç»çš„ GoogLeNet ä¸­çš„ä¸€æ ·ï¼Œä¸åŒä¹‹å¤„åœ¨äº ResNet æ¯ä¸ªå·ç§¯å±‚åå¢åŠ äº†<strong>æ‰¹é‡å½’ä¸€åŒ–å±‚</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">b1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                   nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                   nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>GoogLeNet åœ¨åé¢æ¥äº† 4 ä¸ªç”±Inceptionå—ç»„æˆçš„æ¨¡å—ã€‚ ResNet åˆ™ä½¿ç”¨ 4 ä¸ªç”±æ®‹å·®å—ç»„æˆçš„æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä½¿ç”¨è‹¥å¹²ä¸ªåŒæ ·è¾“å‡ºé€šé“æ•°çš„æ®‹å·®å—ï¼Œå®šä¹‰ç”±æ®‹å·®å—ç»„æˆçš„ <code>resnet_block</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">resnet_block</span><span class="token punctuation">(</span>input_channels<span class="token punctuation">,</span> num_channels<span class="token punctuation">,</span> num_residuals<span class="token punctuation">,</span>                 first_block<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    blk <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_residuals<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å¯¹ç¬¬ä¸€ä¸ªæ¨¡å—åšç‰¹åˆ«å¤„ç†ï¼Œä¸éœ€è¦å¯¹ç»´åº¦è¿›è¡Œè½¬æ¢</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token keyword">not</span> first_block<span class="token punctuation">:</span>            blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Residual<span class="token punctuation">(</span>input_channels<span class="token punctuation">,</span> num_channels<span class="token punctuation">,</span>                                use_1x1conv<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Residual<span class="token punctuation">(</span>num_channels<span class="token punctuation">,</span> num_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> blk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨åœ¨ ResNet ä¸­åŠ å…¥æ‰€æœ‰æ®‹å·®å—ï¼Œè¿™é‡Œæ¯ä¸ªæ¨¡å—ä½¿ç”¨ 2 ä¸ªæ®‹å·®å—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">b2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>resnet_block<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> first_block<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>b3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>resnet_block<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>b4 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>resnet_block<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>b5 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>resnet_block<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åï¼Œä¸ GoogLeNet ä¸€æ ·ï¼Œåœ¨ ResNet ä¸­åŠ å…¥å…¨å±€å¹³å‡æ±‡èšå±‚ï¼Œä»¥åŠå…¨è¿æ¥å±‚è¾“å‡º</p><pre class="line-numbers language-pyt" data-language="pyt"><code class="language-pyt">net = nn.Sequential(b1, b2, b3, b4, b5,                    nn.AdaptiveAvgPool2d((1,1)),                    nn.Flatten(), nn.Linear(512, 10))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ¯ä¸ªæ¨¡å—æœ‰ 4 ä¸ªå·ç§¯å±‚ï¼ˆä¸åŒ…æ‹¬æ’ç­‰æ˜ å°„çš„ 1Ã—1 å·ç§¯å±‚ï¼‰ã€‚ åŠ ä¸Šç¬¬ä¸€ä¸ª 7Ã—7 å·ç§¯å±‚å’Œæœ€åä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œå…±æœ‰ 18 å±‚ã€‚ å› æ­¤ï¼Œè¿™ç§æ¨¡å‹é€šå¸¸è¢«ç§°ä¸º ResNet-18ã€‚è™½ç„¶ ResNet çš„ä¸»ä½“ç»“æ„è·Ÿ GoogLeNetç±»ä¼¼ï¼Œä½† ResNet ç»“æ„æ›´ç®€å•ï¼Œä¿®æ”¹ä¹Ÿæ›´æ–¹ä¾¿ã€‚è¿™äº›å› ç´ éƒ½å¯¼è‡´äº† ResNet è¿…é€Ÿè¢«å¹¿æ³›ä½¿ç”¨</p><p><img src="/archives/d08db5b4/image-20211128204626861.png" style="zoom:80%;"></p>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 06 å·ç§¯ç¥ç»ç½‘ç»œ</title>
      <link href="/archives/59b56001.html"/>
      <url>/archives/59b56001.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-06-å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#D2L-06-å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="D2L 06 å·ç§¯ç¥ç»ç½‘ç»œ"></a>D2L 06 å·ç§¯ç¥ç»ç½‘ç»œ</h1><p>æœ¬ç« ä»‹ç»çš„å·ç§¯ç¥ç»ç½‘ç»œï¼ˆconvolutional neural networkï¼ŒCNNï¼‰æ˜¯ä¸€ç±»å¼ºå¤§çš„ã€ä¸ºå¤„ç†å›¾åƒæ•°æ®è€Œè®¾è®¡çš„ç¥ç»ç½‘ç»œã€‚ åŸºäºå·ç§¯ç¥ç»ç½‘ç»œç»“æ„çš„æ¨¡å‹åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­å·²ç»å ä¸»å¯¼åœ°ä½ï¼Œå½“ä»Šå‡ ä¹æ‰€æœ‰çš„å›¾åƒè¯†åˆ«ã€å¯¹è±¡æ£€æµ‹æˆ–è¯­ä¹‰åˆ†å‰²ç›¸å…³çš„å­¦æœ¯ç«èµ›å’Œå•†ä¸šåº”ç”¨éƒ½ä»¥è¿™ç§æ–¹æ³•ä¸ºåŸºç¡€</p><h2 id="ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯"><a href="#ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯" class="headerlink" title="ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯"></a>ä»å…¨è¿æ¥å±‚åˆ°å·ç§¯</h2><p>MLP çš„éœ€è¦å°†æ•°æ®å±•å¼€åˆ°ä¸€ç»´ï¼Œè¿™å°†å¸¦æ¥å¤§é‡çš„å‚æ•°å¼€é”€ï¼Œä»¥åŠå¿½ç•¥æ•°æ®ä¹‹é—´çš„ç»“æ„ä¿¡æ¯ã€‚CNN æ˜¯æœºå™¨å­¦ä¹ åˆ©ç”¨è‡ªç„¶å›¾åƒä¸­ä¸€äº›å·²çŸ¥ç»“æ„çš„åˆ›é€ æ€§æ–¹æ³•</p><p>ä¸ºäº†è®©ç½‘ç»œèƒ½å¤Ÿé€‚åˆäºè®¡ç®—æœºè§†è§‰ï¼Œéœ€è¦æœ‰ä¸¤ä¸ªç‰¹å¾ï¼š</p><ol><li>å¹³ç§»ä¸å˜æ€§ï¼šå¯¹ç›¸åŒçš„å›¾åƒåŒºåŸŸå…·æœ‰ç›¸ä¼¼çš„ååº”</li><li>å±€éƒ¨æ€§ï¼šåªæ¢ç´¢è¾“å…¥å›¾åƒä¸­çš„å±€éƒ¨åŒºåŸŸï¼Œè€Œä¸è¿‡åº¦åœ¨æ„å›¾åƒä¸­ç›¸éš”è¾ƒè¿œåŒºåŸŸçš„å…³ç³»</li></ol><p>æ•™æç”¨äº†å‡ ä¸ªå…¬å¼çš„è½¬å˜æ¥å®Œæˆè¿™ä¸¤ä¸ªç‰¹å¾</p><ol><li>å…¨è¿æ¥å±‚å…¬å¼è¡¨è¾¾ï¼Œ$H,U,W\ or \ V,X$ åˆ†åˆ«è¡¨ç¤ºè¾“å‡ºï¼ˆéšè—å±‚ï¼‰ï¼Œåç½®ï¼Œæƒé‡ï¼Œè¾“å…¥ã€‚ä¸‹æ ‡è¡¨ç¤ºå›¾å½¢é•¿å®½</li></ol><p><img src="/archives/59b56001/image-20211125150600004.png"></p><ol><li>åŠ å…¥å¹³ç§»ä¸å˜æ€§</li></ol><p><img src="/archives/59b56001/image-20211125150750073.png"></p><ol><li>åŠ å…¥å±€éƒ¨æ€§</li></ol><p><img src="/archives/59b56001/image-20211125150811529.png"></p><p>â€‹    ä¸Šé¢å°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„å·ç§¯å±‚ï¼Œ$V$ ä¸ºå·ç§¯æ ¸ï¼ˆconvolution kernelï¼‰æˆ–è€…æ»¤æ³¢å™¨ï¼ˆfilterï¼‰</p><ol><li>åŠ å…¥é€šé“</li></ol><p><img src="/archives/59b56001/image-20211125150903545.png"></p><p>æ•™æè¿˜ä»‹ç»äº†ä¸€ä¸‹æ•°å­¦ä¸Šçš„å·ç§¯æ“ä½œï¼Œä¸æˆ‘ä»¬å®é™…ä½¿ç”¨çš„å·ç§¯æ“ä½œæ˜¯ä¸ä¸€æ ·çš„ï¼Œå›¾åƒå·ç§¯æ“ä½œåœ¨æ•°å­¦ä¸Šå«åšäº’ç›¸å…³ï¼ˆcross-correlationï¼‰ï¼Œè¯¥æ“ä½œæ˜¯å·ç§¯çš„â€œæœªç¿»è½¬â€ç‰ˆæœ¬ã€‚ä¸ºäº†ä¸æ·±åº¦å­¦ä¹ æ–‡çŒ®ä¸­çš„æ ‡å‡†æœ¯è¯­ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬å°†ç»§ç»­æŠŠâ€œäº’ç›¸å…³è¿ç®—â€ç§°ä¸ºå·ç§¯è¿ç®—</p><h2 id="å›¾åƒå·ç§¯"><a href="#å›¾åƒå·ç§¯" class="headerlink" title="å›¾åƒå·ç§¯"></a>å›¾åƒå·ç§¯</h2><p>äº’ç›¸å…³/å·ç§¯è¿ç®—å›¾è§£</p><p><img src="/archives/59b56001/image-20211125152613227.png" style="zoom:80%;"></p><p>æ³¨æ„ï¼Œè¾“å‡ºå¤§å°ç•¥å°äºè¾“å…¥å¤§å°ã€‚è¿™æ˜¯å› ä¸ºå·ç§¯æ ¸çš„å®½åº¦å’Œé«˜åº¦å¤§äº1ï¼Œ è€Œå·ç§¯æ ¸åªä¸å›¾åƒä¸­æ¯ä¸ªå¤§å°å®Œå…¨é€‚åˆçš„ä½ç½®è¿›è¡Œäº’ç›¸å…³è¿ç®—ã€‚ä¸‹é¢ç®€å•å®ç°ä¸€ä¸ªè‡ªå·±çš„å·ç§¯å±‚</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">def</span> <span class="token function">corr2d</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> K<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""è®¡ç®—äºŒç»´äº’ç›¸å…³è¿ç®—ã€‚"""</span>    h<span class="token punctuation">,</span> w <span class="token operator">=</span> K<span class="token punctuation">.</span>shape    Y <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> h <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> w <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>Y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>Y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            Y<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>X<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> h<span class="token punctuation">,</span> j<span class="token punctuation">:</span>j <span class="token operator">+</span> w<span class="token punctuation">]</span> <span class="token operator">*</span> K<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> Y<span class="token keyword">class</span> <span class="token class-name">Conv2D</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> kernel_size<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>kernel_size<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bias <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> corr2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>weight<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>bias<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å­¦ä¹ å·ç§¯æ ¸"><a href="#å­¦ä¹ å·ç§¯æ ¸" class="headerlink" title="å­¦ä¹ å·ç§¯æ ¸"></a>å­¦ä¹ å·ç§¯æ ¸</h3><p>æ•™æä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼šèƒ½å¤Ÿç”¨ä¸€ä¸ª <code>[1, -1]</code> çš„ç®€å•å·ç§¯æ ¸æ¥æ£€æµ‹æ¨ªå‘è¾¹ç¼˜ã€‚ä½†æ˜¯ä¸å¯èƒ½æ‰€æœ‰å·ç§¯æ ¸æ˜¯äººå·¥æ„é€ çš„ï¼Œå¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬å¯ä»¥åƒä¹‹å‰çš„ MLP ä¸€æ ·ä½¿ç”¨ä¼˜åŒ–ç®—æ³•ä¼°è®¡å‡ºä¸€ä¸ªå·ç§¯æ ¸æ¥è¾¾åˆ°æœŸæœ›çš„æ•ˆæœã€‚æœ€ç»ˆé€šè¿‡æ¢¯åº¦ä¸‹é™æ³•å­¦ä¹ åˆ°çš„æƒé‡ä¸º <code>[0.9895, -0.9873]</code> ä¸äººå·¥è®¾è®¡å·ç§¯æ ¸ååˆ†æ¥è¿‘</p><p>å®é™…ä¸Šå¯èƒ½å­˜åœ¨å„ç§å„æ ·çš„å·ç§¯æ ¸ï¼Œè¿™äº›å·ç§¯æ ¸èƒ½å¤Ÿæå–ä¸åŒçš„ç‰¹å¾ï¼Œä¾‹å¦‚ï¼šå›¾åƒè¾¹ç¼˜ï¼Œæœé¥°è†¨èƒ€ï¼ŒäºŒé˜¶æ±‚å¯¼ç­‰ã€‚å¦‚æœè¦å»äººå·¥è®¾è®¡è¿™ä¹ˆå¤šåŠŸèƒ½çš„å·ç§¯æ ¸ï¼Œå°±å›åˆ°äº†ä¼ ç»Ÿè®¡ç®—æœºè§†è§‰ï¼Œå¦ä¸€ä¸ªé€‰æ‹©å°±æ˜¯è®¾è®¡ä¸€ä¸ªç½‘ç»œï¼Œç„¶åä½¿ç”¨ä¼˜åŒ–ç®—æ³•å»å­¦ä¹ ï¼Œä½†æ˜¯å­¦ä¹ åˆ°çš„å·ç§¯æ ¸å¯è§£é‡Šæ€§å°±ä¸å¼ºäº†</p><h3 id="ç‰¹å¾æ˜ å°„å’Œæ„Ÿå—é‡"><a href="#ç‰¹å¾æ˜ å°„å’Œæ„Ÿå—é‡" class="headerlink" title="ç‰¹å¾æ˜ å°„å’Œæ„Ÿå—é‡"></a>ç‰¹å¾æ˜ å°„å’Œæ„Ÿå—é‡</h3><p>æ•™æè¯´åˆ°ï¼šå·ç§¯å±‚æœ‰æ—¶è¢«ç§°ä¸ºç‰¹å¾æ˜ å°„ï¼ˆFeature Mapï¼‰ã€‚ç”±äº Map çš„æ„ä¹‰åœ¨è‹±æ–‡é‡Œæœ‰å¤šä¸ªï¼Œä¹Ÿå¯ä»¥è¢«ç¿»è¯‘ä¸ºåœ°å›¾ï¼ŒFeature Map ä¹Ÿå¸¸è¢«ç¿»è¯‘ä¸ºç‰¹å¾å›¾è°±ï¼Œè€Œæ•™æåº”è¯¥å°±æ˜¯æƒ³è¡¨è¿°ä¸ºâ€œæ˜ å°„â€ï¼Œä»¥è¡¨ç¤º CNN å¯¹äºç‰¹å¾çš„æå–ä½œç”¨</p><h2 id="å¡«å……å’Œæ­¥å¹…"><a href="#å¡«å……å’Œæ­¥å¹…" class="headerlink" title="å¡«å……å’Œæ­¥å¹…"></a>å¡«å……å’Œæ­¥å¹…</h2><p>å¡«å……å’Œæ­¥å¹…å¯ç”¨äºæœ‰æ•ˆåœ°è°ƒæ•´æ•°æ®çš„ç»´åº¦</p><h3 id="å¡«å……"><a href="#å¡«å……" class="headerlink" title="å¡«å……"></a>å¡«å……</h3><p>åœ¨åº”ç”¨å¤šå±‚å·ç§¯æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¸¢å¤±è¾¹ç¼˜åƒç´ ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® $p_h=k_hâˆ’1$ å’Œ $p_w=k_wâˆ’1$ å»å¡«å……ï¼ˆpaddingï¼‰å›¾åƒå‘¨å›´ï¼Œä½¿è¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜åº¦å’Œå®½åº¦ã€‚å¦‚æœ kernel size ä¸ºå¥‡æ•°å°±èƒ½åœ¨å·¦å³ä¸Šä¸‹å‡åŒ€å¾—å¡«å……äº†</p><h3 id="æ­¥å¹…"><a href="#æ­¥å¹…" class="headerlink" title="æ­¥å¹…"></a>æ­¥å¹…</h3><p>æœ‰æ—¶å€™ä¸ºäº†é«˜æ•ˆè®¡ç®—æˆ–æ˜¯ç¼©å‡é‡‡æ ·æ¬¡æ•°ï¼Œå·ç§¯çª—å£å¯ä»¥è·³è¿‡ä¸­é—´ä½ç½®ï¼Œæ¯æ¬¡æ»‘åŠ¨å¤šä¸ªå…ƒç´ ã€‚æˆ‘ä»¬å°†æ¯æ¬¡æ»‘åŠ¨å…ƒç´ çš„æ•°é‡ç§°ä¸ºæ­¥å¹…ï¼ˆstrideï¼‰</p><h2 id="å¤šè¾“å…¥å¤šè¾“å‡ºé€šé“"><a href="#å¤šè¾“å…¥å¤šè¾“å‡ºé€šé“" class="headerlink" title="å¤šè¾“å…¥å¤šè¾“å‡ºé€šé“"></a>å¤šè¾“å…¥å¤šè¾“å‡ºé€šé“</h2><h3 id="å¤šè¾“å…¥é€šé“"><a href="#å¤šè¾“å…¥é€šé“" class="headerlink" title="å¤šè¾“å…¥é€šé“"></a>å¤šè¾“å…¥é€šé“</h3><p>å½“è¾“å…¥åŒ…å«å¤šä¸ªé€šé“æ—¶ï¼Œéœ€è¦æ„é€ ä¸€ä¸ªä¸è¾“å…¥æ•°æ®å…·æœ‰ç›¸åŒè¾“å…¥é€šé“æ•°ç›®çš„å·ç§¯æ ¸ï¼Œä»¥ä¾¿ä¸è¾“å…¥æ•°æ®è¿›è¡Œäº’ç›¸å…³è¿ç®—ã€‚æˆ‘ä»¬æ¼”ç¤ºäº†ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªè¾“å…¥é€šé“çš„äºŒç»´äº’ç›¸å…³è¿ç®—çš„ç¤ºä¾‹</p><p><img src="/archives/59b56001/image-20211125162435643.png" style="zoom:80%;"></p><h3 id="å¤šè¾“å‡ºé€šé“"><a href="#å¤šè¾“å‡ºé€šé“" class="headerlink" title="å¤šè¾“å‡ºé€šé“"></a>å¤šè¾“å‡ºé€šé“</h3><p>æ¯ä¸€å±‚æœ‰å¤šä¸ªè¾“å‡ºé€šé“æ˜¯è‡³å…³é‡è¦çš„ã€‚åœ¨æœ€æµè¡Œçš„ç¥ç»ç½‘ç»œæ¶æ„ä¸­ï¼Œéšç€ç¥ç»ç½‘ç»œå±‚æ•°çš„åŠ æ·±ï¼Œæˆ‘ä»¬å¸¸ä¼šå¢åŠ è¾“å‡ºé€šé“çš„ç»´æ•°ï¼Œé€šè¿‡å‡å°‘ç©ºé—´åˆ†è¾¨ç‡ä»¥è·å¾—æ›´å¤§çš„é€šé“æ·±åº¦ã€‚ç›´è§‚åœ°è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªé€šé“çœ‹ä½œæ˜¯å¯¹ä¸åŒç‰¹å¾çš„å“åº”</p><h3 id="1x1-å·ç§¯å±‚"><a href="#1x1-å·ç§¯å±‚" class="headerlink" title="1x1 å·ç§¯å±‚"></a>1x1 å·ç§¯å±‚</h3><p>1x1 å·ç§¯çœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚ æ¯•ç«Ÿï¼Œå·ç§¯çš„æœ¬è´¨æ˜¯æœ‰æ•ˆæå–ç›¸é‚»åƒç´ é—´çš„ç›¸å…³ç‰¹å¾ï¼Œä½†æ˜¯è¿™æ ·çš„æ“ä½œå®é™…ä¸Šéå¸¸å¸¸è§</p><p>æˆ‘ä»¬å¯ä»¥å°† 1x1 å·ç§¯å±‚çœ‹ä½œæ˜¯åœ¨æ¯ä¸ªåƒç´ ä½ç½®åº”ç”¨çš„å…¨è¿æ¥å±‚ã€‚è¿™é‡Œè¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜åº¦å’Œå®½åº¦ï¼Œè¾“å‡ºä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä»è¾“å…¥å›¾åƒä¸­åŒä¸€ä½ç½®çš„å…ƒç´ çš„çº¿æ€§ç»„åˆ</p><p><img src="/archives/59b56001/image-20211125163401472.png" style="zoom:80%;"></p><p>æ³¨æ„ï¼šåœ¨åé¢çš„å›¾ç¤ºå’Œä»£ç å½“ä¸­ï¼Œå¾ˆå°‘èƒ½çœ‹åˆ° bias å‡ºç°ï¼Œä½†å®é™…ä¸Šå¦‚æœæ²¡æœ‰ç‰¹æ®ŠæŒ‡å®šï¼Œé»˜è®¤éƒ½æ˜¯å­˜åœ¨ biasï¼Œå…¶æ•°é‡ä¸å·ç§¯æ ¸æ•°é‡ç›¸åŒ</p><h2 id="æ±‡èšå±‚"><a href="#æ±‡èšå±‚" class="headerlink" title="æ±‡èšå±‚"></a>æ±‡èšå±‚</h2><p>ä¹Ÿé€šå¸¸å«åšæ± åŒ–å±‚ï¼ˆpooling layerï¼‰ï¼Œå®ƒé€šå¸¸å…·æœ‰ä¸¤ä¸ªç›®çš„ï¼š</p><ol><li>é™ä½å·ç§¯å±‚å¯¹ä½ç½®çš„æ•æ„Ÿæ€§</li><li>å¯¹è¾“å‡ºè¿›è¡Œé™é‡‡æ ·</li></ol><p>å¯¹äºâ€œæ•æ„Ÿæ€§â€çš„è¯´æ³•ï¼Œæˆ‘è§‰å¾—ä¸å¤ªå¥½ç†è§£ï¼Œåœ¨å´æ©è¾¾çš„è§†é¢‘é‡Œæåˆ°ï¼šæ± åŒ–å±‚èƒ½æé«˜æ‰€æå–ç‰¹å¾çš„é²æ£’æ€§ã€‚è¿™è®©æˆ‘è”æƒ³åˆ°äº†è‡ªå·±çœ‹çš„ PointNetï¼šä½¿ç”¨äº† maxpooling æ¥å°†æ‰€æœ‰ç‚¹çš„ç‰¹å¾æå–ä¸º global ç‰¹å¾ï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œæœ‰ç€ç›¸ä¼¼çš„ä½œç”¨ã€‚å› ä¸º maxpooling æ˜¯ä¸€ä¸ªå¯¹ç§°å‡½æ•°ï¼Œå¯¹äºä¸€äº›ä½ç½®çš„å˜æ¢ï¼ˆå™ªå£°ï¼‰å…¶è¾“å‡ºæ˜¯ä¸ä¼šæœ‰æ”¹å˜çš„ã€‚æˆ‘ä»¬å°†çª—å£ä¸­æœ€å¤§çš„æ•°ä½œä¸ºæ•´ä¸ªçª—å£çš„â€œä»£è¡¨â€ï¼Œå¿½ç•¥å…¶ä»–è¾ƒå°çš„å€¼ï¼Œä»¥æ•´ä½“æŠŠæ¡</p><h3 id="æœ€å¤§æ± åŒ–å’Œå¹³å‡æ± åŒ–"><a href="#æœ€å¤§æ± åŒ–å’Œå¹³å‡æ± åŒ–" class="headerlink" title="æœ€å¤§æ± åŒ–å’Œå¹³å‡æ± åŒ–"></a>æœ€å¤§æ± åŒ–å’Œå¹³å‡æ± åŒ–</h3><p>ä¸å·ç§¯å±‚ç±»ä¼¼ï¼Œæ±‡èšå±‚è¿ç®—ç¬¦ç”±ä¸€ä¸ªå›ºå®šå½¢çŠ¶çš„çª—å£ç»„æˆï¼Œè¯¥çª—å£æ ¹æ®å…¶æ­¥å¹…å¤§å°åœ¨è¾“å…¥çš„æ‰€æœ‰åŒºåŸŸä¸Šæ»‘åŠ¨ã€‚åœ¨æ± åŒ–çª—å£åˆ°è¾¾çš„æ¯ä¸ªä½ç½®ï¼Œå®ƒè®¡ç®—è¯¥çª—å£ä¸­è¾“å…¥å­å¼ é‡çš„æœ€å¤§å€¼æˆ–å¹³å‡å€¼</p><p>åœ¨å¤„ç†å¤šé€šé“è¾“å…¥æ•°æ®æ—¶ï¼Œæ±‡èšå±‚åœ¨æ¯ä¸ªè¾“å…¥é€šé“ä¸Šå•ç‹¬è¿ç®—ï¼Œè€Œä¸æ˜¯åƒå·ç§¯å±‚ä¸€æ ·åœ¨é€šé“ä¸Šå¯¹è¾“å…¥è¿›è¡Œæ±‡æ€»</p><h3 id="èƒ¡æ€ä¹±æƒ³ğŸ˜…"><a href="#èƒ¡æ€ä¹±æƒ³ğŸ˜…" class="headerlink" title="èƒ¡æ€ä¹±æƒ³ğŸ˜…"></a>èƒ¡æ€ä¹±æƒ³ğŸ˜…</h3><p>æ˜¯å¦å¯ä»¥ç›´æ¥é€šè¿‡å·ç§¯æ“ä½œæ›¿ä»£æ± åŒ–å±‚ï¼Ÿå› ä¸ºå·ç§¯ä¹Ÿèƒ½å¤Ÿé™ä½å›¾è°±çš„åˆ†è¾¨ç‡ï¼Œæ˜¾ç„¶å¹³å‡æ± åŒ–æ˜¯å¯ä»¥è¢«æ›¿ä»£çš„ï¼Œä½†æœ€å¤§æ± åŒ–å‘¢ï¼Ÿçœ‹åˆ°ä¸€ä¸ª <a href="(https://www.zhihu.com/question/270777218">çŸ¥ä¹</a> é“¾æ¥ [å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„poolingå±‚èƒ½å¦ç”¨ç›¸åŒstrideçš„convolutionå±‚æ›¿ä»£]) æœ‰æ‰€è®¨è®ºï¼Œå…¶ä¸­æœ‰äººè¯„è®ºï¼šmax pooling æ˜¯åŠ¨æ€çš„ï¼Œè€Œ strided convolution æ˜¯é™æ€çš„ï¼ŒäºŒè€…ä¸å¯ä¸€æ¦‚è€Œè®º</p><p>ç°åœ¨æ­£åœ¨è¯æ˜ä¸€ä»¶äº‹ï¼šå¯ä»¥ä½¿ç”¨ç¥ç»ç½‘ç»œå®ç°æœ€å¤§å€¼åˆ†ç±»/å›å½’é—®é¢˜ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹æˆ‘çš„å®éªŒç»“æœï¼š</p><ol><li>å®éªŒæ•°æ®ä¸º1000ä¸ªæ•°å¯¹ï¼Œä» (0ï¼Œ 20000) ä¸­è¿›è¡Œé‡‡æ ·</li><li>ReLU éœ€è¦è¾“å…¥å¤§å¤šæ•°ä¸ºæ­£æ•°ï¼Œè´Ÿæ•°å¤ªå¤šæ¢¯åº¦ä¼šè¿…é€Ÿæ¶ˆå¤±ï¼Œå½“ç„¶æ•°æ®çš„å½’ä¸€åŒ–ä¹Ÿæœ‰å¾ˆä¸é”™çš„æ•ˆæœ</li><li>é€šè¿‡ä¸€ä¸ªç®€å•ç½‘ç»œï¼Œæˆ‘å¯ä»¥å¾ˆå¥½çš„è®­ç»ƒå‡ºä¸€ä¸ªæœ€å¤§æœ€å°å€¼åˆ†ç±»æ¨¡å‹ï¼Œä½†æ˜¯å¯¹äºå›å½’æ¨¡å‹ä»ç„¶éœ€è¦æ›´å¤šåŠªåŠ›</li><li><del>æ˜¾ç„¶åŸå§‹æ•°æ®å¯¹äºæœ€å¤§å€¼å›å½’é—®é¢˜æ˜¯å¾ˆé‡è¦çš„ï¼Œæˆ–è®¸å¯¹äºå…¶ä»–çš„å›å½’é—®é¢˜ä¹Ÿå¾ˆé‡è¦</del>ã€‚å¦‚æœå¾—åˆ°äº†æœ€å¤§æœ€å°å€¼çš„åˆ†ç±»ï¼Œåªéœ€è¦å°†åˆ†ç±»ç»“æœä¸åŸå§‹æ•°æ®ç›¸ä¹˜å³å¯å¾—åˆ°æœ€å¤§å€¼ã€‚æŒ‰ç…§è¿™ä¸ªæ€è·¯æˆ‘ä¹Ÿå¾—åˆ°æœŸæœ›çš„ç»“æœï¼Œä½†æ˜¯å­¦ä¹ ç‡éå¸¸éå¸¸å°å¤§æ¦‚åˆ°äº† 1e-8 æ¬¡æ–¹çº§åˆ«ï¼Œæœ€ç»ˆæŸå¤±åœ¨ 5 å·¦å³</li><li>å³ä½¿ä¸ä½¿ç”¨â€œç›¸ä¹˜â€æ“ä½œï¼Œå®é™…ä¸Šæˆ‘ä¹Ÿèƒ½äººå·¥æ„é€ å‡ºä¸€ä¸ªç½‘ç»œï¼Œå¾—åˆ°ä¸é”™çš„ç»“æœï¼ŒæŒ‰ç…§æˆ‘çš„æƒ³æ³•ï¼Œç½‘ç»œæ²¡åŠæ³•é€šè¿‡ä¼˜åŒ–ç®—æ³•è·å¾—æˆ‘æ‰€è®¾è®¡çš„å‚æ•°ï¼Œä½†æ˜¯è¿™ä¸ªé—®é¢˜å¾ˆå¿«åœ¨<strong>æ›´å®½æ›´å¤š</strong>çš„ç½‘ç»œå±‚ä¸‹è¢«è§£å†³ï¼Œå®é™…çš„ loss åœ¨ 0.05 å·¦å³ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªç›¸å½“ä¸é”™çš„ç»“æœ</li><li>ä½¿ç”¨ SGD æ— æ³•å¾—åˆ°ä¼˜åŒ–ç»“æœï¼Œåªèƒ½ä½¿ç”¨ Adamï¼Œå¯¹äºç¨€ç–æ•°æ®/æ¨¡å‹å¯èƒ½éœ€è¦è‡ªé€‚åº”çš„å­¦ä¹ ç‡ï¼Œå¯ä»¥å…ˆç”¨ Adam å¿«é€Ÿæ”¶æ•›å†ç”¨ SGD è°ƒæ•´</li><li>ä½¿ç”¨ mini-batch æ— æ³•å¾—åˆ°ä¼˜åŒ–ç»“æœï¼Œbatch size åªèƒ½ç­‰äºä¸€ï¼Œbatch size è¶Šå¤§è¶Šå®¹æ˜“æœç´¢åˆ° sharp minimumï¼Œå‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/64864995">çŸ¥ä¹</a></li></ol><p>æ ¹æ®ä»¥ä¸Šå®éªŒï¼Œæˆ‘è®¤ä¸º strided convolution å…·æœ‰æ›¿ä»£ max pooling çš„èƒ½åŠ›ï¼Œå¦ä¸€äº›ç¬¼ç»Ÿçš„æ„Ÿå—æ˜¯ï¼š</p><ol><li>åˆ†ç±»ä»»åŠ¡æƒ³æ¯”å›å½’ä»»åŠ¡æ›´åŠ ç®€å•</li><li>å¯èƒ½å¯¹äºæœ‰<strong>é«˜ç²¾åº¦</strong>çš„ï¼ˆå›å½’ï¼‰ä»»åŠ¡æ·±åº¦å­¦ä¹ æ˜¯éœ€è¦ä¸€å®šè¾…åŠ©çš„ï¼Œä½†åœ¨å¤§é‡å¤æ‚æ•°æ®çš„æƒ…æ™¯ä¸‹ï¼Œæ·±åº¦å­¦ä¹ ç›¸æ¯”äººç±»å…·æœ‰æ— æ³•æ¯”æ‹Ÿçš„ä¼˜åŠ¿</li><li>ä¸€å¼€å§‹è®¤ä¸ºéœ€è¦ä½¿ç”¨åŸå§‹æ•°æ®è¿›è¡Œå›å½’ï¼Œå°è¯•äº† ResNetï¼Œä½†å®é™…ä¸Šå¹¶ä¸éœ€è¦ï¼Œæ™®é€šçš„å…¨è¿æ¥å±‚å³å¯å®Œæˆ</li></ol><h2 id="LeNet"><a href="#LeNet" class="headerlink" title="LeNet"></a>LeNet</h2><p>å½“æ—¶ï¼Œ LeNet å–å¾—äº†ä¸æ”¯æŒå‘é‡æœºï¼ˆsupport vector machinesï¼‰æ€§èƒ½ç›¸åª²ç¾çš„æˆæœï¼Œæˆä¸ºç›‘ç£å­¦ä¹ çš„ä¸»æµæ–¹æ³•ã€‚ç›´æ¥ä¸Šå›¾å’Œä»£ç å°±èƒ½å¤Ÿæ¸…æ¥šå…¶ç»“æ„</p><p><img src="/archives/59b56001/image-20211127204926151.png" style="zoom:80%;"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">class</span> <span class="token class-name">Reshape</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span>net <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>    Reshape<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>AvgPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>AvgPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†å‡¸æ˜¾ç®€å•ï¼Œæ•™æç›´æ¥ä½¿ç”¨ä¸€ä¸ª <code>nn.Sequential</code> å°†æ‰€æœ‰çš„æ¨¡å—è¿æ¥èµ·æ¥ï¼Œå¹¶è¯·æ³¨æ„ï¼Œè™½ç„¶ ReLU å’Œæœ€å¤§æ±‡èšå±‚æ›´æœ‰æ•ˆï¼Œä½†å®ƒä»¬åœ¨20ä¸–çºª90å¹´ä»£è¿˜æ²¡æœ‰å‡ºç°</p>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 05 æ·±åº¦å­¦ä¹ è®¡ç®—</title>
      <link href="/archives/53554dbc.html"/>
      <url>/archives/53554dbc.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-05-æ·±åº¦å­¦ä¹ è®¡ç®—"><a href="#D2L-05-æ·±åº¦å­¦ä¹ è®¡ç®—" class="headerlink" title="D2L 05 æ·±åº¦å­¦ä¹ è®¡ç®—"></a>D2L 05 æ·±åº¦å­¦ä¹ è®¡ç®—</h1><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹æ·±å…¥æ¢ç´¢æ·±åº¦å­¦ä¹ è®¡ç®—çš„å…³é”®ç»„ä»¶ï¼Œå³æ¨¡å‹æ„å»ºã€å‚æ•°è®¿é—®ä¸åˆå§‹åŒ–ã€è®¾è®¡è‡ªå®šä¹‰å±‚å’Œå—ã€å°†æ¨¡å‹è¯»å†™åˆ°ç£ç›˜ï¼Œä»¥åŠåˆ©ç”¨GPUå®ç°æ˜¾è‘—çš„åŠ é€Ÿã€‚è¿™äº›çŸ¥è¯†å°†ä½¿ä½ ä»åŸºç¡€ç”¨æˆ·å˜ä¸ºé«˜çº§ç”¨æˆ·ã€‚è™½ç„¶æœ¬ç« ä¸ä»‹ç»ä»»ä½•æ–°çš„æ¨¡å‹æˆ–æ•°æ®é›†ï¼Œä½†åé¢çš„é«˜çº§æ¨¡å‹ç« èŠ‚åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºæœ¬ç« çš„çŸ¥è¯†</p><h2 id="å±‚å’Œå—"><a href="#å±‚å’Œå—" class="headerlink" title="å±‚å’Œå—"></a>å±‚å’Œå—</h2><p>ä¸ºäº†å®ç°è¿™äº›å¤æ‚çš„ç½‘ç»œï¼Œæˆ‘ä»¬å¼•å…¥äº†ç¥ç»ç½‘ç»œå—çš„æ¦‚å¿µã€‚å—å¯ä»¥æè¿°å•ä¸ªå±‚ã€ç”±å¤šä¸ªå±‚ç»„æˆçš„ç»„ä»¶æˆ–æ•´ä¸ªæ¨¡å‹æœ¬èº«</p><h3 id="è‡ªå®šä¹‰å—"><a href="#è‡ªå®šä¹‰å—" class="headerlink" title="è‡ªå®šä¹‰å—"></a>è‡ªå®šä¹‰å—</h3><p>ç®€è¦æ€»ç»“ä¸€ä¸‹æ¯ä¸ªå—å¿…é¡»æä¾›çš„åŸºæœ¬åŠŸèƒ½ï¼š</p><ol><li>å°†è¾“å…¥æ•°æ®ä½œä¸ºå…¶æ­£å‘ä¼ æ’­å‡½æ•°çš„å‚æ•°ï¼Œå¹¶é€šè¿‡æ­£å‘ä¼ æ’­å‡½æ•°æ¥ç”Ÿæˆè¾“å‡º</li><li>è®¡ç®—å…¶è¾“å‡ºå…³äºè¾“å…¥çš„æ¢¯åº¦ï¼Œå¯é€šè¿‡å…¶åå‘ä¼ æ’­å‡½æ•°è¿›è¡Œè®¿é—®ã€‚é€šå¸¸è¿™æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„</li><li>å­˜å‚¨å’Œè®¿é—®æ­£å‘ä¼ æ’­è®¡ç®—æ‰€éœ€çš„å‚æ•°ï¼Œå¹¶èƒ½æ ¹æ®éœ€è¦åˆå§‹åŒ–æ¨¡å‹å‚æ•°</li></ol><p>ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„çº¿æ€§æ¨¡å—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyLinear</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_units<span class="token punctuation">,</span> units<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>weight <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>in_units<span class="token punctuation">,</span> units<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bias <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>units<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        linear <span class="token operator">=</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data        <span class="token keyword">return</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>linear<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é™¤äº†è‡ªå®šä¹‰å¸¦å‚æ•°çš„å±‚å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰ä¸å¸¦å‚æ•°çš„æ¨¡å—ï¼Œè¿™æ ·å¯ä»¥æ›´è½»æ¾åœ°åŠ å…¥åˆ°å…¶ä»–æ¨¡å—å½“ä¸­ï¼Œä¾‹å¦‚å¯ä»¥å°†æŸå¤±å‡½æ•°å†™ä¸ºä¸€ä¸ªæ¨¡å—åŠ å…¥åˆ° <code>nn.Sequential</code> ä¸­</p><h3 id="é¡ºåºå—"><a href="#é¡ºåºå—" class="headerlink" title="é¡ºåºå—"></a>é¡ºåºå—</h3><p><code>nn.Sequential</code> æä¾›äº†ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li>å°†å—é€ä¸ªè¿½åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œåœ¨ä¹‹åèƒ½å¤Ÿé€šè¿‡ index è®¿é—®ï¼Œä¸€èˆ¬çš„æ¨¡å—ä¸èƒ½é€šè¿‡ index è®¿é—®å…¶å­æ¨¡å—ï¼Œè€Œæ˜¯é€šè¿‡å±æ€§çš„æ–¹å¼è®¿é—®å­æ¨¡å—</li><li>åœ¨æ­£å‘ä¼ æ’­æ—¶ï¼Œå°†è¾“å…¥æŒ‰é¡ºåºä¼ é€’ç»™å—ç»„æˆé“¾æ¡</li></ol><p>æ•™æä¸­çš„ç®€æ˜“å®ç°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MySequential</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> block <span class="token keyword">in</span> args<span class="token punctuation">:</span>            <span class="token comment"># è¿™é‡Œï¼Œ`block`æ˜¯`Module`å­ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æˆ‘ä»¬æŠŠå®ƒä¿å­˜åœ¨'Module'ç±»çš„æˆå‘˜å˜é‡</span>            <span class="token comment"># `_modules` ä¸­ã€‚`block`çš„ç±»å‹æ˜¯OrderedDictã€‚</span>            self<span class="token punctuation">.</span>_modules<span class="token punctuation">[</span>block<span class="token punctuation">]</span> <span class="token operator">=</span> block    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># OrderedDictä¿è¯äº†æŒ‰ç…§æˆå‘˜æ·»åŠ çš„é¡ºåºéå†å®ƒä»¬</span>        <span class="token keyword">for</span> block <span class="token keyword">in</span> self<span class="token punctuation">.</span>_modules<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            X <span class="token operator">=</span> block<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        <span class="token keyword">return</span> X<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æœ€åçš„ç»ƒä¹ ä¸­æœ‰æé—®ï¼šå¦‚æœæŠŠ <code>self._modules</code> æ¢ä¸ºæ™®é€šçš„ python åˆ—è¡¨æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå›ç­”ï¼šä½¿ç”¨ <code>self._modules</code> å°†ä¼šæŠŠè¿™äº›å­æ¨¡å—æ³¨å†Œåˆ°æ¨¡å—ä¸­ï¼Œè¿™æ˜¯ <code>nn.Module</code> çš„é‡è¦å±æ€§ä¹‹ä¸€ã€‚å½“åœ¨å…¶ä»–æ¨¡å—ä½¿ç”¨è¯¥ <code>MySequential</code> æ—¶ï¼Œè¿™äº›å­æ¨¡å—åŒæ ·ä¹Ÿä¼šè¢«è¯†åˆ«ï¼Œå¹¶é€’å½’åœ°æ³¨å†Œåˆ°è¯¥æ¨¡å—ä¸­ã€‚è€Œæ™®é€šçš„ python list ç±»æ— æ³•åšåˆ°</p><h3 id="åµŒå¥—å—"><a href="#åµŒå¥—å—" class="headerlink" title="åµŒå¥—å—"></a>åµŒå¥—å—</h3><p>å¯ä»¥ç›´æ¥é€šè¿‡ <code>add_module(key, module)</code> æ–¹æ³•åŠ å…¥å­æ¨¡å—ï¼Œæ‰€æœ‰æ·»åŠ å­æ¨¡å—çš„æœ¬è´¨éƒ½æ˜¯å‘ <code>self._module</code> OrderedDict ä¸­æ³¨å†Œæ–°çš„ name: module pair</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">block1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                         nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">block2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># åœ¨è¿™é‡ŒåµŒå¥—</span>        net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'block </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> block1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> netrgnet <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>block2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åœ¨æ­£å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡Œä»£ç "><a href="#åœ¨æ­£å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡Œä»£ç " class="headerlink" title="åœ¨æ­£å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡Œä»£ç "></a>åœ¨æ­£å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡Œä»£ç </h3><p>å¯ä»¥åœ¨ <code>forward()</code> å‡½æ•°ä¸­ä»»æ„æ‰§è¡Œä½ å¸Œæœ›çš„è¿‡ç¨‹ã€‚åœ¨åå‘ä¼ æ’­çš„è¿‡ç¨‹ä¸­åªä¼šæ›´æ–°æ¨¡å—ä¸­çš„å‚æ•°ï¼Œå¦‚ä¸‹é¢çš„ <code>self.rand_weight</code> å°±ä¸ä¼šè¢«æ›´æ–°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">FixedHiddenMLP</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># ä¸è®¡ç®—æ¢¯åº¦çš„éšæœºæƒé‡å‚æ•°ã€‚å› æ­¤å…¶åœ¨è®­ç»ƒæœŸé—´ä¿æŒä¸å˜ã€‚</span>        self<span class="token punctuation">.</span>rand_weight <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        <span class="token comment"># ä½¿ç”¨åˆ›å»ºçš„å¸¸é‡å‚æ•°ä»¥åŠ`relu`å’Œ`dot`å‡½æ•°ã€‚</span>        X <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>rand_weight<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># å¤ç”¨å…¨è¿æ¥å±‚ã€‚è¿™ç›¸å½“äºä¸¤ä¸ªå…¨è¿æ¥å±‚å…±äº«å‚æ•°ã€‚</span>        X <span class="token operator">=</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        <span class="token keyword">return</span> X<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚æ•°ç®¡ç†"><a href="#å‚æ•°ç®¡ç†" class="headerlink" title="å‚æ•°ç®¡ç†"></a>å‚æ•°ç®¡ç†</h2><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>è®¿é—®å‚æ•°ï¼Œç”¨äºè°ƒè¯•ã€è¯Šæ–­å’Œå¯è§†åŒ–</li><li>å‚æ•°åˆå§‹åŒ–</li><li>åœ¨ä¸åŒæ¨¡å‹ç»„ä»¶é—´å…±äº«å‚æ•°</li></ul><h3 id="å‚æ•°è®¿é—®"><a href="#å‚æ•°è®¿é—®" class="headerlink" title="å‚æ•°è®¿é—®"></a>å‚æ•°è®¿é—®</h3><p>é€šè¿‡ <code>state_dict()</code> æŸ¥çœ‹ç½‘ç»œå±‚å‚æ•°çš„ <code>OrderedDict</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nnnet <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>X <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># OrderedDict([('weight', tensor([[-0.1280,  0.3443,  0.0572, -0.1925,  0.3084, -0.2585,  0.1038,  0.0608]])), ('bias', tensor([0.1917]))])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ç±»å±æ€§è®¿é—®å‚æ•°ï¼Œå¹¶è¿›ä¸€æ­¥è®¿é—®è¯¥å‚æ•°çš„å€¼</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bias<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token comment"># tensor([-0.1373], requires_grad=True)</span><span class="token comment"># tensor([-0.1373])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ <code>named_parameters()</code> ä¹Ÿå¯ä»¥è®¿é—®æ‰€æœ‰å‚æ•°çš„åå­—å’Œå‚æ•°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œé€šè¿‡å¾ªç¯å¯éå†æ‰€æœ‰å‚æ•°ï¼Œä»¥ <code>(name, param)</code> å…ƒç»„å½¢å¼ä¸ºè¿”å›å€¼</p><h3 id="å‚æ•°åˆå§‹åŒ–"><a href="#å‚æ•°åˆå§‹åŒ–" class="headerlink" title="å‚æ•°åˆå§‹åŒ–"></a>å‚æ•°åˆå§‹åŒ–</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyTorchä¼šæ ¹æ®ä¸€ä¸ªèŒƒå›´å‡åŒ€åœ°åˆå§‹åŒ–æƒé‡å’Œåç½®çŸ©é˜µï¼Œè¿™ä¸ªèŒƒå›´æ˜¯æ ¹æ®è¾“å…¥å’Œè¾“å‡ºç»´åº¦è®¡ç®—å‡ºçš„ã€‚PyTorchçš„ <code>nn.init</code> æ¨¡å—æä¾›äº†å¤šç§é¢„ç½®åˆå§‹åŒ–æ–¹æ³•ï¼Œå…¶æœ¬è´¨æ˜¯å¯¹ <code>module.weight</code> è¿›è¡Œèµ‹å€¼</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">xavier</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">:</span>        nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>xavier_uniform_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">init_42</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">:</span>        nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>xavier<span class="token punctuation">)</span>net<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>init_42<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‚æ•°ç»‘å®š"><a href="#å‚æ•°ç»‘å®š" class="headerlink" title="å‚æ•°ç»‘å®š"></a>å‚æ•°ç»‘å®š</h3><p>æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åœ¨å¤šä¸ªå±‚é—´å…±äº«å‚æ•°ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä¼˜é›…åœ°åšè¿™ä»¶äº‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># æˆ‘ä»¬éœ€è¦ç»™å…±äº«å±‚ä¸€ä¸ªåç§°ï¼Œä»¥ä¾¿å¯ä»¥å¼•ç”¨å®ƒçš„å‚æ•°ã€‚</span>shared <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    shared<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    shared<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨åå‘ä¼ æ’­æ—¶ï¼Œè¿™ä¸¤ä¸ªéšè—å±‚çš„æ¢¯åº¦å°†ä¼šåŠ åœ¨ä¸€èµ·</p><h2 id="è¯»å†™æ–‡ä»¶"><a href="#è¯»å†™æ–‡ä»¶" class="headerlink" title="è¯»å†™æ–‡ä»¶"></a>è¯»å†™æ–‡ä»¶</h2><p>ç°åœ¨æ˜¯æ—¶å€™å­¦ä¹ å¦‚ä½•åŠ è½½å’Œå­˜å‚¨æƒé‡å‘é‡å’Œæ•´ä¸ªæ¨¡å‹</p><h3 id="åŠ è½½å’Œä¿å­˜å¼ é‡"><a href="#åŠ è½½å’Œä¿å­˜å¼ é‡" class="headerlink" title="åŠ è½½å’Œä¿å­˜å¼ é‡"></a>åŠ è½½å’Œä¿å­˜å¼ é‡</h3><p>å¯ä»¥ç›´æ¥è°ƒç”¨ <code>load</code> å’Œ <code>save</code> å‡½æ•°ï¼Œä»¥è¯»å†™å„ç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬ Pytorch æ¨¡å‹ï¼ˆæ¨¡å‹åŒ…å« <code>state_dict</code> å³å‚æ•°ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> functional <span class="token keyword">as</span> Fx <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'x-file'</span><span class="token punctuation">)</span>x2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'x-file'</span><span class="token punctuation">)</span><span class="token comment"># å¯ä»¥å­˜å‚¨å„ç§çš„æ•°æ®ç±»å‹</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'x-files'</span><span class="token punctuation">)</span>x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'x-files'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŠ è½½å’Œä¿å­˜æ¨¡å‹å‚æ•°"><a href="#åŠ è½½å’Œä¿å­˜æ¨¡å‹å‚æ•°" class="headerlink" title="åŠ è½½å’Œä¿å­˜æ¨¡å‹å‚æ•°"></a>åŠ è½½å’Œä¿å­˜æ¨¡å‹å‚æ•°</h3><p>ä»…ä»…ä¿å­˜å‚æ•°ï¼Œå¹¶å°†ä¿å­˜çš„å‚æ•°åŠ è½½åˆ°æ–°å»ºçš„æ¨¡å‹ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å‡è®¾å®šä¹‰äº†ä¸€ä¸ªæ¨¡å‹</span><span class="token keyword">class</span> <span class="token class-name">MLP</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>net <span class="token operator">=</span> MLP<span class="token punctuation">(</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>net<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'mlp.params'</span><span class="token punctuation">)</span><span class="token comment"># æ–°å»ºæ¨¡å‹å¹¶åŠ è½½å‚æ•°</span>clone <span class="token operator">=</span> MLP<span class="token punctuation">(</span><span class="token punctuation">)</span>clone<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'mlp.params'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h2><p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šç”¨äºå­˜å‚¨å’Œè®¡ç®—çš„è®¾å¤‡ï¼Œå¦‚CPUå’ŒGPUã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¼ é‡æ˜¯åœ¨å†…å­˜ä¸­åˆ›å»ºçš„ï¼Œç„¶åä½¿ç”¨CPUè®¡ç®—å®ƒï¼Œpytorch ä¸­ä¸ GPU ç›¸å…³çš„åŒ…ä¸º <code>torch.cuda</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token comment"># è·å¾— GPU è®¾å¤‡ï¼Œè¿”å›å€¼ä¸ºå­—ç¬¦ä¸² 'cpu' or 'cuda' or f'cuda:{idx}'</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">)</span><span class="token comment"># equals torch.device('cuda:0')</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda:1'</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>device_count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># GPU æ•°é‡</span>torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># GPU æ˜¯å¦å¯ç”¨</span>torch<span class="token punctuation">.</span>version<span class="token punctuation">.</span>cuda<span class="token comment"># cuda ç‰ˆæœ¬</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹å¼ é‡æ‰€åœ¨è®¾å¤‡ï¼Œå¹¶æ›´æ”¹æ‰€åœ¨è®¾å¤‡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>device<span class="token punctuation">)</span><span class="token comment"># cpu</span><span class="token comment"># å°† x ç§»åˆ° GPU ä¸Š</span>x <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">)</span><span class="token comment"># equals x = x.cuda()</span><span class="token comment"># net æ˜¯ä¸€ä¸ª Moduleï¼Œå°†å…¶å‚æ•°ç§»åŠ¨åˆ° GPU ä¸Š</span>net<span class="token punctuation">.</span>to<span class="token punctuation">(</span>x<span class="token punctuation">.</span>device<span class="token punctuation">)</span><span class="token comment"># net.cuda()</span><span class="token comment"># æŸ¥çœ‹ç½‘ç»œçš„å‚æ•°æ˜¯å¦åœ¨ GPU ä¸Š</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>device<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼š</p><ol><li>è®¡ç®—éœ€è¦åœ¨åŒä¸€ä¸ªè®¾å¤‡ä¸Šè¿›è¡Œï¼Œå³æ¨¡å‹å’Œæ•°æ®éœ€è¦åœ¨åŒä¸€ä¸ª GPU æˆ–è€… CPU ä¸Šè¿›è¡Œè®¡ç®—</li><li><code>to(device)</code> å¯¹äºå¼ é‡ä¸æ˜¯ä¸€ä¸ª inplace æ“ä½œï¼Œè€Œå¯¹äºæ¨¡å‹æ¥è¯´æ˜¯ä¸€ä¸ª inplace æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºå¼ é‡éœ€è¦ä½¿ç”¨ <code>x = x.to()</code> æ¥ä½¿æ”¹å˜çœŸæ­£ç”Ÿæ•ˆ</li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 04 å¤šå±‚æ„ŸçŸ¥æœº</title>
      <link href="/archives/fc6001ca.html"/>
      <url>/archives/fc6001ca.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-04-å¤šå±‚æ„ŸçŸ¥æœº"><a href="#D2L-04-å¤šå±‚æ„ŸçŸ¥æœº" class="headerlink" title="D2L 04 å¤šå±‚æ„ŸçŸ¥æœº"></a>D2L 04 å¤šå±‚æ„ŸçŸ¥æœº</h1><h2 id="å¤šå±‚æ„ŸçŸ¥æœº"><a href="#å¤šå±‚æ„ŸçŸ¥æœº" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœº"></a>å¤šå±‚æ„ŸçŸ¥æœº</h2><p>çº¿æ€§æ¨¡å‹çš„è¡¨ç¤ºèƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œå¦‚æœåŠ å…¥éšè—å±‚å’Œéçº¿æ€§è¿ç®—ï¼Œæ¨¡å‹çš„è¡¨ç¤ºèƒ½åŠ›å°†å¤§å¤§å¢åŠ ã€‚äº‹å®ä¸Šå¦‚æœéšè—å±‚çš„èŠ‚ç‚¹è¶³å¤Ÿå¤šï¼Œæ¨¡å‹å°†èƒ½å¤Ÿæ‹Ÿåˆä»»æ„çš„è¿ç»­å‡½æ•° $f(Â·)$ï¼Œè¿™å°±æ˜¯ä¸‡èƒ½/é€šç”¨è¿‘ä¼¼ universal approximation</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.bilibili.com/video/BV1Hh411Q7p4">bilibili</a> <a href="http://neuralnetworksanddeeplearning.com/chap4.html">link</a> ç›´è§‚ç®€è¿°äº†ä¸ºä»€ä¹ˆ hidden layer + ReLU èƒ½å¤Ÿæ‹Ÿåˆä»»æ„è¿ç»­å‡½æ•°ï¼Œçœ‹å®Œå°±æœ‰æ„Ÿè§‰äº†</p><h3 id="Pytorch-å®ç°"><a href="#Pytorch-å®ç°" class="headerlink" title="Pytorch å®ç°"></a>Pytorch å®ç°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dataloader <span class="token keyword">import</span> DataLoader<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sampler <span class="token keyword">import</span> SubsetRandomSampler<span class="token keyword">from</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">import</span> SGD<span class="token keyword">from</span> utils <span class="token keyword">import</span> get_dataset<span class="token punctuation">,</span> traintrain_dataset <span class="token operator">=</span> get_dataset<span class="token punctuation">(</span>train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>test_dataset <span class="token operator">=</span> get_dataset<span class="token punctuation">(</span>train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>data <span class="token operator">=</span> train_dataset<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  MLP <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>    nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">28</span><span class="token operator">*</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>batch_size<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> num_epochs <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">10</span>loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>optim <span class="token operator">=</span> SGD<span class="token punctuation">(</span>MLP<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>lr<span class="token punctuation">)</span>NUM <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_dataset<span class="token punctuation">)</span>sampler <span class="token operator">=</span> SubsetRandomSampler<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>NUM<span class="token punctuation">)</span><span class="token punctuation">)</span>train_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>train_dataset<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> sampler<span class="token operator">=</span>sampler<span class="token punctuation">)</span>train<span class="token punctuation">(</span>MLP<span class="token punctuation">,</span> train_loader<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> optim<span class="token punctuation">,</span> loss<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª utils æ–‡ä»¶ï¼ŒåŒ…å«ä¸€äº›å¸¸è§„åŠŸèƒ½ï¼Œè¿™é‡Œä¸è´´å‡ºæ¥äº†</p><h2 id="æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ"><a href="#æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ" class="headerlink" title="æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ"></a>æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ</h2><h3 id="è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®"><a href="#è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®" class="headerlink" title="è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®"></a>è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®</h3><p>å°†æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šæ‹Ÿåˆå¾—æ¯”åœ¨æ½œåœ¨åˆ†å¸ƒä¸­æ›´æ¥è¿‘çš„ç°è±¡ç§°ä¸ºè¿‡æ‹Ÿåˆï¼ˆoverfittingï¼‰ï¼Œç”¨äºå¯¹æŠ—è¿‡æ‹Ÿåˆçš„æŠ€æœ¯ç§°ä¸ºæ­£åˆ™åŒ–ï¼ˆregularizationï¼‰</p><p>ä¸ºäº†è¿›ä¸€æ­¥è®¨è®ºè¿™ä¸€ç°è±¡ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®ã€‚è®­ç»ƒè¯¯å·®ï¼ˆtraining errorï¼‰æ˜¯æŒ‡ï¼Œæˆ‘ä»¬çš„æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šè®¡ç®—å¾—åˆ°çš„è¯¯å·®ã€‚æ³›åŒ–è¯¯å·®ï¼ˆgeneralization errorï¼‰æ˜¯æŒ‡ï¼Œå½“æˆ‘ä»¬å°†æ¨¡å‹åº”ç”¨åœ¨åŒæ ·ä»åŸå§‹æ ·æœ¬çš„åˆ†å¸ƒä¸­æŠ½å–çš„æ— é™å¤šçš„æ•°æ®æ ·æœ¬æ—¶ï¼Œæˆ‘ä»¬æ¨¡å‹è¯¯å·®çš„æœŸæœ›</p><p>åœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡å°†æ¨¡å‹åº”ç”¨äºä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•é›†æ¥ä¼°è®¡æ³›åŒ–è¯¯å·®ï¼Œè¯¥æµ‹è¯•é›†ç”±éšæœºé€‰å–çš„ã€æœªæ›¾åœ¨è®­ç»ƒé›†ä¸­å‡ºç°çš„æ•°æ®æ ·æœ¬æ„æˆ</p><h3 id="è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"><a href="#è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ" class="headerlink" title="è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ"></a>è¿‡æ‹Ÿåˆå’Œæ¬ æ‹Ÿåˆ</h3><p>æ¬ æ‹Ÿåˆæ˜¯æŒ‡æ¨¡å‹æ— æ³•ç»§ç»­å‡å°‘è®­ç»ƒè¯¯å·®ã€‚è¿‡æ‹Ÿåˆæ˜¯æŒ‡è®­ç»ƒè¯¯å·®è¿œå°äºéªŒè¯è¯¯å·®</p><p>ä¸€èˆ¬æ¥è®²æ¨¡å‹è¶Šå¤æ‚ï¼Œè®­ç»ƒé›†è¶Šç®€å•ï¼Œè¶Šå®¹æ˜“è¿‡æ‹Ÿåˆã€‚æ•™æä½¿ç”¨äº†å¤šé¡¹å¼å›å½’æ¥ç®€è¦è¯´æ˜äº†è¿™ä¸€ç°è±¡ï¼šä½¿ç”¨æ›´é«˜é˜¶çš„å¤šé¡¹å¼ï¼Œé€šè¿‡å‚æ•°è°ƒæ•´ï¼Œå¾ˆå®¹æ˜“ï¼ˆè¿‡ï¼‰æ‹Ÿåˆä¸€ä¸ªå‡½æ•°</p><h3 id="åˆ©ç”¨éªŒè¯é›†è¿›è¡Œæ¨¡å‹é€‰æ‹©"><a href="#åˆ©ç”¨éªŒè¯é›†è¿›è¡Œæ¨¡å‹é€‰æ‹©" class="headerlink" title="åˆ©ç”¨éªŒè¯é›†è¿›è¡Œæ¨¡å‹é€‰æ‹©"></a>åˆ©ç”¨éªŒè¯é›†è¿›è¡Œæ¨¡å‹é€‰æ‹©</h3><p>ä¸ºäº†ç¡®å®šå€™é€‰æ¨¡å‹ä¸­çš„æœ€ä½³æ¨¡å‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨éªŒè¯é›†ã€‚è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæµè¡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨ K æŠ˜äº¤å‰éªŒè¯ã€‚é€šè¿‡å¯¹ K æ¬¡å®éªŒçš„ç»“æœå–å¹³å‡æ¥ä¼°è®¡è®­ç»ƒå’ŒéªŒè¯è¯¯å·®</p><h2 id="æƒé‡è¡°å‡"><a href="#æƒé‡è¡°å‡" class="headerlink" title="æƒé‡è¡°å‡"></a>æƒé‡è¡°å‡</h2><h3 id="L2-æ­£åˆ™åŒ–"><a href="#L2-æ­£åˆ™åŒ–" class="headerlink" title="L2 æ­£åˆ™åŒ–"></a>L2 æ­£åˆ™åŒ–</h3><p>æƒé‡è¡°å‡ï¼ˆé€šå¸¸ç§°ä¸º L2 æ­£åˆ™åŒ–ï¼‰æ˜¯æœ€å¹¿æ³›ä½¿ç”¨çš„æ­£åˆ™åŒ–çš„æŠ€æœ¯ä¹‹ä¸€</p><p>è¦ä¿è¯æƒé‡â€èŒƒå›´â€æ¯”è¾ƒå°ï¼Œæœ€å¸¸ç”¨æ–¹æ³•æ˜¯å°†å…¶èŒƒæ•°ä½œä¸ºæƒ©ç½šé¡¹åŠ åˆ°æœ€å°åŒ–æŸå¤±çš„é—®é¢˜ä¸­ã€‚åŸæ¥çš„è®­ç»ƒç›®æ ‡æœ€å°åŒ–è®­ç»ƒæ ‡ç­¾ä¸Šçš„é¢„æµ‹æŸå¤±ï¼Œè°ƒæ•´ä¸ºæœ€å°åŒ–é¢„æµ‹æŸå¤±å’Œæƒ©ç½šé¡¹ä¹‹å’Œ</p><p>æˆ‘ä»¬é€šè¿‡æ­£åˆ™åŒ–å¸¸æ•° Î» æ¥æè¿°è¿™ç§æƒè¡¡ï¼Œè¿™æ˜¯ä¸€ä¸ªéè´Ÿè¶…å‚æ•°ï¼Œä¸‹é¢æ˜¯ L2 æ­£åˆ™åŒ–ä¸‹çš„æŸå¤±å‡½æ•°</p><p><img src="/archives/fc6001ca/image-20211122191124428.png" style="zoom:80%;"></p><p>å¦‚ä¸Šå½¢å¼çš„æ­£åˆ™åŒ–æœ‰å‡ ä¸ªå¥½å¤„ï¼š</p><ol><li><p>ä¾¿äºè®¡ç®—ï¼Œæ²¡æœ‰æ ¹å·</p></li><li><p>ä½¿å¾—ä¼˜åŒ–ç®—æ³•åå‘äºç”Ÿæˆåœ¨å¤§é‡ç‰¹å¾ä¸Šå‡åŒ€åˆ†å¸ƒæƒé‡çš„æ¨¡å‹ï¼Œè€ƒè™‘ä¸‹é¢çš„ä¼˜åŒ–é—®é¢˜ï¼Œå¯ä»¥ç®€å•ç†è§£ä»€ä¹ˆæ˜¯â€œå‡åŒ€åˆ†å¸ƒâ€</p><script type="math/tex; mode=display">min \ \sum w_i^2 \\s.t. \sum w_i = const</script></li></ol><p>åœ¨å®ä¾‹åŒ–ä¼˜åŒ–å™¨æ—¶ç›´æ¥é€šè¿‡ <code>weight_decay</code> æŒ‡å®š weight decay è¶…å‚æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyTorch åŒæ—¶è¡°å‡æƒé‡å’Œåç§»ã€‚è¿™é‡Œæˆ‘ä»¬åªä¸ºæƒé‡è®¾ç½®äº† <code>weight_decay</code>ï¼Œæ‰€ä»¥ bias å‚æ•°ä¸ä¼šè¡°å‡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">num_inputs <span class="token operator">=</span> <span class="token number">784</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    param<span class="token punctuation">.</span>data<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span><span class="token punctuation">)</span>    loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>num_epochs<span class="token punctuation">,</span> lr <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0.003</span>wd <span class="token operator">=</span> <span class="token number">3</span><span class="token comment"># åç½®å‚æ•°æ²¡æœ‰è¡°å‡ã€‚</span>trainer <span class="token operator">=</span> SGD<span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token punctuation">{</span><span class="token string">"params"</span><span class="token punctuation">:</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">,</span><span class="token string">'weight_decay'</span><span class="token punctuation">:</span> wd<span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span><span class="token string">"params"</span><span class="token punctuation">:</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bias<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>lr<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'wçš„L2èŒƒæ•°ï¼š'</span><span class="token punctuation">,</span> net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li>Pytorch ä¼˜åŒ–å™¨å¯ä»¥å¯¹æ¨¡å‹ä¸­æŒ‡å®šå‚æ•°è¿›è¡Œæƒé‡è¡°å‡ï¼Œä½¿ç”¨ä¸€ä¸ªå­—å…¸ç»„æˆçš„åˆ—è¡¨å³å¯ <a href="https://pytorch.org/docs/stable/optim.html">torch.optim</a></li></ol><h3 id="è¡¥å……ï¼šL1-æ­£åˆ™åŒ–ä¸ç¨€ç–å‚æ•°"><a href="#è¡¥å……ï¼šL1-æ­£åˆ™åŒ–ä¸ç¨€ç–å‚æ•°" class="headerlink" title="è¡¥å……ï¼šL1 æ­£åˆ™åŒ–ä¸ç¨€ç–å‚æ•°"></a>è¡¥å……ï¼šL1 æ­£åˆ™åŒ–ä¸ç¨€ç–å‚æ•°</h3><p>ä»å‡¸ä¼˜åŒ–çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨å¼ºå¯¹å¶æ¡ä»¶ä¸‹ï¼Œç»™å®šæœ€ä¼˜çš„æ­£åˆ™åŒ–è¶…å‚ Î»*ï¼Œåœ¨åŸå‡½æ•°åŠ å…¥æƒ©ç½šé¡¹å’Œç»™å‚æ•°åŠ çº¦æŸæ˜¯ç­‰ä»·çš„</p><script type="math/tex; mode=display">min\ f(x) \ s.t. \ m(x) \le 0\\\Leftrightarrow min \ L(x, \lambda^*)</script><h2 id="Dropout"><a href="#Dropout" class="headerlink" title="Dropout"></a>Dropout</h2><p>è¿™ä¸€éƒ¨åˆ†çš„æ•™æè®²çš„å¾—æ¯”è¾ƒæ¨¡ç³Šâ€¦ä¸è¯´äº†ç›´æ¥å» <a href="https://www.bilibili.com/video/BV1Y5411c7aY?p=1&amp;t=692">bilibili</a> çœ‹å¤§ä½¬è®²è¯¾ï¼æ€»ç»“æ¥è¯´ï¼š</p><ol><li>Dropout è¢«çœ‹ä½œä¸€é¡¹æ­£åˆ™åŒ–æŠ€æœ¯ï¼Œç»™æ¨¡å‹åŠ å…¥å™ªå£°</li><li>Dropout å°†ä¸€äº›è¾“å‡ºé¡¹éšæœºç½®0ï¼Œå¸¸ä½œç”¨åœ¨ MLP çš„éšè—å±‚è¾“å‡ºä¸Šï¼Œå…¶ä¸­ä¸¢å¼ƒæ¦‚ç‡ p ä¸ºè¶…å‚</li><li>æ•™æé€‰æ‹©åœ¨ Dropout è¾“å‡ºçš„æ—¶å€™é™¤ä»¥ (1 - p) ä»¥ä¿è¯æœŸæœ›ä¸å˜ã€‚åœ¨ cs231n è¯¾ç¨‹ä¸­æ˜¯é€‰æ‹©åœ¨æµ‹è¯•çš„æ—¶å€™å¯¹è¾“å‡ºä¹˜ä»¥ (1 - p) ä»¥ä¿æŒæœŸæœ›ä¸å˜ï¼ŒäºŒè€…åº”è¯¥æ˜¯ç­‰ä»·çš„</li></ol><p>æ³¨æ„ï¼šDropout å’Œæƒé‡è¡°å‡éƒ½æ˜¯æ­£åˆ™åŒ–æŠ€æœ¯ï¼Œä»–ä»¬ä»…åœ¨è®­ç»ƒæ—¶ä½¿ç”¨ï¼Œåœ¨æµ‹è¯•æ—¶æ˜¯ä¸ä½¿ç”¨ or ä¸ä¸€æ ·çš„ï¼ŒåŒ…æ‹¬ä¹‹åä¼šä»‹ç»çš„ batch normalization ä¹Ÿæ˜¯ä¸€æ ·çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">dropout1<span class="token punctuation">,</span> dropout2 <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.5</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment"># åœ¨ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚ä¹‹åæ·»åŠ ä¸€ä¸ªdropoutå±‚</span>        nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout1<span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment"># åœ¨ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚ä¹‹åæ·»åŠ ä¸€ä¸ªdropoutå±‚</span>        nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>dropout2<span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ­£å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾"><a href="#æ­£å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾" class="headerlink" title="æ­£å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾"></a>æ­£å‘ä¼ æ’­ã€åå‘ä¼ æ’­å’Œè®¡ç®—å›¾</h2><p>å¯¹äºè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘è®¤ä¸ºéœ€è¦æ›´æ‰å®çš„çŸ©é˜µè®ºçš„çŸ¥è¯†ï¼Œå°¤å…¶æ˜¯å¯¹äºçŸ©é˜µ/å¼ é‡æ±‚å¯¼çš„è¡¨ç¤ºï¼Œçœ‹åœ¨ä¹‹åèƒ½ä¸èƒ½å¡«ä¸Šè¿™éƒ¨åˆ†</p><p>å½“ç„¶ç®€å•çš„ç»“è®ºæ˜¯èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå‰è¿›çš„ï¼Œä¸‹é¢ç»™å‡ºçŸ©é˜µä¹˜æ³•çš„åå‘ä¼ æ’­ç»“è®ºï¼ˆåˆ†å­å¼ï¼‰</p><script type="math/tex; mode=display">y \in \mathbb{R}^M, x \in \mathbb{R}^N, W \in \mathbb{R}^{M\times N} \\y=WÂ·x, \frac{\partial{L}}{\partial y} = d_y^T\\\text{we have } \frac{\partial L}{\partial W}=xd_y^T\\\text{and } \frac{\partial L}{\partial x}=d_y^TW</script><p>å…¶å®é™¤äº†çŸ©é˜µä¹˜æ³•çš„æ±‚å¯¼æ¯”è¾ƒé™Œç”Ÿï¼Œå…¶ä»–è¿ç®—çš„æ±‚å¯¼ä»¥åŠé“¾å¼æ³•åˆ™åº”è¯¥éƒ½ç›¸å¯¹ç†Ÿæ‚‰ï¼Œä¸åˆé«˜ä¸­é‡åˆ°çš„é—®é¢˜æ˜¯ç›¸ä¼¼çš„</p><p>å‡ ä¸ªå…³äºçŸ©é˜µæ±‚å¯¼çš„å‚è€ƒé“¾æ¥ï¼š<a href="https://www.bilibili.com/video/BV1xk4y1B7RQ?p=4&amp;t=0">bilibili</a> <a href="https://blog.csdn.net/nomadlx53/article/details/50849941#commentBox">CSDN</a> <a href="https://en.wikipedia.org/wiki/Matrix_calculus#Scalar-by-matrix">wiki Matrix calculus</a></p><p>è¿™é‡Œæ€»ç»“å‡ ä¸ªåŸºæœ¬æ³•åˆ™ï¼š</p><ol><li>åœ¨æ±‚å¯¼ä¹‹å‰ä¸€å®šè¦ç¡®å®šæ˜¯åˆ†å­å¼è¿˜æ˜¯åˆ†æ¯å¼ï¼Œçœ‹ä¸ªäººé€‰æ‹©ï¼Œæ¨èåˆ†å­å¼ï¼Œæ›´ç¬¦åˆå¹³æ—¶æ±‚å¯¼çš„ç›´è§‰</li><li>æœ€é‡è¦çš„å®šå¾‹è«è¿‡äºä¹˜æ³•æ±‚å¯¼æ³•åˆ™ <a href="https://en.wikipedia.org/wiki/Product_rule">product rule</a> ä»¥åŠé“¾å¼æ±‚å¯¼æ³•åˆ™ <a href="https://en.wikipedia.org/wiki/Chain_rule">chain rule</a>ã€‚å¦‚æœä¹ æƒ¯æŒ‰ç…§åˆ†æ¯å¼æ±‚å¯¼ï¼Œé‚£ä¹ˆé“¾å¼æ±‚å¯¼æ—¶é¡ºåºè¦å€’è¿‡æ¥ï¼Œå¹¶ä¸”å¸¸æ•°åœ¨æå‡ºæ¥æ—¶åº”è¯¥æ”¾åœ¨åé¢å¹¶ä¸”è½¬ç½®  </li><li>å†æ¥çœ‹ä¸Šé¢å¾—å‡ºçš„ç»“è®ºï¼Œå¯¹äº x çš„æ±‚å¯¼å˜å¾—ç›¸å¯¹å®¹æ˜“ï¼Œä½†å¯¹äº W çš„æ±‚å¯¼è¿˜æ˜¯æœ‰ç‚¹å¤æ‚ï¼Œå› ä¸ºæ˜¯å¯¹äºçŸ©é˜µæ±‚å¯¼ã€‚å…¶ä¸­ä¼šé‡åˆ° vector by matrix çš„æƒ…å†µï¼Œè¿™è¯¥æ€ä¹ˆå¤„ç†ï¼Ÿäº‹å®ä¸Šï¼Œè¿™ç§æƒ…å†µéœ€è¦å°† upper gradient or unit 1 vector ä¸éœ€è¦æ±‚å¯¼çš„ vector ç›¸ä¹˜ $\frac{\partial (d_y^TWx)}{\partial W}$ï¼Œå°†å…¶è½¬æ¢ä¸º scalar by matrix</li></ol><p>ä¹‹åå¯ä»¥ç»“åˆ cs231n ä¸­å¯¹ batch normalization çš„åå‘ä¼ æ’­ç»ƒä¹ ä»¥åŠ RNN ä¸­çš„åå‘ä¼ æ’­ç»ƒä¹ æ¥åŠ æ·±ç†Ÿç»ƒåº¦ï¼Œè™½ç„¶ä»–ä»¬éƒ½å¾ˆéš¾ï¼</p><p>ç»è¿‡å¤šæ¬¡çš„æ€»ç»“ï¼Œå…³äºæœºå™¨å­¦ä¹ ä¸­å¸¸ç”¨çš„çŸ©é˜µæ±‚å¯¼è§„å¾‹ï¼ˆä¾ç„¶ä½¿ç”¨åˆ†å­å¼ï¼‰ï¼š</p><ol><li>æ•°ä¹˜æ³•åˆ™<script type="math/tex; mode=display">\text{vector by vector}\\\frac{\partial \mathbf{A} \mathbf{u}}{\partial \mathbf{x}}= \mathbf A \frac{\partial \mathbf u}{\partial \mathbf x}\\\frac{\partial u \mathbf{a}}{\partial \mathbf{x}}= \mathbf a \frac{\partial u}{\partial \mathbf x}\\\\\text{scalar by vector}\\\frac{\partial \mathbf a^T \mathbf{u}}{\partial \mathbf{x}}= \mathbf a^T \frac{\partial \mathbf u}{\partial \mathbf x}</script></li></ol><ol><li><p><strong>ä¹˜æ³•æ³•åˆ™</strong></p><script type="math/tex; mode=display">\text{vector by vector}\\\frac{\partial v \mathbf{u}}{\partial \mathbf{x}}=\quad v \frac{\partial \mathbf{u}}{\partial \mathbf{x}}+\mathbf{u} \frac{\partial v}{\partial \mathbf{x}}\\\\\text{scalar by vector}\\\frac{\partial \mathbf{u}^{\top} \mathbf{v}}{\partial \mathbf{x}}=\mathbf{u}^{\top} \frac{\partial \mathbf{v}}{\partial \mathbf{x}}+\mathbf{v}^{\top} \frac{\partial \mathbf{u}}{\partial \mathbf{x}}</script></li></ol><ol><li>é“¾å¼æ³•åˆ™ã€‚<script type="math/tex; mode=display">\text{vector by vector}\\\frac{\partial \mathbf{f}(\mathbf{g}(\mathbf{u}))}{\partial \mathbf{x}}=\frac{\partial \mathbf{f}(\mathbf{g})}{\partial \mathbf{g}} \frac{\partial \mathbf{g}(\mathbf{u})}{\partial \mathbf{u}} \frac{\partial \mathbf{u}}{\partial \mathbf{x}}\\\\\text{scalar by vector}\\\frac{\partial f(g(u))}{\partial \mathbf{x}}=\frac{\partial f(g)}{\partial g} \frac{\partial g(u)}{\partial u} \frac{\partial u}{\partial \mathbf{x}}</script></li></ol><ol><li>å‘é‡å‡½æ•°ä¸ºé€å…ƒç´ è®¡ç®—ï¼Œæ±‚å¯¼åå˜ä¸ºå¯¹è§’çŸ©é˜µ<script type="math/tex; mode=display">\frac{\partial f(\mathbf x)}{\partial \mathbf x} = diag(f'(\mathbf x))</script></li></ol><ol><li>Scalar by matrixï¼Œä»…ç»™å‡ºä¸‹é¢ä¸€ç§å½¢å¼ï¼Œæ›´é«˜é˜¶çš„å°†ä¸å†è¿›è¡Œè®¨è®º<script type="math/tex; mode=display">\frac{\partial \mathbf{a}^{\top} \mathbf{X} \mathbf{b}}{\partial \mathbf{X}}=\mathbf{b a}^{\top}</script></li></ol><p>æ›´åŠ å®Œå–„çš„çŸ©é˜µæ±‚å¯¼ä½“ç³»å¯ä»¥å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/24709748">çŸ©é˜µæ±‚å¯¼æœ¯</a>ï¼Œå½“ç„¶æˆ‘åˆæ˜¯åœ¨æŒ–å‘äº†ğŸ¤£ï¼Œä»¥åå†æ¥æ•´ç†å§ï¼</p><h2 id="æ•°å€¼ç¨³å®šæ€§å’Œæ¨¡å‹åˆå§‹åŒ–"><a href="#æ•°å€¼ç¨³å®šæ€§å’Œæ¨¡å‹åˆå§‹åŒ–" class="headerlink" title="æ•°å€¼ç¨³å®šæ€§å’Œæ¨¡å‹åˆå§‹åŒ–"></a>æ•°å€¼ç¨³å®šæ€§å’Œæ¨¡å‹åˆå§‹åŒ–</h2><p>åœ¨ MLP çš„æ¨¡å‹ä¸‹ï¼ŒåŠ å…¥æ‰€æœ‰éšè—å˜é‡å’Œè¾“å…¥éƒ½æ˜¯å‘é‡ï¼Œé‚£ä¹ˆæ±‚è§£å…¶ä¸­ä»»ä¸€å‚æ•° W çš„æ¢¯åº¦å°†é¢ä¸´å¦‚ä¸‹çš„è¿‡ç¨‹ï¼ˆæ³¨æ„ä¸‹é¢è¡¨è¾¾å¼ $W^t$ å…¶å®ä¸éœ€è¦è½¬ç½®ï¼‰</p><p><img src="/archives/fc6001ca/image-20211123190427465.png" alt="image-20211123190427465" style="zoom: 50%;"></p><p><img src="/archives/fc6001ca/image-20211123190439856.png" alt="image-20211123190439856" style="zoom: 50%;"></p><p>ä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰å¤šä¸ªçŸ©é˜µè¿›è¡Œè¿ç»­çš„ç›¸ä¹˜ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„åˆå§‹åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¼šé¢ä¸´æ¢¯åº¦çˆ†ç‚¸æˆ–è€…æ¢¯åº¦æ¶ˆå¤±çš„æƒ…å†µã€‚å½“ç„¶è¿™ä¹Ÿè·Ÿæ¿€æ´»å‡½æ•°ç›¸å…³ï¼ŒReLU çš„è®¾è®¡å°†å‡ç¼“éƒ¨åˆ†æ¢¯åº¦æ¶ˆå¤±æƒ…å†µ</p><h2 id="å‚æ•°åˆå§‹åŒ–"><a href="#å‚æ•°åˆå§‹åŒ–" class="headerlink" title="å‚æ•°åˆå§‹åŒ–"></a>å‚æ•°åˆå§‹åŒ–</h2><p>åˆå§‹å‚æ•°è¿‡å¤§ã€è¿‡å°ä¼šå¼•èµ·æ¢¯åº¦çˆ†ç‚¸/æ¶ˆå¤±ï¼Œåˆå§‹å‚æ•°å…¨éƒ¨å–ç›¸åŒå€¼ä¹Ÿä¼šå¯¼è‡´ä¼˜åŒ–æ—¶æ‰€æœ‰å‚æ•°æ›´æ–°çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼ˆMLP æ¨¡å‹ä¸‹ï¼‰</p><p>ä½¿ç”¨æ­£æ€åˆ†å¸ƒæ¥åˆå§‹åŒ–æƒé‡å€¼ï¼Œå¯¹äºä¸­ç­‰è§„æ¨¡çš„é—®é¢˜é€šå¸¸å¾ˆæœ‰æ•ˆã€‚æ•™æè¿˜ä»‹ç»äº†å¦ä¸€ç§åˆå§‹åŒ–æ–¹æ³• Xavier åˆå§‹åŒ–ï¼Œå¯ä»¥å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/40175178#:~:text=Xavier%E5%88%9D%E5%A7%8B,%E5%85%8D%E6%A2%AF%E5%BA%A6%E5%BC%A5%E6%95%A3%E6%83%85%E5%86%B5%E3%80%82">çŸ¥ä¹</a></p><h2 id="ç¯å¢ƒå’Œåˆ†å¸ƒåç§»"><a href="#ç¯å¢ƒå’Œåˆ†å¸ƒåç§»" class="headerlink" title="ç¯å¢ƒå’Œåˆ†å¸ƒåç§»"></a>ç¯å¢ƒå’Œåˆ†å¸ƒåç§»</h2><p>æœºå™¨å­¦ä¹ çš„è®¸å¤šåº”ç”¨ä¸­éƒ½å­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ï¼šé€šè¿‡å°†åŸºäºæ¨¡å‹çš„å†³ç­–å¼•å…¥ç¯å¢ƒï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç ´åæ¨¡å‹</p><h3 id="åˆ†å¸ƒåç§»çš„ç±»å‹"><a href="#åˆ†å¸ƒåç§»çš„ç±»å‹" class="headerlink" title="åˆ†å¸ƒåç§»çš„ç±»å‹"></a>åˆ†å¸ƒåç§»çš„ç±»å‹</h3><h4 id="åå˜é‡åç§»"><a href="#åå˜é‡åç§»" class="headerlink" title="åå˜é‡åç§»"></a>åå˜é‡åç§»</h4><p>åœ¨åˆ†å¸ƒåç§»çš„åˆ†ç±»ä¸­ï¼Œåå˜é‡åç§»å¯èƒ½æ˜¯ç ”ç©¶çš„æœ€å¹¿æ³›çš„ã€‚è¿™é‡Œæˆ‘ä»¬å‡è®¾ï¼Œè™½ç„¶è¾“å…¥çš„åˆ†å¸ƒå¯èƒ½éšæ—¶é—´è€Œæ”¹å˜ï¼Œä½†æ ‡ç­¾å‡½æ•°ï¼Œå³æ¡ä»¶åˆ†å¸ƒ $P(yâˆ£x)$ æ²¡æœ‰æ”¹å˜ã€‚æ•™æä¸¾äº†ä¸€ä¸ªçŒ«ç‹—çš„ä¾‹å­</p><p><img src="/archives/fc6001ca/image-20211124125337960.png" style="zoom:50%;"></p><p><img src="/archives/fc6001ca/image-20211124125348173.png" style="zoom:50%;"></p><p>æµ‹è¯•æ—¶çš„æ•°æ®ç›¸æ¯”è®­ç»ƒæ—¶å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯æ ‡ç­¾çš„å¹¶æ²¡æœ‰æ”¹å˜</p><h4 id="æ ‡ç­¾åç§»"><a href="#æ ‡ç­¾åç§»" class="headerlink" title="æ ‡ç­¾åç§»"></a>æ ‡ç­¾åç§»</h4><p>æ ‡ç­¾åç§»æè¿°äº†ä¸åå˜é‡åç§»ç›¸åçš„é—®é¢˜ã€‚æ ‡ç­¾è¾¹ç¼˜æ¦‚ç‡ $P(y)$ å¯ä»¥æ”¹å˜ï¼Œä½†æ˜¯ç±»åˆ«æ¡ä»¶åˆ†å¸ƒ $P(xâˆ£y)$ åœ¨ä¸åŒçš„é¢†åŸŸä¹‹é—´ä¿æŒä¸å˜ã€‚ç®€å•çš„ç†è§£å°±æ˜¯æ ·æœ¬æ ‡ç­¾/ç±»åˆ«ä¸å‡è¡¡çš„é—®é¢˜</p><h4 id="æ¦‚å¿µåç§»"><a href="#æ¦‚å¿µåç§»" class="headerlink" title="æ¦‚å¿µåç§»"></a>æ¦‚å¿µåç§»</h4><p>å½“æ ‡ç­¾çš„å®šä¹‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼Œé€šä¿—ä¸€ç‚¹è¯´æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æŒ‡çŒ«ä¸ºâ€ç‹—â€œã€‚ä»æ•°å­¦ä¸Šæ¥è¯´ï¼Œæ˜¯è¾“å…¥çš„è¾¹ç¼˜åˆ†å¸ƒç›¸åŒï¼Œæ ‡ç­¾çš„è¾¹ç¼˜åˆ†å¸ƒä¹Ÿç›¸åŒï¼š$p_s(x)=p_t(x),p_s(y)=p_t(y)$ï¼Œä½†æ˜¯æ¡ä»¶åˆ†å¸ƒä¸åŒï¼š$p_s(y|x)â‰ p_t(y|x)$</p><h3 id="åˆ†å¸ƒåç§»çº æ­£"><a href="#åˆ†å¸ƒåç§»çº æ­£" class="headerlink" title="åˆ†å¸ƒåç§»çº æ­£"></a>åˆ†å¸ƒåç§»çº æ­£</h3><p>ä¸»è¦æ˜¯é€šè¿‡çº æ­£æŸå¤±å‡½æ•°çš„åç§»æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ç»™æŸå¤±å‡½æ•°åŠ æƒï¼Œè¿™å°±è¦ä½¿ç”¨æµ‹è¯•é›†ä¸­çš„æ ·æœ¬åˆ†å¸ƒäº†ã€‚è€Œä¸”æ•™æä¹Ÿæåˆ°ï¼šä¸è€çƒ¦çš„è¯»è€…å¯ä»¥ç»§ç»­ä¸‹ä¸€èŠ‚ï¼Œå› ä¸ºè¿™äº›å†…å®¹ä¸æ˜¯åç»­æ¦‚å¿µçš„å…ˆä¿®å†…å®¹ï¼Œè€Œæˆ‘å°±æ˜¯ä¸è€çƒ¦çš„é‚£ä¸€æ‰¹ğŸ˜</p><p><img src="/archives/fc6001ca/image-20211124143457101.png" style="zoom:80%;"></p><h3 id="æœºå™¨å­¦ä¹ ä¸­çš„å…¬å¹³ã€è´£ä»»å’Œé€æ˜åº¦"><a href="#æœºå™¨å­¦ä¹ ä¸­çš„å…¬å¹³ã€è´£ä»»å’Œé€æ˜åº¦" class="headerlink" title="æœºå™¨å­¦ä¹ ä¸­çš„å…¬å¹³ã€è´£ä»»å’Œé€æ˜åº¦"></a>æœºå™¨å­¦ä¹ ä¸­çš„å…¬å¹³ã€è´£ä»»å’Œé€æ˜åº¦</h3><p>è¿™éƒ¨åˆ†è®²äº†ä¸€äº›é“å¾·ä¼¦ç†å›°å¢ƒã€‚æ•™æåŸæ–‡ï¼šé€šå¸¸ï¼Œåœ¨å»ºæ¨¡çº æ­£è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹çš„é¢„æµ‹ä¸è®­ç»ƒæ•°æ®è€¦åˆçš„å„ç§æœºåˆ¶éƒ½æ²¡æœ‰å¾—åˆ°è§£é‡Šã€‚è¿™å¯èƒ½å¯¼è‡´ç ”ç©¶äººå‘˜ç§°ä¹‹ä¸ºâ€œå¤±æ§åé¦ˆå¾ªç¯â€çš„ç°è±¡</p><p>å°±åƒä¸€ä¸ªæ­£åé¦ˆæœºåˆ¶ä¸€æ ·ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªæ¨èç³»ç»Ÿä¸­ï¼Œä½ ä¼šè¢«æ¨èè¶Šæ¥è¶Šå¤šç›¸ä¼¼çš„å†…å®¹ï¼›è€Œåœ¨ä¸€ä¸ªçŠ¯ç½ªé¢„è­¦ç³»ç»Ÿä¸­ï¼ŒæŸä¸€ä¸ªç¤¾åŒºæˆ–è€…æŸä¸€ç±»äººå°†ä¼šè¢«è¶Šæ¥è¶Šé’ˆå¯¹</p>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 03 çº¿æ€§ç¥ç»ç½‘ç»œ</title>
      <link href="/archives/56c94983.html"/>
      <url>/archives/56c94983.html</url>
      
        <content type="html"><![CDATA[<h1 id="D2L-03-çº¿æ€§ç¥ç»ç½‘ç»œ"><a href="#D2L-03-çº¿æ€§ç¥ç»ç½‘ç»œ" class="headerlink" title="D2L 03 çº¿æ€§ç¥ç»ç½‘ç»œ"></a>D2L 03 çº¿æ€§ç¥ç»ç½‘ç»œ</h1><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ç¥ç»ç½‘ç»œçš„æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼šå®šä¹‰ç®€å•çš„ç¥ç»ç½‘ç»œæ¶æ„ã€æ•°æ®å¤„ç†ã€æŒ‡å®šæŸå¤±å‡½æ•°å’Œå¦‚ä½•è®­ç»ƒæ¨¡å‹</p><p>ç»å…¸ç»Ÿè®¡å­¦ä¹ æŠ€æœ¯ä¸­çš„çº¿æ€§å›å½’å’Œsoftmaxå›å½’å¯ä»¥è§†ä¸ºçº¿æ€§ç¥ç»ç½‘ç»œ</p><h2 id="çº¿æ€§å›å½’"><a href="#çº¿æ€§å›å½’" class="headerlink" title="çº¿æ€§å›å½’"></a>çº¿æ€§å›å½’</h2><p>å‡ ä¸ªåŸºæœ¬çš„æ¦‚å¿µ</p><ul><li>æ•°æ®é›† $X \in \mathbb R^{n\times d}$</li><li>æ ·æœ¬ï¼Œç‰¹å¾/åå˜é‡</li><li>æ ‡ç­¾/ç›®æ ‡ $y \in R^n$</li></ul><h3 id="çº¿æ€§æ¨¡å‹"><a href="#çº¿æ€§æ¨¡å‹" class="headerlink" title="çº¿æ€§æ¨¡å‹"></a>çº¿æ€§æ¨¡å‹</h3><p>ä½¿ç”¨ä»¿å°„å˜æ¢å¾—åˆ°é¢„æµ‹å€¼ $\hat{\bold y}$</p><script type="math/tex; mode=display">\hat{\bold y} = \bold X\bold w+b</script><p>$\bold w\in R^d$ï¼Œ$b$ æ˜¯ä¸€ä¸ªæ ‡é‡</p><h3 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p>MSEï¼ˆMean Square Errorï¼‰</p><script type="math/tex; mode=display">L(\mathbf{w}, b)=\frac{1}{n} \sum_{i=1}^{n} l^{(i)}(\mathbf{w}, b)=\frac{1}{n} \sum_{i=1}^{n} \frac{1}{2}\left(\mathbf{w}^{\top} \mathbf{x}^{(i)}+b-y^{(i)}\right)^{2}</script><p>å¸Œæœ›å¯»æ‰¾ä¸€ç»„å‚æ•°ä½¿å¾—æŸå¤±å‡½æ•°æœ€å°</p><script type="math/tex; mode=display">\mathbf{w}^{*}, b^{*}=\underset{\mathbf{w}, b}{\operatorname{argmin}} L(\mathbf{w}, b)</script><p>ç®€å•çš„çº¿æ€§é—®é¢˜å¯ä»¥æœ‰è§£æè§£ï¼Œä½†ä¸€èˆ¬æ·±åº¦å­¦ä¹ çš„é—®é¢˜ä¸­å¾ˆéš¾æ‰¾åˆ°è§£æè§£</p><h3 id="æ¢¯åº¦ä¸‹é™"><a href="#æ¢¯åº¦ä¸‹é™" class="headerlink" title="æ¢¯åº¦ä¸‹é™"></a>æ¢¯åº¦ä¸‹é™</h3><p>å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™</p><p>å­¦åˆ°è¿™é‡Œï¼Œæˆ‘å·²ç»æ„Ÿå—åˆ°å¤§éƒ¨åˆ†æ·±åº¦å­¦ä¹ æ•™æçš„æ•°å­¦éƒ½æ²¡æœ‰è¿›è¡Œæ·±å…¥çš„æŒ–æ˜ï¼Œå…¶æ ¸å¿ƒåœ¨äºâ€åŠ¨æ‰‹â€ï¼Œé€šè¿‡ç®€å•çš„å™è¿°å’Œä»£ç ï¼Œè®©äººä»¬å…¥é—¨æ·±åº¦å­¦ä¹ ï¼Œæœ‰ä¸€ä¸ªæ•´ä½“çš„è®¤è¯†ï¼ŒçŸ¥é“æ·±åº¦å­¦ä¹ èƒ½å¤Ÿå¹²ä»€ä¹ˆ</p><p>ä½†æ˜¯çœŸæ­£çš„æ·±å…¥ï¼šæ¦‚ç‡è®ºï¼Œä¿¡æ¯è®ºï¼Œçº¿æ€§ä»£æ•°ï¼ˆçŸ©é˜µæ±‚å¯¼ï¼‰ï¼Œæœºå™¨å­¦ä¹ ç­‰æ‰€æœ‰çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œéƒ½æœ‰æ‰€æ¬ ç¼ºï¼Œæ‰€ä»¥ç°åœ¨æ”¹å˜ç­–ç•¥ï¼Œå°†ä¸è¿›è¡Œç»†è‡´çš„æ•´ç†ï¼Œä»…è®°å½•æˆ‘è®¤ä¸ºæœ‰ç”¨çš„éƒ¨åˆ†ï¼Œå¹¶è¿›è¡Œé€‚å½“æ‰©å……ã€‚ä¸»è¦ç›®çš„ä¸ºç¼–ç¨‹ç»ƒä¹ </p><h3 id="æ­£æ€åˆ†å¸ƒä¸å¹³æ–¹æŸå¤±"><a href="#æ­£æ€åˆ†å¸ƒä¸å¹³æ–¹æŸå¤±" class="headerlink" title="æ­£æ€åˆ†å¸ƒä¸å¹³æ–¹æŸå¤±"></a>æ­£æ€åˆ†å¸ƒä¸å¹³æ–¹æŸå¤±</h3><p>åœ¨é«˜æ–¯å™ªå£°çš„å‡è®¾ä¸‹ï¼Œæœ€å°åŒ–å‡æ–¹è¯¯å·®ç­‰ä»·äºå¯¹çº¿æ€§æ¨¡å‹çš„æœ€å¤§ä¼¼ç„¶ä¼°è®¡</p><p><img src="/archives/56c94983/image-20211116151118056.png" style="zoom: 80%;"></p><h3 id="çº¿æ€§å›å½’-pytorch-å®ç°"><a href="#çº¿æ€§å›å½’-pytorch-å®ç°" class="headerlink" title="çº¿æ€§å›å½’ pytorch å®ç°"></a>çº¿æ€§å›å½’ pytorch å®ç°</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> torch<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils <span class="token keyword">import</span> data<span class="token comment"># å®šä¹‰éšæœºç§å­</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">synthetic_data</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> num_examples<span class="token punctuation">)</span><span class="token punctuation">:</span>    X <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>num_examples<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    y <span class="token operator">=</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>X<span class="token punctuation">,</span> w<span class="token punctuation">)</span> <span class="token operator">+</span> b    y <span class="token operator">+=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>    X<span class="token punctuation">,</span> y <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>    <span class="token keyword">return</span> X<span class="token punctuation">,</span> y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>true_w <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>true_b <span class="token operator">=</span> <span class="token number">4.2</span>features<span class="token punctuation">,</span> labels <span class="token operator">=</span> synthetic_data<span class="token punctuation">(</span>true_w<span class="token punctuation">,</span> true_b<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token comment"># è¯»å–æ•°æ®é›†</span><span class="token keyword">def</span> <span class="token function">load_array</span><span class="token punctuation">(</span>data_arrays<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> is_train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#@save</span>    <span class="token triple-quoted-string string">"""æ„é€ ä¸€ä¸ªPyTorchæ•°æ®è¿­ä»£å™¨ã€‚"""</span>    dataset <span class="token operator">=</span> data<span class="token punctuation">.</span>TensorDataset<span class="token punctuation">(</span><span class="token operator">*</span>data_arrays<span class="token punctuation">)</span>    <span class="token keyword">return</span> data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span>is_train<span class="token punctuation">)</span>batch_size <span class="token operator">=</span> <span class="token number">10</span>data_iter <span class="token operator">=</span> load_array<span class="token punctuation">(</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span><span class="token comment"># å®šä¹‰æ¨¡å‹</span><span class="token keyword">from</span> torch <span class="token keyword">import</span> nnnet <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># åˆå§‹åŒ–å‚æ•°</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bias<span class="token punctuation">.</span>data<span class="token punctuation">.</span>fill_<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment"># å®šä¹‰æŸå¤±å‡½æ•°</span>loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># å®šä¹‰ä¼˜åŒ–ç®—æ³•</span>trainer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.03</span><span class="token punctuation">)</span><span class="token comment"># è®­ç»ƒ</span>num_epochs <span class="token operator">=</span> <span class="token number">3</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> data_iter<span class="token punctuation">:</span>        l <span class="token operator">=</span> loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token punctuation">,</span>y<span class="token punctuation">)</span>        trainer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>        l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        trainer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>    l <span class="token operator">=</span> loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'epoch </span><span class="token interpolation"><span class="token punctuation">{</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">, loss </span><span class="token interpolation"><span class="token punctuation">{</span>l<span class="token punctuation">:</span><span class="token format-spec">f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li><code>torch.Tensor.to(torch.float32)</code> <a href="https://pytorch.org/docs/stable/generated/torch.Tensor.to.html">doc</a> æ—¢å¯ä»¥è½¬æ¢ç±»å‹ï¼Œåˆå¯ä»¥è½¬æ¢ cpu/gpu è®¾å¤‡</li><li><p>å¯ä»¥é€šè¿‡åºå· <code>net[idx].weight</code> è®¿é—® <code>nn.Sequential</code> ä¸­æŒ‡å®šç½‘ç»œå±‚çš„å‚æ•°</p></li><li><p>å…³äº <a href="https://pytorch.org/tutorials/beginner/nn_tutorial.html">torch.nn</a></p></li></ol><h2 id="Softmax-å›å½’"><a href="#Softmax-å›å½’" class="headerlink" title="Softmax å›å½’"></a>Softmax å›å½’</h2><h3 id="One-hot-ç¼–ç "><a href="#One-hot-ç¼–ç " class="headerlink" title="One-hot ç¼–ç "></a>One-hot ç¼–ç </h3><p>ç¼–ç æ˜¯ä¸€ä¸ªå‘é‡ï¼Œå®ƒçš„åˆ†é‡å’Œç±»åˆ«ä¸€æ ·å¤šã€‚ç±»åˆ«å¯¹åº”çš„åˆ†é‡è®¾ç½®ä¸º1ï¼Œå…¶ä»–æ‰€æœ‰åˆ†é‡è®¾ç½®ä¸º0</p><h3 id="Softmax-è¿ç®—"><a href="#Softmax-è¿ç®—" class="headerlink" title="Softmax è¿ç®—"></a>Softmax è¿ç®—</h3><p>å‡è®¾æœ‰ä¸€ä¸ªæ ·æœ¬ï¼Œè¾“å…¥ä¸º oï¼Œåˆ†ç±»æ•°é‡ä¸º qï¼Œé¢„æµ‹å€¼ä¸º y</p><p><img src="/archives/56c94983/image-20211116170343558.png" style="zoom:80%;"></p><p>å°½ç®¡ softmax æ˜¯ä¸€ä¸ªéçº¿æ€§å‡½æ•°ï¼Œä½† softmax å›å½’çš„è¾“å‡ºä»ç„¶ç”±è¾“å…¥ç‰¹å¾çš„ä»¿å°„å˜æ¢å†³å®šã€‚å› æ­¤ï¼Œsoftmax å›å½’æ˜¯ä¸€ä¸ªçº¿æ€§æ¨¡å‹</p><h3 id="æŸå¤±å‡½æ•°-1"><a href="#æŸå¤±å‡½æ•°-1" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p><img src="/archives/56c94983/image-20211116170647087.png" style="zoom:80%;"></p><p>ä»¥ä¸Šä¸ºä¼¼ç„¶å‡½æ•°ï¼Œä¹Ÿè¢«å¸¸ç§°ä¸ºï¼ˆå¤šåˆ†ç±»ï¼‰äº¤å‰ç†µæŸå¤±ã€‚äº¤å‰ç†µæ˜¯ä¸€ä¸ªè¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´å·®å¼‚çš„å¾ˆå¥½çš„åº¦é‡ã€‚å®ƒæµ‹é‡ç»™å®šæ¨¡å‹ç¼–ç æ•°æ®æ‰€éœ€çš„æ¯”ç‰¹æ•°</p><h4 id="Softmax-åŠå…¶å¯¼æ•°"><a href="#Softmax-åŠå…¶å¯¼æ•°" class="headerlink" title="Softmax åŠå…¶å¯¼æ•°"></a>Softmax åŠå…¶å¯¼æ•°</h4><p>å°† softmax çš„å…¬å¼å¸¦å…¥åˆ°æŸå¤±å‡½æ•°ä¸­å¹¶æ±‚å¯¼</p><p><img src="/archives/56c94983/image-20211116172439239.png" style="zoom:80%;"></p><p>å¯¼æ•°æ˜¯æˆ‘ä»¬æ¨¡å‹åˆ†é…çš„æ¦‚ç‡ï¼ˆç”± softmax å¾—åˆ°ï¼‰ä¸å®é™…å‘ç”Ÿçš„æƒ…å†µï¼ˆç”±ç‹¬çƒ­æ ‡ç­¾å‘é‡è¡¨ç¤ºï¼‰ä¹‹é—´çš„å·®å¼‚ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œä¸æˆ‘ä»¬åœ¨å›å½’ä¸­çœ‹åˆ°çš„éå¸¸ç›¸ä¼¼</p><h3 id="Fashion-MNIST-æ•°æ®é›†"><a href="#Fashion-MNIST-æ•°æ®é›†" class="headerlink" title="Fashion-MNIST æ•°æ®é›†"></a>Fashion-MNIST æ•°æ®é›†</h3><p>è¿™ä¸€å°èŠ‚ä»‹ç»äº†å¦‚ä½•ä» pytorch api åŠ è½½è¯¥æ•°æ®é›†</p><h3 id="Softmax-Pytorch-å®ç°"><a href="#Softmax-Pytorch-å®ç°" class="headerlink" title="Softmax Pytorch å®ç°"></a>Softmax Pytorch å®ç°</h3><h4 id="ä¸Šæº¢ä¸‹æº¢é—®é¢˜"><a href="#ä¸Šæº¢ä¸‹æº¢é—®é¢˜" class="headerlink" title="ä¸Šæº¢ä¸‹æº¢é—®é¢˜"></a>ä¸Šæº¢ä¸‹æº¢é—®é¢˜</h4><p>å¦‚ä½•è§£å†³ exp ä¸Šæº¢å’Œ log ä¸‹æº¢é—®é¢˜ï¼Ÿ</p><ol><li>softmax ä¸Šä¸‹åŒæ—¶é™¤ä»¥ exp(max(x)) å¯ä»¥è§£å†³ä¸Šæº¢é—®é¢˜ã€‚ä½†å½“ exp(max(x)) æ¯”è¾ƒå¤§ (&gt;1000) æ—¶ï¼Œsoftmax ä¼šç›´æ¥è¿”å› 0ï¼Œå†è¿›å…¥ log å‡½æ•°å°±ä¼šäº§ç”Ÿä¸‹æº¢</li><li>è§£å†³æ–¹æ³•æ˜¯ç›´æ¥è¾“å…¥ logits è¾“å‡ºäº¤å‰ç†µï¼Œå³ä¸ç»è¿‡ softmax è¿ç®—ã€‚å› ä¸º log å’Œ exp æ˜¯ä¸€å¯¹åå‡½æ•°ï¼Œå®ƒä»¬å¯ä»¥ç›¸äº’æŠµæ¶ˆï¼Œlog(exp(x)) = x</li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dataloader <span class="token keyword">import</span> DataLoader<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sampler <span class="token keyword">import</span> SubsetRandomSampler<span class="token keyword">from</span>  torchvision <span class="token keyword">import</span> datasets<span class="token keyword">from</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">import</span> SGD<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor<span class="token keyword">import</span> timetraining_data <span class="token operator">=</span> datasets<span class="token punctuation">.</span>FashionMNIST<span class="token punctuation">(</span>    root<span class="token operator">=</span><span class="token string">"./data"</span><span class="token punctuation">,</span>    train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>test_data <span class="token operator">=</span> datasets<span class="token punctuation">.</span>FashionMNIST<span class="token punctuation">(</span>    root<span class="token operator">=</span><span class="token string">"./data"</span><span class="token punctuation">,</span>    train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>    download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">)</span>batch_size <span class="token operator">=</span> <span class="token number">256</span>NUM_TRAIN <span class="token operator">=</span> <span class="token number">1000</span>sampler <span class="token operator">=</span> SubsetRandomSampler<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>NUM_TRAIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># æš‚æ—¶å…ˆä¸ç”¨ sampler</span>train_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>training_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">)</span><span class="token comment"># PyTorchä¸ä¼šéšå¼åœ°è°ƒæ•´è¾“å…¥çš„å½¢çŠ¶ã€‚å› æ­¤ï¼Œ</span><span class="token comment"># æˆ‘ä»¬åœ¨çº¿æ€§å±‚å‰å®šä¹‰äº†å±•å¹³å±‚ï¼ˆflattenï¼‰ï¼Œæ¥è°ƒæ•´ç½‘ç»œè¾“å…¥çš„å½¢çŠ¶</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">init_weights</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">:</span>        nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>init_weights<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># æŸå¤±å‡½æ•°å¹¶ç§»åŠ¨åˆ° GPU</span><span class="token comment"># input is logits, i.e. raw scores</span>loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>loss<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>optim <span class="token operator">=</span> SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">eval</span><span class="token punctuation">(</span>output<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">,</span> label<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>    pred <span class="token operator">=</span> output<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    acc_num <span class="token operator">=</span> <span class="token punctuation">(</span>pred<span class="token punctuation">.</span>to<span class="token punctuation">(</span>label<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span> <span class="token operator">==</span> label<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> acc_num <span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>model<span class="token punctuation">:</span> nn<span class="token punctuation">.</span>Module<span class="token punctuation">,</span> train_loader<span class="token punctuation">,</span> epochs<span class="token punctuation">,</span> optim<span class="token punctuation">:</span> SGD<span class="token punctuation">,</span> loss_fn<span class="token punctuation">)</span><span class="token punctuation">:</span>    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        loss <span class="token operator">=</span> <span class="token number">0</span>        acc_num <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">for</span> data<span class="token punctuation">,</span> label <span class="token keyword">in</span> train_loader<span class="token punctuation">:</span>            <span class="token comment"># å°† data ç§»å…¥ GPU</span>            data <span class="token operator">=</span> data<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>            label <span class="token operator">=</span> label<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>            output <span class="token operator">=</span> model<span class="token punctuation">(</span>data<span class="token punctuation">)</span>            loss <span class="token operator">=</span> loss_fn<span class="token punctuation">(</span>output<span class="token punctuation">,</span> label<span class="token punctuation">)</span>            optim<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>            loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            optim<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>            acc_num <span class="token operator">+=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> label<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'epoch: </span><span class="token interpolation"><span class="token punctuation">{</span>epoch<span class="token punctuation">}</span></span><span class="token string">, loss: </span><span class="token interpolation"><span class="token punctuation">{</span>loss<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">, train_acc: </span><span class="token interpolation"><span class="token punctuation">{</span>acc_num <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>training_data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">, time:</span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>start<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>train<span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_loader<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> optim<span class="token operator">=</span>optim<span class="token punctuation">,</span> loss_fn<span class="token operator">=</span>loss<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡ªå·±å†™ä¸€ä¸ª softmax å®ç°ï¼Œæœ€ç»ˆç»“æœä¸å®˜æ–¹å·®ä¸å¤šï¼Œä»¥ä¸‹ç»“æœæ¥è‡ªè‡ªå·±ï¼Œå›¾åƒæ¥è‡ªå®˜æ–¹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">epoch: <span class="token number">0</span>, loss: <span class="token number">0.983296</span>, train_acc: <span class="token number">0.64</span>, time:4.58epoch: <span class="token number">1</span>, loss: <span class="token number">0.797371</span>, train_acc: <span class="token number">0.72</span>, time:4.47epoch: <span class="token number">2</span>, loss: <span class="token number">0.712272</span>, train_acc: <span class="token number">0.75</span>, time:4.44epoch: <span class="token number">3</span>, loss: <span class="token number">0.660301</span>, train_acc: <span class="token number">0.77</span>, time:4.40epoch: <span class="token number">4</span>, loss: <span class="token number">0.624506</span>, train_acc: <span class="token number">0.78</span>, time:4.49epoch: <span class="token number">5</span>, loss: <span class="token number">0.598148</span>, train_acc: <span class="token number">0.79</span>, time:4.52epoch: <span class="token number">6</span>, loss: <span class="token number">0.577858</span>, train_acc: <span class="token number">0.80</span>, time:4.58epoch: <span class="token number">7</span>, loss: <span class="token number">0.561719</span>, train_acc: <span class="token number">0.80</span>, time:4.59epoch: <span class="token number">8</span>, loss: <span class="token number">0.548546</span>, train_acc: <span class="token number">0.80</span>, time:4.45epoch: <span class="token number">9</span>, loss: <span class="token number">0.537567</span>, train_acc: <span class="token number">0.81</span>, time:4.43epoch: <span class="token number">10</span>, loss: <span class="token number">0.528253</span>, train_acc: <span class="token number">0.81</span>, time:4.50<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/56c94983/output_softmax-regression-concise_75d138_51_0.svg" style="zoom:80%;"></p><p>å­¦ä¹ ç‚¹ï¼š</p><ol><li>åœ¨å®ç°è¿‡ç¨‹ä¸­å‘ç°äº† <code>add_module</code> çš„ä½œç”¨ï¼Œç›¸å½“äºåœ¨ <code>__init__</code> ä¸­ä½¿ç”¨äº† <code>self.module_name = nn.xxx</code>ï¼Œå³æŠŠä¸€ä¸ªæ¨¡å—æ³¨å†Œåˆ°å½“å‰æ¨¡å‹ä¸­ï¼Œæˆä¸ºè¯¥æ¨¡å‹çš„ children / å­æ¨¡å—ã€‚åœ¨ä¹‹åçš„è®­ç»ƒä¸­å°†ä¼šæ›´æ–°è¿™ä¸ªæ¨¡å—çš„å‚æ•°ï¼Œå¹¶ä¸”è¯¥æ¨¡å—ä¹Ÿèƒ½ä½œä¸ºå±æ€§è¢«æ¨¡å‹è®¿é—® <code>model.module_name</code></li><li>é€šè¿‡ <code>nn.init</code> æ¨¡å—å¯ä»¥å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œåˆå§‹åŒ–</li><li>é€šè¿‡ <code>nn.apply(fn)</code> å¾ªç¯åœ°å¯¹æ‰€æœ‰å­æ¨¡å‹ <code>model.children()</code> è¿›è¡Œæ“ä½œ</li><li>éœ€è¦å°†æ¨¡å‹å’Œæ•°æ®éƒ½è½¬ç§»åˆ°ç›¸åŒçš„è®¾å¤‡ä¸Šæ‰èƒ½è¿›è¡Œè¿ç®—ï¼Œå¦‚æœæŸå¤±å‡½æ•°ä¹Ÿæ˜¯ <code>nn.Module</code> çš„å­ç±»ï¼Œåˆ™ä¹Ÿéœ€è¦è½¬ç§»</li></ol><h3 id="è¡¥å……ï¼šä¸ºä»€ä¹ˆä½¿ç”¨-CE-è¿›è¡Œåˆ†ç±»è€Œä¸ä½¿ç”¨-MSE"><a href="#è¡¥å……ï¼šä¸ºä»€ä¹ˆä½¿ç”¨-CE-è¿›è¡Œåˆ†ç±»è€Œä¸ä½¿ç”¨-MSE" class="headerlink" title="è¡¥å……ï¼šä¸ºä»€ä¹ˆä½¿ç”¨ CE è¿›è¡Œåˆ†ç±»è€Œä¸ä½¿ç”¨ MSE"></a>è¡¥å……ï¼šä¸ºä»€ä¹ˆä½¿ç”¨ CE è¿›è¡Œåˆ†ç±»è€Œä¸ä½¿ç”¨ MSE</h3><ol><li><p>ä»æ¢¯åº¦è§’åº¦æ¥çœ‹ã€‚åˆ†ç±»é—®é¢˜çš„è¾“å‡ºé€šå¸¸ç»è¿‡ sigmoid or softmax å‡½æ•°ï¼Œä»¥ sigmoid å‡½æ•°ä¸ºä¾‹ï¼Œå‡½æ•°çš„ä¸¤ç«¯ä¼šéå¸¸éå¸¸çš„å¹³ç¼“ï¼Œè¿™å°±ä¼šå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ï¼Œç½‘ç»œæ— æ³•è¿›ä¸€æ­¥ä¼˜åŒ–</p></li><li><p>äº¤å‰ç†µå°±æ˜¯ç”¨äºè¡¡é‡ä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚è¿™é‡Œåˆè¦æä¸€å¥ KL æ•£åº¦å’Œäº¤å‰ç†µä¹‹é—´çš„å…³ç³»ä¸åŒºåˆ«ï¼š<strong>KL æ•£åº¦å¯ä»¥è¢«ç”¨äºè®¡ç®—ä¸¤ä¸ªåˆ†å¸ƒçš„å·®å¼‚ï¼Œè€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹æœ€å°åŒ– KL æ•£åº¦ç­‰ä»·äºæœ€å°åŒ–äº¤å‰ç†µã€‚è€Œäº¤å‰ç†µçš„è¿ç®—æ›´ç®€å•ï¼Œæ‰€ä»¥ç”¨äº¤å‰ç†µæ¥å½“åšä»£ä»·</strong>ã€‚å†è´´å‡ ä¸ªå…¬å¼</p><script type="math/tex; mode=display">S(v)=-\sum_{i} p\left(v_{i}\right) \log p\left(v_{i}\right)\\D_{K L}(A \| B)=\sum_{i} p_{A}\left(v_{i}\right) \log p_{A}\left(v_{i}\right)-p_{A}\left(v_{i}\right) \log p_{B}\left(v_{i}\right)\\H(A, B)=-\sum_{i} p_{A}\left(v_{i}\right) \log p_{B}\left(v_{i}\right)\\H(A, B)=D_{K L}(A \| B)+S_{A}</script><p>å½“ $S_A$ ä¸ºå¸¸æ•°æ—¶ï¼Œä¼˜åŒ–äº¤å‰ç†µç­‰ä»·äºä¼˜åŒ– KL æ•£åº¦ã€‚æœ€åæä¸€å¥é€šè¿‡ Jensen ä¸ç­‰å¼å¯è¯æ˜ KL æ•£åº¦å¤§äº0</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matplotlib æ‹“å±•</title>
      <link href="/archives/ea21061e.html"/>
      <url>/archives/ea21061e.html</url>
      
        <content type="html"><![CDATA[<h1 id="Matplotlib-æ‹“å±•"><a href="#Matplotlib-æ‹“å±•" class="headerlink" title="Matplotlib æ‹“å±•"></a>Matplotlib æ‹“å±•</h1><p><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.html#module-matplotlib.pyplot">pyplot api doc</a> æ”¾ä¸€ä¸ª api é“¾æ¥ï¼Œä¾¿äºæŸ¥æ‰¾ api</p><h2 id="Axis-limit"><a href="#Axis-limit" class="headerlink" title="Axis limit"></a>Axis limit</h2><p>æœ‰ä¸¤ä¸ªæ¨èçš„æ–¹æ³•</p><ol><li><code>plt.xlim(left, right)</code>ï¼Œ<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.xlim.html?highlight=pyplot%20xlim#matplotlib.pyplot.xlim">xlim doc</a></li><li><code>plt.axis([xmin, xmax, ymin, ymax])</code>ï¼Œ<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.axis.html#matplotlib.pyplot.axis">axis doc</a>ï¼Œé€šè¿‡ <code>plt.axis(False)</code> ä¹Ÿå¯ä»¥ä¸æ˜¾ç¤ºåæ ‡è½´åŠå…¶æ ‡ç­¾</li></ol><p>axis é™¤äº†èŒƒå›´å¯ä»¥è®¾ç½®ï¼Œå…¶ tick ä¹Ÿå¯è®¾ç½®ï¼Œ<code>plt.xticks(ticks=, labels=)</code> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.xticks.html#matplotlib.pyplot.xticks">xticks doc</a></p><p>è¡¥å……ï¼šå°† y è½´è¿›è¡Œåè½¬ <code>plt.gca().invert_yaxis()</code></p><h2 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h2><div class="table-container"><table><thead><tr><th><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.html#module-matplotlib.pyplot"><code>pyplot</code></a> API</th><th>OO API</th><th>description</th></tr></thead><tbody><tr><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html#matplotlib.pyplot.text"><code>text</code></a></td><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.text.html#matplotlib.axes.Axes.text"><code>text</code></a></td><td>Add text at an arbitrary location of the <a href="https://matplotlib.org/stable/api/axes_api.html#matplotlib.axes.Axes"><code>Axes</code></a>.</td></tr><tr><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.annotate.html#matplotlib.pyplot.annotate"><code>annotate</code></a></td><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.annotate.html#matplotlib.axes.Axes.annotate"><code>annotate</code></a></td><td>Add an annotation, with an optional arrow, at an arbitrary location of the <a href="https://matplotlib.org/stable/api/axes_api.html#matplotlib.axes.Axes"><code>Axes</code></a>.</td></tr><tr><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.xlabel.html#matplotlib.pyplot.xlabel"><code>xlabel</code></a></td><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_xlabel.html#matplotlib.axes.Axes.set_xlabel"><code>set_xlabel</code></a></td><td>Add a label to the <a href="https://matplotlib.org/stable/api/axes_api.html#matplotlib.axes.Axes"><code>Axes</code></a>â€˜s x-axis.</td></tr><tr><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.ylabel.html#matplotlib.pyplot.ylabel"><code>ylabel</code></a></td><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_ylabel.html#matplotlib.axes.Axes.set_ylabel"><code>set_ylabel</code></a></td><td>Add a label to the <a href="https://matplotlib.org/stable/api/axes_api.html#matplotlib.axes.Axes"><code>Axes</code></a>â€˜s y-axis.</td></tr><tr><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title"><code>title</code></a></td><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.set_title.html#matplotlib.axes.Axes.set_title"><code>set_title</code></a></td><td>Add a title to the <a href="https://matplotlib.org/stable/api/axes_api.html#matplotlib.axes.Axes"><code>Axes</code></a>.</td></tr><tr><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figtext.html#matplotlib.pyplot.figtext"><code>figtext</code></a></td><td><a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.text"><code>text</code></a></td><td>Add text at an arbitrary location of the <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure"><code>Figure</code></a>.</td></tr><tr><td><a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.suptitle.html#matplotlib.pyplot.suptitle"><code>suptitle</code></a></td><td><a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.suptitle"><code>suptitle</code></a></td><td>Add a title to the <a href="https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure"><code>Figure</code></a>.</td></tr></tbody></table></div><p>è¿™äº›åº”è¯¥éƒ½è¿”å›ä¸€ä¸ª <code>Text</code> æ–‡å­—å¯¹è±¡ï¼Œå½“ç„¶ä¹Ÿæ‹¥æœ‰ <code>Text</code> å¯¹è±¡çš„å„ä¸ªå±æ€§ï¼Œä¸‹é¢åˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„å±æ€§</p><ol><li><code>color</code></li><li><code>fontsize</code></li><li><code>fontweight</code> è°ƒæ•´å­—ä½“ç²—ç»† â€˜ultralightâ€™, â€˜lightâ€™, â€˜normalâ€™, â€˜regularâ€™, â€˜boldâ€™, â€˜extra boldâ€™, â€˜blackâ€™</li><li><code>fontfamily</code> è§„å®šå­—ä½“å®¶æ—ï¼Œå¯ä»¥æ›´æ”¹å­—ä½“</li><li><code>fontstyle</code> å¯ä»¥ä½¿ç”¨æ–œä½“ <code>italic</code></li><li><code>alpha</code> é€æ˜åº¦ï¼Œ0~1ä¹‹é—´ï¼Œ1ä¸ºå®Œå…¨ä¸é€æ˜</li><li><code>bbox</code> ç»™æ–‡å­—å¢åŠ å¤–æ¡†ï¼Œå…¶å€¼ä¸ºä¸€ä¸ªå­—å…¸ï¼Œå¸¸ç”¨ <code>dict(boxstyle='', facecolor='', edgecolor='')</code>ï¼Œå…¶ä¸­ <code>boxstyle</code> å–å€¼è¯·å‚è€ƒ <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.patches.FancyBboxPatch.html#matplotlib-patches-fancybboxpatch">link</a>ï¼Œé»˜è®¤ä¸º square ä¹Ÿå¸¸ç”¨ round</li></ol><p>ä¸‹é¢çœ‹çœ‹è¿™äº› API æœ‰å“ªäº›å¿…è¦å‚æ•°ï¼Œé€šè¿‡ä¸€ä¸ªä¾‹å­äº†è§£</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltfig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># Set titles for the figure and the subplot respectively</span>plt<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'bold figure suptitle'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> fontweight<span class="token operator">=</span><span class="token string">'bold'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'pltes title'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'xlabel'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'ylabel'</span><span class="token punctuation">)</span><span class="token comment"># Set both x- and y-pltis limits to [0, 10] instead of default [0, 1]</span>plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'boxed italics text in data coords'</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">'italic'</span><span class="token punctuation">,</span>        bbox<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'facecolor'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'alpha'</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">r'an equation: $E=mc^2$'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'unicode: Institut fÃ¼r FestkÃ¶rperphysik'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/ea21061e/image-20211115155638742.png" style="zoom:67%;"></p><h2 id="Legend-amp-annotate"><a href="#Legend-amp-annotate" class="headerlink" title="Legend &amp; annotate"></a>Legend &amp; annotate</h2><p><code>label</code> å…¶å®æ˜¯å„ä¸ª <code>Artist</code> å¯¹è±¡éƒ½æ‹¥æœ‰çš„å±æ€§ï¼Œåœ¨ä½¿ç”¨ <code>plt.plot()</code> ç±»ä¼¼çš„æ–¹æ³•æ¥ç»˜å›¾çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨å‚æ•°é‡Œä½¿ç”¨ <code>label=</code> ä»¥åˆ›é€ è¯¥ç»˜å›¾å¯¹è±¡çš„æ ‡ç­¾ã€‚è€Œ <code>legend</code> å¯ä»¥ç”¨äºå°† <code>label</code> ä»¥å›¾ä¾‹å½¢å¼åŠ å…¥åˆ° figure å½“ä¸­ï¼Œå‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/111108841">çŸ¥ä¹</a>, <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.legend.html#matplotlib.pyplot.legend">legend doc</a>,  <a href="https://matplotlib.org/stable/tutorials/introductory/customizing.html#matplotlib-rcparams">about matplotlib.rcParams</a></p><p>ä¹Ÿå¯ä»¥å¯¹å›¾åƒä¸­çš„æŸäº›ç‚¹è¿›è¡Œæ ‡è®°ï¼Œä½¿ç”¨ <code>annotate()</code> æ–¹æ³•å³å¯ï¼Œ<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.annotate.html#matplotlib.pyplot.annotate">annotate doc</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token comment"># è®¾ç½®é»˜è®¤å­—ä½“ä»¥æ˜¾ç¤ºä¸­æ–‡</span>plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.family'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'HarmonyOS Sans SC'</span><span class="token punctuation">]</span>n <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>m1 <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> n <span class="token operator">+</span> <span class="token number">2</span>m2 <span class="token operator">=</span> n <span class="token operator">**</span> <span class="token number">2</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'æ—¶é—´'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'å¿ƒæƒ…'</span><span class="token punctuation">)</span>line1<span class="token punctuation">,</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>n<span class="token punctuation">,</span> m1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'å¥³ç”Ÿè´­ç‰©æ¬²æœ›'</span><span class="token punctuation">)</span>line2<span class="token punctuation">,</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>n<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'ç”·ç”Ÿè´­ç‰©æ¬²æœ›'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>handles<span class="token operator">=</span><span class="token punctuation">[</span>line1<span class="token punctuation">,</span> line2<span class="token punctuation">]</span><span class="token punctuation">,</span> labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'girlè´­ç‰©æ¬²æœ›'</span><span class="token punctuation">,</span><span class="token string">'boyè´­ç‰©æ¬²æœ›'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span><span class="token string">'bottom'</span><span class="token punctuation">,</span> xy<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xytext<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arrowprops<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> shrink<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/ea21061e/image-20211115163146776.png" style="zoom:67%;"></p><h2 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h2><p>åœ¨ç›®æ ‡æ£€æµ‹ä¸­ï¼Œç»å¸¸ä½¿ç”¨ bbox å¯¹ç›®æ ‡è¿›è¡Œæ¡†é€‰ï¼Œå¹¶è¿›è¡Œç±»åˆ«æ ‡æ³¨ï¼Œè¿™äº›éƒ½æ˜¯å¯ä»¥é€šè¿‡ matplotlib åšåˆ°çš„ã€‚ä¸€èˆ¬çš„å›¾åƒåœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œè¢«å¤„ç†ä¸ºä¸€ä¸ª (H, W, C) çš„ä¸‰ç»´å¼ é‡ï¼Œå…¶ä¸­ C é€šå¸¸ä¸º 3ï¼Œåœ¨ matplotlib ä¸­å¯ä»¥ä½¿ç”¨ <code>matplotlib.image</code> åŒ…å¤„ç†å›¾åƒï¼Œç„¶åä½¿ç”¨ <code>plt.imshow()</code> ç»˜åˆ¶å›¾åƒï¼Œ<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.imshow.html#matplotlib.pyplot.imshow">imshow doc</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>image <span class="token keyword">as</span> mpimgimg <span class="token operator">=</span> mpimg<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'test.png'</span><span class="token punctuation">)</span><span class="token comment"># img = plt.imread('test.png')</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># ä¿®æ”¹åŸç‚¹</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'lower'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># ä¿®æ”¹é€æ˜åº¦</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token comment"># åœ¨ img ä¸Šç»˜å›¾</span>x <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>k <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>y <span class="token operator">=</span> k <span class="token operator">*</span> xplt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/ea21061e/image-20211115174301946.png" style="zoom: 67%;"></p><p>é™¤äº†ç»˜åˆ¶å‡½æ•°ï¼Œä¸€èˆ¬çš„å‡ ä½•å›¾å½¢ä¹Ÿèƒ½å¤Ÿç»˜åˆ¶ï¼Œä¸€èˆ¬ä½¿ç”¨ patches å¯¹è±¡ï¼Œå…·ä½“æ“ä½œå¯å‚è€ƒ <a href="https://www.jianshu.com/p/8d14238d402a">ç®€ä¹¦</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Package </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Matplotlib </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matplotlib</title>
      <link href="/archives/d1e3c468.html"/>
      <url>/archives/d1e3c468.html</url>
      
        <content type="html"><![CDATA[<h1 id="Matplotlib"><a href="#Matplotlib" class="headerlink" title="Matplotlib"></a>Matplotlib</h1><p>ä¸å¤šè§£é‡Šï¼Œpython è¶…å¼ºçš„å¯è§†åŒ–å·¥å…·ï¼Œå­¦å°±å®Œäº‹å„¿äº†ï¼Œå‚è€ƒ <a href="https://matplotlib.org/stable/tutorials/index.html">official tutorial</a></p><h2 id="Usage-Guide"><a href="#Usage-Guide" class="headerlink" title="Usage Guide"></a>Usage Guide</h2><h3 id="A-simple-example"><a href="#A-simple-example" class="headerlink" title="A simple example"></a>A simple example</h3><p>Matplotlib çš„å›¾éƒ½æ˜¯åœ¨ <a href="https://matplotlib.org/stable/api/figure_api.html##matplotlib.figure.Figure"><code>Figure</code></a>s ä¸Šç»˜åˆ¶çš„ï¼Œæ¯ä¸ª Figure éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª <a href="https://matplotlib.org/stable/api/axes_api.html##matplotlib.axes.Axes"><code>Axes</code></a>ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.plot.html##matplotlib.axes.Axes.plot"><code>Axes.plot</code></a> åœ¨è½´ä¸Šç»˜åˆ¶ä¸€äº›æ•°æ®ï¼Œä½¿ç”¨ axes åˆ›å»ºå›¾å½¢çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html##matplotlib.pyplot.subplots"><code>pyplot.subplots</code></a> ï¼ˆAxes æ¦‚å¿µæ¯”è¾ƒæŠ½è±¡ï¼Œè¿™é‡Œå°±æŠŠå®ƒä»¬å½“ä½œä¸€ä¸ªä¸ªçš„å­å›¾å¥½äº†ï¼Œsubfigureï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span class="token keyword">import</span> numpy <span class="token keyword">as</span> npfig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">## Create a figure containing a single axes.</span>ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">## Plot some data on the axes.</span><span class="token comment"># plt.show()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ç§æ–¹å¼å–åå« <code>object-oriented style or OO-style</code></p><p><img src="/archives/d1e3c468/sphx_glr_usage_001.png" style="zoom:50%;"></p><p>é™¤äº†ä½¿ç”¨ Axes ç»˜å›¾ä»¥å¤–ï¼Œmatplotlib è¿˜å¯ä»¥ä½¿ç”¨ <code>plt.plot()</code> è¿›è¡Œç»˜å›¾ï¼Œå®ƒä¼šåœ¨â€œå½“å‰â€ Axes ä¸Šæ‰§è¡Œè¯¥ç»˜å›¾ï¼Œå¦‚æœå®ƒä»¬ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥ Axesï¼Œæ‰€ä»¥ä¸Šé¢çš„å›¾åƒå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">## Matplotlib plot.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸ºè¿™ç§æ–¹å¼å–åå« <code>pyplot-style</code> ç›®å‰æ¯”è¾ƒæµè¡Œè¿™ç§æ–¹å¼ï¼ŒåŒæ—¶ç°åœ¨ä¹Ÿä¸æ¨èä½¿ç”¨ <code>pylab</code> è¿›è¡Œç»˜å›¾</p><h3 id="Matplotlib-basic-concept"><a href="#Matplotlib-basic-concept" class="headerlink" title="Matplotlib basic concept"></a>Matplotlib basic concept</h3><ol><li><p>Figure</p><p>å¯ä»¥æŠŠ figure å½“æˆä¸€ä¸ªç”»å¸ƒï¼Œè¿™ä¸ªç”»å¸ƒå¯ä»¥ç”»ä»»æ„æ•°é‡çš„ Axes</p></li><li><p>Axes</p><p>æŠŠ Axes å½“æˆä¸€ä¸ªå°ç”»å¸ƒ</p></li><li><p>Axis</p><p>å¯ä»¥ç†è§£ä¸ºå›¾åƒé‡Œçš„åæ ‡è½´ï¼Œç¡®å®šå‡½æ•°å–å€¼èŒƒå›´</p></li><li><p>Artist</p><p>åŸºæœ¬ä¸Šä»»ä½•ä½ çœ‹åˆ°çš„ä¸œè¥¿éƒ½æ˜¯ artist ç±»ï¼ŒåŒ…æ‹¬ Text objects, Axes, Line2D objectsâ€¦æ‰€æœ‰çš„ artist éƒ½ä¼šè¢«ç”»åˆ°ç”»å¸ƒä¸­</p></li></ol><p>æœ€å¥½ä½¿ç”¨ numpy.array ä½œä¸ºå‡½æ•°çš„è¾“å…¥ï¼Œå…¶ä»–ç±»å‹çš„å˜é‡å¯èƒ½ä¸èƒ½å¾ˆå¥½åœ°å¤„ç†</p><h3 id="Interactive-mode"><a href="#Interactive-mode" class="headerlink" title="Interactive mode"></a>Interactive mode</h3><p>å¯ä»¥ä½¿ç”¨äº¤äº’æ¨¡å¼ï¼Œçœ‹åˆ°æ¯ä¸€ä¸ªç”»å›¾çš„æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨ ipython è¿›è¡Œäº¤äº’</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltplt<span class="token punctuation">.</span>ion<span class="token punctuation">(</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.6</span><span class="token punctuation">,</span> <span class="token number">2.7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">## a window should show</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"interactive test"</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ˜¯æ²¡æœ‰æŒ‡æ˜äº¤äº’æ¨¡å¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>plt.show()</code> è®©ç»˜åˆ¶çš„å›¾åƒæ˜¾ç¤º</p><h3 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h3><p>å¦‚æœæ„Ÿè§‰æ¸²æŸ“å¾—å¾ˆæ…¢çš„è¯ï¼Œå¯ä»¥æ˜¯ä½¿ç”¨ fast style</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>style <span class="token keyword">as</span> mplstylemplstyle<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'fast'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœæœ‰å¤šä¸ª style çš„è¯ï¼Œç¡®ä¿ fast style åœ¨æœ€åï¼Œä»¥ä¿è¯ä¸è¢«å…¶ä»– style ä¿®æ”¹</p><h2 id="Pyplot-tutorial"><a href="#Pyplot-tutorial" class="headerlink" title="Pyplot tutorial"></a>Pyplot tutorial</h2><p><code>matplotlib.pyplot</code> åŒ…å«äº†å„ç§å„æ ·çš„æ¥å£ï¼Œèƒ½å¤Ÿè®©ç”¨æˆ·è½»æ¾åœ°ç»˜å›¾ï¼Œä¸‹é¢å¼•ç”¨ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£</p><blockquote><p>Each <code>pyplot</code> function makes some change to a figure: e.g., creates a figure, creates a plotting area in a figure, plots some lines in a plotting area, decorates the plot with labels, etc.</p><p> It keeps track of things like the current figure and plotting area, and the plotting functions are directed to the current axes.</p></blockquote><h3 id="Intro-to-pyplot"><a href="#Intro-to-pyplot" class="headerlink" title="Intro to pyplot"></a>Intro to pyplot</h3><p>ç»˜åˆ¶ç®€å•æ˜ å°„å‡½æ•° $y = f(x)$ å›¾åƒå¯ä»¥ä½¿ç”¨ <code>plt.plot</code>ï¼Œè¯¦ç»†å†…å®¹æ¨è <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html#matplotlib.pyplot.plot">plot doc</a> </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltplt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'some numbers'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/d1e3c468/sphx_glr_pyplot_001.png" style="zoom: 67%;"></p><p>åªä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè‡ªåŠ¨ä½¿ç”¨å…¶ index ä½œä¸º x è½´ï¼Œå¸¸ç”¨å…¬å¼ä¸ºå¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token punctuation">,</span> fmt<span class="token operator">=</span><span class="token string">'b-'</span><span class="token punctuation">)</span><span class="token comment"># fmt ä»£è¡¨ format 'b-' ä»£è¡¨è“è‰²ç›´çº¿ï¼Œä¸ºé»˜è®¤å€¼ï¼Œå…¶å®ƒ format å¦‚ 'ro' ä»£è¡¨çº¢è‰²åœ†ç‚¹</span><span class="token comment"># x, y å¯ä»¥æ˜¯äºŒç»´çš„ï¼Œè¿™æ ·å°†ç»˜ç”»å¤šä¸ªå‡½æ•°å›¾åƒ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="Formatting-the-style-of-your-plot"><a href="#Formatting-the-style-of-your-plot" class="headerlink" title="Formatting the style of your plot"></a>Formatting the style of your plot</h4><p>å®é™…ä¸Š <code>plt.plot</code> å¯ä»¥æ¥å—ä»»æ„å¤šçš„å‚æ•°ï¼Œä»¥ç»˜ç”»ä»»æ„å¤šä¸ªå‡½æ•°å›¾åƒ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token comment"># evenly sampled time at 200ms intervals</span>t <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token comment"># red dashes, blue squares and green triangles</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>t<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token string">'r--'</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> t<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'bs'</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> t<span class="token operator">**</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'g^'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/d1e3c468/sphx_glr_pyplot_004.png" style="zoom: 67%;"></p><h3 id="Plotting-with-keyword-strings"><a href="#Plotting-with-keyword-strings" class="headerlink" title="Plotting with keyword strings"></a>Plotting with keyword strings</h3><p>å¦‚æœæœ‰ <code>data_dict</code> å­˜æ”¾ç€æ•°æ®ï¼Œåˆ™å¯ä»¥ç›´æ¥é€šè¿‡ <code>data_dict</code> å’Œå…¶ä¸­çš„å…³é”®å­—ç»˜å›¾ï¼Œä¸‹é¢ä½¿ç”¨äº† <code>plt.scatter</code> æ¥ç»˜åˆ¶ä¸€ä¸ªæ•£ç‚¹å›¾ï¼Œ<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.scatter.html?highlight=scatter#matplotlib.pyplot.scatter">scatter doc</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'c'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'d'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">}</span>data<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>data<span class="token punctuation">[</span><span class="token string">'d'</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token comment"># [c]olor, [s]ize</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'entry a'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'entry b'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å›¾åƒå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ•£ç‚¹çš„é¢œè‰²å’Œå¤§å°ä¹Ÿæ˜¯ç”± <code>data</code> å­—å…¸ä¸­çš„ <code>c &amp; d</code> å†³å®šçš„</p><p><img src="/archives/d1e3c468/sphx_glr_pyplot_005.png" style="zoom:67%;"></p><h3 id="Working-with-multiple-figures-and-axes"><a href="#Working-with-multiple-figures-and-axes" class="headerlink" title="Working with multiple figures and axes"></a>Working with multiple figures and axes</h3><p><code>pyplot</code> æœ‰ä¸€ä¸ª current figure/axes æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯å½“å‰åœ¨å“ªä¸ªç”»å¸ƒä¸Šç»˜åˆ¶å“ªä¸ªå›¾åƒï¼Œä¸‹é¢å°±å±•ç¤ºå¦‚ä½•ç»˜åˆ¶ä¸¤ä¸ªå­å›¾</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>t<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>np<span class="token punctuation">.</span>pi<span class="token operator">*</span>t<span class="token punctuation">)</span>t1 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>t2 <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># åˆ›å»º figureï¼Œoptionalï¼Œåˆ›å»ºå­å›¾çš„æ—¶å€™ä¹Ÿä¼šè‡ªåŠ¨åˆ›å»º</span>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span><span class="token comment"># æŒ‡å‘å­å›¾ (2, 1, 1)</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>t1<span class="token punctuation">,</span> f<span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'bo'</span><span class="token punctuation">,</span> t2<span class="token punctuation">,</span> f<span class="token punctuation">(</span>t2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">212</span><span class="token punctuation">)</span><span class="token comment"># åˆ›å»ºå­å›¾ (2, 1, 2)</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>t2<span class="token punctuation">,</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>np<span class="token punctuation">.</span>pi<span class="token operator">*</span>t2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'r--'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥æŠŠ <code>plt</code> çœ‹ä½œä¸€ä¸ªæŒ‡é’ˆæˆ–è€…ç”»ç¬”ï¼Œå®ƒå°†æŒ‡å‘ä½ å°†ç»˜å›¾çš„åœ°æ–¹</p><p><img src="/archives/d1e3c468/sphx_glr_pyplot_007.png" style="zoom: 67%;"></p><p>å…¶ä¸­çš„ <code>211 &amp; 212</code> ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿè¿™å…¶å®æ˜¯ (2, 1, 1) çš„ç®€å†™ï¼Œ<code>subplot(2, 1, 1)</code> ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœï¼Œä¸‰ä¸ªæ•°å­—åˆ†åˆ«è¡¨ç¤ºï¼šnum_rows, num_cols, plot_numberï¼Œå…¶ä¸­ plot_number æ˜¯ä¸€ä¸ªèŒƒå›´ä¸º 1~num_rows * num cols çš„æ•°å­—ï¼Œèƒ½å¤Ÿå®šä½åœ¨å“ªä¸ªå­å›¾ä¸Šç»˜ç”»</p><p>ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ç»˜ç”»å¤šä¸ª figure &amp; subplot</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltplt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token comment"># the first figure</span>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>             <span class="token comment"># the first subplot in the first figure</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">212</span><span class="token punctuation">)</span>             <span class="token comment"># the second subplot in the first figure</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                <span class="token comment"># a second figure</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token comment"># creates a subplot() by default</span>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token comment"># figure 1 current; subplot(212) still current</span>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>             <span class="token comment"># make subplot(211) in figure1 current</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Easy as 1, 2, 3'</span><span class="token punctuation">)</span> <span class="token comment"># subplot 211 title</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/d1e3c468/image-20211114194402180.png" style="zoom:50%;"></p><p>è¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œ <code>plt.gca()</code> ä»£è¡¨è·å¾—å½“å‰ axes (get current axes)</p><h3 id="Plotting-with-categorical-variables"><a href="#Plotting-with-categorical-variables" class="headerlink" title="Plotting with categorical variables"></a>Plotting with categorical variables</h3><p>x è½´ä¸ä»…å¯ä»¥æ˜¯ number è¿˜å¯ä»¥æ˜¯å­—ç¬¦ä¸²åºåˆ— names</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'group_a'</span><span class="token punctuation">,</span> <span class="token string">'group_b'</span><span class="token punctuation">,</span> <span class="token string">'group_c'</span><span class="token punctuation">]</span>values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># ç”»å¸ƒå¤§å°</span>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>names<span class="token punctuation">,</span> values<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>names<span class="token punctuation">,</span> values<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>names<span class="token punctuation">,</span> values<span class="token punctuation">)</span>plt<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'Categorical Plotting'</span><span class="token punctuation">)</span><span class="token comment"># ç»™ Figure æ·»åŠ æ ‡é¢˜</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/d1e3c468/sphx_glr_pyplot_006.png" style="zoom:67%;"></p><h3 id="Controlling-line-properties"><a href="#Controlling-line-properties" class="headerlink" title="Controlling line properties"></a>Controlling line properties</h3><p>å¯ä»¥å¯¹ plot å‡ºæ¥çš„çº¿æ¡çš„å±æ€§è¿›è¡Œè®¾ç½®ï¼Œä¾‹å¦‚é€šè¿‡ <code>plt.setp()</code> æ–¹æ³•ã€‚å®é™…ä¸Š <code>plt.plot()</code> è¿”å›çš„æ˜¯ä¸€ä¸ª <code>Line2D</code> å¯¹è±¡ç»„æˆçš„åˆ—è¡¨ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹ <code>Line2D</code> å¯¹è±¡çš„å±æ€§è¿›è¡Œæ›´æ”¹ <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.lines.Line2D.html#matplotlib.lines.Line2D">Line2D doc</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ç›´æ¥åœ¨ plot æ–¹æ³•ä¸­è¿›è¡Œä¿®æ”¹</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token comment"># ä½¿ç”¨ plt.step()</span>line_1<span class="token punctuation">,</span> line_2 <span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token comment"># use keyword args</span>plt<span class="token punctuation">.</span>setp<span class="token punctuation">(</span>lines<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token comment"># or MATLAB style string value pairs</span>plt<span class="token punctuation">.</span>setp<span class="token punctuation">(</span>line_1<span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'linewidth'</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Working-with-text"><a href="#Working-with-text" class="headerlink" title="Working with text"></a>Working with text</h3><p>é€šè¿‡ <code>text</code> æ–¹æ³•å¯ä»¥ä¸º figure æ·»åŠ æ–‡å­—ï¼Œé€šè¿‡ <code>xlabel, ylable, title</code> ç­‰æ–¹æ³•å¯ä»¥ç»™ figure æ·»åŠ åæ ‡è½´æ ‡ç­¾ä»¥åŠæ ‡é¢˜ï¼Œ<a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.text.html#matplotlib.pyplot.text">text doc</a> <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.xlabel.html#matplotlib.pyplot.xlabel">xlabel doc</a>, <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.ylabel.html#matplotlib.pyplot.ylabel">ylabel doc</a> and <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title">title doc</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">mu<span class="token punctuation">,</span> sigma <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">15</span>x <span class="token operator">=</span> mu <span class="token operator">+</span> sigma <span class="token operator">*</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token comment"># the histogram of the data</span>n<span class="token punctuation">,</span> bins<span class="token punctuation">,</span> patches <span class="token operator">=</span> plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> density<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'g'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.75</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Smarts'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Probability'</span><span class="token punctuation">)</span><span class="token comment"># ç»™ Axes è®¾ç½®æ ‡é¢˜ï¼ŒåŒºåˆ«äº plt.title()</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Histogram of IQ'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">.025</span><span class="token punctuation">,</span> <span class="token string">r'$\mu=100,\ \sigma=15$'</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.03</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># å¯¹è½´è¿›è¡Œè®¾ç½®</span>plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment"># æ ¼ç‚¹è®¾ç½®</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/d1e3c468/sphx_glr_pyplot_008.png" style="zoom:67%;"></p><ol><li><p>æ‰€æœ‰çš„æ–‡å­—å¯¹è±¡éƒ½å¯ä»¥åƒ <code>Line2D</code> ä¸€æ ·è¿›è¡Œå±æ€§è®¾ç½®</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">t <span class="token operator">=</span> plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'my data'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¯ä»¥ä½¿ç”¨ Latex è¯­æ³•è¿›è¡Œæ•°å­¦å…¬å¼çš„ä¹¦å†™</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">r'$\sigma_i=15$'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h4 id="Annotating-text"><a href="#Annotating-text" class="headerlink" title="Annotating text"></a>Annotating text</h4><p>é€šè¿‡ <code>plt.annotate</code> å¯¹å›¾åƒä¸­çš„æŸä¸ªç‚¹è¿›è¡Œæ ‡è®°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token punctuation">)</span>t <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">)</span>s <span class="token operator">=</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>np<span class="token punctuation">.</span>pi<span class="token operator">*</span>t<span class="token punctuation">)</span>line<span class="token punctuation">,</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>t<span class="token punctuation">,</span> s<span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span><span class="token string">'local max'</span><span class="token punctuation">,</span> xy<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xytext<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             arrowprops<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>facecolor<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> shrink<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token punctuation">)</span>plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/d1e3c468/sphx_glr_pyplot_009.png" style="zoom:67%;"></p><h3 id="Nonlinear-axes"><a href="#Nonlinear-axes" class="headerlink" title="Nonlinear axes"></a>Nonlinear axes</h3><p>å¯ä»¥å¯¹åæ ‡è½´è¿›è¡Œç¼©æ”¾ï¼Œä¾‹å¦‚å¯¹æ•°ç¼©æ”¾ <code>plt.xscale('log')</code> æ›´å¤šå°±ä¸å†å™è¿°äº†ï¼Œå¯ä»¥ç›´æ¥å‚è€ƒ <a href="https://matplotlib.org/stable/tutorials/introductory/pyplot.html#logarithmic-and-other-nonlinear-axes">tutorial</a></p><h3 id="ä¿å­˜å›¾ç‰‡"><a href="#ä¿å­˜å›¾ç‰‡" class="headerlink" title="ä¿å­˜å›¾ç‰‡"></a>ä¿å­˜å›¾ç‰‡</h3><p>ä½¿ç”¨ <code>plt.savefig('path\name')</code> å³å¯</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸Šå°±æ˜¯ä¸€äº› matplotlib.pyplot ä¸­çš„åŸºç¡€æ¦‚å¿µï¼ŒæŒæ¡äº†åŸºæœ¬é€»è¾‘è¿‡åï¼Œå°±å¯ä»¥é€šè¿‡æŸ¥è¯¢æ–‡æ¡£è¿›è¡Œæ›´å¤šçš„æ“ä½œäº†ï¼Œæ”¾ä¸¤ä¸ªå‚è€ƒé“¾æ¥</p><ol><li><p><a href="https://github.com/matplotlib/cheatsheets/">Matplotlib Cheat Sheet</a>ï¼ŒæŸ¥çœ‹ä¸€äº›ä»£å·å¾ˆæ–¹ä¾¿</p></li><li><p><a href="https://matplotlib.org/stable/tutorials/introductory/sample_plots.html#sphx-glr-tutorials-introductory-sample-plots-py">Example Gallery</a></p></li></ol><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><p>æ•´ç†ä¸€äº›å¸¸ç”¨çš„ api æ“ä½œ</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Package </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Matplotlib </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 02 é¢„å¤‡çŸ¥è¯†</title>
      <link href="/archives/ca9aa429.html"/>
      <url>/archives/ca9aa429.html</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹ï¼š<a href="https://zh-v2.d2l.ai/chapter_preliminaries/index.html">é¢„å¤‡çŸ¥è¯†</a></p><h1 id="D2L-02-é¢„å¤‡çŸ¥è¯†"><a href="#D2L-02-é¢„å¤‡çŸ¥è¯†" class="headerlink" title="D2L 02 é¢„å¤‡çŸ¥è¯†"></a>D2L 02 é¢„å¤‡çŸ¥è¯†</h1><ol><li>æ‰€æœ‰æœºå™¨å­¦ä¹ æ–¹æ³•éƒ½æ¶‰åŠä»æ•°æ®ä¸­æå–ä¿¡æ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å…ˆå­¦ä¹ ä¸€äº›å…³äº<strong>æ•°æ®çš„å®ç”¨æŠ€èƒ½ï¼ŒåŒ…æ‹¬å­˜å‚¨ã€æ“ä½œå’Œé¢„å¤„ç†æ•°æ®</strong></li><li>æ·±åº¦å­¦ä¹ æ˜¯å…³äº<strong>ä¼˜åŒ–</strong>çš„ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰å‚æ•°çš„æ¨¡å‹ï¼Œæƒ³è¦æ‰¾åˆ°å…¶ä¸­èƒ½æ‹Ÿåˆæ•°æ®çš„æœ€å¥½æ¨¡å‹ã€‚åœ¨ç®—æ³•çš„æ¯ä¸ªæ­¥éª¤ä¸­ï¼Œå†³å®šä»¥ä½•ç§æ–¹å¼è°ƒæ•´å‚æ•°éœ€è¦ä¸€ç‚¹å¾®ç§¯åˆ†çŸ¥è¯†ã€‚æœ¬èŠ‚å°†ç®€è¦ä»‹ç»è¿™äº›çŸ¥è¯†</li><li>æœºå™¨å­¦ä¹ è¿˜æ¶‰åŠå¦‚ä½•åšå‡º<strong>é¢„æµ‹</strong>ï¼šç»™å®šæˆ‘ä»¬è§‚å¯Ÿåˆ°çš„ä¿¡æ¯ï¼ŒæŸäº›æœªçŸ¥å±æ€§å¯èƒ½çš„å€¼æ˜¯å¤šå°‘ï¼Ÿè¦åœ¨ä¸ç¡®å®šçš„æƒ…å†µä¸‹è¿›è¡Œä¸¥æ ¼çš„æ¨ç†ï¼Œæˆ‘ä»¬éœ€è¦å€Ÿç”¨æ¦‚ç‡è¯­è¨€</li></ol><h2 id="2-1-æ•°æ®æ“ä½œ"><a href="#2-1-æ•°æ®æ“ä½œ" class="headerlink" title="2.1 æ•°æ®æ“ä½œ"></a>2.1 æ•°æ®æ“ä½œ</h2><h3 id="Numpy-amp-Pytorch-åŸºç¡€"><a href="#Numpy-amp-Pytorch-åŸºç¡€" class="headerlink" title="Numpy &amp; Pytorch åŸºç¡€"></a>Numpy &amp; Pytorch åŸºç¡€</h3><p>æ ¹æ® <a href="https://github.com/juliangaal/python-cheat-sheet">github é¡¹ç›®</a> å’Œè‡ªå·±çš„ä¸€äº›ç»éªŒï¼Œæ•´ç†äº† Numpy Cheat Sheetï¼Œåœ¨åšå®¢å†…æœç´¢å³å¯ã€‚å­¦ä¹ è¯¥æ•™æä¹Ÿéœ€è¦ä¸€å®šçš„ pytorch åŸºç¡€ï¼ˆå¦‚æœä½ é€‰æ‹© pytorch ä½œä¸ºå·¥å…·çš„è¯ï¼‰ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†</p><h3 id="èŠ‚çœå†…å­˜"><a href="#èŠ‚çœå†…å­˜" class="headerlink" title="èŠ‚çœå†…å­˜"></a>èŠ‚çœå†…å­˜</h3><p>ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•è¿›è¡ŒåŸåœ°æ“ä½œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">Z <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'id(Z):'</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>Z<span class="token punctuation">)</span><span class="token punctuation">)</span>Z<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> X <span class="token operator">+</span> Y<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'id(Z):'</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>Z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># id is the same</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-2-æ•°æ®é¢„å¤„ç†"><a href="#2-2-æ•°æ®é¢„å¤„ç†" class="headerlink" title="2.2 æ•°æ®é¢„å¤„ç†"></a>2.2 æ•°æ®é¢„å¤„ç†</h2><p>æˆ‘ä»¬å°†ç®€è¦ä»‹ç»ä½¿ç”¨<code>pandas</code>é¢„å¤„ç†åŸå§‹æ•°æ®å¹¶å°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºå¼ é‡æ ¼å¼çš„æ­¥éª¤ã€‚å‡è®¾ csv æ•°æ®å¦‚ä¸‹</p><pre class="line-numbers language-csv" data-language="csv"><code class="language-csv"><span class="token value">   NumRooms Alley   Price</span><span class="token value">0       NaN  Pave  127500</span><span class="token value">1       2.0   NaN  106000</span><span class="token value">2       4.0   NaN  178100</span><span class="token value">3       NaN   NaN  140000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ pandas è¯»å– csv æ–‡æ¡£ï¼Œå¹¶å¯¹ NaN å€¼è¿›è¡Œå¤„ç†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token comment"># read_csv</span>data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>data_file<span class="token punctuation">)</span><span class="token comment"># iloc</span>inputs<span class="token punctuation">,</span> outputs <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token comment"># fillna</span>inputs <span class="token operator">=</span> inputs<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è½¬æ¢ä¸º Tensor</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">X<span class="token punctuation">,</span> y <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>values<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ›´å¤šæœ‰å…³ pandas çš„å¤„ç†åç»­å†è¿›è¡Œæ€»ç»“</p><h2 id="2-3-çº¿æ€§ä»£æ•°"><a href="#2-3-çº¿æ€§ä»£æ•°" class="headerlink" title="2.3 çº¿æ€§ä»£æ•°"></a>2.3 çº¿æ€§ä»£æ•°</h2><p>è¿™é‡Œä»…è®°å½•ä¸€äº›è‡ªå·±è§‰å¾—è¯¥æ³¨æ„çš„ç‚¹ï¼Œæ›´åŸºç¡€çš„æ•°å­¦å’Œç¼–ç¨‹çŸ¥è¯†å°±ä¸ä»‹ç»äº†</p><h3 id="ä¸€äº›æ³¨æ„çš„ç‚¹"><a href="#ä¸€äº›æ³¨æ„çš„ç‚¹" class="headerlink" title="ä¸€äº›æ³¨æ„çš„ç‚¹"></a>ä¸€äº›æ³¨æ„çš„ç‚¹</h3><ol><li><p><strong>å‘é‡ä¸å¼ é‡çš„ç»´åº¦</strong></p><p>ç»´åº¦ï¼ˆdimensionï¼‰è¿™ä¸ªè¯åœ¨ä¸åŒä¸Šä¸‹æ–‡æ—¶å¾€å¾€ä¼šæœ‰ä¸åŒçš„å«ä¹‰ï¼Œå‘é‡çš„ç»´åº¦å’Œå¼ é‡çš„ç»´åº¦ç»å¸¸ä¼šä½¿äººæ„Ÿåˆ°å›°æƒ‘ã€‚ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæˆ‘ä»¬åœ¨æ­¤æ˜ç¡®ä¸€ä¸‹ï¼š</p><ol><li>å‘é‡æˆ–è½´çš„ç»´åº¦è¢«ç”¨æ¥è¡¨ç¤ºå‘é‡æˆ–è½´çš„é•¿åº¦ï¼Œå³å‘é‡æˆ–è½´çš„å…ƒç´ æ•°é‡</li><li>å¼ é‡çš„<strong>ç»´åº¦</strong>ç”¨æ¥è¡¨ç¤ºå¼ é‡å…·æœ‰çš„è½´æ•°ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œå¼ é‡çš„æŸä¸ªè½´çš„<strong>ç»´æ•°</strong>å°±æ˜¯è¿™ä¸ªè½´çš„é•¿åº¦</li></ol><p>ä¸¤ä¸ªçŸ©é˜µçš„æŒ‰å…ƒç´ ä¹˜æ³•ç§°ä¸º<strong>å“ˆè¾¾ç›ç§¯ï¼ˆHadamard productï¼‰</strong>ï¼ˆæ•°å­¦ç¬¦å·âŠ™ï¼‰</p></li><li><p><strong>éé™ç»´æ±‚å’Œ</strong></p><p>æœ‰æ—¶åœ¨è°ƒç”¨å‡½æ•°æ¥è®¡ç®—æ€»å’Œæˆ–å‡å€¼æ—¶ä¿æŒè½´æ•°ä¸å˜ä¼šå¾ˆæœ‰ç”¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">sum_A <span class="token operator">=</span> A<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> keepdims<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><strong>å“ˆè¾¾ç›ç§¯ï¼ˆHadamard productï¼‰</strong></p><p>ä¸¤ä¸ªçŸ©é˜µçš„æŒ‰å…ƒç´ ä¹˜æ³•ç§°ä¸ºå“ˆè¾¾ç›ç§¯ï¼ˆHadamard productï¼‰ï¼ˆæ•°å­¦ç¬¦å·âŠ™ï¼‰</p></li><li><p>èŒƒæ•°è®¡ç®—</p><pre class="line-numbers language-PYTHON" data-language="PYTHON"><code class="language-PYTHON"># L2 or Frobenius normu = torch.tensor([3.0, -4.0])torch.norm(u)# L1torch.abs(u).sum()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="çº¿æ€§ä»£æ•°ä¸æœºå™¨å­¦ä¹ "><a href="#çº¿æ€§ä»£æ•°ä¸æœºå™¨å­¦ä¹ " class="headerlink" title="çº¿æ€§ä»£æ•°ä¸æœºå™¨å­¦ä¹ "></a>çº¿æ€§ä»£æ•°ä¸æœºå™¨å­¦ä¹ </h3><blockquote><p>ä»…ç”¨ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°±æ•™ä¼šäº†ä½ æ‰€éœ€çš„ï¼Œç”¨ä»¥ç†è§£å¤§é‡çš„ç°ä»£æ·±åº¦å­¦ä¹ çš„å…¨éƒ¨çº¿æ€§ä»£æ•°ã€‚ çº¿æ€§ä»£æ•°è¿˜æœ‰å¾ˆå¤šï¼Œå…¶ä¸­å¾ˆå¤šæ•°å­¦å¯¹äºæœºå™¨å­¦ä¹ éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼ŒçŸ©é˜µå¯ä»¥åˆ†è§£ä¸ºå› å­ï¼Œè¿™äº›åˆ†è§£å¯ä»¥æ˜¾ç¤ºçœŸå®ä¸–ç•Œæ•°æ®é›†ä¸­çš„ä½ç»´ç»“æ„ã€‚æœºå™¨å­¦ä¹ çš„æ•´ä¸ªå­é¢†åŸŸéƒ½ä¾§é‡äºä½¿ç”¨çŸ©é˜µåˆ†è§£åŠå…¶å‘é«˜é˜¶å¼ é‡çš„æ³›åŒ–æ¥å‘ç°æ•°æ®é›†ä¸­çš„ç»“æ„å¹¶è§£å†³é¢„æµ‹é—®é¢˜ã€‚ä½†è¿™æœ¬ä¹¦çš„é‡ç‚¹æ˜¯æ·±åº¦å­¦ä¹ ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œä¸€æ—¦ä½ å¼€å§‹åŠ¨æ‰‹å°è¯•å¹¶åœ¨çœŸå®æ•°æ®é›†ä¸Šåº”ç”¨äº†æœ‰æ•ˆçš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œä½ ä¼šæ›´å€¾å‘äºå­¦ä¹ æ›´å¤šæ•°å­¦ã€‚å› æ­¤ï¼Œè™½ç„¶æˆ‘ä»¬ä¿ç•™åœ¨åé¢ä»‹ç»æ›´å¤šæ•°å­¦çŸ¥è¯†çš„æƒåˆ©ï¼Œä½†æˆ‘ä»¬è¿™ä¸€èŠ‚åˆ°æ­¤ç»“æŸã€‚</p></blockquote><p>è¿™æœ€åçš„å°ç»“éå¸¸æœ‰æ„æ€ï¼Œè¯´æ˜äº†æœºå™¨å­¦ä¹ éœ€è¦æ›´å¤šçš„æ•°å­¦çŸ¥è¯†ï¼Œä½†æ·±åº¦å­¦ä¹ æ‰€éœ€è¦çš„çº¿æ€§ä»£æ•°çŸ¥è¯†å°±åˆ°æ­¤ä¸ºæ­¢äº†â€¦å¯ä»¥è¯´æ•°å­¦é—¨æ§›æ˜¯ç›¸å½“ä½äº†ï¼Œä¸è¿‡æœºå™¨å­¦ä¹ ç»™äººæ›´æ‰å®çš„æ„Ÿå—ï¼Œä»¥åæœ‰æ—¶é—´å†æ•´ç†ä¸€ä¸‹æœºå™¨å­¦ä¹ é¢†åŸŸçš„çŸ¥è¯†å§ğŸ˜€</p><h2 id="2-4-å¾®åˆ†"><a href="#2-4-å¾®åˆ†" class="headerlink" title="2.4 å¾®åˆ†"></a>2.4 å¾®åˆ†</h2><p>é‡è¦æ¦‚å¿µï¼šå¯¼æ•°ï¼Œå¾®åˆ†ï¼Œåå¾®åˆ†ï¼Œæ¢¯åº¦ï¼Œé“¾å¼æ³•åˆ™ã€‚å½“æ‰©å±•åˆ°å¼ é‡é˜¶æ®µçš„æ—¶å€™ï¼Œéœ€è¦å‚è€ƒå·¥ç¨‹çŸ©é˜µä¸­çš„çŸ¥è¯†ï¼Œä¸‹é¢è´´ä¸€ä¸ªæ¢¯åº¦çš„å…¬å¼</p><script type="math/tex; mode=display">\nabla_{\mathbf{x}} f(\mathbf{x})=\left[\frac{\partial f(\mathbf{x})}{\partial x_{1}}, \frac{\partial f(\mathbf{x})}{\partial x_{2}}, \ldots, \frac{\partial f(\mathbf{x})}{\partial x_{n}}\right]^{\top}</script><h2 id="2-5-è‡ªåŠ¨å¾®åˆ†"><a href="#2-5-è‡ªåŠ¨å¾®åˆ†" class="headerlink" title="2.5 è‡ªåŠ¨å¾®åˆ†"></a>2.5 è‡ªåŠ¨å¾®åˆ†</h2><p>å…³äºè‡ªåŠ¨å¾®åˆ†ï¼Œå¯ä»¥æŸ¥çœ‹åšå®¢ä¸­çš„ <a href="https://hongkun.space/archives/6c437432.html#toc-heading-17">pytorch tutorial</a> é‡Œé¢æ›´è¯¦ç»†åœ°ä»‹ç»äº†è‡ªåŠ¨å¾®åˆ†æ“ä½œã€‚å½“åŠ å…¥äº†å¼ é‡è¿ç®—åè‡ªåŠ¨å¾®åˆ†ä¼šå˜å¾—ä¸é‚£ä¹ˆæ˜¾ç„¶ï¼Œå¯ä»¥è‡ªè¡Œæ¨å¯¼ä¸€ä¸‹çŸ©é˜µç›¸ä¹˜æ—¶çš„ä¸€èˆ¬ç»“è®ºï¼Œä»¥åŠ sigmoid å‡½æ•°çš„è‡ªåŠ¨å¾®åˆ†æƒ…å†µ</p><h2 id="2-6-æ¦‚ç‡"><a href="#2-6-æ¦‚ç‡" class="headerlink" title="2.6 æ¦‚ç‡"></a>2.6 æ¦‚ç‡</h2><p>é‡è¦æ¦‚å¿µï¼šæ¦‚ç‡è®ºåŸºæœ¬å…¬å¼ï¼Œéšæœºå˜é‡ï¼Œè”åˆæ¦‚ç‡ï¼Œæ¡ä»¶æ¦‚ç‡ï¼Œè´å¶æ–¯å®šç†ï¼Œè¾¹é™…æ¦‚ç‡ï¼Œç‹¬ç«‹æ€§ï¼ŒæœŸæœ›ï¼Œæ–¹å·®ï¼Œåæ–¹å·®â€¦</p><p>æ¦‚ç‡è®ºå’ŒçŸ©é˜µè®ºéƒ½æ˜¯æˆ‘éå¸¸è–„å¼±çš„ç¯èŠ‚ğŸ˜­ï¼Œå¸Œæœ›æœ‰æ—¶é—´ä¸€å®šè¦å¥½å¥½é‡æ–°å­¦è¿‡ï¼ï¼ï¼</p><h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><ol><li>å®Œæˆ matplotlib æ•´ç†</li><li>å®Œæˆæ¦‚ç‡è®ºï¼Œçº¿æ€§ä»£æ•°çš„æ·±å…¥å­¦ä¹ </li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MMDetection3D &amp; OpenPCDet Installation</title>
      <link href="/archives/93e5b117.html"/>
      <url>/archives/93e5b117.html</url>
      
        <content type="html"><![CDATA[<h1 id="MMDetection3D-amp-OpenPCDet"><a href="#MMDetection3D-amp-OpenPCDet" class="headerlink" title="MMDetection3D &amp; OpenPCDet"></a>MMDetection3D &amp; OpenPCDet</h1><h2 id="Install-mmdet3d"><a href="#Install-mmdet3d" class="headerlink" title="Install mmdet3d"></a>Install mmdet3d</h2><p>å¯ä»¥å‚è€ƒ <a href="https://mmdetection3d.readthedocs.io/en/latest/getting_started.html#">å®˜æ–¹ doc</a> è¿›è¡Œä¸‹è½½ã€‚å…¶ä¸­æä¾›äº†å¦‚ä½•ä½¿ç”¨ conda ä»é›¶ä¸‹è½½ï¼Œä½†æ˜¯ç¯å¢ƒä¸ä»…ä»…åŒ…å« conda ç¯å¢ƒï¼Œè¿˜æœ‰ GCC, CUDA ç­‰ç¼–è¯‘ç¯å¢ƒã€‚æ‰€ä»¥æ›´å¥½çš„é€‰æ‹©æ˜¯ä½¿ç”¨ docker è¿›è¡Œå®‰è£…ï¼Œè¿™æ ·èƒ½å¤Ÿä¸€æ­¥è§£å†³æ‰€æœ‰ç¯å¢ƒé—®é¢˜ï¼Œä¸“æ³¨äºä»£ç </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># build an image with PyTorch 1.6, CUDA 10.1</span>docker build -t mmdetection3d docker/docker run --gpus all --shm-size<span class="token operator">=</span>8g -it -v <span class="token punctuation">{</span>DATA_DIR<span class="token punctuation">}</span>:/mmdetection3d/data mmdetection3d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºæ¯æ¬¡å¯åŠ¨ docker éƒ½è¦ä¼ å…¥å¾ˆå¤šå‚æ•°ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè®°å½•å¯åŠ¨å®¹å™¨çš„å‘½ä»¤ï¼Œä»¥åç›´æ¥å¤åˆ¶ç²˜è´´</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker run --gpus all --shm-size<span class="token operator">=</span>8g -it -v /home/chk/data:/shared -v /home/chk/.Xauthority:/root/.Xauthority -e <span class="token environment constant">DISPLAY</span> --net<span class="token operator">=</span>host --name<span class="token comment"># å…¶ä¸­ -e å’Œ --net æ˜¯ä¸ºäº†è®¾ç½®å›¾å½¢åŒ–æ“ä½œï¼Œåœ¨ä¹‹åè¯¦ç»†ä»‹ç»</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸¤ä¸ªé—®é¢˜</p><ol><li><p>clone MMDetection3D æ—¶ç½‘ç»œå‡ºäº†é—®é¢˜ï¼Œclone å¤±è´¥äº†ã€‚å†æ¬¡å°è¯• <code>docker build</code> åæˆåŠŸ</p></li><li><p>å…¶ä¸­æœ‰ä¸ªå°æŠ¥é”™ <code>ERROR: nbconvert 5.6.0 has requirement traitlets&gt;=4.2, but you'll have traitlets 4.1.0 which is inco</code></p><p>ä½†æ˜¯æœ€ç»ˆæ˜¾ç¤ºæ˜¯æˆåŠŸå®‰è£…ï¼ŒæŸ¥äº†ä¸€ä¸‹è¿™ä¸ªåº“ï¼Œæ˜¯ç”¨äºå°† notebooks è½¬ä¸ºå…¶ä»–æ ¼å¼çš„ï¼Œå…ˆæš‚æ—¶å¿½ç•¥ã€‚å¦‚é‡åˆ°æŠ¥é”™åˆ™å°è¯•ä½¿ç”¨ pip å‡çº§ä»¥ç¬¦åˆæ¡ä»¶</p></li></ol><h3 id="Nvidia-Docker"><a href="#Nvidia-Docker" class="headerlink" title="Nvidia-Docker"></a>Nvidia-Docker</h3><p>ä¸ºäº†è®©å®¹å™¨èƒ½å¤Ÿä½¿ç”¨ GPUï¼Œéœ€è¦å®‰è£… Nvidia-dockerï¼Œè¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡ <a href="https://zhuanlan.zhihu.com/p/361934132">çŸ¥ä¹</a></p><h2 id="Verify"><a href="#Verify" class="headerlink" title="Verify"></a>Verify</h2><p>æ¥è¿è¡Œå®˜æ–¹ <a href="https://mmdetection3d.readthedocs.io/en/latest/demo.html">demo</a> éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</p><p>ä¸‹è½½å¥½ SECOND æ¨¡å‹ï¼Œç„¶åè¿è¡Œè„šæœ¬</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python demo/pcd_demo.py demo/data/kitti/kitti_000008.bin configs/second/hv_second_secfpn_6x8_80e_kitti-3d-car.py checkpoints/hv_second_secfpn_6x8_80e_kitti-3d-car_20200620_230238-393f000c.pth<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æœ€åå¾—åˆ°æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:  File <span class="token string">"demo/pcd_demo.py"</span>, line <span class="token number">4</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>    from mmdet3d.apis <span class="token function">import</span> inference_detector, init_model, show_result_meshlab  File <span class="token string">"/mmdetection3d/mmdet3d/__init__.py"</span>, line <span class="token number">5</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>    <span class="token function">import</span> mmseg  File <span class="token string">"/opt/conda/lib/python3.7/site-packages/mmseg/__init__.py"</span>, line <span class="token number">59</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>    f<span class="token string">'MMCV=={mmcv.__version__} is used but incompatible. '</span> <span class="token punctuation">\</span>AssertionError: <span class="token assign-left variable">MMCV</span><span class="token operator">==</span><span class="token number">1.3</span>.8 is used but incompatible. Please <span class="token function">install</span> mmcv<span class="token operator">&gt;=</span><span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span>, <span class="token number">13</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span><span class="token punctuation">)</span>, <span class="token operator">&lt;=</span><span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">4</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span><span class="token punctuation">)</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨å°è¯•å‡çº§ MMCV ä»¥è§£å†³ã€‚ä¿®æ”¹ dockerfile ä¸­çš„ mmcv ç‰ˆæœ¬ä¸º 1.3.13ï¼Œé‡æ–°ç”Ÿæˆé•œåƒå’Œå¯¹åº”å®¹å™¨ã€‚ç”±äºç›®å‰å®éªŒå®¤çš„ GPU æœ‰å…¶ä»–äººåœ¨è·‘é¡¹ç›®ï¼Œæ‰€ä»¥éªŒè¯çš„æ—¶å€™å‘ç”Ÿé”™è¯¯ <a href="https://github.com/open-mmlab/mmdetection3d/issues/21">github issue</a></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">RuntimeError: /mmdetection3d/mmdet3d/ops/spconv/src/indice_cuda.cu <span class="token number">124</span>cuda execution failed with error <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>åº”è¯¥æ˜¯ç”±äºæ˜¾å­˜ä¸è¶³å¯¼è‡´çš„ï¼Œäºæ˜¯é€‰æ‹©äº†ä¸€ä¸ªè¾ƒå°çš„æ¨¡å‹ PointNet++ è¿›è¡Œäº†éªŒè¯ï¼Œæœ€ç»ˆ demo èƒ½å¤Ÿè¿è¡Œï¼Œæ•…ä»¥ä¸Šå‡çº§æ˜¯æœ‰æ•ˆçš„ã€‚åœ¨ MeshLab ä¸­è¿›è¡Œå¯è§†åŒ–æŸ¥çœ‹ PointNet++ åˆ†å‰²æ•ˆæœ</p><p><img src="/archives/93e5b117/image-20211028172827565.png" style="zoom:50%;"></p><p>ç­‰æœåŠ¡å™¨ç©ºé—²äº†ï¼Œæµ‹è¯•äº† SECONDï¼Œä¹Ÿå¯ä»¥è¿è¡Œ</p><p><img src="/archives/93e5b117/image-20211029132630612.png" style="zoom: 67%;"></p><h2 id="Work-with-VSCode"><a href="#Work-with-VSCode" class="headerlink" title="Work with VSCode"></a>Work with VSCode</h2><h3 id="VSCode-with-container"><a href="#VSCode-with-container" class="headerlink" title="VSCode with container"></a>VSCode with container</h3><p>æƒ³è¦ vscode ç¼–è¾‘ docker å®¹å™¨ä¸­çš„æ–‡ä»¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹æ³• </p><ol><li><p>ä¸‹è½½ docker å’Œ remote-container æ’ä»¶</p></li><li><p>åœ¨ side bar ä¸­å¯ä»¥çœ‹åˆ° docker å·¥å…·æ ï¼Œå¯ä»¥è½»æ¾å¯åŠ¨å®¹å™¨</p><p><img src="/archives/93e5b117/image-20211028115235998.png"></p></li><li><p>å¯åŠ¨å®¹å™¨åï¼Œé€‰æ‹© <code>Attach Visual Studio Code</code> å°±å¯ä»¥æ‰“å¼€æ–°çš„çª—å£ï¼Œæ–°çª—å£çš„ç•Œé¢å°±åƒ vscode åœ¨å®¹å™¨ä¸­è¿è¡Œä¸€æ ·</p><p><img src="/archives/93e5b117/image-20211028115404905.png"></p></li></ol><p>å¦‚æœåœ¨ Linux ä¸Šé‡åˆ°è¿æ¥é—®é¢˜ <code>error "connect EACCES /var/run/docker.sock"</code> è¿™æ˜¯ç”±äº docker æƒé™é€ æˆï¼Œå¯ä»¥æŒ‰ç…§ <a href="https://github.com/microsoft/vscode-docker/wiki/Troubleshooting">å®˜æ–¹æç¤º</a>  å¯ä»¥å°è¯•è§£å†³ã€‚å¦‚æœè¿˜ä¸èƒ½è§£å†³ï¼Œç›´æ¥é€šè¿‡ä¿®æ”¹ <code>docker.sock</code> æ–‡ä»¶çš„æƒé™ä¸€æ­¥åˆ°ä½</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">666</span> /var/run/docker.sock<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="VSCode-å…å¯†ç™»å½•"><a href="#VSCode-å…å¯†ç™»å½•" class="headerlink" title="VSCode å…å¯†ç™»å½•"></a>VSCode å…å¯†ç™»å½•</h3><p>å®Œæˆä»¥ä¸‹æ­¥éª¤å³å¯ï¼š</p><ol><li><p>ç”Ÿæˆæœ¬åœ° ssh-keyï¼Œå’Œ git æ“ä½œæ˜¯ä¸€æ ·çš„</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ssh-keygen -t rsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å°† <code>id_rsa.pub</code> å¤åˆ¶åˆ°æœåŠ¡å™¨ä¸»æœº <code>~/.ssh</code> æ–‡ä»¶å¤¹ä¸‹ï¼Œå°† <code>id_rsa.pub</code> çš„å†…å®¹åŠ å…¥åˆ° <code>authorized_keys</code> ä¸­</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">cat</span> id_rsa.pub <span class="token operator">&gt;&gt;</span> authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>é‡å¯ ssh æœåŠ¡ <code>service sshd restart</code></p></li></ol><p>å…¶ä»–æ“ä½œå’Œä¸€èˆ¬ remote-ssh æ˜¯ä¸€æ ·çš„ï¼ŒæŒ‰é»˜è®¤å¡«å†™é…ç½®æ–‡ä»¶å³å¯ï¼Œä¸éœ€è¦é…ç½® <code>IdentityFile</code> å…³é”®å­—</p><pre class="line-numbers language-config" data-language="config"><code class="language-config">Host Arbitrary_Nane  HostName Host_ip  User User_Name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="VSCode-X11-forward"><a href="#VSCode-X11-forward" class="headerlink" title="VSCode X11 forward"></a>VSCode X11 forward</h3><p>ä½¿ç”¨ X server è§£å†³æ— æ³•å¯è§†åŒ–å›¾å½¢ç•Œé¢çš„é—®é¢˜ã€‚ä¸€èˆ¬æ¥è®²ä½¿ç”¨ ssh è¿æ¥åˆ°æœåŠ¡å™¨åæ˜¯ä¸èƒ½ä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢æœåŠ¡çš„ï¼Œä¾‹å¦‚ä½¿ç”¨  firefox æµè§ˆå™¨ã€‚ä¸€äº›è½¯ä»¶è‡ªå¸¦ X serverï¼Œä¾‹å¦‚ MobaXtermï¼Œå½“è¿æ¥ä¸ŠæœåŠ¡å™¨åï¼Œå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œè¾“å…¥ <code>firefox</code>ï¼Œç„¶åå°±èƒ½å¼¹å‡ºæµè§ˆå™¨çª—å£ã€‚å¦‚æœç”µè„‘ä¸Šæ²¡æœ‰ X server åˆ™éœ€è¦è‡ªè¡Œå®‰è£…ï¼Œæˆ–è€…ç›´æ¥æŠŠ MobaXterm æŒ‚åœ¨æ—è¾¹å³å¯ã€‚æ›´å¤šç§‘æ™®å†…å®¹å‚è€ƒ <a href="https://www.jianshu.com/p/1a296191a122">åšå®¢</a></p><p>ç°åœ¨åœ¨ VSCode Remote-SSH ä¸Šä¹Ÿæ”¯æŒäº† X11 forwardingï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®Œæˆ</p><p>é¦–å…ˆä¿®æ”¹é…ç½® vscode <code>settings.json</code> ä¸­ <code>terminal.integrated.env.windows</code> å­—æ®µï¼Œæ·»åŠ æœ¬åœ°æ˜¾ç¤ºå˜é‡</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">   <span class="token property">"terminal.integrated.env.windows"</span><span class="token operator">:</span> <span class="token punctuation">{</span>       <span class="token property">"DISPLAY"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1:0.0"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨ ssh é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ç›¸å…³å­—æ®µ</p><pre class="line-numbers language-config" data-language="config"><code class="language-config">Host Arbitrary_Nane  HostName Host_ip  User User_Name  ForwardAgent yes  ForwardX11 yes  ForwardX11Trusted yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ååœ¨æœåŠ¡å™¨ä¸ŠæŒ‡å®š <code>DISPLAY</code> ç¯å¢ƒå˜é‡</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">DISPLAY</span></span><span class="token operator">=</span><span class="token string">"localhost:10.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ³¨æ„ï¼Œ10.0 è¿™ä¸ªæ•°å­—æ˜¯æ ¹æ® .Xauthority æ–‡ä»¶ç¡®å®šï¼Œå¯ä»¥é€šè¿‡ xauth list å‘½ä»¤æŸ¥çœ‹ã€‚å¾—åˆ°åˆ—è¡¨å¯èƒ½ä¼šæ¯”è¾ƒé•¿ï¼Œæˆ‘å¯¹è¿™ä¸€å—ä¸æ˜¯å¾ˆäº†è§£â€¦ç»éªŒæ¥çœ‹ï¼Œå…³æ³¨çš„æ˜¯æœ€åä¸€è¡Œï¼Œæˆ–è€… unix:index æœ€å°çš„é‚£ä¸€è¡Œ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">user@linux xauth listlinux/unix:12  MIT-MAGIC-COOKIE-1  78cbc********************c64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™é‡Œçœ‹åˆ° <code>unix:12</code> æ‰€ä»¥æˆ‘ä»¬é…ç½® <code>DISPLAY</code> å˜é‡æ—¶åº”è¯¥ä¸º <code>export DISPLAY="localhost:12.0"</code></p><p>ä½¿ç”¨ <code>xeyes</code> æµ‹è¯•ä¸€ä¸‹ï¼Œå¦‚æœçœ‹åˆ°ä¸€ä¸ªçœ¼ç›çª—å£å°±æˆåŠŸäº†ğŸ˜</p><h3 id="Docker-with-GUI"><a href="#Docker-with-GUI" class="headerlink" title="Docker with GUI"></a>Docker with GUI</h3><p>å¦‚æœèƒ½å¤Ÿåœ¨ Docker ä¸­ä½¿ç”¨ GUI app å²‚ä¸æ˜¯ç¾æ»‹æ»‹ï¼Ÿæ—¢ç„¶èƒ½å¤Ÿåœ¨ VSCode ä¸­é€šè¿‡ X11 forward åè®®è¿è¡Œå›¾å½¢ç•Œé¢ï¼Œé‚£ä¹ˆç†è®ºä¸Š Docker ä¹Ÿæ˜¯å¯ä»¥çš„ï¼æ ¹æ®è¿™ä¸¤ä¸ªåšå®¢ï¼š<a href="https://www.cnblogs.com/larva-zhh/p/10531824.html">Link-1</a> <a href="https://medium.com/@SaravSun/running-gui-applications-inside-docker-containers-83d65c0db110">Link-2</a> è¿›è¡Œé…ç½®ï¼Œæ„æƒ³ä¸åˆ°åœ°æˆåŠŸäº†ï¼Œè¯´æ˜åšå®¢ä¸­çš„åŸç†æ˜¯æ­£ç¡®çš„ï¼Œåªè¦å°† Host ä¸­çš„ X11 æœåŠ¡å™¨åˆ†äº«ç»™ Docker å°±å¯ä»¥ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>Share the Hostâ€™s XServer with the Container by creating a volume</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">--volume<span class="token operator">=</span><span class="token string">"<span class="token environment constant">$HOME</span>/.Xauthority:/root/.Xauthority:rw"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡ç™»å½•çš„æ—¶ Host <code>.Xauthority</code> æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¦‚æœç›´æ¥å¤åˆ¶è¯¥æ–‡ä»¶çš„è¯ï¼Œè¦æ¯æ¬¡æ›´æ–°</p></li><li><p>share the Hostâ€™s <strong>DISPLAY</strong> environment variable to the Container</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">--env<span class="token operator">=</span><span class="token string">"DISPLAY"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>Run container with <strong>host</strong> network driver with</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">--net<span class="token operator">=</span>host<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h2 id="KITTI"><a href="#KITTI" class="headerlink" title="KITTI"></a>KITTI</h2><p>ä½¿ç”¨ KITTI æ•°æ®é›†è¿›è¡Œå®éªŒï¼Œä¸‹è½½é€šè¿‡ <a href="https://gas.graviti.cn/dataset/data-decorators/KITTIObject">GRAVITI</a></p><p><img src="/archives/93e5b117/image-20211028134043307.png" style="zoom:80%;"></p><p>å°†æ•°æ®é›†æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œå…¨éƒ¨è§£å‹</p><h2 id="SECOND-on-MMDetection3D"><a href="#SECOND-on-MMDetection3D" class="headerlink" title="SECOND on MMDetection3D"></a>SECOND on MMDetection3D</h2><p>å…ˆå°è¯•æµ‹è¯•ä¸€ä¸‹ç»å…¸çš„ backbone SECOND èƒ½ä¸èƒ½è¿è¡Œ</p><h3 id="Test-SECOND"><a href="#Test-SECOND" class="headerlink" title="Test SECOND"></a>Test SECOND</h3><ol><li><p>ä¸‹è½½ <a href="https://github.com/open-mmlab/mmdetection3d/blob/master/configs/second/README.md">SECOND</a> æ¨¡å‹</p></li><li><p>æ ¹æ® <a href="https://mmdetection3d.readthedocs.io/en/latest/datasets/kitti_det.html">doc</a> ç”Ÿæˆæ•°æ®é›†ï¼Œå…¶ä¸­ç”Ÿæˆäº†ä¸€äº› pkl æ–‡ä»¶ç”¨äºå­˜å‚¨æ•°æ®é›†æ¯ä¸ªæ ·æœ¬çš„ç›¸å…³ä¿¡æ¯ï¼Œå…³äº pkl æ–‡ä»¶å¯ä»¥å‚è€ƒ <a href="https://blog.csdn.net/Ving_x/article/details/114488844">CSDN</a>ã€‚ä¸‹é¢æ˜¯ç¨‹åºè¿è¡Œä¸­æœ€åçš„è¾“å‡º</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">load <span class="token number">2207</span> Pedestrian database infosload <span class="token number">14357</span> Car database infosload <span class="token number">734</span> Cyclist database infosload <span class="token number">1297</span> Van database infosload <span class="token number">488</span> Truck database infosload <span class="token number">224</span> Tram database infosload <span class="token number">337</span> Misc database infosload <span class="token number">56</span> Person_sitting database infos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>Test SECOND on KITTI valï¼Œå…¶ä¸­ <code>AP@0.5 0.5 0.5</code> ä»£è¡¨ bbox, bev, 3d ä»»åŠ¡çš„ IoU é˜ˆå€¼åˆ†åˆ«ä¸º 0.5, 0.5, 0.5ï¼Œåˆ—å‡º Car ç›¸å…³çš„éƒ¨åˆ†</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Result is saved to /tmp/tmp50avi_bh/results.pkl.Car AP@0.70, <span class="token number">0.70</span>, <span class="token number">0.70</span>:bbox AP:98.1839, <span class="token number">89.7606</span>, <span class="token number">88.7837</span>bev  AP:89.6905, <span class="token number">87.4570</span>, <span class="token number">85.4865</span>3d   AP:87.4561, <span class="token number">76.7570</span>, <span class="token number">74.1302</span>aos  AP:97.70, <span class="token number">88.73</span>, <span class="token number">87.34</span>Car AP@0.70, <span class="token number">0.50</span>, <span class="token number">0.50</span>:bbox AP:98.1839, <span class="token number">89.7606</span>, <span class="token number">88.7837</span>bev  AP:98.4400, <span class="token number">90.1218</span>, <span class="token number">89.6270</span>3d   AP:98.3329, <span class="token number">90.0209</span>, <span class="token number">89.4035</span>aos  AP:97.70, <span class="token number">88.73</span>, <span class="token number">87.34</span>Overall AP@easy, moderate, hard:bbox AP:84.0061, <span class="token number">75.7857</span>, <span class="token number">73.6821</span>bev  AP:80.2144, <span class="token number">72.7919</span>, <span class="token number">69.1538</span>3d   AP:76.7926, <span class="token number">66.6667</span>, <span class="token number">62.3905</span>aos  AP:80.79, <span class="token number">72.30</span>, <span class="token number">70.19</span><span class="token punctuation">{</span><span class="token string">'KITTI/Car_3D_easy_strict'</span><span class="token builtin class-name">:</span> <span class="token number">87.45610724795893</span>, <span class="token string">'KITTI/Car_BEV_easy_strict'</span><span class="token builtin class-name">:</span> <span class="token number">89.69046011671303</span>, <span class="token string">'KITTI/Car_2D_easy_strict'</span><span class="token builtin class-name">:</span> <span class="token number">98.18389028596552</span>, <span class="token string">'KITTI/Car_3D_moderate_strict'</span><span class="token builtin class-name">:</span> <span class="token number">76.75701107649772</span>, <span class="token string">'KITTI/Car_BEV_moderate_strict'</span><span class="token builtin class-name">:</span> <span class="token number">87.45702960861706</span>, <span class="token string">'KITTI/Car_2D_moderate_strict'</span><span class="token builtin class-name">:</span> <span class="token number">89.76058109581083</span>, <span class="token string">'KITTI/Car_3D_hard_strict'</span><span class="token builtin class-name">:</span> <span class="token number">74.13015065869207</span>, <span class="token string">'KITTI/Car_BEV_hard_strict'</span><span class="token builtin class-name">:</span> <span class="token number">85.4865455582404</span>, <span class="token string">'KITTI/Car_2D_hard_strict'</span><span class="token builtin class-name">:</span> <span class="token number">88.78373491728972</span>, <span class="token string">'KITTI/Car_3D_easy_loose'</span><span class="token builtin class-name">:</span> <span class="token number">98.33288257217502</span>, <span class="token string">'KITTI/Car_BEV_easy_loose'</span><span class="token builtin class-name">:</span> <span class="token number">98.4400221898542</span>, <span class="token string">'KITTI/Car_2D_easy_loose'</span><span class="token builtin class-name">:</span> <span class="token number">98.18389028596552</span>, <span class="token string">'KITTI/Car_3D_moderate_loose'</span><span class="token builtin class-name">:</span> <span class="token number">90.02090501786836</span>, <span class="token string">'KITTI/Car_BEV_moderate_loose'</span><span class="token builtin class-name">:</span> <span class="token number">90.12184507731126</span>, <span class="token string">'KITTI/Car_2D_moderate_loose'</span><span class="token builtin class-name">:</span> <span class="token number">89.76058109581083</span>, <span class="token string">'KITTI/Car_3D_hard_loose'</span><span class="token builtin class-name">:</span> <span class="token number">89.40349529357029</span>, <span class="token string">'KITTI/Car_BEV_hard_loose'</span><span class="token builtin class-name">:</span> <span class="token number">89.62702775979791</span>, <span class="token string">'KITTI/Car_2D_hard_loose'</span><span class="token builtin class-name">:</span> <span class="token number">88.78373491728972</span>, <span class="token string">'KITTI/Overall_3D_easy'</span><span class="token builtin class-name">:</span> <span class="token number">76.79258397928281</span>, <span class="token string">'KITTI/Overall_BEV_easy'</span><span class="token builtin class-name">:</span> <span class="token number">80.21439732105783</span>, <span class="token string">'KITTI/Overall_2D_easy'</span><span class="token builtin class-name">:</span> <span class="token number">84.00606839712997</span>, <span class="token string">'KITTI/Overall_3D_moderate'</span><span class="token builtin class-name">:</span> <span class="token number">66.6666643647041</span>, <span class="token string">'KITTI/Overall_BEV_moderate'</span><span class="token builtin class-name">:</span> <span class="token number">72.7919003517221</span>, <span class="token string">'KITTI/Overall_2D_moderate'</span><span class="token builtin class-name">:</span> <span class="token number">75.78568527747004</span>, <span class="token string">'KITTI/Overall_3D_hard'</span><span class="token builtin class-name">:</span> <span class="token number">62.39046573028369</span>, <span class="token string">'KITTI/Overall_BEV_hard'</span><span class="token builtin class-name">:</span> <span class="token number">69.15381069261458</span>, <span class="token string">'KITTI/Overall_2D_hard'</span><span class="token builtin class-name">:</span> <span class="token number">73.68210872556001</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>ä½†æ˜¯æƒ³è¦çš„é¢„æµ‹ç»“æœ <code>pred.obj</code> ä»¥åŠ <code>result.pkl</code> å¥½åƒå¹¶æ²¡æœ‰ä¿å­˜ï¼Œå¹¶ä¸”æŸ¥çœ‹äº†è¾“å‡ºä¸­çš„è·¯å¾„ <code>/tmp/tmp50avi_bh/results.pkl</code> ç”šè‡³éƒ½æ‰¾ä¸åˆ°è¿™ä¸ªè·¯å¾„ ï¼Œå†æ¬¡æŸ¥çœ‹äº†å®˜æ–¹æ–‡æ¡£ï¼Œæœ‰ä»¥ä¸‹æè¿°</p><blockquote><ul><li><code>--show</code>: If specified, detection results will be plotted in the silient mode. It is only applicable to single GPU testing and used for debugging and visualization. This should be used with <code>--show-dir</code>.</li></ul></blockquote><p>å› ä¸ºæˆ‘åœ¨è¿è¡Œçš„æ—¶å€™åªæŒ‡å®šäº† <code>--show-dir</code>ï¼Œè€Œ  <code>--show</code> å’Œ <code>--show-dir</code> éœ€è¦ä¸€èµ·ä½¿ç”¨ã€‚è€Œæ²¡æœ‰çœ‹åˆ° <code>result.pkl</code> æ˜¯å› ä¸ºæˆ‘ä¼ å…¥ <code>--out</code> çš„å‚æ•°ä¸ºæ–‡ä»¶å¤¹ï¼Œåº”è¯¥ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚å¯¹äº <code>--show</code> çš„ä½¿ç”¨ï¼Œéœ€è¦å®‰è£… open3dï¼Œ<code>pip install open3d</code> å³å¯ï¼Œæˆ‘åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é”™è¯¯ï¼Œè¿™é‡Œåˆ—å‡ºæ¥</p><ol><li><p>é‡åˆ°é”™è¯¯ <code>AttributeError: 'NoneType' object has no attribute 'point_size'</code>ï¼ŒåŸå› å¯èƒ½æ˜¯ç”±äº open3d ç‰ˆæœ¬é—®é¢˜ï¼Œå¯ä»¥å°è¯•æ›´æ¢ç‰ˆæœ¬ <code>pip install open3d==0.11</code>ï¼Œå‚è€ƒ  <a href="https://github.com/open-mmlab/mmdetection3d/issues/344">github issue</a> </p></li><li><p>ä½¿ç”¨ open3d==0.11 åé‡åˆ°é”™è¯¯ <code>OSError: libc++.so.1: cannot open shared object file: No such file or directory</code>ï¼ŒåŸå› åœ¨äºç¯å¢ƒå˜é‡æ²¡æœ‰è®¾ç½®ï¼Œå‚è€ƒ <a href="https://github.com/isl-org/Open3D/issues/2518">github issue</a> åŠ å…¥å¯¹åº”ç¯å¢ƒå˜é‡å³å¯</p></li><li><p>å¦‚æœä»¥ä¸Šé—®é¢˜éƒ½è§£å†³äº†ï¼Œä½†ä½ çš„æµ‹è¯•ç¯å¢ƒä¸ºè¿œç¨‹æœåŠ¡å™¨ï¼Œæ²¡æœ‰å›¾å½¢ç•Œé¢ GUIï¼Œé‚£ä¹ˆè¿˜å¯èƒ½é‡åˆ°æŠ¥é”™ <code>RuntimeError: [Open3D ERROR] GLFW Error: X11: The DISPLAY environment variable is missing</code>ï¼Œå¯ä»¥å‚è€ƒ <a href="https://github.com/open-mmlab/mmdetection3d/issues/851">github issue</a> å¯¹ <code>if show</code> éƒ¨åˆ†çš„ä»£ç è¿›è¡Œæ³¨é‡Šï¼Œæˆ–è€…å¦‚å‰æ–‡æåˆ°çš„æ–¹æ³•ï¼Œé…ç½®å¥½ GUI ç¯å¢ƒ</p></li></ol><h3 id="Train-SECOND"><a href="#Train-SECOND" class="headerlink" title="Train SECOND"></a>Train SECOND</h3><p>åªèƒ½è·‘1ä¸ª batch_size </p><p><img src="/archives/93e5b117/image-20211030195600143-16359966282161.png"></p><p>æˆ‘è®¤ä¸ºæˆ‘åº”è¯¥è½¬æˆ˜ä¸€ä¸‹ <a href="https://github.com/open-mmlab/OpenPCDet">OpenPCDet</a> é¡¹ç›®ï¼Œæ ¹æ® PV-RCNN è®ºæ–‡</p><blockquote><p>Our PV-RCNN framework is trained from scratch in an end-to-end manner with the ADAM optimizer. For the KITTI dataset, we train the entire network with the batch size 24, learning rate 0.01 for 80 epochs on 8 GTX 1080 Ti GPUs, which takes around 5 hours.</p></blockquote><p>ä½¿ç”¨8ä¸ª 1080Ti GPU ä¹Ÿèƒ½å¤Ÿè·‘24ä¸ª batch sizeï¼Œè¯´æ˜å®éªŒå®¤çš„ 2080Ti è‡³å°‘æ¯ä¸ªèƒ½è·‘3ä¸ª batch sizeã€‚ç„¶è€Œ MMDetection3D åªèƒ½è·‘ä¸€ä¸ªï¼Œç¡®å®å¤ªå°‘äº†ã€‚ç°åœ¨éœ€è¦å¯¹ OpenPCDet è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„ç ”ç©¶</p><h2 id="â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”"><a href="#â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”" class="headerlink" title="â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-"></a>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</h2><h2 id="OpenPCDet-amp-spconv"><a href="#OpenPCDet-amp-spconv" class="headerlink" title="OpenPCDet &amp; spconv"></a>OpenPCDet &amp; spconv</h2><p>é¦–å…ˆé¢ä¸´çš„éš¾é¢˜å°±æ˜¯å®‰è£…  <a href="https://github.com/open-mmlab/OpenPCDet">OpenPCDet</a>ï¼Œæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨ docker å®‰è£…ï¼Œä¹Ÿæœ‰äººå‘å¸ƒäº† <a href="https://hub.docker.com/r/xfbs/openpcdet">openpcdet-docker</a> ä½†æˆ‘ä¸‹è½½ä¸‹æ¥åï¼Œæ„Ÿè§‰ä¸å¤ªå¥½ç”¨ï¼Œæœ€åŸºæœ¬çš„ pip å‘½ä»¤éƒ½æ²¡æœ‰ï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯æˆ‘æ‰“å¼€æ–¹å¼ä¸å¯¹ã€‚å°è¯•ç°æˆçš„ docker å¤±è´¥åï¼Œåªæœ‰è‡ªå·±é€æ­¥æ­å»ºäº†</p><h3 id="Install-spconv-v1-2-1"><a href="#Install-spconv-v1-2-1" class="headerlink" title="Install spconv v1.2.1"></a>Install spconv v1.2.1</h3><p>å®‰è£… OpenPCDet é¦–å…ˆéœ€è¦å®‰è£… spconvï¼Œè¿™ä¸ªéƒ¨åˆ†ä¹Ÿæ˜¯èŠ±è´¹äº†ä¸å°‘ç²¾åŠ›ï¼Œåˆ°å¤„éƒ½æ˜¯å›°éš¾å•ŠğŸ˜¥è€Œä¸”ç”±äº OpenPCDet é¡¹ç›®æ›´æ–°é€Ÿåº¦å¹¶ä¸å¿«ï¼Œä½†æ˜¯ spconv å·²ç»æ›´æ–°åˆ°äº† 2.0 ç‰ˆæœ¬ï¼Œè€ç‰ˆæœ¬å‡ ä¹å·²ç»åœæ­¢æ›´æ–°äº†ï¼Œæ‰€ä»¥æƒ³è¦å®‰è£…è€ç‰ˆæœ¬ <a href="https://github.com/traveller59/spconv/tree/v1.2.1">spconv v1.2.1</a> ä¹Ÿæ¯”æœ‰ä¸€äº›éš¾åº¦</p><h4 id="Install-by-docker-deprecate"><a href="#Install-by-docker-deprecate" class="headerlink" title="Install by docker (deprecate)"></a>Install by docker (deprecate)</h4><p>é¦–å…ˆæƒ³è¦é€šè¿‡ docker æ¥ä¸‹è½½ spconvï¼Œä½†æ˜¯ç”±äº spconv çš„é•œåƒä»ä¸æ‰“ tagï¼Œå¦‚æœæ ¹æ®åŸ Dockerfile ä¼šé»˜è®¤æ‹‰å–æœ€æ–°çš„é•œåƒï¼Œæ‰€ä»¥ CUDA ç‰ˆæœ¬å¹¶ä¸æ˜¯æˆ‘æƒ³è¦ä¸‹è½½çš„ 10.1ã€‚è€Œä¸”å®éªŒå®¤ Ubuntu çš„ Nvidia Driver ç‰ˆæœ¬ä¸å¤Ÿæ–°ï¼Œæ‰€ä»¥æ›´é«˜ç‰ˆæœ¬çš„ CUDA é•œåƒæ˜¯æ²¡åŠæ³•å¯åŠ¨çš„ã€‚äºæ˜¯å°±å°è¯•æ ¹æ® github ä¸­æœ€æ™šçš„æ›´æ–°æ—¶é—´ï¼Œä¸‹è½½è€ç‰ˆæœ¬çš„é•œåƒï¼Œè¿™é‡Œæˆ‘å®‰è£…çš„ tag æ˜¯</p><p><img src="/archives/93e5b117/image-20211031204629220.png" style="zoom:80%;"></p><p>ä¸‹è½½å¥½è¯¥é•œåƒåå°±èƒ½æ­£å¸¸è¿è¡Œ CUDA é•œåƒäº†ï¼Œç„¶åå°±æ ¹æ® OpenPCDet å®˜æ–¹ <a href="https://github.com/open-mmlab/OpenPCDet/blob/master/docs/INSTALL.md">Install</a> æ–‡æ¡£è¿›è¡Œå®‰è£…</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> clone https://github.com/open-mmlab/OpenPCDet.gitpip <span class="token function">install</span> -r requirements.txt python setup.py develop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä½†ä¹‹ååœ¨å®‰è£… mayavi åº“çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ï¼Œå› ä¸ºéœ€è¦ä½¿ç”¨ python3.7ï¼Œè€Œé•œåƒæ˜¯ python3.8ï¼Œå¹¶ä¸”é•œåƒæ²¡æœ‰ conda å‘½ä»¤ï¼Œä¸ªäººä¸æ˜¯å¾ˆä¹ æƒ¯ï¼Œäºæ˜¯æ‰“ç®—æ”¾å¼ƒé€šè¿‡ spconv docker å®‰è£…ã€‚è€ƒè™‘ä½¿ç”¨ mmdetection3d æä¾›çš„é•œåƒï¼Œä½œä¸ºåŸºç¡€é•œåƒä»é›¶å¼€å§‹å®‰è£…ï¼Œå› ä¸ºè¯¥é•œåƒçš„åŠŸèƒ½æ›´å¤šä¸€äº›ï¼Œç¯å¢ƒæ›´å®Œæ•´ï¼Œå…¶éƒ¨åˆ† Dockerfile å¦‚ä¸‹</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">ARG PYTORCH="1.6.0"ARG CUDA="10.1"ARG CUDNN="7"FROM pytorch/pytorch:${PYTORCH}-cuda${CUDA}-cudnn${CUDNN}-develENV TORCH_CUDA_ARCH_LIST="6.0 6.1 7.0+PTX"ENV TORCH_NVCC_FLAGS="-Xfatbin -compress-all"ENV CMAKE_PREFIX_PATH="$(dirname $(which conda))/../"RUN apt-get update &amp;&amp; apt-get install -y ffmpeg libsm6 libxext6 git ninja-build libglib2.0-0 libsm6 libxrender-dev libxext6 \    &amp;&amp; apt-get clean \    &amp;&amp; rm -rf /var/lib/apt/lists/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Install-cmake"><a href="#Install-cmake" class="headerlink" title="Install cmake"></a>Install cmake</h4><p>é¦–å…ˆé‡åˆ°çš„éš¾é¢˜æ˜¯å®‰è£… cmakeï¼Œå‘ç°åŸæ¥é€šè¿‡ pip å®‰è£…æ‰æ˜¯æœ€å¿«çš„æ–¹å¼ï¼Œè€Œä¸”ç‰ˆæœ¬å¾ˆæ–°ï¼Œå‚è€ƒ <a href="https://stackoverflow.com/questions/49859457/how-to-reinstall-the-latest-cmake-version">stackoverflow</a></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> root@fb873089e53c:/spconv<span class="token comment"># cmake --version</span>cmake version <span class="token number">3.21</span>.3CMake suite maintained and supported by Kitware <span class="token punctuation">(</span>kitware.com/cmake<span class="token punctuation">)</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Git-clone"><a href="#Git-clone" class="headerlink" title="Git clone"></a>Git clone</h4><p>ä¸€å®šè¦ä½¿ç”¨ <code>git clone ... --recursive</code> å‘½ä»¤æ¥ clone è¯¥é¡¹ç›®ï¼Œ<code>--recursive</code> å‘½ä»¤æ„æ€æ˜¯è¿™ä¸ªé¡¹ç›®è¿˜æœ‰ä¸€äº›å­é¡¹ç›®ä¹Ÿéœ€è¦ cloneã€‚å¹¶ä¸”éœ€è¦åŠ ä¸Š <code>-b</code> å‚æ•°æŒ‡å®š clone çš„ branchï¼Œä¸ç„¶ä¼šé»˜è®¤ clone master åˆ†æ”¯ï¼Œè€Œä¸æ˜¯æˆ‘éœ€è¦çš„ v1.2.1 ç‰ˆæœ¬ã€‚æ•´ä¸ªä¸‹è½½çš„è¿‡ç¨‹å¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨å›½å†…çš„é•œåƒæºï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ <a href="https://hongkun.space/archives/2121b11b.html#toc-heading-1">git ç¬”è®°</a>ï¼ˆé¢˜å¤–è¯ï¼Œè‡ªå·±å°±æ˜¯å› ä¸º clone æ“ä½œæ²¡æœ‰å¼„å¯¹ï¼Œåœ¨å®‰è£…çš„æ—¶å€™é™¤äº†å¥½å¤šé”™â€¦å¿ƒæ€çˆ†ç‚¸ï¼‰</p><h4 id="Setup-py"><a href="#Setup-py" class="headerlink" title="Setup.py"></a>Setup.py</h4><p>è¿è¡Œ <code>setup.py</code> è¿›è¡Œç¼–è¯‘ï¼Œç„¶åè¿›å…¥ <code>./dist</code> æ–‡ä»¶å¤¹ä¸‹è½½ <code>xxx.whl</code> ä¸åŒç‰ˆæœ¬çš„ spconv ä¼šæœ‰ä¸åŒçš„ <code>.whl</code> æ–‡ä»¶ </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python setup.py bdist_wheel<span class="token builtin class-name">cd</span> ./distpython xxx.whl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="Install-OpenPCDet"><a href="#Install-OpenPCDet" class="headerlink" title="Install OpenPCDet"></a>Install OpenPCDet</h3><p>ä¸‹è½½å¥½äº† spconv ç»§ç»­å‰å¾€ OpenPCDet é¡¹ç›®ç»§ç»­å®‰è£…å§</p><h4 id="Install-requirements"><a href="#Install-requirements" class="headerlink" title="Install requirements"></a>Install requirements</h4><p><code>git clone https://github.com/open-mmlab/OpenPCDet.git</code> ä¸‹è½½é¡¹ç›®ï¼Œç„¶åå®‰è£…ç¯å¢ƒ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> -r requirements.txt <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨ä¸‹è½½ requirements çš„æ—¶å€™å‘ç°è«åå…¶å¦™åœ°ä¸‹è½½äº†æœ€æ–°ç‰ˆçš„ torch==1.10.0 æ›¿æ¢äº†åŸæ¥çš„ torch==1.6.0ï¼Œ<code>requirements.txt</code> éƒ¨åˆ†å†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">torch&gt;=1.1kornia<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸€èˆ¬æƒ…å†µä¸‹ pip æ˜¯ä¸ä¼šè‡ªåŠ¨æ›¿æ¢å·²ç»æ»¡è¶³è¦æ±‚çš„åŒ…çš„ï¼Œæˆ‘ä½¿ç”¨äº†å¦ä¸€ä¸ª docker ä¹Ÿæ²¡æœ‰å¤ç°å‡ºè¿™ä¸ªé”™è¯¯è¿‡ç¨‹ï¼Œæ‰€ä»¥å°±æš‚æ—¶ä¸è¦æ‹…å¿ƒè¿™ä¸ªæ“ä½œäº†ã€‚åœ¨ torch==1.10.0 çš„æƒ…å†µä¸‹è¿è¡Œ <code>setup.py</code> å¯èƒ½é‡åˆ°å¦‚ä¸‹æŠ¥é”™ï¼Œæ›´æ¢å¯¹åº”çš„ torch ç‰ˆæœ¬å°±å¥½</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">RuntimeError:The detected CUDA version <span class="token punctuation">(</span><span class="token number">10.1</span><span class="token punctuation">)</span> mismatches the version that was used to compilePyTorch <span class="token punctuation">(</span><span class="token number">10.2</span><span class="token punctuation">)</span>. Please <span class="token function">make</span> sure to use the same CUDA versions.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¹¶ä¸”ç”±äº kornia å¯¹äº Pytorch ä½ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ï¼Œæ ¹æ® <a href="https://github.com/open-mmlab/OpenPCDet/issues/544">github issue</a> é€‰æ‹©ä¸‹è½½ <code>kornia==0.5</code> ç‰ˆæœ¬ï¼Œå¦‚æœä½ ä¸éœ€è¦ä½¿ç”¨ CaDNN ä¹Ÿå¯ä»¥é€‰æ‹©ä¸ä¸‹è½½ korniaã€‚ç°åœ¨é‡æ–°å®‰è£… torch==1.6.0 &amp; kornia==0.5</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> <span class="token assign-left variable">torch</span><span class="token operator">==</span><span class="token number">1.6</span>.0+cu101 <span class="token assign-left variable">torchvision</span><span class="token operator">==</span><span class="token number">0.7</span>.0+cu101 -f https://download.pytorch.org/whl/torch_stable.htmlpip <span class="token function">install</span> <span class="token assign-left variable">kornia</span><span class="token operator">==</span><span class="token number">0.5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="Setup-py-1"><a href="#Setup-py-1" class="headerlink" title="Setup.py"></a>Setup.py</h4><p>è¿è¡Œ <code>setup.py</code> è¿›è¡Œç¼–è¯‘</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python setup.py develop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Install-mayavi"><a href="#Install-mayavi" class="headerlink" title="Install mayavi"></a>Install mayavi</h3><p>è¿™ä¸ªåº“æ˜¯ç”¨äºå¯è§†åŒ–çš„ï¼Œå…¶å®‰è£…ä¹Ÿæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹çš„ï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š</p><ol><li><p><code>mayavi</code> æ˜¯éœ€è¦å›¾å½¢åŒ–ç•Œé¢ GUI çš„ï¼Œåˆ°äº†è¿™ä¸€æ­¥æˆ‘ä¸å¾—ä¸æƒ³åŠæ³•è®© docker èƒ½å¤Ÿè¿è¡Œ GUI appï¼Œè¿˜å¥½æ‰¾åˆ°äº†æ–¹æ³•ï¼Œå‚ç…§å‰æ–‡å³å¯å®Œæˆ</p></li><li><p>æ ¹æ® <a href="https://zhuanlan.zhihu.com/p/373668000">çŸ¥ä¹</a> ä¸‹è½½ <code>vtk==8.1.2</code>ï¼Œè‡ªåŠ¨å®‰è£…çš„ä¸º <code>vtk==9.0.x</code>ï¼Œ<a href="https://blog.csdn.net/weixin_43978293/article/details/118731248">æ®è¯´</a> åœ¨ python3.8 ç¯å¢ƒä¸­ä¼¼ä¹ä¼šå‡ºé—®é¢˜</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> <span class="token assign-left variable">vtk</span><span class="token operator">==</span><span class="token number">8.1</span>.2 <span class="token comment"># è‡ªåŠ¨å®‰è£…çš„vtkæ˜¯9ï¼Œä¼šäº§ç”Ÿå†²çª</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>è¿˜éœ€è¦ä¸‹è½½ <code>PyQt5</code> ä»¥è¿›è¡Œå¯è§†åŒ–</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> PyQt5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹‹åé‡åˆ°äº†ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„æŠ¥é”™ï¼Œä¹Ÿæ˜¯å›°æ‰°æˆ‘å¾ˆä¹…ï¼Œ<a href="https://www.jianshu.com/p/b51008566134">åšå®¢</a> è§£é‡Šæ˜¯å°‘äº†ä¸€äº›ä¾èµ–åº“ï¼Œå¯èƒ½æ˜¯å› ä¸º docker æ˜¯ä¸€ä¸ªç²¾ç®€çš„ ubuntuï¼Œæ²¡æœ‰å®Œæ•´çš„ä¾èµ–åº“</p><p>é€šè¿‡ <code>apt install python3-pyqt5</code> ä¸‹è½½äº†å…¶ç›¸å…³çš„ä¾èµ–åº“ </p></li></ol><p>é€šè¿‡ä¸æ–­åœ°å°è¯•ä¸æ–­åœ°æŠ˜è…¾å¯ç®—æ˜¯å®‰è£…å¥½äº†ğŸ˜€å…ˆæ¥è¿›è¡Œæµ‹è¯•å§ï¼</p><h2 id="Demo-on-OpenPCDet"><a href="#Demo-on-OpenPCDet" class="headerlink" title="Demo on OpenPCDet"></a>Demo on OpenPCDet</h2><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p>å…ˆå°†åŸæ¥çš„ KITTI æ•°æ®é›†æ”¾åˆ° data ç›®å½•ä¸‹ï¼Œå·²ç»ä½¿ç”¨ MMDetection3d ç”Ÿæˆäº†åŸºæœ¬æ•°æ®ï¼Œä½† OpenPCDet æš‚æ—¶è¿˜ä¸éœ€è¦ç”Ÿæˆï¼ŒDemo åªéœ€è¦åŸå§‹æ•°æ®é›†å°±å¯ä»¥äº†ã€‚å‡†å¤‡å¥½æ¨¡å‹å’Œæ•°æ®é›†åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æµ‹è¯•ä¸€ä¸‹ SECOND</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">import</span> osCONFIG_FILE <span class="token operator">=</span> <span class="token string">'/OpenPCDet/tools/cfgs/kitti_models/second.yaml'</span>CKPT <span class="token operator">=</span> <span class="token string">'/OpenPCDet/checkpoints/second_7862.pth'</span>POINT_CLOUD_DATA <span class="token operator">=</span> <span class="token string">'/OpenPCDet/data/kitti/training/velodyne/000007.bin'</span>os.system<span class="token punctuation">(</span>f<span class="token string">'python demo.py --cfg_file {CONFIG_FILE} \    --ckpt {CKPT} \    --data_path {POINT_CLOUD_DATA}'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œ <code>Demo.py</code> åè·å¾—äº†å¦‚ä¸‹é¢„æµ‹ç»“æœï¼Œçœ‹ä¸Šå»è¿˜æŒºä¸é”™çš„</p><p><img src="/archives/93e5b117/image-20211102173223643.png" style="zoom:80%;"></p><h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><p>ç›´æ¥æµ‹è¯• SECOND åœ¨ KITTI éªŒè¯é›†ä¸Šçš„ç»“æœï¼Œåˆ—å‡º Car ç›¸å…³çš„éƒ¨åˆ†</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Car AP@0.70, <span class="token number">0.70</span>, <span class="token number">0.70</span>:bbox AP:90.7803, <span class="token number">89.8999</span>, <span class="token number">89.0433</span>bev  AP:90.0097, <span class="token number">87.9282</span>, <span class="token number">86.4528</span>3d   AP:88.6137, <span class="token number">78.6245</span>, <span class="token number">77.2243</span>aos  AP:90.76, <span class="token number">89.77</span>, <span class="token number">88.82</span>Car AP_R40@0.70, <span class="token number">0.70</span>, <span class="token number">0.70</span>:bbox AP:95.6261, <span class="token number">94.1728</span>, <span class="token number">91.7683</span>bev  AP:92.4184, <span class="token number">88.5586</span>, <span class="token number">87.6479</span>3d   AP:88.6137, <span class="token number">78.6245</span>, <span class="token number">77.2243</span>aos  AP:95.59, <span class="token number">94.01</span>, <span class="token number">91.52</span>Car AP@0.70, <span class="token number">0.50</span>, <span class="token number">0.50</span>:bbox AP:90.7803, <span class="token number">89.8999</span>, <span class="token number">89.0433</span>bev  AP:90.7940, <span class="token number">90.1441</span>, <span class="token number">89.5173</span>3d   AP:90.7940, <span class="token number">90.0886</span>, <span class="token number">89.4014</span>aos  AP:90.76, <span class="token number">89.77</span>, <span class="token number">88.82</span>Car AP_R40@0.70, <span class="token number">0.50</span>, <span class="token number">0.50</span>:bbox AP:95.6261, <span class="token number">94.1728</span>, <span class="token number">91.7683</span>bev  AP:95.6751, <span class="token number">94.8476</span>, <span class="token number">94.2478</span>3d   AP:95.6623, <span class="token number">94.7450</span>, <span class="token number">94.0537</span>aos  AP:95.59, <span class="token number">94.01</span>, <span class="token number">91.52</span><span class="token punctuation">..</span>.<span class="token number">2021</span>-11-01 <span class="token number">11</span>:48:15,756   INFO  Result is save to /OpenPCDet/output/OpenPCDet/tools/cfgs/kitti_models/second/default/eval/epoch_7862/val/default<span class="token number">2021</span>-11-01 <span class="token number">11</span>:48:15,756   INFO  ****************Evaluation done.*****************<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ MMDetection3D çš„ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œæ•´ä½“ä¸Šæ¥çœ‹è¿˜æ˜¯ç›¸è¿‘çš„</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># OpenPCDet</span>Car AP@0.50, <span class="token number">0.70</span>3d   AP:90.7940, <span class="token number">90.0886</span>, <span class="token number">89.4014</span>3d   AP:88.6137, <span class="token number">78.6245</span>, <span class="token number">77.2243</span>Car AP_R40@0.50, <span class="token number">0.70</span>3d   AP:95.6623, <span class="token number">94.7450</span>, <span class="token number">94.0537</span>3d   AP:88.6137, <span class="token number">78.6245</span>, <span class="token number">77.2243</span><span class="token comment"># MMDetection3d</span>Car AP@0.50, <span class="token number">0.70</span>3d   AP:98.3329, <span class="token number">90.0209</span>, <span class="token number">89.4035</span>3d   AP:87.4561, <span class="token number">76.7570</span>, <span class="token number">74.1302</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Train"><a href="#Train" class="headerlink" title="Train"></a>Train</h3><p>æŸ¥çœ‹ä¸€ä¸‹ SECOND è®­ç»ƒçš„åŸºæœ¬æƒ…å†µï¼Œè¿™é‡Œæ”¹äº†ä¸€ä¸ªé…ç½®ï¼šUSE_ROAD_PLANE: False</p><p><img src="/archives/93e5b117/image-20211102184034692.png"></p><p>è®­ç»ƒé€Ÿåº¦è¿˜æ˜¯ä¸é”™çš„ï¼Œæ­¤æ—¶çš„ batch size per GPU = 4 æ¯” MMDetection3D æ•ˆç‡æ›´é«˜ï¼Œä¸‹é¢æ˜¯ GPU ä½¿ç”¨æƒ…å†µ</p><p><img src="/archives/93e5b117/image-20211102184056522.png"></p><h2 id="CenterPoint-on-MMDetection3D"><a href="#CenterPoint-on-MMDetection3D" class="headerlink" title="CenterPoint on MMDetection3D"></a>CenterPoint on MMDetection3D</h2><p>ç°åœ¨å°è¯•ä¸€ä¸‹ç”¨ MMDetection3D è¿è¡Œ CenterPointï¼Œæƒ³è¦çœ‹ä¸€çœ‹ KITTI æ•°æ®é›†çš„ç»“æœï¼Œæ¯•ç«ŸåŸè®ºæ–‡ä¸­æ²¡æœ‰åœ¨ KITTI ä¸Šè¿›è¡Œæµ‹è¯•ã€‚æœ‰äººåœ¨ <a href="https://github.com/open-mmlab/mmdetection3d/issues/871">github issue</a> ä¹Ÿè¿›è¡Œäº†ä¸€äº›å°è¯•ï¼ŒåŸæ–‡ä½œè€…ä¹Ÿæœ‰é¡¹ç›® <a href="https://github.com/tianweiy/CenterPoint-KITTI">CenterPoint-KITTI</a>ï¼Œä»å®éªŒç»“æœæ¥çœ‹ï¼Œå•é˜¶æ®µä¸ SECOND æ•ˆæœå·®ä¸å¤šï¼Œå¹¶æ²¡æœ‰éå¸¸äº®çœ¼çš„è¡¨ç°ï¼Œå¯èƒ½è¿˜éœ€è¦è¿›ä¸€æ­¥çš„å¾®è°ƒ</p><p>å°è¯•åœ¨ MMDetection3D ä¸Šç®€å•è¿è¡Œä¸€ä¸‹ï¼Œç„¶è€Œä¼¼ä¹æ˜¯æ˜¾å­˜ä¸å¤Ÿçš„åŸå› ï¼Œæ²¡èƒ½å¤Ÿè·‘èµ·æ¥ï¼Œåç»­å†è¿›ä¸€æ­¥ç ”ç©¶å§</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenPCDet </tag>
            
            <tag> MMDetection3D </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Voxel R-CNN</title>
      <link href="/archives/de63c30e.html"/>
      <url>/archives/de63c30e.html</url>
      
        <content type="html"><![CDATA[<h1 id="Voxel-R-CNN"><a href="#Voxel-R-CNN" class="headerlink" title="Voxel R-CNN"></a>Voxel R-CNN</h1><hr><p>Deng, Jiajun, Shaoshuai Shi, Peiwei Li, Wengang Zhou, Yanyong Zhang, and Houqiang Li. â€œVoxel R-CNN: Towards High Performance Voxel-Based 3D Object Detection.â€ <em>ArXiv:2012.15712 [Cs]</em>, February 5, 2021. <a href="http://arxiv.org/abs/2012.15712">http://arxiv.org/abs/2012.15712</a>.</p><p>Comment: AAAI2021</p><hr><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>è¿™ç¯‡è®ºæ–‡æ˜¯ PV-RCNN çš„ä¸€ä¸ªåç»­ç ”ç©¶ï¼Œä¸ºäº†è§£å†³ PV-RCNN ä¸­çš„æ¨ç†é€Ÿåº¦é—®é¢˜ï¼Œåœ¨æ”¹è¿›ä¹‹åé€Ÿåº¦èƒ½å¤Ÿè¾¾åˆ° 25 fps çš„å®æ—¶æ¨ç†é€Ÿåº¦ï¼ˆon NVIDIA 2080 Tiï¼‰ï¼Œç›¸æ¯”äºå‰ä½œçš„ 8.9 fpsï¼ˆè®ºæ–‡æä¾›æ•°æ®ï¼‰æå‡äº†æ¥è¿‘2å€ã€‚åŒæ—¶åœ¨å‡†åº¦ä¸Šä¹Ÿè¶…è¶Šäº†å‰ä½œï¼Œè™½ç„¶è¶…è¶Šå¾—ä¸å¤šï¼Œä½†æ˜¯æœ¬è®ºæ–‡çš„æ•´ä¸ªæ¡†æ¶éå¸¸å¹²å‡€ï¼Œå‡ ä¹æ²¡æœ‰ä½¿ç”¨ä»»ä½•å…¶ä»–çš„æŠ€å·§ï¼Œåç»­æå‡ç©ºé—´éå¸¸å¤§</p><p>è®¸å¤šç°æœ‰çš„é«˜æ€§èƒ½ 3D æ¢æµ‹å™¨éƒ½æ˜¯åŸºäºç‚¹ point-basedï¼Œå› ä¸ºè¿™ç§ç»“æ„å¯ä»¥æ›´å¥½åœ°ä¿ç•™ç²¾ç¡®çš„ç©ºé—´ä¿¡æ¯ã€‚ç„¶è€Œç”±äºæ— åºå­˜å‚¨ï¼Œpoint-wise ç‰¹å¾ä¼šå¯¼è‡´é«˜è®¡ç®—å¼€é”€ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŸºäºä½“ç´  voxel-based çš„ç»“æ„æ›´é€‚åˆäºç‰¹å¾æå–ï¼Œä½†æ˜¯å‡†ç¡®åº¦ä¸é«˜ã€‚<strong>è€Œè¿™ç¯‡è®ºæ–‡å°±æ‰“ç ´äº†è¿™ä¸ªè§‚å¿µâ€”â€”å³ä½¿æ˜¯ç²—ç²’åº¦çš„ä½“ç´ å—ä¹Ÿèƒ½å¾ˆå¥½åœ°æä¾›ç©ºé—´ä¿¡æ¯ï¼Œç²¾ç¡®çš„ç‚¹äº‘ä¿¡æ¯å¹¶ä¸æ˜¯é«˜æ€§èƒ½çš„å…³é”®ç‚¹</strong>ã€‚ä¹‹å‰ voxel-based æ–¹æ³•ä¹‹æ‰€ä»¥æ•ˆæœä¸ä½³ï¼Œæ˜¯å› ä¸ºå°†ä¸‰ç»´ä½“ç´ ç‰¹å¾å›¾è°± 3D voxel feature map é‡å¡‘ä¸º 2D BEV feature map è¿‡åä¸å†åˆ©ç”¨åŸæ¥çš„ä¸‰ç»´ä½“ç´ ç‰¹å¾äº†ï¼Œè€Œé‡å¡‘çš„è¿‡ç¨‹ä¸­å°±æŸå¤±äº†ç©ºé—´ä¿¡æ¯</p><p>è®ºæ–‡çš„æ ¸å¿ƒé‡ç‚¹ä¸ºä½¿ç”¨äº† voxel RoI pooling æ“ä½œï¼Œé€šè¿‡æå– RoI ä¸­çš„ç‰¹å¾å¯¹é€‰æ¡†è¿›è¡Œç»†åŒ–ï¼Œå…¶ä¸­ RoI ç‰¹å¾æ¥æºäº backbone ä¸­æå–çš„ 3D featureï¼ˆè¿™é‡Œæˆ‘å«å®ƒä½“ç´ åŒ–ç‰¹å¾ voxel-wise featureï¼‰ï¼Œè€Œé PV-RCNN ä¸­çš„ç‚¹ç±»ç‰¹å¾ point-wise featureã€‚å»é™¤äº†è®¡ç®—é‡åºå¤§çš„ç‚¹ç±»ç‰¹å¾æå–ï¼Œä½¿å¾— Voxel R-CNN æ¨ç†é€Ÿåº¦å¤§å¤§å¢åŠ ï¼ŒåŒæ—¶ä¿æŒäº†ä¼˜å¼‚çš„å‡†ç¡®ç‡</p><h2 id="Voxel-R-CNN-Architecture"><a href="#Voxel-R-CNN-Architecture" class="headerlink" title="Voxel R-CNN Architecture"></a>Voxel R-CNN Architecture</h2><p><img src="/archives/de63c30e/image-20211019154543934.png"></p><p>å¯ä»¥è¯´è¿™ä¸ªç¤ºæ„å›¾å±•ç¤ºå‡ºæ¥çš„ç»“æ„éå¸¸å¹²å‡€ï¼Œæ²¡æœ‰å¤šä½™çš„æŠ€å·§ï¼Œå°±æ˜¯ RCNN æ¡†æ¶çš„ä¸‰éƒ¨æ›²ï¼š</p><ol><li>3D backboneç‰¹å¾æå–</li><li>RPN æå‡ºé€‰æ¡†</li><li>2-Stage ç»†åŒ–é€‰æ¡†</li></ol><h3 id="3D-backbone-amp-RPN"><a href="#3D-backbone-amp-RPN" class="headerlink" title="3D backbone &amp; RPN"></a>3D backbone &amp; RPN</h3><p>ç›´æ¥ä½¿ç”¨ SECOND ä½œä¸ºå…¶ backbone ç½‘ç»œæå–ç‰¹å¾ï¼Œå°†å¾—åˆ°çš„ 3D ç‰¹å¾æ²¿ Z è½´è¿›è¡Œå †å ï¼Œé‡å¡‘ä¸º 2D ä¿¯è§†ç‰¹å¾å›¾è°± BEV feature map ä½œä¸º RPN çš„è¾“å…¥ã€‚è®ºæ–‡åœ¨ç¬¬ä¸‰èŠ‚å°±è¿™æ ·ä¸€å¥å¸¦è¿‡ 3D backboneï¼Œè¯¥ backbone æœ‰4ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µçš„é¢‘é“æ•°åˆ†åˆ«ä¸º 16, 32, 48, 64</p><p>RPN è®¾è®¡ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ol><li>top-down ç‰¹å¾æå–ç½‘ç»œï¼Œä½¿ç”¨2ä¸ªå·ç§¯å—</li><li>å¯¹å°ºåº¦ç‰¹å¾èåˆç»“æ„ï¼Œå°†ä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾è°±è¿›è¡Œä¸Šé‡‡æ ·å¹¶è¿æ¥èµ·æ¥ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç‰¹å¾å›¾è°±</li></ol><p>æœ€åæ—¶å€™è¯¥ç‰¹å¾å›¾è°±å»åšåˆ†ç±»ä»»åŠ¡å’Œå›å½’ä»»åŠ¡ï¼Œè¿™éƒ¨åˆ†ä¸ VoxelNet ä¸­çš„ RPN ç»“æ„ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œè´´ä¸€ä¸‹ VoxelNet ä¸­ RPN çš„ç¤ºæ„å›¾</p><p><img src="/archives/de63c30e/image-20211019161506601.png" style="zoom: 67%;"></p><p>æŸå¤±å‡½æ•°ä½¿ç”¨ focal loss å’Œ Huber lossï¼Œæ•°å­¦è¡¨ç¤ºå¦‚ä¸‹</p><script type="math/tex; mode=display">\mathcal{L}_{\mathrm{RPN}}=\frac{1}{N_{\mathrm{fg}}}\left[\sum_{i} \mathcal{L}_{\text {cls }}\left(p_{i}^{a}, c_{i}^{*}\right)+\mathbb{1}\left(c_{i}^{*} \geq 1\right) \sum_{i} \mathcal{L}_{\text {reg }}\left(\delta_{i}^{a}, t_{i}^{*}\right)\right]</script><p>å…¶ä¸­ Huber loss ä¸é€šå¸¸ä½¿ç”¨çš„ smooth L1 loss ä¹Ÿæ˜¯ç›¸ä¼¼çš„ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°å¥‡å¼‚ç‚¹çš„æŸå¤±ï¼Œå…¶å…·ä½“å…¬å¼å¦‚ä¸‹</p><script type="math/tex; mode=display">L_{\delta}(y, f(x))=\left\{\begin{array}{ll}\frac{1}{2}(y-f(x))^{2}, & \text { for }|y-f(x)| \leq \delta \\\delta \cdot\left(|y-f(x)|-\frac{1}{2} \delta\right), & \text { otherwise. }\end{array}\right.</script><p><img src="/archives/de63c30e/1182370-20180928094214405-164664611.gif" style="zoom:50%;"></p><h3 id="Voxel-RoI-pooling"><a href="#Voxel-RoI-pooling" class="headerlink" title="Voxel RoI pooling"></a>Voxel RoI pooling</h3><p>æ¥ä¸‹æ¥å°±æ˜¯è®ºæ–‡æ ¸å¿ƒæ“ä½œäº†ï¼Œå³å¦‚ä½•å¯¹æå–å‡ºçš„ä½“ç´ åŒ–ç‰¹å¾ voxel-wise feature è¿›è¡Œ RoI pooling</p><h4 id="Voxel-volumes-as-points"><a href="#Voxel-volumes-as-points" class="headerlink" title="Voxel volumes as points"></a>Voxel volumes as points</h4><p>å°†æ¯ä¸€ä¸ªä½“ç´ å— voxel volume è§†ä½œä¸ºä¸€ä¸ªç‚¹ï¼Œè¯¥ç‚¹çš„åæ ‡ä¸ºä½“ç´ ä¸­å¿ƒçš„åæ ‡</p><script type="math/tex; mode=display">\{v_i=x_i,y_i,z_i\}_{i=1}^N\\\{\phi_i\}_{i=1}^N</script><p>å…¶ä¸­ $\phi_i$ è¡¨ç¤ºè¯¥ä½“ç´ çš„ç‰¹å¾</p><h4 id="Voxel-query"><a href="#Voxel-query" class="headerlink" title="Voxel query"></a>Voxel query</h4><p>è¯¥æ“ä½œä¸ºå¯»æ‰¾æŸä¸ªä½“ç´ é™„è¿‘çš„éç©ºä½“ç´ ã€‚ç”±äºä½“ç´ çš„è§„èŒƒè¡¨è¾¾ï¼Œä¸¤ä¸ªä½“ç´ ä¹‹é—´çš„ä½ç½®å¯ä»¥ç”±ä»–ä»¬çš„åæ ‡ index è¿…é€Ÿè®¡ç®—ï¼Œè®ºæ–‡é‡‡ç”¨æ›¼å“ˆé¡¿è·ç¦» Manhattan distance è¡¨ç¤ºä¸¤ä¸ªä½“ç´  $\alpha,\beta$ çš„è·ç¦»</p><script type="math/tex; mode=display">\alpha = (i_\alpha, j_\alpha, k_\alpha),\ \beta = (i_\beta, j_\beta, k_\beta)\\D_{m}(\alpha, \beta)=\left|i_{\alpha}-i_{\beta}\right|+\left|j_{\alpha}-j_{\beta}\right|+\left|k_{\alpha}-k_{\beta}\right|</script><p>è®ºæ–‡ä½¿ç”¨çƒæœç´¢ ball query æ¥å¯»æ‰¾é™„è¿‘çš„ä½“ç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(K)$ï¼Œå…¶ä¸­ $K$ æ˜¯ï¼ˆæœ€å¤§ï¼‰é‚»å±…æ•°ã€‚ä½†è¿™ä¸ª ball query ç®—æ³•å…·ä½“æ€ä¹ˆå®ç°çš„æš‚æ—¶è¿˜ä¸ç†è§£â€¦ç»™è‡ªå·±ç•™ä¸ªå‘å§ï¼Œä»¥åè¡¥æœºå™¨å­¦ä¹ å’Œæ•°æ®ç»“æ„çš„æ—¶å€™çœ‹èƒ½ä¸èƒ½å¡«ä¸Šï¼</p><p><img src="/archives/de63c30e/image-20211019170427837.png" style="zoom: 50%;"></p><h4 id="Voxel-RoI-pooling-1"><a href="#Voxel-RoI-pooling-1" class="headerlink" title="Voxel RoI pooling"></a>Voxel RoI pooling</h4><p>é¦–å…ˆå°†æè®®é€‰æ¡† proposal å¹³å‡åˆ†æˆ $G\times G\times G$ ä¸ªå­ä½“ç´ å—ï¼Œå°†å­ä½“ç´ å—çš„ä¸­å¿ƒç‚¹ä½œä¸ºé‡‡æ ·æ …æ ¼ç‚¹ $g_i$ï¼Œç”¨äºè¿›ä¸€æ­¥èšé›†ä½“ç´ ç‰¹å¾ã€‚å¯¹äºæ¯ä¸€ä¸ªé‡‡æ ·æ …æ ¼ç‚¹ï¼Œä½¿ç”¨ voxel queryï¼Œå¾—åˆ°å…¶é‚»å±…é›†åˆ $\Gamma_i = \{v_i^1,â€¦,v_i^K\}$ ç„¶åä½¿ç”¨ PointNet æ¨¡å—è¿›è¡Œç‰¹å¾æå–</p><script type="math/tex; mode=display">\boldsymbol{\eta}_{i}=\max _{k=1,2, \cdots, K}\left\{\Psi\left(\left[\boldsymbol{v}_{i}^{k}-\boldsymbol{g}_{i} ; \boldsymbol{\phi}_{i}^{k}\right]\right)\right\}</script><p>åœ¨çœŸæ­£å®æ–½è¯¥ pooling æ“ä½œæ—¶ï¼Œå…¶ pooling å¯¹è±¡å…¶å®ä¸æ˜¯åˆå§‹çš„ä½“ç´ åŒ–ç‚¹äº‘ï¼Œè€Œæ˜¯ 3D backbone ä¸­æœ€åä¸¤ä¸ªé˜¶æ®µçš„ 3D voxel-wise featureã€‚å¹¶ä¸”å¯¹äºæ¯ä¸ªé˜¶æ®µï¼Œè®¾ç½®äº†å¤šä¸ªæ›¼å“ˆé¡¿è·ç¦»é˜ˆå€¼ä»¥è¿›è¡Œå¯¹å°ºåº¦èšé›† groupingï¼Œæœ€åå°†ä¸åŒé˜¶æ®µä¸åŒå°ºåº¦çš„èšé›†ç‰¹å¾è¿›è¡Œè¿æ¥å¾—åˆ°æœ€ç»ˆçš„ç‰¹å¾é›†</p><h4 id="Accelerated-local-aggregation"><a href="#Accelerated-local-aggregation" class="headerlink" title="Accelerated local aggregation"></a>Accelerated local aggregation</h4><p>è®ºæ–‡ä½¿ç”¨äº†åŠ é€Ÿç‰ˆæœ¬çš„ PointNetï¼ŒåŒºåˆ«ä¸åŸå§‹ç‰ˆæœ¬å…ˆåšé‚»å±…æœç´¢å†è¿›è¡Œç‰¹å¾æå–ï¼ŒåŠ é€Ÿç‰ˆæœ¬çš„ PointNet å°†ä½“ç´ å—çš„ä½ç½® $(x,y,z)$ å’Œç‰¹å¾ feature è¿›è¡Œåˆ†åˆ«å¤„ç†ï¼Œå›¾ç¤ºå¦‚ä¸‹</p><p><img src="/archives/de63c30e/image-20211019171951879.png" style="zoom:80%;"></p><p>å¦‚æœæŒ‰ç…§ PV-RCNN ä¸­çš„æ–¹æ³•è¿›è¡Œç‚¹äº‘ç‰¹å¾èšåˆï¼Œåˆ™è¦å…ˆå¯»æ‰¾é™„è¿‘çš„ç‚¹ groupingï¼Œç„¶åå†å¯¹é™„è¿‘çš„ç‚¹ä½¿ç”¨ MLP åšç‰¹å¾æå–ï¼Œè¿™ä¸€è¿‡ç¨‹çš„å¤æ‚åº¦ä¸º $(O(M Ã— K Ã— (C + 3) Ã— Câ€™ ))$ï¼Œå…¶ä¸­ $M=r\times G^3$ ä¸ºæ ¼ç‚¹æ•° grid pointsï¼Œ$r$ ä¸º RoI æ•°é‡ï¼Œ$K$ ä¸ºï¼ˆæœ€å¤§ï¼‰é‚»å±…æ•°ï¼Œ$C+3$ ä¸ºè¾“å…¥ç‰¹å¾ç»´æ•°ï¼Œ$Câ€™$ ä¸ºè¾“å‡ºç‰¹å¾ç»´æ•°</p><p>è€Œè®ºæ–‡å°†ç›¸å¯¹åæ ‡ä¸ä½“ç´ ç‰¹å¾åˆ†ç¦»ã€‚ç»™å®šæƒé‡ä¸º$ W âˆˆ \mathbb R^{Câ€™ ,C+3}$ çš„å…¨è¿æ¥å±‚ï¼Œè®ºæ–‡å°†å…¶åˆ†ä¸º $ W_F âˆˆ \mathbb R^{Câ€™ ,C}$  å’Œ  $ W_C âˆˆ \mathbb R^{Câ€™ ,3}$ã€‚ç”±äºä½“ç´ ç‰¹å¾ä¸ç½‘æ ¼ç‚¹æ— å…³ï¼Œå› æ­¤åœ¨æ‰§è¡Œ voxel query æœç´¢ä¹‹å‰ï¼Œç›´æ¥åœ¨ä½“ç´ ç‰¹å¾ä¸Šåº”ç”¨äº†æƒé‡ä¸º $W_F$ çš„å…¨è¿æ¥å±‚ã€‚ç„¶åï¼Œåœ¨ voxel query ä¹‹åï¼Œæˆ‘ä»¬åªå°†åˆ†ç»„çš„ç›¸å¯¹åæ ‡ä¹˜ä»¥ $W_C$ï¼Œå¾—åˆ°ç›¸å¯¹ä½ç½®ç‰¹å¾ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°åˆ†ç»„çš„ä½“ç´ ç‰¹å¾ä¸­</p><p>åŠ é€Ÿ PointNet æ¨¡å—çš„ FLOP ä¸º $O(N Ã—C Ã—Câ€™ +M Ã—K Ã— 3Ã—Câ€™)$ï¼Œç”±äºåˆ†ç»„ä½“ç´ çš„æ•°é‡ $M Ã—K$ æ¯” $N$ é«˜ä¸€ä¸ªæ•°é‡çº§ï¼Œå› æ­¤åŠ é€Ÿçš„ PointNet æ¨¡å—æ¯”åŸå§‹æ¨¡å—æ›´é«˜æ•ˆã€‚æ›´ç›´è§‚åœ°æ¥è®²ï¼Œè¿™æ ·å‡å°‘äº†å¾ˆå¤šç”±äºé‡å çš„é‚»å±…äº§ç”Ÿçš„ç‰¹å¾æå–æ“ä½œ</p><p>è¿™éƒ¨åˆ†å†…å®¹å¼•èµ·äº†æˆ‘å¯¹äº FC/MLP ä½œç”¨çš„æ€è€ƒï¼šMLP å°†åŸå§‹ç‰¹å¾é€šè¿‡<strong>ç®€å•çš„</strong>éçº¿æ€§å˜æ¢æ˜ å°„åˆ°æ–°çš„ç‰¹å¾ç©ºé—´ä¸­ï¼Œå…¶ä¸­ä¼´éšçš„ç»´åº¦å˜æ¢æ˜¯æœ€ç›´è§‚çš„ä½“ç°ã€‚ä»¥ä¸Šæ–¹æ³•åšç‰¹å¾èšé›†ç«Ÿç„¶å¯ä»¥å°†è¾“å…¥åˆ†å¼€æ¥çœ‹å¾…ï¼Œè¿™æ ·åšç«Ÿç„¶ä¸ä¼šå½±å“è¡¨ç°ï¼Œé‚£ä¸ºä»€ä¹ˆä¸å¯¹ç›¸å¯¹åæ ‡ä¹Ÿé‡‡ç”¨åŒæ ·çš„æ“ä½œï¼Œè¿™æ ·å¤æ‚åº¦ä¸º $O(N Ã—(C+3) Ã—Câ€™)$ ä¼šå˜å¾—æ›´å°</p><h3 id="Detection-head"><a href="#Detection-head" class="headerlink" title="Detection head"></a>Detection head</h3><p>ç»è¿‡ voxel RoI pooling è¿‡åæ¯ä¸€ä¸ªé€‰æ¡†éƒ½æœ‰å¯¹åº”çš„ç‰¹å¾å‘é‡é›†æ¥è¡¨ç¤ºï¼Œæ¥ä¸‹æ¥å°±ä½¿ç”¨è¿™äº›ç‰¹å¾å¯¹é€‰æ¡†è¿›è¡Œç»†åŒ–ã€‚å…·ä½“æ¥è®²ï¼Œä½¿ç”¨ä¸€ä¸ª shared 2-layer MLP å°† RoI ç‰¹å¾è¿›ä¸€æ­¥åšç‰¹å¾æå–ï¼Œå°†è¿™äº›ç‰¹å¾ç”¨äºç½®ä¿¡åº¦é¢„æµ‹å’Œå›å½’é¢„æµ‹ä¸¤ä¸ªä»»åŠ¡ã€‚å›å½’åˆ†æ”¯é¢„æµ‹ä» 3D é¢„æµ‹é€‰æ¡† proposals åˆ°çœŸå®æ¡†çš„æ®‹å·®ï¼Œç½®ä¿¡åº¦åˆ†æ”¯é¢„æµ‹ä¸ IoU ç›¸å…³çš„åˆ†æ•°ã€‚è¿™äº›éƒ½æ˜¯å¾ˆå¸¸è§„çš„æ“ä½œäº†ï¼Œä¸ PV-RCNN ä¸­æ˜¯ä¸€è‡´çš„ï¼Œä½¿ç”¨ binary cross entropy loss å’Œ smooth L1 lossï¼Œæ•°å­¦è¡¨ç¤ºå¦‚ä¸‹</p><script type="math/tex; mode=display">\begin{aligned}\mathcal{L}_{\text {head }}=& \frac{1}{N_{s}}\left[\sum_{i} \mathcal{L}_{\text {cls }}\left(p_{i}, l_{i}^{*}\left(\operatorname{IoU}_{i}\right)\right)\right.\\&\left.+\mathbb{1}\left(\operatorname{Io} U_{i} \geq \theta_{\text {reg }}\right) \sum_{i} \mathcal{L}_{\text {reg }}\left(\delta_{i}, t_{i}^{*}\right)\right]\end{aligned}</script><script type="math/tex; mode=display">l_{i}^{*}\left(\mathrm{IoU}_{i}\right)=\left\{\begin{array}{ll}0 & \mathrm{IoU}_{i}<\theta_{L} \\\frac{\mathrm{loU}_{i}-\theta_{L}}{\theta_{H}-\theta_{L}} & \theta_{L} \leq \mathrm{IoU}_{i}<\theta_{H} \\1 & \mathrm{IoU}_{i}>\theta_{H}\end{array}\right.</script><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="SECOND-amp-PV-RCNN"><a href="#SECOND-amp-PV-RCNN" class="headerlink" title="SECOND &amp; PV-RCNN"></a>SECOND &amp; PV-RCNN</h3><p><img src="/archives/de63c30e/image-20211020194545864.png"></p><p>è®ºæ–‡å¯¹ SECOND å’Œ PV-RCNN è¿›è¡Œäº†å®éªŒï¼Œä¸¤å¼ å›¾åˆ†åˆ«è¯´æ˜äº†ï¼š</p><ol><li>2-Stage çš„ç»†åŒ–æ˜¯æœ‰æ•ˆæœçš„ï¼Œå‰ä½œ PV-RCNN çš„è¡¨ç°æ˜¯ç›¸å½“ä¸é”™çš„</li><li>PV-RCNN ä¸­èŠ±è´¹äº†å¤§é‡æ—¶é—´ï¼ˆè¶…è¿‡ä¸€èˆ¬ï¼‰ç”¨äº voxel set abstraction (VSA) æ“ä½œï¼Œé€ç‚¹æ“ä½œ point-wise operation è®¡ç®—é‡å¾ˆå¤§</li></ol><h3 id="KITTI"><a href="#KITTI" class="headerlink" title="KITTI"></a>KITTI</h3><h4 id="val-set"><a href="#val-set" class="headerlink" title="val set"></a>val set</h4><p><img src="/archives/de63c30e/image-20220129123000757.png" alt="image-20220129123000757" style="zoom: 50%;"></p><h4 id="test-set"><a href="#test-set" class="headerlink" title="test set"></a>test set</h4><p><img src="/archives/de63c30e/image-20211020195023758.png"></p><p>å¯¹æ ‡ SA-SSDï¼Œåœ¨å‡†åº¦å’Œé€Ÿåº¦ä¸Šå‡å®ç°äº†è¶…è¶Š</p><h3 id="Waymo"><a href="#Waymo" class="headerlink" title="Waymo"></a>Waymo</h3><p><img src="/archives/de63c30e/image-20211020195307759.png"></p><h3 id="Ablation-study"><a href="#Ablation-study" class="headerlink" title="Ablation study"></a>Ablation study</h3><p><img src="/archives/de63c30e/image-20211020200856394.png"></p><p>å…¶ä¸­ä¸ä½¿ç”¨ voxel query åˆ™ä½¿ç”¨ ball query æ›¿ä»£ï¼ŒåŒºåˆ«è¯·å‚è€ƒ voxel query ä¸€èŠ‚ Figure 3ã€‚å¯ä»¥çœ‹å‡º voxel query ç¨å¾®åŠ å¿«äº†é€Ÿåº¦ä¹Ÿç¨å¾®æå‡äº†å‡†ç¡®ç‡ï¼Œå¯¹äºé€Ÿåº¦æå‡æœ€å¤§çš„æ˜¯ accelerated PointNet æ“ä½œã€‚å¯¹äºå‡†åº¦æå‡æœ€å¤§çš„åˆ™æ˜¯ 2-Stage detection headï¼Œä½†åŒæ—¶ä¹Ÿè®©é€Ÿåº¦ä¸‹é™ä¸€åŠå¤š</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>è¿™ä¸€ç¯‡è®ºæ–‡çš„ä¸­å¿ƒæ€æƒ³å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯ç›´æ¥ä½¿ç”¨ voxel-wise feature å¯¹é¢„æµ‹é€‰æ¡†è¿›è¡Œç»†åŒ–ï¼Œç„¶ååŠ é€Ÿäº† PointNet ç‰¹å¾æå–æ“ä½œï¼ŒäºŒè€…çš„ç»“åˆå½¢æˆäº†æœ¬æ–‡çš„æ ¸å¿ƒ voxel RoI poolingã€‚Voxel R-CNN åœ¨é€Ÿåº¦å’Œå‡†åº¦ä¸Šå…¨é¢è¶…è¶Šäº†å‰ä½œ PV-RCNNï¼Œé‡ç‚¹åœ¨äºå…¶ç½‘ç»œç»“æ„éå¸¸å¹²å‡€ï¼Œæ²¡æœ‰ä½¿ç”¨è¿‡å¤šçš„è¾…åŠ©æŠ€å·§ï¼Œå¦‚æœå°†å…¶ä»–è®ºæ–‡ä¸­çš„æå‡æŠ€å·§ç»“åˆåˆ°æœ¬è®ºæ–‡ä¸­ï¼ˆä¾‹å¦‚è¯­ä¹‰åˆ†å‰²ï¼‰ï¼Œåº”è¯¥ä¼šæœ‰æ›´å¤šçš„æå‡ï¼ŒæœŸå¾…ä¹‹åçš„å‘å±•</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Voxel R-CNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker</title>
      <link href="/archives/f5f9fa9b.html"/>
      <url>/archives/f5f9fa9b.html</url>
      
        <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>å¾ˆæ—©ä¹‹é—´å°±å¬è¯´ docker äº†ï¼Œæœ€è¿‘åœ¨ bilibili ä¸Šè¿˜çœ‹åˆ°äº†è¿™ä¹ˆä¸€ä¸ªè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV163411C7jE">ä¸ºä»€ä¹ˆæˆ‘ä¸ç”¨ Dockerï¼Ÿ</a> ç€å®æŠŠæˆ‘ç¬‘æ‹‰äº†ã€‚è€Œä¸”åœ¨çœ‹ MMDetection3D çš„æ—¶å€™å‘ç°å¯ä»¥é€šè¿‡ docker å®‰è£…ï¼Œé‚£ä¹ˆå°±å°è¯•ä¸€ä¸‹è¿™ä¸ªå·¥å…·å§ï¼ä¹Ÿè®¸åˆæ‰“å¼€äº†æ–°ä¸–ç•Œå¤§é—¨å‘¢ï¼Ÿæ›´å¤šå…³äºç§‘æ™®çš„çŸ¥è¯†å¯ä»¥çœ‹è¿™ç¯‡ <a href="https://zhuanlan.zhihu.com/p/187505981">çŸ¥ä¹</a>ï¼Œè¿™é‡Œå¼•ç”¨å…¶ä¸­ä¸€å¥è¯</p><blockquote><p>dockeræ˜¯ä¸€ä¸ªç”¨Goè¯­è¨€å®ç°çš„å¼€æºé¡¹ç›®ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ–¹ä¾¿çš„åˆ›å»ºå’Œä½¿ç”¨å®¹å™¨ï¼Œdockerå°†ç¨‹åºä»¥åŠç¨‹åºæ‰€æœ‰çš„ä¾èµ–éƒ½æ‰“åŒ…åˆ°docker containerï¼Œè¿™æ ·ä½ çš„ç¨‹åºå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒéƒ½ä¼šæœ‰ä¸€è‡´çš„è¡¨ç°ï¼Œè¿™é‡Œç¨‹åºè¿è¡Œçš„ä¾èµ–ä¹Ÿå°±æ˜¯å®¹å™¨å°±å¥½æ¯”é›†è£…ç®±ï¼Œå®¹å™¨æ‰€å¤„çš„æ“ä½œç³»ç»Ÿç¯å¢ƒå°±å¥½æ¯”è´§èˆ¹æˆ–æ¸¯å£ï¼Œ<strong>ç¨‹åºçš„è¡¨ç°åªå’Œé›†è£…ç®±æœ‰å…³ç³»(å®¹å™¨)ï¼Œå’Œé›†è£…ç®±æ”¾åœ¨å“ªä¸ªè´§èˆ¹æˆ–è€…å“ªä¸ªæ¸¯å£(æ“ä½œç³»ç»Ÿ)æ²¡æœ‰å…³ç³»</strong>ã€‚</p></blockquote><p>æ•´ä¸ªç¬”è®°å‚è€ƒ <a href="https://www.bilibili.com/video/BV1og4y1q7M4">ç‹‚ç¥è¯´ Docker</a>ï¼Œæ‰“ç®—æ•´ç†ä¸€äº›åŸºæœ¬é€»è¾‘å’Œå‘½ä»¤ï¼Œæ–¹ä¾¿ä¹‹åå¤ä¹ ä¸æŸ¥çœ‹</p><p>Link: <a href="https://dockerlabs.collabnix.com/docker/cheatsheet/">Docker Cheat Sheet</a></p><h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><p>è¿™ä¸€æ­¥å°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥ä¸Š <a href="https://www.docker.com/">å®˜ç½‘</a> ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä¸Šé¢æåˆ°çš„è§†é¢‘æ•™ç¨‹è¿›è¡Œä¸‹è½½ã€‚å¦‚æœä¸‹è½½å¾ˆæ…¢çš„è¯ä¾æ—§è€ƒè™‘é•œåƒå®‰è£…ï¼Œè¿™é‡Œè´´ä¸€ä¸ªè‡ªå®¶é•œåƒå…³äº docker çš„å¸®åŠ©æ–‡æ¡£ï¼š<a href="https://mirror.nju.edu.cn/help/docker-ce">NJU Mirror</a>ï¼ŒåŒæ—¶å®˜æ–¹ä¹Ÿæä¾›äº†å¸è½½ docker çš„æ“ä½œï¼Œå¯ä»¥æ”¾å¿ƒä¸‹è½½äº†ï¼ç°åœ¨æˆ‘æ˜¯åœ¨ windows ä¸Šç†Ÿæ‚‰ docker æ“ä½œï¼Œç›´æ¥å‚»ç“œå¼ä¸‹è½½äº† docker desktopï¼Œå…¶ä¸­ Windows å®‰è£…å¯èƒ½é‡åˆ°æŠ¥é”™ <code>WSL 2 installation is incomplete</code>ï¼Œæ ¹æ®æç¤ºä¸‹è½½ <a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">WLS_update_x64.msi</a> å®‰è£…å³å¯</p><h2 id="Docker-åŸºæœ¬ç»„æˆ"><a href="#Docker-åŸºæœ¬ç»„æˆ" class="headerlink" title="Docker åŸºæœ¬ç»„æˆ"></a>Docker åŸºæœ¬ç»„æˆ</h2><ol><li><p>é•œåƒï¼ˆimageï¼‰</p><blockquote><p>When running a container, it uses an isolated filesystem. This custom filesystem is provided by a <strong>container image</strong>. Since the image contains the containerâ€™s filesystem, it must contain everything needed to run an application - all dependencies, configuration, scripts, binaries, etc. The image also contains other configuration for the container, such as environment variables, a default command to run, and other metadata.</p></blockquote></li><li><p>å®¹å™¨ï¼ˆcontainerï¼‰</p><blockquote><p>A container is a sandboxed process on your machine that is isolated from all other processes on the host machine. </p></blockquote><p>ä¸€ç§å½¢è±¡çš„è¯´æ³•æ—¶ï¼Œé•œåƒæ˜¯ç±» classï¼Œå®¹å™¨æ˜¯ç±»çš„å®ä¾‹ object</p></li><li><p>ä»“åº“ï¼ˆrepositoryï¼‰</p><p>å°±åƒ github ä¸€æ ·ï¼Œä»“åº“ dockerhub å¯ä»¥å­˜æ”¾å„ç§å¼€æºé•œåƒä»¥ä¾›å¤§å®¶ä¸‹è½½ï¼Œå¦‚æœä¸‹è½½ dockerhub çš„é€Ÿåº¦æ…¢ï¼Œä¾ç„¶å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæºè¿›è¡Œä¸‹è½½ï¼Œ<a href="https://mirror.nju.edu.cn/help/docker-hub">NJU Mirror</a></p></li></ol><h2 id="Docker-çš„å¸¸ç”¨å‘½ä»¤"><a href="#Docker-çš„å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Docker çš„å¸¸ç”¨å‘½ä»¤"></a>Docker çš„å¸¸ç”¨å‘½ä»¤</h2><p><a href="https://docs.docker.com/reference/">å®˜æ–¹å‚è€ƒæ–‡æ¡£</a></p><h3 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker version<span class="token comment"># æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span>docker info<span class="token comment"># æ˜¾ç¤º docker çš„ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨çš„æ•°é‡</span>docker <span class="token punctuation">[</span>command<span class="token punctuation">]</span> --help<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># æŸ¥çœ‹é•œåƒ</span>docker images<span class="token comment"># æŸ¥çœ‹ images</span>docker images -aq<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰ images id.</span><span class="token comment"># a for all, q for quiet</span><span class="token comment"># æœç´¢é•œåƒ</span>docker search img_name<span class="token comment"># æœç´¢é•œåƒ</span>docker search -f<span class="token comment"># filter</span><span class="token comment"># ä¸‹è½½é•œåƒ</span>docker pull name:tag<span class="token comment"># ä¸‹è½½é•œåƒï¼Œå¯ä»¥æŒ‡å®šæ ‡ç­¾/ç‰ˆæœ¬</span><span class="token comment"># åˆ é™¤é•œåƒ</span>docker rmi img_name<span class="token comment"># ç§»é™¤é•œåƒ</span>docker rmi -f img_name<span class="token comment"># å¼ºåˆ¶åˆ é™¤é•œåƒ</span>docker rmi -f <span class="token variable"><span class="token variable">$(</span>docker images -aq<span class="token variable">)</span></span><span class="token comment"># å¼ºåˆ¶åˆ é™¤å…¨éƒ¨é•œåƒ</span>docker image prune -a<span class="token comment"># æ¸…ç†æ²¡æœ‰ä½¿ç”¨çš„é•œåƒ</span><span class="token comment"># ç»™é•œåƒæ‰“æ ‡ç­¾</span>docker tag src_img dst_img:tag<span class="token comment"># åˆ›é€ æ–°çš„é•œåƒåŠæ–°æ ‡ç­¾</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3><p>æœ‰äº†é•œåƒ image è¿‡åæ‰èƒ½åˆ›å»ºå®¹å™¨ containerï¼Œè¿™ä¸€éƒ¨åˆ†çš„å‘½ä»¤æ˜¯æœ€æ ¸å¿ƒçš„ä¹Ÿæ˜¯æœ€å¤šçš„</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># åˆ›å»ºå®¹å™¨</span>docker run <span class="token punctuation">[</span>opt<span class="token punctuation">]</span> img<span class="token comment"># å¸¸ç”¨å‚æ•°</span>--name string<span class="token comment"># ç»™å®¹å™¨å‘½å</span>-d, --detached<span class="token comment"># åå°è¿è¡Œ</span>-it<span class="token comment"># äº¤äº’ç»ˆç«¯ interactive terminal</span>-p host_port:ctn_port<span class="token comment"># æŒ‡å®šæš´éœ²ç«¯å£</span>--rm<span class="token comment"># é€€å‡ºååˆ é™¤å®¹å™¨</span>--hostname name<span class="token comment"># æŒ‡å®šä¸»æœºå</span><span class="token comment"># æŸ¥çœ‹å®¹å™¨</span>docker <span class="token function">ps</span><span class="token comment"># æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</span>docker <span class="token function">ps</span> -a<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</span>docker <span class="token function">ps</span> -q<span class="token comment"># æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨id</span>docker <span class="token function">ps</span> -n int<span class="token comment"># é™åˆ¶æ˜¾ç¤ºæ•°é‡</span>docker logs --tail <span class="token number">10</span> ctn_id<span class="token comment"># æŸ¥çœ‹å®¹å™¨æ“ä½œæ—¥å¿—</span>docker <span class="token function">top</span> ctn_id<span class="token comment"># æŸ¥çœ‹å®¹å™¨è¿›ç¨‹</span>docker inspect ctn_id<span class="token comment"># æŸ¥çœ‹å®¹å™¨å…ƒæ•°æ®</span><span class="token comment"># é€€å‡ºå®¹å™¨</span><span class="token builtin class-name">exit</span><span class="token comment"># å®Œå…¨é€€å‡º</span>ctrl + P + Q<span class="token comment"># å®¹å™¨åœ¨åå°ä»è¿è¡Œ</span><span class="token comment"># å¯åŠ¨å’Œåœæ­¢å®¹å™¨</span>docker start ctn_iddocker start -ai ctn_id<span class="token comment"># å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨äº¤äº’</span>docker restart ctn_iddocker stop ctn_iddocker <span class="token function">kill</span> ctn_id<span class="token comment"># å¼ºåˆ¶åœæ­¢</span><span class="token comment"># è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</span>docker <span class="token builtin class-name">exec</span> -it ctn_id<span class="token comment"># è¿›å…¥å®¹å™¨å¹¶å¼€å¯æ–°ç»ˆç«¯</span>docker attach ctn_id<span class="token comment"># è¿›å…¥æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯</span><span class="token comment"># åˆ é™¤å®¹å™¨</span>docker <span class="token function">rm</span> ctn_id<span class="token comment"># åˆ é™¤æŒ‡å®šå®¹å™¨</span>docker <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -aq<span class="token variable">)</span></span><span class="token comment"># å¼ºåˆ¶åˆ é™¤æ‰€æœ‰å®¹å™¨</span><span class="token comment"># æ‹·è´å®¹å™¨æ–‡ä»¶è‡³ä¸»æœº</span>docker <span class="token function">cp</span> ctn_id:src_path dst_path<span class="token comment"># ä¹‹åä½¿ç”¨å·æŠ€æœ¯ -v å¯ä»¥å®ç°æ–‡ä»¶å…±äº«</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šçš„ <code>ctn_id</code> æŒ‡çš„æ—¶å®¹å™¨ idï¼Œä¹Ÿå¯ä»¥ç”¨å®¹å™¨åæ›¿ä»£ï¼Œå¦‚æœæœ‰çš„è¯</p><p>è¡¥å……ï¼šè‡ªå·±æ‹…å¿ƒä¸‹è½½çš„é•œåƒå¤ªå¤šäº†ä¼šå ç”¨ C ç›˜ï¼Œæ‰€ä»¥ä½¿ç”¨ç›®å½•è¿æ¥ï¼Œå°† docker appdata ç§»åˆ°äº† D ç›˜</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd"># ç®¡ç†å‘˜æƒé™mklink /j Docker D:\AppData\Dockermklink /j target source<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="Docker-é•œåƒè®²è§£"><a href="#Docker-é•œåƒè®²è§£" class="headerlink" title="Docker é•œåƒè®²è§£"></a>Docker é•œåƒè®²è§£</h2><h3 id="é•œåƒåŠ è½½åŸç†"><a href="#é•œåƒåŠ è½½åŸç†" class="headerlink" title="é•œåƒåŠ è½½åŸç†"></a>é•œåƒåŠ è½½åŸç†</h3><p>UnionFS æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿã€‚æ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚åœ¨è¿™ç§å±‚çº§ç»“æ„ä¸‹ï¼Œå¦‚æœæœ‰æ¶‰åŠåˆ°ç›¸åŒçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå±‚ä¸å±‚é—´å°±å¯ä»¥å…±ç”¨äº†ï¼Œæå¤§èŠ‚çœèµ„æº</p><p>docker çš„é•œåƒå®é™…ä¸Šç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§æ–‡ä»¶ç³»ç»Ÿå°±æ˜¯ä¸Šè¿°çš„ UnionFSã€‚æ¥ç€ï¼Œåœ¨å†…éƒ¨åˆåˆ†ä¸º2éƒ¨åˆ†ï¼š</p><ul><li>boot file system ï¼ˆbootfsï¼‰ï¼šdockeré•œåƒçš„æœ€åº•å±‚æ˜¯bootfsï¼Œä¸»è¦åŒ…å« bootloaderï¼ˆåŠ è½½å™¨ï¼‰å’Œ kernelï¼ˆå†…æ ¸ï¼‰ã€‚bootloader ä¸»è¦æ˜¯å¼•å¯¼åŠ è½½ kernelã€‚æ³¨æ„ kernel æ˜¯ä¸å®¿ä¸»æœºå…±äº«çš„ï¼Œè€Œä¸”ä¸ç”¨åƒè™šæ‹Ÿæœºä¸€æ ·æ¨¡æ‹Ÿç¡¬ä»¶ï¼Œæ‰€ä»¥ docker åŠ è½½å¾ˆå¿«ï¼Œæ˜¯ç§’çº§çš„</li><li>root file system ï¼ˆrootfsï¼‰ï¼šåŒ…å«å…¸å‹çš„ç›®å½•ç»“æ„ï¼ŒåŒ…æ‹¬ /dev, /proc, /bin, /etc, /lib, /usr, and /tmp ç­‰å†åŠ ä¸Šè¦è¿è¡Œç”¨æˆ·åº”ç”¨æ‰€éœ€è¦çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶å’Œåº“æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿåœ¨ä¸åŒçš„Linux å‘è¡Œç‰ˆï¼ˆUbuntu, CentOSâ€¦ï¼‰ä¸­æ˜¯ä¸åŒçš„ã€‚è€Œä¸”ç”¨æˆ·å¯ä»¥å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå¯¹æ¯”ä¹‹ä¸‹ï¼Œç”¨æˆ·å°±ä¸ä¼šä¿®æ”¹ bootfs</li></ul><p><img src="/archives/f5f9fa9b/image-20220129171824126.png" alt="image-20220129171824126" style="zoom: 50%;"></p><p>Docker é•œåƒéƒ½æ˜¯åªè¯»çš„ï¼Œå½“å¯åŠ¨å®¹å™¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ï¼Œè¿™ä¸€å±‚å°±æ˜¯é€šå¸¸è¯´çš„å®¹å™¨å±‚ï¼Œå®¹å™¨ä¹‹ä¸‹çš„éƒ½å«é•œåƒå±‚</p><h3 id="Commit-image"><a href="#Commit-image" class="headerlink" title="Commit image"></a>Commit image</h3><p>å½“ä½ åœ¨å®¹å™¨ä¸­å®Œæˆäº†ä½ çš„åº”ç”¨ï¼Œæƒ³è¦å°†è¯¥å®¹å™¨ç”Ÿæˆé•œåƒï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>docker commit</code> å‘½ä»¤ã€‚æœ¬è´¨ä¸Šå°±æ˜¯æŠŠä½ çš„å®¹å™¨å±‚å˜ä¸ºé•œåƒå±‚ï¼ŒåŠ å…¥åˆ°åŸæ¥çš„é•œåƒå±‚ä¸­ï¼ˆroot file systemï¼‰å†æ‰“åŒ…ä¿å­˜èµ·æ¥ã€‚å› ä¸ºæ˜¯åˆ†å±‚æ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™æ ·çš„æ“ä½œå¾ˆæ–¹ä¾¿</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker commit -a <span class="token string">"author"</span> -m <span class="token string">"message"</span> ctn_id img_name:tag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·å°±å¯ä»¥æ‰“é€ è‡ªå·±çš„ä¸ªæ€§åŒ–é•œåƒäº†ï¼Œä½†ä¹‹åè¿˜ä¼šæœ‰æ›´é«˜çº§çš„æ–¹æ³• Dockerfile æ¥åˆ›é€ é•œåƒ</p><h3 id="Save-amp-load-image"><a href="#Save-amp-load-image" class="headerlink" title="Save &amp; load image"></a>Save &amp; load image</h3><p>æœ‰æ—¶å€™ä¸å¸Œæœ›ä»ç½‘ç»œä¸‹è½½é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ <code>docker save</code> å‘½ä»¤æ‰“åŒ…é•œåƒï¼Œç„¶åæŠŠé•œåƒä¼ è¾“ç»™éœ€è¦çš„äººï¼Œåˆ«äººå†ç”¨ <code>docker load</code> å°†é•œåƒåŠ è½½å³å¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker save -o xxx.tar imgdocker save -i xxx.tar <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å®¹å™¨æ•°æ®å·"><a href="#å®¹å™¨æ•°æ®å·" class="headerlink" title="å®¹å™¨æ•°æ®å·"></a>å®¹å™¨æ•°æ®å·</h2><p>è¿™æ˜¯ä¸€ç§å°†<strong>æ•°æ®æŒä¹…åŒ–/å…±äº«æ•°æ®</strong>çš„æŠ€æœ¯ã€‚æ•°æ®å·å¯ä»¥å°†å®¹å™¨ä¸å®¿ä¸»æœºï¼Œå®¹å™¨ä¸å®¹å™¨ä¹‹é—´è¿æ¥ä¸€ä¸ªé€šé“ï¼Œè¿›è¡Œæ•°æ®å…±äº«ï¼Œå¯åŒæ­¥ä¿®æ”¹ã€‚å¹¶ä¸”åˆ æ‰å…¶ä¸­ä¸€ä¸ªå®¹å™¨çš„æ•°æ®ï¼ˆä¸æ˜¯ä¿®æ”¹ï¼‰ï¼Œå…¶ä»–å®¹å™¨çš„å…±äº«æ•°æ®å¹¶ä¸ä¼šæŸåï¼Œè¿™å°±è¾¾åˆ°äº†æŒä¹…åŒ–çš„æ•ˆæœ</p><h3 id="ä½¿ç”¨æ•°æ®å·"><a href="#ä½¿ç”¨æ•°æ®å·" class="headerlink" title="ä½¿ç”¨æ•°æ®å·"></a>ä½¿ç”¨æ•°æ®å·</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># åœ¨åˆ›å»ºå®¹å™¨æ—¶é€šè¿‡å‚æ•° -v æŒ‚è½½</span>-v, --volume<span class="token operator">=</span><span class="token punctuation">[</span>host-src:<span class="token punctuation">]</span>container-dest<span class="token punctuation">[</span>:<span class="token operator">&lt;</span>options<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token comment"># The 'host-src' is an absolute path or a name value.</span><span class="token comment"># é€šè¿‡å¤šæ¬¡ -v å‚æ•°æŒ‚è½½å¤šä¸ªå·</span><span class="token comment"># æŒ‡å®šè·¯å¾„æŒ‚è½½</span><span class="token comment"># å¦‚æœä¸å­˜åœ¨è·¯å¾„åˆ™è‡ªåŠ¨åˆ›é€ </span>docker run -v host_dir:ctn_dir ctn_id<span class="token comment"># åŒ¿åæŒ‚è½½</span><span class="token comment"># ä»…ä¼ å…¥å®¹å™¨å†…è·¯å¾„</span>docker run -v ctn_dir ctn_id<span class="token comment"># å…·åæŒ‚è½½</span><span class="token comment"># ç»™å·æ·»åŠ åå­—ï¼Œæ³¨æ„è¿™åŒºåˆ«äºæŒ‡å®šè·¯å¾„æŒ‚è½½</span>docker run -v name:ctn_dir ctn_id <span class="token comment"># æŒ‡å®šè¯»å†™æƒé™ï¼Œå¦‚ ro æŒ‡å®¹å™¨åªèƒ½è¯»å·</span>docker run -v ctn_dir:ro ctn_iddocekr run -v ctn_dir:rw ctn_id<span class="token comment"># å®¹å™¨ä¹‹é—´çš„å…±äº«å·</span><span class="token comment"># å¯ä»¥å…¶ä»–å®¹å™¨çš„å·æŒ‚è½½åˆ°å½“å‰å®¹å™¨ä¸‹</span>docker run --volumes-from ctn_list ctn_id<span class="token comment"># æŸ¥çœ‹æ‰€æœ‰å·çš„æƒ…å†µ</span>docker volume <span class="token function">ls</span>docker volume inspect volume_id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>â€æŒ‚è½½â€œçš„æœ¬è´¨æ˜¯åœ¨å®¿ä¸»æœºåˆ›é€ äº†ä¸€ä¸ªæ•°æ®å· volumeï¼ˆå¦‚æœå®ç°æ²¡æœ‰è¯¥ volume çš„è¯ï¼‰ï¼Œå¯ä»¥æŠŠè¿™ä¸ªå·çœ‹ä½œä¸ºä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹ï¼Œé€šè¿‡æŒ‡å®šå‘½ä»¤å¤§å®¶éƒ½å¯ä»¥æ¥è®¿é—®å’Œä¿®æ”¹</p><p>æ•°æ®å·è¿˜å¯ä»¥ä½¿ç”¨ <code>docker inspect ctn_id</code> æŸ¥çœ‹è¯¦æƒ…ï¼Œåœ¨ <code>Mount</code> å­—æ®µä¸‹è®°å½•æœ‰ <code>Source &amp; Destination</code> åˆ†åˆ«å¯¹åº”å®¿ä¸»æœºå’Œå®¹å™¨å†…ç›®å½•</p><p>é™¤äº†é€šè¿‡ <code>-v</code> å‘½ä»¤æŒ‚è½½å·ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Dockerfile è¿›è¡ŒæŒ‚è½½ï¼Œé€šè¿‡æŒ‡å®š VOLUME å­—æ®µï¼Œç¡®å®šå®¹å™¨å†…æŒ‚è½½è·¯å¾„</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">VOLUME <span class="token punctuation">[</span><span class="token string">"DIR_1"</span>,<span class="token string">"DIR_2"</span>,<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»¥ä¸Šçš„æ“ä½œéƒ½æ˜¯åœ¨åˆ›å»ºå®¹å™¨æ—¶æŒ‚è½½å·ï¼Œå¦‚æœåœ¨åˆ›å»ºå¥½å®¹å™¨ä¹‹åæƒ³è¦æŒ‚è½½å·åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿäº‹å®ä¸Šä¹Ÿæ²¡æœ‰ä¸€ä¸ªä¼˜é›…çš„åŠæ³•èƒ½è§£å†³ï¼Œå¯ä»¥é€‰æ‹©å°†è¯¥å®¹å™¨ commit ä¸ºé•œåƒï¼Œç„¶åå†è¿›è¡Œåˆ›å»º</p><h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><p>åœ¨ä¸Šä¸€èŠ‚é¦–æ¬¡æåˆ°äº†ä½¿ç”¨ dockerfile æŒ‚è½½å·ã€‚Dockerfile æ˜¯ç”¨æ¥æ„å»º docker é•œåƒçš„æ–‡ä»¶ï¼Œæœ¬è´¨ä¸ºä¸€ä¸ªå‘½ä»¤å‚æ•°è„šæœ¬ã€‚å…ˆæ¥çœ‹çœ‹ä¸€äº›å®˜æ–¹çš„ dockerfile æ˜¯æ€ä¹ˆå†™çš„ğŸ˜€</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM scratchADD ubuntu-focal-oci-amd64-root.tar.gz /# å‡è®¾è¯¥å‹ç¼©æ–‡ä»¶å·²ç»é¢„å…ˆä¸‹è½½åˆ°åé¢æŒ‡å®šçš„ç›®å½•CMD ["bash"]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸‰è¡Œå°±åˆ›å»ºäº†ä¸€ä¸ª Ubuntu 20.04 dockerfileï¼Œä¸€èˆ¬å®˜æ–¹æ‰€ç»™çš„éƒ½æ˜¯æœ€åŸºç¡€çš„ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥æœ‰æ—¶å€™éœ€è¦è‡ªå·±åˆ›å»º dockerfile ä»¥åŠå¯¹åº”çš„é•œåƒã€‚ç®€å•ä»‹ç»ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ï¼š</p><ol><li>æ‰€æœ‰å‘½ä»¤éƒ½æ˜¯å¤§å†™</li><li>å‘½ä»¤æŒ‰ç…§é¡ºåºä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ</li><li>æ³¨é‡Šä½¿ç”¨äº•å· #</li><li>æ¯ä¸ªå‘½ä»¤éƒ½ä¼šå½¢æˆä¸€ä¸ªæ–°çš„é•œåƒå±‚</li></ol><h3 id="Dockerfile-å‘½ä»¤"><a href="#Dockerfile-å‘½ä»¤" class="headerlink" title="Dockerfile å‘½ä»¤"></a>Dockerfile å‘½ä»¤</h3><p>Dockerfile çš„å¸¸ç”¨å‘½ä»¤åŠå…¶ä½œç”¨</p><ul><li>FROMï¼šåŸºäºå“ªä¸ªåŸºç¡€é•œåƒ</li><li>WORKDIRï¼šæŒ‡å®šshellå‘½ä»¤è¿è¡Œåœ¨å“ªä¸ªç›®å½•ä¸‹ã€‚ä¸ºåç»­çš„ RUNã€CMDã€COPYã€ADD ç­‰å‘½ä»¤é…ç½®å·¥ä½œç›®å½•ã€‚æ¥ä¸‹æ¥çš„ COPY å’Œ ADD å‘½ä»¤ä¸­çš„ç›¸å¯¹è·¯å¾„å°±æ˜¯ç›¸å¯¹äº WORKDIR æŒ‡å®šçš„è·¯å¾„</li><li>COPYï¼šå°†å½“å‰å®¿ä¸»æœºçš„æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­å»ï¼ˆ<strong>copyçš„æ–‡ä»¶å¿…é¡»åœ¨buildå‘½ä»¤æœ€åæŒ‡å®šçš„è·¯å¾„å†…</strong>ï¼‰</li><li>ADDï¼šå’ŒCOPYä¸€æ ·ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è§£å‹ç¼©ï¼Œæˆ–è€…ä» url æ‹·è´æ–‡ä»¶åˆ°é•œåƒä¸­ã€‚<strong>COPY å’Œ ADD å‘½ä»¤å…·æœ‰ç›¸åŒçš„ç‰¹ç‚¹ï¼šåªå¤åˆ¶ç›®å½•ä¸­çš„å†…å®¹è€Œä¸åŒ…å«ç›®å½•è‡ªèº«</strong>ã€‚</li><li>RUNï¼šæ„å»ºé•œåƒæ—¶è¿è¡Œçš„shellå‘½ä»¤</li><li>CMDï¼šå®¹å™¨è¿è¡Œæ—¶æ‰§è¡Œçš„shellå‘½ä»¤ï¼ˆ<strong>å¤šä¸ªCMDåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼Œè¦æƒ³éƒ½æ‰§è¡Œå¯ä»¥ä½¿ç”¨&amp;&amp;è¿æ¥å¤šä¸ªå‘½ä»¤</strong>ï¼‰ï¼ˆ<strong>å¦‚æœå®¹å™¨runæ—¶ï¼Œåé¢æŒ‡å®šäº†shellç‰ˆæœ¬ï¼ŒDockerfileä¸­çš„CMDä¹Ÿä¼šè¢«è¦†ç›–</strong>ï¼‰</li><li>ENTRYPOINTï¼šå’ŒCMDä¸€æ ·ï¼Œä½†æ˜¯å¯ä»¥è¿½åŠ ï¼ˆå¿…é¡»ä½¿ç”¨execæ ¼å¼ï¼Œå³ï¼šENTRYPOINT [./entrypoint.shï¼Œå‚æ•°1ï¼Œå‚æ•°2â€¦â€¦]ï¼‰</li><li>EXPOSEï¼šæŒ‡å®šé•œåƒæš´éœ²å‡ºæ¥çš„ç«¯å£</li><li>VOLUMUï¼šæ•°æ®å®¹å™¨å·ï¼ŒæŒ‡å®šæ˜ å°„æ–‡ä»¶ï¼Œç”¨äºæ•°æ®æŒä¹…åŒ–</li><li>ENVï¼šæŒ‡å®šç¯å¢ƒå˜é‡</li><li>LABELï¼šæŒ‡å®šå®¹å™¨è¿è¡Œæ—¶æ ‡ç¤º</li><li>SHELLï¼šæŒ‡å®šshell</li><li>MAINTAINERï¼šé•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€</li><li>ONBUILDï¼šå½“æ„å»ºä¸€ä¸ªçˆ¶é•œåƒæ—¶ï¼Œçˆ¶é•œåƒè¢«å­é•œåƒç»§æ‰¿æ—¶ï¼ŒONBUILDè¢«è§¦å‘</li></ul><p>è¿™é‡Œè´´ä¸€ä¸ª mmdetection 3D å†™çš„ dockerfile</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">ARG PYTORCH="1.6.0"ARG CUDA="10.1"ARG CUDNN="7"FROM pytorch/pytorch:${PYTORCH}-cuda${CUDA}-cudnn${CUDNN}-devel# å¦‚æœé¢„å…ˆæ²¡æœ‰ä¸‹è½½è¯¥é•œåƒï¼ŒçŒœæµ‹ä¼šè‡ªåŠ¨è£…ï¼Œç±»ä¼¼ docker runENV TORCH_CUDA_ARCH_LIST="6.0 6.1 7.0+PTX"ENV TORCH_NVCC_FLAGS="-Xfatbin -compress-all"ENV CMAKE_PREFIX_PATH="$(dirname $(which conda))/../"RUN apt-get update &amp;&amp; apt-get install -y ffmpeg libsm6 libxext6 git ninja-build libglib2.0-0 libsm6 libxrender-dev libxext6 \    &amp;&amp; apt-get clean \    &amp;&amp; rm -rf /var/lib/apt/lists/*# Install MMCV, MMDetection and MMSegmentationRUN pip install mmcv-full==1.3.8 -f https://download.openmmlab.com/mmcv/dist/cu101/torch1.6.0/index.htmlRUN pip install mmdet==2.17.0RUN pip install mmsegmentation==0.18.0# Install MMDetection3DRUN conda clean --allRUN git clone https://github.com/open-mmlab/mmdetection3d.git /mmdetection3dWORKDIR /mmdetection3dENV FORCE_CUDA="1"RUN pip install -r requirements/build.txtRUN pip install --no-cache-dir -e .<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ dockerfile ç”Ÿæˆé•œåƒçš„å¸¸ç”¨å‘½ä»¤</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker build -t name:tag -f dockerfile_name FILE_PATH<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å‘å¸ƒé•œåƒ"><a href="#å‘å¸ƒé•œåƒ" class="headerlink" title="å‘å¸ƒé•œåƒ"></a>å‘å¸ƒé•œåƒ</h2><h3 id="DockerHub"><a href="#DockerHub" class="headerlink" title="DockerHub"></a>DockerHub</h3><ol><li><p>æ³¨å†Œ dockerhub è´¦æˆ·</p></li><li><p>ç™»å½•ï¼Œç›´æ¥è¾“å…¥ <code>docker login</code> å°±ä¼šæç¤ºè¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥å¸¦å‚æ•°</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker login -u username<span class="token comment"># Password:</span>docker <span class="token builtin class-name">logout</span><span class="token comment"># é€€å‡ºç™»å½•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å‘å¸ƒé•œåƒ <code>docker push img:tag</code></p></li></ol><p>ä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…ä»“åº“è¿›è¡Œå‘å¸ƒï¼Œä¾‹å¦‚é˜¿é‡Œäº‘ï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç»äº†</p><h2 id="ä»¥å›¾ç‰‡å°ç»“-Docker"><a href="#ä»¥å›¾ç‰‡å°ç»“-Docker" class="headerlink" title="ä»¥å›¾ç‰‡å°ç»“ Docker"></a>ä»¥å›¾ç‰‡å°ç»“ Docker</h2><p><img src="/archives/f5f9fa9b/format,png.png"></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VoxelNet &amp; SECOND</title>
      <link href="/archives/4486189f.html"/>
      <url>/archives/4486189f.html</url>
      
        <content type="html"><![CDATA[<h1 id="VoxelNet-amp-SECOND"><a href="#VoxelNet-amp-SECOND" class="headerlink" title="VoxelNet &amp; SECOND"></a>VoxelNet &amp; SECOND</h1><hr><p>Zhou, Yin, and Oncel Tuzel. â€œVoxelNet: End-to-End Learning for Point Cloud Based 3D Object Detection.â€ <em>ArXiv:1711.06396 [Cs]</em>, November 16, 2017. <a href="http://arxiv.org/abs/1711.06396">http://arxiv.org/abs/1711.06396</a>.</p><p>Yan, Yan, Yuxing Mao, and Bo Li. â€œSECOND: Sparsely Embedded Convolutional Detection.â€ <em>Sensors</em> 18, no. 10 (October 6, 2018): 3337. <a href="https://doi.org/10.3390/s18103337">https://doi.org/10.3390/s18103337</a>.</p><hr><h2 id="VoxelNet"><a href="#VoxelNet" class="headerlink" title="VoxelNet"></a>VoxelNet</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>VoxelNet ä½œä¸ºä½“ç´ åŒ–å¤„ç†ç‚¹äº‘çš„å¥ åŸºä¹‹ä½œï¼Œå…¶åœ°ä½ä¹Ÿæ˜¯ç›¸å½“é«˜çš„ã€‚è¯¥è®ºæ–‡ä¸ºä¹‹åçš„ä½“ç´ åŒ–æ¡†æ¶æä¾›äº†é€šç”¨çš„æ€è·¯ï¼šè¯¥ç½‘ç»œå°†ç‚¹äº‘åˆ†å‰²ä¸ºå‡åŒ€çš„ 3D ä½“ç´ å—ï¼Œå¹¶å°†æ¯ä¸€ä¸ªä½“ç´ å†…çš„ç‚¹ä½¿ç”¨ç»Ÿä¸€çš„ç‰¹å¾è¡¨ç¤ºã€‚ç„¶åå†å°† 3D ç‰¹å¾å›¾è°±è½¬åŒ–ä¸º BEV ç‰¹å¾å›¾è°±è¿›è¡Œé€‰æ¡†é¢„æµ‹</p><p>åœ¨å½“æ—¶å¯¹äºç‚¹äº‘ç‰¹å¾æå–è¿˜å¤„äºèµ·æ­¥é˜¶æ®µï¼ŒPointNet åˆšåˆšé—®ä¸–ï¼Œå¯¹äºç‰¹å¾æå–ä¸å†ä½¿ç”¨äººå·¥è®¾è®¡ç‰¹å¾ï¼Œå¤šè§†è§’èåˆçš„æ–¹æ³•ä¹Ÿé€æ¸è¢«è¶…è¶Šã€‚ä½†æ˜¯ PointNet åºå¤§çš„è¿ç®—é‡æ˜¯ä¸€ä¸ªäºŸéœ€è§£å†³çš„é—®é¢˜ï¼Œä¸ºäº†æœ‰æ•ˆåœ°åˆ©ç”¨ç‚¹äº‘ï¼Œå°†å…¶è¿›è¡Œä½“ç´ åŒ–è¡¨ç¤ºä¸å¤±ä¸ºä¸€ä¸ªå¥½æ–¹å‘ï¼Œè§„åˆ™åŒ–çš„æ•°æ®ç»“æ„ä¸€èˆ¬æ˜¯æ›´åˆ©äºå­˜å‚¨ä¸å­¦ä¹ çš„ï¼ŒVoxelNet åº”è¿è€Œç”Ÿ </p><h3 id="VoxelNet-Architecture"><a href="#VoxelNet-Architecture" class="headerlink" title="VoxelNet Architecture"></a>VoxelNet Architecture</h3><p><img src="/archives/4486189f/image-20211018182525929.png"></p><h4 id="Feature-Learning-Network"><a href="#Feature-Learning-Network" class="headerlink" title="Feature Learning Network"></a>Feature Learning Network</h4><p>è¿™ä¸€éƒ¨åˆ†æ˜¯æ•´ä¸ªç½‘ç»œçš„æ ¸å¿ƒï¼Œè¯¦ç»†åœ°æè¿°äº†å¦‚ä½•å°†ç‚¹äº‘ç¼–ç ä¸ºä½“ç´ åŒ–ç‰¹å¾å›¾è°±ã€‚é¦–å…ˆæ˜¯å°†ç½‘ç»œåˆ†å‰²ä¸ºå‡åŒ€çš„ä½“ç´ å—ï¼Œæœ€ç»ˆå¯ä»¥ä½¿ç”¨ $(D,H,W)$ å½¢çŠ¶çš„çŸ©é˜µæ¥è¡¨ç¤ºè¯¥ä½“ç´ åŒ–ç‚¹äº‘ã€‚ç”±äºç‚¹äº‘ä¸­èƒ½å¤ŸåŒ…å« ~100k æ•°é‡çº§çš„ç‚¹ï¼Œæ‰€ä»¥å¯¹æ¯ä¸ªä½“ç´ å— $(d,h,w)$ ä¸­çš„ç‚¹çš„æ•°é‡è¿›è¡Œé™åˆ¶ï¼Œæœ€å¤šä¸è¶…è¿‡ $T$ ä¸ªç‚¹ï¼Œè¿™æ ·çš„é™åˆ¶èƒ½å¤Ÿå¾ˆå¥½çš„èŠ‚çº¦è®¡ç®—ï¼Œå¹³è¡¡æ¯ä¸ªä½“ç´ å—å†…çš„ç‚¹äº‘æ•°é‡</p><p>æ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨å¤šä¸ªä½“ç´ ç‰¹å¾ç¼–ç æ¨¡å— voxel feature encoding (VFE) å¯¹æ¯ä¸ªä½“ç´ å—å†…çš„ç‚¹äº‘è¿›è¡Œç‰¹å¾æå–ï¼Œä¸‹é¢å¯¹ VFE æ¨¡å—è¿›è¡Œè¯¦ç»†äº†è§£ã€‚å…¶ä¸­<strong>ä¸€ä¸ª</strong>éç©ºä½“ç´ å—ç‰¹å¾è¡¨ç¤ºä¸ºå¦‚ä¸‹å…¬å¼</p><script type="math/tex; mode=display">\mathbf{V}=\left\{\mathbf{p}_{i}=\left[x_{i}, y_{i}, z_{i}, r_{i}\right]^{T} \in \mathbb{R}^{4}\right\}_{i=1 \ldots t}</script><p>å³è¯¥ä½“ç´ å—ä¸­æ‰€æœ‰çš„ç‚¹ï¼Œå…¶ä¸­ $r_i$ ä¸ºåå°„å¼ºåº¦ã€‚å°†è¯¥ç‰¹å¾è¿›è¡Œå¢å¼ºï¼ŒåŠ å…¥æ¯ä¸ªç‚¹è·ç¦»è¯¥ä½“ç´ ä¸­å¿ƒçš„åç§»é‡</p><script type="math/tex; mode=display">\mathbf{V_in}=\left\{\hat{\mathbf{p}}_{i}=\left[x_{i}, y_{i}, z_{i}, r_{i}, x_i-v_x, y_i-v_y, z_i-v_z\right]^{T} \in \mathbb{R}^{4}\right\}_{i=1 \ldots t}</script><p>å°†è¯¥ç‰¹å¾é€å…¥ç½‘ç»œï¼ˆFCN + BN + ReLUï¼‰å¾—åˆ°æ¯ä¸€ä¸ªç‚¹çš„ç‰¹å¾ $\mathbf{f}_i \in \mathbb{R}^m$ï¼Œç„¶åå†ä½¿ç”¨ MaxPooling è·å¾—è¯¥ä½“ç´ çš„æ•´ä½“ç‰¹å¾ $\tilde{\mathbf{f}}_i \in \mathbb{R}^m$ ã€‚ï¼ˆå…¶å®è¿™ä¸ªç»“æ„ä¸ PointNet æ˜¯ç›¸ä¼¼çš„ï¼Œåªä¸è¿‡è®ºæ–‡ä¸­åç§°å« FCN/MLP è€Œä¸æ˜¯ shared MLPï¼Œä½†å®é™…ä¸Š FCN çš„æƒé‡æ˜¯æ‰€æœ‰éç©ºä½“ç´ å…±äº«çš„ï¼‰</p><p>å°†ä½“ç´ çš„ç‰¹å¾ä¸é€ç‚¹çš„ç‰¹å¾ point-wise feature è¿æ¥èµ·æ¥</p><script type="math/tex; mode=display">\mathbf{f}_{i}^{o u t}=\left[\mathbf{f}_{i}^{T}, \tilde{\mathbf{f}}^{T}\right]^{T} \in \mathbb{R}^{2 m}</script><p>è¯¥æ“ä½œæ˜¯ä¸ºäº†ç»™æ¯ä¸ªç‚¹å¢åŠ å…¶æ‰€åœ¨ä½“ç´ çš„ä¿¡æ¯ã€‚ä»¥ä¸Šå°±æ˜¯ç¬¬ä¸€ä¸ª VFE æ¨¡å—çš„æ“ä½œè¿‡ç¨‹ï¼Œå°†ä½“ç´ ä¸­çš„ç‚¹äº‘ç¼–ç ä¸ºç»Ÿä¸€å½¢çŠ¶çš„ç‰¹å¾å‘é‡ï¼Œå›¾ç¤ºå¦‚ä¸‹</p><p><img src="/archives/4486189f/image-20211018193130912.png" style="zoom: 80%;"></p><p>è®ºæ–‡ä½¿ç”¨å¤šä¸ªè¿™æ ·çš„ VFE æ¨¡å—ï¼Œä¸æ–­åœ°å¯¹ç‚¹äº‘è¿›è¡Œç‰¹å¾æå–æ“ä½œï¼Œæœ€åä¸€ä¸ª VFE æ¨¡å—åœ¨ä½¿ç”¨ MaxPooling åï¼Œä¸å†å°†å…¶è¿æ¥åˆ°é€ç‚¹çš„ç‰¹å¾ä¸Šï¼Œå³æœ€ç»ˆå¾—åˆ°äº†ä¸€ä¸ªé€ä½“ç´ çš„ç‰¹å¾å›¾è°± voxel-wise featureï¼Œæ¯ä¸ªä½“ç´ çš„ç‰¹å¾ç»´æ•°è®°ä¸º $C$ï¼Œæ•´ä¸ªç‚¹äº‘çš„ç‰¹å¾å›¾è°±è¡¨ç¤ºä¸º $(C, D, H, W)$ å½¢çŠ¶çš„çŸ©é˜µ</p><h4 id="Convolutional-middle-layers"><a href="#Convolutional-middle-layers" class="headerlink" title="Convolutional middle layers"></a>Convolutional middle layers</h4><p>è¿™éƒ¨åˆ†è®ºæ–‡ä»¥å°‘é‡çš„æ–‡å­—æè¿°ç•¥è¿‡ã€‚å°±æ˜¯å¯¹æå–å‡ºæ¥çš„ä½“ç´ ç‰¹å¾è¿›è¡Œå·ç§¯æ“ä½œï¼Œè¡¨ç¤ºä¸º Conv3D(C_in, C_out, kernel_size, stride, padding)ã€‚è¿™ä¸€ç»“æ„çš„é€æ¸èšé›†ä½“ç´ ç‰¹å¾ï¼Œç¼©å°ç‰¹å¾å›¾è°±åˆ†è¾¨ç‡ï¼Œä¸æ–­æå‡å›¾è°±ä¸­æ¯ä¸ªåƒç´ çš„æ„Ÿå—é‡</p><h4 id="Region-Proposal-Network"><a href="#Region-Proposal-Network" class="headerlink" title="Region Proposal Network"></a>Region Proposal Network</h4><p>é¦–å…ˆå°† 3D çš„ç‰¹å¾å›¾è°±æ²¿ç€ z è½´ï¼Œé‡å¡‘ reshape ä¸º 2D çš„ BEV ä¿¯è§†ç‰¹å¾å›¾è°±ã€‚è½¬æ¢åˆ°äºŒç»´è¿‡åå°±æ˜¯ç†Ÿæ‚‰çš„é¢†åŸŸäº†ï¼Œå…ˆä½¿ç”¨å¤šä¸ªäºŒç»´å·ç§¯æ¨¡å— Conv2D è¿›è¡Œç‰¹å¾æå–ï¼Œç„¶åå°†ä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾å›¾è°±è¿›è¡Œä¸Šé‡‡æ ·æˆ–è€…å«åå·ç§¯ upsampling/deconvolutionã€‚ç»è¿‡ä¸Šé‡‡æ ·åï¼Œå¾—åˆ°å¤šä¸ªåˆ†è¾¨ç‡ç›¸åŒçš„ç‰¹å¾å›¾è°±ï¼Œç„¶åå°†å®ƒä»¬è¿æ¥èµ·æ¥ï¼Œä½¿ç”¨ anchor-based detector è¿›è¡Œåˆ†ç±»ä»»åŠ¡å’Œå›å½’ä»»åŠ¡ã€‚æ•´ä¸ª RPN ç½‘ç»œçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º    </p><p><img src="/archives/4486189f/image-20211018193754367.png"></p><p>å¯¹äº anchor çš„è®¾ç½®ä¸åƒäºŒç»´ä¸€æ ·æœ‰å¾ˆå¤šä¸ªå°ºåº¦çš„ anchorï¼Œè®ºæ–‡ä»…ä½¿ç”¨äº†ä¸€ä¸ª anchor size å’Œä¸¤ä¸ªæ—‹è½¬è§’åº¦ï¼ˆæ°´å¹³å’Œå‚ç›´ï¼‰ä½œä¸ºé¢„å®šä¹‰é€‰æ¡†</p><h4 id="Loss-function"><a href="#Loss-function" class="headerlink" title="Loss function"></a>Loss function</h4><p>å…³äºå›å½’ä»»åŠ¡ä½¿ç”¨çš„æ˜¯å¯¹æ•°å¤§å° logarithmic size çš„æ®‹å·®å€¼ä½œä¸ºæ‹Ÿåˆå¯¹è±¡/æ ‡ç­¾ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨çœŸå®çš„æ®‹å·®å€¼ï¼Œå…·ä½“è¿™ä¹ˆåšçš„åŸå› æˆ‘ä¸å¤ªæ¸…æ¥šï¼Œå¯èƒ½å¯¹æ•°å‡½æ•°èƒ½å¤Ÿè®©æ ‡ç­¾æ›´åŠ å¹³æ»‘ï¼Œå¹¶ä¸”ä»å›¾åƒä¸Šæ¥çœ‹ï¼Œlog å‡½æ•°èƒ½å¤Ÿç¨å¾®é™ä½æƒ©ç½š</p><script type="math/tex; mode=display">\begin{array}{l}\Delta x=\frac{x_{c}^{g}-x_{c}^{a}}{d^{a}}, \Delta y=\frac{y_{c}^{g}-y_{c}^{a}}{d^{a}}, \Delta z=\frac{z_{c}^{g}-z_{c}^{a}}{h^{a}} \\\Delta l=\log \left(\frac{l^{g}}{l^{a}}\right), \Delta w=\log \left(\frac{w^{g}}{w^{a}}\right), \Delta h=\log \left(\frac{h^{g}}{h^{a}}\right) \\\Delta \theta=\theta^{g}-\theta^{a}\end{array}\\</script><script type="math/tex; mode=display">where \ d^{a}=\sqrt{\left(l^{a}\right)^{2}+\left(w^{a}\right)^{2}}</script><p>å›å½’ä»»åŠ¡çš„æŸå¤±å‡½æ•°ä¸º smooth L1 lossï¼Œåˆ†ç±»ä»»åŠ¡ä½¿ç”¨äº¤å‰ç†µæŸå¤± cross entropy lossï¼ˆè¿™ä¸ªæ—¶å€™ focal loss è¿˜æ²¡è¯ç”Ÿï¼Œåœ¨ä¹‹åå…¶å‡çº§æ¡†æ¶ SECOND ä¸­ä½¿ç”¨äº†ï¼‰</p><p><img src="/archives/4486189f/image-20211018195534649.png" style="zoom: 80%;"></p><p>ç”±äºæ˜¯ anchor-based RPN ä¾ç„¶æ˜¯è¦å¯¹é¢„å®šä¹‰é€‰æ¡† pre-defined anchors è¿›è¡Œæ­£è´Ÿåˆ†ç±»çš„ï¼Œè€Œä¸”å›å½’æŸå¤±å¯¹ positive anchor æ‰€é¢„æµ‹çš„é€‰æ¡†è®¡ç®—æŸå¤±</p><h4 id="Data-structure"><a href="#Data-structure" class="headerlink" title="Data structure"></a>Data structure</h4><p>æ—¢ç„¶ä½¿ç”¨äº†ä½“ç´ åŒ–è¡¨ç¤ºï¼Œå¿…å®šå¸¦æ¥æ•°æ®ç»“æ„ä¸Šçš„è¡¨ç¤ºä¼˜åŠ¿ã€‚ç”±äºç‚¹äº‘çš„ç¨€ç–æ€§ï¼Œæœ‰å¤§é‡çš„ä½“ç´ å†…éƒ¨æ˜¯æ²¡æœ‰ç‚¹äº‘çš„ï¼Œæ­¤æ—¶ä½¿ç”¨å“ˆå¸Œè¡¨èƒ½å¤Ÿå¿«é€Ÿåœ°æŸ¥æ‰¾ä½“ç´ é˜µä¸­çš„éç©ºä½“ç´ ã€‚å‡è®¾éç©ºçš„ä½“ç´ å—æœ€å¤šæœ‰ $K$ ä¸ªï¼Œåˆå§‹åŒ–ä¸€ä¸ª $(K,T,7)$ å½¢çŠ¶çš„çŸ©é˜µä»¥å­˜å‚¨æ¯ä¸ªä½“ç´ åŠå…¶å†…éƒ¨ç‚¹äº‘çš„ç‰¹å¾ï¼Œå…¶ä¸­ $T$ ä»£è¡¨ä¸€ä¸ªä½“ç´ å†…æœ€å¤šæœ‰ $T$ ä¸ªç‚¹ï¼Œ$7$ ä»£è¡¨åŸå§‹ç‚¹äº‘çš„ç‰¹å¾ã€‚ä»¥æ¯ä¸ªä½“ç´ çš„åæ ‡ä½œä¸º hash key åˆ¶ä½œ hash tableï¼Œé€šè¿‡éå†æ‰€æœ‰çš„ç‚¹ï¼Œå°±èƒ½å¤Ÿå°†æ¯ä¸ªç‚¹åˆ†é…åˆ°å¯¹åº”ä½“ç´ ä¸­ï¼Œæœ€ç»ˆç»™å‡ºä½“ç´ çš„åæ ‡ï¼Œå°±èƒ½å¤Ÿè¿…é€ŸæŸ¥æ‰¾å‡ºè¯¥ä½“ç´ å†…æ‰€æœ‰é‡‡æ ·ç‚¹çš„ä¿¡æ¯ã€‚ä»¥ä¸Šæ„é€ å“ˆå¸Œè¡¨+ç‰¹å¾æå–çš„è¿‡ç¨‹å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤º</p><p><img src="/archives/4486189f/image-20211018203646922.png"></p><h2 id="SECOND"><a href="#SECOND" class="headerlink" title="SECOND"></a>SECOND</h2><p>SECOND å¯ä»¥è¯´å°±æ˜¯ VoxelNet çš„å‡çº§ç‰ˆæœ¬ï¼Œæ›´å¿«æ›´å‡†ï¼Œå…¶æ•´ä¸ª SSD æ£€æµ‹æ¡†æ¶å¯ä»¥è¯´å·²ç»æˆä¸º Voxel-based SSD çš„ä¸»æµï¼Œæ˜¯ç°åœ¨ç»å¸¸ä½¿ç”¨çš„ backbone ä¹‹ä¸€ï¼Œèƒ½å¤Ÿéå¸¸æœ‰æ•ˆåœ°å°†ç‚¹äº‘ä½“ç´ åŒ–å¹¶è¿›è¡Œä¸‰ç»´å·ç§¯æ“ä½œã€‚è¿™ä¸€éƒ¨åˆ†ä»…ä»‹ç»ä¸€ä¸‹ SECOND ç½‘ç»œä¸ºä»€ä¹ˆæ›´å¿«ï¼Œè¿™ä¹Ÿæ˜¯è¯¥è®ºæ–‡çš„é‡ç‚¹è´¡çŒ®ä¹‹ä¸€ï¼Œä½¿ç”¨äº†ç¨€ç–å·ç§¯/å­æµå½¢å·ç§¯ sparse convolution/submanifold convolution æ”¹è¿›äº†åŸæ¥çš„ä¸‰ç»´å·ç§¯æ“ä½œï¼Œçœå»äº†å¤§é‡å¯¹ç©ºä½“ç´ çš„å·ç§¯æ“ä½œï¼ˆç‚¹äº‘çš„ç¨€ç–æ€§å¯¼è‡´å¤§é‡ä½“ç´ å—ä¸ºç©ºï¼‰ï¼Œä»è€ŒåŠ é€Ÿè®¡ç®—ã€‚ä¸‹é¢ç•™ä¸¤ä¸ªå‚è€ƒé“¾æ¥ï¼Œ</p><ol><li><p>çŸ¥ä¹ï¼š<a href="https://zhuanlan.zhihu.com/p/382365889">Link1</a> <a href="https://zhuanlan.zhihu.com/p/383299678">Link2</a>ï¼ˆä¸¤ä¸ªé“¾æ¥å†…å®¹ç›¸ä¼¼ï¼Œè®²è§£ç¨€ç–å·ç§¯/å­æµå½¢å·ç§¯ï¼‰</p></li><li><p>å­æµå½¢å·ç§¯å®šä¹‰ï¼š<a href="https://paperswithcode.com/method/submanifold-convolutions">Link3</a></p></li></ol><p>å…¶æ ¸å¿ƒæ€æƒ³ä¹Ÿæ˜¯å’Œ hash table ç±»ä¼¼ï¼Œåˆ›å»ºä¸€ä¸ª RuleBook è®°å½•ä¸‹æ¯ä¸ªä½“ç´ å—çš„è¾“å…¥ä½ç½®åœ¨å“ªé‡Œã€è¾“å‡ºä½ç½®åœ¨å“ªé‡Œã€å¯¹åº”ç›¸ä¹˜çš„å·ç§¯æ ¸æƒé‡åœ¨å“ªé‡Œã€‚é€šè¿‡éå†è¿™ä¸ª RuleBook å³å¯å®Œæˆä¸‰ç»´å·ç§¯æ“ä½œ</p><p>ä¸‹é¢ä»…ç•™ä¸€å¼ ç¤ºæ„å›¾ä»¥ä¾¿å¿«é€Ÿå¤ä¹ ï¼ˆå¦‚æœæ²¡çœ‹è¿‡å‚è€ƒé“¾æ¥åº”è¯¥æ˜¯å¾ˆéš¾çœ‹æ‡‚ï¼‰</p><p><img src="/archives/4486189f/v2-80514738ec783b83d56a2506a0a2150b_r.jpg"></p><p>ä¸ªäººå†é‡æ–°æ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li>æ„å»ºç¨€ç–å‘é‡ sparse tensor</li><li>é€šè¿‡ç¨€ç–å‘é‡æ„å»º RuleBook (hash in table &amp; hash out table åŒ…æ‹¬å…¶ä¸­)ï¼Œä»é€»è¾‘ä¸Šç†è§£ï¼šè¯¥ RuleBook è®°å½•äº†è¾“å…¥çš„ç¨€ç–å‘é‡ä½ç½®å’Œå¯¹åº”<strong>å·ç§¯æ ¸ä½ç½®</strong> $(i, j)$ ä»¥åŠå…¶è¾“å‡ºç¨€ç–å‘é‡çš„ä½ç½®ï¼Œä½†å®é™…ä¸Šæ˜¯ä»¥å·ç§¯æ ¸ä½ç½® $(i, j)$ ä¸ºä¸»å¯¼å»ºç«‹çš„</li><li>åŒæ—¶å¹¶è¡Œè®¡ç®—æ‰€æœ‰çš„è¾“å…¥ç¨€ç–å‘é‡ï¼Œå¹¶è·å¾—è¾“å‡ºç¨€ç–å‘é‡</li></ol><p>ä¸ºä»€ä¹ˆè¦å¼•å…¥å­æµå½¢å·ç§¯ï¼Ÿå› ä¸ºæ™®é€šçš„ç¨€ç–å·ç§¯ä¼šè®©æ„Ÿå—é‡è¿…é€Ÿå¢åŠ ï¼Œè®¸å¤š inactive çš„ç‚¹ç»è¿‡å·ç§¯è¿‡åå˜å¾— activeï¼Œè€Œå­æµå½¢å·ç§¯åˆ™ä¿è¯äº† active ç‚¹çš„ä¸ªæ•°ä¸å˜ï¼Œå‚è€ƒ <a href="https://github.com/facebookresearch/SparseConvNet">github</a></p><p><img src="/archives/4486189f/i.gif" alt="sparse convolution"></p><p><img src="/archives/4486189f/img.gif" alt="submanifold convolution"></p><p>é™¤äº†ç¨€ç–å·ç§¯çš„å†…å®¹ä¹‹å¤–ï¼ŒSECOND è¿˜è´¡çŒ®æœ‰ä¸¤ä¸ªé‡è¦è´¡çŒ®ï¼š</p><ol><li><p>å¯¹äºæ–¹å‘æŸå¤±å‡½æ•°çš„æ”¹è¿›</p><script type="math/tex; mode=display">L_{\theta}=\operatorname{SmoothL1}\left(\sin \left(\theta_{p}-\theta_{t}\right)\right)</script><p>ä½¿ç”¨æ­£å¼¦ L1 loss å†åŠ ä¸Šæ–¹å‘äºŒå…ƒåˆ†ç±»æŸå¤±ï¼Œä»¥è¾¾åˆ°ç²¾ç¡®çš„æ–¹å‘å®šä½</p></li><li><p>å¯¹äºæ•°æ®å¢å¼ºçš„æ”¹è¿›</p><ol><li>ä»æ ‡ç­¾æ± ä¸­éšæœºé‡‡æ · Sample Ground Truths from the Database</li><li>å¯¹æ¯ä¸ªæ ‡ç­¾éšæœºæ—‹è½¬ Object Noise</li><li>å¯¹æ•´ä¸ªç‚¹äº‘éšæœºæ—‹è½¬å’Œéšæœºç¼©æ”¾  Global Rotation and Scaling</li></ol></li></ol><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><p><img src="/archives/4486189f/image-20211018213219777.png" alt="image-20211018213219777"></p><p>SECOND åœ¨é€Ÿåº¦ä¸Šç›¸æ¯”äº VoxelNet æå‡äº†æ¥è¿‘5å€ï¼Œå·²ç»èƒ½å¤Ÿè¾¾åˆ°å®æ—¶æ£€æµ‹çš„æ ‡å‡†ï¼ˆ20+ fpsï¼‰ï¼Œè¿™åœ¨é€Ÿåº¦ä¸Šæ˜¯å®Œå…¨çš„ç¢¾å‹ï¼Œè€Œä¸”åœ¨å‡†ç¡®ç‡ä¸Šä¹Ÿè¿œè¿œé¢†å…ˆ</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>ä»¥ä¸Šåˆ™æ˜¯å¯¹ VoxelNet å’Œ SECOND çš„æ€»ç»“ï¼Œè¿™ä¸¤ç¯‡å·²ç»æ˜¯å¥½å‡ å¹´å‰çš„æ–‡ç« äº†ï¼Œä¹Ÿæ˜¯ä¸‰ç»´ç‚¹äº‘ä½“ç´ åŒ–æ–¹å‘çš„å¥ åŸºä¹‹ä½œã€‚åœ¨å¾ˆå¤šè®ºæ–‡ä¸­éƒ½å°†åˆ°äº†è¿™ä¸¤ç¯‡çš„èº«å½±ï¼Œæ‰€ä»¥äº†è§£ä¸€ä¸‹å…¶ä¸­çš„å®ç°ç»†èŠ‚ï¼Œèƒ½å¤Ÿå¸®åŠ©æ›´å¥½åœ°ç†è§£å…¶ä»–è®ºæ–‡çš„ç»“æ„</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VoxelNet </tag>
            
            <tag> SECOND </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SE-SSD</title>
      <link href="/archives/774e60d7.html"/>
      <url>/archives/774e60d7.html</url>
      
        <content type="html"><![CDATA[<h1 id="SE-SSD"><a href="#SE-SSD" class="headerlink" title="SE-SSD"></a>SE-SSD</h1><hr><p>Zheng, Wu, Weiliang Tang, Li Jiang, and Chi-Wing Fu. â€œSE-SSD: Self-Ensembling Single-Stage Object Detector From Point Cloud.â€ <em>ArXiv:2104.09804 [Cs]</em>, April 20, 2021. <a href="http://arxiv.org/abs/2104.09804">http://arxiv.org/abs/2104.09804</a>.</p><hr><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>æœ¬è®ºæ–‡çš„æ ¸å¿ƒä¸ºä½¿ç”¨çŸ¥è¯†è’¸é¦ <strong>Knowledge Distill</strong> + <strong>Mean Teacher</strong>çš„æ€æƒ³ï¼ŒåŠ å…¥è½¯ç›®æ ‡ soft target å¯¹ç½‘ç»œçš„é¢„æµ‹ç»“æœè¿›è¡Œç›‘ç£å­¦ä¹ ã€‚ç”Ÿæˆè¯¥ soft target ä¸æ˜¯ä½¿ç”¨åŸå§‹æ–¹æ³•ï¼Œå°†ä¸åŒæ¨¡å‹çš„ prediction è¿›è¡Œé›†æˆï¼Œè€Œæ˜¯å…ˆå°†æ¨¡å‹è¿›è¡Œé›†æˆï¼Œå†ä½¿ç”¨é›†æˆæ¨¡å‹è¿›è¡Œé¢„æµ‹ predictionã€‚é›†æˆæ¨¡å‹ç»“æ„ ensemble model ä¸åŸå§‹ç½‘ç»œç›¸åŒï¼Œç§°ä¸º Teacher-SSDï¼Œè€ŒåŸå§‹ç½‘ç»œç§°ä¸º Student-SSDï¼Œå…¶ä¸­ Teacher-SSD çš„å‚æ•°ä¸º Student-SSD å‚æ•°çš„é›†æˆï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ¨¡å‹åå«è‡ªåµŒå…¥ SSD (self-embedding)</p><h3 id="Why-soft-target"><a href="#Why-soft-target" class="headerlink" title="Why soft target"></a>Why soft target</h3><p>æ‰‹åŠ¨æ³¨é‡Šçš„ç¡¬ç›®æ ‡ï¼ˆå³æ ‡ç­¾ hard target/labelï¼‰ç›¸æ¯”ï¼Œè½¯ç›®æ ‡é€šå¸¸å…·æœ‰æ›´é«˜çš„ç†µï¼Œä»è€Œä¸ºå­¦ç”Ÿæä¾›æ›´å¤šä¿¡æ¯ä»¥ä¾›å­¦ä¹ ï¼Œå¼¥è¡¥äº†ç›‘ç£ä¿¡å·çš„ä¸è¶³ã€‚å¹¶ä¸”è®ºæ–‡çš„è½¯ç›®æ ‡æ¥è‡ªäºè‡ªèº«æ¨¡å‹çš„é›†æˆï¼Œæ‰€ä»¥ä¸è‡ªèº«çš„é¢„æµ‹ç»“æœæ¯”è¾ƒç›¸ä¼¼ï¼Œé¿å…äº†æ¢¯åº¦çš„å‰§çƒˆå˜åŒ–ã€‚è€Œæ‰€è°“æ›´é«˜çš„ç†µè¯¥å¦‚ä½•å»ç†è§£ï¼Ÿå‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/390167950">çŸ¥ä¹</a></p><p>å±•å¼€åˆ†æä¸€ä¸‹è½¯ç›®æ ‡çš„ä½œç”¨ï¼Œä»¥åˆ†ç±»ä»»åŠ¡ä¸ºä¾‹ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li>åˆ†ç±»æ ‡ç­¾ä¸º one hot å‘é‡ï¼Œä»…ä¸ºä¸€ä¸ªç‚¹ï¼Œä¹Ÿå³è¯¥ç›®æ ‡æ‰€å±ç±»åˆ«ã€‚è€Œä½¿ç”¨ teacher model å¯¹äºæ¯ä¸ªæ ·æœ¬è¾“å‡ºä¸€ä¸ªè¿ç»­çš„ label åˆ†å¸ƒï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨çš„ç›‘ç£ä¿¡æ¯å°±è¿œæ¯” one hot çš„å¤šäº†</li><li>è½¯ç›®æ ‡è¿˜æä¾›äº†å…¶ä»–åˆ†ç±»çš„å¾—åˆ†/å¯èƒ½æ€§ï¼Œå«æœ‰äº†ç±»åˆ«ä¸ç±»åˆ«ä¹‹é—´çš„ä¿¡æ¯</li><li>ï¼ˆåœ¨æœ¬è®ºæ–‡ä¸­ï¼‰å°†å­¦ä¹ æ›²çº¿å˜å¾—æ›´åŠ å¹³æ»‘ï¼Œå‡å°‘äº†æ¢¯åº¦æ–¹å·®ï¼Œå¸®åŠ©æ›´å¥½çš„å¾®è°ƒ</li></ol><p>é™¤äº†è¯¥æ ¸å¿ƒæ€æƒ³å¤–ï¼Œè®ºæ–‡è¿˜æå‡ºäº†æ–°çš„æ•°æ®å¢å¼ºçš„æ–¹å¼å’Œæ–°çš„æŸå¤±å‡½æ•°ä»¥æå‡ç½‘ç»œè¡¨ç°ï¼š</p><ol><li>Shape-aware data augmentation</li><li>Consistency loss for soft target</li><li>Orientation-aware distance-IoU loss for hard target </li></ol><h2 id="SE-SSD-Architecture"><a href="#SE-SSD-Architecture" class="headerlink" title="SE-SSD Architecture"></a>SE-SSD Architecture</h2><p><img src="/archives/774e60d7/image-20211014170119221.png"></p><p>SE-SSD çš„æ•´ä½“ç»“æ„éå¸¸çš„ç®€æ´ã€‚ç½‘ç»œçš„è®¡ç®—æœ‰ä¸¤æ¡è·¯çº¿ï¼Œteacher è·¯çº¿ &amp; student è·¯çº¿</p><ol><li><p>Teacher è·¯çº¿ï¼ˆå›¾ä¸­æ ‡ä»¥è“è‰²ç®­å¤´ï¼‰ï¼šå°†åŸå§‹ç‚¹äº‘è¾“å…¥åˆ° Teacher SSD ä¸­äº§ç”Ÿé¢„æµ‹ç»“æœ predictionsï¼Œå¯¹é¢„æµ‹é€‰æ¡†è¿›è¡Œå…¨å±€å˜æ¢ global transformation (including a random translation, flipping, and scaling) ç”Ÿæˆè½¯ç›®æ ‡ soft target</p></li><li><p>Student è·¯çº¿ï¼ˆé€”ä¸­æ ‡ä»¥ç»¿è‰²ç®­å¤´ï¼‰ï¼šå°†åŸå§‹ç‚¹äº‘è¿›è¡Œå…¨å±€å˜æ¢ global transformationï¼Œç„¶åè¿›è¡Œæ•°æ®å¢å¼º shape aware data augmentationï¼Œç”Ÿæˆå¢å¼ºè¿‡åçš„è¾“å…¥å’Œç¡¬ç›®æ ‡ã€‚å°†å¢å¼ºåçš„æ•°æ®è¾“å…¥ Student SSD åšå¤šä»»åŠ¡ï¼šå›å½’ä»»åŠ¡å’Œåˆ†ç±»ä»»åŠ¡ï¼Œæœ€ç»ˆå¾—åˆ°é¢„æµ‹ç»“æœ student predictionsã€‚è¯¥é¢„æµ‹ç»“æœå°†ä¸ç¡¬ç›®æ ‡å’Œè½¯ç›®æ ‡åŒæ—¶è¾“å…¥æŸå¤±å‡½æ•°ï¼Œè¿›è¡Œè®¡ç®—å¹¶ä¼˜åŒ–ç½‘ç»œå‚æ•°</p></li></ol><p>ä»¥ä¸Šå°±æ˜¯æ•´ä½“çš„æµç¨‹ï¼Œä¸‹é¢éœ€è¦å¯¹ Student SSDï¼Œæ•°æ®å¢å¼ºæ–¹æ³•ä»¥åŠæŸå¤±å‡½æ•°è¿›è¡Œè¯¦ç»†çš„äº†è§£</p><h3 id="Architecture-of-Student-SSD"><a href="#Architecture-of-Student-SSD" class="headerlink" title="Architecture of Student SSD"></a>Architecture of Student SSD</h3><p>SSD çš„ç»“æ„ä¸ä½œè€…çš„å‰ä½œæ–‡ç«  CIA-SSD æ˜¯ä¸€è‡´çš„ã€‚è¯¥ç½‘ç»œä¸ºä¸€ä¸ªè½»é‡å‹ç»“æ„ï¼Œä½†æ˜¯æ¨ç†æ•ˆæœä¾ç„¶å¾ˆå¥½ã€‚æŒ‰ç†æ¥è®² SA-SSD å·²ç»å¾ˆå¿«äº†ï¼Œä½†æ˜¯è¯¥æ¨¡å‹æ¯”å…¶æ›´å¿«æ›´å¥½ã€‚è®ºæ–‡ä¸­è§£é‡Šäº†é€Ÿåº¦çš„åŸå› ï¼šCIA-SSD ä½¿ç”¨çš„ channel æ•°å¤§éƒ¨åˆ†éƒ½æ˜¯ SA-SSD çš„ä¸€åŠï¼Œä½†æ˜¯å°†è¯­ä¹‰å’Œç©ºé—´ä¿¡æ¯çš„å­¦ä¹ ç§»åˆ°äº†ä¸»å¹²ç½‘ç»œä¸­ï¼Œç»¼åˆä¹‹ä¸‹èƒœå‡ºã€‚è¿˜æœ‰ä¸€ç¯‡è®ºæ–‡ Voxel R-CNN çš„è¡¨ç°ä¹Ÿéå¸¸ä¼˜ç§€ï¼Œéƒ½åœ¨é€Ÿåº¦å’Œå‡†ç¡®ç‡ä¸Šè¶…è¶Šäº† SA-SSDã€‚è¿™äº›ç»“æœæ˜¯å¦æ„å‘³ç€è¾…åŠ©ç½‘ç»œçš„å½»åº•å¤±è´¥å‘¢ï¼Ÿ</p><p>æˆ‘è®¤ä¸ºè¾…åŠ©ç½‘ç»œæä¾›äº†ä¸€ç§å¯èƒ½æ€§ï¼šå³ä½¿æ˜¯å°æ¨¡å‹ä¹Ÿèƒ½å¤Ÿä½¿ç”¨æ›´å¥½çš„å‚æ•°è¾¾åˆ°ä¸€æµçš„æ•ˆæœã€‚å¹¶ä¸”è¾…åŠ©ç½‘ç»œçš„æ€æƒ³å¾ˆç®€å•ï¼Œèƒ½å¤Ÿè½»æ¾åœ°åŠ å…¥åˆ°å¤§éƒ¨åˆ†çš„ç»“æ„å½“ä¸­ï¼Œè€Œä¸éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´è¿›è¡Œç»“æ„è®¾è®¡</p><p>ä¸‹é¢å¯¹ CIA-SSD çš„é‡è¦ç»“æ„è¿›è¡Œç®€è¦çš„ä»‹ç»</p><p><img src="/archives/774e60d7/image-20211016161605882.png" style="zoom: 80%;"></p><ol><li>ä½¿ç”¨ç¨€ç–å·ç§¯å°†ä½“ç´ åŒ–ç‚¹äº‘è¿›è¡Œç¼–ç ï¼Œå¹¶è½¬åŒ–ä¸º BEV ç‰¹å¾å›¾è°±</li><li>ä½¿ç”¨ SSFA æ¨¡å—å¯¹ BEV ç‰¹å¾å›¾è°±è¿›è¡Œè¿›ä¸€æ­¥ç‰¹å¾æå–ï¼š<ol><li>ä¿æŒåŸ BEV ç‰¹å¾å›¾è°±çš„å½¢çŠ¶ï¼Œè¿›è¡Œå¤šæ¬¡å·ç§¯ç»§ç»­æå–å°å°ºåº¦çš„ç©ºé—´ç‰¹å¾ spatial groupï¼Œå‡è®¾æœ€ç»ˆå¾—åˆ°ç©ºé—´ç‰¹å¾å›¾è°± $F_{spatial}$</li><li>å°† $F_{spatial}$ ä½œä¸ºè¾“å…¥ï¼Œè¿›ä¸€æ­¥æå–é«˜çº§/æ„Ÿå—é‡æ›´å¤§çš„è¯­ä¹‰ç‰¹å¾ semantic groupï¼Œå‡è®¾æœ€ç»ˆå¾—åˆ°è¯­ä¹‰ç‰¹å¾å›¾è°± $F_{semantic}$</li><li>å°†è¯­ä¹‰ç‰¹å¾è¿›è¡Œä¸Šé‡‡æ ·/åå·ç§¯ upsampling/deconvolution è¾¾åˆ°å’Œç©ºé—´ç‰¹å¾ä¸€æ ·çš„å½¢çŠ¶ï¼Œä»¥å‡†å¤‡èåˆ</li><li>èåˆé˜¶æ®µï¼Œå°†ä¸¤ä¸ªç‰¹å¾å›¾è°±çš„é€šé“æ•°å‹ç¼©ä¸º1ï¼Œå¹¶ä½¿ç”¨ sigmoid å‡½æ•°æ˜ å°„è‡³ 0-1 åŒºé—´ï¼Œå¾—åˆ°ä¸¤ä¸ªæ–°çš„æƒé‡ç‰¹å¾å›¾è°±ã€‚ç„¶åå°†æƒé‡ç‰¹å¾å›¾è°±ä¸åŸæ¥çš„ç‰¹å¾å›¾è°±é€å…ƒç´ ç›¸ä¹˜ï¼Œå¾—åˆ°æœ€ç»ˆç”¨äºå¤šä»»åŠ¡çš„ç‰¹å¾å›¾è°± $F$</li></ol></li><li>è¿›è¡Œå¤šä»»åŠ¡é¢„æµ‹ï¼šåˆ†ç±»ä»»åŠ¡ã€IoU é¢„æµ‹ä»»åŠ¡ã€box å›å½’é¢„æµ‹ä»»åŠ¡ã€æ–¹å‘åˆ†ç±»ä»»åŠ¡</li></ol><p>CIA-SSD ä¸­æåˆ°äº†ä¸€äº› trick åœ¨æœ¬è®ºæ–‡ä¹‹ä¸­å‡æ²¡æœ‰ä½¿ç”¨ï¼Œä¸ªäººè§‰å¾—æ¯”è¾ƒå¤æ‚ï¼Œä¸å¤ªå¥½ç†è§£ï¼Œå°±ä¸ç»§ç»­æ·±å…¥ç ”ç©¶äº†ï¼Œè€Œä¸”å¦‚æ˜¯å¥½ trick çš„è¯æœ¬è®ºæ–‡åº”è¯¥ä¼šæ²¿ç”¨ã€‚æ€»ä½“æ¥çœ‹ CIA-SSD çš„ç»“æ„ä¾ç„¶æ˜¯åŠ å¼ºå¯¹å¤šå°ºåº¦ä¿¡æ¯çš„æå–å¹¶è¿›è¡Œèåˆ</p><h3 id="Shape-aware-data-augmentation"><a href="#Shape-aware-data-augmentation" class="headerlink" title="Shape-aware data augmentation"></a>Shape-aware data augmentation</h3><p>ç”±äºç‚¹äº‘æ•°æ®çš„ä¸è§„åˆ™æ€§ï¼Œå¾ˆå¤šç‰©ä½“è¡¨é¢ä¸Šçš„ç‚¹éƒ½æ²¡æœ‰è¢«é‡‡é›†åˆ°ï¼Œè¿™æ˜¯ç‰©ç†å±‚é¢çš„åŸå› ã€‚ä¸ºäº†æ¨¡æ‹Ÿè¿™ç§æ•°æ®ç¼ºå¤±å¹¶å¢åŠ æ ·æœ¬å¤šæ ·æ€§ï¼Œè®ºæ–‡é‡‡å–äº†ä¸‹å›¾æ‰€ç¤ºçš„åšæ³•</p><p><img src="/archives/774e60d7/image-20211016165328812.png" style="zoom: 80%;"></p><p>ç”¨è¯­è¨€ç®€è¦å™è¿°ï¼š</p><ol><li>åœ¨è¿›è¡Œæ“ä½œå‰å…ˆå¯¹æ•°æ®é›†è¿›è¡ŒåŸºæœ¬çš„æ•°æ®å¢å¼º global transformation (including a random translation, flipping, and scaling)</li><li>å°†æ¯ä¸ª3Dé€‰æ¡†åˆ†ä¸º6ä¸ªå­åŒºåŸŸï¼Œæ–¹æ³•ä¸ºå°†é€‰æ¡†é¡¶ç‚¹ä¸é€‰æ¡†ä¸­å¿ƒç›¸è¿æ¥ï¼Œå½¢æˆå…­ä¸ªå››æ£±é”¥</li><li>å¯¹æ¯ä¸ª3Dé€‰æ¡†ï¼Œåœ¨6ä¸ªå­åŒºåŸŸä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå‰”é™¤ï¼Œä»¥æ¨¡æ‹Ÿé‡‡é›†æ—¶ç‚¹äº‘ä¸¢å¤±çš„æƒ…å†µ</li><li>å°†ä¸åŒ3Dé€‰æ¡†ä¹‹é—´çš„å­åŒºåŸŸè¿›è¡Œäº¤æ¢ï¼Œå­åŒºåŸŸçš„ç›¸å¯¹ä½ç½®æ˜¯ä¸€æ ·çš„ï¼Œä¾‹å¦‚å°†ä¸¤ä¸ªé€‰æ¡†çš„å³ä¾§çš„å››æ£±é”¥è¿›è¡Œäº¤æ¢ã€‚è¯¥æ“ä½œå¢åŠ æ ·æœ¬çš„å¤šæ ·æ€§</li><li>å¯¹æ¯ä¸ª3Dé€‰æ¡†ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªå­åŒºåŸŸè¿›è¡Œä¸‹é‡‡æ ·ï¼Œä½¿å…¶æ›´åŠ ç¨€ç–ã€‚é‡‡æ ·æ–¹æ³•ä¸º farthest point sampling (FPS)</li></ol><h3 id="Consistency-loss"><a href="#Consistency-loss" class="headerlink" title="Consistency loss"></a>Consistency loss</h3><p>ä¸ºäº†è®©è½¯ç›®æ ‡ä¸ä¼šå¯¹é¢„æµ‹é€‰æ¡†è¿›è¡Œé”™è¯¯å¼•å¯¼ï¼Œéœ€è¦å…ˆå¯¹è½¯ç›®æ ‡å’Œé¢„æµ‹é€‰æ¡†åŒæ—¶è¿›è¡Œç­›é€‰ï¼š</p><ol><li>å»æ‰ç½®ä¿¡åº¦ä½äºé˜ˆå€¼ $\tau_c$ çš„è½¯ç›®æ ‡å’Œé¢„æµ‹é€‰æ¡†</li><li>ä»…åŒ¹é… IoU é«˜çš„è½¯ç›®æ ‡å’Œé¢„æµ‹é€‰æ¡†ï¼ŒäºŒè€… IoU ä½äºé˜ˆå€¼ $\tau_I$ çš„ä¸è¿›è¡ŒæŸå¤±å‡½æ•° consistency loss è®¡ç®—</li></ol><p>æ•°å­¦è¡¨ç°å½¢å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">\begin{array}{c}\mathcal{L}_{b o x}^{c}=\frac{1}{N^{\prime}} \sum_{i=1}^{N} \mathbb{1}\left(I o U_{i}>\tau_{I}\right) \sum_{e} \frac{1}{7} \mathcal{L}_{\delta_{e}}^{c} \\\\\delta_{e}=\left\{\begin{array}{ll}\left|e_{s}-e_{t}\right| & \text { if } e \in\{x, y, z, w, l, h\} \\\left|\sin \left(e_{s}-e_{t}\right)\right| & \text { if } e \in\{r\}\end{array}\right.\end{array}</script><p>$\mathcal{L}_{\delta_e}^c$ ä¸º smooth L1 lossï¼Œ$N$ å’Œ $Nâ€™$ ä¸ºèµ·å§‹é¢„æµ‹é€‰æ¡†æ•°å’Œç­›é€‰åçš„é€‰æ¡†æ•°ã€‚å¯¹äºåˆ†ç±»ä¹Ÿä½¿ç”¨ç±»ä¼¼çš„æŸå¤±å‡½æ•°</p><script type="math/tex; mode=display">\mathcal{L}_{c l s}^{c}=\frac{1}{N^{\prime}} \sum_{i=1}^{N} \mathbb{1}\left(I o U_{i}>\tau_{I}\right) \mathcal{L}_{\delta_{c}}^{c}\\\delta_{c}=\left|\sigma\left(c_{s}\right)-\sigma\left(c_{t}\right)\right|</script><h3 id="Orientation-aware-distance-IoU-loss"><a href="#Orientation-aware-distance-IoU-loss" class="headerlink" title="Orientation-aware distance-IoU loss"></a>Orientation-aware distance-IoU loss</h3><p>ä¸ºäº†è®©é¢„æµ‹é€‰æ¡†çš„å‡ ä½•å‚æ•°æ›´å…³æ³¨ç›®æ ‡ä¸­å¿ƒå’Œæ—‹è½¬æ–¹å‘ï¼Œè®ºæ–‡è®¾è®¡äº†ç›¸å…³çš„æŸå¤±å‡½æ•°ï¼Œå¼•å¯¼é€‰æ¡†ä¸ç¡¬ç›®æ ‡å¯¹é½</p><script type="math/tex; mode=display">\mathcal{L}_{b o x}^{s}=1-\operatorname{IoU}\left(B_{p}, B_{g}\right)+\frac{c^{2}}{d^{2}}+\gamma(1-|\cos (\Delta r)|)</script><p>$B_p$ å’Œ $B_g$ ä»£è¡¨é¢„æµ‹é€‰æ¡†å’Œç¡¬ç›®æ ‡/æ ‡ç­¾ï¼Œ$c$ ä»£è¡¨ä¸­å¿ƒè·ç¦»ï¼Œ$d$ ä»£è¡¨åŒ…å›´ä¸¤ä¸ªé€‰æ¡†çš„æœ€å°é•¿æ–¹ä½“çš„å¯¹è§’çº¿ï¼Œ$\Delta r$ ä»£è¡¨ä¸¤ä¸ªé€‰æ¡† BEV ç›¸å·®çš„è§’åº¦ï¼Œ$\gamma$ ä¸ºè¶…å‚æ•°ï¼Œå›¾ç¤ºå¦‚ä¸‹</p><p><img src="/archives/774e60d7/image-20211016191827057.png"></p><p>è®ºæ–‡ç”»å‡ºäº† $(1-|cos(\Delta r)|)$ çš„å›¾åƒï¼Œæ–¹å‘å·®åˆ«è¶Šå¤§æŸå¤±å‡½æ•°è¶Šå¤§</p><p><img src="/archives/774e60d7/image-20211016193642630.png" style="zoom: 80%;"></p><p>é™¤äº†å›å½’ä»»åŠ¡ï¼Œè¿˜æœ‰é€‰æ¡†çš„åˆ†ç±»ä»»åŠ¡ï¼Œä»¥åŠé€‰æ¡†æœå‘çš„åˆ†ç±»ä»»åŠ¡ï¼Œä¸¤ä¸ªä»»åŠ¡çš„æŸå¤±å‡½æ•°åˆ†åˆ«ä¸º focal loss å’Œ binary cross entropy lossã€‚æ•…æ•´ä¸ªç½‘ç»œçš„å…¨éƒ¨æŸå¤±å‡½æ•°å†™ä¸º</p><script type="math/tex; mode=display">\mathcal{L}_{\text {student }}=\mathcal{L}_{\text {cls }}^{s}+\omega_{1} \mathcal{L}_{\text {box }}^{s}+\omega_{2} \mathcal{L}_{\text {dir }}^{s}+\mu_{t}\left(\mathcal{L}_{\text {cls }}^{c}+\mathcal{L}_{\text {box }}^{c}\right)</script><p>å‰ä¸‰é¡¹ä¸ºé¢„æµ‹é€‰æ¡†ä¸ç¡¬ç›®æ ‡çš„æŸå¤±å‡½æ•°ï¼Œåˆ†åˆ«å¯¹åº”ï¼šé€‰æ¡†åˆ†ç±»ä»»åŠ¡ï¼Œé€‰æ¡† $(x, y ,z ,w, l, h, \theta)$ å›å½’ä»»åŠ¡ï¼Œé€‰æ¡†æœå‘åˆ†ç±»ä»»åŠ¡</p><p>åä¸¤é¡¹ä¸ºé¢„æµ‹é€‰æ¡†ä¸è½¯ç›®æ ‡çš„æŸå¤±å‡½æ•° consistency lossï¼Œåˆ†åˆ«å¯¹åº”ï¼šåˆ†ç±»ä¸€è‡´æŸå¤±ï¼Œé€‰æ¡†ä¸€è‡´æŸå¤±ã€‚å…¶ä½™å‚æ•°ä¸ºæƒé‡è¶…å‚æ•°ï¼Œå…¶ä¸­ $\mu_t$ éšæ—¶é—´ä»0å¢é•¿è‡³1</p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="KITTI"><a href="#KITTI" class="headerlink" title="KITTI"></a>KITTI</h3><p><img src="/archives/774e60d7/image-20211016200424581.png" style="zoom: 80%;"></p><p>ç›®å‰ï¼ˆ2021/10/16ï¼‰ SE-SSD ä¾æ—§åœ¨ KITTI æ¦œå•ä¸Šæ’åé¡¶å°– $9^{th}$</p><h3 id="Ablation-study"><a href="#Ablation-study" class="headerlink" title="Ablation study"></a>Ablation study</h3><p><img src="/archives/774e60d7/image-20211016202758864.png"></p><p>è®ºæ–‡ä¸­çš„ä¸‰ä¸ªé‡è¦ç»“æ„ï¼Œåœ¨éªŒè¯é›†ä¸Š Easy éš¾åº¦æå‡æ˜¯æœ€å°çš„ï¼Œå› ä¸ºå·²ç»æ¯”è¾ƒå‡†äº†ï¼Œè€Œåœ¨ Moderate å’Œ Hard éš¾åº¦ä¸­éƒ½æå‡äº† 3% å·¦å³ã€‚å…¶ä¸­å¯ä»¥çœ‹åˆ°å•ç‹¬ä½œç”¨æœ€å¤§çš„ç»“æ„ä¸º consistency lossï¼Œè€Œä¸”åœ¨è¯¥ç»“æ„çš„åŠ æŒä¸‹ï¼Œ ODIoU loss çš„æ•ˆæœä¼¼ä¹ä¹Ÿå˜å¾—æ›´å¥½</p><p>å¯¹äº ODIoU ä¸èƒ½ç›´æ¥å»æ‰ï¼Œè®ºæ–‡ä½¿ç”¨çš„æ˜¯ smooth L1 loss ä»£æ›¿</p><h3 id="Consistency-loss-1"><a href="#Consistency-loss-1" class="headerlink" title="Consistency loss"></a>Consistency loss</h3><p><img src="/archives/774e60d7/image-20211016203125284.png" style="zoom:80%;"></p><p>ä¸¤ä¸ªè¡¨åˆ†åˆ«è¯´æ˜äº†ï¼š</p><ol><li><p>åˆ†ç±»å’Œå›å½’ï¼Œä¸¤ä¸ªä»»åŠ¡çš„é¢„æµ‹ç»“æœåŒæ—¶å¯¹é½è½¯ç›®æ ‡æ—¶æ•ˆæœæœ€å¥½</p></li><li><p>å¹¶ä¸”å¯¹è½¯ç›®æ ‡è¿›è¡Œç­›é€‰æ—¶ï¼ŒåŸºäº IoU ç­–ç•¥çš„ç­›é€‰èƒ½å¤Ÿä¿ç•™æ›´å¤šçš„ä¿¡æ¯ã€‚å…¶ä¸­ nms filter ä»£è¡¨çš„æ˜¯ä½¿ç”¨ NMS ç­–ç•¥å¯¹è½¯ç›®æ ‡è¿›è¡Œç­›é€‰ï¼Œ gt filter ä»£è¡¨çš„æ˜¯å‰”é™¤ä¸ ground truth æ ‡ç­¾é‡å çš„è½¯ç›®æ ‡</p></li></ol><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>SE-SSD çš„è¡¨ç°å¯ä»¥è¯´æ˜¯éå¸¸çš„æƒŠè‰³ï¼Œæ‰€ä½¿ç”¨çš„ Teacher-SSD &amp; Student-SSD &amp; soft target æ€æƒ³ç®€å•ä¸”æœ‰æ•ˆï¼Œæˆ–è®¸åœ¨ä¹‹åèƒ½å¤Ÿæˆä¸ºä¸€ç§å¸¸ç”¨çš„æå‡ç½‘ç»œæ•ˆæœçš„æ‰‹æ®µã€‚è®ºæ–‡è®¾è®¡çš„æ•°æ®å¢å¼ºå’ŒæŸå¤±å‡½æ•°ä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç½‘ç»œå‡†ç¡®ç‡ï¼Œè¿™ä¹Ÿè¯´æ˜äº†é™¤äº†ç½‘ç»œç»“æ„æœ¬èº«ï¼Œ<strong>å…¶ä»–çš„ä¿¡æ¯ï¼ˆæ ‡ç­¾ã€æ ·æœ¬ï¼‰ä»¥åŠè¯„ä¼°æ¨¡å‹çš„æ–¹å¼</strong>ä¹Ÿæ˜¯ç›¸å½“é‡è¦çš„ã€‚åœ¨é˜…è¯»æœŸé—´ä¹Ÿæœ‰ä¸€äº›ç–‘é—®å’Œæƒ³æ³•äº§ç”Ÿ</p><p><strong>Q:</strong> åŒæ—¶è½¯ç›®æ ‡ç›¸å¯¹äºé¢„å…ˆè®¾å®šçš„ anchorï¼Œå…·æœ‰æ›´ç²¾ç¡®çš„è¾¹ç•Œæ¡†å’Œç½®ä¿¡åº¦ï¼Œè¿™é‡Œæ˜¯å¦å¯ä»¥å€Ÿé‰´ 2-Stage ä¸­çš„æ€æƒ³ï¼Œå¯¹äºè½¯ç›®æ ‡è¿›ä¸€æ­¥çš„åˆ©ç”¨ï¼Œå°†å…¶ä½œä¸ºæ›´é«˜çº§çš„æ³¨æ„åŠ›æœºåˆ¶</p><p><strong>Q:</strong> å¯¹äºè½¯ç›®æ ‡æ˜¯å¦ä¸€å®šè¦æ¥è‡ªäºè‡ªèº«çš„é›†æˆï¼Œä½¿ç”¨å…¶ä»–æ¨¡å‹çš„æ•ˆæœä¼šå¦‚ä½•ã€‚å¯¹äºé›†æˆæ¨¡å‹çš„å‚æ•°æ›´æ–°æ–¹å¼ä¸ä¸€å®šä½¿ç”¨ EWAï¼Œå¯å¦å€Ÿé‰´å¼ºåŒ–å­¦ä¹ ä¸­çš„æ–¹æ³•ã€‚å¯¹äº consistency loss èƒ½å¦è¿›ä¸€æ­¥æ”¹è¿›ï¼Œæ¯”å¦‚å¢åŠ  IoU ç›¸å…³æŸå¤±</p><p><strong>Q:</strong> ï¼ˆä¸ SA-SSD è”åŠ¨ï¼‰è¾…åŠ©ä»»åŠ¡ä¸è½¯ç›®æ ‡çš„å¼‚æ­¥è¿›è¡Œï¼Œå…ˆä½¿ç”¨è¾…åŠ©å‡½æ•°è¿›è¡ŒåŸºç¡€å­¦ä¹ ï¼Œå†ä½¿ç”¨è½¯ç›®æ ‡è¿›è¡ŒçŸ¥è¯†è’¸é¦</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SE-SSD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SA-SSD</title>
      <link href="/archives/82cec617.html"/>
      <url>/archives/82cec617.html</url>
      
        <content type="html"><![CDATA[<h1 id="SA-SSD"><a href="#SA-SSD" class="headerlink" title="SA-SSD"></a>SA-SSD</h1><hr><p>He, Chenhang, Hui Zeng, Jianqiang Huang, Xian-Sheng Hua, and Lei Zhang. â€œStructure Aware Single-Stage 3D Object Detection From Point Cloud.â€ In <em>2020 IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR)</em>, 11870â€“79. Seattle, WA, USA: IEEE, 2020. <a href="https://doi.org/10.1109/CVPR42600.2020.01189">https://doi.org/10.1109/CVPR42600.2020.01189</a>.</p><hr><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>ç°é˜¶æ®µç‚¹äº‘ç›®æ ‡æ£€æµ‹å¸¸ç”¨ SSD æ–¹æ³•ä¸ºï¼Œä½¿ç”¨å·ç§¯ç½‘ç»œé€æ­¥ç¼©å° feature map å½¢çŠ¶ï¼ŒåŒæ—¶æ„Ÿå—é‡ä¹Ÿåœ¨é€æ¸æé«˜ï¼Œæœ€ç»ˆä½¿ç”¨ downscale çš„ç‰¹å¾å›¾è°±å»åšé€‰æ¡†çš„é¢„æµ‹ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸å¯é¿å…åœ°ä¼šä¸¢å¤±ç©ºé—´ä¿¡æ¯ï¼š</p><ol><li>åœ¨å°†ç‚¹äº‘è¿›è¡Œä½“ç´ åŒ–æ—¶ä¼šä¸¢å¤±åŸå§‹ç‚¹äº‘çš„ç©ºé—´ä¿¡æ¯</li><li>åœ¨è¿›è¡Œå·ç§¯æ“ä½œæ—¶ï¼Œè™½ç„¶è¿›ä¸€æ­¥æå–äº†å±€éƒ¨ç‰¹å¾ï¼Œä½†åŒæ—¶ä¹Ÿä¼šä¸¢å¤±ç»†èŠ‚ä¿¡æ¯</li></ol><p>ä¸ºäº†è§£å†³ä¿¡æ¯ä¸¢å¤±é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ 2-Stage ç›®æ ‡æ£€æµ‹ç½‘ç»œã€‚åœ¨ç¬¬äºŒé˜¶æ®µå¯ä»¥åˆ©ç”¨æ›´ç²¾ç»†çš„ç©ºé—´ä¿¡æ¯ï¼Œé‡ç‚¹å…³æ³¨ç¬¬ä¸€é˜¶æ®µæå‡ºçš„ RoIï¼Œä»è€Œé¢„æµ‹æ›´åŠ ç²¾å‡†ï¼Œè¿™æ­ç¤ºäº†åˆ©ç”¨ç‚¹äº‘çš„ç»†ç²’åº¦ fine-grained ç©ºé—´ä¿¡æ¯çš„é‡è¦æ€§ã€‚ç„¶è€Œï¼Œå¯¹æ¯ä¸ªç‚¹è¿›è¡Œæ“ä½œå¹¶ä¸ºæ¯ä¸ª RoI é‡æ–°æå–ç‰¹å¾ä¼šå¤§å¤§å¢åŠ è®¡ç®—æˆæœ¬ï¼Œä½¿å¾—ä¸¤é˜¶æ®µæ–¹æ³•éš¾ä»¥è¾¾åˆ°å®æ—¶é€Ÿåº¦</p><p>ä½¿ç”¨è¾…åŠ©ä»»åŠ¡æ¥æå‡ä¸»ä»»åŠ¡çš„è¡¨ç°ï¼Œåœ¨ç›®æ ‡æ£€æµ‹ç½‘ç»œä¸­ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„æ–¹æ³•ã€‚ä¾‹å¦‚åœ¨ PV-RCNN ä¸­åˆ™è¿›è¡Œäº†å‰æ™¯ç‚¹ä»»åŠ¡ï¼Œå¹¶åˆ©ç”¨è¯¥ä»»åŠ¡å¯¹ä¸åŒç‚¹çš„ç‰¹å¾è¿›è¡Œæƒé‡åˆ†é…ï¼Œå‰æ™¯ç‚¹å°†è·å¾—æ›´å¤§çš„æƒé‡ã€‚</p><p>è®ºæ–‡ä½¿ç”¨å¯åˆ†ç¦»è¾…åŠ©ç½‘ç»œæ¥è¡¥å¿æŸå¤±çš„ç©ºé—´ä¿¡æ¯ã€‚è¾…åŠ©ç½‘ç»œçš„è¾“å…¥ä¸º backbone ä¸­ä¸åŒåˆ†è¾¨ç‡çš„ feature mapï¼Œå°†ç‰¹å¾å›¾è°±çš„æ …æ ¼åŒ–ç‰¹å¾è¡¨ç¤ºï¼Œä½¿ç”¨ç‰¹å¾ä¼ æ’­ feature propagation è½¬åŒ–ä¸ºé€ç‚¹çš„ç‰¹å¾è¡¨ç¤ºï¼Œç„¶åä½¿ç”¨é€ç‚¹çš„ç‰¹å¾å»åšä¸¤ä¸ªè¾…åŠ©ä»»åŠ¡ï¼šå‰æ™¯ç‚¹åˆ†ç¦»å’Œä¸­å¿ƒé¢„æµ‹ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¾…åŠ©ç½‘ç»œä¸ä¸»å¹²ç½‘ç»œè¿›è¡Œè”åˆä¼˜åŒ–ï¼Œæ‰€ä»¥ä¸»å¹²ç½‘ç»œçš„ backbone å‚æ•°ä¸­å°†å…·æœ‰åŸå§‹ç‚¹äº‘çš„è¯­ä¹‰ä¿¡æ¯ã€‚è€Œåœ¨è¿›è¡Œæ¨ç†çš„æ—¶å€™ï¼Œè¾…åŠ©ç½‘ç»œå°†ä»ä¸»å¹²ç½‘ç»œä¸­åˆ†ç¦»ï¼Œæ•…ä¸å¢åŠ ä»»ä½•çš„è®¡ç®—</p><p><a href="https://blog.csdn.net/qq_39732684/article/details/105147497">CSDN</a> ä¸Šå¯¹äºè¿™ç¯‡è®ºæ–‡çš„ä»£ç è§£è¯»ï¼Œè¯¥ç½‘ç»œçš„ä»£ç æ„å»ºæ˜¯åŸºäº MMDetection å’Œ SECOND</p><h3 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h3><p>åœ¨ç½‘ç»œä¸­é—´æ’å…¥è¾…åŠ©ä»»åŠ¡çš„åšæ³•ï¼Œæˆ‘åœ¨äºŒç»´ç›®æ ‡æ£€æµ‹ä¸­çš„ä¸€ç¯‡æ–‡ç« ï¼ˆHourglass Networksï¼‰ä¸­ä¹Ÿçœ‹åˆ°è¿‡ç±»ä¼¼çš„ç»“æ„ã€‚ä½†åœ¨ Hourglass ä¸­è¿™ç§åšæ³•å«åšä¸­é—´ç›‘ç£ intermediate supervisionï¼Œä½†è¯¥ç»“æ„åœ¨æ¨ç†ä¸­å¹¶æ²¡æœ‰è¢«åˆ†ç¦»ï¼Œå…¶ä¸­çš„ç‰¹å¾å›¾è°±ç»è¿‡è½¬åŒ–è¿‡åå†ä¸€æ¬¡åŠ å…¥åˆ°äº†ä¸»å¹²ç½‘ç»œä¸­</p><p>å¦‚æœå°† SA-SSD è¾…åŠ©ç½‘ç»œä¸­å­¦ä¹ çš„ç‰¹å¾å†æ¬¡é€å…¥ä¸»å¹²ç½‘ç»œä¹‹ä¸­æ•ˆæœä¼šæ›´å¥½å—ï¼Ÿäº‹å®ä¸Šï¼Œè¿™æ ·å°±å›åˆ°äº† 2-Stage ç›®æ ‡æ£€æµ‹ç½‘ç»œç»“æ„ã€‚ä¾‹å¦‚ PV-RCNN ä¹Ÿæ˜¯å°† voxel-wise ç‰¹å¾è½¬åŒ–ä¸º point-wise ç‰¹å¾ï¼Œå†ä½¿ç”¨ point-wise ç‰¹å¾æ ¹æ® RoI åšé€‰æ¡†ç»†åŒ–ã€‚æ‰€ä»¥éœ€è¦æå‡ºçš„é—®é¢˜ä¸ºï¼šä»€ä¹ˆæ ·çš„è¾…åŠ©ç½‘ç»œç»“æ„ï¼Œèƒ½å¤Ÿè®©ä¸»å¹²ç½‘ç»œæœ‰æ•ˆæå–ç²¾ç»†çš„ç©ºé—´ä¿¡æ¯ã€‚<strong>è¿™ä¸ªé—®é¢˜å°†åˆå¼•ç”³å‡ºä¸¤ä¸ªç–‘é—®ï¼šå¦‚æœè¾…åŠ©ç½‘ç»œçš„å¯¹ç‰¹å¾çš„è½¬æ¢è¿‡äºå¤æ‚ï¼Œé‚£ä¹ˆæ›´æ–°åˆ°ä¸»å¹²ç½‘ç»œä¸­çš„å‚æ•°æ˜¯å¦è¿˜æœ‰æ„ä¹‰ï¼Ÿå¦‚æœé‡‡ç”¨ä¸ä¸»å¹²ç½‘ç»œç›¸ä¼¼çš„ç»“æ„ä½œä¸ºè¾…åŠ©ç½‘ç»œçš„ç»“æ„ï¼Œè¿™ç§ç›¸ä¼¼ç»“æ„æ˜¯å¦ä¼šå¸®åŠ©ç‰¹å¾å­¦ä¹ ï¼Ÿ</strong></p><h2 id="SA-SSD-Architecture"><a href="#SA-SSD-Architecture" class="headerlink" title="SA-SSD Architecture"></a>SA-SSD Architecture</h2><p><img src="/archives/82cec617/image-20211012145648239.png"></p><h3 id="Input-pre-process"><a href="#Input-pre-process" class="headerlink" title="Input pre-process"></a>Input pre-process</h3><p>è®ºæ–‡é‡‡ç”¨äº†ç®€å• floor æ“ä½œï¼Œå°†æ‰€æœ‰ç‚¹çš„åæ ‡æ˜ å°„åˆ°æ …æ ¼ç‚¹ä¸Šã€‚è¿™æ ·çš„é¢„å¤„ç†ä¸ SECOND ç›¸æ¯”ï¼Œä½¿ç”¨æ—¶é—´éå¸¸çŸ­ï¼Œåœ¨æœ€åçš„å®éªŒéƒ¨åˆ†æœ‰å›¾è¡¨</p><script type="math/tex; mode=display">\overline{p_i} = (âŒŠ \frac{x_i}{d_x} âŒ‹, âŒŠ \frac{y_i}{d_y} âŒ‹, âŒŠ \frac{z_i}{d_z} âŒ‹)</script><h3 id="Backbone-network"><a href="#Backbone-network" class="headerlink" title="Backbone network"></a>Backbone network</h3><p>ä¸»å¹²ç½‘ç»œçš„ç»“æ„æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯åŸºäº VoxelNet/SECOND ç½‘ç»œç»“æ„ï¼Œä½¿ç”¨ 3D ç¨€ç–å·ç§¯ sparse convolution è¿›è¡Œç‰¹å¾æå–ã€‚å°†å¾—åˆ°çš„ 3D ç‰¹å¾å›¾è°±é‡å¡‘ reshape ä¸ºäºŒç»´ BEV ç‰¹å¾å›¾è°±è¡¨ç¤ºï¼Œå³å°† z è½´æ–¹å‘çš„ç‰¹å¾è¿æ¥èµ·æ¥ã€‚æœ€ç»ˆä½¿ç”¨è¯¥ BEV ç‰¹å¾å›¾è°±åˆ†ä¸ºå¤´ï¼Œåšé€‰æ¡†é¢„æµ‹ä»»åŠ¡å’Œåˆ†ç±»ä»»åŠ¡</p><h3 id="Detachable-auxiliary-network"><a href="#Detachable-auxiliary-network" class="headerlink" title="Detachable auxiliary network"></a>Detachable auxiliary network</h3><p>è¾…åŠ©ç½‘ç»œçš„ç›®æ ‡æ˜¯å¸®åŠ©ä¸»å¹²ç½‘ç»œæ„ŸçŸ¥ 3D ç‚¹äº‘çš„ç»“æ„ä¿¡æ¯ã€‚ä¸‹é¢è¯¦ç»†åœ°ä»‹ç»è¾…åŠ©ç½‘ç»œçš„ä½¿ç”¨åŠ¨æœº</p><h4 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h4><p>åœ¨ä¸»å¹²ç½‘ç»œæå–ç‚¹äº‘ç‰¹å¾çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä¸æ–­åœ°è¿›è¡Œå·ç§¯æ“ä½œï¼Œè¯¥æ“ä½œä¹Ÿæ˜¯ä¸€ä¸ªä¸‹é‡‡æ ·æ“ä½œï¼Œå°†ä¸å¯é¿å…åœ°ä¸¢å¤±å‡†ç¡®çš„ç©ºé—´ä¿¡æ¯ã€‚å½“ä»…ä½¿ç”¨éƒ¨åˆ†ç‚¹ï¼ˆç”±äºä¸‹é‡‡æ ·çš„åŸå› ï¼‰å¯¹ 3D é€‰æ¡†è¿›è¡Œé¢„æµ‹æ—¶ï¼Œå¦‚æœæ·»åŠ ä¸€äº›å…¶ä»–ä¿¡æ¯è¿›è¡Œè¾…åŠ©ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°å¸®åŠ©é¢„æµ‹ç»“æœï¼Œæ¯”å¦‚ï¼šæ¯ä¸ªç‚¹çš„æ˜¯å¦ä¸ºå‰æ™¯ç‚¹ã€æ¯ä¸ªç‚¹çš„é€‰æ¡†ä¸­å¿ƒåœ¨ä½•å¤„ã€‚æœ‰äº†è¿™äº›è¾…åŠ©ä¿¡æ¯ï¼Œèƒ½å¤Ÿè®©é¢„æµ‹çš„é€‰æ¡†æ›´åŠ å‡†ç¡®</p><p><img src="/archives/82cec617/image-20211012165858427.png"></p><p>å—æ­¤å¯å‘ï¼Œæœ€ç®€å•æ“ä½œä¸ºï¼Œç›´æ¥ä½¿ç”¨æ›´å¤šçš„ç½‘ç»œæ¥å®Œæˆå¯¹äºè¾…åŠ©ä¿¡æ¯çš„é¢„æµ‹ï¼Œç„¶åå†å°†è¿™äº›è¾…åŠ©ç‰¹å¾ã€ä¿¡æ¯ä¸ä¸»å¹²ç½‘ç»œçš„ç‰¹å¾ç›¸è¿æ¥ï¼Œè¿›è¡Œæœ€ç»ˆçš„é¢„æµ‹ã€‚ä½†æ˜¯è¿™äº›ç½‘ç»œå°†ä¼šä½¿ç”¨æ›´å¤šçš„è®¡ç®—èµ„æºï¼Œæœ¬è®ºæ–‡åˆ™å¸Œæœ›åœ¨ä¸å¢åŠ è®¡ç®—èµ„æºçš„åŒæ—¶è·å¾—è¿™äº›è¾…åŠ©ä»»åŠ¡çš„ç‰¹å¾ä¸ä¿¡æ¯ï¼ŒåŸºäºæ­¤æå‡ºäº†å¯åˆ†ç¦»è¾…åŠ©ç½‘ç»œã€‚è¯¥è¾…åŠ©ç½‘ç»œåœ¨è®­ç»ƒæ—¶ä¸ä¸»å¹²ç½‘ç»œè”åˆä¼˜åŒ–ï¼Œè€Œåœ¨æ¨ç†æ—¶å°†ä»ä¸»å¹²ç½‘ç»œä¸­åˆ†ç¦»ï¼Œä¹Ÿå³åœ¨è®­ç»ƒæ—¶ç”±äºè¾…åŠ©ç½‘ç»œçš„å¼•è¿›ä¼šå¢åŠ æ›´å¤šçš„è®¡ç®—ï¼Œä½†åœ¨æ¨ç†æ—¶æ²¡æœ‰å…¶ä»–å¤šä½™çš„è®¡ç®—ï¼Œä¿æŒä¸»å¹²ç½‘ç»œçš„é«˜æ•ˆç‡</p><h3 id="Point-wise-feature-representation"><a href="#Point-wise-feature-representation" class="headerlink" title="Point-wise feature representation"></a>Point-wise feature representation</h3><p>ä¸ºè§£å†³ä»¥ä¸Šæå‡ºçš„é—®é¢˜ï¼Œè®ºæ–‡çš„è§£å†³æ–¹æ¡ˆä¸ºï¼šæ„å»ºä¸€ä¸ªå…·æœ‰ç‚¹çº§ point-level ç›‘ç£çš„è¾…åŠ©ç½‘ç»œï¼Œä»¥å¼•å¯¼ä¸»å¹²ç½‘ç»œåœ¨ä¸åˆ†è¾¨ç‡çš„ç‰¹å¾å›¾è°±å»å­¦ä¹ æ›´ç»†ç²’åº¦çš„ç»“æ„ã€‚è¯¥å¼•å¯¼ä¸ºéšæ€§çš„å¼•å¯¼ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­é€šè¿‡è¾…åŠ©ä»»åŠ¡å’Œåå‘è½¬æ’­å»è°ƒæ•´ä¸»å¹²ç½‘ç»œä¸­çš„å‚æ•°ï¼Œä½¿å¾—ä¸»å¹²ç½‘ç»œè·å¾—æ›´ç»†èŠ‚çš„ç‰¹å¾ä¿¡æ¯ã€‚å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š</p><ol><li><p>ä½¿ç”¨ç‰¹å¾ä¼ æ’­ feature propagationï¼Œå°†ä¸åŒåˆ†è¾¨ç‡ä¸‹çš„ voxel-level ç‰¹å¾è½¬åŒ–ä¸º point-level ç‰¹å¾ï¼Œè¯¥æ“ä½œä¸ PointNet++ ä¸­çš„ç‰¹å¾ä¼ æ’­æ˜¯ä¸€è‡´çš„ï¼Œæ˜¯åŸºäºç©ºé—´è·ç¦»çš„æ’å€¼æ“ä½œ inverse distance weighted average </p><script type="math/tex; mode=display">f^{(j)}(x)=\frac{\sum_{i=1}^{k} w_{i}(x) f_{i}^{(j)}}{\sum_{i=1}^{k} w_{i}(x)} \quad \text { where } \quad w_{i}(x)=\frac{1}{d\left(x, x_{i}\right)^{p}}, j=1, \ldots, C</script><p>è€Œè¿™äº›æ’å€¼ç‚¹çš„æ¥æºè®ºæ–‡ä¸­å¹¶æ²¡æœ‰æåŠï¼Œä½†æ˜¯æ¯ä¸€ä¸ª voxel-level ç‰¹å¾æ‰€è½¬æ¢å‡ºæ¥çš„ point-level ç‰¹å¾åº”è¯¥éƒ½æ˜¯ç›¸åŒå½¢çŠ¶çš„</p></li><li><p>å°†ä¸åŒåˆ†è¾¨ç‡ä¸‹å¾—åˆ°çš„ point-level ç‰¹å¾è¿æ¥èµ·æ¥ä½¿ç”¨ shared MLP è¿›è¡Œç¼–ç ï¼ˆåœ¨è®ºæ–‡çš„ä»£ç ä¸­å¹¶æ²¡æœ‰ä½“ç°ï¼‰</p></li><li>å°†ç¼–ç å¾—åˆ°çš„ç‰¹å¾ï¼Œä½¿ç”¨ MLP å»é¢„æµ‹ä¸¤ä¸ªç»“æœï¼šæ¯ä¸ªç‚¹çš„å±äºå‰æ™¯ç‚¹çš„æ¦‚ç‡ï¼Œå‰æ™¯ç‚¹åˆ°ç›®æ ‡ä¸­å¿ƒçš„åç§»é‡ã€‚è¿™é‡Œçš„ unit point convolutions åº”è¯¥è¿˜æ˜¯</li></ol><p>ä¸¤ä¸ªä»»åŠ¡çš„æŸå¤±å‡½æ•°ä¹Ÿæ˜¯å¸¸è§„çš„ focal loss å’Œ smooth L1 lossï¼Œä¸” L1 loss ä»…é’ˆå¯¹äºå‰æ™¯ç‚¹</p><script type="math/tex; mode=display">\mathcal{L}_{\mathrm{seg}}=\frac{1}{N_{\text {pos }}} \sum_{i}^{N}-\alpha\left(1-\hat{s}_{i}\right)^{\gamma} \log \left(\hat{s}_{i}\right)\\where \ \hat{s}_{i}=\left\{\begin{array}{ll}\tilde{s}_{i} & \text { if } s_{i}=1 \\1-\tilde{s}_{i} & \text { otherwise. }\end{array}\right.</script><script type="math/tex; mode=display">\mathcal{L}_{\mathrm{ctr}}=\frac{1}{N_{\text {pos }}} \sum_{i}^{N} \text { Smooth- } l_{1}(\Delta \tilde{\mathbf{p}}-\Delta \mathbf{p}) \cdot \mathbb{1}\left[s_{i}=1\right]</script><h3 id="Part-sensitive-warping"><a href="#Part-sensitive-warping" class="headerlink" title="Part-sensitive warping"></a>Part-sensitive warping</h3><p>å¦‚æœä½¿ç”¨ anchor-based æ–¹æ³•è¿›è¡Œç›®æ ‡æ£€æµ‹ï¼Œä¾‹å¦‚ï¼šFaster RCNNï¼Œä¼šå‡ºç°é¢„æµ‹é€‰æ¡†ä¸åˆ†ç±»ç½®ä¿¡åº¦ä¹‹é—´å¹¶ä¸åŒ¹é…ã€‚åˆ†ç±»ç½®ä¿¡åº¦çš„ç‰¹å¾æ¥æºæ˜¯ç”±é¢„å…ˆè®¾å€¼çš„ anchor å†³å®šçš„ï¼Œè€Œä¸æ˜¯æ¥è‡ªæ‰€é¢„æµ‹çš„é€‰æ¡†ã€‚ä¸ºè§£å†³è¿™ä¸€é—®é¢˜ï¼Œè®ºæ–‡æå‡ºäº† part-sensitive warping operation (PSWarp) ç”¨äºçŸ«æ­£è¿™ä¸€ä¸åŒ¹é…ç°è±¡ï¼Œå…¶ä¸­å¿ƒæ€æƒ³ä¸ºï¼šè®©é¢„æµ‹é€‰æ¡†çš„åˆ†ç±»ç½®ä¿¡åº¦ï¼Œæ¥è‡ªäºé¢„æµ‹é€‰æ¡†å¯¹åº”çš„åˆ†ç±»ç‰¹å¾å›¾è°±åŒºåŸŸã€‚å…·ä½“æ“ä½œæ›´åŠ å¤æ‚ä¸€ç‚¹</p><ol><li><p>å°†åˆ†ç±»ç‰¹å¾å›¾è°±æ”¹å˜ç»´åº¦ï¼Œä» $(W, L, F)$ è‡³ $(W,L,C, K)$ å…¶ä¸­ C è¡¨ç¤ºç±»åˆ«æ•°é‡ï¼ŒK è¡¨ç¤ºå°†é¢„æµ‹é€‰æ¡†çš„ä¿¯è§†å›¾å¹³å‡åˆ†æˆäº† K ä»½ï¼ˆè®ºæ–‡å°†é€‰æ¡†åˆ†ä¸ºäº† 4x7=28 ä»½ï¼‰ï¼ŒK ä¸ªç»´åº¦é‡Œçš„æ¯ä¸€ä¸ªç»´åº¦ä»£è¡¨è¯¥ç‚¹ä¸ºé€‰æ¡†æŸä¸ªéƒ¨åˆ†çš„å¾—åˆ†ã€‚ä¾‹å¦‚å½“ K = 4 æ—¶ï¼Œç»´åº¦ (0, 1, 2, 3) ä»£è¡¨é¢„æµ‹é€‰æ¡†çš„ (å·¦ä¸Šï¼Œå³ä¸Šï¼Œå·¦ä¸‹ï¼Œå³ä¸‹) çš„å¾—åˆ†</p></li><li><p>å°†é¢„æµ‹é€‰æ¡†çš„ä¿¯è§†å›¾å¹³å‡åˆ†ä¸º K ä»½åï¼Œå–æ¯ä¸€ä¸ªéƒ¨åˆ†çš„ä¸­å¿ƒç‚¹ä½œä¸ºé‡‡æ ·ç‚¹ï¼Œå†ä½¿ç”¨åŒçº¿æ€§æ’å€¼ bilinear interpolation è·å¾—<strong>é‡‡æ ·ç‚¹åœ¨åˆ†ç±»å›¾è°±ä¸­çš„ç‰¹å¾å€¼</strong>ã€‚ä¸ºäº†æ›´å…·ä½“çš„è¯´æ˜æ’å€¼è¿‡ç¨‹ï¼Œå°†è¿™ K ä¸ªé‡‡æ ·ç‚¹è¿›è¡Œç¼–å· $\{S_k: k=1, 2,â€¦,K\}$ï¼Œå‡è®¾ç¬¬ i ä¸ªé‡‡æ ·ç‚¹ $S_i$ å…¶æ’å€¼å‚è€ƒçš„ç‰¹å¾å›¾è°± feature map $\mathcal{X}$ ä¹Ÿä¸ºç¬¬ i ä¸ªï¼Œå³ $(W,L,C,i)$ è®°ä¸º $\mathcal{X^i}$ã€‚ä»£æ•°è¿‡ç¨‹å¦‚ä¸‹</p><script type="math/tex; mode=display">\mathcal{C}_{p}=\frac{1}{K} \sum_{k=1}^{K} \sum_{i\in\{\lfloor{u^k}\rfloor ,\lfloor{u^k+1}\rfloor\}\atop  j\in\{\lfloor{v^k}\rfloor ,\lfloor{v^k+1}\rfloor\}} \mathcal{X_{ij}^k}\times b(i,j,u^k,v^k)</script><p>ä»£ç å¯ä»¥å‚è€ƒ <a href="https://blog.csdn.net/themasterbi/article/details/106913582">CSDN</a>ï¼Œè¿™ç¯‡åšå®¢çš„æ‰€å†™çš„æºä»£ç æ³¨é‡Šï¼Œæ˜¯ä¼—å¤šåšå®¢ä¸­è®©æˆ‘å”¯ä¸€ç†è§£çš„æ³¨é‡Šï¼Œä¸ç„¶é€šè¿‡è®ºæ–‡ä¸­çš„æ–‡å­—å¾ˆéš¾ç†è§£ PSWarp æ“ä½œã€‚æœ€ç»ˆè·å¾—è¾“å‡º $(K, 1, N, 1)$ï¼Œå…¶ä¸­ $N$ ä¸ºè¯¥åœºæ™¯ä¸­é¢„æµ‹é€‰æ¡†çš„æ•°é‡ã€‚å›¾ç¤ºå¦‚ä¸‹</p><p><img src="/archives/82cec617/image-20211013182126400.png" style="zoom:80%;"></p></li><li><p>K ä¸ªé‡‡æ ·ç‚¹å°†ä¼šå¾—åˆ°çš„ K ä¸ªå¾—åˆ†ï¼Œå®ƒä»¬çš„å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆåˆ†ç±»å¾—åˆ†ï¼Œæœ€åä½¿ç”¨ sigmoid å‡½æ•°è·å¾—åˆ†ç±»ç½®ä¿¡åº¦</p></li></ol><p>å°†è¾…åŠ©ä»»åŠ¡å’Œä¸»ä»»åŠ¡çš„æŸå¤±å‡½æ•°ä¹˜ä»¥æƒé‡è¶…å‚æ•°ï¼Œç›¸åŠ åå¾—åˆ°æ•´ä¸ªç½‘ç»œçš„æŸå¤±å‡½æ•°</p><script type="math/tex; mode=display">\mathcal{L}=\mathcal{L}_{\text {cls }}+\omega \mathcal{L}_{\text {box }}+\mu \mathcal{L}_{\text {seg }}+\lambda \mathcal{L}_{\text {ctr }}</script><p>å‰ä¸¤é¡¹å³ä¸ºä¸»ä»»åŠ¡çš„åˆ†ç±»ä»»åŠ¡å’Œé¢„æµ‹é€‰æ¡†ä»»åŠ¡ï¼Œåä¸¤é¡¹ä¸ºè¾…åŠ©ä»»åŠ¡çš„åˆ†å‰²ä»»åŠ¡å’Œé¢„æµ‹ä¸­å¿ƒä»»åŠ¡ã€‚æ‰€æœ‰çš„åˆ†ç±»ä»»åŠ¡å’Œå›å½’ä»»åŠ¡éƒ½æ˜¯ focal loss å’Œ smooth L1 loss</p><p>æŸå¤±å‡½æ•°æ²¡æœ‰ä½¿ç”¨åˆ° IoU ç›¸å…³çš„éƒ¨åˆ†ï¼ŒIoU å…¶å®æ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„ç»¼åˆè¯„ä¼°æ ‡å‡†ï¼ŒåŒ…å«äº†ä¸å°‘çš„ä¿¡æ¯ã€‚ä¹‹åå¯ä»¥è€ƒè™‘åŠ å…¥é¢„æµ‹ IoU çš„ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡æˆ–è®¸å¯¹åŸç½‘ç»œæœ‰ä¸é”™çš„ä¼˜åŒ–</p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="Train"><a href="#Train" class="headerlink" title="Train"></a>Train</h3><p>åœ¨ RPN ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç”±äº anchor-based å±æ€§ï¼Œéœ€è¦æä¾› anchor çš„ positive/negative å±æ€§ä»¥è¿›è¡Œåˆ†ç±»ä»»åŠ¡çš„è®­ç»ƒï¼Œå…¶ IoU é˜ˆå€¼åˆ†åˆ«ä¸º0.6å’Œ0.45ã€‚åœ¨æ¨ç†é˜¶æ®µä½¿ç”¨é˜ˆå€¼ä¸º0.1çš„ NMS æ“ä½œ </p><h3 id="KITTI"><a href="#KITTI" class="headerlink" title="KITTI"></a>KITTI</h3><p><img src="/archives/82cec617/image-20211013184635247.png"></p><h3 id="Weight-selection-of-auxiliary-tasks"><a href="#Weight-selection-of-auxiliary-tasks" class="headerlink" title="Weight selection of auxiliary tasks"></a>Weight selection of auxiliary tasks</h3><p><img src="/archives/82cec617/image-20211013184733794.png"></p><p>è®ºæ–‡é‡‡ç”¨ $\mu=0.9,\lambda=2$</p><h3 id="Ablation-study-amp-compare"><a href="#Ablation-study-amp-compare" class="headerlink" title="Ablation study &amp; compare"></a>Ablation study &amp; compare</h3><p><img src="/archives/82cec617/image-20211013185112410.png"></p><p>å¯ä»¥çœ‹å‡º3ä¸ªç‰¹æ®Šè®¾è®¡å„æœ‰0.5%å·¦å³çš„æå‡ï¼Œæœ€ç»ˆæä¾›äº†æ¥è¿‘1.5%çš„æå‡ï¼ŒåŒæ—¶ç½‘ç»œé€Ÿåº¦ä¹Ÿä¿æŒå¾—ç›¸å½“ä¸é”™</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>è®ºæ–‡åˆ›æ–°æ€§åœ°ä½¿ç”¨äº†å¯åˆ†ç¦»è¾…åŠ©ç½‘ç»œï¼Œåœ¨æ¨ç†æ—¶ä¸å¢åŠ é¢å¤–è®¡ç®—é‡ï¼ŒåŒæ—¶æå‡äº†æœ€ç»ˆçš„è¡¨ç°ã€‚å¯ä»¥æ„Ÿè§‰è¯¥æ€æƒ³æ˜¯ä¸€ä¸ªä¸é”™çš„çªç ´å£ï¼Œä½†æ˜¯è¿™èƒŒåç•™ä¸‹äº†æ›´å¤šçš„ç–‘é—®ï¼šè¾…åŠ©ç½‘ç»œçš„å…·ä½“ç»“æ„åº”è¯¥å¦‚ä½•è®¾è®¡ï¼Œæ˜¯è¯¥ç®€å•ï¼Œè¿˜æ˜¯è¯¥å¤æ‚ï¼Œæˆ–è€…éƒ½ä¸æ˜¯ï¼›è¯¥æ–¹æ³•æ˜¯å¦èƒ½ç§°ä¸ºä¸€ç§ä¸»æµçš„æ–¹æ³•ï¼Œå°†æ•´ä¸ªç›®æ ‡æ£€æµ‹çš„æ¡†æ¶å¸¦åˆ°ä¸€ä¸ªæ–°çš„å°é˜¶ä¸Šï¼›ç»†ç²’åº¦ä¿¡æ¯åº”è¯¥ä»¥æ€æ ·çš„è¡¨ç¤ºæ–¹æ³•åŠ å…¥åˆ°å…¶ä¸­ï¼Œå°¤å…¶ä¸ 2-Stage æ–¹æ³•åšæ¯”è¾ƒï¼Œç›´æ¥çš„ç‰¹å¾åŠ å…¥å’Œé—´æ¥çš„ç‰¹å¾å¼•å¯¼å­¦ä¹ ï¼Œä¸¤è€…è¯¥æ€ä¹ˆè¡¡é‡â€¦</p><p>PSWarp æ–¹æ³•æƒ³è¦è§£å†³çš„å›°éš¾æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯ç½®ä¿¡åº¦ä¸é€‰æ¡†ä¸åŒ¹é…é—®é¢˜ã€‚ä½†è¯¥æ–¹æ³•æ˜¯å¦ä¸ºè§£å†³è¯¥é—®é¢˜æœ€å¥½çš„ï¼Œæˆ–è®¸å…¶ä»–è®ºæ–‡æœ‰æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œè¿˜æœ‰å¾…ç»§ç»­å­¦ä¹ </p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SA-SSD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CenterPoint</title>
      <link href="/archives/807a20df.html"/>
      <url>/archives/807a20df.html</url>
      
        <content type="html"><![CDATA[<h1 id="CenterPoint"><a href="#CenterPoint" class="headerlink" title="CenterPoint"></a>CenterPoint</h1><hr><p>Yin, Tianwei, Xingyi Zhou, and Philipp KrÃ¤henbÃ¼hl. â€œCenter-Based 3D Object Detection and Tracking.â€ <em>ArXiv:2006.11275 [Cs]</em>, January 6, 2021. <a href="http://arxiv.org/abs/2006.11275">http://arxiv.org/abs/2006.11275</a>.</p><hr><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h3 id="ä¸‰ç»´ç›®æ ‡æ£€æµ‹éš¾ç‚¹"><a href="#ä¸‰ç»´ç›®æ ‡æ£€æµ‹éš¾ç‚¹" class="headerlink" title="ä¸‰ç»´ç›®æ ‡æ£€æµ‹éš¾ç‚¹"></a>ä¸‰ç»´ç›®æ ‡æ£€æµ‹éš¾ç‚¹</h3><p>ä¸äºŒç»´ç›®æ ‡æ£€æµ‹ç›¸æ¯”ï¼Œä¸‰ç»´ç›®æ ‡æ£€æµ‹æœ‰å‡ ä¸ªåŸºæœ¬çš„éš¾ç‚¹</p><ol><li><p>ç‚¹äº‘æ•°æ®çš„ç¨€ç–æ€§ï¼Œæœ‰å¤§é‡çš„ç©ºé—´æ²¡æœ‰ç‚¹äº‘ </p></li><li><p><strong>é€‰æ¡†çš„è‡ªç”±åº¦é«˜ï¼Œä¸ä»…æœ‰æ›´çµæ´»çš„æ–¹å‘ï¼Œè¿˜æœ‰æ›´å¤šçš„å°ºå¯¸ã€‚Anchor-based RPN éš¾ä»¥æ»¡è¶³è¿™æ ·çš„çµæ´»æ€§</strong> </p></li></ol><h3 id="Contribution"><a href="#Contribution" class="headerlink" title="Contribution"></a>Contribution</h3><p>CenterPoint æ˜¯ä¸€ä¸ª 2-Stage ä¸‰ç»´ç›®æ ‡æ£€æµ‹ç½‘ç»œï¼Œæ˜¯ center-based ç³»åˆ—æ€æƒ³åœ¨ä¸‰ç»´ä¸­çš„åº”ç”¨ï¼Œå…¶å‰ä½œ CenterNet (Objects as Points) åœ¨äºŒç»´ç›®æ ‡æ£€æµ‹ä¸­æœ‰ä¸é”™çš„æ•ˆæœï¼ŒåŒæ—¶ä¹Ÿåœ¨ CenterPoint ä¸­å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚æœ¬è®ºæ–‡æå‡ºçš„æ˜¯ä¸€ç§åŸºæœ¬æ¡†æ¶ï¼Œä½¿ç”¨ center-based æ€æƒ³èƒ½å¤Ÿä¸åŒç¨‹åº¦æå‡ backbone çš„è¡¨ç°ï¼ˆçº¦ 3-4 mAPï¼‰ã€‚å†ç»è¿‡ç¬¬äºŒé˜¶æ®µçš„ç»†åŒ– refinement è¿˜èƒ½å¤Ÿç»§ç»­æå‡çº¦ 2 mAP çš„è¡¨ç°ï¼Œä¸”ç‰ºç‰²çš„è®¡ç®—è¾ƒå°‘ï¼Œæ§åˆ¶åœ¨ 10% ä»¥å†…ã€‚ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ä¸¤ä¸ªé˜¶æ®µçš„è¿‡ç¨‹ï¼š</p><ol><li>é¦–å…ˆä½¿ç”¨ 3D backbone æå–ç‚¹äº‘ç‰¹å¾ï¼Œè¯¥ç‰¹å¾æ˜¯ä»¥ map-view çš„å½¢å¼ï¼ˆä¿¯è§†æ …æ ¼ï¼‰å‘ˆç°ã€‚ç¬¬ä¸€é˜¶æ®µ Stage-1 ä½¿ç”¨ map-view features æ£€æµ‹å„ä¸ªç›®æ ‡ç‚¹çš„ä¸­å¿ƒä½ç½®ï¼Œç„¶åä½¿ç”¨ä¸­å¿ƒä½ç½®çš„ç‰¹å¾å›å½’é¢„æµ‹ 3D é€‰æ¡†çš„å…¶ä»–å±æ€§ï¼ŒåŒ…æ‹¬å¤§å°ã€æ–¹å‘ã€é€Ÿåº¦ç­‰</li><li>ç¬¬äºŒé˜¶æ®µ Stage-2 ä½¿ç”¨æ›´å¤šçš„ç›¸å…³ç‚¹çš„ç‰¹å¾æ¥å¯¹é€‰æ¡†è¿›è¡Œç»†åŒ–</li></ol><h2 id="CenterPoint-Architecture"><a href="#CenterPoint-Architecture" class="headerlink" title="CenterPoint Architecture"></a>CenterPoint Architecture</h2><h3 id="3D-æ£€æµ‹ç½‘ç»œé€šç”¨æ¡†æ¶"><a href="#3D-æ£€æµ‹ç½‘ç»œé€šç”¨æ¡†æ¶" class="headerlink" title="3D æ£€æµ‹ç½‘ç»œé€šç”¨æ¡†æ¶"></a>3D æ£€æµ‹ç½‘ç»œé€šç”¨æ¡†æ¶</h3><p>è®ºæ–‡é‡Œæäº†ä¸€ä¸‹ç°ä»£ 3D detector çš„å¸¸è§å¤„ç†è¿‡ç¨‹ã€‚é¦–å…ˆæ˜¯ä½¿ç”¨ä¸€ä¸ª backbone å¯¹ç‚¹äº‘æ•°æ®è¿›è¡Œç‰¹å¾æå–ï¼Œè¯¥ backbone ä¹Ÿå¯ä»¥å«åš encoderã€‚backbone çš„è¾“å‡ºä¸ºä¸€ä¸ª map-view feature map $M\in R^{W\times L\times F}$ï¼Œå…¶ä¸­ W &amp; L ä¸º width &amp; length å’Œä¸‰ç»´åœºæ™¯çš„é•¿å®½ç›¸å…³ï¼ŒF ä¸ºç‰¹å¾ç»´åº¦çš„å¤§å°æˆ–è€…ç§°ä¸º channel numberã€‚è®ºæ–‡ä¸­é‡‡ç”¨çš„ backbone æœ‰ä¸¤ä¸ª VoxelNet &amp; PointPillarsï¼ˆå»ºè®®äº†è§£ä¸€ä¸‹è¿™ä¸¤ä¸ªç½‘ç»œï¼‰ï¼Œå¯¹è¿™ä¸¤ä¸ª backbone åšäº†å®éªŒå’Œæ¯”è¾ƒ</p><p>ç„¶åå¸¸ä½¿ç”¨ bounding box detector åœ¨è¯¥ feature map ä¸Šè¿›è¡Œæ£€æµ‹ã€‚è¿™æ ·çš„ detector åœ¨äºŒç»´å½“ä¸­æœ‰å¾ˆå¤šå¯ä»¥å€Ÿé‰´çš„ç½‘ç»œï¼Œè®ºæ–‡ä½¿ç”¨äº† CenterNet è€Œä¸æ˜¯å¸¸è§„çš„ anchor-based ç½‘ç»œã€‚ä¸‹å›¾å³ä¸º CenterPoint ç»“æ„ç¤ºæ„å›¾ï¼Œæ¥ä¸‹æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹ä¸¤ä¸ªé˜¶æ®µçš„ç»†èŠ‚</p><p><img src="/archives/807a20df/2f857fd4-fe6f-447b-9817-c1a9079d245e.png" style="zoom: 80%;"></p><h3 id="Stage-1"><a href="#Stage-1" class="headerlink" title="Stage-1"></a>Stage-1</h3><p>ç¬¬ä¸€é˜¶æ®µåŸºæœ¬ä¸Šå°±æ˜¯ CenterNet æ€æƒ³çš„å¤åˆ»ï¼Œä¸ç®¡æ˜¯ä¸­å¿ƒé¢„æµ‹ï¼Œè¿˜æ˜¯å›å½’å…¶ä»–å±æ€§ï¼Œæ‰€ä»¥ç»†èŠ‚éƒ¨åˆ†è¯·é˜…è¯» Objects as Pointsã€‚è¿™äº›é¢„æµ‹éƒ½å±äº dense prediction ä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªæ …æ ¼ bin éƒ½ä¼šæœ‰è‡ªå·±çš„é¢„æµ‹ç»“æœï¼Œæ‰€æœ‰çš„ç¬¬ä¸€é˜¶æ®µç½‘ç»œéƒ½æ˜¯å¸¸è§çš„å·ç§¯ç½‘ç»œ</p><h4 id="Center-heatmap-head"><a href="#Center-heatmap-head" class="headerlink" title="Center heatmap head"></a>Center heatmap head</h4><p>é¦–å…ˆéœ€è¦ä½¿ç”¨ feature map é¢„æµ‹å„ä¸ªç›®æ ‡çš„ä¸­å¿ƒç‚¹åœ¨å“ªé‡Œã€‚è¿™é‡Œçš„è¿‡ç¨‹å’Œ CenterNet æ˜¯ç›¸ä¼¼çš„ï¼Œä¸‹é¢åˆ—å‡ºå…¶ä¸­çš„å…³é”®éƒ¨åˆ†ï¼š</p><ol><li><p>æ ‡ç­¾ labelï¼šå°† ground truth ä¸­å¿ƒç‚¹çš„ä½ç½®æ˜ å°„åˆ° feature map ä¸­å½¢æˆä¸­å¿ƒç‚¹çš„ heatmap $Y\in [0,1]^{W\times L\times C}$ï¼Œå…¶ä¸­ C ä¸ºç±»åˆ«æ•°é‡ã€‚è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ª 0~1 çš„åŒºé—´ï¼Œæ˜¯ç”±äºè¯¥æ ‡ç­¾å¹¶ä¸æ˜¯ç¡¬æ ‡ç­¾ï¼Œè€Œæ˜¯ä½¿ç”¨äº†é«˜æ–¯æ ¸ï¼Œå°†è¯¥æ ‡ç­¾é™„è¿‘çš„æ …æ ¼ä¹Ÿä½œä¸ºäº†è½¯ç›®æ ‡ä¸­å¿ƒï¼Œå…¶è®¡ç®—å½¢å¦‚ä¸‹é¢çš„å…¬å¼</p><script type="math/tex; mode=display">Y_{xyc}=\exp \left(-\frac{\left(x-\tilde{p}_{x}\right)^{2}+\left(y-\tilde{p}_{y}\right)^{2}}{2 \sigma_{p}^{2}}\right)</script></li><li><p>æŸå¤±å‡½æ•° loss functionï¼šfocal loss</p></li></ol><p>ä»¥ä¸Šä¸¤ä¸ªæ“ä½œéƒ½æ˜¯åŸºäºç‚¹äº‘çš„ç¨€ç–æ€§ã€æ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡è€Œè®¾è®¡ã€‚åˆ¶ä½œè½¯æ ‡ç­¾çš„åŸå› æ˜¯åœ¨äºä¸­å¿ƒç‚¹çš„èŒƒå›´å®åœ¨å¤ªå°ï¼Œå¿…é¡»å°†å…¶è¾å°„å‡ºå»ï¼›è€Œä½¿ç”¨ focal loss ä¹Ÿæ˜¯å› ä¸ºèƒŒæ™¯ç‚¹å¤ªå¤šï¼Œè€Œä¸­å¿ƒç‚¹å¤ªå°‘</p><h4 id="Regression-heads"><a href="#Regression-heads" class="headerlink" title="Regression heads"></a>Regression heads</h4><p>ä¸ºäº†é¢„æµ‹é€‰æ¡†ï¼Œè¿˜éœ€è¦é¢„æµ‹å…¶ä»–çš„å±æ€§</p><ol><li><strong>æ …æ ¼åå·®</strong> offsetï¼Œç”±äºä¸­å¿ƒç›®æ ‡ç‚¹æ˜¯è¢«æ˜ å°„åˆ°äº†æ …æ ¼ä¸­ï¼Œå¹¶ä¸æ˜¯ç²¾å‡†çš„ï¼Œæ‰€ä»¥éœ€è¦é¢„æµ‹ä¸€ä¸ªåå·®å€¼è¿›è¡Œä¿®æ­£ a sub-voxel location refinement $o \in R^2$ , The subvoxel location refinement o reduces the quantization error</li><li><strong>é«˜åº¦</strong> height-above-ground $h_g \in R$, The height-above-ground hg helps localize the object in 3D and adds the missing elevation information removed by the mapview projection</li><li><strong>é€‰æ¡†å¤§å°</strong> the 3D size $s \in R^3$ </li><li><strong>é€‰æ¡†æ–¹å‘</strong> and a yaw rotation angle $(sin(Î±), cos(Î±)) \in R^2$ </li></ol><p>æŸå¤±å‡½æ•°å¯¹äºä¸­å¿ƒ center ä½¿ç”¨çš„ä¸€èˆ¬ L1 lossï¼Œå¯¹äºé€‰æ¡†å¤§å° size å®é™…é¢„æµ‹çš„æ˜¯<strong>å¯¹æ•°å¤§å°</strong> logarithmic sizeï¼Œç„¶åå†è®¡ç®— L1 lossã€‚ä½¿ç”¨å¯¹æ•°å¤§å°ï¼Œå¯¹äºä¸åŒå½¢çŠ¶çš„é€‰æ¡†æ›´å¯èƒ½æ›´æœ‰ä¼˜åŠ¿ï¼ŒæŸå¤±å‡½æ•°çš„æ›²çº¿ä¼šæ›´å¹³æ»‘ä¸€äº›</p><p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µï¼Œæ‰€æœ‰çš„æŸå¤±å‡½æ•°ä»…åœ¨æ ‡ç­¾ä½ç½® keypoint location è¿›è¡Œï¼Œè¿™ä¸ªæ€æƒ³å’Œ PointRCNN, SECOND ç­‰ä¸€è‡´ï¼Œä»…å¯¹ positive proposals åšå›å½’æŸå¤±è®¡ç®—ï¼ˆä»¥ä¸Šä¸ºæ ¹æ® CenterNet çš„æ¨æµ‹ï¼ŒåŸæ–‡ä¼¼ä¹å¹¶æœªæåŠï¼‰</p><h3 id="Stage-2"><a href="#Stage-2" class="headerlink" title="Stage-2"></a>Stage-2</h3><p>ç¬¬äºŒé˜¶æ®µæœ‰ä¸¤ä¸ªä»»åŠ¡ï¼Œç»†åŒ– refinement å’Œè¯„åˆ† scoreã€‚æˆ‘ä»¬ä»é¢„æµ‹é€‰æ¡†çš„æ¯ä¸ªé¢çš„ä¸­å¿ƒæå–ä¸€ä¸ªç‚¹ç‰¹å¾ï¼Œè¿™æ ·å°±æœ‰6ä¸ªç‰¹å¾ç‚¹ï¼Œä½†åœ¨ä¿¯è§†å›¾ä¸­ä¸Šä¸‹è¡¨é¢ä¸­å¿ƒç‚¹é‡åˆï¼Œæ•…åªæœ‰5ä¸ªç‰¹å¾ç‚¹ã€‚å¯¹äºæ¯ä¸ªç‚¹ï¼Œä½¿ç”¨åŒçº¿æ€§æ’å€¼  <a href="https://www.cnblogs.com/xpvincent/archive/2013/03/15/2961448.html">bilinear interpolation</a> ä» feature map ä¸­æå–å‡ºå„è‡ªçš„ç‰¹å¾ï¼Œç„¶åå°†æ‰€æœ‰ç‰¹å¾è¿æ¥ concat é€å…¥ MLP ä¸­é¢„æµ‹ç½®ä¿¡åº¦ confidence score $I$ &amp; 3D bounding box</p><h4 id="ç½®ä¿¡åº¦"><a href="#ç½®ä¿¡åº¦" class="headerlink" title="ç½®ä¿¡åº¦"></a>ç½®ä¿¡åº¦</h4><p>å…¶ä¸­çš„ç½®ä¿¡åº¦ $I$ ä¸åˆ†ç±»æ— å…³ class-agnosticï¼Œä»…ä¸ IoU ç›¸å…³ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹</p><script type="math/tex; mode=display">I=\min \left(1, \max \left(0,2 \times I o U_{t}-0.5\right)\right)</script><p><img src="/archives/807a20df/image-20211007171708779.png" style="zoom: 67%;"></p><p>æŸå¤±å‡½æ•°ä¸ºäºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°</p><script type="math/tex; mode=display">L_{\text {score }}=-I_{t} \log \left(\hat{I}_{t}\right)-\left(1-I_{t}\right) \log \left(1-\hat{I}_{t}\right)</script><p>æœ€ç»ˆçš„é¢„æµ‹åˆ†æ•°ä¸ºå¦‚ä¸‹å…¬å¼</p><script type="math/tex; mode=display">\hat{Q}_{t}=\sqrt{\hat{Y}_{t} * \hat{I}_{t}}</script><h4 id="ç»†åŒ–"><a href="#ç»†åŒ–" class="headerlink" title="ç»†åŒ–"></a>ç»†åŒ–</h4><p>è¯¥ç»†åŒ–å·¥ä½œæ˜¯åœ¨ç¬¬ä¸€é˜¶æ®µçš„æè®® proposal ä¹‹ä¸Šè¿›è¡Œï¼Œå³å›å½’é¢„æµ‹ç¬¬ä¸€é˜¶æ®µæ‰€é¢„æµ‹çš„é€‰æ¡†ä¸çœŸå®é€‰æ¡†ä¹‹é—´çš„æ®‹å·®ã€‚å¹¶ä¸”ï¼ˆåœ¨è®­ç»ƒæ—¶ï¼‰ç»†åŒ–åº”è¯¥æ˜¯ä»…å¯¹æ­£æ ·æœ¬è¿›è¡Œï¼Œæ­£è´Ÿæ ·æœ¬çš„æ ‡å‡†åˆ¤å®šä¸ºé¢„æµ‹é€‰æ¡†ä¸æ ‡ç­¾ IoU å¤§äº0.55ï¼Œä»¥ 1:1 æ­£è´Ÿæ¯”ä¾‹å„é‡‡æ ·128ä¸ª</p><blockquote><p>During the training of two-stage CenterPoint, we randomly sample 128 boxes with 1:1 positive negative ratio [43] from the first stage predictions.</p></blockquote><p>åœ¨æµ‹è¯•\æ¨ç†æ—¶æ²¡æœ‰æ ‡ç­¾ï¼Œåˆ™å…ˆä½¿ç”¨ NMS ç­›é€‰å‡ºå€™é€‰é€‰æ¡†ï¼Œç„¶åé€‰å–å¾—åˆ†æœ€é«˜çš„500ä¸ªé€‰æ¡†ï¼Œæœ€åå†è¿›è¡Œç¬¬äºŒé˜¶æ®µçš„ç½®ä¿¡åº¦é¢„æµ‹å’Œç»†åŒ–ã€‚NMS çš„å¾—åˆ†æ ¹æ®åº”è¯¥æ˜¯ heatmap $Y$ï¼Œæ¯•ç«Ÿæ­¤æ—¶ç½®ä¿¡åº¦ $I$ è¿˜æ²¡æœ‰è®¡ç®—å‡ºæ¥</p><p>ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µçš„ç½‘ç»œç»“æ„ä»¥åŠè®­ç»ƒæ–¹æ³•éƒ½ä»‹ç»å®Œäº†ï¼Œä¸€äº›æ›´å…·ä½“çš„åŸºç¡€ç»“æ„å¯ä»¥å‚è€ƒä¸‹é¢çš„åŸæ–‡</p><blockquote><p>All first-stage outputs share a first 3 Ã— 3 convolutional layer, Batch Normalization [25], and ReLU. Each output then uses its own branch of two 3Ã—3 convolutions separated by a batch norm and ReLU. Our second-stage uses a shared two-layer MLP, with a batch norm, ReLU, and Dropout [22] with a drop rate of 0.3, followed by two branches of three fully-connected layers, one for confidence score and one for box regression prediction.</p></blockquote><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="Waymo"><a href="#Waymo" class="headerlink" title="Waymo"></a>Waymo</h3><p><img src="/archives/807a20df/5a04d50f-941e-48ec-a14c-b65a2d6d46fc.png"></p><h3 id="nuScenes"><a href="#nuScenes" class="headerlink" title="nuScenes"></a>nuScenes</h3><p><img src="/archives/807a20df/e847f9af-5198-4628-9797-ae958aa73c63.png"></p><h3 id="Anchor-vs-center"><a href="#Anchor-vs-center" class="headerlink" title="Anchor vs. center"></a>Anchor vs. center</h3><p><img src="/archives/807a20df/bfeb0fb3-b716-4ac0-9f38-f1ecc1b6a683.png"></p><h3 id="One-stage-vs-Two-stage"><a href="#One-stage-vs-Two-stage" class="headerlink" title="One-stage vs. Two-stage"></a>One-stage vs. Two-stage</h3><p><img src="/archives/807a20df/5d0b419b-6226-40a5-8632-879a222a9da1.png"></p><blockquote><p>Two-stage refinement does not bring an improvement over the single-stage CenterPoint model on nuScenes in our experiments. Similar results have been observed in previous two-stage methods like PointRCNN [45] and PV-RCNN [44].</p></blockquote><p>nuScenes å¯¹äº 2-Stage æ¨¡å‹åé¦ˆå¹¶ä¸å¥½ï¼ŒåŸå› å¯èƒ½åœ¨äºå…¶é‡‡æ ·ç‚¹è¾ƒå°‘ï¼Œé™åˆ¶äº†è¿›ä¸€æ­¥çš„ç²¾ç¡®ç»†åŒ–</p><h3 id="Effects-of-different-feature-components"><a href="#Effects-of-different-feature-components" class="headerlink" title="Effects of different feature components"></a>Effects of different feature components</h3><p>å¯¹äºç¬¬äºŒé˜¶æ®µçš„ç»†åŒ–ï¼Œè®ºæ–‡ç›´æ¥ä½¿ç”¨äº†åŒçº¿æ€§æ’å€¼å¾—åˆ°çš„ BEV ç‰¹å¾ï¼Œå®é™…ä¸Šè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å¾—åˆ°å„ä¸ªé‡‡æ ·ç‚¹çš„ç‰¹å¾ã€‚æ¯”å¦‚ï¼š</p><ol><li>PV-RCNN ä¸­é‡‡ç”¨çš„ voxel set abstraction (VSA) æ“ä½œï¼Œä¹Ÿå¯ä»¥å°†å‘¨å›´ voxel ç‰¹å¾æå–åˆ°é‡‡æ ·ç‚¹ä¸Š</li><li>SA-SSD ä¸­é‡‡ç”¨çš„åŸºäºç©ºé—´è·ç¦»çš„æ’å€¼ inverse distance weighted average ä¹Ÿå¯ä»¥å°† voxel ç‰¹å¾ä¼ æ’­åˆ°é‡‡æ ·ç‚¹ä¸Š</li></ol><p>è®ºæ–‡å°†è¿™ä¸¤ç§æ–¹å¼åœ¨ç¬¬äºŒé˜¶æ®µçš„ç»†åŒ–ç¯èŠ‚ä¸­ä¸è®ºæ–‡é‡‡ç”¨çš„ BEV æ’å€¼æ³•è¿›è¡Œå¯¹æ¯”å®éªŒï¼Œè™½ç„¶æ•ˆæœä¸æ˜¯æœ€å¥½ï¼Œä½†å·®è·ä¸å¤§ï¼Œèƒœåœ¨ç”¨æ—¶</p><p><img src="/archives/807a20df/image-20211014212255839.png"></p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>CenterPoint çš„ç»“æ„å…¶å®ç›¸å¯¹ç®€å•ï¼Œä½†å–å¾—äº†å¾ˆå¥½çš„æ•ˆæœï¼Œä¼¼ä¹åœ¨å‘Šè¯‰æˆ‘æ›´å¤šçš„å‚æ•°å°±è®©ç½‘ç»œè‡ªå·±å»é¢„æµ‹å¥½äº†ï¼Œæˆ–è®¸å½“äººä¸ºå¼•å…¥ä¸€äº› anchor ç›¸å…³çš„å‚æ•°ï¼Œåè€Œè®©ç½‘ç»œä¸å¥½å­¦ä¹ ã€‚å¹¶ä¸”ç”±äºå…¶ç»“æ„çš„ç®€å•ï¼Œè®¡ç®—æ—¶é—´ç›¸å¯¹å…¶ä»– 2-Stage ç½‘ç»œæ¥è®²æ›´å°‘ï¼Œä¸çŸ¥é“è¿™ç§ center-based æ€æƒ³æœ‰æœºä¼šèƒ½å¦è¿ç”¨åˆ°æ›´å¹¿æ³›çš„åœ°æ–¹</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Point Cloud </tag>
            
            <tag> CenterPoint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D2L 01 å‰è¨€</title>
      <link href="/archives/786d359c.html"/>
      <url>/archives/786d359c.html</url>
      
        <content type="html"><![CDATA[<h1 id="Dive-into-deep-learning"><a href="#Dive-into-deep-learning" class="headerlink" title="Dive into deep learning"></a>Dive into deep learning</h1><p>ä¸­æ–‡æ•™æï¼ˆç¬¬äºŒç‰ˆï¼‰<a href="https://zh-v2.d2l.ai/">https://zh-v2.d2l.ai/</a> </p><p>è‹±æ–‡æ•™æï¼š<a href="https://d2l.ai/">https://d2l.ai/</a> </p><p>ä¸­æ–‡æ•™æåªæœ‰éƒ¨åˆ†å†…å®¹ï¼Œæˆ‘é€‰æ‹©å…ˆä»ä¸­æ–‡å¼€å§‹çœ‹å‡å°‘ä¸€äº›éš¾åº¦ï¼Œæ²¡æœ‰çš„ç« èŠ‚å†å»çœ‹è‹±æ–‡éƒ¨åˆ†ã€‚è¯·å…ˆé˜…è¯» <a href="http://zh-v2.d2l.ai/chapter_installation/index.html">å®‰è£…</a> <a href="http://zh-v2.d2l.ai/chapter_notation/index.html">ç¬¦å·</a> ä¸¤ä¸ªç« èŠ‚ï¼Œé‡Œé¢åŒ…å«äº†å¦‚ä½•ä¸‹è½½è¯¥ä¹¦çš„ notebook ä»¥åŠè®²è§£äº†è¯¥ä¹¦ä½¿ç”¨çš„æ•°å­¦ç¬¦å·</p><h1 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h1><h2 id="å…³é”®ç»„ä»¶"><a href="#å…³é”®ç»„ä»¶" class="headerlink" title="å…³é”®ç»„ä»¶"></a>å…³é”®ç»„ä»¶</h2><h3 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h3><ol><li>æ•°æ®çš„åˆ†å¸ƒï¼Œä¸€èˆ¬å‡è®¾ä¸ºç‹¬ç«‹åŒåˆ†å¸ƒã€‚æ‰€ä»¥å½“åˆ†å¸ƒå‡ºç°åå·®ï¼Œæ¨¡å‹ä¹Ÿä¼šç›¸åº”åœ°è¢«å½±å“</li><li>æ•°æ®çš„ç»´æ•°ï¼Œæ¯ä¸€ä¸ªæ ·æœ¬éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªå›ºå®šç»´æ•°çš„æ ·æœ¬ï¼Œä¾‹å¦‚æ¯ä¸ªæ ·æœ¬ä¸ºä¸€ä¸ªä¸‰ç»´å‘é‡ï¼Œè®°å½•äººçš„èº«é«˜ã€ä½“é‡ã€æ€§åˆ«ã€‚ä¹Ÿå¯ä»¥ä¸ä¸€æ ·ï¼Œä¾‹å¦‚æ ·æœ¬ä¸ºå›¾ç‰‡æ—¶ï¼Œæ•°æ®ä¸ºä¸‰ç»´å¼ é‡ (width, height, 3)ï¼Œç»´åº¦çš„å…·ä½“åˆ†é‡ç”±å…¶é•¿å®½å†³å®šã€‚æ³¨æ„è¿™é‡Œè¦åŒºåˆ†ä¸€ä¸‹ï¼Œå‘é‡çš„ç»´åº¦å’Œå¼ é‡çš„ç»´åº¦ä¸æ˜¯åŒä¸€ä¸ªå®šä¹‰</li><li>æ•°æ®çš„æ ‡ç­¾ï¼Œéœ€è¦æœ‰æ­£ç¡®çš„æ•°æ®æ¥å¼•å¯¼æ¨¡å‹çš„å­¦ä¹ </li></ol><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>ç›´æ¥å¼•ç”¨åŸæ–‡</p><blockquote><p><strong>å¤§å¤šæ•°æœºå™¨å­¦ä¹ ä¼šæ¶‰åŠåˆ°æ•°æ®çš„è½¬æ¢ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬å»ºç«‹ä¸€ä¸ªâ€œæ‘„å–ç…§ç‰‡å¹¶é¢„æµ‹ç¬‘è„¸â€çš„ç³»ç»Ÿã€‚å†æ¯”å¦‚ï¼Œæˆ‘ä»¬æ‘„å–ä¸€ç»„ä¼ æ„Ÿå™¨è¯»æ•°ï¼Œå¹¶é¢„æµ‹è¯»æ•°çš„æ­£å¸¸ä¸å¼‚å¸¸ç¨‹åº¦ã€‚ è™½ç„¶ç®€å•çš„æ¨¡å‹èƒ½å¤Ÿè§£å†³å¦‚ä¸Šç®€å•çš„é—®é¢˜ï¼Œä½†æœ¬ä¹¦ä¸­å…³æ³¨çš„é—®é¢˜è¶…å‡ºäº†ç»å…¸æ–¹æ³•çš„æé™ã€‚ æ·±åº¦å­¦ä¹ ä¸ç»å…¸æ–¹æ³•çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼šå‰è€…å…³æ³¨çš„åŠŸèƒ½å¼ºå¤§çš„æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹ç”±ç¥ç»ç½‘ç»œé”™ç»¼å¤æ‚çš„äº¤ç»‡åœ¨ä¸€èµ·ï¼ŒåŒ…å«å±‚å±‚æ•°æ®è½¬æ¢ï¼Œå› æ­¤è¢«ç§°ä¸º<em>æ·±åº¦å­¦ä¹ </em>ï¼ˆdeep learningï¼‰ã€‚ åœ¨è®¨è®ºæ·±åº¦æ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå°†æåŠä¸€äº›ä¼ ç»Ÿæ–¹æ³•ã€‚</strong></p></blockquote><h3 id="ç›®æ ‡å‡½æ•°"><a href="#ç›®æ ‡å‡½æ•°" class="headerlink" title="ç›®æ ‡å‡½æ•°"></a>ç›®æ ‡å‡½æ•°</h3><p>åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ¨¡å‹çš„ä¼˜åŠ£ç¨‹åº¦çš„åº¦é‡ï¼Œè¿™ä¸ªåº¦é‡åœ¨å¤§å¤šæ•°æƒ…å†µæ˜¯â€œå¯ä¼˜åŒ–â€çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<em>ç›®æ ‡å‡½æ•°</em>ï¼ˆobjective functionï¼‰ã€‚ æˆ‘ä»¬é€šå¸¸å®šä¹‰ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼Œå¹¶å¸Œæœ›ä¼˜åŒ–å®ƒåˆ°æœ€ä½ç‚¹ã€‚å› ä¸ºè¶Šä½è¶Šå¥½ï¼Œæ‰€ä»¥è¿™äº›å‡½æ•°æœ‰æ—¶è¢«ç§°ä¸º<em>æŸå¤±å‡½æ•°</em>ï¼ˆloss function, æˆ–cost functionï¼‰</p><h3 id="ä¼˜åŒ–ç®—æ³•"><a href="#ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ä¼˜åŒ–ç®—æ³•"></a>ä¼˜åŒ–ç®—æ³•</h3><p>æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¤§å¤šæµè¡Œçš„ä¼˜åŒ–ç®—æ³•é€šå¸¸åŸºäºä¸€ç§åŸºæœ¬æ–¹æ³•â€“<em>æ¢¯åº¦ä¸‹é™</em>ï¼ˆgradient descentï¼‰</p><h2 id="å„ç§æœºå™¨å­¦ä¹ é—®é¢˜"><a href="#å„ç§æœºå™¨å­¦ä¹ é—®é¢˜" class="headerlink" title="å„ç§æœºå™¨å­¦ä¹ é—®é¢˜"></a>å„ç§æœºå™¨å­¦ä¹ é—®é¢˜</h2><h3 id="ç›‘ç£å­¦ä¹ "><a href="#ç›‘ç£å­¦ä¹ " class="headerlink" title="ç›‘ç£å­¦ä¹ "></a>ç›‘ç£å­¦ä¹ </h3><p>ç›‘ç£å­¦ä¹ å°±æ¯”è¾ƒç»å…¸äº†ï¼Œæœ‰å›å½’é—®é¢˜ã€åˆ†ç±»é—®é¢˜ã€æ ‡è®°é—®é¢˜ã€æœç´¢é—®é¢˜ã€æ¨èç³»ç»Ÿã€åºåˆ—å­¦ä¹ ã€‚å‰ä¸¤ä¸ªé—®é¢˜æ¯”è¾ƒå¸¸è§äº†ï¼Œæä¸€ä¸‹åé¢å‡ ä¸ª</p><ol><li>æ ‡è®°é—®é¢˜ï¼Œå¯ä»¥æ˜¯ç›®æ ‡æ£€æµ‹ç›¸å…³ï¼Œä¹Ÿå¯ä»¥æ˜¯æè¿°æ ·æœ¬ (image captioning) ç›¸å…³</li><li>æœç´¢é—®é¢˜ï¼Œä¸€å¤§åº”ç”¨å³ä¸ºæœç´¢å¼•æ“ï¼Œåœ¨æµ·é‡æ•°æ®åº“ä¸­æ‰¾åˆ°ä¸æœç´¢å†…å®¹æœ€åŒ¹é…çš„é€‰é¡¹</li><li>æ¨èç³»ç»Ÿï¼Œæ ¹æ®ç”¨æˆ·å–œå¥½å¯¹ç”¨æˆ·è¿›è¡Œä¸ªæ€§åŒ–æ¨è</li><li>åºåˆ—å­¦ä¹ ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯å¯å˜é•¿åº¦çš„åºåˆ—ï¼Œå¯åº”ç”¨äºæœºå™¨ç¿»è¯‘ã€æ–‡æœ¬è¯­éŸ³è½¬æ¢ç­‰</li></ol><h3 id="æ— ç›‘ç£å­¦ä¹ "><a href="#æ— ç›‘ç£å­¦ä¹ " class="headerlink" title="æ— ç›‘ç£å­¦ä¹ "></a>æ— ç›‘ç£å­¦ä¹ </h3><p>åªæœ‰æ ·æœ¬ï¼Œæ²¡æœ‰æ ‡ç­¾ï¼Œæ„åœ¨å­¦ä¹ æ•°æ®ä¹‹é—´çš„å†…éƒ¨å…³ç³»ã€‚èšç±»ã€ä¸»æˆåˆ†åˆ†æã€å› æœå…³ç³»å’Œæ¦‚ç‡å›¾æ¨¡å‹ã€ç”Ÿæˆå¯¹æŠ—ç½‘ç»œéƒ½æ˜¯æ— ç›‘ç£å­¦ä¹ çš„ä¾‹å­ï¼Œå…¶ä¸­ç”Ÿæˆå¯¹æŠ—ç½‘ç»œæ˜¯ç°åœ¨æ·±åº¦å­¦ä¹ ä¸­éå¸¸é‡è¦å’Œæ´»è·ƒçš„é¢†åŸŸ</p><h3 id="å¼ºåŒ–å­¦ä¹ "><a href="#å¼ºåŒ–å­¦ä¹ " class="headerlink" title="å¼ºåŒ–å­¦ä¹ "></a>å¼ºåŒ–å­¦ä¹ </h3><p>å¼ºåŒ–å­¦ä¹ åˆæ˜¯å¦ä¸€ä¸ªåºå¤§çš„æ¡†æ¶ï¼Œè€Œä¸”ååˆ†å¼ºå¤§ï¼Œå¼ºåŒ–å­¦ä¹ çš„ç›®æ ‡æ˜¯äº§ç”Ÿä¸€ä¸ªç­–ç•¥ï¼Œè®©ç­–ç•¥çš„å¥–åŠ±è¾¾åˆ°æœ€å¤§ã€‚æ·±åº¦å¼ºåŒ–å­¦ä¹ å°†æ·±åº¦å­¦ä¹ åº”ç”¨äºå¼ºåŒ–å­¦ä¹ é—®é¢˜ï¼Œä¹Ÿæ˜¯éå¸¸çƒ­é—¨çš„ç ”ç©¶æ–¹å‘</p><h2 id="æ·±åº¦å­¦ä¹ å‘å±•ä¹‹è·¯"><a href="#æ·±åº¦å­¦ä¹ å‘å±•ä¹‹è·¯" class="headerlink" title="æ·±åº¦å­¦ä¹ å‘å±•ä¹‹è·¯"></a>æ·±åº¦å­¦ä¹ å‘å±•ä¹‹è·¯</h2><ol><li>ç®—åŠ›çš„å‘å±•å’Œæ•°æ®é›†çš„å‘å±•æ˜¯æ·±åº¦å­¦ä¹ çˆ†å‘çš„åŸºç¡€ã€‚ä¸”ç”±äºè¿™ä¸¤è€…çš„é™åˆ¶ï¼Œè®¸å¤šä¼˜ç§€çš„ç®—æ³•å’Œæ¨¡å‹å…¶å®åœ¨å¾ˆæ—©çš„æ—¶å€™å°±è¢«æå‡ºï¼Œå¦‚å¤šå±‚æ„ŸçŸ¥æœºã€å·ç§¯ç½‘ç»œï¼Œä½†æ— æ³•æ–½å±•æ›´å¼ºå¤§çš„å¨åŠ›</li><li>åˆ—ä¸¾éƒ¨åˆ†æœ€è¿‘åå¹´ä¸­çš„äº‹ä»¶ï¼Œå¸®åŠ©æ·±åº¦å­¦ä¹ å–å¾—å·¨å¤§æˆå°±ï¼š</li></ol><ul><li>æ–°çš„å®¹é‡æ§åˆ¶æ–¹æ³•ï¼Œå¦‚ dropoutï¼Œæœ‰åŠ©äºå‡è½»è¿‡æ‹Ÿåˆ</li><li>æå‡ºæ³¨æ„åŠ›æœºåˆ¶</li><li>ç”Ÿæˆå¯¹æŠ—ç½‘ç»œçš„å‘æ˜</li><li>æ„å»ºå¹¶è¡Œå¼å’Œåˆ†å¸ƒå¼è®­ç»ƒç®—æ³•</li><li>å¼€æºçš„æ·±åº¦å­¦ä¹ æ¡†æ¶</li></ul><h2 id="æ·±åº¦å­¦ä¹ ç‰¹ç‚¹"><a href="#æ·±åº¦å­¦ä¹ ç‰¹ç‚¹" class="headerlink" title="æ·±åº¦å­¦ä¹ ç‰¹ç‚¹"></a>æ·±åº¦å­¦ä¹ ç‰¹ç‚¹</h2><ol><li><p><strong>æ·±åº¦å­¦ä¹ æ˜¯â€œæ·±åº¦â€çš„ï¼Œæ¨¡å‹å­¦ä¹ è®¸å¤šè½¬æ¢çš„â€œå±‚â€ï¼Œæ¯ä¸€å±‚æä¾›ä¸€ä¸ªå±‚æ¬¡çš„è¡¨ç¤º</strong>ã€‚ ä¾‹å¦‚ï¼Œé è¿‘è¾“å…¥çš„å±‚å¯ä»¥è¡¨ç¤ºæ•°æ®çš„ä½çº§ç»†èŠ‚ï¼Œè€Œæ¥è¿‘åˆ†ç±»è¾“å‡ºçš„å±‚å¯ä»¥è¡¨ç¤ºç”¨äºåŒºåˆ†çš„æ›´æŠ½è±¡çš„æ¦‚å¿µã€‚ ç”±äºè¡¨ç¤ºå­¦ä¹ çš„ç›®çš„æ˜¯å¯»æ‰¾è¡¨ç¤ºæœ¬èº«ï¼Œå› æ­¤æ·±åº¦å­¦ä¹ å¯ä»¥ç§°ä¸ºâ€œå¤šçº§è¡¨ç¤ºå­¦ä¹ â€</p></li><li><p>æ¯‹åº¸ç½®ç–‘ï¼Œæ·±åº¦å­¦ä¹ æ–¹æ³•ä¸­æœ€æ˜¾è‘—çš„å…±åŒç‚¹æ˜¯ä½¿ç”¨<strong>ç«¯åˆ°ç«¯è®­ç»ƒ</strong>ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…¶åŸºäºå•ç‹¬è°ƒæ•´çš„ç»„ä»¶ç»„è£…ç³»ç»Ÿï¼Œä¸å¦‚æ„å»ºç³»ç»Ÿï¼Œç„¶åè”åˆè°ƒæ•´å®ƒä»¬çš„æ€§èƒ½ã€‚ ä¾‹å¦‚ï¼Œåœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œç§‘å­¦å®¶ä»¬ä¹ æƒ¯äºå°†ç‰¹å¾å·¥ç¨‹çš„è¿‡ç¨‹ä¸å»ºç«‹æœºå™¨å­¦ä¹ æ¨¡å‹çš„è¿‡ç¨‹åˆ†å¼€ã€‚ Cannyè¾¹ç¼˜æ£€æµ‹å™¨ <a href="https://zh-v2.d2l.ai/chapter_references/zreferences.html#canny-1987">[Canny, 1987]</a> å’ŒSIFTç‰¹å¾æå–å™¨ <a href="https://zh-v2.d2l.ai/chapter_references/zreferences.html#lowe-2004">[Lowe, 2004]</a> ä½œä¸ºå°†å›¾åƒæ˜ å°„åˆ°ç‰¹å¾å‘é‡çš„ç®—æ³•ï¼Œåœ¨è¿‡å»çš„åå¹´é‡Œå æ®äº†è‡³é«˜æ— ä¸Šçš„åœ°ä½ã€‚ åœ¨è¿‡å»çš„æ—¥å­é‡Œï¼Œå°†æœºå™¨å­¦ä¹ åº”ç”¨äºè¿™äº›é—®é¢˜çš„å…³é”®éƒ¨åˆ†æ˜¯æå‡ºäººå·¥è®¾è®¡çš„ç‰¹å¾å·¥ç¨‹æ–¹æ³•ï¼Œå°†æ•°æ®è½¬æ¢ä¸ºæŸç§é€‚åˆäºæµ…å±‚æ¨¡å‹çš„å½¢å¼ã€‚ ç„¶è€Œï¼Œä¸ä¸€ä¸ªç®—æ³•è‡ªåŠ¨æ‰§è¡Œçš„æ•°ç™¾ä¸‡ä¸ªé€‰æ‹©ç›¸æ¯”ï¼Œäººç±»é€šè¿‡ç‰¹å¾å·¥ç¨‹æ‰€èƒ½å®Œæˆçš„äº‹æƒ…å¾ˆå°‘ã€‚ å½“æ·±åº¦å­¦ä¹ å¼€å§‹æ—¶ï¼Œ<strong>è¿™äº›ç‰¹å¾æŠ½å–å™¨è¢«è‡ªåŠ¨è°ƒæ•´çš„æ»¤æ³¢å™¨æ‰€å–ä»£ï¼Œäº§ç”Ÿäº†æ›´é«˜çš„ç²¾ç¡®åº¦</strong></p></li><li><p>æ­¤å¤–ï¼Œé€šè¿‡å–ä»£å¤§éƒ¨åˆ†ç‰¹å®šé¢†åŸŸçš„é¢„å¤„ç†ï¼Œæ·±åº¦å­¦ä¹ æ¶ˆé™¤äº†ä»¥å‰åˆ†éš”è®¡ç®—æœºè§†è§‰ã€è¯­éŸ³è¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€åŒ»å­¦ä¿¡æ¯å­¦å’Œå…¶ä»–åº”ç”¨é¢†åŸŸçš„è®¸å¤šç•Œé™ï¼Œ<strong>ä¸ºè§£å†³å„ç§é—®é¢˜æä¾›äº†ä¸€å¥—ç»Ÿä¸€çš„å·¥å…·</strong></p></li><li><p><strong>é™¤äº†ç«¯åˆ°ç«¯çš„è®­ç»ƒï¼Œæˆ‘ä»¬æ­£åœ¨ç»å†ä»å‚æ•°ç»Ÿè®¡æè¿°åˆ°å®Œå…¨éå‚æ•°æ¨¡å‹çš„è½¬å˜ã€‚</strong> å½“æ•°æ®ç¨€ç¼ºæ—¶ï¼Œäººä»¬éœ€è¦ä¾é ç®€åŒ–å¯¹ç°å®çš„å‡è®¾æ¥è·å¾—æœ‰ç”¨çš„æ¨¡å‹ã€‚ å½“æ•°æ®ä¸°å¯Œæ—¶ï¼Œå¯ä»¥ç”¨æ›´å‡†ç¡®åœ°æ‹Ÿåˆå®é™…æƒ…å†µçš„éå‚æ•°æ¨¡å‹æ¥ä»£æ›¿ã€‚ åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œè¿™åæ˜ äº†ç‰©ç†å­¦åœ¨ä¸Šä¸ªä¸–çºªä¸­å¶éšç€è®¡ç®—æœºçš„å‡ºç°æ‰€ç»å†çš„è¿›æ­¥ã€‚ ç°åœ¨äººä»¬å¯ä»¥å€ŸåŠ©äºç›¸å…³åå¾®åˆ†æ–¹ç¨‹çš„æ•°å€¼æ¨¡æ‹Ÿï¼Œè€Œä¸æ˜¯ç”¨æ‰‹æ¥æ±‚è§£ç”µå­è¡Œä¸ºçš„å‚æ•°è¿‘ä¼¼ã€‚<strong>è¿™å¯¼è‡´äº†æ›´ç²¾ç¡®çš„æ¨¡å‹ï¼Œå°½ç®¡å¸¸å¸¸ä»¥ç‰ºç‰²å¯è§£é‡Šæ€§ä¸ºä»£ä»·</strong></p></li><li><p><strong>ä¸ä»¥å‰å·¥ä½œçš„å¦ä¸€ä¸ªä¸åŒä¹‹å¤„æ˜¯æ¥å—æ¬¡ä¼˜è§£ï¼Œå¤„ç†éå‡¸éçº¿æ€§ä¼˜åŒ–é—®é¢˜ï¼Œå¹¶ä¸”æ„¿æ„åœ¨è¯æ˜ä¹‹å‰å°è¯•</strong>ã€‚ è¿™ç§åœ¨å¤„ç†ç»Ÿè®¡é—®é¢˜ä¸Šæ–°å‘ç°çš„ç»éªŒä¸»ä¹‰ï¼ŒåŠ ä¸Šäººæ‰çš„è¿…é€Ÿæ¶Œå…¥ï¼Œå¯¼è‡´äº†å®ç”¨ç®—æ³•çš„å¿«é€Ÿè¿›æ­¥ã€‚ å°½ç®¡åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä»¥ä¿®æ”¹å’Œé‡æ–°å‘æ˜å­˜åœ¨äº†æ•°åå¹´çš„å·¥å…·ä¸ºä»£ä»·çš„ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> Dive into deep learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dive into deep learning </tag>
            
            <tag> æ·±åº¦å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Numpy Cheat Sheet</title>
      <link href="/archives/19c6ccbf.html"/>
      <url>/archives/19c6ccbf.html</url>
      
        <content type="html"><![CDATA[<h1 id="Numpy-Cheat-Sheet"><a href="#Numpy-Cheat-Sheet" class="headerlink" title="Numpy Cheat Sheet"></a>Numpy Cheat Sheet</h1><h2 id="Basics-åŸºç¡€"><a href="#Basics-åŸºç¡€" class="headerlink" title="Basics åŸºç¡€"></a>Basics åŸºç¡€</h2><h3 id="ç®€å•åˆ›å»º"><a href="#ç®€å•åˆ›å»º" class="headerlink" title="ç®€å•åˆ›å»º"></a>ç®€å•åˆ›å»º</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">,</span> step<span class="token punctuation">)</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Placeholders-åˆ›å»º"><a href="#Placeholders-åˆ›å»º" class="headerlink" title="Placeholders åˆ›å»º"></a>Placeholders åˆ›å»º</h3><p>åŒ…æ‹¬åˆ›å»º linespace, zeros, ones, random, empty æ•°ç»„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>linespace<span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">,</span> num<span class="token punctuation">)</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token comment"># 0-1 uniform</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token operator">*</span>dimensions<span class="token punctuation">)</span><span class="token comment"># normal/gaussian</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>low<span class="token punctuation">,</span> high<span class="token punctuation">,</span> shape<span class="token punctuation">)</span><span class="token comment"># high is exclusive</span>np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Array-æ•°ç»„"><a href="#Array-æ•°ç»„" class="headerlink" title="Array æ•°ç»„"></a>Array æ•°ç»„</h2><h3 id="Array-Properties-å±æ€§"><a href="#Array-Properties-å±æ€§" class="headerlink" title="Array Properties å±æ€§"></a>Array Properties å±æ€§</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">array<span class="token punctuation">.</span>shapearray<span class="token punctuation">.</span>ndim<span class="token comment"># dimensions of array</span>array<span class="token punctuation">.</span>sizearray<span class="token punctuation">.</span>dtypearray<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token comment"># convert data type</span><span class="token builtin">len</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token builtin">type</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Copy-å¤åˆ¶"><a href="#Copy-å¤åˆ¶" class="headerlink" title="Copy å¤åˆ¶"></a>Copy å¤åˆ¶</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>array<span class="token punctuation">)</span>other <span class="token operator">=</span> array<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Sort-æ’åº"><a href="#Sort-æ’åº" class="headerlink" title="Sort æ’åº"></a>Sort æ’åº</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">array<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>array<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Array-Operations-æ•°ç»„æ“ä½œ"><a href="#Array-Operations-æ•°ç»„æ“ä½œ" class="headerlink" title="Array Operations æ•°ç»„æ“ä½œ"></a>Array Operations æ•°ç»„æ“ä½œ</h2><h3 id="Adding-amp-removing"><a href="#Adding-amp-removing" class="headerlink" title="Adding &amp; removing"></a>Adding &amp; removing</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>np<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># not common</span>np<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># not common</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="Combining"><a href="#Combining" class="headerlink" title="Combining"></a>Combining</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span>arrays<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>arrays<span class="token punctuation">)</span>np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span>arrays<span class="token punctuation">)</span>np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>arrays<span class="token punctuation">,</span> axis<span class="token punctuation">)</span><span class="token comment"># This will create a new axis</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Shaping"><a href="#Shaping" class="headerlink" title="Shaping"></a>Shaping</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">array<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>shape<span class="token punctuation">)</span>array<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>array<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># equals array.T</span>array<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>axes<span class="token punctuation">)</span><span class="token comment"># permute axes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Math-æ•°å­¦"><a href="#Math-æ•°å­¦" class="headerlink" title="Math æ•°å­¦"></a>Math æ•°å­¦</h2><h3 id="Operations-åŸºç¡€è¿ç®—"><a href="#Operations-åŸºç¡€è¿ç®—" class="headerlink" title="Operations åŸºç¡€è¿ç®—"></a>Operations åŸºç¡€è¿ç®—</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># basic</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># equals x @ y</span>np<span class="token punctuation">.</span>dop<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># dot product of 1D array</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token comment"># x1 &amp; x2 have the same shape or x2 can broadcast</span>np<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># preprocess</span>np<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span>isinf<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> ndigits<span class="token punctuation">)</span>np<span class="token punctuation">.</span>nan_to_num<span class="token punctuation">(</span>x<span class="token punctuation">,</span> nan<span class="token punctuation">)</span><span class="token comment"># Replace NaN with zero and infinity with large finite numbers (default behaviour) or with the numbers defined by the user using the nan, posinf and/or neginf keywords.</span>np<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span><span class="token comment"># test whether all be true along a axis</span>np<span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span><span class="token comment"># compare</span>np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># Element-wise maximum of array elements.</span>np<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token comment"># cumulative</span>np<span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span><span class="token comment"># cumulative sum, if axis=None, flatten x</span>np<span class="token punctuation">.</span>diff<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span><span class="token comment"># differences</span>np<span class="token punctuation">.</span>prod<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span><span class="token comment"># product along given axis</span><span class="token comment"># arg-relative</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>np<span class="token punctuation">.</span>bincount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># Count number of occurrences of each value in array of non-negative ints.</span><span class="token comment"># linear algebra</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>det<span class="token punctuation">(</span>x<span class="token punctuation">)</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># Statistics</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>x<span class="token punctuation">,</span> axis<span class="token punctuation">)</span>np<span class="token punctuation">.</span>corrcoef<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Slicing-åˆ‡ç‰‡"><a href="#Slicing-åˆ‡ç‰‡" class="headerlink" title="Slicing åˆ‡ç‰‡"></a>Slicing åˆ‡ç‰‡</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># n dimensions</span>array<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token comment"># upper bound is exclusive</span>array<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token comment"># reverse slicing</span>array<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment"># step is 2</span><span class="token comment"># bool</span>array<span class="token punctuation">[</span>array <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">]</span>array<span class="token punctuation">[</span><span class="token punctuation">(</span>array<span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>array<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment"># Fancy indexing</span>array<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment"># could be any iterable int array</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Broadcast-å¹¿æ’­"><a href="#Broadcast-å¹¿æ’­" class="headerlink" title="Broadcast å¹¿æ’­"></a>Broadcast å¹¿æ’­</h2><p>å¹¿æ’­æ•°ç»„ç»´åº¦éœ€è¦æ»¡è¶³ä»¥ä¸‹è¦æ±‚ä»»æ„ä¸€ä¸ªï¼š</p><ol><li><p>ä»åå¾€å‰æ¯”ï¼Œä¸¤ä¸ªæ•°ç»„å„ä¸ªç»´åº¦å¤§å°ç›¸åŒ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">A <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>B <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>C <span class="token operator">=</span> A <span class="token operator">+</span> B<span class="token comment"># B will broadcast to (2, 3, 4, 5)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸¤ä¸ªæ•°ç»„å­˜åœ¨ç»´åº¦å¤§å°ä¸ç›¸ç­‰æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªä¸ç›¸ç­‰ç»´åº¦å¤§å°ä¸º1</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">A <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>B <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>C <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>D <span class="token operator">=</span> A <span class="token operator">+</span> B <span class="token operator">+</span> A <span class="token operator">*</span> C<span class="token comment"># B &amp; C will broadcast to (2, 3, 4, 5)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="å­˜å‚¨ä¸º-bin"><a href="#å­˜å‚¨ä¸º-bin" class="headerlink" title="å­˜å‚¨ä¸º .bin"></a>å­˜å‚¨ä¸º .bin</h2><p>ä½¿ç”¨ <code>tofile &amp; fromfile</code> å°† ndarray å­˜å‚¨ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Pathbin_file <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'./xxx.bin'</span><span class="token punctuation">)</span>a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>binfile<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    a<span class="token punctuation">.</span>tofile<span class="token punctuation">(</span>f<span class="token punctuation">)</span>b <span class="token operator">=</span> np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>binfile<span class="token punctuation">,</span> dtype<span class="token operator">=</span>a<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Package </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Numpy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PV-RCNN</title>
      <link href="/archives/b179cc3a.html"/>
      <url>/archives/b179cc3a.html</url>
      
        <content type="html"><![CDATA[<h1 id="PV-RCNN"><a href="#PV-RCNN" class="headerlink" title="PV-RCNN"></a>PV-RCNN</h1><hr><p>Shi, Shaoshuai, Chaoxu Guo, Li Jiang, Zhe Wang, Jianping Shi, Xiaogang Wang, and Hongsheng Li. â€œPV-RCNN: Point-Voxel Feature Set Abstraction for 3D Object Detection.â€ <em>ArXiv:1912.13192 [Cs, Eess]</em>, April 9, 2021. <a href="http://arxiv.org/abs/1912.13192">http://arxiv.org/abs/1912.13192</a>.</p><p>Comment: Accepted by CVPR 2020. arXiv admin note: substantial text overlap with arXiv:2102.00463</p><hr><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>å¤§å¤šæ•°ç°æœ‰çš„ 3D æ£€æµ‹æ–¹æ³•åœ¨ç‚¹äº‘è¡¨ç¤ºæ–¹é¢å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><ol><li>åŸºäºä½“ç´ åŒ–çš„è¡¨ç¤ºï¼Œthe grid-based methods (e.g. VoxelNet)</li><li>åŸºäºç‚¹çš„è¡¨ç¤ºï¼Œthe point-based methods (e.g. Point R-CNN)</li></ol><p>è¿™ä¸¤ç§æ–¹æ³•å„æœ‰ä¼˜ç¼ºç‚¹ï¼š</p><ol><li>åŸºäºä½“ç´ åŒ–çš„æ“ä½œæœ‰æ•ˆåœ°ç¼–ç å¤šå°ºåº¦ç‰¹å¾ multi-scale feature representationsï¼Œå¹¶å¯ä»¥ç”Ÿæˆé«˜è´¨é‡çš„ 3D proposals</li><li>åŸºäº PointNet çš„ set abstraction æ“ä½œï¼Œä¿ç•™äº†æ›´å‡†ç¡®çš„ä½ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥æœ‰æ›´åŠ çµæ´»çš„æ„Ÿå—é‡</li></ol><p>è€Œ PV-RCNN å°±æ˜¯å—è¿™ä¸¤ç±»è¡¨ç¤ºçš„å¯å‘ï¼Œå°†è¿™ä¸¤ç±»æ–¹æ³•æœ‰æ•ˆç»“åˆèµ·æ¥ï¼Œä½¿å¾—ç‚¹äº‘ç‰¹å¾æ—¢æœ‰ä½“ç´ åŒ–çš„å¤šå°ºåº¦ä¿¡æ¯ï¼Œåˆå¢åŠ äº† set abstraction çš„ç²¾å‡†åº¦ä¸çµæ´»åº¦</p><p>è®ºæ–‡æ€»ç»“äº†4ä¸ªè´¡çŒ®ç‚¹ï¼š</p><ol><li>ç»“åˆäº†ä¸¤ç§ç‚¹äº‘è¡¨ç¤ºçš„ä¼˜ç‚¹ï¼šåŸºäºä½“ç´ çš„è¡¨ç¤ºå’ŒåŸºäºç‚¹çš„è¡¨ç¤º</li><li>æå‡ºäº† <strong>voxel-to-keypoint scene encoding scheme</strong>ï¼Œå°†ä½“ç´ ç±»çš„ç‰¹å¾ç¼–ç è½¬åŒ–ä¸ºç‚¹äº‘ç±»ç‰¹å¾</li><li><p>æå‡ºäº† <strong>multi-scale RoI feature abstraction layer</strong>ï¼Œå°† RoI ä¸­çš„ç‚¹äº‘ç‰¹å¾ç¼–ç è½¬åŒ–ä¸ºæ …æ ¼ç‚¹ç‰¹å¾ RoI-grid pooling via set abstraction</p></li><li><p>PV-RCNN ä»¥æ˜¾è‘—çš„ä¼˜åŠ¿åœ¨å½“æ—¶çš„ KITTI &amp; Waymo æ¦œå•ä¸Šæ’åç¬¬ä¸€</p></li></ol><p>ä¸­é—´ä¸¤ç‚¹æå¾—æ¯”è¾ƒç¬¼ç»Ÿï¼Œéœ€è¦å…·ä½“çœ‹çœ‹ PV-RCNN çš„ç»“æ„æ‰èƒ½æœ‰ä¸€ä¸ªå½¢è±¡çš„äº†è§£</p><h2 id="PV-RCNN-Architecture"><a href="#PV-RCNN-Architecture" class="headerlink" title="PV-RCNN Architecture"></a>PV-RCNN Architecture</h2><p><img src="/archives/b179cc3a/ee6744b0-bff5-448b-a317-1557749f9588.png"></p><h3 id="3D-voxel-CNN"><a href="#3D-voxel-CNN" class="headerlink" title="3D voxel CNN"></a>3D voxel CNN</h3><p>é¦–å…ˆå°†è¾“å…¥ç‚¹äº‘ P åˆ’åˆ†ä¸ºç©ºé—´åˆ†è¾¨ç‡ä¸º $L Ã— W Ã— H$ çš„å°ä½“ç´ /æ …æ ¼ï¼Œå…¶ä¸­éç©ºä½“ç´ çš„ç‰¹å¾ç›´æ¥è®¡ç®—ä¸ºæ‰€æœ‰å†…éƒ¨ç‚¹çš„é€ç‚¹ç‰¹å¾çš„å¹³å‡å€¼ã€‚å¸¸ç”¨çš„ç‰¹å¾æ˜¯ 3D åæ ‡ coordinate å’Œåå°„å¼ºåº¦ reflectance intensityã€‚Voxel CNN èƒ½å¤Ÿåœ¨å¤šä¸ªä¸‹é‡‡æ ·åˆ†è¾¨ç‡ä¸‹ (1x, 2x, 4x, 8x) è¿›è¡Œç‰¹å¾æå–ï¼Œå¾—åˆ°ä¸åŒ level çš„ voxel-wise feature vectorsï¼Œè¿™å°±æ˜¯ä½“ç´ åŒ–æ–¹æ³•çš„å¥½å¤„ï¼Œå¯ä»¥ç›´æ¥é‡‡ç”¨æˆç†Ÿçš„å·ç§¯æ–¹æ³•</p><p>ä½†æ˜¯ä½¿ç”¨ voxel CNN ä¹Ÿä¼šæœ‰ä¸€å®šçš„å±€é™æ€§ï¼š</p><ol><li>è¿™äº›ç‰¹å¾é€šå¸¸ä¸ºä½åˆ†è¾¨ç‡çš„ç©ºé—´ç‰¹å¾ï¼ŒæŸå¤±äº†å¤§é‡çš„ç©ºé—´ä¿¡æ¯ï¼Œé˜»ç¢äº†å¯¹è±¡çš„å‡†ç¡®å®šä½</li><li>å³ä½¿é€šè¿‡ä¸Šé‡‡æ · upsample è¿™äº›ç‰¹å¾å›¾è°±éƒ½ä¼šæ˜¯æ¯”è¾ƒç¨€ç–çš„ï¼Œä¼ ç»Ÿçš„æ± åŒ–æ–¹æ³•å¯èƒ½å¾—åˆ°è®¸å¤šé›¶ç‰¹å¾å‘é‡</li></ol><h3 id="Proposal-generation"><a href="#Proposal-generation" class="headerlink" title="Proposal generation"></a>Proposal generation</h3><p>å°†æå–çš„ 3D ç‰¹å¾è½¬æ¢ reshape ä¸º 2D ä¿¯è§†ç‰¹å¾å›¾ bird-view feature mapsï¼ŒæŒ‰ç…§åŸºäºé”š anchor çš„æ–¹æ³•ç”Ÿæˆé«˜è´¨é‡çš„ 3D proposal (e.g. PointPillars)ã€‚è¿™é‡Œå¯ä»¥å°è¯•ä½¿ç”¨å…¶ä»–çš„ç”Ÿæˆç®—æ³•ï¼Œä¾‹å¦‚å°† anchor-based æ¢ä¸º anchor-freeï¼Œæå‡æ•ˆç‡å’Œå‡†ç¡®ç‡</p><h3 id="Voxel-to-keypoint-encoding"><a href="#Voxel-to-keypoint-encoding" class="headerlink" title="Voxel-to-keypoint encoding"></a>Voxel-to-keypoint encoding</h3><p>äº†è§£äº† voxel CNN çš„ä¸€äº›å±€é™æ€§ï¼Œæ˜¯å¦æœ‰æ–¹æ³•å»è¡¥å¿æŸå¤±çš„ç©ºé—´ä¿¡æ¯å‘¢ï¼Ÿè¿™é‡Œè®ºæ–‡å°†æå‡ºä¸€ç§å…¨æ–°çš„ encoding æ–¹æ³• <strong>voxel set abstraction (VSA)</strong>ï¼Œæ¥å°†æ•´ä¸ªåœºæ™¯çš„ç¼–ç ä» voxel-like è½¬æ¢ä¸º point-likeï¼Œå…·ä½“æ¥è¯´ voxel set abstraction ä½¿ç”¨ PointNet++ ç½‘ç»œä¸­çš„ set abstraction æ€æƒ³ï¼Œå°† voxel ç‰¹å¾èšåˆåˆ°åœºæ™¯ä¸­çš„å…³é”®ç‚¹é›† $K$ä¸Šï¼Œè¿™äº›å…³é”®ç‚¹ç”± FurthestPoint-Sampling (FPS) ç®—æ³•é‡‡æ ·å¾—å‡ºã€‚è¿™ä¸€æ“ä½œæˆ‘è®¤ä¸ºæ˜¯æ•´ä¸ªè®ºæ–‡é‡Œæœ€å…·åˆ›æ„çš„æ“ä½œï¼Œå°† set abstraction çš„æ“ä½œè¿›è¡Œäº†æ›´å¹¿çš„æ‹“å±•ï¼Œä»åŸæ¥çš„ point-to-point ç‰¹å¾èšåˆæ“ä½œï¼Œåˆ°è¿™é‡Œä¸º voxel-to-pointã€‚æ›´è¯¦ç»†çš„åŠ¨æœºå¯ä»¥å‚è€ƒåŸä½œè€…åœ¨ <a href="https://zhuanlan.zhihu.com/p/148942116">çŸ¥ä¹</a> ä¸Šçš„å›ç­”</p><p>ç°åœ¨ä»¥æ›´åŠ æ•°å­¦åŒ–çš„è¯­è¨€æ¥è¡¨è¾¾ <strong>voxel set abstraction (VSA)</strong>ã€‚å…³é”®ç‚¹é›†åˆ $K=\{p_1,â€¦,p_n\}$ï¼Œå¯¹äºæ¯ä¸ªå…³é”®ç‚¹ $p_i$ ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ªåŠå¾„ $r_k$ å†…å¯»æ‰¾å…¶ç›¸é‚»çš„éç©ºä½“ç´  $v_j^{(l_k)}$ å…¶å¯¹ç‰¹å¾ä¸º $f_j^{(l_k)}$ï¼Œ$l_k$ ä»£è¡¨çš„æ˜¯åœ¨ voxel CNN é˜¶æ®µä¸­çš„ä¸åŒåˆ†è¾¨ç‡é˜¶æ®µ</p><script type="math/tex; mode=display">S_{i}^{\left(l_{k}\right)}=\left\{\left[f_{j}^{\left(l_{k}\right)} ; v_{j}^{\left(l_{k}\right)}-p_{i}\right]^{T}\middle|\ \ \begin{array}{ll}\left\|v_{j}^{\left(l_{k}\right)}-p_{i}\right\|^{2}<r_{k}, \\\forall v_{j}^{\left(l_{k}\right)} \in \mathcal{V}^{\left(l_{k}\right)} \\\forall f_{j}^{\left(l_{k}\right)} \in \mathcal{F}^{\left(l_{k}\right)}\end{array}\right\}</script><p>ç„¶åä½¿ç”¨ PointNet++ ä¸­çš„ set abstraction æ“ä½œï¼Œå°†è¿™äº›ç‰¹å¾èšåˆä¸ºä¸€ä¸ªç‰¹å¾å‘é‡</p><script type="math/tex; mode=display">f_{i}^{\left(p v_{k}\right)}=\max \left\{G\left(\mathcal{M}\left(S_{i}^{\left(l_{k}\right)}\right)\right)\right\}</script><p>å…¶ä¸­ $M(Â·)$ è¡¨ç¤ºä»ç›¸é‚»é›†åˆ $S^{(l_k)}_i$ ä¸­éšæœºé‡‡æ ·æœ€å¤š $T_k$ ä¸ªä½“ç´ ä»¥èŠ‚çœè®¡ç®—ï¼Œ$G(Â·)$ è¡¨ç¤ºä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥å™¨ç½‘ç»œ MLPï¼ˆåŒºåˆ«äº PoinNet ä¸­çš„ Shared MLPï¼‰ã€‚å°†å¤šä¸ªåŠå¾„çš„ç‰¹å¾å‘é‡è¿æ¥èµ·æ¥å°±èƒ½å¾—åˆ°å¤šå°ºåº¦çš„ç‰¹å¾ï¼Œç±»ä¼¼äº PointNet++ ä¸­çš„ multi-scale grouping (MSG)</p><p>ç°åœ¨å°†ä¸åŒåˆ†è¾¨ç‡çš„ç‰¹å¾è¿æ¥èµ·æ¥ï¼ŒåŸè®ºæ–‡æœ‰4ä¸ªä¸åŒçš„åˆ†è¾¨ç‡</p><script type="math/tex; mode=display">f_{i}^{(p v)}=\left[f_{i}^{\left(p v_{1}\right)}, f_{i}^{\left(p v_{2}\right)}, f_{i}^{\left(p v_{3}\right)}, f_{i}^{\left(p v_{4}\right)}\right], \text { for } i=1, \cdots, n</script><p>å†æ·»åŠ ä¸€äº›ç‰¹å¾ï¼šåŸç‚¹äº‘æ•°æ® raw point feature å’Œå¯¹åº”ç‚¹çš„ä¿¯è§†å›¾ç‰¹å¾ bird-eye view featureï¼Œå¾—åˆ°æœ€ç»ˆçš„æ•´ä¸ªç‚¹äº‘çš„ç‰¹å¾é›†åˆ</p><script type="math/tex; mode=display">f_{i}^{(p)}=\left[f_{i}^{(p v)}, f_{i}^{(r a w)}, f_{i}^{(b e v)}\right], \text { for } i=1, \cdots, n</script><p>å†è¿›è¡Œä¸€äº›æƒé‡è°ƒæ•´ï¼Œæƒé‡ä¾æ®ä¸ºè¯¥ç‚¹æ˜¯å¦ä¸ºå‰æ™¯ç‚¹ï¼Œå¦‚æœä¸ºèƒŒæ™¯ç‚¹åˆ™æƒé‡é™ä½ï¼Œè¿™å°†ç»™æ¨¡å‹å¸¦æ¥æ›´å¥½çš„æ³¨æ„åŠ›æœºåˆ¶ã€‚ä½¿ç”¨å¾—åˆ°çš„ç‚¹äº‘ç‰¹å¾ï¼Œé€å…¥åˆ°ä¸‰å±‚çš„ MLP $A(Â·)$ ä¸­å»é¢„æµ‹è¯¥ç‚¹çš„æƒé‡ï¼Œç„¶åå†ä¸åŸç‰¹å¾ç›¸ä¹˜</p><script type="math/tex; mode=display">\tilde{f}_{i}^{(p)}=\mathcal{A}\left(f_{i}^{(p)}\right) \cdot f_{i}^{(p)}</script><p>è¿™é‡Œçš„æƒé‡è°ƒæ•´æœºåˆ¶è®ºæ–‡ç§°ä¸º <strong>predicted key weighting (PKW)</strong>ï¼Œå…¶å›¾ç¤ºå¦‚ä¸‹</p><p><img src="/archives/b179cc3a/image-20211008181557465.png"></p><h3 id="Keypoint-to-grid-RoI-feature-abstraction"><a href="#Keypoint-to-grid-RoI-feature-abstraction" class="headerlink" title="Keypoint-to-grid RoI feature abstraction"></a>Keypoint-to-grid RoI feature abstraction</h3><p>ç»™å®šæ¯ä¸ª 3D RoI/proposalï¼Œè®ºæ–‡æå‡º RoI-grid poolingï¼Œå°†å…³é”®ç‚¹ç‰¹å¾èšåˆåˆ°å…·æœ‰å¤šä¸ªæ„Ÿå—é‡çš„ RoI-grid ç‚¹ï¼Œç‰¹å¾èšåˆæ–¹æ³•ä¾æ—§ç±»ä¼¼äº PointNet++ MSGï¼Œå›¾ç¤ºå¦‚ä¸‹ï¼Œè“è‰²è™šçº¿æ˜¯æˆ‘è‡ªå·±ç”»çš„ï¼Œæ–¹ä¾¿ä½“ç°å‡º grid</p><p><img src="/archives/b179cc3a/image-20211008183015394.png" style="zoom: 50%;"></p><p>å…¶æ•°å­¦è¡¨è¾¾ä¹Ÿæ˜¯ç±»ä¼¼çš„</p><script type="math/tex; mode=display">\begin{array}{l}\tilde{\Psi}=\left\{\left[\tilde{f}_{j}^{(p)} ; p_{j}-g_{i}\right]^{T} \Biggl|\ \begin{array}{l}\left\|p_{j}-g_{i}\right\|^{2}<\tilde{r}, \\\forall p_{j} \in \mathcal{K}, \forall \tilde{f}_{j}^{(p)} \in \tilde{\mathcal{F}}\end{array}\right\} \\\tilde{f}_{i}^{(g)}=\max \{G(\mathcal{M}(\tilde{\Psi}))\}\end{array}</script><p>ä¸ºä»€ä¹ˆè¿™é‡Œè¿˜è¦å†æ¬¡è¿›è¡Œç¼–ç ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨é€‰æ¡†å†…çš„æ‰€æœ‰ç‚¹è¿›è¡Œèšåˆï¼Œå¾—åˆ°ä¸€ä¸ªå…¨å±€çš„è¡¨è¾¾ï¼Ÿä¸€ä¸ªé‡è¦åŸå› æ˜¯å› ä¸ºä½¿ç”¨ roi pooling èƒ½å¤Ÿå°†ç‰¹å¾èšåˆåˆ°ä¸€ä¸ªå›ºå®šçš„å½¢çŠ¶ï¼Œä¾¿äºä¹‹åè¾“å…¥åˆ° MLPã€‚åŒæ—¶ä¹Ÿå¯èƒ½æ˜¯ä¸ºäº†è·å¾—å¤šå°ºåº¦çš„ç‰¹å¾</p><h3 id="Refinement-and-confidence-prediction"><a href="#Refinement-and-confidence-prediction" class="headerlink" title="Refinement and confidence prediction"></a>Refinement and confidence prediction</h3><p>é‡‡ç”¨2å±‚ MLPï¼Œå»åšç½®ä¿¡åº¦é¢„æµ‹å’Œé€‰æ¡†ç»†åŒ–ä¸¤ä¸ªä»»åŠ¡ã€‚é‡‡ç”¨ 3D RoI/proposal ä¸å…¶å¯¹åº”çš„çœŸå®é€‰æ¡† ground truth ä¹‹é—´çš„ 3D IoU ä½œä¸ºè®­ç»ƒç›®æ ‡ï¼Œå¹¶é‡‡ç”¨äºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°</p><script type="math/tex; mode=display">y_{k}=\min \left(1, \max \left(0,2 \mathrm{IoU}_{k}-0.5\right)\right)\\L_{\mathrm{iou}}=-y_{k} \log \left(\tilde{y}_{k}\right)-\left(1-y_{k}\right) \log \left(1-\tilde{y}_{k}\right)</script><p>è¿™ç§  quality-aware ç½®ä¿¡åº¦é¢„æµ‹ç­–ç•¥æ¯”ä¼ ç»Ÿåˆ†ç±»æ ‡ç­¾å®ç°äº†æ›´å¥½çš„æ€§èƒ½ï¼ˆè¿™ç§æŸå¤±å‡½æ•°æ˜¯å¦è¿˜èƒ½è¿›ä¸€æ­¥æ”¹è¿›å‘¢ï¼Ÿæ¯”å¦‚é€šè¿‡ç®€å•çš„å¹³æ»‘è¿‡æ¸¡æ“ä½œï¼Œä½¿å¾—å­¦ä¹ æ›²çº¿æ›´å¹³ç¼“ï¼‰å¯¹äºç»†åŒ– refinement çš„ç›®æ ‡å’ŒæŸå¤±å‡½æ•°è®ºæ–‡æ²¡æœ‰å®Œæ•´åˆ—å‡ºï¼Œæ•´ä½“æ€æƒ³æ˜¯é¢„æµ‹å…¶æ®‹å·®ï¼Œå¹¶ä½¿ç”¨ smooth-L1 lossï¼Œå…·ä½“è¯·å‚è€ƒ SECOND, Part-A^2</p><script type="math/tex; mode=display">L_{\mathrm{rcnn}}=L_{\mathrm{iou}}+\sum_{\mathrm{r} \in\{x, y, z, l, h, w, \theta\}} \mathcal{L}_{\text {smooth-L1 }}\left(\widehat{\Delta \mathrm{r}^{p}}, \Delta \mathrm{r}^{p}\right)</script><p>åœ¨ voxel CNN é˜¶æ®µï¼Œregion proposal å’Œ classification çš„æŸå¤±å‡½æ•°ä¹Ÿæ²¡æœ‰å®Œæ•´åˆ—å‡ºï¼Œå¦‚ä¸‹</p><script type="math/tex; mode=display">L_{\mathrm{rpn}}=L_{\mathrm{cls}}+\beta \sum_{\mathrm{r} \in\{x, y, z, l, h, w, \theta\}} \mathcal{L}_{\text {smooth-L1 }}\left(\widehat{\Delta \mathrm{r}^{a}}, \Delta \mathrm{r}^{a}\right)</script><p>å…¶ä¸­åˆ†ç±»ä»»åŠ¡å’Œåˆ†å‰²ä»»åŠ¡éƒ½ä½¿ç”¨çš„æ˜¯ focal loss</p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="KITTI"><a href="#KITTI" class="headerlink" title="KITTI"></a>KITTI</h3><p>PV-RCNN åœ¨ KITTI æ•°æ®é›†ä¸Šçš„å‡†ç¡®ç‡å’Œå¬å›ç‡</p><p><img src="/archives/b179cc3a/image-20211008205557923.png"></p><p><img src="/archives/b179cc3a/image-20211008210508478.png" style="zoom:80%;"></p><h3 id="Waymo"><a href="#Waymo" class="headerlink" title="Waymo"></a>Waymo</h3><p><img src="/archives/b179cc3a/image-20211008210829402.png"></p><h3 id="Ablation-study"><a href="#Ablation-study" class="headerlink" title="Ablation study"></a>Ablation study</h3><p><img src="/archives/b179cc3a/image-20211008211127226.png"></p><p>æ¶ˆèå®éªŒé’ˆå¯¹ voxel set abstraction, RoI-grid pooling, PKW, IoU-guided scoreing è¿›è¡Œæ·±å…¥ç ”ç©¶ï¼Œè¿™äº›ç»“æ„èƒ½å°†æœ€ç»ˆè¡¨ç°æå‡ 1-3 mAP</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>PV-RCNN ä¸­çš„ä¸€ä¸ªå·¨å¤§å¯å‘æ˜¯å¯¹äºç‰¹å¾çš„ aggregation ä¸éœ€è¦è¢«æ•°æ®å®é™…çš„å½¢å¼ç»™é™åˆ¶ï¼Œç»“åˆå¤šç§æ•°æ®æå–ç‰¹å¾çš„ä¼˜åŠ¿ï¼Œåˆ›é€ å…¶ä¸­çš„æ¡¥æ¢ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°è¿›è¡Œå±€éƒ¨å’Œå…¨å±€çš„æŠŠæ§ï¼Œåˆå°†ç‚¹äº‘è¡¨ç¤ºå¸¦åˆ°äº†ä¸€ä¸ªæ–°çš„é«˜åº¦ï¼Œå³ä½¿æ¥è¿‘ä¸¤å¹´è¿‡å»äº†ï¼Œè¯¥æ–¹æ³•ä»åœ¨ KITTI æ¦œå•æ’åå‰50ã€‚è¯¥ç½‘ç»œçš„æ¨ç†é€Ÿåº¦åœ¨ 80ms å·¦å³ï¼Œä¾æ—§è¿˜æœ‰æå‡çš„ç©ºé—´ï¼Œé¡¹ç›®å¼€æºåœ¨äº† OpenMMLabï¼Œç°åœ¨ OpenMMLab åˆæå‡ºäº†æ–°çš„ç½‘ç»œ Voxel R-CNNï¼Œæ¨ç†é€Ÿåº¦å‡å°‘äº†ä¸€åŠï¼Œè¾¾åˆ°äº† 40ms å·¦å³ï¼Œè€Œä¸”å‡†ç¡®åº¦ä¹Ÿä¸Šå‡äº†ï¼Œå¯ä»¥è¿›ä¸€æ­¥è¿›è¡Œå­¦ä¹ </p><h2 id="TO-READ"><a href="#TO-READ" class="headerlink" title="TO READ"></a>TO READ</h2><ol><li>SECOND</li><li>Part-A^2</li><li>Voxel R-CNN</li></ol>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Point Cloud </tag>
            
            <tag> PV-RCNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Point-GNN</title>
      <link href="/archives/74da7df7.html"/>
      <url>/archives/74da7df7.html</url>
      
        <content type="html"><![CDATA[<h1 id="Point-GNN-note"><a href="#Point-GNN-note" class="headerlink" title="Point-GNN note"></a>Point-GNN note</h1><p>ç”±äºå¯¹äºGNNæ²¡æœ‰è¿‡å¤šçš„äº†è§£ï¼Œå¹¶ä¸èƒ½æ„Ÿå—åˆ°GNNç›¸å¯¹äºCNNæœ‰æå¤§çš„ä¼˜åŠ¿ã€‚ç›¸åçš„ï¼Œåœ¨å…¶ä¸­è®¾è®¡çš„å¾ˆå¤šç»“æ„ï¼Œä¸ä½¿ç”¨CNNå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œæœ€æ ¸å¿ƒçš„è§‚ç‚¹å°±æ˜¯æ•æ‰åˆ° (multi-scale) local featureï¼Œè¿™ç¯‡ç¬”è®°ä»…æ½¦è‰è®°å½•ä¸€ä¸‹</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>æ„å»ºå›¾çš„æ–¹æ³•ï¼šä»¥ç‚¹ä½œä¸ºå›¾çš„é¡¶ç‚¹ï¼Œå°†æ¯ä¸ªç‚¹å’Œé™„è¿‘çš„ç‚¹ç›¸è¿å½¢æˆè¾¹</p><p>We encode the point cloud natively in a graph by using the points as the graph vertices. The edges of the graph connect neighborhood points that lie within a fixed radius, which allows feature information to flow between neighbors.  </p><p>A graph neural network reuses the graph edges in every layer, and avoids grouping and sampling the points repeatedly.</p><p><strong>å‡ ä¸ªç‰¹ç‚¹</strong>ï¼š</p><ol><li>Use a graph representation can <strong>preserve the irregularity</strong> of a point cloud</li><li>Unlike the techniques that sample and group the points into sets repeatedly, <strong>we construct the graph once</strong>. </li><li>The proposed Point-GNN then extracts features of the point cloud by <strong>iteratively updating vertex features</strong> on the same graph. Our work is a <strong>single-stage detection</strong> method.</li></ol><h2 id="Point-GNN-for-3D-Object-Detection-in-a-Point-Cloud"><a href="#Point-GNN-for-3D-Object-Detection-in-a-Point-Cloud" class="headerlink" title="Point-GNN for 3D Object Detection in a Point Cloud"></a>Point-GNN for 3D Object Detection in a Point Cloud</h2><p>our method contains three components:</p><p>(a) graph construction, </p><p>(b) a GNN of T iterations, and </p><p>(c) bounding box merging and scoring.</p><p><img src="/archives/74da7df7/image-20210615114208241.png" style="zoom:80%;"></p><h3 id="Graph-construction"><a href="#Graph-construction" class="headerlink" title="Graph construction"></a>Graph construction</h3><p>Formally, we define a point cloud of N points as a set $P = \{p_1, â€¦, p_N \}$, where $p_i = (x_i, s_i)$</p><p>$x_i$æ˜¯åæ ‡ï¼Œ$s_i$ä¸ºstate valueå¯ä»¥çœ‹ä½œfeature</p><p> we construct a graph G = (P, E) by using P as the vertices and connecting a point to its neighbors within a fixed radius r</p><p><img src="/archives/74da7df7/image-20210614174123691.png" style="zoom:80%;"></p><p>ç”±äºç‚¹å¤ªå¤šäº†ï¼Œéœ€è¦ä¸‹é‡‡æ ·</p><p>we use a voxel downsampled point cloud $\hat{P}$ for the graph construction.</p><p>ä¸ºäº†ä¿ç•™åŸç‚¹äº‘çš„ä¿¡æ¯ï¼Œå…ˆç”¨PointNetå°†ç‚¹äº‘encodeï¼ˆæ–‡ç« è¯´ä¸ç”¨grouping and samplingå…¶å®åˆ°å¤„éƒ½åœ¨ç”¨ï¼‰</p><p>To preserve the information within the original point cloud, we encode the dense point cloud in the initial state value si of the vertex. More specifically, we search the raw points within a r0 radius of each vertex and use the neural network on sets to extract their features. </p><h3 id="Graph-Neural-Network-with-Auto-Registration"><a href="#Graph-Neural-Network-with-Auto-Registration" class="headerlink" title="Graph Neural Network with Auto-Registration"></a>Graph Neural Network with Auto-Registration</h3><p><strong>GNNä¸€èˆ¬è¿­ä»£è¿‡ç¨‹</strong></p><p>A typical graph neural network refines the vertex features by aggregating features along the edges.</p><p>åœ¨ $(t+1)^{th}$ è¿­ä»£ä¸­ï¼Œé¡¶ç‚¹æ›´æ–°å…¬å¼ä¸º</p><p><img src="/archives/74da7df7/image-20210614214253822.png" style="zoom:80%;"></p><p>where  $e^t$ and $v^t$ are the edge and vertex features from the $t^{th}$ iteration.</p><p>$f^t(Â·)$ é€šè¿‡ä¸¤ä¸ªé¡¶ç‚¹çš„ç‰¹å¾æ¥æ›´æ–°è¾¹çš„ç‰¹å¾</p><p>$\rho(Â·)$ ä¸ºä¸€ä¸ªé›†å‡½æ•°ï¼Œå°†æ¯ä¸ªé¡¶ç‚¹çš„è¾¹çš„ç‰¹å¾è¿›è¡Œç»¼åˆ</p><p>$g^t(Â·)$ æ›´æ–°é¡¶ç‚¹içš„ç‰¹å¾</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œé¡¶ç‚¹çš„ç‰¹å¾ $v_i$ï¼Œå°±æ˜¯ä¹‹å‰æ‰€è¯´çš„æ¯ä¸ªç‚¹çš„çŠ¶æ€ $s_i$</p><p>åœ¨æœ¬æ–‡æ–°çš„è¿­ä»£æ›´æ–°æ–¹ç¨‹è¢«æå‡ºï¼Œä½†æˆ‘ä¸ç†è§£å…¶ä¸­çš„æ„ä¹‰ï¼Œæ–‡ç« è¯´è¿™æ ·çš„æ›´æ–°æ˜¯ä¸ºäº†å¢åŠ translation invariance</p><p><img src="/archives/74da7df7/image-20210614215842089.png" style="zoom:50%;"></p><h3 id="LOSS"><a href="#LOSS" class="headerlink" title="LOSS"></a>LOSS</h3><p> We use the average cross-entropy loss as the classification loss.</p><p><img src="/archives/74da7df7/image-20210614220904072.png" style="zoom: 67%;"></p><p>We encode the bounding box with the vertex coordinates (xv, yv, zv) as follows:</p><p><img src="/archives/74da7df7/image-20210614220942233.png" style="zoom:67%;"></p><p>We then average the localization loss of all the vertices:</p><p><img src="/archives/74da7df7/image-20210614221044678.png" style="zoom:67%;"></p><p>To prevent over-fitting, we add L1 regularization to each MLP. The total loss is then:</p><p><img src="/archives/74da7df7/image-20210614221104990.png" style="zoom: 80%;"></p><h3 id="Box-Merging-and-Scoring"><a href="#Box-Merging-and-Scoring" class="headerlink" title="Box Merging and Scoring"></a>Box Merging and Scoring</h3><p>æ–‡ç« é€šè¿‡ä¸€äº›çš„æ–¹æ³•æ¥å®ç°è¿‘ä¼¼äºï¼ˆæ›´å¥½äºï¼‰NMSçš„æ•ˆæœï¼Œæˆ‘æ²¡æœ‰ä»”ç»†çœ‹</p><h2 id="Eperiment"><a href="#Eperiment" class="headerlink" title="Eperiment"></a>Eperiment</h2><p>æœ€ç»ˆå®éªŒç»“æœè¿˜æ˜¯å¾ˆä¸é”™çš„</p><p><img src="/archives/74da7df7/image-20210614221626269.png" style="zoom:80%;"></p><p><img src="/archives/74da7df7/image-20210614221800920.png" style="zoom:80%;"></p><p>æ„Ÿè§‰æ¯”è¾ƒç®€å•çš„è®¾è®¡ä½†è¾¾åˆ°äº†è¾ƒå¥½çš„æ•ˆæœï¼Œä¹Ÿä¸æ¸…æ¥šè¿™ä¸ªç½‘ç»œçš„è¡¨ç°å¥½åˆ°åº•æ¥æºäºå“ªä¸€éƒ¨åˆ†â€¦</p><p>ä¸ä½œä¸ºä»Šåå»¶ç”³çš„é‡ç‚¹ï¼ŒæŒè§‚æœ›æ€åº¦</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Point Cloud </tag>
            
            <tag> Point-GNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PointPillars</title>
      <link href="/archives/f3e8f95c.html"/>
      <url>/archives/f3e8f95c.html</url>
      
        <content type="html"><![CDATA[<h1 id="PointPillars-note"><a href="#PointPillars-note" class="headerlink" title="PointPillars note"></a>PointPillars note</h1><p>è¿™ç¯‡æ–‡ç« ä¹Ÿç»å¸¸åœ¨å…¶ä»–æ–‡ç« ä¸­è¢«æåˆ°ï¼Œè¯¥ç½‘ç»œç‰¹ç‚¹å°±æ˜¯å…·æœ‰éå¸¸å¿«çš„æ¨ç†é€Ÿåº¦ã€‚è¿™ç¯‡æ–‡ç« çš„ä¸€ä¸ªå‡ºå‘ç‚¹ä¹‹ä¸€ï¼Œå°±æ˜¯ä¸æƒ³ä½¿ç”¨é€Ÿåº¦è¾ƒæ…¢çš„ 3D convolutionã€‚è¿™ç¯‡ç¬”è®°æ¯”è¾ƒæ½¦è‰ï¼Œä½†ç›®çš„æ˜¯æ¢³ç†æ¸…æ¥šæ¨¡å‹çš„æ¡†æ¶å’Œæµç¨‹</p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>In this work we propose PointPillars, a novel encoder which <strong>utilizes PointNets to learn a representation of point clouds organized in vertical columns (pillars).</strong> While <strong>the encoded features can be used with any standard 2D convolutional detection architecture,</strong> we further propose a lean downstream network</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Recently SECOND  improved the inference speed of VoxelNet but the 3D convolutions remain a bottleneck. </p><p>In this work we use a single stage method</p><p>We show how all computations on pillars can be posed as dense 2D convolutions which enables <strong>inference at 62 Hz;</strong> a factor of 2-4 times faster than other methods</p><h2 id="PointPillars-Network"><a href="#PointPillars-Network" class="headerlink" title="PointPillars Network"></a>PointPillars Network</h2><p>It consists of three main stages (Figure 2): </p><p>(1) A feature encoder network that <strong>converts a point cloud to a sparse pseudoimage;</strong></p><p>(2) <strong>a 2D convolutional backbone</strong> to process the pseudo-image into high-level representation; and </p><p>(3) a detection head that <strong>detects and regresses 3D boxes.</strong></p><p><img src="/archives/f3e8f95c/image-20210615120459627.png" style="zoom:80%;"></p><h3 id="Pointcloud-to-Pseudo-Image"><a href="#Pointcloud-to-Pseudo-Image" class="headerlink" title="Pointcloud to Pseudo-Image"></a>Pointcloud to Pseudo-Image</h3><p>As a first step the point cloud is discretized into an evenly spaced grid in the x-y plane, creating a set of pillars P with |P| = B</p><p>The points in <strong>each pillar are then augmented with</strong> $x_c, y_c, z_c, x_p, y_p$ where the c subscript denotes distance to the arithmetic mean of all points in the pillar and the p subscript denotes the offset from the pillar x, y center. </p><p>The augmented lidar point l is now <strong>D = 9</strong> dimensional $(x, y, z, r, x_c, y_c, z_c, x_p, y_p)$ </p><p>The set of pillars will be mostly empty due to sparsity of the point cloud</p><p><strong>ä¸ºäº†æ›´è¿‘ä¸€æ­¥å¤„ç† sparsityï¼Œè§„å®šäº†æ¯ä¸ª sampleï¼Œæœ€å¤šæœ‰ P ä¸ª non-empty Pillarsï¼Œæ¯ä¸ª pillar æœ€å¤šæœ‰ N ä¸ª pointsï¼Œå¤šäºå°±è¿›è¡Œéšæœºé‡‡æ ·ã€‚æœ€ç»ˆå¾—åˆ° tensor of size (D, P, N)ã€‚ä¹‹åä½¿ç”¨ PointNetï¼Œå°†æ¯ä¸ª Pillar è¿›è¡Œ aggreagte å¾—åˆ° feature tensor (C, P)ï¼Œå†å°†è¿™ä¸ª feature tensor è¿˜åŸæˆä¸º feature map</strong></p><h3 id="Backbone"><a href="#Backbone" class="headerlink" title="Backbone"></a>Backbone</h3><p><strong>We use a similar backbone as VoxelNet</strong> and the structure is shown in Figure 2. The backbone has two sub-networks: one top-down network that produces features at increasingly small spatial resolution and a second network that performs upsampling and concatenation of the top-down features. </p><p><strong>The top-down backbone can be characterized by a series of blocks Block(S, L, F).</strong> Each block operates at stride S (measured relative to the original input pseudo-image). A block has L 3x3 2D conv-layers with F output channels, each followed by BatchNorm and a ReLU</p><h3 id="Detection-Head"><a href="#Detection-Head" class="headerlink" title="Detection Head"></a>Detection Head</h3><p>In this paper, we use the Single Shot Detector (SSD) [18] setup to perform 3D object detection. Similar to SSD, we match the priorboxes to the ground truth using 2D Intersection over Union (IoU)</p><h2 id="Loss"><a href="#Loss" class="headerlink" title="Loss"></a>Loss</h2><p>Ground truth boxes and anchors are defined by $(x, y, z, w, l, h, \theta)$. The localization regression residuals between ground truth and anchors are defined by:</p><p><img src="/archives/f3e8f95c/image-20210615124243246.png" style="zoom:67%;"></p><p>$d^a = \sqrt{(w^a)^2+(l^a)^2}$ ï¼Œthe total localization loss is: </p><p><img src="/archives/f3e8f95c/image-20210615124445132.png" style="zoom:67%;"></p><p>For the object classification loss, we use the focal loss [16]:</p><p><img src="/archives/f3e8f95c/image-20210615124612144.png" style="zoom:67%;"></p><p>The total loss is therefore</p><p><img src="/archives/f3e8f95c/image-20210615124700683.png" style="zoom:67%;"></p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><p><strong>Params:</strong> Unless explicitly varied in an experimental study, we use an xy resolution: 0.16 m, max number of pillars (P): 12000, and max number of points per pillar (N): 100.</p><p><img src="/archives/f3e8f95c/image-20210615124819976.png" style="zoom:80%;"></p><h3 id="Speed-v-s-resolution-amp-presicion"><a href="#Speed-v-s-resolution-amp-presicion" class="headerlink" title="Speed v.s. resolution &amp; presicion"></a>Speed v.s. resolution &amp; presicion</h3><p><img src="/archives/f3e8f95c/image-20210615124859420.png" style="zoom:80%;"></p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Point Cloud </tag>
            
            <tag> PointPillars </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PointNet &amp; PointNet++</title>
      <link href="/archives/63387d0d.html"/>
      <url>/archives/63387d0d.html</url>
      
        <content type="html"><![CDATA[<h1 id="PointNet-amp-PointNet"><a href="#PointNet-amp-PointNet" class="headerlink" title="PointNet &amp; PointNet++"></a>PointNet &amp; PointNet++</h1><hr><p>Qi, Charles R., Hao Su, Kaichun Mo, and Leonidas J. Guibas. â€œPointNet: Deep Learning on Point Sets for 3D Classification and Segmentation.â€ <em>ArXiv:1612.00593 [Cs]</em>, April 10, 2017. <a href="http://arxiv.org/abs/1612.00593">http://arxiv.org/abs/1612.00593</a>.</p><p>Comment: CVPR 2017</p><p>Qi, Charles R., Li Yi, Hao Su, and Leonidas J. Guibas. â€œPointNet++: Deep Hierarchical Feature Learning on Point Sets in a Metric Space.â€ <em>ArXiv:1706.02413 [Cs]</em>, June 7, 2017. <a href="http://arxiv.org/abs/1706.02413">http://arxiv.org/abs/1706.02413</a>.</p><p>From zotero</p><hr><p>PointNet ç®—æ˜¯åˆ©ç”¨æ·±åº¦å­¦ä¹ å¤„ç†ç‚¹äº‘æ•°æ®çš„å¼€å±±ä¹‹ä½œã€‚ç”±äºç‚¹äº‘æ•°æ®å¯¹æ¯”å›¾ç‰‡æ•°æ®æ›´åŠ æ··ä¹±å’Œå¤æ‚ï¼ŒåŸæœ‰çš„äºŒç»´å¤„ç†æ–¹æ³•é¢å¯¹ç‚¹äº‘æ•°æ®å¹¶æ²¡æœ‰èµ·åˆ°å¥½çš„æ•ˆæœï¼Œä½†åœ¨ PointNet æå‡ºåï¼Œå¤„ç†ä¸‰ç»´ç‚¹äº‘æ•°æ®æœ‰äº†æ–°çš„æ€è·¯ï¼Œå¹¶ä¸”å®éªŒç»“æœæœ‰äº†æ˜¾è‘—çš„æå‡ã€‚è¯¥ç¬”è®°ä¸»è¦ä¸ºäº†æ€»ç»“ PointNet å’Œ PointNet++ ä¸­å¿ƒæ€æƒ³ï¼Œå‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_39373480/article/details/88878629">CSDN</a></p><h2 id="PointNet"><a href="#PointNet" class="headerlink" title="PointNet"></a>PointNet</h2><h3 id="ä¸‰ç»´è¡¨ç¤º"><a href="#ä¸‰ç»´è¡¨ç¤º" class="headerlink" title="ä¸‰ç»´è¡¨ç¤º"></a>ä¸‰ç»´è¡¨ç¤º</h3><p><img src="/archives/63387d0d/image-20211004162518323.png" style="zoom: 50%;"></p><p>ä¸‰ç»´æ•°æ®çš„è¡¨è¿°å½¢å¼ä¸€èˆ¬åˆ†ä¸ºå››ç§ï¼š</p><ol><li><p>ç‚¹äº‘ï¼šç”± N ä¸ª D ç»´çš„ç‚¹ç»„æˆï¼Œå½“è¿™ä¸ª D = 3 çš„æ—¶å€™ä¸€èˆ¬ä»£è¡¨ç€ $(x, y, z)$ çš„åæ ‡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŒ…æ‹¬ä¸€äº›æ³•å‘é‡ã€å¼ºåº¦ç­‰åˆ«çš„ç‰¹å¾</p></li><li><p>Meshï¼šç”±ä¸‰è§’é¢ç‰‡å’Œæ­£æ–¹å½¢é¢ç‰‡ç»„æˆ</p></li><li><p>ä½“ç´ ï¼šç”±ä¸‰ç»´æ …æ ¼å°†ç‰©ä½“ç”¨0å’Œ1è¡¨å¾</p></li><li><p>å¤šè§’åº¦çš„RGBå›¾åƒæˆ–è€…RGB-Då›¾åƒ</p></li></ol><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ç‚¹äº‘æ•°æ®ï¼Ÿ</strong></p><ol><li>ç‚¹äº‘æ›´æ¥è¿‘äºè®¾å¤‡çš„åŸå§‹è¡¨å¾ï¼ˆå³é›·è¾¾æ‰«æç‰©ä½“ç›´æ¥äº§ç”Ÿç‚¹äº‘ï¼‰</li><li>ç‚¹äº‘çš„è¡¨è¾¾æ–¹å¼æ›´åŠ ç®€å•ï¼Œä¸€ä¸ªç‰©ä½“ä»…ç”¨ä¸€ä¸ª N Ã— D çš„çŸ©é˜µè¡¨ç¤º</li></ol><h3 id="Properties-of-Point-Sets"><a href="#Properties-of-Point-Sets" class="headerlink" title="Properties of Point Sets"></a>Properties of Point Sets</h3><ul><li>Unorderedï¼Œæ— åºæ€§</li><li>Interaction among pointsï¼Œç‚¹ä¸ç‚¹ä¹‹é—´çš„ä½œç”¨</li><li>Invariance under transformationsï¼Œç©ºé—´ä¸å˜æ€§</li></ul><p>ä»¥ä¸Šæ€§è´¨çš„å‰ä¸¤ç‚¹æ˜¯åŒºåˆ«äºäºŒç»´å›¾åƒæ•°æ®çš„ï¼Œä¹Ÿæ˜¯å¤„ç†ç‚¹äº‘æ•°æ®çš„éš¾ç‚¹ã€‚PointNet æ ¸å¿ƒçš„è´¡çŒ®æœ‰ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯è§£å†³æ— åºçš„ç‚¹äº‘è¾“å…¥ï¼Œä¸€ä¸ªæ˜¯è§£å†³ç©ºé—´ä¸å˜æ€§ã€‚ä½†æ˜¯å¯¹äºå¤„ç†ç©ºé—´ä¸å˜æ€§çš„ç»“æ„ï¼Œåœ¨ç°åœ¨çœ‹æ¥ä¼¼ä¹æ²¡æœ‰å¿…è¦æ€§ã€‚è€Œä¸”å¯¹äºç‚¹ä¸ç‚¹ä¹‹é—´çš„ä½œç”¨ PointNet ä¹Ÿæ²¡æœ‰æ·±å…¥è€ƒè™‘ï¼Œä½†åœ¨ä¹‹åçš„ PointNet++ ä¸­æå‡ºäº†è§£å†³æ–¹æ³•</p><h3 id="PointNet-Architecture"><a href="#PointNet-Architecture" class="headerlink" title="PointNet Architecture"></a>PointNet Architecture</h3><p>å…ˆçœ‹ä¸‹å›¾æœ‰ä¸ªæ•´ä½“æ„Ÿå—<img src="/archives/63387d0d/eef95113-fb3d-4ba8-b8a4-6c377d66d2bd.png" style="zoom: 50%;"></p><p>PointNet èƒ½å¤Ÿå¤„ç†åˆ†ç±»ä»»åŠ¡å’Œåˆ†å‰²ä»»åŠ¡ï¼Œåˆ†åˆ«å¯¹åº”ç€æµç¨‹å›¾çš„ä¸Šä¸‹ä¸¤ä¸ªéƒ¨åˆ†</p><p>input transform å’Œ feature transform çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†è®©ç½‘ç»œé¢å¯¹ç©ºé—´çš„æ—‹è½¬ã€ç¼©æ”¾ç­‰æœ‰ä¸€å®šçš„é²æ£’æ€§ï¼Œåœ¨è®ºæ–‡ä¸­çš„æ–¹æ³•æ˜¯æ–°å¼•å…¥äº†ä¸€ä¸ª <strong>T-Net</strong> ç½‘ç»œå»å­¦ä¹ ç‚¹äº‘çš„æ—‹è½¬ï¼Œå°†ç‰©ä½“æ ¡å‡†ï¼Œå…·ä½“çš„ç»“æ„åœ¨è¯¥ç¬”è®°ä¸­ä¸ä¼šè¯¦ç»†ä»‹ç»</p><p>Shared MLP æœ¬è´¨ä¸ºä¸€ç»´çš„å·ç§¯ <a href="https://pytorch.org/docs/stable/generated/torch.nn.Conv1d.html">Conv1d</a>ï¼Œå¯ä»¥å‚è€ƒé“¾æ¥ <a href="https://blog.csdn.net/Passersby__/article/details/104941591">CSDN</a> è¿›ä¸€æ­¥å­¦ä¹ ã€‚Shared MLP + Max Pooling æ“ä½œå®ç°äº†å¯¹æ— åºæ€§ç‚¹äº‘æ•°æ®çš„å¯¹ç§°å¤„ç†ï¼Œå³å½“ç‚¹äº‘è¾“å…¥é¡ºåºæ”¹å˜æ—¶ï¼Œè¾“å‡ºç»“æœä¸ä¼šå› ä¸ºè¾“å…¥é¡ºåºçš„æ”¹å˜è€Œæ”¹å˜ã€‚æ³¨æ„ Max Pooling æ˜¯å¯¹ä¸åŒçš„ç‚¹è€Œè¨€çš„ï¼Œè€Œä¸æ˜¯å¯¹äºåŒä¸€ä¸ªç‚¹çš„ç‰¹å¾å‘é‡æ“ä½œçš„ã€‚ä¸‹é¢æˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºä¸ºä½•ä½¿ç”¨ Shared MLP + Max Pooling</p><h3 id="Symmetry-Function-for-Unordered-Input"><a href="#Symmetry-Function-for-Unordered-Input" class="headerlink" title="Symmetry Function for Unordered Input"></a>Symmetry Function for Unordered Input</h3><p>ç‚¹äº‘å®é™…ä¸Šæ‹¥æœ‰<strong>ç½®æ¢ä¸å˜æ€§</strong>çš„ç‰¹ç‚¹ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ç½®æ¢ä¸å˜æ€§å‘¢ï¼Œç®€å•åœ°è¯´å°±æ˜¯ç‚¹çš„æ’åºä¸å½±å“ç‰©ä½“çš„æ€§è´¨ã€‚å› æ­¤é’ˆå¯¹ç‚¹äº‘çš„ç½®æ¢ä¸å˜æ€§ï¼Œå…¶è®¾è®¡çš„ç½‘ç»œå¿…é¡»æ˜¯ä¸€ä¸ª<strong>å¯¹ç§°çš„å‡½æ•°</strong>ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„ <strong>sum</strong> å’Œ <strong>max</strong> ç­‰å‡½æ•°å…¶å®éƒ½æ˜¯å¯¹ç§°å‡½æ•°</p><p>æ–‡ç« çš„å…·ä½“åšæ³•ä¸ºï¼šå°†ç‚¹äº‘æ•°æ®ä½¿ç”¨ Shared MLP å‡ç»´ï¼ˆä»3ç»´æœ€ç»ˆå‡è‡³1024ç»´ï¼‰ï¼Œç„¶åä½¿ç”¨ max pooling æ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªå…¨å±€çš„ç‰¹å¾å‘é‡ global featureã€‚ä½¿ç”¨è¯¥ global feature å°±å¯ä»¥è¿›è¡Œç‚¹äº‘çš„åˆ†ç±»ä»»åŠ¡äº†ï¼Œè€Œå¦‚æœæ˜¯è¿›è¡Œç‚¹äº‘åˆ†å‰²ä»»åŠ¡ï¼Œåˆ™éœ€è¦å’Œæ¯ä¸ªç‚¹çš„å±€éƒ¨ç‰¹å¾ç»“åˆèµ·æ¥ï¼Œå†è¿›è¡Œè®¡ç®—</p><p>Qï¼šå‡ç»´ï¼ˆæˆ–è€…è¯´å¤šå·ç§¯æ ¸ï¼‰åœ¨æ·±åº¦å­¦ä¹ å½“ä¸­æ˜¯éå¸¸å¸¸è§çš„ï¼Œè¯¥æ“ä½œçš„æœ¬è´¨æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿä¸ªäººçŒœæµ‹ï¼šå¯¹é«˜ç»´åº¦çš„ç©ºé—´è¿›è¡Œåˆ†å‰²æ›´ç®€å•ï¼Œå¹¶å¯¹æ•°æ®ä¿ç•™è¶³å¤Ÿçš„ç‰¹å¾</p><h3 id="Shared-MLP-Max-Pooling-çš„åˆç†æ€§"><a href="#Shared-MLP-Max-Pooling-çš„åˆç†æ€§" class="headerlink" title="Shared MLP + Max Pooling çš„åˆç†æ€§"></a>Shared MLP + Max Pooling çš„åˆç†æ€§</h3><p>è¯¥è®ºæ–‡æå‡ºäº†å¦‚ä¸‹çš„å®šç†ï¼Œè¯¥å®šç†åŸºäºä¸‡èƒ½è¿‘ä¼¼å®šç†ï¼ˆUniversal Approximate Theoremï¼‰</p><p><img src="/archives/63387d0d/3b3fa29d-44f5-4724-af23-8438e1961530.png" style="zoom: 67%;"></p><p>å¯¹äºæ–‡ç« è¯æ˜ç†è§£ï¼Œæœ‰2ä¸ªæ¦‚å¿µéœ€è¦è¿›ä¸€æ­¥äº†è§£ï¼Œä¸€ä¸ªæ˜¯ <a href="https://en.wikipedia.org/wiki/Hausdorff_distance">Hausdorff_distance</a> ä¸€ä¸ªæ˜¯ <a href="https://en.wikipedia.org/wiki/Power_set">Power set</a>ï¼Œå‰è€…è¡¨ç¤ºäº†ä¸¤ä¸ªé›†åˆçš„è·ç¦»ï¼Œåè€…è¡¨ç¤ºäº†ä¸€ä¸ªé›†åˆçš„æ‰€æœ‰å­é›†</p><p>è¯¥å®šç†çš„ç»“è®ºæ˜¯ï¼Œè®ºæ–‡æå‡ºçš„ç»“æ„ï¼Œèƒ½å¤Ÿæ‹Ÿåˆä»»æ„çš„è¿ç»­é›†åˆå‡½æ•°ã€‚è¿™ä¸ªå®šç†çš„ç»“è®ºï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šæ„ä¹‰ï¼Œå› ä¸ºä¸‡èƒ½è¿‘ä¼¼å®šç†å‘Šè¯‰æˆ‘ä»¬ï¼Œè¶³å¤Ÿå¤šèŠ‚ç‚¹çš„ MLP èƒ½å¤Ÿè¿‘ä¼¼ä»»ä½•è¿ç»­å‡½æ•°ã€‚é‡ç‚¹åœ¨äºè®ºæ–‡çš„è¯æ˜è¿‡ç¨‹ï¼Œç»™å‡ºäº† Shared MLP + Max Pooling çš„åˆç†æ€§ï¼Œè¯¥åˆç†æ€§æ€»ç»“ä¸ºå¦‚ä¸‹</p><blockquote><p>The proof to this theorem can be found in our supplementary material. The key idea is that in the worst case the network can learn to convert a point cloud into a volumetric representation, by partitioning the space into equal-sized voxels. In practice, however, the network learns a much smarter strategy to probe the space, as we shall see in point function visualizations.</p></blockquote><p>è¿™é‡Œçš„ worst case çš„â€œæœ€å·®â€ä½“ç°åœ¨ä½•å¤„æˆ‘å¹¶ä¸ç†è§£ï¼Œä½†æ˜¯è¯æ˜è¿‡ç¨‹ä¸­æŒ‡å‡ºäº†ç½‘ç»œçš„ä¸€æ¡å¯èƒ½çš„å­¦ä¹ è·¯å¾„ã€‚è¯¥å­¦ä¹ è·¯å¾„æè¿°ä¸ºå¦‚ä¸‹ï¼š</p><ol><li>å°†æ‰€æœ‰çš„ç‚¹æ˜ å°„åˆ°å…¶â€œé™„è¿‘â€çš„æ …æ ¼ç‚¹ä¸­ï¼Œè¿™æ ·å¾—åˆ°ä¸€ä¸ªæ–°çš„ç‚¹é›†ï¼Œå¯ä»¥è¯æ˜ä½¿ç”¨è¯¥æ …æ ¼ç‚¹é›†ä½œä¸ºè¾“å…¥å»æ›¿æ¢åŸç‚¹é›†ï¼Œå¹¶ä¸ä¼šå¯¹è¾“å‡ºé€ æˆå¤ªå¤§çš„å½±å“ï¼Œæ‰€ä»¥è¯¥æ …æ ¼ç‚¹é›†å°±æ˜¯å¯¹åŸç‚¹é›†çš„ä¸€ä¸ªå¾ˆå¥½çš„è¿‘ä¼¼ã€‚è€Œè¿™ä¸ªæ˜ å°„å°±æ˜¯ç”± Shared MLP + Max Pooling + MLP å®Œæˆ</li><li>æ­¤æ—¶è¿˜éœ€è¦ä½¿ç”¨æ–°çš„ MLP å®Œæˆå¯¹åŸè¿ç»­é›†å‡½æ•°çš„æ‹Ÿåˆã€‚è¯¥ MLP å’Œç¬¬ä¸€æ­¥ä¸­çš„ MLP å¯ä»¥å åŠ èµ·æ¥ï¼Œä½œä¸ºä¸€ä¸ªæ•´ä½“çš„ MLPï¼Œåœ¨å…¬å¼ä¸­å³è¡¨ç¤ºä¸º Î³ å‡½æ•°</li></ol><p>é€šè¿‡äººä¸ºè®¾ç½®çš„å­¦ä¹ è·¯å¾„ï¼Œè§£é‡Šäº†è¯¥ç»“æ„çš„åˆç†æ€§ã€‚ä½†é€šè¿‡ç½‘ç»œè‡ªèº«çš„å­¦ä¹ ï¼Œèƒ½å¤Ÿè·å¾—æ›´å¥½çš„æ•ˆæœï¼Œå‰©ä¸‹çš„å°±äº¤ç»™ä¼˜åŒ–ç®—æ³•å§ï¼</p><h4 id="æ›´æ–°ï¼šä»å‡ç»´çš„è§’åº¦æ¥çœ‹å¾…-PointNet"><a href="#æ›´æ–°ï¼šä»å‡ç»´çš„è§’åº¦æ¥çœ‹å¾…-PointNet" class="headerlink" title="æ›´æ–°ï¼šä»å‡ç»´çš„è§’åº¦æ¥çœ‹å¾… PointNet"></a>æ›´æ–°ï¼šä»å‡ç»´çš„è§’åº¦æ¥çœ‹å¾… PointNet</h4><p>ä¸ºä»€ä¹ˆè¦å°†æ¯ä¸€ä¸ªç‚¹çš„ä½ç½®ä½¿ç”¨å…¨è¿æ¥ç½‘ç»œè¿›è¡Œå‡ç»´åº¦ï¼ŸBTWï¼Œå› ä¸ºæ¯ä¸€ä¸ªç‚¹éƒ½å…±ç”¨ä¸€ä¸ªå…¨è¿æ¥ç½‘ç»œæ‰€ä»¥å« shared MLP</p><p>è¿™æ ·çš„å‡ç»´æ“ä½œæˆ‘åœ¨ one-hot ç¼–ç ä¸­çœ‹åˆ°è¿‡ï¼Œå³ç”¨ä¸€ä¸ªå¤šç»´çš„ï¼Œç”± {0,1} ç»„æˆçš„å‘é‡æ¥è¡¨ç¤ºå±äºæŸä¸€ä¸ªç±»ï¼Œè¿™é‡Œä¼šä¸ä¼šæ˜¯ç›¸åŒçš„é“ç†ï¼ŸMLP çš„æƒé‡å®é™…ä¸Šæ˜¯ç©ºé—´ä¸­çš„å¤šä¸ªå‘é‡ï¼Œè¿™äº›å‘é‡å°†ç©ºé—´åˆ†å‰²æˆå¤šä¸ªå­ç©ºé—´ï¼Œå¦‚æœè¾“å…¥å‘é‡è½åœ¨è¯¥å­ç©ºé—´ä¸­ï¼Œåˆ™è¾“å…¥å‘é‡ä¸åˆ†éš”å‘é‡çš„ç‚¹ç§¯æ•°å€¼å°±ä¼šè¾ƒå¤§ï¼Œæ­¤æ—¶å¯ä»¥æŠŠåˆ™è¯¥å­ç©ºé—´çœ‹ä½œä¸º<strong>æŸç§ç‰¹å¾</strong>ã€‚ä¹‹åä½¿ç”¨ maxpooling å †æ‰€æœ‰è¾“å…¥å‘é‡è¿›è¡Œå…¨å±€çš„ç‰¹å¾æå–ï¼Œæœ€åä½¿ç”¨ MLP è¿›è¡Œå„ç§ä¸‹æ¸¸ä»»åŠ¡ </p><p>è¿™ä¸ªæ€æƒ³ï¼ˆå¯èƒ½ï¼‰èµ·æºäºä¼ ç»Ÿçš„æ»¤æ³¢ï¼Œä¹Ÿå¯èƒ½æ¥è‡ªäºçœ‹äº†é©¬æ¯…æ•™æˆçš„ä¸€äº›è¯´æ³•ï¼šæŠŠæ»¤æ³¢/å·ç§¯æ ¸çœ‹ä½œæ˜¯ä¸€ä¸ªé«˜ç»´åº¦å‘é‡ï¼Œè€Œå·ç§¯æ“ä½œå®é™…ä¸Šæ˜¯è¯¥éƒ¨åˆ†æ•°æ®ä¸è¯¥å‘é‡çš„ç‚¹ç§¯ï¼Œä¹Ÿå°±æ˜¯åœ¨è¯¥æ–¹å‘ä¸Šçš„æŠ•å½±ï¼Œå¯»æ‰¾å·ç§¯æ ¸å°±æ˜¯åœ¨å¯»æ‰¾ä¸åŒçš„é«˜ç»´å‘é‡ï¼Œå¯¹é«˜ç»´ç©ºé—´è¿›è¡Œåˆ†å‰²ï¼ŒåŸå§‹ç‰¹å¾è½åœ¨é«˜ç»´ç©ºé—´çš„ä¸åŒåŒºåŸŸï¼Œå®ƒä»¬ä¸é«˜ç»´å‘é‡çš„ç‚¹ç§¯ä»£è¡¨äº†å®ƒä»¬åœ¨è¿™äº›æ–¹å‘ä¸Šçš„æŠ•å½±ï¼Œå¦‚æœæ–¹å‘ç›¸åŒé‚£ä¹ˆæŠ•å½±å€¼è‚¯å®šä¼šæ‰“ï¼Œå¦‚æœæ–¹å‘å‚ç›´æˆ–è€…ç›¸åæŠ•å½±å€¼åˆ™ä¼šå˜å°ï¼Œè¿™æ ·è½åœ¨ä¸åŒåŒºåŸŸçš„ç‰¹å¾å°†ä¼šè¢«è¯†åˆ«å‡ºæ¥ï¼ˆé€šè¿‡ ReLU or maxpoolingï¼‰ï¼Œè¿™äº›æŠ•å½±å€¼å¯èƒ½å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æå–å¾—åˆ°çš„â€œç‰¹å¾â€</p><h2 id="PointNet-1"><a href="#PointNet-1" class="headerlink" title="PointNet++"></a>PointNet++</h2><p>PointNet++ çš„æå‡ºæºäº PointNet çš„ç¼ºç‚¹â€”â€”ç¼ºå¤±å±€éƒ¨ç‰¹å¾ã€‚PointNetå¯¹äºåœºæ™¯çš„åˆ†å‰²æ•ˆæœååˆ†ä¸€èˆ¬ï¼Œç”±äºå…¶ç½‘ç»œç›´æ¥æš´åŠ›åœ°å°†æ‰€æœ‰çš„ç‚¹æœ€å¤§æ± åŒ–ä¸ºäº†ä¸€ä¸ªå…¨å±€ç‰¹å¾ï¼Œå› æ­¤å±€éƒ¨ç‚¹ä¸ç‚¹ä¹‹é—´çš„è”ç³»å¹¶æ²¡æœ‰è¢«ç½‘ç»œå­¦ä¹ åˆ°ã€‚PointNet++ ä¸­ä¸»è¦å€Ÿé‰´äº† CNN çš„å¤šå±‚æ„Ÿå—é‡çš„æ€æƒ³ï¼Œå¢å¼ºäº†ç½‘ç»œå¯¹äºå±€éƒ¨ç‰¹å¾çš„æå–èƒ½åŠ›</p><p>å…·ä½“æ¥è®²å°±æ˜¯ï¼šå¯¹äºç‚¹äº‘æ•°æ®ï¼Œå°†ç‚¹äº‘æ•°æ®è¿›è¡Œé‡‡æ ·å’Œåˆ†ç»„ï¼Œä½¿ç”¨åŸ PointNet å¯¹è¿™äº›åˆ†ç»„åçš„ç‚¹äº‘å­é›†è¿›è¡Œç‰¹å¾æå–ï¼ˆè€Œéä¹‹å‰çš„å…¨å±€ç‰¹å¾æå–ï¼‰ï¼Œå¾—åˆ°äº†æ–°çš„ç‰¹å¾é›†åˆï¼Œå¯¹äºæ–°çš„ç‰¹å¾é›†åˆï¼Œå¯ä»¥é‡å¤ä¹‹å‰çš„é‡‡æ ·ã€åˆ†ç»„ã€æå–è¿‡ç¨‹ï¼Œä¸æ–­åœ°è¿­ä»£ã€‚éšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ ï¼ŒPointNet çš„æ„Ÿå—é‡ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œä¸‹å›¾ä¸º PointNet++  (single scale grouping) çš„ç»“æ„å›¾ï¼Œèƒ½å¤Ÿæœ‰ä¸€ä¸ªæ›´åŠ ç›´è§‚çš„æ„Ÿå—</p><p><img src="/archives/63387d0d/a4bc72c1-997d-4536-b50a-78a1917af8d6.png" style="zoom: 67%;"></p><h3 id="PointNet-Architecture-1"><a href="#PointNet-Architecture-1" class="headerlink" title="PointNet++ Architecture"></a>PointNet++ Architecture</h3><p>å’Œ PointNet ç±»ä¼¼ï¼Œæ•´ä½“ä¾æ—§æ˜¯ encoder-decoder æ¨¡å¼ï¼Œå¯ä»¥å¤„ç†åˆ†å‰²ä»»åŠ¡å’Œåˆ†ç±»ä»»åŠ¡ï¼Œä½†ä¸¤ä¸ªä»»åŠ¡çš„ decoder ä¸ç›¸åŒ</p><h4 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h4><p>Encoder ç”±å¤šä¸ª set abstraction ç»“æ„ç»„æˆï¼Œå…¶ä¸­ set abstraction ç”±3ä¸ªé‡è¦éƒ¨åˆ†ç»„æˆï¼šsampling é‡‡æ ·ï¼Œgrouping åˆ†ç»„ï¼ŒPointNet ä½¿ç”¨ PointNet é‡‡é›†ç‰¹å¾ï¼Œæ¥ä¸‹æ¥è¿›ä¸€æ­¥äº†è§£è¿™ä¸‰ä¸ªéƒ¨åˆ†</p><ol><li>Samplingï¼šä½¿ç”¨åˆ©ç”¨ FPSï¼ˆæœ€è¿œç‚¹é‡‡æ ·ï¼‰éšæœºé‡‡æ ·ç‚¹ï¼Œå‚è€ƒé“¾æ¥ <a href="https://blog.csdn.net/minhuaQAQ/article/details/107280596">CSDN</a></li><li>Groupingï¼šåˆ©ç”¨ Ball Query åˆ’ä¸€ä¸ª R ä¸ºåŠå¾„çš„åœˆï¼Œå°†æ¯ä¸ªåœˆé‡Œé¢çš„ç‚¹äº‘ä½œä¸ºä¸€ç°‡</li><li>PointNetï¼š å¯¹ Sampling + Grouping ä»¥åçš„ç‚¹äº‘è¿›è¡Œç‰¹å¾æå–ï¼Œæ³¨æ„è¿™é‡Œçš„ PointNet å’ŒåŸ PointNet ç›¸æ¯”ï¼Œå»æ‰äº†å…¶ä¸­çš„ T-Net transform çš„éƒ¨åˆ†</li></ol><p>æ•°æ®çš„å½¢çŠ¶å˜åŒ–ä¸ºï¼š</p><p>Input (N, d) -&gt; sampling (n, d) -&gt; grouping (n, K, d) -&gt; PointNet (n, C + d) -&gt; â€¦</p><p>å…¶ä¸­ d åº”è¯¥ä¸ºç‚¹çš„åŸå§‹ä¿¡æ¯ï¼Œä¼šä¸€ç›´è·Ÿéšç€ç‚¹å­˜åœ¨ï¼Œå› ä¸º sampling + grouping å°†ä¼šä½¿ç”¨</p><h4 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a>Decoder</h4><p>åˆ†ç±»ä»»åŠ¡çš„ decoder ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä½¿ç”¨ PointNet æå–å…¨å±€ç‰¹å¾ï¼Œç„¶åé€å…¥ MLP ä¸­è¿›è¡Œåˆ†ç±»</p><p>åˆ†å‰²ä»»åŠ¡çš„ decoder éœ€è¦å¾—åˆ°æ¯ä¸€ä¸ªç‚¹çš„ç‰¹å¾å‘é‡ï¼Œä½†æ˜¯ç»è¿‡ encoder æˆ‘ä»¬åªæœ‰å°‘æ•°ä¸€äº›ç‚¹çš„ç‰¹å¾ï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè®ºæ–‡é‡‡å–çš„ç»“æ„ä¸º Point Feature Propagationï¼Œå°†å°‘æ•°ç‚¹çš„ç‰¹å¾é€å±‚ä¼ æ’­åˆ°æ¯ä¸€ä¸ªç‚¹ï¼Œå…¶æœ¬è´¨ä¸ºæ’å€¼ interpolationã€‚å…¬å¼å¦‚ä¸‹ï¼Œç”± <a href="https://www.latexlive.com/">latexlive</a> ä»å›¾ç‰‡ç”Ÿæˆ</p><script type="math/tex; mode=display">f^{(j)}(x)=\frac{\sum_{i=1}^{k} w_{i}(x) f_{i}^{(j)}}{\sum_{i=1}^{k} w_{i}(x)} \quad \text { where } \quad w_{i}(x)=\frac{1}{d\left(x, x_{i}\right)^{p}}, j=1, \ldots, C</script><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†è¯¥ç‚¹å‘¨å›´çš„ç‚¹çš„ç‰¹å¾å€¼è¿›è¡ŒåŠ æƒå¹³å‡ï¼Œä½œä¸ºè¯¥ç‚¹è‡ªå·±çš„ç‰¹å¾ï¼Œè®ºæ–‡å– k = 3, p = 2ï¼Œå³ neighbor æœ‰3ä¸ªï¼Œè·ç¦»ä¸ºæ¬§æ°è·ç¦»</p><p>é™¤äº†å¯¹ç‚¹è¿›è¡Œæ’å€¼ï¼Œè¿›è¡Œç‰¹å¾ä¼ æ’­å¤–ï¼Œè®ºæ–‡è¿˜å°†æ’å€¼å¾—åˆ°ç‰¹å¾ä¸ encoder ä¸­å¯¹åº”å±‚çš„ç›¸åŒç‚¹çš„ç‰¹å¾è¿æ¥èµ·æ¥ concatenateï¼Œä½¿å¾—ç‰¹å¾çš„ä¿¡æ¯ä¿ç•™æ›´å¤š</p><h4 id="å¤šå°ºåº¦-MSG-amp-MRG"><a href="#å¤šå°ºåº¦-MSG-amp-MRG" class="headerlink" title="å¤šå°ºåº¦ MSG &amp; MRG"></a>å¤šå°ºåº¦ MSG &amp; MRG</h4><p>ä¸ºäº†ç»§ç»­å¢åŠ ç½‘ç»œå¯¹äºå¤šå°ºåº¦ä¿¡æ¯çš„æå–ï¼Œè®ºæ–‡ä¹Ÿæå‡ºäº†ä¸¤ç§å¤šå°ºåº¦ grouping æ–¹æ³•ï¼ŒMSG &amp; MRG å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/archives/63387d0d/4c9a6b7b-e492-40fe-b552-5a63e7aab832.png" style="zoom:43%;"></p><ol><li>MSGï¼šæ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯ä½¿ç”¨å¤šä¸ªåŠå¾„ï¼Œå»è·å–å¤šä¸ªå°ºåº¦çš„ç‰¹å¾ï¼Œç„¶åå°†è¿™äº›ç‰¹å¾è¿æ¥èµ·æ¥</li><li>MRGï¼šMSG çš„è®¡ç®—é‡ç›¸å¯¹æ¯”è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯åœ¨ç‚¹æ¯”è¾ƒå¤šçš„æ—¶å€™ã€‚è®ºæ–‡æå‡ºäº† MRGï¼ŒMRG åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå·¦è¾¹ç‰¹å¾ä¸ºä¸€èˆ¬çš„ grouping å¾—åˆ°çš„ç‰¹å¾ï¼Œå³è¾¹ç‰¹å¾ä¸ºè¯¥ grouping èŒƒå›´åœ¨åŸå§‹ç‚¹äº‘ä¸­çš„ä½ç½®ï¼Œå¯¹è¯¥ä½ç½®èŒƒå›´å†…çš„åŸå§‹ç‚¹äº‘åšç‰¹å¾æå–ã€‚ç”±äº MRG ä½œè€…å¹¶ä¸ºå°†å…¶ä»£ç å¼€æºï¼Œæ‰€ä»¥å¯èƒ½ç†è§£å¹¶ä¸æ·±åˆ»ï¼Œæ‰€ä»¥è¯·å‚è€ƒåŸæ–‡åŠå…¶é™„å½•</li></ol><h4 id="æ•°æ®é¢„å¤„ç†-Dropout"><a href="#æ•°æ®é¢„å¤„ç†-Dropout" class="headerlink" title="æ•°æ®é¢„å¤„ç† Dropout"></a>æ•°æ®é¢„å¤„ç† Dropout</h4><p>å¤šå°ºåº¦è®­ç»ƒçš„ç›®çš„ä¹‹ä¸€æ˜¯ä¸ºäº†æ›´å¥½åº”å¯¹ç‚¹äº‘å¯†åº¦çš„å˜åŒ–ï¼Œå¯¹äºå¯†åº¦ä½çš„ç‚¹äº‘ï¼Œé€‰å–æ›´å¤§å°ºåº¦èŒƒå›´çš„ç‰¹å¾æ•ˆæœä¼šæ›´å¥½ã€‚åŒæ—¶è®ºæ–‡ä¹Ÿé‡‡ç”¨äº† dropout æ“ä½œï¼Œå¯¹è®­ç»ƒæ•°æ®ç‚¹ä»¥ dropout ratio Î¸ è¿›è¡Œéšæœºå‰”é™¤ï¼Œè€Œ Î¸ æ˜¯ä» 0-0.95 ä¸­å‡åŒ€é‡‡æ ·å¾—åˆ°ï¼Œè¿™æ ·å°±èƒ½åˆ›å»ºä¸åŒå¯†åº¦çš„ç‚¹äº‘æ•°æ®äº†</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>PointNet ç³»åˆ—æ˜¯ç‚¹äº‘åˆ†å‰²ç½‘ç»œæœ€åˆçš„ baselineï¼Œä¸€äº›ç½‘ç»œä¹Ÿæ˜¯é€šè¿‡ä»¥è¿™ä¸¤ä¸ªç½‘ç»œä¸ºåŸºç¡€æ„é€ å‡ºæ¥çš„ã€‚å…¶ä¼˜ç‚¹éå¸¸çš„æ˜æ˜¾ï¼Œå°±æ˜¯<strong>å‚æ•°é‡å°</strong>ï¼›ä½†å…¶ç¼ºç‚¹å°±æ˜¯å¯¹äº<strong>å±€éƒ¨çš„ç‰¹å¾çš„æŠ“å–è¿˜ä¸æ˜¯ç‰¹åˆ«çš„å®Œå–„</strong>ï¼Œè¿™ä¹Ÿæ˜¯æœªæ¥å¯ä»¥æ”¹è¿›çš„åœ°æ–¹</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Point Cloud </tag>
            
            <tag> PointNet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PointRCNN</title>
      <link href="/archives/51543c70.html"/>
      <url>/archives/51543c70.html</url>
      
        <content type="html"><![CDATA[<h1 id="PointRCNN"><a href="#PointRCNN" class="headerlink" title="PointRCNN"></a>PointRCNN</h1><hr><p>Shi, Shaoshuai, Xiaogang Wang, and Hongsheng Li. â€œPointRCNN: 3D Object Proposal Generation and Detection from Point Cloud.â€ <em>ArXiv:1812.04244 [Cs]</em>, May 16, 2019. <a href="http://arxiv.org/abs/1812.04244">http://arxiv.org/abs/1812.04244</a>.</p><p>Comment: Accepted by CVPR 2019</p><hr><p>ä»Šåçš„è®ºæ–‡æ•´ç†åº”è¯¥éµå¾ªä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶ï¼š</p><ol><li>å‰è¨€ï¼šä¸»è¦ä¸ºäº†æå‡ºé—®é¢˜ï¼Œå¼•å…¥èƒŒæ™¯ï¼Œå¼•å‡ºè®ºæ–‡ã€‚æè¿°ä¸€ä¸‹æ–‡ç« è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œä»¥åŠå…¶é‡è¦äº®ç‚¹ Remark</li><li>ç»“æ„ï¼šæè¿°è®ºæ–‡ä¸­çš„ç½‘ç»œç»“æ„ï¼ŒåŠå…¶æ ¸å¿ƒæ€æƒ³</li><li>å®éªŒï¼šè®ºæ–‡çš„ç»“æœå¥½å</li><li>æ€»ç»“ï¼šå†™ä¸€äº›è‡ªå·±çš„æƒ³æ³•ï¼Œæå‡ºå¯èƒ½çš„æ–¹å‘</li></ol><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>PointRCNN çš„ä¸€å¤§ç‰¹ç‚¹æ˜¯ï¼Œè¯¥æ–¹æ³•<strong>åŸºäºåŸå§‹çš„ç‚¹äº‘æ•°æ®ç›´æ¥è¿›è¡Œç‰¹å¾æå–å’Œ RPN æ“ä½œ</strong>ã€‚éšç€ PointNet ç³»åˆ—è®ºæ–‡çš„å‡ºç°ï¼Œå¯ä»¥ç›´æ¥åŸºäºç‚¹äº‘åŸå§‹æ•°æ®è¿›è¡Œç‰¹å¾æå–ï¼Œè€Œä¸éœ€è¦è¿›è¡Œä½“ç´ åŒ– (VoxelNetï¼ŒSECOND) æˆ–è€…å¯¹ç‚¹äº‘è¿›è¡ŒæŠ•å½± (PointPillar) å†ä½¿ç”¨äºŒç»´çš„ä¸€äº›æ–¹æ³•ã€‚ç›´æ¥ä½¿ç”¨ç‚¹äº‘æ•°æ®ï¼Œæœ€æ˜æ˜¾çš„å¥½å¤„å°±æ˜¯å‡å°‘äº†ä¿¡æ¯ä¸¢å¤± information loss</p><p>ä½†åœ¨å…¶ä»–çš„æ–‡ç« å½“ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äºŒç»´çš„å¤„ç†æ–¹æ³•å¹¶ä¸æ˜¯å®Œå…¨è¢«æ’æ–¥çš„ (CenterPoint)ã€‚å› ä¸º 3D é€‰æ¡†æœ‰7ç»´ $(x, y, z, w, h, l, \theta)$ï¼Œæœ€åä¸€ä¸ªç»´åº¦ä»£è¡¨çš„æ˜¯è§’åº¦ï¼Œç†è®ºä¸Šæ¥è®²ä¸‰ç»´ä¸­ç‰©ä½“çš„è§’åº¦åº”è¯¥æ˜¯æœ‰3ä¸ªåˆ†é‡çš„ï¼Œè€Œè¿™é‡Œä»…æœ‰æŸä¸€ä¸ªå¹³é¢ï¼ˆä¿¯è§†ï¼‰çš„è§’åº¦ï¼Œè¿™é‡Œè§’åº¦ç»´åº¦çš„ç¡®å®æœ¬èº«å°±ä¸ºäºŒç»´æ–¹æ³•æä¾›äº†å¾ˆå¥½çš„å…¥å£</p><p>PointRCNN æå‡ºçš„è´¡çŒ®ï¼š</p><ol><li>æå‡ºäº† 3D é€‰æ¡†ç”Ÿæˆç®—æ³•ï¼Œa bottom-up point cloud-based 3D bounding box proposal generation algorithm</li><li>æå‡ºäº† bin-based lossesï¼Œæå‡ç½‘ç»œè¡¨ç°ä¸æ”¶æ•›é€Ÿåº¦</li><li>ä½¿ç”¨è§„èŒƒå˜æ¢ Canonical transformation</li></ol><p>åä¸¤ä¸ªè´¡çŒ®<strong>ä¼¼ä¹</strong>åœ¨æŒ‡å‘ä¸¤ä¸ªæ–¹å‘ï¼šç½‘ç»œæ›´å€¾å‘ç”±æ˜“åˆ°éš¾çš„å­¦ä¹ ï¼Œç½‘ç»œæ›´æ“…äºå­¦ä¹ è§„èŒƒåŒ–çš„æ•°æ®</p><h2 id="PointRCNN-Architecture"><a href="#PointRCNN-Architecture" class="headerlink" title="PointRCNN Architecture"></a>PointRCNN Architecture</h2><p><img src="/archives/51543c70/image-20211006164534924.png" style="zoom: 80%;"></p><p>PointRCNN çš„å­¦ä¹ åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><p>3D é€‰æ¡†ç”Ÿæˆ proposal generationï¼Œä½¿ç”¨ PointNet++ æå–æ¯ä¸€ä¸ªç‚¹çš„ç‰¹å¾å‘é‡ï¼Œä½¿ç”¨è¿™äº›å‘é‡é¢„æµ‹å‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹ï¼Œå¹¶ç”Ÿæˆåˆæ­¥é€‰æ¡†</p></li><li><p>3D é€‰æ¡†ç»†åŒ– box refinementï¼Œåˆ©ç”¨åˆæ­¥æå–çš„é€‰æ¡†ï¼Œå†å¯¹è¿™äº›é€‰æ¡†è¿›è¡Œç²¾ç»†åŒ–å¤„ç†</p></li></ol><h3 id="Stage-1-3D-é€‰æ¡†ç”Ÿæˆ"><a href="#Stage-1-3D-é€‰æ¡†ç”Ÿæˆ" class="headerlink" title="Stage-1: 3D é€‰æ¡†ç”Ÿæˆ"></a>Stage-1: 3D é€‰æ¡†ç”Ÿæˆ</h3><h4 id="å‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹åˆ†å‰²"><a href="#å‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹åˆ†å‰²" class="headerlink" title="å‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹åˆ†å‰²"></a>å‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹åˆ†å‰²</h4><p>è®ºæ–‡ä½¿ç”¨ PointNet++ with multi-scale grouping ä½œä¸º backboneï¼Œæå–æ¯ä¸€ä¸ªç‚¹çš„ç‰¹å¾å‘é‡ï¼Œæ¯ä¸ªç‚¹çš„ç‰¹å¾å‘é‡æ˜¯å…·æœ‰ä¸€å®šçš„æ„Ÿå—é‡çš„ï¼Œä¹Ÿå°±æ˜¯åŒ…å«äº†å±€éƒ¨èŒƒå›´çš„ä¿¡æ¯ã€‚å½“ç„¶è¿™ä¸ª backbone ä¹Ÿå¯ä»¥æ¢æˆå…¶ä»–ç½‘ç»œç»“æ„ï¼Œå¯èƒ½æ•ˆæœä¼šæ›´å¥½</p><p>ç°åœ¨è·å¾—äº†é€ç‚¹çš„ç‰¹å¾å‘é‡ point-wise feature vectorï¼Œå…ˆä½¿ç”¨è¿™äº›ç‰¹å¾å‘é‡åšå‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹çš„åˆ†ç±»ä»»åŠ¡ï¼Œå…¶æŸå¤±å‡½æ•°ä¸º focal loss</p><script type="math/tex; mode=display">\mathcal{L}_{\text {focal }}\left(p_{t}\right)=-\alpha_{t}\left(1-p_{t}\right)^{\gamma} \log \left(p_{t}\right)\\\text{where }p_{t}=\left\{\begin{array}{ll}p & \text { for forground point } \\ 1-p & \text { otherwise }\end{array}\right.</script><p>å¯ä»¥çœ‹åˆ°åœ¨ Î³ æ¯”è¾ƒå¤§æ—¶ï¼Œå¤§éƒ¨åˆ†çš„losså€¼éƒ½æ˜¯æ¯”è¾ƒä½çš„ï¼Œé™¤éç½‘ç»œçš„é¢„æµ‹éå¸¸çš„ç¦»è°±ï¼Œæƒ©ç½šæ‰ä¼šæ€¥å‰§å¢åŠ ã€‚å¯ä»¥è¯´ focal loss èƒ½å¤Ÿå‡è½»æƒ©ç½šï¼ŒæŠŠ loss çš„æƒé‡ focus åœ¨æ¯”è¾ƒéš¾çš„æ ·æœ¬ä¸Š</p><p><img src="/archives/51543c70/a8c1f242-8cf0-4310-bd10-a488658a3463-16335112903811.png" style="zoom: 80%;"></p><p>æ›´è¯¦ç»†çš„è¯´æ˜ï¼Œ<a href="https://zhuanlan.zhihu.com/p/122542747">çŸ¥ä¹</a></p><h4 id="é€‰æ¡†ç”Ÿæˆ"><a href="#é€‰æ¡†ç”Ÿæˆ" class="headerlink" title="é€‰æ¡†ç”Ÿæˆ"></a>é€‰æ¡†ç”Ÿæˆ</h4><p>ç»è¿‡äº†å‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹çš„äºŒå…ƒåˆ†ç±»ä»»åŠ¡ï¼Œç½‘ç»œå°±è¦æ­£å¼è¿›è¡Œé€‰æ¡†ç”Ÿæˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç½‘ç»œä»…é‡‡ç”¨å‰æ™¯ç‚¹æ¥ç”Ÿæˆé€‰æ¡†ï¼Œå°½ç®¡åœ¨ç½‘ç»œè®­ç»ƒä¹‹åˆï¼Œå‰æ™¯ç‚¹å’ŒèƒŒæ™¯ç‚¹çš„åˆ†ç±»ç»“æœå¹¶ä¸é è°±ï¼Œä½†éšç€è®­ç»ƒçš„æ·±å…¥ä¼šè¶Šæ¥è¶Šå‡†ç¡®</p><p>æ€æ ·é€šè¿‡å‰æ™¯ç‚¹ç”Ÿæˆé€‰æ¡†å‘¢ï¼Ÿä¸€ä¸ªç®€å•çš„æƒ³æ³•å°±æ˜¯ï¼šæ¯ä¸€ä¸ªç‚¹éƒ½å»å›å½’é¢„æµ‹è¯¥ç‚¹æ‰€å±çš„é€‰æ¡†ã€‚è®ºæ–‡åœ¨æŸäº›ç›®æ ‡ä¸Šé‡‡å–äº†å›å½’çš„æ€æƒ³ï¼Œåœ¨ä¸€äº›é‡è¦ç›®æ ‡ä¸Šé‡‡ç”¨äº†åˆ†ç±»+å›å½’çš„é¢„æµ‹æ–¹æ³•ï¼Œè®ºæ–‡ç§°è¿™ç§æ€æƒ³ä¸º bin-basedã€‚ç°åœ¨æ¥çœ‹çœ‹åœ¨è¿™ä¸€é˜¶æ®µç½‘ç»œæƒ³è¦é¢„æµ‹çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œ</p><script type="math/tex; mode=display">\begin{array}{l}\operatorname{bin}_{x}^{(p)}=\left\lfloor\frac{x^{p}-x^{(p)}+\mathcal{S}}{\delta}\right\rfloor, \operatorname{bin}_{z}^{(p)}=\left\lfloor\frac{z^{p}-z^{(p)}+\mathcal{S}}{\delta}\right\rfloor \\\operatorname{res}_{u \in\{x, z\}}^{(p)}=\frac{1}{\mathcal{C}}\left(u^{p}-u^{(p)}+\mathcal{S}-\left(\operatorname{bin}_{u}^{(p)} \cdot \delta+\frac{\delta}{2}\right)\right),(2) \\\operatorname{res}_{y}^{(p)}=y^{p}-y^{(p)}\end{array}</script><p>ç»“åˆä¸‹é¢è¿™å¼ å›¾æ¥è§£é‡Šä¸€ä¸‹å…¶ä¸­çš„å˜é‡</p><p><img src="/archives/51543c70/image-20211006172654158.png" style="zoom: 80%;"></p><p>$(x^{(p)}, y^{(p)}, z^{(p)})$ ä»£è¡¨çš„æ˜¯å‰æ™¯ç‚¹çš„åæ ‡ï¼Œ$(x^{p}, y^{p}, z^{p})$ ä»£è¡¨çš„æ˜¯ç›®æ ‡ä¸­å¿ƒç‚¹çš„åæ ‡ï¼Œå…¶ä½™é‡å‡ä¸ºå¸¸é‡ï¼Œå¦‚ S ä¸ºæœç´¢èŒƒå›´ï¼ŒÎ´ ä¸º bin çš„é•¿åº¦ï¼ŒC ä¸ºå½’ä¸€åŒ–å¸¸é‡ã€‚åœ¨æ–‡ç« å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å‡ºï¼Œå¦‚æœè¶…å‡ºäº†æœç´¢èŒƒå›´æ˜¯å¦å°±ä¸ä½¿ç”¨è¯¥ç‚¹è¿›è¡Œé¢„æµ‹ï¼Œæ‰€ä»¥ä¸å¤ªç†è§£è¿™é‡Œæœç´¢èŒƒå›´çš„æ„ä¹‰</p><p>ç°åœ¨å¯ä»¥å…·ä½“æ¥çœ‹ç›®æ ‡çš„å«ä¹‰ï¼Œé¦–å…ˆæ˜¯ $(bin_x^{(p)}, bin_z^{(p)})$ å¯ä»¥å°†å…¶çœ‹ä½œä¸­å¿ƒç‚¹ç›¸å¯¹äºå‰æ™¯ç‚¹çš„æ …æ ¼åæ ‡ã€‚ç„¶åæ˜¯æ®‹å·®ï¼Œå¯¹äº x, z åæ ‡è®¡ç®—äº†æ …æ ¼åæ ‡å’Œå®é™…åæ ‡çš„æ®‹å·®ï¼Œå¯¹äº y åæ ‡åˆ™ç›´æ¥è®¡ç®—ä¸­å¿ƒç‚¹ç›¸å¯¹äºå‰æ™¯ç‚¹çš„å·®è·</p><p>æƒ³è¦å¾—åˆ°çš„é€‰æ¡†æœ‰7ä¸ªå˜é‡  $(x, y, z, w, h, l, \theta)$ï¼Œä¸Šé¢ä»…æåˆ°äº†3ä¸ªï¼Œå‰©ä½™çš„å››ä¸ªä¸­ï¼Œè§’åº¦ Î¸ é‡‡å–å’Œ x, z ç±»ä¼¼çš„æ€è·¯ä½¿ç”¨ bin-based æ€æƒ³ï¼Œå°†è§’åº¦åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼›è€Œé€‰æ¡†çš„é•¿æ¬¾é«˜åˆ™é‡‡å–å’Œ y ç±»ä¼¼çš„æ€è·¯ï¼Œç›´æ¥é¢„æµ‹å…¶æ®‹å·®ï¼Œå…¶æ®‹å·®ä¸ºè¯¥æ ‡ç­¾ä¸æ•´ä¸ªæ•°æ®é›†çš„å¹³å‡å€¼çš„å·®</p><p>å¦‚æœå¾—åˆ°äº†ä»¥ä¸Šé¢„æµ‹å€¼ï¼šbin, resï¼Œé‚£ä¹ˆé€šè¿‡ç®€å•çš„è®¡ç®—ï¼Œå°±èƒ½å¤Ÿå¾—åˆ°é¢„æµ‹é€‰æ¡†çš„æ‰€æœ‰å‚æ•°ã€‚è®¾ç½®è¿™æ ·çš„é¢„æµ‹ç›®æ ‡æ„ä¹‰åœ¨å“ªé‡Œå‘¢ï¼Ÿä»¥ä¸‹ä¸ºä¸ªäººç†è§£ï¼š</p><ol><li>ä½¿ç”¨ bin-based æ€æƒ³ï¼Œå°†å›å½’é—®é¢˜è½¬åŒ–ä¸ºåˆ†ç±»é—®é¢˜ï¼Œå…ˆå»é¢„æµ‹ä¸­å¿ƒç‚¹è½åœ¨å“ªä¸ªæ …æ ¼ä¸­ï¼Œç„¶åå†é€šè¿‡æ®‹å·®ç²¾ç»†è°ƒæ•´</li><li>ä½¿ç”¨æ®‹å·®ï¼Œé¢„æµ‹ä¸€ä¸ªç›¸å¯¹å€¼æ˜¯æ›´å®¹æ˜“çš„ï¼Œé¢„æµ‹ä¸€ä¸ªç»å¯¹å€¼éœ€è¦æ›´å¤šçš„è®¡ç®—ã€‚ä»ç‰©ç†çš„è§’åº¦ä¸Šæ¥è¯´ï¼Œå°±å¥½åƒè§„å®šäº†ä¸€ä¸ªé›¶åŠ¿èƒ½é¢ï¼Œè®©è®¡ç®—å˜å¾—æœ‰æ ‡å‡†</li></ol><p>æœ‰äº†ç›®æ ‡æ ‡ç­¾å’Œç½‘ç»œé¢„æµ‹çš„ç»“æœï¼Œå°±éœ€è¦æŸå¤±å‡½æ•°æ¥è¡¡é‡ç»“æœçš„å¥½å</p><script type="math/tex; mode=display">\begin{array}{l}\mathcal{L}_{\text {bin }}^{(p)}=\sum_{u \in\{x, z, \theta\}}\left(\mathcal{F}_{\mathrm{cls}}\left(\widehat{\mathrm{bin}}_{u}^{(p)}, \operatorname{bin}_{u}^{(p)}\right)+\mathcal{F}_{\text {reg }}\left(\widehat{\operatorname{res}}_{u}^{(p)}, \operatorname{res}_{u}^{(p)}\right)\right) \\\mathcal{L}_{\text {res }}^{(p)}=\sum_{v \in\{y, h, w, l\}} \mathcal{F}_{\text {reg }}\left(\widehat{\operatorname{res}}_{v}^{(p)}, \operatorname{res}_{v}^{(p)}\right) \\\mathcal{L}_{\text {reg }}=\frac{1}{N_{\text {pos }}} \sum_{p \in \text { pos }}\left(\mathcal{L}_{\text {bin }}^{(p)}+\mathcal{L}_{\text {res }}^{(p)}\right)\end{array}</script><p>åˆ†ç±»ä»»åŠ¡é‡‡å–çš„æ˜¯ cross entropy classification lossï¼Œå›å½’ä»»åŠ¡é‡‡å–çš„æ˜¯ smooth L1 loss</p><h4 id="NMS"><a href="#NMS" class="headerlink" title="NMS"></a>NMS</h4><p>ä½¿ç”¨ non-maximum suppression (NMS) ç®—æ³•å»é™¤å¤šä½™çš„é€‰æ¡†ï¼Œå…³äºè®­ç»ƒå’Œæ¨ç†æ—¶çš„å…·ä½“å‚æ•°è¯·å‚è€ƒåŸæ–‡ã€‚ç­›é€‰å‡ºæ¥çš„é€‰æ¡†ï¼Œå°†è¿›è¡Œä¸‹ä¸€æ­¥ç»†åŒ–ï¼ŒNMS å‡ ä¹æ˜¯ç­›é€‰æœ€ç»ˆé€‰æ¡†/ç»†åŒ–é€‰æ¡†å¿…ä¸å¯ç¼ºçš„ï¼Œå¯èƒ½ä¹‹åçš„æ€»ç»“é‡Œä¸ä¼šæï¼Œä½†ä¸ä»£è¡¨æ²¡æœ‰è¿™ä¸€æ­¥éª¤</p><blockquote><p>For training, we use 0.85 as the birdâ€™s view IoU threshold and after NMS we keep top 300 proposals for training the stage-2 sub-network. For inference, we use oriented NMS with IoU threshold 0.8, and only top 100 proposals are kept for the refinement of stage-2 sub-network.</p></blockquote><p>å…³äº NMS çš„å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/makefile/p/nms.html">link</a></p><h3 id="Stage2-3D-é€‰æ¡†ç»†åŒ–"><a href="#Stage2-3D-é€‰æ¡†ç»†åŒ–" class="headerlink" title="Stage2: 3D é€‰æ¡†ç»†åŒ–"></a>Stage2: 3D é€‰æ¡†ç»†åŒ–</h3><p>é€‰æ¡†ç»†åŒ– refinement æœ‰4ä¸ªä¸»è¦æ­¥éª¤ï¼š</p><ol><li><p>å¢å¤§é€‰æ¡† region poolingï¼Œç¨å¾®å°†åˆæ­¥å¾—åˆ°çš„é€‰æ¡†æ‰©å¤§ä¸€ç‚¹ï¼Œä½¿å¾—è¯¥é€‰æ¡†åŒ…å«æ›´å¤šçš„å‰æ™¯ç‚¹ï¼ŒåŒæ—¶å‰”é™¤é€‰æ¡†ä¸­çš„èƒŒæ™¯ç‚¹ã€‚è¿™å¯¹ Stage-1 çš„åˆ†å‰²ä»»åŠ¡æœ‰ä¸€å®šè¦æ±‚</p></li><li><p>è§„èŒƒå˜æ¢ canonical transformationï¼Œå¯¹æ¯ä¸ªé€‰æ¡†å»ºç«‹äº†ä¸€ä¸ªä»¥è‡ªå·±ä¸ºä¸­å¿ƒçš„<strong>ä¸ªä½“åæ ‡ç³»</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="/archives/51543c70/4c790bdd-2912-45d4-ab7a-31de52926ed6-16335194333043.png" style="zoom: 80%;"></p></li><li><p>ç‰¹å¾å­¦ä¹  feature learning</p></li><li><p>ç»†åŒ–ä¸åˆ†ç±» refinement &amp; classification</p></li></ol><p>ç°åœ¨å¯¹ç‰¹å¾å­¦ä¹ å’Œé‡æ–°ç»†åŒ–è¿›è¡Œè¯¦ç»†åœ°äº†è§£</p><h4 id="ç‰¹å¾å­¦ä¹ "><a href="#ç‰¹å¾å­¦ä¹ " class="headerlink" title="ç‰¹å¾å­¦ä¹ "></a>ç‰¹å¾å­¦ä¹ </h4><p>ç”±äºç»è¿‡äº†è§„èŒƒå˜æ¢ä¸¢å¤±äº†æ·±åº¦ä¿¡æ¯ï¼Œä¸ºæ¯ä¸€ä¸ªç‚¹åŠ ä¸Šäººä¸ºæ„é€ çš„æ·±åº¦ç‰¹å¾</p><script type="math/tex; mode=display">d^{(p)} = \sqrt{(x^{(p)})^2+ (y^{(p)})^2 + (z^{(p)})^2}</script><p>æ¯ä¸ªç‚¹é™¤äº†æ·±åº¦ç‰¹å¾å¤–ï¼Œè¿˜å¢åŠ äº†åå°„å¼ºåº¦ç‰¹å¾ r å’Œåˆ†å‰²é¢ç½© mã€‚å°†è¿™äº›è§„èŒƒå˜æ¢å¹¶ä¸”å¢å¼ºåçš„ç‰¹å¾ï¼Œé€å…¥åˆ°ä¸€ä¸ª MLP ä¸­è¿›è¡Œè½¬æ¢å¾—åˆ°ä¸€ä¸ªè¾“å‡ºï¼Œå°†è¯¥è¾“å‡ºä¸ PointNet++ ä¸­å­¦ä¹ çš„è¯­ä¹‰ç‰¹å¾è¿æ¥èµ·æ¥ï¼Œè¿›è¡Œæœ€åçš„ç»†åŒ–å·¥ä½œ</p><p><img src="/archives/51543c70/image-20211006193601408.png" style="zoom: 80%;"></p><h4 id="ç»†åŒ–ä¸åˆ†ç±»"><a href="#ç»†åŒ–ä¸åˆ†ç±»" class="headerlink" title="ç»†åŒ–ä¸åˆ†ç±»"></a>ç»†åŒ–ä¸åˆ†ç±»</h4><p>è¿™é‡Œçš„å­¦ä¹ è¿‡ç¨‹å’Œ Stage-1 ä¸­çš„å­¦ä¹ è¿‡ç¨‹æ˜¯ç›¸ä¼¼çš„ã€‚é¢„æµ‹ç›®æ ‡ä¾ç„¶ä½¿ç”¨æ˜¯ bin-based æ€æƒ³ï¼Œä¸è¿‡æ˜¯åœ¨è§„èŒƒå˜åŒ–åçš„åæ ‡ä¸‹è¿›è¡Œï¼Œè€Œä¸”ä»…å¯¹åœ¨ Stage-1 äº§ç”Ÿçš„åŸºç¡€é€‰æ¡†å†…çš„ç‚¹è¿›è¡Œè®¡ç®—ã€‚å…¶å…·ä½“é¢„æµ‹ç›®æ ‡å€¼å°±ä¸å†èµ˜è¿°ï¼Œè®ºæ–‡é‡Œç»™å‡ºäº†è§„èŒƒå˜åŒ–åçš„ ground truth bounding box å¦‚ä½•è®¡ç®—</p><script type="math/tex; mode=display">\tilde{\mathbf{b}}_{i}^{\mathrm{gt}}=\left(x_{i}^{\mathrm{gt}}-x_{i}, y_{i}^{\mathrm{gt}}-y_{i}, z_{i}^{\mathrm{gt}}-z_{i}, h_{i}^{\mathrm{gt}}, w_{i}^{\mathrm{gt}}, l_{i}^{\mathrm{gt}}, \theta_{i}^{\mathrm{gt}}-\theta_{i}\right)</script><p>å…¶ä¸­æ²¡æœ‰ gt ä¸Šæ ‡çš„å€¼å³ä¸ºå¯¹åº”åŸºç¡€é€‰æ¡†çš„å‚æ•°ã€‚é™¤äº†å¯¹é€‰æ¡†è¿›è¡Œè¿›ä¸€æ­¥çš„ç²¾ç»†åŒ–å¤–ï¼Œè¿˜è¦æ‰§è¡Œå¤šåˆ†ç±»ä»»åŠ¡ï¼Œè¯¥å¤šåˆ†ç±»ä»»åŠ¡çš„ç½‘ç»œè®ºæ–‡å¹¶æ²¡æœ‰è¯¦ç»†è¯´æ˜ï¼Œåº”è¯¥å¯ä»¥å‚ç…§ PointNet ç³»åˆ—ã€‚Region pooling çš„æ–¹æ³•æ˜¯åœ¨é€‰æ¡†ä¸­çš„ç‚¹é‡Œéšæœºé‡‡æ ·512ä¸ªï¼Œä¾¿äºä¹‹åè¾“å…¥ MLP </p><p>æœ€ç»ˆå°†ç²¾ç»†åŒ–ä»»åŠ¡å’Œå¤šåˆ†ç±»ä»»åŠ¡çš„æŸå¤±å‡½æ•°ç›¸åŠ ï¼Œå¾—åˆ°æœ€ç»ˆçš„æŸå¤±å‡½æ•°</p><script type="math/tex; mode=display">\begin{aligned}\mathcal{L}_{\text {refine }}=& \frac{1}{\| \mathcal{B}\|} \sum_{i \in \mathcal{B}} \mathcal{F}_{\text {cls }}\left(\operatorname{prob}_{i}, \text { label }_{i}\right) \\&+\frac{1}{\left\|\mathcal{B}_{\text {pos }}\right\|} \sum_{i \in \mathcal{B}_{\text {pos }}}\left(\tilde{\mathcal{L}}_{\text {bin }}^{(i)}+\tilde{\mathcal{L}}_{\text {res }}^{(i)}\right)\end{aligned}</script><p>å…¶ä¸­ positive bounding box å®šä¹‰ä¸ºå¦‚ä¸‹</p><blockquote><p>For training the box classification head, a proposal is considered as positive if its maximum 3D IoU with ground-truth boxes is above 0.6</p></blockquote><p>åœ¨æµ‹è¯•\æ¨ç†æ—¶ä¸ºäº†é€‰å‡ºæœ€ç»ˆå¾—åˆ†æœ€é«˜çš„é€‰æ¡†ï¼Œè¿˜è¦å†ä½¿ç”¨ä¸€æ¬¡ NMS ç®—æ³•</p><blockquote><p>We finally apply oriented NMS with birdâ€™s view IoU threshold 0.01 to remove the overlapping bounding boxes</p></blockquote><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><p>éœ€è¦æ³¨æ„çš„æ˜¯ PointRCNN ä¸¤ä¸ªé˜¶æ®µæ˜¯åˆ†å¼€è®­ç»ƒçš„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„è®­ç»ƒã€‚åˆ†å¼€è®­ç»ƒå’Œç«¯å¯¹ç«¯è®­ç»ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿å—ï¼Ÿ</p><h3 id="KITTI"><a href="#KITTI" class="headerlink" title="KITTI"></a>KITTI</h3><p><img src="/archives/51543c70/image-20211006202449787.png"></p><p>å…³äº average precision (AP) å’Œ recall å‚è€ƒé“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/56961620">çŸ¥ä¹</a></p><h3 id="Ablation-study"><a href="#Ablation-study" class="headerlink" title="Ablation study"></a>Ablation study</h3><p><img src="/archives/51543c70/image-20211006202739285.png"></p><p>å¯ä»¥çœ‹åˆ°è§„èŒƒå˜æ¢çš„ä½œç”¨éå¸¸å¤§ï¼Œå¤§å¾—ç¦»è°±</p><h3 id="Bin-based-loss-recall"><a href="#Bin-based-loss-recall" class="headerlink" title="Bin-based loss recall"></a>Bin-based loss recall</h3><p><img src="/archives/51543c70/image-20211006202846004.png"></p><p>è“è‰²æ›²çº¿ä¸ºè®ºæ–‡ä¸­ä½¿ç”¨çš„æŸå¤±å‡½æ•°ï¼Œæ•ˆæœæœ€å¥½</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>PointRCNN ä¸º 2-Stage ç½‘ç»œï¼Œæå‡ºçš„ bin-based æŸå¤±å‡½æ•°å’Œè§„èŒƒå˜æ¢ canonical transformation æå‡äº†ç½‘ç»œçš„æ€§èƒ½ã€‚å¹¶ä¸”ç›´æ¥ä½¿ç”¨ç‚¹äº‘æ•°æ®ï¼Œå‡å°‘äº†åŸå§‹ç‚¹äº‘çš„ä¿¡æ¯æŸå¤±ã€‚ä½†æ˜¯æ•´ä½“çœ‹ä¸‹æ¥æ„Ÿè§‰ trick å’Œç»†èŠ‚æŒºå¤šçš„ï¼Œæ¯”å¦‚å…¶ region pooling å’Œå‰æ™¯èƒŒæ™¯ç‚¹åˆ†å‰²ç­‰ç­‰ï¼Œè®ºæ–‡é‡Œå¹¶æ²¡æœ‰è®°å½•å…¶æ¨ç†é€Ÿåº¦ï¼Œåœ¨å…¶ä»–æ–‡çŒ®ä¸­æ‰¾åˆ°å¤§çº¦ä¸º 10 fpsï¼Œæˆ–è®¸ä»Šåéœ€è¦åœ¨é€Ÿåº¦ä¸Šè¿›è¡Œæ›´å¿«çš„çªç ´</p><h2 id="TO-READ"><a href="#TO-READ" class="headerlink" title="TO READ"></a>TO READ</h2><p>LiDAR R-CNN</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Point Cloud </tag>
            
            <tag> PointRCNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch cn231n note (dev)</title>
      <link href="/archives/88f138aa.html"/>
      <url>/archives/88f138aa.html</url>
      
        <content type="html"><![CDATA[<h1 id="Pytorch-cs231n-note"><a href="#Pytorch-cs231n-note" class="headerlink" title="Pytorch cs231n note"></a>Pytorch cs231n note</h1><p>è·Ÿç€ä½œä¸šè¿‡ä¸€éï¼Œçœ‹çœ‹æœ‰å“ªäº›éœ€è¦ç†Ÿæ‚‰çš„ pytorch çŸ¥è¯†ç‚¹ï¼Œç¬”è®°é‡Œçš„è‹±æ–‡æ˜¯ä» notebook ä¸­çš„åŸæ–‡</p><p>ç°åœ¨çœ‹æ¥2017å¹´çš„ cs231n è¯¾ç¨‹è§†é¢‘å·²ç»æœ‰å¾ˆå¤šå†…å®¹éœ€è¦è¡¥å……äº†ï¼Œå°¤å…¶æ˜¯ç°åœ¨ transformer å¾ˆç«çš„æƒ…å†µä¸‹</p><p>åŸæ¥è¿™ä¸ªè€å¸ˆ <strong>Justin Johnson</strong> å·²ç»ä¸åœ¨ Stanford äº†ï¼Œç°åœ¨åœ¨UMich <a href="https://web.eecs.umich.edu/~justincj/">ä¸ªäººä¸»é¡µ</a> å¼€äº†ä¸€ä¸ªè®¡ç®—æœºè§†è§‰çš„è¯¾ç¨‹ <a href="https://web.eecs.umich.edu/~justincj/teaching/eecs498/FA2020/">Deep Learning for Computer Vision</a>ï¼Œè¿™ä¸ªè¯¾ç¨‹æ¯”è¾ƒæ–°ï¼Œæœ‰2020å¹´çš„æ•™å­¦èµ„æº</p><h2 id="How-do-I-learn-PyTorch"><a href="#How-do-I-learn-PyTorch" class="headerlink" title="How do I learn PyTorch?"></a>How do I learn PyTorch?</h2><p>One of our former instructors, Justin Johnson, made an excellent <a href="https://github.com/jcjohnson/pytorch-examples">tutorial</a> for PyTorch. (è¿™ä¸ª github ä»“åº“æ„Ÿè§‰å¥½è€äº†ï¼Œå¯ä»¥çœ‹çœ‹ pytorch <a href="https://pytorch.org/tutorials/">å®˜æ–¹ tutorial</a>)</p><p>You can also find the detailed <a href="http://pytorch.org/docs/stable/index.html">API doc</a> here. If you have other questions that are not addressed by the API docs, the <a href="https://discuss.pytorch.org/">PyTorch forum</a> is a much better place to ask than StackOverflow.</p><h2 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h2><p>æ£€æŸ¥ cuda</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># basic check</span>torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>version<span class="token punctuation">.</span>cuda<span class="token comment"># cuda device</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">,</span> device_oridinal<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Part-1-Preparation"><a href="#Part-1-Preparation" class="headerlink" title="Part 1: Preparation"></a>Part 1: Preparation</h2><h3 id="torchvision-transform"><a href="#torchvision-transform" class="headerlink" title="torchvision.transform"></a>torchvision.transform</h3><p><strong>torchvision ç‹¬ç«‹äº torchã€‚torchvision åŒ…ç”±æµè¡Œçš„æ•°æ®é›†ï¼ˆtorchvision.datasetsï¼‰ã€æ¨¡å‹æ¶æ„(torchvision.models)å’Œç”¨äºè®¡ç®—æœºè§†è§‰çš„å¸¸è§å›¾åƒè½¬æ¢ç»„æˆ t(torchvision.transforms)</strong></p><p>The torchvision.transforms package provides tools for preprocessing data and for performing data augmentation</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torchvison<span class="token punctuation">.</span>transfoms <span class="token keyword">as</span> T<span class="token comment"># T.Compose: Composes several transforms together</span><span class="token comment"># T.ToTensor: Converts a PIL Image or numpy.ndarray (H x W x C) in the range</span><span class="token comment"># T.Normalize: Normalize a tensor image with mean and standard deviation</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span> to a torch<span class="token punctuation">.</span>FloatTensor of shape <span class="token punctuation">(</span>C x H x W<span class="token punctuation">)</span> <span class="token keyword">in</span> the <span class="token builtin">range</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span>transform <span class="token operator">=</span> T<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>                T<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                T<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.4914</span><span class="token punctuation">,</span> <span class="token number">0.4822</span><span class="token punctuation">,</span> <span class="token number">0.4465</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0.2023</span><span class="token punctuation">,</span> <span class="token number">0.1994</span><span class="token punctuation">,</span> <span class="token number">0.2010</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="torchvision-dataset"><a href="#torchvision-dataset" class="headerlink" title="torchvision.dataset"></a>torchvision.dataset</h3><p>ä½¿ç”¨ CIFAR10 æ•°æ®é›†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>datasets <span class="token keyword">as</span> dset<span class="token comment"># args</span><span class="token comment"># root: root directory of dataset where it might exist or will be saved to if download</span><span class="token comment"># train: if true create dataset from traning set</span><span class="token comment"># transform: A function/transform that takes in an PIL image and returns a transformed version</span>cifar10_train <span class="token operator">=</span> dset<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span><span class="token string">'./cs231n/datasets'</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">)</span>cifar10_test <span class="token operator">=</span> dset<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span><span class="token string">'./cs231n/datasets'</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œéœ€è¦å­¦ä¹ å¤„ç†æ•°æ®é›†å¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•</p><h4 id="DataLoader-amp-Sampler"><a href="#DataLoader-amp-Sampler" class="headerlink" title="DataLoader &amp; Sampler"></a>DataLoader &amp; Sampler</h4><blockquote><p>DataLoader: Combines a dataset and a sampler, and provides single- or multi-process iterators over the dataset.</p></blockquote><p>åˆ›å»º train, val, test ä¸‰ä¸ª DataLoader</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">NUM_TRAIN <span class="token operator">=</span> <span class="token number">49000</span><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoaderfromt torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> samplerloader_train <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>cifar10_train<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> sampler<span class="token operator">=</span>sampler<span class="token punctuation">.</span>SubsetRandomSampler<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>NUM_TRAIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>loader_val <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>cifar10_train<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> sampler<span class="token operator">=</span>sampler<span class="token punctuation">.</span>SubsetRandomSampler<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>NUM_TRAIN<span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>loader_test <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>cifar10_test<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</p><h3 id="train-a-model"><a href="#train-a-model" class="headerlink" title="train a model"></a>train a model</h3><h2 id="Part-2-Barebones-by-PyTorch"><a href="#Part-2-Barebones-by-PyTorch" class="headerlink" title="Part 2: Barebones by PyTorch"></a>Part 2: Barebones by PyTorch</h2><h3 id="Autograd-engine"><a href="#Autograd-engine" class="headerlink" title="Autograd engine"></a>Autograd engine</h3><blockquote><p>When we create a PyTorch Tensor with <code>requires_grad=True</code>, then operations involving that Tensor will not just compute values; they will also build up a computational graph in the background</p></blockquote><h3 id="torch-nn-functional"><a href="#torch-nn-functional" class="headerlink" title="torch.nn.functional"></a>torch.nn.functional</h3><p>å„ç§å‡½æ•°éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œä½œä¸šé‡Œç”¨äº† relu, conv2d</p><h4 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h4><p>Run into errors when using  F.conv2d</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>funtional <span class="token keyword">as</span> Ffilters <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>inputs <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token comment"># the next line produce error: Illegal instruction (core dumped)</span>x <span class="token operator">=</span> F<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> filters<span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡æ›´æ¢ pytorch ç‰ˆæœ¬å¾—åˆ°è§£å†³ï¼Œå¸è½½ <code>conda uninstall pytorch</code></p><p>é‡æ–°ä¸‹è½½ <code>conda install pytorch==1.2.0 torchvision==0.4.0</code></p><p>nn.Conv2d å’Œ nn.function.conv2d æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå°¤å…¶æ˜¯ä¼ å…¥çš„å‚æ•°çœ‹</p><h3 id="Kaiming-normalization"><a href="#Kaiming-normalization" class="headerlink" title="Kaiming normalization"></a>Kaiming normalization</h3><p>è¿™ä¸ªåˆå§‹åŒ–æ˜¯ä»€ä¹ˆï¼Ÿå¾…æ•´ç†</p><h3 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h3><p>ä½¿ç”¨ cuda è°ƒç”¨ GPU å¤±è´¥ </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># run: torch.randn(shape, device=device, dtype=dtype)</span>RuntimeError: CUDA error: all CUDA-capable devices are busy or unavailable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ£€æŸ¥äº† <code>torch.cuda.is_available()</code> è¿˜æœ‰ <code>torch.version.cuda</code> éƒ½æ˜¯å¥½çš„ï¼Œç½‘ä¸Šä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•ï¼Œåœ¨ StackOverflow ä¸Šæ‰¾åˆ°äº†æ–¹æ³•ï¼š<strong>é‡å¯!!!</strong> ï¼ˆå¯æ¶ï¼Œé‡å¯ç¡®å®ç®¡ç”¨ï¼‰</p><h3 id="to-device"><a href="#to-device" class="headerlink" title="to_device"></a>to_device</h3><h3 id="with-no-grad-with-torch-no-grad-ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#with-no-grad-with-torch-no-grad-ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="with no_grad(), with torch.no_grad() ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>with no_grad(), with torch.no_grad() ä»€ä¹ˆæ„æ€ï¼Ÿ</h3><h3 id="æ ¼å¼åŒ–è¾“å‡º-2f-ä»€ä¹ˆæ„æ€"><a href="#æ ¼å¼åŒ–è¾“å‡º-2f-ä»€ä¹ˆæ„æ€" class="headerlink" title="æ ¼å¼åŒ–è¾“å‡º %.2f%% ä»€ä¹ˆæ„æ€"></a>æ ¼å¼åŒ–è¾“å‡º %.2f%% ä»€ä¹ˆæ„æ€</h3><h2 id="Part-3-Pytorch-Module-API"><a href="#Part-3-Pytorch-Module-API" class="headerlink" title="Part 3: Pytorch Module API"></a>Part 3: Pytorch Module API</h2><p>ä¸Šé¢çš„ Barebone è¦æ±‚æˆ‘ä»¬æ‰‹åŠ¨è·Ÿè¸ªæ‰€æœ‰å‚æ•°å¼ é‡ï¼Œéå¸¸ä¸æ–¹ä¾¿ï¼ŒPytorch æä¾›äº† <code>nn.Module</code> API èƒ½å¤Ÿè®©æˆ‘ä»¬å®šä¹‰ä»»æ„çš„ç½‘ç»œç»“æ„ï¼ŒåŒæ—¶è¿½è¸ªæ‰€æœ‰ç½‘ç»œä¸­çš„å‚æ•°</p><p>è¿˜æœ‰ä¼˜åŒ–ç­–ç•¥çš„é€‰æ‹© <code>torch.optim</code> </p><p>ä½¿ç”¨æ­¥éª¤ï¼š</p><ol><li><p><code>nn.Module</code> ä½œä¸ºå­ç±»ç»§æ‰¿</p><p>Q: è¿™ä¸ªç±»æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå¦‚æœä¸å®šä¹‰è¿™ä¸ªç±»ï¼Œç›´æ¥ç»„åˆè¿™ä¸ªç±»</p></li><li><p>åœ¨ constructor <code>__init__()</code> ä¸­å®šä¹‰å¥½éœ€è¦çš„ç½‘ç»œå±‚ä½œä¸ºç±»çš„å±æ€§ï¼Œ<strong>æ³¨æ„ï¼Œä¸€å®šè¦è¿è¡Œ </strong><code>super().__init__()</code></p><p>è¿˜å¯ä»¥ç”¨ <code>nn.init</code> å¯¹ç½‘ç»œå‚æ•°è¿›è¡Œä¸åŒçš„åˆå§‹åŒ–</p></li><li><p>åœ¨ <code>forward()</code> æ–¹æ³•ä¸­å®šä¹‰ç½‘ç»œçš„è¿æ¥</p></li></ol><p>ä¼˜åŒ–çš„æ—¶å€™è¦å…ˆæ¸…é›¶æ¢¯åº¦ <code>optimizer.zero_grad()</code></p><h2 id="Part-4-Pytorch-Sequential-API"><a href="#Part-4-Pytorch-Sequential-API" class="headerlink" title="Part 4: Pytorch Sequential API"></a>Part 4: Pytorch Sequential API</h2><p>Pytorch å®šä¹‰äº†ä¸€ä¸ªæ›´æ–¹ä¾¿çš„ Module: <code>nn.Sequential</code>ï¼Œæ¥å®ç°é¡ºåºè¿æ¥ç½‘ç»œï¼Œä¸éœ€è¦åƒ <code>nn.Module</code> ä¸€æ ·åšä¸‰ä¸ªæ­¥éª¤</p><p><code>nn.Sequential</code> è‡ªèº«ä¹Ÿæ˜¯å¯ä»¥åµŒå¥—çš„</p><h2 id="Part-5-CIFAR-10-open-ended-challenge"><a href="#Part-5-CIFAR-10-open-ended-challenge" class="headerlink" title="Part 5: CIFAR-10 open-ended challenge"></a>Part 5: CIFAR-10 open-ended challenge</h2><h3 id="Things-you-might-try"><a href="#Things-you-might-try" class="headerlink" title="Things you might try:"></a>Things you might try:</h3><ul><li><strong>Filter size</strong>: Above we used 5x5; would smaller filters be more efficient?</li><li><strong>Number of filters</strong>: Above we used 32 filters. Do more or fewer do better?</li><li><strong>Pooling vs Strided Convolution</strong>: Do you use max pooling or just stride convolutions?</li><li><strong>Batch normalization</strong>: Try adding spatial batch normalization after convolution layers and vanilla batch normalization after affine layers. Do your networks train faster?</li><li><strong>Network architecture</strong>: The network above has two layers of trainable parameters. Can you do better with a deep network? Good architectures to try include:<ul><li>[conv-relu-pool]xN -&gt; [affine]xM -&gt; [softmax or SVM]</li><li>[conv-relu-conv-relu-pool]xN -&gt; [affine]xM -&gt; [softmax or SVM]</li><li>[batchnorm-relu-conv]xN -&gt; [affine]xM -&gt; [softmax or SVM]</li></ul></li><li><strong>Global Average Pooling</strong>: Instead of flattening and then having multiple affine layers, perform convolutions until your image gets small (7x7 or so) and then perform an average pooling operation to get to a 1x1 image picture (1, 1 , Filter#), which is then reshaped into a (Filter#) vector. This is used in <a href="https://arxiv.org/abs/1512.00567">Googleâ€™s Inception Network</a> (See Table 1 for their architecture).</li><li><strong>Regularization</strong>: Add l2 weight regularization, or perhaps use Dropout.</li></ul><p>ä¸Šé¢çš„è¿™äº›é€‰æ‹©éƒ½éå¸¸æœ‰æ„ä¹‰ï¼Œæˆ‘éœ€è¦èƒ½å¤Ÿé€ä¸ªå›ç­”ä»–ä»¬</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Pytorch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pytorch </tag>
            
            <tag> CS231N </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MMDetection é¡¹ç›®</title>
      <link href="/archives/acef3112.html"/>
      <url>/archives/acef3112.html</url>
      
        <content type="html"><![CDATA[<h1 id="MMDetection-é¡¹ç›®"><a href="#MMDetection-é¡¹ç›®" class="headerlink" title="MMDetection é¡¹ç›®"></a>MMDetection é¡¹ç›®</h1><p>ç°åœ¨æ­£å¼å¼€å§‹ MMDetection é¡¹ç›®ï¼ä¹‹å‰æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç”¨ MMDetection æ¥æ£€æµ‹ç½‘çƒæ¯”èµ›ä¸­çš„ç½‘çƒçƒé€Ÿï¼Œä½¿ç”¨äº† Faster-RCNN æ¨¡å‹è¯•äº†ä¸‹ç›®æ ‡æ£€æµ‹ï¼Œå‘ç°å¯¹äºç½‘çƒè¿™ç§å°ç‰©ä½“æ ¹æœ¬æ£€æµ‹ä¸å‡ºæ¥ï¼Œåœ¨è§†é¢‘ä¸­å°±æ˜¯éå¸¸å°çš„ä¸€ä¸ªåƒç´ ç‚¹ã€‚é‚£ä¹ˆèƒ½ä¸èƒ½ä½¿ç”¨è‡ªå·±æ ‡æ³¨çš„æ•°æ®é›†æ¥è®­ç»ƒä¸€ä¸ªå°ç›®æ ‡æ£€æµ‹ï¼ˆä»…ç½‘çƒï¼‰çš„ç½‘ç»œï¼Œæ¥å¯¹ç½‘çƒè§†é¢‘è¿›è¡Œæ£€æµ‹ï¼Ÿç°åœ¨æ¥è¿›è¡Œå…·ä½“çš„è¯•éªŒ</p><h2 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h2><p>ä½¿ç”¨ Labelme è¿›è¡Œæ ‡æ³¨ï¼Œå¹¶è½¬åŒ–ä¸º COCO æ•°æ®é›†ã€‚å°†æ•°æ®é›†æŒ‰ç…§å¦‚ä¸‹ç»“æ„æ’åˆ—</p><pre class="line-numbers language-none"><code class="language-none">mmdetectionâ”œâ”€â”€ dataâ”‚   â”œâ”€â”€ cocoâ”‚   â”‚   â”œâ”€â”€ annotationsâ”‚   â”‚   â”œâ”€â”€ train2017â”‚   â”‚   â”œâ”€â”€ val2017â”‚   â”‚   â”œâ”€â”€ test2017<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ annotations æ”¾ç½® coco format json æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶å¤¹æ”¾ç½®å›¾ç‰‡æ•°æ®é›†</p><h2 id="å‡†å¤‡-config-æ–‡ä»¶"><a href="#å‡†å¤‡-config-æ–‡ä»¶" class="headerlink" title="å‡†å¤‡ config æ–‡ä»¶"></a>å‡†å¤‡ config æ–‡ä»¶</h2><p>ç”±äºæ ‡æ³¨æ–‡ä»¶æ˜¯æœ‰åš segmentation çš„ï¼Œé€‰æ‹© Mask-RCNN ä½œä¸ºæ¨¡å‹</p><ol><li><p>base config: <a href="https://github.com/open-mmlab/mmdetection/blob/master/configs/mask_rcnn/mask_rcnn_r101_fpn_mstrain-poly_3x_coco.py">Mask-RCNN-R101-FPN</a> </p></li><li><p>checkpoint: <a href="https://download.openmmlab.com/mmdetection/v2.0/mask_rcnn/mask_rcnn_r101_fpn_mstrain-poly_3x_coco/mask_rcnn_r101_fpn_mstrain-poly_3x_coco_20210524_200244-5675c317.pth">model</a></p></li></ol><p>æ”¾ç½®åœ¨ <code>/mmdet/config/mask_rcnn</code> ä¸‹ï¼Œå…·ä½“ config æ–‡ä»¶æ”¾åœ¨æ–‡æœ«</p><h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p>ç›®å‰è¿˜æ˜¯ä¸èƒ½è·‘èµ·æ¥ï¼Œé¢„è®¡æ˜¯ config æ–‡ä»¶å’Œæ•°æ®é›† CLASSES çš„åŸå› ï¼Œè¿˜æœ‰è¦æ³¨æ„ config çš„ç»§æ‰¿å…³ç³»ï¼</p><ol><li><p>ç”±äºç»§æ‰¿æœºåˆ¶ï¼Œä½¿ç”¨äº† <code>RepeatDataset</code> ä¸å¯¹åŸæ•°æ®é›†ç±»å‹è¿›è¡Œä¿®æ”¹ï¼Œä¸ç„¶æŠ¥é”™</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">TypeError<span class="token punctuation">:</span> CocoDataset<span class="token punctuation">:</span> __init__<span class="token punctuation">(</span><span class="token punctuation">)</span> got an unexpected keyword argument <span class="token string">'times'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>é‡åˆ°æŠ¥é”™</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">AssertionError<span class="token punctuation">:</span> The `num_classes` <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">in</span> Shared2FCBBoxHead of MMDataParallel does <span class="token keyword">not</span> matches the length of `CLASSES` <span class="token number">80</span><span class="token punctuation">)</span> <span class="token keyword">in</span> RepeatDataset<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¾æ—§æ˜¯ç”±äº <code>ReapeatDataset</code> é€ æˆçš„ï¼Œç”±äºå¯¹è¿™ä¸ªç±»ä¸å¤Ÿäº†è§£ï¼Œæ‰€ä»¥é¢‘ç¹æŠ¥é”™ğŸ˜…è¿™é‡Œçš„é€»è¾‘æ˜¯å› ä¸ºæ²¡æœ‰æŒ‡å®š <code>classes</code>ï¼Œç”±äºåŸ coco æ•°æ®é›†æœ‰80ä¸ªç±»ï¼Œè‡ªå·±çš„ç±»åˆ«ä¸ä¸€å®šæ˜¯åŸ COCO æ•°æ®é›†ç›¸åŒã€‚æ—¢ç„¶æ˜¯ <code>RepeatDataset</code> é‚£ä¹ˆä¸€å®šæ˜¯é‡å¤äº†è‡ªå·±å®šä¹‰çš„æ•°æ®é›†ï¼Œé‚£å°±çœ‹çœ‹å®šä¹‰çš„æ•°æ®é›†ä¸­æ˜¯å¦æŒ‡å®šäº† <code>classes</code>ã€‚ç»“æœä¸€çœ‹ï¼Œæœç„¶æ²¡æœ‰æŒ‡å®šï¼ŒåŠ ä¸Šå°±è§£å†³äº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    samples_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>    workers_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RepeatDataset'</span><span class="token punctuation">,</span>        times<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>        dataset<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>            ann_file<span class="token operator">=</span><span class="token string">'/home/chenhongkun/mmdetection/data/coco/annotations/train.json'</span><span class="token punctuation">,</span>            img_prefix<span class="token operator">=</span><span class="token string">'/home/chenhongkun/mmdetection/data/coco/train2017'</span><span class="token punctuation">,</span>            <span class="token comment"># classes=('tennis', ),</span>            pipeline<span class="token operator">=</span><span class="token punctuation">[</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span>                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadAnnotations'</span><span class="token punctuation">,</span>                    with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                    with_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                    poly2mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span>                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span>                    img_scale<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    multiscale_mode<span class="token operator">=</span><span class="token string">'range'</span><span class="token punctuation">,</span>                    keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span>                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>                    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span>                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span>                    keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'gt_bboxes'</span><span class="token punctuation">,</span> <span class="token string">'gt_labels'</span><span class="token punctuation">,</span> <span class="token string">'gt_masks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        classes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'tennis'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'/home/chenhongkun/mmdetection/data/coco/annotations/train.json'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'/home/chenhongkun/mmdetection/data/coco/train2017'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>è®­ç»ƒäº†ä¸€ä¸ª epoch æ¥çœ‹çœ‹ç»“æœï¼Œå‘ç°å¾ˆéš¾æ£€æµ‹åˆ°å°çš„ç‰©ä½“ã€‚è€Œä¸”ç»è¿‡äº†70ä¸ª epoch çš„è®­ç»ƒï¼Œæœ€å Loss æ²¡æœ‰æŒç»­ä¸‹é™ï¼Œæ„Ÿè§‰ä¼˜åŒ–åœæ­¢äº†ã€‚ç°åœ¨å°è¯•å¢åŠ  batch æ•°é‡ï¼Œä¸‹ä¸€ä¸ªæ‰‹æ®µå°±æ˜¯å‡å°‘å­¦ä¹ ç‡ã€‚æˆ‘ä¹Ÿåœ¨æ€è€ƒä¼šä¸ä¼šæ˜¯ anchor çš„é—®é¢˜ï¼Œå› ä¸º anchor å¤ªå¤§äº†æ ¹æœ¬æ£€æµ‹ä¸åˆ°è¿™ä¹ˆå°çš„ç‰©ä½“</p><p>ç°åœ¨ä¿®æ”¹äº† anchor å¤§å°æ•ˆæœä¸é”™ï¼Œç»§ç»­è®­ç»ƒâ€¦æœ€åå¯è§†åŒ–ç»“æœæ¥çœ‹æœ‰è®¸å¤šé‡å¤çš„ç»“æœï¼ŒNMS çš„é˜ˆå€¼éœ€è¦å†è°ƒä¸€ä¸‹ï¼Œè€Œä¸”ç°åœ¨çš„é¢„æµ‹å€¼éå¸¸ä½ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä¸è¿‡ä½ç½®è¿˜æ˜¯å¯ä»¥æ¥å—</p><p><img src="/archives/acef3112/image-20210920231709443.png" style="zoom:50%;"></p><h2 id="å·¥å…·ç®±"><a href="#å·¥å…·ç®±" class="headerlink" title="å·¥å…·ç®±"></a>å·¥å…·ç®±</h2><ol><li><p><code>print_config.py</code>ï¼Œæ‰“å°å®Œæ•´ config æ–‡ä»¶</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">python tools<span class="token operator">/</span>misc<span class="token operator">/</span>print_config<span class="token punctuation">.</span>py $<span class="token punctuation">{</span>CONFIG<span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token operator">-</span>h<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>options $<span class="token punctuation">{</span>OPTIONS <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>analyze_logs.py</code>ï¼Œå¯ä»¥å°†æ—¥å¿—ä¸­çš„è®°å½•å€¼ç»˜åˆ¶æˆæ›²çº¿å›¾</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">python tools<span class="token operator">/</span>analysis_tools<span class="token operator">/</span>analyze_logs<span class="token punctuation">.</span>py plot_curve <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>keys $<span class="token punctuation">{</span>KEYS<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>title $<span class="token punctuation">{</span>TITLE<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>legend $<span class="token punctuation">{</span>LEGEND<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>backend $<span class="token punctuation">{</span>BACKEND<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>style $<span class="token punctuation">{</span>STYLE<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>out $<span class="token punctuation">{</span>OUT_FILE<span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>tools/analysis_tools/analyze_results.py</code> calculates single image mAP and saves or shows the topk images with the highest and lowest scores based on prediction results. <a href="https://mmdetection.readthedocs.io/en/latest/useful_tools.html#result-analysis">link</a></p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python">python tools<span class="token operator">/</span>analysis_tools<span class="token operator">/</span>analyze_results<span class="token punctuation">.</span>py \      $<span class="token punctuation">{</span>CONFIG<span class="token punctuation">}</span> \      $<span class="token punctuation">{</span>PREDICTION_PATH<span class="token punctuation">}</span> \      $<span class="token punctuation">{</span>SHOW_DIR<span class="token punctuation">}</span> \      <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>show<span class="token punctuation">]</span> \      <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>wait<span class="token operator">-</span>time $<span class="token punctuation">{</span>WAIT_TIME<span class="token punctuation">}</span><span class="token punctuation">]</span> \      <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>topk $<span class="token punctuation">{</span>TOPK<span class="token punctuation">}</span><span class="token punctuation">]</span> \      <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>show<span class="token operator">-</span>score<span class="token operator">-</span>thr $<span class="token punctuation">{</span>SHOW_SCORE_THR<span class="token punctuation">}</span><span class="token punctuation">]</span> \      <span class="token punctuation">[</span><span class="token operator">-</span><span class="token operator">-</span>cfg<span class="token operator">-</span>options $<span class="token punctuation">{</span>CFG_OPTIONS<span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>dataset_converters</code> å·¥å…·ç®±èƒ½å¤Ÿå°†ä¸åŒçš„æ•°æ®é›†æ ¼å¼è½¬ä¸º coco formatï¼Œæ¯”å¦‚ä½¿ç”¨ <code>image2coco.py</code> èƒ½å¤Ÿå°†å›¾ç‰‡ç”Ÿæˆæ²¡æœ‰æ ‡ç­¾çš„ coco format json æ–‡ä»¶</p></li><li><p><a href="https://github.com/Chien-Hung/DetVisGUI/tree/mmdetection">DetVisGUI project</a>ï¼Œä¸ºä¸€ä¸ªå¯è§†åŒ–é¡¹ç›®ï¼Œèƒ½å¤Ÿå°†æ£€æµ‹ç»“æœ <code>result.pkl</code> å¯è§†åŒ–</p></li></ol><h2 id="å®Œæ•´-config-æ–‡ä»¶"><a href="#å®Œæ•´-config-æ–‡ä»¶" class="headerlink" title="å®Œæ•´ config æ–‡ä»¶"></a>å®Œæ•´ config æ–‡ä»¶</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">checkpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>    <span class="token comment"># mark</span>log_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> hooks<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'TextLoggerHook'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># mark</span>custom_hooks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'NumClassCheckHook'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>dist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">'nccl'</span><span class="token punctuation">)</span>log_level <span class="token operator">=</span> <span class="token string">'INFO'</span>load_from <span class="token operator">=</span> <span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/checkpoints/mask_rcnn_r101_fpn_mstrain-poly_3x_coco_20210524_200244-5675c317.pth'</span>resume_from <span class="token operator">=</span> <span class="token boolean">None</span>workflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>dataset_type <span class="token operator">=</span> <span class="token string">'CocoDataset'</span>data_root <span class="token operator">=</span> <span class="token string">'data/coco/'</span>img_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>train_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadAnnotations'</span><span class="token punctuation">,</span>        with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>        with_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>        poly2mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span>        img_scale<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        multiscale_mode<span class="token operator">=</span><span class="token string">'range'</span><span class="token punctuation">,</span>        keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'gt_bboxes'</span><span class="token punctuation">,</span> <span class="token string">'gt_labels'</span><span class="token punctuation">,</span> <span class="token string">'gt_masks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>test_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>        transforms<span class="token operator">=</span><span class="token punctuation">[</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    samples_per_gpu<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span>  <span class="token comment"># mark</span>    workers_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RepeatDataset'</span><span class="token punctuation">,</span>        times<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>        dataset<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>            ann_file<span class="token operator">=</span><span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/data/coco/annotations/train.json'</span><span class="token punctuation">,</span>            img_prefix<span class="token operator">=</span><span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/data/coco/train2017'</span><span class="token punctuation">,</span>            classes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'tennis'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>            pipeline<span class="token operator">=</span><span class="token punctuation">[</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span>                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadAnnotations'</span><span class="token punctuation">,</span>                    with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                    with_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                    poly2mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span>                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span>                    img_scale<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    multiscale_mode<span class="token operator">=</span><span class="token string">'range'</span><span class="token punctuation">,</span>                    keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span>                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>                    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token builtin">dict</span><span class="token punctuation">(</span>                    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span>                    keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'gt_bboxes'</span><span class="token punctuation">,</span> <span class="token string">'gt_labels'</span><span class="token punctuation">,</span> <span class="token string">'gt_masks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        classes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'tennis'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/data/coco/annotations/train.json'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/data/coco/train2017'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/data/coco/annotations/val.json'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/data/coco/val2017'</span><span class="token punctuation">,</span>        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                transforms<span class="token operator">=</span><span class="token punctuation">[</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span>                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        classes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'tennis'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/data/coco/annotations/test2017.json'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'/home/declan/vscode/mmlab_test/mmdetection/data/coco/test2017'</span><span class="token punctuation">,</span>        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                transforms<span class="token operator">=</span><span class="token punctuation">[</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span>                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        classes<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'tennis'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>evaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">,</span> <span class="token string">'segm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>optimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'SGD'</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.00125</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>optimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>grad_clip<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>lr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    policy<span class="token operator">=</span><span class="token string">'step'</span><span class="token punctuation">,</span>    warmup<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span>    warmup_iters<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>    warmup_ratio<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>    step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># mark try 70 epoch</span>runner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'EpochBasedRunner'</span><span class="token punctuation">,</span> max_epochs<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>model <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MaskRCNN'</span><span class="token punctuation">,</span>    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ResNet'</span><span class="token punctuation">,</span>        depth<span class="token operator">=</span><span class="token number">101</span><span class="token punctuation">,</span>        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        frozen_stages<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'BN'</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        norm_eval<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>        style<span class="token operator">=</span><span class="token string">'pytorch'</span><span class="token punctuation">,</span>        init_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pretrained'</span><span class="token punctuation">,</span>                      checkpoint<span class="token operator">=</span><span class="token string">'torchvision://resnet101'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'FPN'</span><span class="token punctuation">,</span>        in_channels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>        num_outs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    rpn_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RPNHead'</span><span class="token punctuation">,</span>        in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>        feat_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>        anchor_generator<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'AnchorGenerator'</span><span class="token punctuation">,</span>            scales<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment"># mark important</span>            ratios<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        bbox_coder<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span><span class="token punctuation">,</span>            target_means<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            target_stds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        loss_cls<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        loss_bbox<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'L1Loss'</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    roi_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'StandardRoIHead'</span><span class="token punctuation">,</span>        bbox_roi_extractor<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>            roi_layer<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span> output_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        bbox_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Shared2FCBBoxHead'</span><span class="token punctuation">,</span>            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>            fc_out_channels<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>            roi_feat_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>            num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>            bbox_coder<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span><span class="token punctuation">,</span>                target_means<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                target_stds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            reg_class_agnostic<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>            loss_cls<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            loss_bbox<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'L1Loss'</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        mask_roi_extractor<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>            roi_layer<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span> output_size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span> sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        mask_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'FCNMaskHead'</span><span class="token punctuation">,</span>            num_convs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>            conv_out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>            num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>            loss_mask<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span> use_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    train_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        rpn<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            assigner<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>                pos_iou_thr<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span>                neg_iou_thr<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>                min_pos_iou<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            sampler<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>                num<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>                pos_fraction<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            allowed_border<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        rpn_proposal<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            nms_pre<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>            nms<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        rcnn<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            assigner<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>                pos_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>                min_pos_iou<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            sampler<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>                num<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>                pos_fraction<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            mask_size<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span>            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    test_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        rpn<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            nms_pre<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>            nms<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        rcnn<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>            score_thr<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>            nms<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span> iou_threshold<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            max_per_img<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>            mask_thr_binary<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'tennis'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>work_dir <span class="token operator">=</span> <span class="token string">'./work_dirs/mask_rcnn'</span>gpu_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MMDetection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Labelme æ ‡æ³¨å·¥å…·</title>
      <link href="/archives/be6c9228.html"/>
      <url>/archives/be6c9228.html</url>
      
        <content type="html"><![CDATA[<h1 id="Labelme-æ ‡æ³¨å·¥å…·"><a href="#Labelme-æ ‡æ³¨å·¥å…·" class="headerlink" title="Labelme æ ‡æ³¨å·¥å…·"></a>Labelme æ ‡æ³¨å·¥å…·</h1><p><a href="https://github.com/wkentaro/labelme">labelme github</a></p><p>ä¸‹è½½ç›´æ¥ <code>pip install labelme</code></p><p>å‚è€ƒ <a href="https://www.bilibili.com/video/BV1jV411U7zb">bilibili</a></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="ç®€å•è®¾ç½®"><a href="#ç®€å•è®¾ç½®" class="headerlink" title="ç®€å•è®¾ç½®"></a>ç®€å•è®¾ç½®</h3><p><img src="/archives/be6c9228/å±å¹•æˆªå›¾ 2021-09-17 115035.png" style="zoom: 50%;"></p><ol><li>æ‰“å¼€ Save Automatically</li><li>Change Output Dirï¼Œé€‰å®šè¾“å‡ºæ–‡ä»¶å¤¹</li><li>Save With Image Data</li></ol><h3 id="å¼€å§‹æ ‡æ³¨"><a href="#å¼€å§‹æ ‡æ³¨" class="headerlink" title="å¼€å§‹æ ‡æ³¨"></a>å¼€å§‹æ ‡æ³¨</h3><p>é€‰æ‹©å›¾ç‰‡æ‰€åœ¨æ–‡ä»¶å¤¹å³å¯å¼€å§‹æ ‡æ³¨ï¼Œå¯ä»¥ä½¿ç”¨å¤šè¾¹å½¢é€æ­¥å°†ç‰©ä½“åŒ…å›´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›ç®€å•çš„é›†åˆå›¾å½¢è¿›è¡Œæ ‡æ³¨ã€‚æ ‡æ³¨å®Œæˆååœ¨å½“å‰æ–‡ä»¶å¤¹å³å¯å‘ç° json æ–‡ä»¶</p><h3 id="æ–‡ä»¶æ•´ç†"><a href="#æ–‡ä»¶æ•´ç†" class="headerlink" title="æ–‡ä»¶æ•´ç†"></a>æ–‡ä»¶æ•´ç†</h3><ol><li>å¯¹æœªæ ‡æ³¨çš„æ–‡ä»¶è¿›è¡Œæ¸…ç†ï¼Œå› ä¸ºè‡ªå·±æ²¡æŠŠæ‰€æœ‰å›¾ç‰‡éƒ½æ ‡æ³¨ã€‚å¯¹å·²æ ‡æ³¨çš„æ–‡ä»¶é‡æ–°å‘½åï¼Œä½¿å¾—æ•°æ®é›†åˆ—è¡¨æ›´è¿è´¯</li><li>ä¿®æ”¹ json æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œä»¥åŒ¹é…ä¿®æ”¹çš„æ–‡ä»¶åï¼Œå³ä¿®æ”¹ <code>imagePath</code> å­—æ®µ</li></ol><h3 id="æ•°æ®è½¬åŒ–"><a href="#æ•°æ®è½¬åŒ–" class="headerlink" title="æ•°æ®è½¬åŒ–"></a>æ•°æ®è½¬åŒ–</h3><p>ä½¿ç”¨ <a href="https://github.com/Tony607">Tony607</a>/<strong><a href="https://github.com/Tony607/labelme2coco">labelme2coco</a></strong> ä¸­çš„è„šæœ¬è¿›è¡Œè½¬åŒ–ï¼Œå°†æ‰€æœ‰çš„ json æ–‡ä»¶è½¬åŒ–ä¸ºä¸€ä¸ª coco format json æ–‡ä»¶ï¼Œéå¸¸æ–¹ä¾¿</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">python labelme2coco.py image_dir<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>image_dir</code> ä¸ºä¹‹å‰æ ‡æ³¨æ‰€åœ¨çš„æ–‡ä»¶å¤¹ã€‚è€Œä¸”ä½œè€…è¿˜æä¾›äº†ä¸€ä¸ª <code>COCO_Image_Viewer.ipynb</code> å¯ä»¥å°†ç»“æœå¯è§†åŒ–æ˜¾ç¤ºå‡ºæ¥ï¼Œåªéœ€è¦ç®€å•ä¿®æ”¹ä¸€ä¸‹å…¶ä¸­çš„æ–‡ä»¶å¤¹è·¯å¾„å³å¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">annotation_path <span class="token operator">=</span> <span class="token string">"trainval.json"</span>image_dir <span class="token operator">=</span> <span class="token string">"your_image_dir"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><p>COCO api å­¦ä¹ </p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Labelme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MMCV tutorial</title>
      <link href="/archives/81012a8b.html"/>
      <url>/archives/81012a8b.html</url>
      
        <content type="html"><![CDATA[<h1 id="Understand-MMCV"><a href="#Understand-MMCV" class="headerlink" title="Understand MMCV"></a>Understand MMCV</h1><p>ç°åœ¨æƒ³è¦æ›´æ·±ä¸€æ­¥å­¦ä¹  mmdetectionï¼Œäºæ˜¯å¿…ä¸å¯å°‘åœ°è¦æ¥äº†è§£ä¸€ä¸‹ MMCV è¿™ä¸ªåŸºç¡€åº“ã€‚ä»ä¹‹å‰çš„å­¦ä¹ è¿‡ç¨‹æ¥çœ‹ï¼Œä¸€ä¸ªæ€æƒ³å°±æ˜¯ä¸€åˆ‡çš†ä¸º classã€‚é…ç½®æ–‡ä»¶æœ‰ Config classï¼Œç®¡ç†æ¨¡å—æœ‰ Registry classï¼Œè¿è¡Œæ¨¡å‹æœ‰ Runner classâ€¦ä¸‹é¢æ¥å…·ä½“çœ‹çœ‹è¿™äº›ç±»çš„ä¸€äº›åŸºç¡€æ¡†æ¶</p><h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><blockquote><p><code>Config</code> class is used for manipulating config and config files. It supports loading configs from multiple file formats including <strong>python</strong>, <strong>json</strong> and <strong>yaml</strong>. It provides dict-like apis to get and set values.</p></blockquote><p>ä» mmdetection ä»£ç æ¥çœ‹ï¼Œä¸»è¦æ˜¯ä» python æ–‡ä»¶åˆ›å»º config class</p><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><p>æ–‡æ¡£ä¸¾äº†ä¸€ä¸ªä¾‹å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># test.py</span>a <span class="token operator">=</span> <span class="token number">1</span>b <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>b1<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b2<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>d <span class="token operator">=</span> <span class="token string">'string'</span>pre_defined <span class="token operator">=</span> <span class="token string">'{{ fileDirname }}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä» <code>test.py</code> åˆ›å»º config class</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> mmcv<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>config <span class="token keyword">import</span> Configcfg <span class="token operator">=</span> Config<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span><span class="token string">'test.py'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token comment"># print result</span><span class="token comment"># Config (path: a.py): {'a': 1, 'b': {'b1': [0, 1, 2], 'b2': None}, 'c': (1, 2), 'd': 'string',</span><span class="token comment"># 'pre_defined': '/home/hongkun/mmdetection'}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>config class ä¹Ÿæ”¯æŒ4ä¸ªé¢„å…ˆå®šä¹‰çš„å˜é‡ <code>{{ var }}</code></p><p><code>{{ fileDirname }}</code> : å½“å‰æ–‡ä»¶è·¯å¾„</p><p><code>{{ fileBasename }}</code>: å½“å‰æ–‡ä»¶åï¼Œå¦‚ <code>test.py</code></p><p><code>{{ fileBasenameNoExtension }}</code>:  å½“å‰æ–‡ä»¶åï¼Œæ— æ‰©å±•åï¼Œå¦‚ <code>test</code></p><p><code>{{ fileExtname }}</code>: å½“å‰æ–‡ä»¶æ‰©å±•åï¼Œå¦‚ <code>.py</code></p><h3 id="ç»§æ‰¿-inheritance"><a href="#ç»§æ‰¿-inheritance" class="headerlink" title="ç»§æ‰¿ inheritance"></a>ç»§æ‰¿ inheritance</h3><p>æƒ³è¦ä½¿ç”¨å…¶ä»–é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œåªéœ€è¦æ·»åŠ ç»§æ‰¿å…³é”®å­— <code>_base_ = file or list_of_file</code> å³å¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># inheritance.py</span>_base_ <span class="token operator">=</span> <span class="token string">'test.py'</span> <span class="token comment"># or a list like, ['config_1.py', 'config_2.py']</span>b <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>b2<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># b = dict(b3=1, _delete_=True)</span>e <span class="token operator">=</span> <span class="token string">'new config'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»§æ‰¿ä¹‹åï¼Œ<code>inheritance.py</code> é™¤äº†è‡ªèº«çš„é…ç½®ï¼Œè¿˜ä¼šåŒ…å« <code>test.py</code> ä¸­çš„æ‰€æœ‰é…ç½®</p><p>å½“é‡åˆ°é‡å¤çš„å…³é”®å­—æ—¶ï¼Œä¾‹å¦‚ä¸¤ä¸ªé…ç½®æ–‡ä»¶ä¸­éƒ½æœ‰ <code>b</code> å…³é”®å­—ï¼Œconfig class ä¹Ÿæ”¯æŒä¿®æ”¹ï¼Œæ­¤æ—¶æƒ…å†µåˆ†ä¸ºï¼š</p><ol><li>key å¯¹åº”çš„ value ä¸ºå­—å…¸ï¼Œé‚£ä¹ˆä¼šå°†è¿™ä¸ªå­—å…¸ä¸éœ€è¦ç»§æ‰¿çš„å­—å…¸è¿›è¡Œèåˆï¼Œå¦‚æœæƒ³è¦å¿½ç•¥ç»§æ‰¿æ–‡ä»¶å¤¹ä¸­çš„åŒåé…ç½®ï¼Œåˆ™éœ€è¦æ·»åŠ  <code>_delete_=True</code> é”®å€¼</li><li>key å¯¹åº”çš„ value ä¸ºä¸ºå…¶ä»–ç±»å‹ï¼Œåˆ™å°†ä½¿ç”¨å½“å‰çš„ value</li></ol><h2 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h2><p>registry class æ˜¯æ•´ä¸ª MMCV çš„å¤§ç®¡å®¶ï¼Œè´Ÿè´£å°†<strong>ç±»</strong>è¿›è¡Œæ³¨å†Œå¹¶é…åˆ config ä¸­çš„ä¿¡æ¯å°†ç±»å®ä¾‹åŒ–ï¼Œè¿™ä¸ªç±»å¯ä»¥æ˜¯ä»»ä½•å·²å®ç°çš„ç±»ï¼šå¯ä»¥æ˜¯æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»æ¯”å¦‚ Runner, Datasetsâ€¦æœ¬è´¨ä¸Š registry å®Œæˆçš„æ˜¯ä¸€ä¸ªæ˜ å°„ï¼š string â€”&gt; classï¼Œè¿™é‡Œçš„ string é€šå¸¸åœ¨ config ä¸­å¯¹åº”ç€ <code>type</code> å­—æ®µã€‚ä½ åœ¨ config æ–‡ä»¶ä¸­åªè¦çœ‹åˆ°äº† <code>type='CLASS_NAME'</code> é‚£ä¹ˆå°±ä¸€å®šå¯ä»¥åœ¨é¡¹ç›®ä»£ç ä¸­æ‰¾åˆ°å¯¹åº”çš„ç±»çš„å®ç°ï¼Œè€Œ <code>type</code> ä¹‹åå¡«å†™çš„å…¶ä»–å…³é”®å­—ï¼Œæ­£æ˜¯è¿™äº›ç±»éœ€è¦çš„åˆå§‹åŒ–å‚æ•°ã€‚æ‰€ä»¥å¤§å¯ä»¥æŠŠ registry çœ‹ä½œæ˜¯ä¸€ä¸ªé«˜çº§çš„å­—å…¸</p><p>ä½¿ç”¨ registry ç®¡ç†ç±»éœ€è¦3ä¸ªæ­¥éª¤ï¼ˆä¸€èˆ¬åªè¦2ä¸ªï¼‰ï¼š</p><ol><li>åˆ›å»º build function (ä¸€èˆ¬ä¸ç”¨è‡ªå·±åˆ›å»ºï¼ŒRegistry æœ‰è‡ªå¸¦ build_from_cfg å‡½æ•°)</li><li>åˆ›å»º registry ç±»</li><li>æŠŠå¾…ç®¡ç†çš„ç±»æ³¨å†Œåˆ° registry ä¸­ï¼Œå³å¯ä½¿ç”¨ registry ç®¡ç†æ¨¡å—</li></ol><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>å‡è®¾è¦ç®¡ç†ä¸€ä¸ª <code>Converter class</code>ï¼Œå‡†å¤‡åœ¨ <code>Converters</code> æ–‡ä»¶å¤¹ä¸­å®ç°ã€‚å…ˆå°è¯•ç”¨ä¸€ä¸ª python æ–‡ä»¶ï¼š <code>builder.py</code> å®ç° registry çš„ç®¡ç†åŠŸèƒ½ï¼Œå¹¶é€šè¿‡ registry å®ä¾‹åŒ– Converter</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Converters/builder.py</span><span class="token keyword">from</span> mmcv<span class="token punctuation">.</span>utils <span class="token keyword">import</span> Registry<span class="token comment"># 1. create a build function</span><span class="token keyword">def</span> <span class="token function">build_converter</span><span class="token punctuation">(</span>cfg<span class="token punctuation">,</span> registry<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    cfg_ <span class="token operator">=</span> cfg<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>    converter_type <span class="token operator">=</span> cfg_<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> converter_type <span class="token keyword">not</span> <span class="token keyword">in</span> registry<span class="token punctuation">:</span>        <span class="token keyword">raise</span> KeyError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Unrecognized converter type </span><span class="token interpolation"><span class="token punctuation">{</span>converter_type<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        converter_cls <span class="token operator">=</span> registry<span class="token punctuation">.</span>get<span class="token punctuation">(</span>converter_type<span class="token punctuation">)</span>    converter <span class="token operator">=</span> converter_cls<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">,</span> <span class="token operator">**</span>cfg_<span class="token punctuation">)</span>    <span class="token keyword">return</span> converter<span class="token comment"># 2. create a registry for converters</span>CONVERTERS <span class="token operator">=</span> Registry<span class="token punctuation">(</span><span class="token string">'Converter'</span><span class="token punctuation">,</span> build_func<span class="token operator">=</span>build_converter<span class="token punctuation">)</span><span class="token comment"># if use default build_func: CONVERTERS = Registry('Converter')</span><span class="token comment"># 3. use the registry to manage the module</span><span class="token decorator annotation punctuation">@CONVERTERS<span class="token punctuation">.</span>register_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Converter1</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>a <span class="token operator">=</span> a        self<span class="token punctuation">.</span>b <span class="token operator">=</span> b <span class="token comment"># use this converter through configs</span>converter_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Converter1'</span><span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token string">'a_value'</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token string">'b_value'</span><span class="token punctuation">)</span>converter <span class="token operator">=</span> CONVERTERS<span class="token punctuation">.</span>build<span class="token punctuation">(</span>converter_cfg<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'converter attribute:'</span><span class="token punctuation">,</span> converter<span class="token punctuation">.</span>a<span class="token punctuation">,</span> converter<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢å°±æ˜¯ registry çš„å·¥ä½œé€»è¾‘ï¼šå…ˆå»ºé€  registry ç±»ï¼Œå†å°†å¾…ç®¡ç†çš„ç±»é€šè¿‡è£…é¥°å™¨æ³¨å†Œåˆ° registry ç±»ä¸­ï¼Œæœ€åä½¿ç”¨ cfg å»ºé€ å®ä¾‹</p><p>å¦‚æœå»çœ‹ mmdetection çš„ä»£ç ä¼šå‘ç°ï¼Œå…¶ <code>builder.py</code> æ˜¯å†™å¾—éå¸¸ç®€å•çš„ï¼Œå¹¶æ²¡æœ‰åŒ…å« <code>build_func</code> ä»¥åŠå…·ä½“ç®¡ç†çš„ç±»ã€‚æ˜¯å› ä¸ºå…¶ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„ <code>build_func=build_from_cfg</code> å¹¶ä¸”å°†å…¶ä»–ç±»ç”¨å•ç‹¬æ–‡ä»¶ä¿å­˜ï¼Œä¹‹åé€šè¿‡ <code>__init__.py</code> ï¼Œå°†æ‰€æœ‰çš„ç±»æ³¨å†Œåˆ° builder ä¸­çš„ registry ç±»ä¸­</p><h3 id="å±‚çº§æ³¨å†Œ-Hierarchy-Registry"><a href="#å±‚çº§æ³¨å†Œ-Hierarchy-Registry" class="headerlink" title="å±‚çº§æ³¨å†Œ Hierarchy Registry"></a>å±‚çº§æ³¨å†Œ Hierarchy Registry</h3><p>è¿™é‡Œæˆ‘æ›´æƒ³å«å®ƒç»§æ‰¿æ³¨å†Œã€‚åœ¨ registry ç±»ä¸­æä¾›äº† parent å‚æ•°ï¼Œparent å¿…é¡»ä¹Ÿæ˜¯ registry ç±»ã€‚è¿™æ ·å­ registry å°±èƒ½å¤Ÿç»§æ‰¿ parent registry çš„ build_func æ¥è¿›è¡Œå®ä¾‹åŒ–ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªç±»æ—¢èƒ½å¤Ÿä½¿ç”¨æ³¨å†Œåœ¨è‡ªå·±åä¸‹çš„ç±»ï¼Œé€šè¿‡æŒ‡å®šâ€æ—è°±â€œä¹Ÿèƒ½å¤Ÿä¹Ÿä½¿ç”¨å…¶ä»– registry ç®¡ç†çš„ç±»ã€‚ä½†è¿™ä¸ªâ€æ—è°±â€œæ˜¯æŒ‰ç…§ OpenMMLab é¡¹ç›®åˆ’åˆ†çš„ï¼Œä¸æ˜¯æˆ‘ä»¬èƒ½ä¿®æ”¹çš„ï¼Œæ‰€ä»¥ä¸ªè¿™ç»§æ‰¿æ³¨å†Œçš„æ„ä¹‰æ˜¯åœ¨äº OpenMMLab ä¸åŒé¡¹ç›®ä¹‹é—´çš„æ¨¡å‹éƒ½å¯ä»¥è°ƒç”¨ï¼Œä¾‹å¦‚ mmdetection å¯ä»¥è°ƒç”¨ mmclassification ä¸­çš„æ¨¡å‹ã€‚è¯·å‰å¾€æ–‡æ¡£å‚è€ƒ <a href="https://mmcv.readthedocs.io/en/latest/understand_mmcv/registry.html#hierarchy-registry">æ›´å¤š</a></p><h2 id="Runner"><a href="#Runner" class="headerlink" title="Runner"></a>Runner</h2><p>Runner æ˜¯ç®¡ç†è®­ç»ƒè¿‡ç¨‹çš„ç±»ï¼Œæœ‰ä¸¤ä¸ªå­ç±» <code>EpochBasedRunner</code> and <code>IterBasedRunner</code>ã€‚Runner ä¹Ÿèƒ½å¤Ÿåœ¨ train å’Œ val ä¸¤ç§æ¨¡å¼ä¸­åˆ‡æ¢ï¼Œå’Œ hook ç»“åˆå¯ä»¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æœ‰æ›´å¤šæ‹“å±•åŠŸèƒ½</p><h3 id="EpochBasedRunner"><a href="#EpochBasedRunner" class="headerlink" title="EpochBasedRunner"></a>EpochBasedRunner</h3><p>è¯¥ runner çš„å·¥ä½œæµæ˜¯åŸºäº epoch çš„ï¼Œæ¯ä¸€ä¸ª epoch å°†åŒ…å«å¤šä¸ª iterationsã€‚æ¯”å¦‚å½“ <code>workflow = [('train', 2), ('val', 1)]</code> è¯¥ runner å°±ä¼šè¿è¡Œ2æ¬¡è®­ç»ƒé›†1æ¬¡éªŒè¯é›†ã€‚ä¸‹é¢çœ‹çœ‹å…¶è¿è¡Œçš„åŸºæœ¬é€»è¾‘</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># the condition to stop training</span><span class="token keyword">while</span> curr_epoch <span class="token operator">&lt;</span> max_epochs<span class="token punctuation">:</span>    <span class="token comment"># traverse the workflow.</span>    <span class="token comment"># e.g. workflow = [('train', 2), ('val', 1)]</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> flow <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>workflow<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># mode(e.g. train) determines which function to run</span>        mode<span class="token punctuation">,</span> epochs <span class="token operator">=</span> flow        <span class="token comment"># epoch_runner will be either self.train() or self.val()</span>        epoch_runner <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mode<span class="token punctuation">)</span>        <span class="token comment"># execute the corresponding function</span>        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>            epoch_runner<span class="token punctuation">(</span>data_loaders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ˜¯ train æ¨¡å¼ï¼Œé‚£ä¹ˆå°†è°ƒç”¨ç±»ä¼¼å¦‚ä¸‹å‡½æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Currently, epoch_runner could be either train or val</span><span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data_loader<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># traverse the dataset and get batch data for 1 epoch</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> data_batch <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>data_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># it will execute all before_train_iter function in the hooks registered. You may want to watch out for the order.</span>        self<span class="token punctuation">.</span>call_hook<span class="token punctuation">(</span><span class="token string">'before_train_iter'</span><span class="token punctuation">)</span>        <span class="token comment"># set train_mode as False in val function</span>        self<span class="token punctuation">.</span>run_iter<span class="token punctuation">(</span>data_batch<span class="token punctuation">,</span> train_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>call_hook<span class="token punctuation">(</span><span class="token string">'after_train_iter'</span><span class="token punctuation">)</span>   self<span class="token punctuation">.</span>call_hook<span class="token punctuation">(</span><span class="token string">'after_train_epoch'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šä¸¤æ®µä»£ç å°±å±•ç¤ºäº† runner çš„åŸºæœ¬é€»è¾‘ï¼šéå†æ•´ä¸ªè®­ç»ƒé›†ï¼Œå¹¶åœ¨æ¯æ¬¡éå†å‰åè¿è¡Œ hook è¿›è¡Œæ‹“å±•æ“ä½œ</p><h3 id="IterBasedRunner"><a href="#IterBasedRunner" class="headerlink" title="IterBasedRunner"></a>IterBasedRunner</h3><p>ä¸ <code>EpochBasedRunner</code> ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯åŸºäº iteration çš„ runner å®ç°ï¼Œä¸€ä¸ª iteration å°†åŒ…å«ä¸€ä¸ª batchsizeã€‚å¦‚æœå®šä¹‰äº† <code>workflow = [('train', 2), ('val', 1)]</code> é‚£ä¹ˆå°†ä¼šå¾ªç¯è¿è¡Œ2ä¸ªè®­ç»ƒé›† iterations å’Œ1ä¸ªéªŒè¯æœº iterationã€‚ä¸‹é¢ä¹Ÿçœ‹çœ‹å…¶è¿è¡Œé€»è¾‘</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Although we set workflow by iters here, we might also need info on the epochs in some using cases. That can be provided by IterLoader.</span>iter_loaders <span class="token operator">=</span> <span class="token punctuation">[</span>IterLoader<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> data_loaders<span class="token punctuation">]</span><span class="token comment"># the condition to stop training</span><span class="token keyword">while</span> curr_iter <span class="token operator">&lt;</span> max_iters<span class="token punctuation">:</span>    <span class="token comment"># traverse the workflow.</span>    <span class="token comment"># e.g. workflow = [('train', 2), ('val', 1)]</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> flow <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>workflow<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># mode(e.g. train) determines which function to run</span>        mode<span class="token punctuation">,</span> iters <span class="token operator">=</span> flow        <span class="token comment"># iter_runner will be either self.train() or self.val()</span>        iter_runner <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mode<span class="token punctuation">)</span>        <span class="token comment"># execute the corresponding function</span>        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>iters<span class="token punctuation">)</span><span class="token punctuation">:</span>            iter_runner<span class="token punctuation">(</span>iter_loaders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨-Runner"><a href="#ä½¿ç”¨-Runner" class="headerlink" title="ä½¿ç”¨ Runner"></a>ä½¿ç”¨ Runner</h3><p>ä¸€èˆ¬æ¥è®²ä½¿ç”¨ runner æ¥è¿›è¡Œè®­ç»ƒæœ‰4ä¸ªåŸºæœ¬æ­¥éª¤ï¼š</p><ol><li>åˆå§‹åŒ– dataloader, model, optimizer, etc.</li><li>åˆå§‹åŒ– runnerï¼šå°† config, model, optimizer, etc. ä¼ å…¥ Runner ä¸­è¿›è¡Œå®ä¾‹åŒ–</li><li>æ³¨å†Œ training hooks &amp; customized hooks</li><li>å¼€å§‹è®­ç»ƒï¼š<code>runner.run(data_loaders, cfg.workflow)</code></li></ol><p>å…·ä½“ç¤ºä¾‹ä»£ç è¯·ç§»æ­¥ <a href="https://mmcv.readthedocs.io/en/latest/understand_mmcv/runner.html#a-simple-example">MMCV Runner</a></p><h2 id="File-IO"><a href="#File-IO" class="headerlink" title="File IO"></a>File IO</h2><p>mmcv ç»™å¯¼å…¥å’Œè¾“å…¥æ–‡æ¡£è®¾æœ‰ APIï¼Œå¯ä»¥å¯¼å…¥ä¸åŒæ ¼å¼çš„æ–‡æ¡£ï¼Œä¾‹å¦‚ json, yaml, pklã€‚ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•å¯¼å…¥ä¸€ä¸ª json æ–‡ä»¶ä¸ºå­—å…¸</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token comment">// file.json</span><span class="token punctuation">{</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Python: Current File"</span><span class="token punctuation">,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"python"</span><span class="token punctuation">,</span>            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"${file}"</span><span class="token punctuation">,</span>            <span class="token property">"console"</span><span class="token operator">:</span> <span class="token string">"integratedTerminal"</span><span class="token punctuation">,</span>            <span class="token property">"justMyCode"</span><span class="token operator">:</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mmcv<span class="token builtin">file</span> <span class="token operator">=</span> mmcv<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'file.json'</span><span class="token punctuation">)</span><span class="token comment"># load data from a file-like object</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'file.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    data <span class="token operator">=</span> mmcv<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">,</span> file_format<span class="token operator">=</span><span class="token string">'json'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token comment"># &lt;class 'dict'&gt;</span><span class="token comment"># {'version': '0.2.0', 'configurations': [{'name': 'Python: Current File', 'type': 'python', 'request': 'launch', 'program': '${file}', 'console': 'integratedTerminal', 'justMyCode': False}]}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>mmcv.dump</code> æ¥è½¬åŒ–æ–‡ä»¶æˆ–è€…è¾“å‡ºæ–‡ä»¶</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mmcv<span class="token comment"># å°†å­—å…¸è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</span>info <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Declan'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">23</span><span class="token punctuation">)</span>dump_info <span class="token operator">=</span> mmcv<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>info<span class="token punctuation">,</span> file_format<span class="token operator">=</span><span class="token string">'yaml'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>dump_info<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>dump_info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># age: 23</span><span class="token comment"># name: Declan</span><span class="token comment"># &lt;class 'str'&gt;</span><span class="token comment"># å°†æ–‡ä»¶ä¿å­˜ä¸º info.yaml</span>mmcv<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">'info.yaml'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½†æ˜¯ä»¥ä¸Šçš„ API ä¸èƒ½å¯¼å…¥ txt æ ¼å¼æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨ <code>mmcv.list_from_txt</code> or <code>mmcv.dict_from_txt</code> å°† txt æ–‡ä»¶å¯¼å…¥ä¸ºåˆ—è¡¨æˆ–è€…å­—å…¸</p><pre class="line-numbers language-a.txt" data-language="a.txt"><code class="language-a.txt">1 cat2 dog cow3 panda<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">mmcv<span class="token punctuation">.</span>dict_from_file<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token comment"># {'1': 'cat', '2': ['dog', 'cow'], '3': 'panda'}</span>mmcv<span class="token punctuation">.</span>list_from_file<span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span><span class="token comment"># ['1 cat', '2 dog cow', '3 panda']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Data-Process"><a href="#Data-Process" class="headerlink" title="Data Process"></a>Data Process</h2><blockquote><p>This module provides some image processing methods, which requires <code>opencv</code> to be installed.</p></blockquote><h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3><h4 id="Read-Write-Show"><a href="#Read-Write-Show" class="headerlink" title="Read/Write/Show"></a>Read/Write/Show</h4><p>å¯¹äºå›¾ç‰‡çš„åŸºæœ¬æ“ä½œï¼šè¯»ã€å†™ã€å±•ç¤ºï¼Œåˆ†åˆ«ä½¿ç”¨ <code>imread</code>ï¼Œ<code>imwrite</code>ï¼Œ<code>imshow</code> ä¸‰ä¸ª API</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mmcv<span class="token comment"># Read &amp; Write</span>img <span class="token operator">=</span> mmcv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'test.jpg'</span><span class="token punctuation">)</span>mmcv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token string">'out.jpg'</span><span class="token punctuation">)</span><span class="token comment"># Show</span>mmcv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'tests/data/color.jpg'</span><span class="token punctuation">)</span><span class="token comment"># Show with bboxes</span>bboxes <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>mmcv<span class="token punctuation">.</span>imshow_bboxes<span class="token punctuation">(</span>img<span class="token punctuation">,</span> bboxes<span class="token punctuation">)</span><span class="token comment"># Show with ndarray</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    img <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>    mmcv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> win_name<span class="token operator">=</span><span class="token string">'test image'</span><span class="token punctuation">,</span> wait_time<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="More"><a href="#More" class="headerlink" title="More"></a>More</h4><p>å¯¹äºå›¾ç‰‡è¿˜æœ‰æ›´å¤šçš„æ“ä½œå°±ä¸åœ¨è¿™é‡Œåˆ—ä¸¾äº†ï¼Œä¾‹å¦‚è‰²åŸŸè½¬æ¢ã€å‰ªè£ã€æ—‹è½¬ç­‰ï¼Œå‚è€ƒ <a href="https://mmcv.readthedocs.io/en/latest/understand_mmcv/data_process.html#data-process">MMCV æ–‡æ¡£</a></p><h3 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h3><p>å…³äºè§†é¢‘æ¨¡å—ä¸»è¦å®ç°3ä¸ªåŠŸèƒ½ï¼š</p><ol><li>è¯»å–è§†é¢‘</li><li>ç¼–è¾‘è§†é¢‘</li><li>å¤„ç†å…‰æµæ–‡ä»¶</li></ol><h4 id="VideoReader"><a href="#VideoReader" class="headerlink" title="VideoReader"></a>VideoReader</h4><p>è¯¥ API èƒ½å¤Ÿè¿‡å¾—è§†é¢‘çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶èƒ½å¤Ÿè§†é¢‘ä¸­çš„æ¯ä¸€å¸§è¿›è¡Œç´¢å¼•æˆ–éå†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">video <span class="token operator">=</span> mmcv<span class="token punctuation">.</span>VideoReader<span class="token punctuation">(</span><span class="token string">'test.mp4'</span><span class="token punctuation">)</span><span class="token comment"># obtain basic information</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>video<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>video<span class="token punctuation">.</span>width<span class="token punctuation">,</span> video<span class="token punctuation">.</span>height<span class="token punctuation">,</span> video<span class="token punctuation">.</span>resolution<span class="token punctuation">,</span> video<span class="token punctuation">.</span>fps<span class="token punctuation">)</span><span class="token comment"># iterate over all frames</span><span class="token keyword">for</span> frame <span class="token keyword">in</span> video<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>frame<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token comment"># read the next frame</span>img <span class="token operator">=</span> video<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># read a frame by index</span>img <span class="token operator">=</span> video<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token comment"># read some frames</span>img <span class="token operator">=</span> video<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¯¥æ¨¡å—å†…ç½®æ–¹æ³• <code>cvt2frames</code> å¯ä»¥å°† video è½¬åŒ–ä¸º imagesï¼ŒåŒæ—¶ <code>mmcv.frames2video</code> ä¹Ÿå¯ä»¥å°† images è½¬åŒ–ä¸º video</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># split a video into frames and save to a folder</span>video <span class="token operator">=</span> mmcv<span class="token punctuation">.</span>VideoReader<span class="token punctuation">(</span><span class="token string">'test.mp4'</span><span class="token punctuation">)</span><span class="token comment"># convert a video to frame images</span>video<span class="token punctuation">.</span>cvt2frames<span class="token punctuation">(</span><span class="token string">'out_dir'</span><span class="token punctuation">)</span><span class="token comment"># generate video from frames</span>mmcv<span class="token punctuation">.</span>frames2video<span class="token punctuation">(</span><span class="token string">'out_dir'</span><span class="token punctuation">,</span> <span class="token string">'test.avi'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœç†Ÿæ‚‰ ffmpeg çš„è¯ï¼Œé€šè¿‡ ffmpeg èƒ½å¤Ÿå®ç°æ›´å¤šæ ¼å¼çš„è½¬åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ python ä¸­çš„ <code>os.system</code> æ‰§è¡Œå‘½ä»¤è¡Œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> osos<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'ffmpeg -version'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>mmcv ä¸­ä¹Ÿæœ‰ä¸€äº›æ¥å£å€Ÿç”¨äº† ffmpeg ä»¥å®ç°å¯¹è§†é¢‘çš„æ›´å¤šæ“ä½œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># cut a video clip</span>mmcv<span class="token punctuation">.</span>cut_video<span class="token punctuation">(</span><span class="token string">'test.mp4'</span><span class="token punctuation">,</span> <span class="token string">'clip1.mp4'</span><span class="token punctuation">,</span> start<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> vcodec<span class="token operator">=</span><span class="token string">'h264'</span><span class="token punctuation">)</span><span class="token comment"># join a list of video clips</span>mmcv<span class="token punctuation">.</span>concat_video<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'clip1.mp4'</span><span class="token punctuation">,</span> <span class="token string">'clip2.mp4'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'joined.mp4'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'quiet'</span><span class="token punctuation">)</span><span class="token comment"># resize a video with the specified size</span>mmcv<span class="token punctuation">.</span>resize_video<span class="token punctuation">(</span><span class="token string">'test.mp4'</span><span class="token punctuation">,</span> <span class="token string">'resized1.mp4'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">360</span><span class="token punctuation">,</span> <span class="token number">240</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># resize a video with a scaling ratio of 2</span>mmcv<span class="token punctuation">.</span>resize_video<span class="token punctuation">(</span><span class="token string">'test.mp4'</span><span class="token punctuation">,</span> <span class="token string">'resized2.mp4'</span><span class="token punctuation">,</span> ratio<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Optical-flow"><a href="#Optical-flow" class="headerlink" title="Optical flow"></a>Optical flow</h4><p>mmcv ä¹Ÿå¯¹å…‰æµæ–‡ä»¶çš„å¤„ç†æä¾›æ”¯æŒï¼Œä½†æˆ‘å¯¹äºå…¶äº†è§£ä¸å¤šï¼Œæš‚æ—¶ä¸ä½œæ•´ç†ã€‚è¿™é‡Œè´´ä¸€ä¸ªé“¾æ¥ <a href="https://mmcv.readthedocs.io/en/latest/understand_mmcv/data_process.html#optical-flow">MMCV Optical flow</a></p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><h3 id="KITTI-æ•°æ®é›†"><a href="#KITTI-æ•°æ®é›†" class="headerlink" title="KITTI æ•°æ®é›†"></a>KITTI æ•°æ®é›†</h3><p>KITTIæ•°æ®é›†æœ‰40å¤šä¸ªGï¼Œç›¸æ¯”èµ·æ¥æ˜¯ä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°æ®é›†</p><p>å¯¹äºæ•°æ®é›†çš„è®²è§£å¯ä»¥å‚è€ƒ <a href="https://blog.csdn.net/u013086672/article/details/103913361">CSDN</a></p><p>ä¸‹è½½æ•°æ®é›†å¯ä»¥åœ¨ <a href="https://gas.graviti.cn/dataset/data-decorators/KITTIObject">GRAVITI</a> ä¸‹è½½ï¼Œéœ€è¦æ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼Œä½†æ˜¯é€Ÿåº¦å¾ˆå¿«</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MMCV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MMDetection tutorial note</title>
      <link href="/archives/71f4e62.html"/>
      <url>/archives/71f4e62.html</url>
      
        <content type="html"><![CDATA[<h1 id="MMDetection-tutorial-note"><a href="#MMDetection-tutorial-note" class="headerlink" title="MMDetection tutorial note"></a>MMDetection tutorial note</h1><h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><p>ç”±äº config æ˜¯æœ‰ç»§æ‰¿æœºåˆ¶çš„ï¼Œæ‰€ä»¥æƒ³è¦æŸ¥çœ‹å®Œæ•´çš„ configï¼Œå¯ä»¥ç”¨å®˜æ–¹æä¾›çš„ <code>print_config.py</code> å‡½æ•°æ¥æŸ¥çœ‹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python tools/misc/print_config.py /<span class="token environment constant">PATH</span>/TO/CONFIG<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä¿®æ”¹-config"><a href="#ä¿®æ”¹-config" class="headerlink" title="ä¿®æ”¹ config"></a>ä¿®æ”¹ config</h3><p>åœ¨ä½¿ç”¨ <code>tools/train.py</code> or <code>tools/test.py</code> æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>--cfg-options</code> æ¥ä¿®æ”¹æ­¤æ¬¡è¿è¡Œçš„ config è€Œä¸ä¿®æ”¹ config æ–‡ä»¶</p><p>æ›´æ”¹å­—å…¸ï¼Œåˆ—è¡¨ï¼Œå…ƒç»„éƒ½å¯ä»¥ï¼Œåªéœ€è¦æŒ‰ç…§è§„èŒƒä¼ å…¥å‚æ•°å³å¯ï¼Œä¸‹é¢ç»™å‡ ä¸ªä¾‹å­</p><ol><li><p>æ›´æ”¹å­—å…¸ <code>--cfg-options model.backbone.norm_eval=False</code></p></li><li><p>æ›´æ”¹åˆ—è¡¨ä¸­çš„å­—å…¸ <code>[dict(type='LoadImageFromFile'), ...]</code> </p><p><code>--cfg-options data.train.pipeline.0.type=LoadImageFromWebcam</code></p></li><li><p>æ›´æ”¹åˆ—è¡¨ï¼Œå…ƒç»„ <code>workflow=[('train', 1)]</code></p><p><code>--cfg-options workflow="[(train,1),(val,1)]"</code> æ³¨æ„å¿…é¡»è¦åŠ å¼•å·ï¼Œä¸”å†…éƒ¨ä¸èƒ½æœ‰ç©ºæ ¼</p></li></ol><h3 id="config-ç»“æ„"><a href="#config-ç»“æ„" class="headerlink" title="config ç»“æ„"></a>config ç»“æ„</h3><p>åœ¨ <code>config/_base_</code> ä¸­æœ‰4ä¸ªåŸºæœ¬çš„ç»„æˆéƒ¨åˆ†</p><ol><li>dataset</li><li>models: backbone, neck æ˜¯å¿…é¡»æœ‰çš„</li><li>schedule</li><li>default_runtime</li></ol><p>æ›´è¯¦ç»†çš„è¦æ±‚å’Œä¾‹å­è¯·ç›´æ¥æŸ¥çœ‹ <a href="https://mmdetection.readthedocs.io/en/latest/tutorials/config.html#config-name-style">æ–‡æ¡£</a></p><p>config çš„ç»“æ„å…¶å®å°±ç»™å­¦ä¹  MMDetection æœ‰ä¸€ä¸ªæ˜ç¡®çš„æŒ‡å¯¼ï¼Œé‡ç‚¹å°±æ˜¯è¿™å››ä¸ªéƒ¨åˆ†ï¼Œæ€ä¹ˆå»ºç«‹æ•°æ®é›†ã€æ¨¡å‹ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éœ€ä¸éœ€è¦åšäº›å…¶ä»–è®°å½•å’Œå¤„ç†â€¦</p><h2 id="Customize-Datasets"><a href="#Customize-Datasets" class="headerlink" title="Customize Datasets"></a>Customize Datasets</h2><p>æ•°æ®å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†å¤„ç†ï¼Œä¸€ä¸ªæ˜¯æ•°æ®æœ¬èº«ï¼Œå¦ä¸€ä¸ªæ˜¯æ•°æ®çš„æ ‡ç­¾ä¿¡æ¯ <code>annotation_file</code>ï¼Œæ‰€ä»¥æƒ³è¦å»ºç«‹ä¸ªæ€§åŒ–çš„æ•°æ®é›†ï¼Œå¤„ç†å¥½è¿™ä¸¤ä¸ªéƒ¨åˆ†å³å¯</p><p>å¯¹äºæ•°æ®æœ¬èº«ï¼Œæ¯”å¦‚å›¾ç‰‡æ•°æ®ã€ç‚¹äº‘æ•°æ®â€¦å…¶å®èƒ½å¤Ÿåšçš„å¤„ç†æ˜¯æ¯”è¾ƒå°‘çš„ï¼Œæ›´å¤šçš„æ˜¯åšé¢„å¤„ç†æ¯”å¦‚ data augmentationï¼Œä½†è¿™äº›æ“ä½œå°±ä¸åœ¨è¿™ä¸€éƒ¨åˆ†è¿›è¡Œï¼Œè€Œæ˜¯åˆ°ä¸‹ä¸€èŠ‚ Data Piplines ä¸­è¿›è¡Œ</p><h3 id="è§„èŒƒ-annotation-file"><a href="#è§„èŒƒ-annotation-file" class="headerlink" title="è§„èŒƒ annotation_file"></a>è§„èŒƒ annotation_file</h3><p>ç°åœ¨é‡å¿ƒæ”¾åœ¨å¤„ç†æ•°æ®çš„æ ‡ç­¾ä¿¡æ¯ä¸Šï¼Œæ ¸å¿ƒå°±æ˜¯æŠŠæ ‡ç­¾ä¿¡æ¯å¤„ç†æˆä¸ºä¸€ç§è§„èŒƒçš„æ ¼å¼å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œåœ¨ MMDetection ä¸­ COCO format æ˜¯ä¸€ç§æ¨èçš„æ ¼å¼ã€‚COCO format æ˜¯ä¸€ä¸ª json æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­åŒ…å«äº†æ•´ä¸ªæ•°æ®é›†æ¯ä¸€ä¸ªæ ·æœ¬çš„æ ‡ç­¾ä¿¡æ¯ï¼Œå…¶ä¸­æœ‰3ä¸ªå¤§çš„å…³é”®å­—ï¼š</p><ul><li><code>images</code>: contains a list of images with their informations like <code>file_name</code>, <code>height</code>, <code>width</code>, and <code>id</code>.</li><li><code>annotations</code>: contains the list of instance annotations.</li><li><code>categories</code>: contains the list of categories names and their ID.</li></ul><p>å½¢å¦‚ä¸‹é¢çš„å†…å®¹</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">'images'<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>        'file_name'<span class="token operator">:</span> 'COCO_val2014_000000001268.jpg'<span class="token punctuation">,</span>        'height'<span class="token operator">:</span> <span class="token number">427</span><span class="token punctuation">,</span>        'width'<span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span>        'id'<span class="token operator">:</span> <span class="token number">1268</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    ...<span class="token punctuation">]</span><span class="token punctuation">,</span>'annotations'<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>        'segmentation'<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">192.81</span><span class="token punctuation">,</span>            <span class="token number">247.09</span><span class="token punctuation">,</span>            ...            <span class="token number">219.03</span><span class="token punctuation">,</span>            <span class="token number">249.06</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  # if you have mask labels        'area'<span class="token operator">:</span> <span class="token number">1035.749</span><span class="token punctuation">,</span>        'iscrowd'<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        'image_id'<span class="token operator">:</span> <span class="token number">1268</span><span class="token punctuation">,</span>        'bbox'<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">192.81</span><span class="token punctuation">,</span> <span class="token number">224.8</span><span class="token punctuation">,</span> <span class="token number">74.73</span><span class="token punctuation">,</span> <span class="token number">33.43</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        'category_id'<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>        'id'<span class="token operator">:</span> <span class="token number">42986</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    ...<span class="token punctuation">]</span><span class="token punctuation">,</span>'categories'<span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>'id'<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 'name'<span class="token operator">:</span> 'car'<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ›´æ”¹-config-file-ä»¥åŒ¹é…"><a href="#æ›´æ”¹-config-file-ä»¥åŒ¹é…" class="headerlink" title="æ›´æ”¹ config file ä»¥åŒ¹é…"></a>æ›´æ”¹ config file ä»¥åŒ¹é…</h3><p>æ›´æ”¹ config file ä¸­çš„ dataset/data é…ç½®æ¥åŒ¹é… <code>annotation_file</code>ï¼Œéœ€è¦æ˜ç¡®çš„æ˜¯ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><code>annotation_file_path</code> &amp; <code>image_path</code></li><li><code>classes</code> æ•°æ®é›†æœ‰å“ªäº›ç±»åˆ«</li><li><code>num_classes</code> æ•°æ®é›†ç±»åˆ«æœ‰å¤šå°‘</li></ol><p>è¿™ä¸‰ä¸ªéƒ¨åˆ†åœ¨ config ä¸­çš„ train, val, test å­—æ®µä¸­å‡æœ‰å‡ºç°ï¼Œå…·ä½“æ›´æ”¹å“ªäº›éƒ¨åˆ†ï¼Œå‚è€ƒä¸‹é¢çš„ä»£ç ï¼Œå‡è®¾æ–°æ•°æ®é›†æœ‰5ä¸ªç±»åˆ«ï¼Œç”¨å­—æ¯ a~e æ¥è¡¨ç¤º</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># the new config inherits the base configs to highlight the necessary modification</span>_base_ <span class="token operator">=</span> <span class="token string">'./cascade_mask_rcnn_r50_fpn_1x_coco.py'</span><span class="token comment"># 1. dataset settings</span>dataset_type <span class="token operator">=</span> <span class="token string">'CocoDataset'</span>classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    samples_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>    workers_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span>dataset_type<span class="token punctuation">,</span>        <span class="token comment"># explicitly add your class names to the field `classes`</span>        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'path/to/your/train/annotation_data'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'path/to/your/train/image_data'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span>dataset_type<span class="token punctuation">,</span>        <span class="token comment"># explicitly add your class names to the field `classes`</span>        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'path/to/your/val/annotation_data'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'path/to/your/val/image_data'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span>dataset_type<span class="token punctuation">,</span>        <span class="token comment"># explicitly add your class names to the field `classes`</span>        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'path/to/your/test/annotation_data'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'path/to/your/test/image_data'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 2. model settings</span><span class="token comment"># explicitly over-write all the `num_classes` field from default 80 to 5.</span>model <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    roi_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        bbox_head<span class="token operator">=</span><span class="token punctuation">[</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Shared2FCBBoxHead'</span><span class="token punctuation">,</span>                <span class="token comment"># explicitly over-write all the `num_classes` field from default 80 to 5.</span>                num_classes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Shared2FCBBoxHead'</span><span class="token punctuation">,</span>                <span class="token comment"># explicitly over-write all the `num_classes` field from default 80 to 5.</span>                num_classes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Shared2FCBBoxHead'</span><span class="token punctuation">,</span>                <span class="token comment"># explicitly over-write all the `num_classes` field from default 80 to 5.</span>                num_classes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment"># explicitly over-write all the `num_classes` field from default 80 to 5.</span>    mask_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>num_classes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ¨è <a href="https://www.bilibili.com/video/BV1Jb4y1r7ir?p=1">bilibili æ•™ç¨‹</a>ï¼Œæœ‰å®ä¾‹è®²è§£äº†å¦‚ä½•å¤„ç†ä¸ªæ€§åŒ–æ•°æ®é›†</p><p>æ–‡æ¡£ä¸­è¿˜æåˆ°äº†å¯ä»¥<a href="https://mmdetection.readthedocs.io/en/latest/tutorials/customize_dataset.html#reorganize-new-data-format-to-middle-format"> å»ºç«‹è‡ªå·±çš„ Dataset ç±»</a>ï¼Œæ¥å®ŒæˆåŸæœ¬çš„ <code>CocoDataset</code> ç±»çš„åŠŸèƒ½ã€‚åªéœ€è¦ç»§æ‰¿ <code>CustomDataset</code> åŸºç±»ç„¶åé‡å†™ <code>load_annotations(self, ann_file)</code> and <code>get_ann_info(self, idx)</code> ä¸¤ä¸ªæ–¹æ³•</p><h2 id="Customize-Data-Pipelines"><a href="#Customize-Data-Pipelines" class="headerlink" title="Customize Data Pipelines"></a>Customize Data Pipelines</h2><p>æ¥ä¸‹æ¥å°±è¦å…·ä½“åœ°å¯¹æ•°æ®é›†è¿›è¡Œå¤„ç†äº†ï¼Œéœ€è¦æ·±å…¥åˆ° <code>mmdet/datasets</code> å½“ä¸­çœ‹çœ‹ï¼Œä» <code>builder.py</code> å¤§è‡´å¯ä»¥çœ‹å‡ºï¼Œç±»ä¼¼äº pytorchï¼Œmmdetection ä¹Ÿå°†æ•°æ®å¤„ç†åˆ†ä¸º <code>Dataset</code> å’Œ <code>Dataloader</code> ä¸¤ä¸ªç±»æ¥åˆ›å»ºå’ŒåŠ è½½æ•°æ®é›†ã€‚è¿™ä¸€èŠ‚çš„é‡ç‚¹æ˜¯åœ¨ <code>Dataset</code> ç±»ä¸­ï¼Œä¸Šä¸€èŠ‚æåˆ°çš„ <code>CocoDataset</code>  ç±»å°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚åœ¨ä¸Šä¸€èŠ‚ï¼Œå¤„ç†äº†æ•°æ®é›†çš„ annotation è§„èŒƒé—®é¢˜ï¼Œè¿™ä¸€èŠ‚éœ€è¦ä½¿ç”¨ <code>Dataset</code> ç±»å»ºç«‹ä¸€ä¸ª piplines å¯¹æ•°æ®é›†è¿›è¡Œä¸€ç³»åˆ—å˜æ¢æ“ä½œ</p><h3 id="å˜æ¢æ“ä½œ"><a href="#å˜æ¢æ“ä½œ" class="headerlink" title="å˜æ¢æ“ä½œ"></a>å˜æ¢æ“ä½œ</h3><p>åœ¨ <code>mmdet/datasets/piplines</code> ä¸­æœ‰è®¸å¤šçš„æ–¹æ³•ï¼Œç”¨äºå¯¹æ•°æ®çš„å¤„ç†ã€‚å¦‚æœæƒ³è¦åˆ›å»ºè‡ªå·±çš„ç±»ï¼Œæ­¥éª¤ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼š</p><ol><li>åˆ›å»º <code>MyTransform</code> ç±»</li><li>å¯¼å…¥è¿™ä¸ªç±»</li><li>å°†è¯¥ç±»åŠ å…¥åˆ° config ä¸­ï¼Œæ–‡æ¡£ä¸­çš„ <a href="https://mmdetection.readthedocs.io/en/latest/tutorials/data_pipeline.html#extend-and-use-custom-pipelines">ç¤ºä¾‹ä»£ç </a></li></ol><p>ä¸‹é¢æ˜¯ Faster R-CNN config æ–‡ä»¶ä¸­ pipeline éƒ¨åˆ†çš„ä¸€ä¸ªä¾‹å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">img_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span> to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>train_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadAnnotations'</span><span class="token punctuation">,</span> with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span> <span class="token operator">**</span>img_norm_cfg<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'gt_bboxes'</span><span class="token punctuation">,</span> <span class="token string">'gt_labels'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>test_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>        transforms<span class="token operator">=</span><span class="token punctuation">[</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span> <span class="token operator">**</span>img_norm_cfg<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Dataset-å®ç°å˜æ¢æ“ä½œ"><a href="#Dataset-å®ç°å˜æ¢æ“ä½œ" class="headerlink" title="Dataset å®ç°å˜æ¢æ“ä½œ"></a>Dataset å®ç°å˜æ¢æ“ä½œ</h3><p>ä»¥ <code>CocoDataset</code> ä¸ºä¾‹ï¼ŒæŸ¥çœ‹è¯¥ç±»çš„ä»£ç ï¼Œå¹¶æ²¡æœ‰å‘ç°åœ¨ <code>mmdet/datasets/coco.py</code> ä¸­æœ‰å®ç° pipelinesã€‚å®é™…ä¸Šï¼Œ<code>CocoDataset</code> è´Ÿè´£å®ç°çš„æ˜¯å¯¹ <code>annotation_file</code> çš„å¤„ç†ï¼Œè€Œå¯¹äº pipelines çš„å®ç°ï¼Œåœ¨å…¶ç»§æ‰¿çš„ <code>CustomDataset</code> ä¸­å®ç°çš„ï¼Œå…·ä½“å®ç°é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>ä½¿ç”¨ <code>Compose</code> ç±»å°† config æ–‡ä»¶ä¸­çš„æ‰€æœ‰å˜æ¢æ“ä½œç±»å®ä¾‹åŒ–ï¼Œå¹¶å°†æ‰€æœ‰çš„ç±»å­˜å‚¨åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­</li><li>å¯¹éœ€è¦å¤„ç†çš„ data ä¾æ¬¡ä½¿ç”¨åˆ—è¡¨ä¸­çš„å˜åŒ–æ“ä½œï¼Œå…·ä½“å‚è€ƒä»£ç  <a href="https://github.com/open-mmlab/mmdetection/blob/master/mmdet/datasets/custom.py">CustomDataset</a> <a href="https://github.com/open-mmlab/mmdetection/blob/master/mmdet/datasets/pipelines/compose.py">Compose</a></li></ol><h2 id="Customize-Models"><a href="#Customize-Models" class="headerlink" title="Customize Models"></a>Customize Models</h2><p>åœ¨ mmdetection ä¸­æ˜¯é€šè¿‡ registry æ¥ç®¡ç†å„ç§æ¨¡å—çš„ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬æ¨¡å‹ä¸­çš„æ¨¡å—ã€‚è€Œå¦‚æœæƒ³è¦é€šè¿‡ registry æ·»åŠ æ¨¡å—çš„é€»è¾‘éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„ backbone, <code>MobileNet</code> ä¸ºä¾‹</p><ol><li><p>å®šä¹‰ä¸€ä¸ªæ–°çš„ backbone, <code>mmdet/models/backbones/mobilenet.py</code></p></li><li><p>å¯¼å…¥è¿™ä¸ªæ¨¡å—ï¼Œæœ‰ä¸¤ç§æ–¹æ³•</p><ul><li><p>åœ¨ <code>__init__.py</code> ä¸­ import è¿™ä¸ªæ¨¡å—ï¼Œ<code>from .mobilenet import MobileNet</code></p></li><li><p>åœ¨ config ä¸­æ·»åŠ  <code>custom_imports</code> å­—å…¸</p></li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">custom_imports <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    imports<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'mmdet.models.backbones.mobilenet'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    allow_failed_imports<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨ config ä¸­ä½¿ç”¨è¿™ä¸ªæ¨¡å—</p></li></ol><p>åœ¨ <code>mmdet/tools/train.py</code> ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ <code>build_detector()</code> å°† config ä¸­æ¨¡å‹çš„å…·ä½“å‚æ•°å®ä¾‹åŒ– registry ä¸­çš„ç±»ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªç®€åŒ–çš„ <code>build_detector()</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> mmcv<span class="token punctuation">.</span>cnn <span class="token keyword">import</span> MODELS <span class="token keyword">as</span> MMCV_MODELS<span class="token keyword">from</span> mmcv<span class="token punctuation">.</span>utils <span class="token keyword">import</span> RegistryMODELS <span class="token operator">=</span> Registry<span class="token punctuation">(</span><span class="token string">'models'</span><span class="token punctuation">,</span> parent<span class="token operator">=</span>MMCV_MODELS<span class="token punctuation">)</span>DETECTORS <span class="token operator">=</span> MODELS<span class="token keyword">def</span> <span class="token function">build_detector</span><span class="token punctuation">(</span>cfg<span class="token punctuation">,</span> train_cfg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> test_cfg<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Build detector."""</span><span class="token keyword">return</span> DETECTORS<span class="token punctuation">.</span>build<span class="token punctuation">(</span>        cfg<span class="token punctuation">,</span> default_args<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>train_cfg<span class="token operator">=</span>train_cfg<span class="token punctuation">,</span> test_cfg<span class="token operator">=</span>test_cfg<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Customize-Runtime-Settings"><a href="#Customize-Runtime-Settings" class="headerlink" title="Customize Runtime Settings"></a>Customize Runtime Settings</h2><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦è®²æ€ä¹ˆé…ç½® optimizer ä»¥åŠè®­ç»ƒæµç¨‹</p><h3 id="Customize-optimization-settings"><a href="#Customize-optimization-settings" class="headerlink" title="Customize optimization settings"></a>Customize optimization settings</h3><p>mmdetection é€‚é…äº†æ‰€æœ‰ pytorch ä¸­çš„ä¼˜åŒ–å™¨ï¼Œåªéœ€è¦ä¿®æ”¹ optimizer çš„ <code>type</code> å…³é”®å­—å³å¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># use Adam optimizer</span>optimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Adam'</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.0003</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Optimizer çš„å®ç°ä¸æ˜¯åœ¨ mmdetection é¡¹ç›®ä¸­ï¼Œè€Œæ˜¯åœ¨ mmcv é¡¹ç›®ä¸­ï¼Œæ‰€ä»¥æƒ³è¦ä¸ªæ€§åŒ–çš„ optimizer åˆ™éœ€è¦è‡ªå·±æ–°å»ºæ–‡ä»¶å¤¹è¿›è¡Œå®ç°ã€‚ç°åœ¨æ–°å»º <code>mmdet/core/optimizer</code> æ–‡ä»¶å¤¹ï¼Œæ–°å»º <code>my_optimizer.py</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> mmcv<span class="token punctuation">.</span>runner<span class="token punctuation">.</span>optimizer <span class="token keyword">import</span> OPTIMIZERS<span class="token keyword">from</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">import</span> Optimizer<span class="token decorator annotation punctuation">@OPTIMIZERS<span class="token punctuation">.</span>register_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">MyOptimizer</span><span class="token punctuation">(</span>Optimizer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> ç„¶åä¿®æ”¹ config æ–‡ä»¶ï¼Œå¹¶ import è¯¥æ¨¡å—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">optimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MyOptimizer'</span><span class="token punctuation">,</span> a<span class="token operator">=</span>a_value<span class="token punctuation">,</span> b<span class="token operator">=</span>b_value<span class="token punctuation">,</span> c<span class="token operator">=</span>c_value<span class="token punctuation">)</span>custom_imports <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>imports<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'mmdet.core.optimizer.my_optimizer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                       allow_failed_imports<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæƒ³è¦å¯¹ optimizer æœ‰æ›´åŠ ç²¾ç»†åŒ–çš„æ“ä½œï¼Œéœ€è¦æ„å»ºæ–°çš„ OPTIMIZER_CONSTRUCTORSï¼Œæ„å»ºé€»è¾‘éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œå› ä¸ºå¾ˆå¤šä¼˜åŒ–æ“ä½œå¹¶ä¸ç†Ÿæ‚‰ï¼Œä¸çŸ¥é“è¯¥æ€ä¹ˆç”¨ï¼Œç­‰æœ‰å…·ä½“çš„ä¾‹å­å†è¿›ä¸€æ­¥äº†è§£</p><h3 id="Customize-training-schedules"><a href="#Customize-training-schedules" class="headerlink" title="Customize training schedules"></a>Customize training schedules</h3><p>åœ¨è®­ç»ƒä¼˜åŒ–çš„è¿‡ç¨‹å½“ä¸­ï¼Œéœ€è¦å¯¹è®­ç»ƒè¿‡ç¨‹è¿›è¡Œä¸€äº›å¾®è°ƒï¼Œä¾‹å¦‚å¯¹ learning rate è¿›è¡Œè¡°å‡ï¼Œmmdetection ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ hook åšåˆ°ï¼Œæ‰€è°“çš„ Hook å°±æ˜¯åœ¨æ¯ä¸ª epoch or iteration ä¹‹å‰ã€ä¹‹åè¿›è¡Œçš„ä¸€äº›æ“ä½œã€‚å…·ä½“æ›´æ”¹ training schedule çš„æ“ä½œä¸ºï¼šåœ¨ config æ–‡ä»¶ä¸­é…ç½® <code>lr_config</code> ç­‰å­—æ®µã€‚ä¾‹å¦‚é»˜è®¤çš„é˜¶æ¢¯ç­–ç•¥ <code>StepLR</code> å¯ä»¥åœ¨æŒ‡å®šçš„ epoch è°ƒæ•´å­¦ä¹ ç‡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">lr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    policy<span class="token operator">=</span><span class="token string">'step'</span><span class="token punctuation">,</span>    warmup<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span>    warmup_iters<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>    warmup_ratio<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>    step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Customize-workflow"><a href="#Customize-workflow" class="headerlink" title="Customize workflow"></a>Customize workflow</h3><p>è¿™éƒ¨åˆ†åŸºæœ¬ä¸Šå°±ä½¿ç”¨é»˜è®¤çš„ workflow å°±å¥½ï¼Œå³ <code>workflow = [('train',1)]</code> ï¼Œè¿™å°†ä¼šä¸€æ¬¡ä¸€æ¬¡åœ°å¾ªç¯è®­ç»ƒé›†ï¼Œç›´åˆ°è¾¾åˆ° <code>total_epochs/max_epochs</code> å¦‚æœæƒ³è¦è®­ç»ƒå¤šä¸ª epoch è¿‡åå¯¹æ¨¡å‹è¿›è¡Œ evaluation åˆ™æ˜¯è°ƒç”¨ <code>EvalHook</code>ï¼Œè€Œè¿™åœ¨ config æ–‡ä»¶ä¸­å¯¹åº”çš„æ˜¯ <code>evaluation</code> å­—æ®µ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">workflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment"># æ¯é—´éš”ä¸€æ¬¡è¿›è¡Œè¯„ä¼°</span>evaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'bbox'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="Customize-hooks"><a href="#Customize-hooks" class="headerlink" title="Customize hooks"></a>Customize hooks</h3><p>åœ¨ä¹‹å‰å·²ç»æåˆ°äº† hooks çš„ä½œç”¨ï¼Œmmdetection ä¸­å·²ç»å®ç°äº†ä¸€äº› hooksï¼š</p><ul><li>og_config</li><li>checkpoint_config</li><li>evaluation</li><li>lr_config</li><li>optimizer_config</li><li>momentum_config</li></ul><p>è¿™äº› hooks èƒ½å¤Ÿåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å»æä¾›å¾®è°ƒã€è¯„ä¼°ã€è®°å½•ç­‰åŠŸèƒ½ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹å…¶ä¸­çš„2ä¸ª</p><ol><li><p>Checkpoint configï¼Œç”¨äºä¿å­˜è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¨¡å‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">checkpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>Log configï¼Œç”¨äºè®°å½•è®­ç»ƒè¿‡ç¨‹ä¸­çš„å…³é”®æ•°æ®ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ª logger</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">log_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>    hooks<span class="token operator">=</span><span class="token punctuation">[</span>        <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'TextLoggerHook'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'TensorboardLoggerHook'</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>å¦‚æœæƒ³è¦ä½¿ç”¨ä¸ªæ€§åŒ–çš„ hookï¼Œå‡†å¤‡è¿‡ç¨‹ä¹Ÿæ˜¯è€3æ­¥äº†</p><ol><li><p>å®šä¹‰æ–°çš„ hook</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> mmcv<span class="token punctuation">.</span>runner <span class="token keyword">import</span> HOOKS<span class="token punctuation">,</span> Hook<span class="token decorator annotation punctuation">@HOOKS<span class="token punctuation">.</span>register_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">MyHook</span><span class="token punctuation">(</span>Hook<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">before_run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> runner<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">after_run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> runner<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">before_epoch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> runner<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">after_epoch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> runner<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">before_iter</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> runner<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">after_iter</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> runner<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¼å…¥æ–°çš„ hook</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">custom_imports <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>imports<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'mmdet.core.utils.my_hook'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> allow_failed_imports<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ä½¿ç”¨æ–°çš„ hook</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">custom_hooks <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MyHook'</span><span class="token punctuation">,</span> a<span class="token operator">=</span>a_value<span class="token punctuation">,</span> b<span class="token operator">=</span>b_value<span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><p>å¯¹äº hook çš„è°ƒç”¨ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥äº†è§£ <code>Runner</code> ç±»ã€‚mmdetection æ˜¯å°†è¿™äº› hook config ä¼ å…¥åˆ°äº† <code>runner</code> å®ä¾‹ä¸­ï¼Œå¹¶åœ¨å…¶ä¸­åˆ›å»º hook å®ä¾‹ã€‚æ›´å¤šæœ‰å…³ <code>Runner</code> çš„å†…å®¹éœ€è¦åœ¨ <a href="https://mmcv.readthedocs.io/en/latest/understand_mmcv/runner.html#">mmcv</a> é‡Œå»æŸ¥çœ‹</p><h2 id="Customize-Losses"><a href="#Customize-Losses" class="headerlink" title="Customize Losses"></a>Customize Losses</h2><p>mmdetction ä¸­æŸå¤±å‡½æ•°æ˜¯ç›´æ¥åœ¨æ¨¡å‹ä¸­å„ä¸ª prediction head ä¸­ä½¿ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ forward pass ä¹‹åå•ç‹¬ä½¿ç”¨ï¼Œæ‰€ä»¥å…¶å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Œå–å†³äºæ¨¡å‹ä¹‹ä¸­å„ä¸ª prediction head æ€ä¹ˆæ¥æ”¶æŸå¤±å‡½æ•°ã€‚ä»¥ <code>loss_cls</code> å­—æ®µä¸ºä¾‹ä½¿ç”¨ <code>FocalLoss</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">loss_cls<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'FocalLoss'</span><span class="token punctuation">,</span>    use_sigmoid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    gamma<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">,</span>    alpha<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>    loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Finetuning-Models"><a href="#Finetuning-Models" class="headerlink" title="Finetuning Models"></a>Finetuning Models</h2><p>å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹å‚æ•°å·²ç»æœ‰è¾ƒå¥½çš„ç‰¹å¾æå–èƒ½åŠ›ï¼Œæ‰€ä»¥å°†è¿™äº›å‚æ•°ç”¨äºæ–°çš„æ•°æ®é›†åªéœ€è¦ä¸€äº›å¾®è°ƒã€‚é™¤äº†è¦å‡†å¤‡å¥½è‡ªå·±æ•°æ®é›†å’Œ config ä¹‹å¤–ï¼Œéœ€è¦æ³¨æ„çš„å°±æ˜¯è°ƒæ•´ training scheduleã€‚ç”±äºæ˜¯ä»…å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œæ‰€ä»¥å­¦ä¹ ç‡åº”è¯¥è®¾ç½®å¾—ç›¸å¯¹å°ä¸€äº›ï¼Œå¹¶ä¸” epoch ä¹Ÿåº”å½“å°‘ä¸€äº›ä»¥é¿å…è¿‡æ‹Ÿåˆã€‚æ–‡æ¡£ç»™å‡ºäº†ä¸€ä¸ªå‚è€ƒçš„ä¾‹å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># optimizer</span><span class="token comment"># lr is set for a batch size of 8</span>optimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'SGD'</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span> momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>optimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>grad_clip<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment"># learning policy</span>lr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    policy<span class="token operator">=</span><span class="token string">'step'</span><span class="token punctuation">,</span>    warmup<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span>    warmup_iters<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>    warmup_ratio<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>    step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># the max_epochs and step in lr_config need specifically tuned for the customized dataset</span>runner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>max_epochs<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>log_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token comment"># We can use the pre-trained Mask RCNN model to obtain higher performance</span>load_from <span class="token operator">=</span> <span class="token string">'checkpoints/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco_bbox_mAP-0.408__segm_mAP-0.37_20200504_163245-42aa3d00.pth'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯ä»¥æŠŠ mmdetection çš„ä½¿ç”¨åˆ†ä¸ºä¸¤ä¸ªå¤§å—æ¥è¿›è¡Œç†è§£ï¼š</p><ol><li>æ¨¡å‹çš„å»ºç«‹</li><li>æ¨¡å‹çš„è®­ç»ƒ</li></ol><p>é¦–å…ˆæ˜¯æ¨¡å‹çš„å»ºç«‹ï¼Œå…¶æ ¸å¿ƒä¸º config &amp; registryï¼Œè¦ç†è§£è¿™ä¸¤ä¸ªç±»çš„ä½œç”¨ã€‚é€šè¿‡ config å°†æ¨¡å‹çš„æ‰€æœ‰æ„é€ ç»†èŠ‚éƒ½ä»¥å­—å…¸çš„å½¢å¼åŒ…å«è¿›æ¥äº†ï¼Œå°†è¿™äº› config ä¼ å…¥åˆ° registry ä¸­æ³¨å†Œå¥½çš„æ¨¡å‹ç±»ä¸­ä»è€Œå®ç°æ¨¡å‹çš„å®ä¾‹åŒ–ã€‚ä»ä¸­å¯ä»¥çœ‹åˆ°æ³¨å†Œå’Œä½¿ç”¨ä»»ä½•æ–°æ¨¡å—çš„ä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼šå®šä¹‰æ¨¡å‹ã€å¯¼å…¥æ¨¡å‹ã€ä¿®æ”¹ config æ–‡ä»¶</p><p>æ¥ç€æ˜¯æ¨¡å‹çš„è®­ç»ƒï¼Œéƒ¨åˆ†çš„æ ¸å¿ƒä¸º optimizer &amp; runnerã€‚å…¶ä¸­ runner åŒ…å«äº†ä¸åŒçš„ hook ä»¥åœ¨æ¯ä¸€ä¸ª epoch/iter ä¹‹å‰/ä¹‹åè¿›è¡Œéœ€è¦çš„æ“ä½œï¼Œä¾‹å¦‚ï¼šè°ƒæ•´å­¦ä¹ ç‡ã€ä¿å­˜æ¨¡å‹ã€è®°å½•æ•°æ®ç­‰ç­‰ã€‚å½“ç„¶è¿™äº›åŠŸèƒ½ä¹Ÿæ˜¯é€šè¿‡ config &amp; registry æ¥è¿›è¡Œç®¡ç†çš„</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ config æ–‡ä»¶åŠå…¶ç®€è¦æ³¨é‡Šè¯´æ˜ï¼Œä¸º ResNet50 å’Œ FPN çš„ Mask R-CNN çš„é…ç½®æ–‡ä»¶ã€‚é…åˆä¹‹å‰çš„ tutorialï¼Œå¯ä»¥å…·ä½“çœ‹çœ‹æ¯ä¸ªå­—æ®µåœ¨ config æ–‡ä»¶ä¸­çš„ä»€ä¹ˆä½ç½®ã€æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œå¸®åŠ©æ•´ä½“æŠŠæ¡ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ mmdetection github é¡¹ç›®ä¸Šè¿›è¡Œæœç´¢ï¼ŒæŸ¥æ‰¾æºç ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">model <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MaskRCNN'</span><span class="token punctuation">,</span>  <span class="token comment"># æ£€æµ‹å™¨(detector)åç§°</span>    backbone<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># ä¸»å¹²ç½‘ç»œçš„é…ç½®æ–‡ä»¶</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ResNet'</span><span class="token punctuation">,</span>  <span class="token comment"># ä¸»å¹²ç½‘ç»œçš„ç±»åˆ«ï¼Œå¯ç”¨é€‰é¡¹è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/models/backbones/resnet.py#L308</span>        depth<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>  <span class="token comment"># ä¸»å¹²ç½‘ç»œçš„æ·±åº¦ï¼Œå¯¹äº ResNet å’Œ ResNext é€šå¸¸è®¾ç½®ä¸º 50 æˆ– 101ã€‚</span>        num_stages<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>  <span class="token comment"># ä¸»å¹²ç½‘ç»œçŠ¶æ€(stages)çš„æ•°ç›®ï¼Œè¿™äº›çŠ¶æ€äº§ç”Ÿçš„ç‰¹å¾å›¾ä½œä¸ºåç»­çš„ head çš„è¾“å…¥ã€‚</span>        out_indices<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æ¯ä¸ªçŠ¶æ€äº§ç”Ÿçš„ç‰¹å¾å›¾è¾“å‡ºçš„ç´¢å¼•ã€‚</span>        frozen_stages<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># ç¬¬ä¸€ä¸ªçŠ¶æ€çš„æƒé‡è¢«å†»ç»“</span>        norm_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># å½’ä¸€åŒ–å±‚(norm layer)çš„é…ç½®é¡¹ã€‚</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'BN'</span><span class="token punctuation">,</span>  <span class="token comment"># å½’ä¸€åŒ–å±‚çš„ç±»åˆ«ï¼Œé€šå¸¸æ˜¯ BN æˆ– GNã€‚</span>            requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦è®­ç»ƒå½’ä¸€åŒ–é‡Œçš„ gamma å’Œ betaã€‚</span>        norm_eval<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦å†»ç»“ BN é‡Œçš„ç»Ÿè®¡é¡¹ã€‚</span>        style<span class="token operator">=</span><span class="token string">'pytorch'</span><span class="token punctuation">,</span>  <span class="token comment"># ä¸»å¹²ç½‘ç»œçš„é£æ ¼ï¼Œ'pytorch' æ„æ€æ˜¯æ­¥é•¿ä¸º2çš„å±‚ä¸º 3x3 å·ç§¯ï¼Œ 'caffe' æ„æ€æ˜¯æ­¥é•¿ä¸º2çš„å±‚ä¸º 1x1 å·ç§¯ã€‚</span>       init_cfg<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pretrained'</span><span class="token punctuation">,</span> checkpoint<span class="token operator">=</span><span class="token string">'torchvision://resnet50'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># åŠ è½½é€šè¿‡ ImageNet ä¸è®­ç»ƒçš„æ¨¡å‹</span>    neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'FPN'</span><span class="token punctuation">,</span>  <span class="token comment"># æ£€æµ‹å™¨çš„ neck æ˜¯ FPNï¼Œæˆ‘ä»¬åŒæ ·æ”¯æŒ 'NASFPN', 'PAFPN' ç­‰ï¼Œæ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/models/necks/fpn.py#L10ã€‚</span>        in_channels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># è¾“å…¥é€šé“æ•°ï¼Œè¿™ä¸ä¸»å¹²ç½‘ç»œçš„è¾“å‡ºé€šé“ä¸€è‡´</span>        out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># é‡‘å­—å¡”ç‰¹å¾å›¾æ¯ä¸€å±‚çš„è¾“å‡ºé€šé“</span>        num_outs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># è¾“å‡ºçš„èŒƒå›´(scales)</span>    rpn_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RPNHead'</span><span class="token punctuation">,</span>  <span class="token comment"># RPN_head çš„ç±»å‹æ˜¯ 'RPNHead', æˆ‘ä»¬ä¹Ÿæ”¯æŒ 'GARPNHead' ç­‰ï¼Œæ›´å¤šç»†èŠ‚å¯ä»¥å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/models/dense_heads/rpn_head.py#L12ã€‚</span>        in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># æ¯ä¸ªè¾“å…¥ç‰¹å¾å›¾çš„è¾“å…¥é€šé“ï¼Œè¿™ä¸ neck çš„è¾“å‡ºé€šé“ä¸€è‡´ã€‚</span>        feat_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># head å·ç§¯å±‚çš„ç‰¹å¾é€šé“ã€‚</span>        anchor_generator<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># é”šç‚¹(Anchor)ç”Ÿæˆå™¨çš„é…ç½®ã€‚</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'AnchorGenerator'</span><span class="token punctuation">,</span>  <span class="token comment"># å¤§å¤šæ˜¯æ–¹æ³•ä½¿ç”¨ AnchorGenerator ä½œä¸ºé”šç‚¹ç”Ÿæˆå™¨, SSD æ£€æµ‹å™¨ä½¿ç”¨ `SSDAnchorGenerator`ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/core/anchor/anchor_generator.py#L10ã€‚</span>            scales<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># é”šç‚¹çš„åŸºæœ¬æ¯”ä¾‹ï¼Œç‰¹å¾å›¾æŸä¸€ä½ç½®çš„é”šç‚¹é¢ç§¯ä¸º scale * base_sizes</span>            ratios<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># é«˜åº¦å’Œå®½åº¦ä¹‹é—´çš„æ¯”ç‡ã€‚</span>            strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># é”šç”Ÿæˆå™¨çš„æ­¥å¹…ã€‚è¿™ä¸ FPN ç‰¹å¾æ­¥å¹…ä¸€è‡´ã€‚ å¦‚æœæœªè®¾ç½® base_sizesï¼Œåˆ™å½“å‰æ­¥å¹…å€¼å°†è¢«è§†ä¸º base_sizesã€‚</span>        bbox_coder<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># åœ¨è®­ç»ƒå’Œæµ‹è¯•æœŸé—´å¯¹æ¡†è¿›è¡Œç¼–ç å’Œè§£ç ã€‚</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span><span class="token punctuation">,</span>  <span class="token comment"># æ¡†ç¼–ç å™¨çš„ç±»åˆ«ï¼Œ'DeltaXYWHBBoxCoder' æ˜¯æœ€å¸¸ç”¨çš„ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/core/bbox/coder/delta_xywh_bbox_coder.py#L9ã€‚</span>            target_means<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># ç”¨äºç¼–ç å’Œè§£ç æ¡†çš„ç›®æ ‡å‡å€¼</span>            target_stds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># ç”¨äºç¼–ç å’Œè§£ç æ¡†çš„æ ‡å‡†æ–¹å·®</span>        loss_cls<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># åˆ†ç±»åˆ†æ”¯çš„æŸå¤±å‡½æ•°é…ç½®</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span>  <span class="token comment"># åˆ†ç±»åˆ†æ”¯çš„æŸå¤±ç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿæ”¯æŒ FocalLoss ç­‰ã€‚</span>            use_sigmoid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># RPNé€šå¸¸è¿›è¡ŒäºŒåˆ†ç±»ï¼Œæ‰€ä»¥é€šå¸¸ä½¿ç”¨sigmoidå‡½æ•°ã€‚</span>            los_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># åˆ†ç±»åˆ†æ”¯çš„æŸå¤±æƒé‡ã€‚</span>        loss_bbox<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># å›å½’åˆ†æ”¯çš„æŸå¤±å‡½æ•°é…ç½®ã€‚</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'L1Loss'</span><span class="token punctuation">,</span>  <span class="token comment"># æŸå¤±ç±»å‹ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒè®¸å¤š IoU Losses å’Œ Smooth L1-loss ç­‰ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/models/losses/smooth_l1_loss.py#L56ã€‚</span>            loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å›å½’åˆ†æ”¯çš„æŸå¤±æƒé‡ã€‚</span>    roi_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># RoIHead å°è£…äº†ä¸¤æ­¥(two-stage)/çº§è”(cascade)æ£€æµ‹å™¨çš„ç¬¬äºŒæ­¥ã€‚</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'StandardRoIHead'</span><span class="token punctuation">,</span>  <span class="token comment"># RoI head çš„ç±»å‹ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/models/roi_heads/standard_roi_head.py#L10ã€‚</span>        bbox_roi_extractor<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># ç”¨äº bbox å›å½’çš„ RoI ç‰¹å¾æå–å™¨ã€‚</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>  <span class="token comment"># RoI ç‰¹å¾æå–å™¨çš„ç±»å‹ï¼Œå¤§å¤šæ•°æ–¹æ³•ä½¿ç”¨  SingleRoIExtractorï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/models/roi_heads/roi_extractors/single_level.py#L10ã€‚</span>            roi_layer<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># RoI å±‚çš„é…ç½®</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span>  <span class="token comment"># RoI å±‚çš„ç±»åˆ«, ä¹Ÿæ”¯æŒ DeformRoIPoolingPack å’Œ ModulatedDeformRoIPoolingPackï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/ops/roi_align/roi_align.py#L79ã€‚</span>                output_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>  <span class="token comment"># ç‰¹å¾å›¾çš„è¾“å‡ºå¤§å°ã€‚</span>                sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æå– RoI ç‰¹å¾æ—¶çš„é‡‡æ ·ç‡ã€‚0 è¡¨ç¤ºè‡ªé€‚åº”æ¯”ç‡ã€‚</span>            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># æå–ç‰¹å¾çš„è¾“å‡ºé€šé“ã€‚</span>            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å¤šå°ºåº¦ç‰¹å¾å›¾çš„æ­¥å¹…ï¼Œåº”è¯¥ä¸ä¸»å¹²çš„æ¶æ„ä¿æŒä¸€è‡´ã€‚</span>        bbox_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># RoIHead ä¸­ box head çš„é…ç½®.</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Shared2FCBBoxHead'</span><span class="token punctuation">,</span>  <span class="token comment"># bbox head çš„ç±»åˆ«ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/models/roi_heads/bbox_heads/convfc_bbox_head.py#L177ã€‚</span>            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># bbox head çš„è¾“å…¥é€šé“ã€‚ è¿™ä¸ roi_extractor ä¸­çš„ out_channels ä¸€è‡´ã€‚</span>            fc_out_channels<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span>  <span class="token comment"># FC å±‚çš„è¾“å‡ºç‰¹å¾é€šé“ã€‚</span>            roi_feat_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span>  <span class="token comment"># å€™é€‰åŒºåŸŸ(Region of Interest)ç‰¹å¾çš„å¤§å°ã€‚</span>            num_classes<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>  <span class="token comment"># åˆ†ç±»çš„ç±»åˆ«æ•°é‡ã€‚</span>            bbox_coder<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># ç¬¬äºŒé˜¶æ®µä½¿ç”¨çš„æ¡†ç¼–ç å™¨ã€‚</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span><span class="token punctuation">,</span>  <span class="token comment"># æ¡†ç¼–ç å™¨çš„ç±»åˆ«ï¼Œå¤§å¤šæ•°æƒ…å†µä½¿ç”¨ 'DeltaXYWHBBoxCoder'ã€‚</span>                target_means<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># ç”¨äºç¼–ç å’Œè§£ç æ¡†çš„å‡å€¼</span>                target_stds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># ç¼–ç å’Œè§£ç çš„æ ‡å‡†æ–¹å·®ã€‚å› ä¸ºæ¡†æ›´å‡†ç¡®ï¼Œæ‰€ä»¥å€¼æ›´å°ï¼Œå¸¸è§„è®¾ç½®æ—¶ [0.1, 0.1, 0.2, 0.2]ã€‚</span>            reg_class_agnostic<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># å›å½’æ˜¯å¦ä¸ç±»åˆ«æ— å…³ã€‚</span>            loss_cls<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># åˆ†ç±»åˆ†æ”¯çš„æŸå¤±å‡½æ•°é…ç½®</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span>  <span class="token comment"># åˆ†ç±»åˆ†æ”¯çš„æŸå¤±ç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿæ”¯æŒ FocalLoss ç­‰ã€‚</span>                use_sigmoid<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦ä½¿ç”¨ sigmoidã€‚</span>                loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># åˆ†ç±»åˆ†æ”¯çš„æŸå¤±æƒé‡ã€‚</span>            loss_bbox<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># å›å½’åˆ†æ”¯çš„æŸå¤±å‡½æ•°é…ç½®ã€‚</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'L1Loss'</span><span class="token punctuation">,</span>  <span class="token comment"># æŸå¤±ç±»å‹ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒè®¸å¤š IoU Losses å’Œ Smooth L1-loss ç­‰ã€‚</span>                loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å›å½’åˆ†æ”¯çš„æŸå¤±æƒé‡ã€‚</span>        mask_roi_extractor<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># ç”¨äº mask ç”Ÿæˆçš„ RoI ç‰¹å¾æå–å™¨ã€‚</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span><span class="token punctuation">,</span>  <span class="token comment"># RoI ç‰¹å¾æå–å™¨çš„ç±»å‹ï¼Œå¤§å¤šæ•°æ–¹æ³•ä½¿ç”¨ SingleRoIExtractorã€‚</span>            roi_layer<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># æå–å®ä¾‹åˆ†å‰²ç‰¹å¾çš„ RoI å±‚é…ç½®</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RoIAlign'</span><span class="token punctuation">,</span>  <span class="token comment"># RoI å±‚çš„ç±»å‹ï¼Œä¹Ÿæ”¯æŒ DeformRoIPoolingPack å’Œ ModulatedDeformRoIPoolingPackã€‚</span>                output_size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">,</span>  <span class="token comment"># ç‰¹å¾å›¾çš„è¾“å‡ºå¤§å°ã€‚</span>                sampling_ratio<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æå– RoI ç‰¹å¾æ—¶çš„é‡‡æ ·ç‡ã€‚</span>            out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># æå–ç‰¹å¾çš„è¾“å‡ºé€šé“ã€‚</span>            featmap_strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å¤šå°ºåº¦ç‰¹å¾å›¾çš„æ­¥å¹…ã€‚</span>        mask_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># mask é¢„æµ‹ head æ¨¡å‹</span>            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'FCNMaskHead'</span><span class="token punctuation">,</span>  <span class="token comment"># mask head çš„ç±»å‹ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/models/roi_heads/mask_heads/fcn_mask_head.py#L21ã€‚</span>            num_convs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>  <span class="token comment"># mask head ä¸­çš„å·ç§¯å±‚æ•°</span>            in_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># è¾“å…¥é€šé“ï¼Œåº”ä¸ mask roi extractor çš„è¾“å‡ºé€šé“ä¸€è‡´ã€‚</span>            conv_out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># å·ç§¯å±‚çš„è¾“å‡ºé€šé“ã€‚</span>            num_classes<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span>  <span class="token comment"># è¦åˆ†å‰²çš„ç±»åˆ«æ•°ã€‚</span>            loss_mask<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># mask åˆ†æ”¯çš„æŸå¤±å‡½æ•°é…ç½®ã€‚</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span><span class="token punctuation">,</span>  <span class="token comment"># ç”¨äºåˆ†å‰²çš„æŸå¤±ç±»å‹ã€‚</span>                use_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦åªåœ¨æ­£ç¡®çš„ç±»ä¸­è®­ç»ƒ maskã€‚</span>                loss_weight<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># mask åˆ†æ”¯çš„æŸå¤±æƒé‡.</span>    train_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># rpn å’Œ rcnn è®­ç»ƒè¶…å‚æ•°çš„é…ç½®</span>        rpn<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># rpn çš„è®­ç»ƒé…ç½®</span>            assigner<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># åˆ†é…å™¨(assigner)çš„é…ç½®</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>  <span class="token comment"># åˆ†é…å™¨çš„ç±»å‹ï¼ŒMaxIoUAssigner ç”¨äºè®¸å¤šå¸¸è§çš„æ£€æµ‹å™¨ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/core/bbox/assigners/max_iou_assigner.py#L10ã€‚</span>                pos_iou_thr<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">,</span>  <span class="token comment"># IoU &gt;= 0.7(é˜ˆå€¼) è¢«è§†ä¸ºæ­£æ ·æœ¬ã€‚</span>                neg_iou_thr<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>  <span class="token comment"># IoU &lt; 0.3(é˜ˆå€¼) è¢«è§†ä¸ºè´Ÿæ ·æœ¬ã€‚</span>                min_pos_iou<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>  <span class="token comment"># å°†æ¡†ä½œä¸ºæ­£æ ·æœ¬çš„æœ€å° IoU é˜ˆå€¼ã€‚</span>                match_low_quality<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦åŒ¹é…ä½è´¨é‡çš„æ¡†(æ›´å¤šç»†èŠ‚è§ API æ–‡æ¡£).</span>                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å¿½ç•¥ bbox çš„ IoF é˜ˆå€¼ã€‚</span>            sampler<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># æ­£/è´Ÿé‡‡æ ·å™¨(sampler)çš„é…ç½®</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>  <span class="token comment"># é‡‡æ ·å™¨ç±»å‹ï¼Œè¿˜æ”¯æŒ PseudoSampler å’Œå…¶ä»–é‡‡æ ·å™¨ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/core/bbox/samplers/random_sampler.py#L8ã€‚</span>                num<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>  <span class="token comment"># æ ·æœ¬æ•°é‡ã€‚</span>                pos_fraction<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token comment"># æ­£æ ·æœ¬å æ€»æ ·æœ¬çš„æ¯”ä¾‹ã€‚</span>                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># åŸºäºæ­£æ ·æœ¬æ•°é‡çš„è´Ÿæ ·æœ¬ä¸Šé™ã€‚</span>                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># é‡‡æ ·åæ˜¯å¦æ·»åŠ  GT ä½œä¸º proposalã€‚</span>            allowed_border<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># å¡«å……æœ‰æ•ˆé”šç‚¹åå…è®¸çš„è¾¹æ¡†ã€‚</span>            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># è®­ç»ƒæœŸé—´æ­£æ ·æœ¬çš„æƒé‡ã€‚</span>            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦è®¾ç½®è°ƒè¯•(debug)æ¨¡å¼</span>        rpn_proposal<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># åœ¨è®­ç»ƒæœŸé—´ç”Ÿæˆ proposals çš„é…ç½®</span>            nms_across_levels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦å¯¹è·¨å±‚çš„ box åš NMSã€‚ä»…é€‚ç”¨äº `GARPNHead` ï¼Œnaive rpn ä¸æ”¯æŒ nms cross levelsã€‚</span>            nms_pre<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">,</span>  <span class="token comment"># NMS å‰çš„ box æ•°</span>            nms_post<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment"># NMS è¦ä¿ç•™çš„ box çš„æ•°é‡ï¼Œåªåœ¨ GARPNHHead ä¸­èµ·ä½œç”¨ã€‚</span>            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment"># NMS åè¦ä¿ç•™çš„ box æ•°é‡ã€‚</span>            nms<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span> <span class="token comment"># NMS çš„é…ç½®</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span>  <span class="token comment"># NMS çš„ç±»åˆ«</span>                iou_threshold<span class="token operator">=</span><span class="token number">0.7</span> <span class="token comment"># NMS çš„é˜ˆå€¼</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å…è®¸çš„æœ€å° box å°ºå¯¸</span>        rcnn<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># roi head çš„é…ç½®ã€‚</span>            assigner<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># ç¬¬äºŒé˜¶æ®µåˆ†é…å™¨çš„é…ç½®ï¼Œè¿™ä¸ rpn ä¸­çš„ä¸åŒ</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span><span class="token punctuation">,</span>  <span class="token comment"># åˆ†é…å™¨çš„ç±»å‹ï¼ŒMaxIoUAssigner ç›®å‰ç”¨äºæ‰€æœ‰ roi_headsã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/core/bbox/assigners/max_iou_assigner.py#L10ã€‚</span>                pos_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token comment"># IoU &gt;= 0.5(é˜ˆå€¼)è¢«è®¤ä¸ºæ˜¯æ­£æ ·æœ¬ã€‚</span>                neg_iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token comment"># IoU &lt; 0.5(é˜ˆå€¼)è¢«è®¤ä¸ºæ˜¯è´Ÿæ ·æœ¬ã€‚</span>                min_pos_iou<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>  <span class="token comment"># å°† box ä½œä¸ºæ­£æ ·æœ¬çš„æœ€å° IoU é˜ˆå€¼</span>                match_low_quality<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦åŒ¹é…ä½è´¨é‡ä¸‹çš„ box(æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… API æ–‡æ¡£)ã€‚</span>                ignore_iof_thr<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å¿½ç•¥ bbox çš„ IoF é˜ˆå€¼</span>            sampler<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomSampler'</span><span class="token punctuation">,</span>  <span class="token comment">#é‡‡æ ·å™¨çš„ç±»å‹ï¼Œè¿˜æ”¯æŒ PseudoSampler å’Œå…¶ä»–é‡‡æ ·å™¨ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/core/bbox/samplers/random_sampler.py#L8ã€‚</span>                num<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span>  <span class="token comment"># æ ·æœ¬æ•°é‡</span>                pos_fraction<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span>  <span class="token comment"># æ­£æ ·æœ¬å æ€»æ ·æœ¬çš„æ¯”ä¾‹ã€‚.</span>                neg_pos_ub<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># åŸºäºæ­£æ ·æœ¬æ•°é‡çš„è´Ÿæ ·æœ¬ä¸Šé™ã€‚.</span>                add_gt_as_proposals<span class="token operator">=</span><span class="token boolean">True</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># é‡‡æ ·åæ˜¯å¦æ·»åŠ  GT ä½œä¸º proposalã€‚</span>            mask_size<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">,</span>  <span class="token comment"># mask çš„å¤§å°</span>            pos_weight<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># è®­ç»ƒæœŸé—´æ­£æ ·æœ¬çš„æƒé‡ã€‚</span>            debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># æ˜¯å¦è®¾ç½®è°ƒè¯•æ¨¡å¼ã€‚</span>    test_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># ç”¨äºæµ‹è¯• rnn å’Œ rnn è¶…å‚æ•°çš„é…ç½®</span>        rpn<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># æµ‹è¯•é˜¶æ®µç”Ÿæˆ proposals çš„é…ç½®</span>            nms_across_levels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦å¯¹è·¨å±‚çš„ box åš NMSã€‚ä»…é€‚ç”¨äº`GARPNHead`ï¼Œnaive rpn ä¸æ”¯æŒåš NMS cross levelsã€‚</span>            nms_pre<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment"># NMS å‰çš„ box æ•°</span>            nms_post<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment"># NMS è¦ä¿ç•™çš„ box çš„æ•°é‡ï¼Œåªåœ¨`GARPNHHead`ä¸­èµ·ä½œç”¨ã€‚</span>            max_per_img<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>  <span class="token comment"># NMS åè¦ä¿ç•™çš„ box æ•°é‡</span>            nms<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span> <span class="token comment"># NMS çš„é…ç½®</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span>  <span class="token comment"># NMS çš„ç±»å‹</span>                iou_threshold<span class="token operator">=</span><span class="token number">0.7</span> <span class="token comment"># NMS é˜ˆå€¼</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>            min_bbox_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># box å…è®¸çš„æœ€å°å°ºå¯¸</span>        rcnn<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># roi heads çš„é…ç½®</span>            score_thr<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>  <span class="token comment"># bbox çš„åˆ†æ•°é˜ˆå€¼</span>            nms<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># ç¬¬äºŒæ­¥çš„ NMS é…ç½®</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'nms'</span><span class="token punctuation">,</span>  <span class="token comment"># NMS çš„ç±»å‹</span>                iou_thr<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># NMS çš„é˜ˆå€¼</span>            max_per_img<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>  <span class="token comment"># æ¯å¼ å›¾åƒçš„æœ€å¤§æ£€æµ‹æ¬¡æ•°</span>            mask_thr_binary<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># mask é¢„å¤„çš„é˜ˆå€¼</span>dataset_type <span class="token operator">=</span> <span class="token string">'CocoDataset'</span>  <span class="token comment"># æ•°æ®é›†ç±»å‹ï¼Œè¿™å°†è¢«ç”¨æ¥å®šä¹‰æ•°æ®é›†ã€‚</span>data_root <span class="token operator">=</span> <span class="token string">'data/coco/'</span>  <span class="token comment"># æ•°æ®çš„æ ¹è·¯å¾„ã€‚</span>img_norm_cfg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment">#å›¾åƒå½’ä¸€åŒ–é…ç½®ï¼Œç”¨æ¥å½’ä¸€åŒ–è¾“å…¥çš„å›¾åƒã€‚</span>    mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># é¢„è®­ç»ƒé‡Œç”¨äºé¢„è®­ç»ƒä¸»å¹²ç½‘ç»œæ¨¡å‹çš„å¹³å‡å€¼ã€‚</span>    std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># é¢„è®­ç»ƒé‡Œç”¨äºé¢„è®­ç»ƒä¸»å¹²ç½‘ç»œæ¨¡å‹çš„æ ‡å‡†å·®ã€‚</span>    to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment">#  é¢„è®­ç»ƒé‡Œç”¨äºé¢„è®­ç»ƒä¸»å¹²ç½‘ç»œçš„å›¾åƒçš„é€šé“é¡ºåºã€‚</span>train_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token comment"># è®­ç»ƒæµç¨‹</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># ç¬¬ 1 ä¸ªæµç¨‹ï¼Œä»æ–‡ä»¶è·¯å¾„é‡ŒåŠ è½½å›¾åƒã€‚</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadAnnotations'</span><span class="token punctuation">,</span>  <span class="token comment"># ç¬¬ 2 ä¸ªæµç¨‹ï¼Œå¯¹äºå½“å‰å›¾åƒï¼ŒåŠ è½½å®ƒçš„æ³¨é‡Šä¿¡æ¯ã€‚</span>        with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦ä½¿ç”¨æ ‡æ³¨æ¡†(bounding box)ï¼Œ ç›®æ ‡æ£€æµ‹éœ€è¦è®¾ç½®ä¸º Trueã€‚</span>        with_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦ä½¿ç”¨ instance maskï¼Œå®ä¾‹åˆ†å‰²éœ€è¦è®¾ç½®ä¸º Trueã€‚</span>        poly2mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦å°† polygon mask è½¬åŒ–ä¸º instance mask, è®¾ç½®ä¸º False ä»¥åŠ é€Ÿå’ŒèŠ‚çœå†…å­˜ã€‚</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span>  <span class="token comment"># å˜åŒ–å›¾åƒå’Œå…¶æ³¨é‡Šå¤§å°çš„æ•°æ®å¢å¹¿çš„æµç¨‹ã€‚</span>        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å›¾åƒçš„æœ€å¤§è§„æ¨¡ã€‚</span>        keep_ratio<span class="token operator">=</span><span class="token boolean">True</span>    <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦ä¿æŒå›¾åƒçš„é•¿å®½æ¯”ã€‚</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">,</span>  <span class="token comment">#  ç¿»è½¬å›¾åƒå’Œå…¶æ³¨é‡Šå¤§å°çš„æ•°æ®å¢å¹¿çš„æµç¨‹ã€‚</span>        flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># ç¿»è½¬å›¾åƒçš„æ¦‚ç‡ã€‚</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>  <span class="token comment"># å½’ä¸€åŒ–å½“å‰å›¾åƒçš„æ•°æ®å¢å¹¿çš„æµç¨‹ã€‚</span>        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># è¿™äº›é”®ä¸ img_norm_cfg ä¸€è‡´ï¼Œå› ä¸º img_norm_cfg è¢«</span>        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment"># ç”¨ä½œå‚æ•°ã€‚</span>        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span>  <span class="token comment"># å¡«å……å½“å‰å›¾åƒåˆ°æŒ‡å®šå¤§å°çš„æ•°æ®å¢å¹¿çš„æµç¨‹ã€‚</span>        size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å¡«å……å›¾åƒå¯ä»¥è¢«å½“å‰å€¼æ•´é™¤ã€‚</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æµç¨‹é‡Œæ”¶é›†æ•°æ®çš„é»˜è®¤æ ¼å¼æ†ã€‚</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span>  <span class="token comment"># å†³å®šæ•°æ®ä¸­å“ªäº›é”®åº”è¯¥ä¼ é€’ç»™æ£€æµ‹å™¨çš„æµç¨‹</span>        keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'gt_bboxes'</span><span class="token punctuation">,</span> <span class="token string">'gt_labels'</span><span class="token punctuation">,</span> <span class="token string">'gt_masks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>test_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># ç¬¬ 1 ä¸ªæµç¨‹ï¼Œä»æ–‡ä»¶è·¯å¾„é‡ŒåŠ è½½å›¾åƒã€‚</span>    <span class="token builtin">dict</span><span class="token punctuation">(</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>  <span class="token comment"># å°è£…æµ‹è¯•æ—¶æ•°æ®å¢å¹¿(test time augmentations)ã€‚</span>        img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># å†³å®šæµ‹è¯•æ—¶å¯æ”¹å˜å›¾åƒçš„æœ€å¤§è§„æ¨¡ã€‚ç”¨äºæ”¹å˜å›¾åƒå¤§å°çš„æµç¨‹ã€‚</span>        flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># æµ‹è¯•æ—¶æ˜¯å¦ç¿»è½¬å›¾åƒã€‚</span>        transforms<span class="token operator">=</span><span class="token punctuation">[</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span>  <span class="token comment"># ä½¿ç”¨æ”¹å˜å›¾åƒå¤§å°çš„æ•°æ®å¢å¹¿ã€‚</span>                 keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># æ˜¯å¦ä¿æŒå®½å’Œé«˜çš„æ¯”ä¾‹ï¼Œè¿™é‡Œçš„å›¾åƒæ¯”ä¾‹è®¾ç½®å°†è¦†ç›–ä¸Šé¢çš„å›¾åƒè§„æ¨¡å¤§å°çš„è®¾ç½®ã€‚</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># è€ƒè™‘åˆ° RandomFlip å·²ç»è¢«æ·»åŠ åˆ°æµç¨‹é‡Œï¼Œå½“ flip=False æ—¶å®ƒå°†ä¸è¢«ä½¿ç”¨ã€‚</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>  <span class="token comment">#  å½’ä¸€åŒ–é…ç½®é¡¹ï¼Œå€¼æ¥è‡ª img_norm_cfgã€‚</span>                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span>  <span class="token comment"># å°†é…ç½®ä¼ é€’ç»™å¯è¢« 32 æ•´é™¤çš„å›¾åƒã€‚</span>                size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span>  <span class="token comment"># å°†å›¾åƒè½¬ä¸ºå¼ é‡</span>                keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span>  <span class="token comment"># æ”¶é›†æµ‹è¯•æ—¶å¿…é¡»çš„é”®çš„æ”¶é›†æµç¨‹ã€‚</span>                keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    samples_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment"># å•ä¸ª GPU çš„ Batch size</span>    workers_per_gpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment"># å•ä¸ª GPU åˆ†é…çš„æ•°æ®åŠ è½½çº¿ç¨‹æ•°</span>    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># è®­ç»ƒæ•°æ®é›†é…ç½®</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®é›†çš„ç±»åˆ«, æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/datasets/coco.py#L19ã€‚</span>        ann_file<span class="token operator">=</span><span class="token string">'data/coco/annotations/instances_train2017.json'</span><span class="token punctuation">,</span>  <span class="token comment"># æ³¨é‡Šæ–‡ä»¶è·¯å¾„</span>        img_prefix<span class="token operator">=</span><span class="token string">'data/coco/train2017/'</span><span class="token punctuation">,</span>  <span class="token comment"># å›¾ç‰‡è·¯å¾„å‰ç¼€</span>        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token comment"># æµç¨‹, è¿™æ˜¯ç”±ä¹‹å‰åˆ›å»ºçš„ train_pipeline ä¼ é€’çš„ã€‚</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadAnnotations'</span><span class="token punctuation">,</span>                with_bbox<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                with_mask<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                poly2mask<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">,</span> flip_ratio<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>                mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span>                keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token string">'gt_bboxes'</span><span class="token punctuation">,</span> <span class="token string">'gt_labels'</span><span class="token punctuation">,</span> <span class="token string">'gt_masks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># éªŒè¯æ•°æ®é›†çš„é…ç½®</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'data/coco/annotations/instances_val2017.json'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'data/coco/val2017/'</span><span class="token punctuation">,</span>        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token comment"># ç”±ä¹‹å‰åˆ›å»ºçš„ test_pipeline ä¼ é€’çš„æµç¨‹ã€‚</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                transforms<span class="token operator">=</span><span class="token punctuation">[</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span>                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># æµ‹è¯•æ•°æ®é›†é…ç½®ï¼Œä¿®æ”¹æµ‹è¯•å¼€å‘/æµ‹è¯•(test-dev/test)æäº¤çš„ ann_file</span>        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'CocoDataset'</span><span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'data/coco/annotations/instances_val2017.json'</span><span class="token punctuation">,</span>        img_prefix<span class="token operator">=</span><span class="token string">'data/coco/val2017/'</span><span class="token punctuation">,</span>        pipeline<span class="token operator">=</span><span class="token punctuation">[</span>  <span class="token comment"># ç”±ä¹‹å‰åˆ›å»ºçš„ test_pipeline ä¼ é€’çš„æµç¨‹ã€‚</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token builtin">dict</span><span class="token punctuation">(</span>                <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span><span class="token punctuation">,</span>                img_scale<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                flip<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>                transforms<span class="token operator">=</span><span class="token punctuation">[</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Resize'</span><span class="token punctuation">,</span> keep_ratio<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span>                        <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Normalize'</span><span class="token punctuation">,</span>                        mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span><span class="token punctuation">,</span> <span class="token number">116.28</span><span class="token punctuation">,</span> <span class="token number">103.53</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                        std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span><span class="token punctuation">,</span> <span class="token number">57.12</span><span class="token punctuation">,</span> <span class="token number">57.375</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                        to_rgb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Pad'</span><span class="token punctuation">,</span> size_divisor<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'ImageToTensor'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'Collect'</span><span class="token punctuation">,</span> keys<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        samples_per_gpu<span class="token operator">=</span><span class="token number">2</span>  <span class="token comment"># å•ä¸ª GPU æµ‹è¯•æ—¶çš„ Batch size</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span>evaluation <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># evaluation hook çš„é…ç½®ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/core/evaluation/eval_hooks.py#L7ã€‚</span>    interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># éªŒè¯çš„é—´éš”ã€‚</span>    metric<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'bbox'</span><span class="token punctuation">,</span> <span class="token string">'segm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># éªŒè¯æœŸé—´ä½¿ç”¨çš„æŒ‡æ ‡ã€‚</span>optimizer <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># ç”¨äºæ„å»ºä¼˜åŒ–å™¨çš„é…ç½®æ–‡ä»¶ã€‚æ”¯æŒ PyTorch ä¸­çš„æ‰€æœ‰ä¼˜åŒ–å™¨ï¼ŒåŒæ—¶å®ƒä»¬çš„å‚æ•°ä¸ PyTorch é‡Œçš„ä¼˜åŒ–å™¨å‚æ•°ä¸€è‡´ã€‚</span>    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'SGD'</span><span class="token punctuation">,</span>  <span class="token comment"># ä¼˜åŒ–å™¨ç§ç±»ï¼Œæ›´å¤šç»†èŠ‚å¯å‚è€ƒ https://github.com/open-mmlab/mmdetection/blob/master/mmdet/core/optimizer/default_constructor.py#L13ã€‚</span>    lr<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span>  <span class="token comment"># ä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡ï¼Œå‚æ•°çš„ä½¿ç”¨ç»†èŠ‚è¯·å‚ç…§å¯¹åº”çš„ PyTorch æ–‡æ¡£ã€‚</span>    momentum<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span>  <span class="token comment"># åŠ¨é‡(Momentum)</span>    weight_decay<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>  <span class="token comment"># SGD çš„è¡°å‡æƒé‡(weight decay)ã€‚</span>optimizer_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># optimizer hook çš„é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œç»†èŠ‚è¯·å‚è€ƒ https://github.com/open-mmlab/mmcv/blob/master/mmcv/runner/hooks/optimizer.py#L8ã€‚</span>    grad_clip<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># å¤§å¤šæ•°æ–¹æ³•ä¸ä½¿ç”¨æ¢¯åº¦é™åˆ¶(grad_clip)ã€‚</span>lr_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># å­¦ä¹ ç‡è°ƒæ•´é…ç½®ï¼Œç”¨äºæ³¨å†Œ LrUpdater hookã€‚</span>    policy<span class="token operator">=</span><span class="token string">'step'</span><span class="token punctuation">,</span>  <span class="token comment"># è°ƒåº¦æµç¨‹(scheduler)çš„ç­–ç•¥ï¼Œä¹Ÿæ”¯æŒ CosineAnnealing, Cyclic, ç­‰ã€‚è¯·ä» https://github.com/open-mmlab/mmcv/blob/master/mmcv/runner/hooks/lr_updater.py#L9 å‚è€ƒ LrUpdater çš„ç»†èŠ‚ã€‚</span>    warmup<span class="token operator">=</span><span class="token string">'linear'</span><span class="token punctuation">,</span>  <span class="token comment"># é¢„çƒ­(warmup)ç­–ç•¥ï¼Œä¹Ÿæ”¯æŒ `exp` å’Œ `constant`ã€‚</span>    warmup_iters<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span>  <span class="token comment"># é¢„çƒ­çš„è¿­ä»£æ¬¡æ•°</span>    warmup_ratio<span class="token operator">=</span>    <span class="token number">0.001</span><span class="token punctuation">,</span>  <span class="token comment"># ç”¨äºçƒ­èº«çš„èµ·å§‹å­¦ä¹ ç‡çš„æ¯”ç‡</span>    step<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># è¡°å‡å­¦ä¹ ç‡çš„èµ·æ­¢å›åˆæ•°</span>runner <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'EpochBasedRunner'</span><span class="token punctuation">,</span>  <span class="token comment"># å°†ä½¿ç”¨çš„ runner çš„ç±»åˆ« (ä¾‹å¦‚ IterBasedRunner æˆ– EpochBasedRunner)ã€‚</span>    max_epochs<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment"># runner æ€»å›åˆæ•°ï¼Œ å¯¹äº IterBasedRunner ä½¿ç”¨ `max_iters`</span>checkpoint_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># Checkpoint hook çš„é…ç½®æ–‡ä»¶ã€‚æ‰§è¡Œæ—¶è¯·å‚è€ƒ https://github.com/open-mmlab/mmcv/blob/master/mmcv/runner/hooks/checkpoint.pyã€‚</span>    interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># ä¿å­˜çš„é—´éš”æ˜¯ 1ã€‚</span>log_config <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>  <span class="token comment"># register logger hook çš„é…ç½®æ–‡ä»¶ã€‚</span>    interval<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>  <span class="token comment"># æ‰“å°æ—¥å¿—çš„é—´éš”</span>    hooks<span class="token operator">=</span><span class="token punctuation">[</span>        <span class="token comment"># dict(type='TensorboardLoggerHook')  # åŒæ ·æ”¯æŒ Tensorboard æ—¥å¿—</span>        <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'TextLoggerHook'</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># ç”¨äºè®°å½•è®­ç»ƒè¿‡ç¨‹çš„è®°å½•å™¨(logger)ã€‚</span>dist_params <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">'nccl'</span><span class="token punctuation">)</span>  <span class="token comment"># ç”¨äºè®¾ç½®åˆ†å¸ƒå¼è®­ç»ƒçš„å‚æ•°ï¼Œç«¯å£ä¹ŸåŒæ ·å¯è¢«è®¾ç½®ã€‚</span>log_level <span class="token operator">=</span> <span class="token string">'INFO'</span>  <span class="token comment"># æ—¥å¿—çš„çº§åˆ«ã€‚</span>load_from <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># ä»ä¸€ä¸ªç»™å®šè·¯å¾„é‡ŒåŠ è½½æ¨¡å‹ä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹ï¼Œå®ƒå¹¶ä¸ä¼šæ¶ˆè€—è®­ç»ƒæ—¶é—´ã€‚</span>resume_from <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># ä»ç»™å®šè·¯å¾„é‡Œæ¢å¤æ£€æŸ¥ç‚¹(checkpoints)ï¼Œè®­ç»ƒæ¨¡å¼å°†ä»æ£€æŸ¥ç‚¹ä¿å­˜çš„è½®æ¬¡å¼€å§‹æ¢å¤è®­ç»ƒã€‚</span>workflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># runner çš„å·¥ä½œæµç¨‹ï¼Œ[('train', 1)] è¡¨ç¤ºåªæœ‰ä¸€ä¸ªå·¥ä½œæµä¸”å·¥ä½œæµä»…æ‰§è¡Œä¸€æ¬¡ã€‚æ ¹æ® total_epochs å·¥ä½œæµè®­ç»ƒ 12ä¸ªå›åˆã€‚</span>work_dir <span class="token operator">=</span> <span class="token string">'work_dir'</span>  <span class="token comment"># ç”¨äºä¿å­˜å½“å‰å®éªŒçš„æ¨¡å‹æ£€æŸ¥ç‚¹å’Œæ—¥å¿—çš„ç›®å½•æ–‡ä»¶åœ°å€ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ol><li>å­¦ä¹  mmdetection å·¥å…·ç®±</li><li>å®ç°ä¸€ä¸ªé¡¹ç›®</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MMLab </tag>
            
            <tag> MMDetection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FFMPEG note</title>
      <link href="/archives/97736837.html"/>
      <url>/archives/97736837.html</url>
      
        <content type="html"><![CDATA[<h1 id="FFMPEG"><a href="#FFMPEG" class="headerlink" title="FFMPEG"></a>FFMPEG</h1><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><h3 id="01-ä¸‹è½½ï¼Œé…ç½®"><a href="#01-ä¸‹è½½ï¼Œé…ç½®" class="headerlink" title="01.ä¸‹è½½ï¼Œé…ç½®"></a>01.ä¸‹è½½ï¼Œé…ç½®</h3><p>ç”¨çš„ç³»ç»Ÿæ˜¯ Ubuntu å¯ä»¥ç›´æ¥ apt-get</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ffmpeg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>windows å¯ä»¥å»å®˜ç½‘ä¸‹è½½ <a href="https://www.gyan.dev/ffmpeg/builds/">windows build</a></p><h3 id="02-ç®€ä»‹ï¼Œä¸Šæ‰‹-FFmpeg-FFprobe-FFplay"><a href="#02-ç®€ä»‹ï¼Œä¸Šæ‰‹-FFmpeg-FFprobe-FFplay" class="headerlink" title="02.ç®€ä»‹ï¼Œä¸Šæ‰‹(FFmpeg FFprobe FFplay)"></a>02.ç®€ä»‹ï¼Œä¸Šæ‰‹(FFmpeg FFprobe FFplay)</h3><p>(1) æŸ¥çœ‹ ffmpeg çš„å¸®åŠ©è¯´æ˜ï¼Œæä¾›çš„æŒ‡ä»¤ã€‚å»ºè®®å°†å…¶ä¸­çš„å‘½ä»¤å¤§è‡´çœ‹çœ‹ï¼Œåœ¨æœ¬ç¬”è®°æœ€åé™„æœ‰è¯¥å¸®åŠ©è¯´æ˜</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -h<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(2) æ’­æ”¾åª’ä½“çš„æŒ‡ä»¤</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffplay video.mp4ffplay music.mp3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>(3) å¸¸ç”¨å¿«æ·é”®</p><p>æŒ‰é”®â€Qâ€æˆ–â€Escâ€ï¼šé€€å‡ºåª’ä½“æ’­æ”¾<br>é”®ç›˜æ–¹å‘é”®ï¼šåª’ä½“æ’­æ”¾çš„å‰è¿›åé€€<br>ç‚¹å‡»é¼ æ ‡å³é”®ï¼šæ‹–åŠ¨åˆ°è¯¥æ’­æ”¾ä½ç½®<br>æŒ‰é”®â€Fâ€ï¼šå…¨å±<br>æŒ‰é”®â€Pâ€æˆ–ç©ºæ ¼é”®ï¼šæš‚åœ<br>æŒ‰é”®â€Wâ€:åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼</p><p>(4) æŸ¥çœ‹åª’ä½“å‚æ•°ä¿¡æ¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffprobe video.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¾“å‡ºå½¢å¦‚ä¸‹é¢çš„å†…å®¹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Stream <span class="token comment">#0:0[0x1](und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, bt709), 1440x720, 163 kb/s, 30 fps, 30 tbr, 16k tbn (default)</span>    Metadata:      handler_name    <span class="token builtin class-name">:</span> VideoHandler      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>Stream <span class="token comment">#0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 128 kb/s (default)</span>    Metadata:      handler_name    <span class="token builtin class-name">:</span> SoundHandler      vendor_id       <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°è§†é¢‘ä¸º h264 ç¼–ç ï¼Œåˆ†è¾¨ç‡ 1440x720ã€æ¯”ç‰¹ç‡(ç ç‡) 163 kb/sã€å¸§ç‡ 30 fpsã€‚éŸ³é¢‘ä¸º acc ç¼–ç ï¼ŒéŸ³é¢‘é‡‡æ ·ç‡ 44100 Hzï¼Œæ¯”ç‰¹ç‡ 128 kb/s</p><h3 id="03-è½¬æ¢æ ¼å¼-æ–‡ä»¶æ ¼å¼-å°è£…æ ¼å¼"><a href="#03-è½¬æ¢æ ¼å¼-æ–‡ä»¶æ ¼å¼-å°è£…æ ¼å¼" class="headerlink" title="03.è½¬æ¢æ ¼å¼(æ–‡ä»¶æ ¼å¼,å°è£…æ ¼å¼)"></a>03.è½¬æ¢æ ¼å¼(æ–‡ä»¶æ ¼å¼,å°è£…æ ¼å¼)</h3><p>(1) æ–‡ä»¶åå¯ä»¥æ˜¯ä¸­è‹±æ–‡ï¼Œä½†ä¸èƒ½æœ‰ç©ºæ ¼</p><p>(2) <strong>è½¬æ¢æ ¼å¼</strong></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i video.mp4 video_avi.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ffmpeg ä½¿ç”¨ -i å‚æ•°æ¥è¡¨ç¤ºè¾“å…¥æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨ -f å‚æ•°æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼Œä½†ä¸ºäº†çœäº‹å„¿å¥½åƒä¹Ÿå¯ä»¥ä¸ç”¨æŒ‡å®šï¼Œffmpeg ä¼šæ ¹æ®è¾“å‡ºæ–‡ä»¶åçš„åç¼€è‡ªåŠ¨è¯†åˆ«</p><h3 id="04-æå–éŸ³è§†é¢‘"><a href="#04-æå–éŸ³è§†é¢‘" class="headerlink" title="04.æå–éŸ³è§†é¢‘"></a>04.æå–éŸ³è§†é¢‘</h3><p>(1) å•ç‹¬æå–è§†é¢‘ï¼ˆä¸å«éŸ³é¢‘æµï¼‰</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i video.mp4 -vcodec copy -an video_silent.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(2) å•ç‹¬æå–éŸ³é¢‘ï¼ˆä¸å«è§†é¢‘æµï¼‰</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i video.mp4 -vn -acodec copy video_novideo.m4a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…·å¤‡å¤šä¸ªéŸ³é¢‘æµçš„ï¼Œå¦‚</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Stream <span class="token comment">#0:2[0x81]:Audio:ac3,48000Hz,5.1,s16,384kb/s</span>Stream <span class="token comment">#0:3[0x82]:Audio:ac3,48000Hz,5.1,s16,384kb/s</span>Stream <span class="token comment">#0:4[0x80]:Audio:ac3,48000Hz,5.1,s16,448kb/s</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é’ˆå¯¹æ€§çš„å•ä¸€çš„æå–ï¼Œä¾‹å¦‚æå–ç¬¬2æ¡ï¼Œç”¨æŒ‡ä»¤ï¼š -map 0:3</p><p>(3) åˆå¹¶éŸ³è§†é¢‘</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i video_novideo.m4a -i video_silent.mp4 -c copy video_merge.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>-c ä¸º -codec çš„ç¼©å†™ï¼Œä¼ å…¥å‚æ•° copy å³ä½¿ç”¨åŸè§†é¢‘/éŸ³é¢‘ç¼–ç å™¨ï¼Œè¿™æ ·ä¼šå¤§å¤§åŠ å¿«å¤„ç†æ—¶é—´è€Œä¸ç”¨é‡æ–°è½¬ç ã€‚ä¸€èˆ¬åœ¨ codec å‰/åæœ‰ a/v å³ä»£è¡¨éŸ³é¢‘/è§†é¢‘</p><h3 id="05-æˆªå–ï¼Œè¿æ¥éŸ³è§†é¢‘"><a href="#05-æˆªå–ï¼Œè¿æ¥éŸ³è§†é¢‘" class="headerlink" title="05.æˆªå–ï¼Œè¿æ¥éŸ³è§†é¢‘"></a>05.æˆªå–ï¼Œè¿æ¥éŸ³è§†é¢‘</h3><p>(1) æˆªå–</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i music.mp3 -ss 00:00:30 -to 00:02:00 -acodec copy music_cutout.mp3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¾“å…¥æ—¶é—´å¯ä»¥æ˜¯å¦‚ä¸Šçš„ <code>æ—¶:åˆ†:ç§’</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯ <code>åˆ†:ç§’</code>ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¾“å…¥å¤šå°‘ç§’ï¼Œç§’å¯ä»¥æ˜¯æµ®ç‚¹æ•°ã€‚è¿˜å¯ä»¥æˆªå–æŒ‡å®šé•¿åº¦çš„éŸ³è§†é¢‘ï¼Œå¦‚æˆªå–60ç§’</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i music.mp3 -ss 00:00:30 -t <span class="token number">60</span> -acodec copy music_cutout60s.mp3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>-sseof time_offset: å¼€å§‹æ—¶é—´ä»åª’ä½“æœ«å°¾å¼€å§‹è®¡ç®—ï¼Œä¼ å…¥å‚æ•°ä¸ºå¤æ•°</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i in.mp4 -ss 00:01:00 -to 00:01:10 -c copy out.mp4ffmpeg -ss 00:01:00 -i in.mp4 -to 00:01:10 -c copy out.mp4ffmpeg -ss 00:01:00 -i in.mp4 -to 00:01:10 -c copy -copyts out.mp4<span class="token comment"># ä»æœ«å°¾å¾€å‰ 10s æˆªå– 5s</span>ffmpeg -sseof -10 -t <span class="token number">5</span> -i in.mp4 -c copy out.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŠŠ-ssæ”¾åˆ°-iä¹‹å‰ï¼Œå¯ç”¨äº†å…³é”®å¸§æŠ€æœ¯ï¼ŒåŠ é€Ÿæ“ä½œã€‚ä½†æˆªå–çš„æ—¶é—´æ®µä¸ä¸€å®šå‡†ç¡®ã€‚å¯ç”¨æœ€åä¸€æ¡æŒ‡ä»¤ï¼Œä¿ç•™æ—¶é—´æˆ³ï¼Œä¿è¯æ—¶é—´å‡†ç¡®ã€‚</p><p>(2) è¿æ¥éŸ³è§†é¢‘</p><p>æˆ‘æ¨èä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•</p><ol><li><p>æ–°å»ºä¸€ä¸ª list.txt æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†éœ€è¦è¿æ¥çš„éŸ³è§†é¢‘ã€‚æ ¼å¼å¦‚ä¸‹</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">file '/path/to/file1'file '/path/to/file2'file '/path/to/file3'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>å¯ä»¥ä½¿ç”¨ -f concatï¼Œæ¥åˆå¹¶éŸ³è§†é¢‘</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -f concat -i mylist.txt -c copy output.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><p>å¯¹äºç²¾ç»†çš„éŸ³è§†é¢‘è¿æ¥å¹¶ä¸æ¨èä½¿ç”¨ ffmeg</p><h3 id="06-å›¾ç‰‡è§†é¢‘è½¬æ¢ï¼Œæ°´å°ï¼Œgif"><a href="#06-å›¾ç‰‡è§†é¢‘è½¬æ¢ï¼Œæ°´å°ï¼Œgif" class="headerlink" title="06.å›¾ç‰‡è§†é¢‘è½¬æ¢ï¼Œæ°´å°ï¼Œgif"></a>06.å›¾ç‰‡è§†é¢‘è½¬æ¢ï¼Œæ°´å°ï¼Œgif</h3><p><strong>(1) å›¾ç‰‡è§†é¢‘è½¬æ¢</strong></p><p>æˆªå–ç¬¬7ç§’ç¬¬1å¸§çš„ç”»é¢</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i video.mp4 -ss <span class="token number">7</span> -vframes <span class="token number">1</span> video_image.jpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è§†é¢‘åˆ†ç¦»æˆå›¾ç‰‡</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i input_test.mp4 -r <span class="token number">1</span> -f image2 output_image-%03d.png<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å›¾ç‰‡ä¹Ÿèƒ½åˆæˆä¸ºè§†é¢‘</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -f image2 -r <span class="token number">15</span> -i output_image-%03d.png output_test.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œçš„ <code>-r</code> ä»£è¡¨ rate å¯ä»¥ç†è§£ä¸ºå¸§ç‡ã€‚<code>output_image-%03d.png</code> æ˜¯å›¾ç‰‡çš„å‘½åæ ¼å¼ï¼Œè¿™ç§å½¢å¼åœ¨ python æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­ç»å¸¸çœ‹åˆ°</p><p>æ³¨æ„ï¼Œè¿™é‡Œé€‰æ‹© png æ ¼å¼è€Œä¸æ˜¯ jpg æ ¼å¼æ˜¯å› ä¸º png ä¸ºæ— æŸå‹ç¼©å›¾ï¼Œè¿™æ ·åœ¨è§†é¢‘å’Œå›¾ç‰‡çš„è½¬æ¢å½“ä¸­ï¼Œå°±ä¸ä¼šæœ‰æŸå¤±</p><p>(2) æ°´å°</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i video.mp4 -i qt.png -filter_complex <span class="token string">"overlay=20:80"</span> video_watermark.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(3) æˆªå–åŠ¨å›¾</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i video.mp4 -ss <span class="token number">7.5</span> -to <span class="token number">8.5</span> -s 640x320 -r <span class="token number">15</span> video_gif.gif<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="è¡¥å……ï¼šè§†é¢‘ç¼–ç "><a href="#è¡¥å……ï¼šè§†é¢‘ç¼–ç " class="headerlink" title="è¡¥å……ï¼šè§†é¢‘ç¼–ç "></a>è¡¥å……ï¼šè§†é¢‘ç¼–ç </h2><h3 id="01-æ”¹å˜ç¼–ç -ä¸Š-ç¼–ç -éŸ³é¢‘è½¬ç "><a href="#01-æ”¹å˜ç¼–ç -ä¸Š-ç¼–ç -éŸ³é¢‘è½¬ç " class="headerlink" title="01.æ”¹å˜ç¼–ç  ä¸Š(ç¼–ç ,éŸ³é¢‘è½¬ç )"></a>01.æ”¹å˜ç¼–ç  ä¸Š(ç¼–ç ,éŸ³é¢‘è½¬ç )</h3><p>(1)æŸ¥çœ‹ç¼–è§£ç å™¨</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -codecs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(2)<strong>ç½‘ç«™å¸¸ç”¨ç¼–ç </strong></p><p>MP4å°è£…ï¼šH264è§†é¢‘ç¼–ç +ACCéŸ³é¢‘ç¼–ç <br>WebMå°è£…ï¼šVP8è§†é¢‘ç¼–ç +VorbiséŸ³é¢‘ç¼–ç <br>OGGå°è£…ï¼šTheoraè§†é¢‘ç¼–ç +VorbiséŸ³é¢‘ç¼–ç </p><p>(3)<strong>æ— æŸç¼–ç æ ¼å¼.flacè½¬æ¢ç¼–ç </strong></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i music_flac.flac -acodec libmp3lame -ar <span class="token number">44100</span> -ab 320k -ac <span class="token number">2</span> music_flac_mp3.mp3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¯´æ˜ï¼š</strong></p><ul><li>acodec:audio Coder Decoder éŸ³é¢‘ç¼–ç è§£ç å™¨</li><li>libmp3lame:mp3è§£ç å™¨</li><li>ar:audio rateï¼šéŸ³é¢‘é‡‡æ ·ç‡</li><li><strong>44100:è®¾ç½®éŸ³é¢‘çš„é‡‡æ ·ç‡44100ã€‚è‹¥ä¸è¾“å…¥ï¼Œé»˜è®¤ç”¨åŸéŸ³é¢‘çš„é‡‡æ ·ç‡</strong></li><li>ab:audio bit rate éŸ³é¢‘æ¯”ç‰¹ç‡</li><li><strong>320kï¼šè®¾ç½®éŸ³é¢‘çš„æ¯”ç‰¹ç‡ã€‚è‹¥ä¸è¾“å…¥ï¼Œé»˜è®¤128K</strong></li><li>ac: aduio channels éŸ³é¢‘å£°é“</li><li>2:å£°é“æ•°ã€‚è‹¥ä¸è¾“å…¥ï¼Œé»˜è®¤é‡‡ç”¨æºéŸ³é¢‘çš„å£°é“æ•°</li></ul><p>æ¦‚æ‹¬ï¼šè®¾ç½®æ ¼å¼çš„åŸºæœ¬å¥—è·¯-å…ˆæ˜¯æŒ‡åå±æ€§ï¼Œç„¶åè·Ÿç€æ–°çš„å±æ€§å€¼</p><p>(4)æŸ¥çœ‹ç»“æœå±æ€§</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffprobe music_flac_mp3.mp3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="02-æ”¹å˜ç¼–ç -ä¸­-è§†é¢‘å‹åˆ¶"><a href="#02-æ”¹å˜ç¼–ç -ä¸­-è§†é¢‘å‹åˆ¶" class="headerlink" title="02.æ”¹å˜ç¼–ç  ä¸­(è§†é¢‘å‹åˆ¶)"></a>02.æ”¹å˜ç¼–ç  ä¸­(è§†é¢‘å‹åˆ¶)</h3><p>(1)è§†é¢‘è½¬ç </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i video.mp4 -s 1920x1080 -pix_fmt yuv420p -vcodec libx264 -preset medium -profile:v high -level:v <span class="token number">4.1</span> -crf <span class="token number">23</span> -acodec aac -ar <span class="token number">44100</span> -ac <span class="token number">2</span> -b:a 128k video_avi.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>è¯´æ˜:</strong></p><ul><li><strong>-s 1920x1080ï¼šç¼©æ”¾è§†é¢‘æ–°å°ºå¯¸(size)</strong></li><li>-pix_fmt yuv420pï¼špixel format,ç”¨æ¥è®¾ç½®è§†é¢‘é¢œè‰²ç©ºé—´ã€‚å‚æ•°æŸ¥è¯¢ï¼šffmpeg -pix_fmts</li><li>-vcodec libx264ï¼švideo Coder Decoderï¼Œè§†é¢‘ç¼–ç è§£ç å™¨</li><li>-preset medium: ç¼–ç å™¨é¢„è®¾ã€‚å‚æ•°ï¼šultrafast,superfast,veryfast,faster,fast,medium,slow,slower,veryslow,placebo</li><li>-profile:v high :ç¼–ç å™¨é…ç½®ï¼Œä¸å‹ç¼©æ¯”æœ‰å…³ã€‚å®æ—¶é€šè®¯-baseline,æµåª’ä½“-main,è¶…æ¸…è§†é¢‘-high</li><li>-level:v 4.1 ï¼šå¯¹ç¼–ç å™¨è®¾ç½®çš„å…·ä½“è§„èŒƒå’Œé™åˆ¶ï¼Œæƒè¡¡å‹ç¼©æ¯”å’Œç”»è´¨ã€‚</li><li>-crf 23 ï¼šè®¾ç½®ç ç‡æ§åˆ¶æ¨¡å¼ã€‚constant rate factor-æ’å®šé€Ÿç‡å› å­æ¨¡å¼ã€‚èŒƒå›´0~51,é»˜è®¤23ã€‚æ•°å€¼è¶Šå°ï¼Œç”»è´¨è¶Šé«˜ã€‚ä¸€èˆ¬åœ¨8~28åšå‡ºé€‰æ‹©ã€‚</li><li><strong>-r 30 :è®¾ç½®è§†é¢‘å¸§ç‡</strong></li><li>-acodec aac :audio Coder Decoder-éŸ³é¢‘ç¼–ç è§£ç å™¨</li><li>-b:a 128k :éŸ³é¢‘æ¯”ç‰¹ç‡.å¤§å¤šæ•°ç½‘ç«™é™åˆ¶éŸ³é¢‘æ¯”ç‰¹ç‡128k,129k<br>å…¶ä»–å‚è€ƒä¸Šä¸€ä¸ªæ•™ç¨‹</li></ul><h3 id="03-æ”¹å˜ç¼–ç -ä¸‹-ç ç‡æ§åˆ¶æ¨¡å¼"><a href="#03-æ”¹å˜ç¼–ç -ä¸‹-ç ç‡æ§åˆ¶æ¨¡å¼" class="headerlink" title="03.æ”¹å˜ç¼–ç  ä¸‹(ç ç‡æ§åˆ¶æ¨¡å¼)"></a>03.æ”¹å˜ç¼–ç  ä¸‹(ç ç‡æ§åˆ¶æ¨¡å¼)</h3><p>ffmpegæ”¯æŒçš„ç ç‡æ§åˆ¶æ¨¡å¼ï¼š-qp -crf -b</p><p>(1)  -qp :constant quantizer,æ’å®šé‡åŒ–å™¨æ¨¡å¼ </p><p>æ— æŸå‹ç¼©çš„ä¾‹å­ï¼ˆå¿«é€Ÿç¼–ç ï¼‰</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i input -vcodec libx264 -preset ultrafast -qp <span class="token number">0</span> output.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ— æŸå‹ç¼©çš„ä¾‹å­ï¼ˆé«˜å‹ç¼©æ¯”ï¼‰</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i input -vcodec libx264 -preset veryslow -qp <span class="token number">0</span> output.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(2) -crf :constant rate factor,æ’å®šé€Ÿç‡å› å­æ¨¡å¼</p><p>(3) -b ï¼šbitrate,å›ºå®šç›®æ ‡ç ç‡æ¨¡å¼ã€‚ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨</p><p>3ç§æ¨¡å¼é»˜è®¤å•éç¼–ç </p><p>VBR(Variable Bit Rate/åŠ¨æ€æ¯”ç‰¹ç‡) ä¾‹å­</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i input -vcodec libx264 -preset veryslow output<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ABR(Average Bit Rate/å¹³å‡æ¯”ç‰¹ç‡) ä¾‹å­</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg -i input -vcodec libx264 -preset veryslow -b:v 3000k output<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>CBR(Constant Bit Rate/æ’å®šæ¯”ç‰¹ç‡) ä¾‹å­</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">..</span>. -b:v 4000k -minrate 4000k -maxrate 4000k -bufsize 1835k <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p>ç¬”è®°æ¥æºï¼š<a href="https://www.bilibili.com/video/av40146374">https://www.bilibili.com/video/av40146374</a></p><p>å®˜æ–¹æ•™ç¨‹ï¼š <a href="http://ffmpeg.org/ffmpeg-all.html">http://ffmpeg.org/ffmpeg-all.html</a></p><p>åšå®¢ï¼š<a href="https://www.jianshu.com/p/f07f0be088d0">https://www.jianshu.com/p/f07f0be088d0</a></p><h2 id="å¸®åŠ©æ–‡æ¡£ï¼Œç”¨äºæŸ¥è¯¢"><a href="#å¸®åŠ©æ–‡æ¡£ï¼Œç”¨äºæŸ¥è¯¢" class="headerlink" title="å¸®åŠ©æ–‡æ¡£ï¼Œç”¨äºæŸ¥è¯¢"></a>å¸®åŠ©æ–‡æ¡£ï¼Œç”¨äºæŸ¥è¯¢</h2><p>ä¸‹é¢æ˜¯ ffmpeg çš„å¸®åŠ©æ–‡æ¡£ï¼Œç”¨äºæŸ¥è¯¢</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ffmpeg version <span class="token number">2021</span>-09-08-git-5e7e2e5031-full_build-www.gyan.dev Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>-2021 the FFmpeg developers  built with gcc <span class="token number">10.3</span>.0 <span class="token punctuation">(</span>Rev5, Built by MSYS2 project<span class="token punctuation">)</span>  configuration: --enable-gpl --enable-version3 --enable-static --disable-w32threads --disable-autodetect --enable-fontconfig --enable-iconv --enable-gnutls --enable-libxml2 --enable-gmp --enable-lzma --enable-libsnappy --enable-zlib --enable-librist --enable-libsrt --enable-libssh --enable-libzmq --enable-avisynth --enable-libbluray --enable-libcaca --enable-sdl2 --enable-libdav1d --enable-libzvbi --enable-librav1e --enable-libsvtav1 --enable-libwebp --enable-libx264 --enable-libx265 --enable-libxvid --enable-libaom --enable-libopenjpeg --enable-libvpx --enable-libass --enable-frei0r --enable-libfreetype --enable-libfribidi --enable-libvidstab --enable-libvmaf --enable-libzimg --enable-amf --enable-cuda-llvm --enable-cuvid --enable-ffnvcodec --enable-nvdec --enable-nvenc --enable-d3d11va --enable-dxva2 --enable-libmfx --enable-libglslang --enable-vulkan --enable-opencl --enable-libcdio --enable-libgme --enable-libmodplug --enable-libopenmpt --enable-libopencore-amrwb --enable-libmp3lame --enable-libshine --enable-libtheora --enable-libtwolame --enable-libvo-amrwbenc --enable-libilbc --enable-libgsm --enable-libopencore-amrnb --enable-libopus --enable-libspeex --enable-libvorbis --enable-ladspa --enable-libbs2b --enable-libflite --enable-libmysofa --enable-librubberband --enable-libsoxr --enable-chromaprint  libavutil      <span class="token number">57</span>.  <span class="token number">4.101</span> / <span class="token number">57</span>.  <span class="token number">4.101</span>  libavcodec     <span class="token number">59</span>.  <span class="token number">7.102</span> / <span class="token number">59</span>.  <span class="token number">7.102</span>  libavformat    <span class="token number">59</span>.  <span class="token number">5.100</span> / <span class="token number">59</span>.  <span class="token number">5.100</span>  libavdevice    <span class="token number">59</span>.  <span class="token number">0.101</span> / <span class="token number">59</span>.  <span class="token number">0.101</span>  libavfilter     <span class="token number">8</span>.  <span class="token number">7.101</span> /  <span class="token number">8</span>.  <span class="token number">7.101</span>  libswscale      <span class="token number">6</span>.  <span class="token number">1.100</span> /  <span class="token number">6</span>.  <span class="token number">1.100</span>  libswresample   <span class="token number">4</span>.  <span class="token number">0.100</span> /  <span class="token number">4</span>.  <span class="token number">0.100</span>  libpostproc    <span class="token number">56</span>.  <span class="token number">0.100</span> / <span class="token number">56</span>.  <span class="token number">0.100</span>Hyper fast Audio and Video encoderusage: ffmpeg <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>infile options<span class="token punctuation">]</span> -i infile<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token punctuation">{</span><span class="token punctuation">[</span>outfile options<span class="token punctuation">]</span> outfile<span class="token punctuation">}</span><span class="token punctuation">..</span>.Getting help:    -h      -- print basic options    -h long -- print <span class="token function">more</span> options    -h full -- print all options <span class="token punctuation">(</span>including all <span class="token function">format</span> and codec specific options, very long<span class="token punctuation">)</span>    -h <span class="token assign-left variable">type</span><span class="token operator">=</span>name -- print all options <span class="token keyword">for</span> the named decoder/encoder/demuxer/muxer/filter/bsf/protocol    See <span class="token function">man</span> ffmpeg <span class="token keyword">for</span> detailed description of the options.Print <span class="token builtin class-name">help</span> / information / capabilities:-L                  show license-h topic            show <span class="token builtin class-name">help</span>-? topic            show <span class="token builtin class-name">help</span>-help topic         show <span class="token builtin class-name">help</span>--help topic        show <span class="token builtin class-name">help</span>-version            show version-buildconf          show build configuration-formats            show available formats-muxers             show available muxers-demuxers           show available demuxers-devices            show available devices-codecs             show available codecs-decoders           show available decoders-encoders           show available encoders-bsfs               show available bit stream filters-protocols          show available protocols-filters            show available filters-pix_fmts           show available pixel formats-layouts            show standard channel layouts-sample_fmts        show available audio sample formats-colors             show available color names-sources device     list sources of the input device-sinks device       list sinks of the output device-hwaccels           show available HW acceleration methodsGlobal options <span class="token punctuation">(</span>affect whole program instead of just one <span class="token function">file</span><span class="token punctuation">)</span>:-loglevel loglevel  <span class="token builtin class-name">set</span> logging level-v loglevel         <span class="token builtin class-name">set</span> logging level-report             generate a report-max_alloc bytes    <span class="token builtin class-name">set</span> maximum size of a single allocated block-y                  overwrite output files-n                  never overwrite output files-ignore_unknown     Ignore unknown stream types-filter_threads     number of non-complex filter threads-filter_complex_threads  number of threads <span class="token keyword">for</span> -filter_complex-stats              print progress report during encoding-max_error_rate maximum error rate  ratio of decoding errors <span class="token punctuation">(</span><span class="token number">0.0</span>: no errors, <span class="token number">1.0</span>: <span class="token number">100</span>% errors<span class="token punctuation">)</span> above <span class="token function">which</span> ffmpeg returns an error instead of success.-bits_per_raw_sample number  <span class="token builtin class-name">set</span> the number of bits per raw sample-vol volume         change audio volume <span class="token punctuation">(</span><span class="token number">256</span><span class="token operator">=</span>normal<span class="token punctuation">)</span>Per-file main options:-f <span class="token function">fmt</span>              force <span class="token function">format</span>-c codec            codec name-codec codec        codec name-pre preset         preset name-map_metadata outfile<span class="token punctuation">[</span>,metadata<span class="token punctuation">]</span>:infile<span class="token punctuation">[</span>,metadata<span class="token punctuation">]</span>  <span class="token builtin class-name">set</span> metadata information of outfile from infile-t duration         record or transcode <span class="token string">"duration"</span> seconds of audio/video-to time_stop       record or transcode stop <span class="token function">time</span>-fs limit_size      <span class="token builtin class-name">set</span> the limit <span class="token function">file</span> size <span class="token keyword">in</span> bytes-ss time_off        <span class="token builtin class-name">set</span> the start <span class="token function">time</span> offset-sseof time_off     <span class="token builtin class-name">set</span> the start <span class="token function">time</span> offset relative to EOF-seek_timestamp     enable/disable seeking by timestamp with -ss-timestamp <span class="token function">time</span>     <span class="token builtin class-name">set</span> the recording timestamp <span class="token punctuation">(</span><span class="token string">'now'</span> to <span class="token builtin class-name">set</span> the current <span class="token function">time</span><span class="token punctuation">)</span>-metadata <span class="token assign-left variable">string</span><span class="token operator">=</span>string  <span class="token function">add</span> metadata-program <span class="token assign-left variable">title</span><span class="token operator">=</span>string:st<span class="token operator">=</span>number<span class="token punctuation">..</span>.  <span class="token function">add</span> program with specified streams-target <span class="token builtin class-name">type</span>        specify target <span class="token function">file</span> <span class="token builtin class-name">type</span> <span class="token punctuation">(</span><span class="token string">"vcd"</span>, <span class="token string">"svcd"</span>, <span class="token string">"dvd"</span>, <span class="token string">"dv"</span> or <span class="token string">"dv50"</span> with optional prefixes <span class="token string">"pal-"</span>, <span class="token string">"ntsc-"</span> or <span class="token string">"film-"</span><span class="token punctuation">)</span>-apad               audio pad-frames number      <span class="token builtin class-name">set</span> the number of frames to output-filter filter_graph  <span class="token builtin class-name">set</span> stream filtergraph-filter_script filename  <span class="token builtin class-name">read</span> stream filtergraph description from a <span class="token function">file</span>-reinit_filter      reinit filtergraph on input parameter changes-discard            discard-disposition        dispositionVideo options:-vframes number     <span class="token builtin class-name">set</span> the number of video frames to output-r rate             <span class="token builtin class-name">set</span> frame rate <span class="token punctuation">(</span>Hz value, fraction or abbreviation<span class="token punctuation">)</span>-fpsmax rate        <span class="token builtin class-name">set</span> max frame rate <span class="token punctuation">(</span>Hz value, fraction or abbreviation<span class="token punctuation">)</span>-s size             <span class="token builtin class-name">set</span> frame size <span class="token punctuation">(</span>WxH or abbreviation<span class="token punctuation">)</span>-aspect aspect      <span class="token builtin class-name">set</span> aspect ratio <span class="token punctuation">(</span><span class="token number">4</span>:3, <span class="token number">16</span>:9 or <span class="token number">1.3333</span>, <span class="token number">1.7777</span><span class="token punctuation">)</span>-bits_per_raw_sample number  <span class="token builtin class-name">set</span> the number of bits per raw sample-vn                 disable video-vcodec codec       force video codec <span class="token punctuation">(</span><span class="token string">'copy'</span> to copy stream<span class="token punctuation">)</span>-timecode hh:mm:ss<span class="token punctuation">[</span>:<span class="token punctuation">;</span>.<span class="token punctuation">]</span>ff  <span class="token builtin class-name">set</span> initial TimeCode value.-pass n             <span class="token keyword">select</span> the pass number <span class="token punctuation">(</span><span class="token number">1</span> to <span class="token number">3</span><span class="token punctuation">)</span>-vf filter_graph    <span class="token builtin class-name">set</span> video filters-ab bitrate         audio bitrate <span class="token punctuation">(</span>please use -b:a<span class="token punctuation">)</span>-b bitrate          video bitrate <span class="token punctuation">(</span>please use -b:v<span class="token punctuation">)</span>-dn                 disable dataAudio options:-aframes number     <span class="token builtin class-name">set</span> the number of audio frames to output-aq quality         <span class="token builtin class-name">set</span> audio quality <span class="token punctuation">(</span>codec-specific<span class="token punctuation">)</span>-ar rate            <span class="token builtin class-name">set</span> audio sampling rate <span class="token punctuation">(</span>in Hz<span class="token punctuation">)</span>-ac channels        <span class="token builtin class-name">set</span> number of audio channels-an                 disable audio-acodec codec       force audio codec <span class="token punctuation">(</span><span class="token string">'copy'</span> to copy stream<span class="token punctuation">)</span>-vol volume         change audio volume <span class="token punctuation">(</span><span class="token number">256</span><span class="token operator">=</span>normal<span class="token punctuation">)</span>-af filter_graph    <span class="token builtin class-name">set</span> audio filtersSubtitle options:-s size             <span class="token builtin class-name">set</span> frame size <span class="token punctuation">(</span>WxH or abbreviation<span class="token punctuation">)</span>-sn                 disable subtitle-scodec codec       force subtitle codec <span class="token punctuation">(</span><span class="token string">'copy'</span> to copy stream<span class="token punctuation">)</span>-stag fourcc/tag    force subtitle tag/fourcc-fix_sub_duration   fix subtitles duration-canvas_size size   <span class="token builtin class-name">set</span> canvas size <span class="token punctuation">(</span>WxH or abbreviation<span class="token punctuation">)</span>-spre preset        <span class="token builtin class-name">set</span> the subtitle options to the indicated preset<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶ </category>
          
          <category> FFMPEG </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FFMPEG </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pr note</title>
      <link href="/archives/d76b900f.html"/>
      <url>/archives/d76b900f.html</url>
      
        <content type="html"><![CDATA[<h1 id="Premiere-note"><a href="#Premiere-note" class="headerlink" title="Premiere note"></a>Premiere note</h1><p>æ•™ç¨‹èµ„æºï¼š<a href="https://www.bilibili.com/video/BV1K64y1r7pp?p=1">åŸºç¡€æ•™ç¨‹ bilibili</a> </p><h2 id="ä»ç•Œé¢å¼€å§‹"><a href="#ä»ç•Œé¢å¼€å§‹" class="headerlink" title="ä»ç•Œé¢å¼€å§‹"></a>ä»ç•Œé¢å¼€å§‹</h2><p>å…³äºç¼–ç ï¼šH.264 ç¼–ç å°±æ˜¯å¯¹åº” mp4 æ ¼å¼è§†é¢‘</p><h3 id="ç•Œé¢"><a href="#ç•Œé¢" class="headerlink" title="ç•Œé¢"></a>ç•Œé¢</h3><ol><li><strong>ç´ æç®±</strong></li><li>å·¥å…·æ </li><li><strong>åºåˆ—</strong></li><li>é¢„è§ˆçª—å£</li><li>æ•ˆæœçª—å£</li><li><strong>å‚æ•°çª—å£</strong></li><li><strong>é¢æ¿</strong>ï¼šä¸åŒçš„é¢æ¿ä¸“æ³¨å¤„ç†è§†é¢‘çš„ä¸åŒéƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼šç»„ä»¶é¢æ¿å®Œæˆçš„æ˜¯å¯¹è§†é¢‘çš„ç²—å‰ª</li></ol><h2 id="è¿‡ç¨‹ä¸­çš„å°æŠ€å·§"><a href="#è¿‡ç¨‹ä¸­çš„å°æŠ€å·§" class="headerlink" title="è¿‡ç¨‹ä¸­çš„å°æŠ€å·§"></a>è¿‡ç¨‹ä¸­çš„å°æŠ€å·§</h2><ol><li>é€šè¿‡æ•ˆæœé¢æ¿ -&gt; ç‰¹æ•ˆå‚æ•°å¯ä»¥è¿›è¡Œç¼©æ”¾ï¼Œæˆ–è€…å³é”®é€‰æ‹©ç¼©æ”¾ä¸ºå¸§å¤§å°</li><li>å³é”®é€‰æ‹©å€é€Ÿ</li><li>å³é”®å–æ¶ˆè§†é¢‘éŸ³é¢‘é“¾æ¥</li><li>å³é”®æ³¢çº¹åˆ é™¤ï¼Œæˆ–é€‰ä¸­ç©ºéš™ç›´æ¥åˆ é™¤</li><li>å³é”®å‡å°‘éŸ³é¢‘å¢ç›Š</li><li>shift + left/right arrow èƒ½å¤Ÿä»¥5å¸§ç§»ï¼Œä¸æŒ‰ shift ç§»åŠ¨1å¸§</li><li>æŒ‰ä½ shift å†æ‹‰åŠ¨æ—¶é—´è½´ä¼šæœ‰å¸é™„æ•ˆæœ</li><li>ctrl + k å¿«é€Ÿå‰ªè£</li><li>ä½¿ç”¨åµŒå¥—ï¼Œèåˆç´ æ</li><li>æŒ‰ä½ ctrl æ‹–åŠ¨è§†é¢‘ï¼Œèƒ½å¤Ÿä¸è¦†ç›–åœ°ç§»åŠ¨è§†é¢‘ç‰‡æ®µ</li><li>å•å‡»é¡¶éƒ¨åºåˆ—èœå• -&gt; å°é—­é—´éš™</li><li>ctrl + D æˆ–è€… shift + D è¿›è¡Œå¿«é€Ÿè§†é¢‘è¿‡æ¸¡</li></ol><h3 id="å¿«æ·é”®"><a href="#å¿«æ·é”®" class="headerlink" title="å¿«æ·é”®"></a>å¿«æ·é”®</h3><p>cut </p><h2 id="æ ‡è®°å‡ºå…¥ç‚¹"><a href="#æ ‡è®°å‡ºå…¥ç‚¹" class="headerlink" title="æ ‡è®°å‡ºå…¥ç‚¹"></a>æ ‡è®°å‡ºå…¥ç‚¹</h2><ol><li>é¢„è§ˆå·¥å…·æ </li></ol><p><img src="/archives/d76b900f/image-20210713213300154.png"></p><ol><li><strong>å‡ºå…¥ç‚¹</strong>åœ¨ pr ä¸­ä»¥ bracket {} å½¢å¼å‡ºç°</li></ol><p>â€‹    åŒå‡»ç´ æï¼Œå¯¹ç´ æè¿›è¡Œå‡ºå…¥ç‚¹æ ‡è®°ï¼Œå†å°†ç´ ææ‹–å…¥åºåˆ—å°±èƒ½å¾—åˆ°å‰ªè£åçš„    ç´ æ</p><ol><li>æ·»åŠ æ ‡è®°ç‚¹ï¼Œå°±æ˜¯å·¥å…·æ ç¬¬ä¸€ä¸ªæ ‡å¿—ã€‚å¯ä»¥æ ‡è®°è§†é¢‘ä¸­çš„é‡è¦æ—¶åˆ»</li></ol><h2 id="æŠ½å¸§å¡ç‚¹"><a href="#æŠ½å¸§å¡ç‚¹" class="headerlink" title="æŠ½å¸§å¡ç‚¹"></a>æŠ½å¸§å¡ç‚¹</h2><p>æ ¹æ®éŸ³é¢‘çš„èŠ‚å¥å»å¡ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°éŸ³é¢‘ä¸Šçš„èŠ‚å¥ç‚¹ä¸Šæ˜¯æ˜æ˜¾çš„æ³¢å³°ï¼ŒæŠŠè¿™äº›ç‚¹æ ‡è®°å‡ºæ¥ï¼Œå¯¹åŸè§†é¢‘å‰ªè£å¡è¿™ä¸ªç‚¹å³å¯</p><p>å¯ä»¥ä½¿ç”¨æ’ä»¶ beat edit æ¥å¸®æˆ‘ä»¬è‡ªåŠ¨æ‰¾åˆ°èŠ‚å¥ç‚¹</p><h2 id="åŠ è½½å­—å¹•"><a href="#åŠ è½½å­—å¹•" class="headerlink" title="åŠ è½½å­—å¹•"></a>åŠ è½½å­—å¹•</h2><p>å¦‚æœæ˜¯æƒ³è¦åŠ å¤§é‡å­—å¹•ï¼Œæ¨èä½¿ç”¨è½¯ä»¶ arctime pro</p><p>TODO: å¦‚ä½•è‡ªåŠ¨è¯†åˆ«å¯¹è¯ï¼Œå½¢æˆå­—å¹•</p><h2 id="é¬¼ç•œ"><a href="#é¬¼ç•œ" class="headerlink" title="é¬¼ç•œ"></a>é¬¼ç•œ</h2><ol><li><p>é¬¼ç•œç´ æï¼Œé¬¼ç•œç´ æï¼Œé¬¼ç•œç´ æï¼</p></li><li><p>æŒ‰ä½ alt æ‹–æ‹½è§†é¢‘å°±èƒ½å¤Ÿå¤åˆ¶</p></li><li>å³é”®é€‰æ‹©å¸§é€Ÿåº¦æ›´æ”¹é€Ÿåº¦ï¼Œè¿˜å¯ä»¥å€’æ”¾</li></ol><h2 id="è½¬åœº"><a href="#è½¬åœº" class="headerlink" title="è½¬åœº"></a>è½¬åœº</h2><ol><li>åŸºç¡€çš„è½¬åœºï¼Œæ·¡å…¥æ·¡å‡º</li><li>ä½¿ç”¨ç‰¹æ•ˆçš„è½¬åœºï¼Œå°†ç‰¹æ•ˆåŠ åœ¨è°ƒæ•´å›¾å±‚ä¸Šï¼Œä¸ç”¨ä¿®æ”¹åŸå›¾å±‚</li><li>å¯ä»¥ä½¿ç”¨ preset è½¬åœºèµ„æºï¼š<a href="https://www.bilibili.com/video/BV1ab411E7EA">é¢„è®¾ bilibili</a> (æ›´å¤šèµ„æºè¯·ç§»æ­¥ bilibili)</li></ol><h2 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h2><p>æ¨èçš„å­—ä½“ï¼Œæ¨èå­—ä½“ç½‘ç«™ <a href="https://www.fonts.net.cn/">å­—ä½“å¤©ä¸‹</a></p><ol><li>æ€æºé»‘ä½“</li><li>å°åŒ—é»‘ä½“ï¼Œé€‚ç”¨äºç¹ä½“å­—</li><li>èŠ±å›­æ˜æœä½“</li><li>åˆ»çŸ³å½•æ˜ä½“ï¼Œä»¤ä¸œé½ä¼‹å¤åˆ»ä½“</li><li>OPPO/HarmonyOS SANS</li><li>æ‰‹ä¹¦ä½“ä¸­æ–‡ç®€ä½“</li><li>good hood, maria ä»¥ä¸Šå­—ä½“å‡å…è´¹å¯å•†ç”¨</li><li>gloss and boom</li><li>againts å­—ä½“</li><li>Futura, Baskerville(æ­£è§„),  Trajan(æ ‡é¢˜)</li></ol><h2 id="è°ƒè‰²"><a href="#è°ƒè‰²" class="headerlink" title="è°ƒè‰²"></a>è°ƒè‰²</h2><p>ä½¿ç”¨ LUT è°ƒè‰²ï¼Œé…åˆä¸Šä¾§è½®è¿›è¡Œå¾®è°ƒ</p><p>æ•™ç¨‹ï¼š<a href="https://www.bilibili.com/video/BV1qE411d7BS">è°ƒè‰² bilibili</a></p><h2 id="åŠ¨ç”»"><a href="#åŠ¨ç”»" class="headerlink" title="åŠ¨ç”»"></a>åŠ¨ç”»</h2><p><strong>æœ€åŸºç¡€ä¹Ÿæœ€å¸¸ç”¨çš„å°±æ˜¯ä½¿ç”¨å…³é”®å¸§å®ç°åŠ¨ç”»ï¼ŒPr èƒ½å¤Ÿé€šè¿‡å…³é”®å¸§è‡ªåŠ¨å®ç°ç®€å•åŠ¨ç”»</strong></p><p>ä¸‹é¢æ˜¯ä¸€äº›æ‡’äººæ•™ç¨‹ï¼Œèƒ½å¤Ÿé€šè¿‡æ¨¡æ¿æˆ–è€…é¢„è®¾å®ŒæˆåŠ¨ç”»</p><p><a href="https://www.bilibili.com/video/BV1JK4y1o712?from=search&amp;seid=15809921384211472980">æ–‡å­—å‡ºå…¥åŠ¨ç”»é¢„è®¾</a>ï¼šæ¨èä½¿ç”¨ glitch smooth</p><p><a href="https://www.bilibili.com/video/BV1QJ411578F?from=search&amp;seid=1184998685891370931">å¿«é€Ÿæ·»åŠ  emoji è¡¨æƒ…</a></p><h2 id="å¸¸ç”¨æ•ˆæœï¼Œè¿›é˜¶å®æˆ˜"><a href="#å¸¸ç”¨æ•ˆæœï¼Œè¿›é˜¶å®æˆ˜" class="headerlink" title="å¸¸ç”¨æ•ˆæœï¼Œè¿›é˜¶å®æˆ˜"></a>å¸¸ç”¨æ•ˆæœï¼Œè¿›é˜¶å®æˆ˜</h2><p><a href="https://www.bilibili.com/video/BV1h7411M7pH?from=search&amp;seid=1594445263778267172">ç®€å•è§†é¢‘è¿‡æ¸¡</a></p><p><a href="https://www.bilibili.com/video/BV1tt411w75b?from=search&amp;seid=14224780402575780190">è£å‰ªï¼Œæ—‹è½¬</a></p><p><a href="https://www.bilibili.com/video/BV1Kb411M7QD?from=search&amp;seid=14224780402575780190">è½¨é“é®ç½©æ•™ç¨‹</a></p><p><a href="https://www.bilibili.com/video/BV1T441177Rz/">ä¸é€æ˜åº¦ï¼Œè’™æ¿é®ç½©è½¬åœº</a></p><p><a href="https://www.bilibili.com/medialist/play/ml1093412053/BV1CX4y1373V">ç»¿å¹•ç´ ææ•™ç¨‹ è¶…çº§é”®</a></p><p><a href="https://www.bilibili.com/video/BV1Kb411M7QD?from=search&amp;seid=14224780402575780190">åŸºç¡€å›¾å½¢å˜æ¢ï¼Œç»ç’ƒåˆ’è¿‡æ•ˆæœ</a></p><p><a href="https://www.bilibili.com/video/BV1Vb411J7q3?from=search&amp;seid=11560949388583323453">æ–‡å­—ä¹¦å†™</a></p><h2 id="vlog-ç´ æåº“"><a href="#vlog-ç´ æåº“" class="headerlink" title="vlog ç´ æåº“"></a>vlog ç´ æåº“</h2><ol><li><p><a href="https://dongmanhuayuan.myheartsite.com/">åŠ¨æ¼«èŠ±å›­é•œåƒç«™</a></p></li><li><p><a href="https://mixkit.co/">mixkit</a></p><p>è§†é¢‘ï¼ŒéŸ³é¢‘ï¼ŒPræ¨¡æ¿èµ„æº</p></li><li><p><a href="https://pixabay.com/zh/">pixabay</a></p><p>è§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œå›¾ç‰‡èµ„æº</p></li><li><p><a href="https://www.iconfont.cn/">iconfont</a></p></li><li><p>vlog éŸ³ä¹èµ„æºï¼šå‚è€ƒ <a href="https://www.bilibili.com/video/BV1uX4y1G7M8?from=search&amp;seid=14857001846860959682">vlog bgm bilibili</a>ï¼Œè¿˜å¯ä»¥å­¦ä¹ ä¸€ä¸‹å¦‚ä½•å¤„ç† bgm ä¸äººå£°æ··åˆ</p><p><a href="https://soundcloud.com/lakeyinspired">sound cloud: lakey inspired</a></p><p>å¦‚æœæƒ³è¦ä½¿ç”¨ off vocal music åªéœ€è¦æœç´¢ æ­Œå + instrumental å³å¯</p></li></ol><p>è§†é¢‘ã€éŸ³æ•ˆç´ æå¸Œæœ›è‡ªå·±è¦æœ‰ç›®çš„åœ°å»å¯»æ‰¾ï¼Œä¸ç„¶èµ„æºå†å¤šä¹Ÿæ²¡ç”¨</p>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶ </category>
          
          <category> Adobe </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Manim Kindergarten æ•™ç¨‹</title>
      <link href="/archives/84b26b6c.html"/>
      <url>/archives/84b26b6c.html</url>
      
        <content type="html"><![CDATA[<h1 id="Manim-æ‹“å±•å­¦ä¹ "><a href="#Manim-æ‹“å±•å­¦ä¹ " class="headerlink" title="Manim æ‹“å±•å­¦ä¹ "></a>Manim æ‹“å±•å­¦ä¹ </h1><p>ç”±äº Manim-Kindergarten çš„ <a href="https://www.bilibili.com/video/BV1p54y197cC?from=search&amp;seid=1264961070490764259">è§†é¢‘æ•™ç¨‹</a> éå¸¸å‹å¥½ï¼Œæ‰€ä»¥æ ¹æ®ä»–ä»¬çš„è§†é¢‘è¿›è¡Œæ•´ç†å’Œå­¦ä¹ ã€‚ä½†æ˜¯ç”±äºæ•™ç¨‹ä¸­ä½¿ç”¨çš„ manim ç‰ˆæœ¬å¹¶ä¸æ˜¯ç¤¾åŒºç‰ˆæœ¬ï¼Œæ‰€æœ‰æ•´ç†çš„å†…å®¹å’ŒåŸæ•™ç¨‹æœ‰æ‰€å‡ºå…¥</p><h2 id="ç¬¬ä¸€è®²-ç‰©ä½“çš„ä½ç½®ä¸åæ ‡å˜æ¢"><a href="#ç¬¬ä¸€è®²-ç‰©ä½“çš„ä½ç½®ä¸åæ ‡å˜æ¢" class="headerlink" title="ç¬¬ä¸€è®² ç‰©ä½“çš„ä½ç½®ä¸åæ ‡å˜æ¢"></a>ç¬¬ä¸€è®² ç‰©ä½“çš„ä½ç½®ä¸åæ ‡å˜æ¢</h2><p>æ€æ ·ç¡®å®šç‰©ä½“çš„åæ ‡ï¼Ÿé¦–å…ˆè¦ç†è§£ manim çš„åæ ‡ä½“ç³»ã€‚</p><ol><li>åœ¨ manim ä¸­ï¼Œä½¿ç”¨ä¸‰ç»´ ndarray è¡¨ç¤ºä¸€ä¸ªç‚¹çš„åæ ‡ <code>np.array([x, y, z])</code>ï¼ŒäºŒç»´åœºæ™¯ä¸­è®¾ <code>z = 0</code></li><li>å•ä½é•¿åº¦å–å†³äº constants.py ä¸­çš„ FRAME_HEIGHTï¼Œç”»é¢çš„å®½åº¦ç”±é«˜åº¦å’Œé•¿å®½æ¯”åŒæ—¶å†³å®šã€‚FRAME_HEIGHT é»˜è®¤å€¼ä¸º8ï¼Œy çš„å˜åŒ–èŒƒå›´åªèƒ½æ˜¯ [-4, 4]</li><li>åœ¨ manim ä¸­ï¼ŒäºŒç»´ç”»é¢ä»¥ä¸­å¿ƒä¸ºåæ ‡åŸç‚¹ï¼Œå‘å³ä¸º x è½´æ­£æ–¹å‘ï¼Œå‘ä¸Šä¸º y è½´æ­£æ–¹å‘</li></ol><p>manim ä¸­å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„å•ä½æ–¹å‘å¸¸é‡æ¯”å¦‚ï¼š</p><p>LEFT = <code>np.array([-1, 0, 0])</code></p><p>RIGHT = <code>np.array([1, 0, 0])</code> </p><p>UP = <code>np.array([0, 1, 0])</code></p><p>DOWN = <code>np.array([0, -1, 0])</code></p><h3 id="shift-move-to"><a href="#shift-move-to" class="headerlink" title="shift+move_to"></a>shift+move_to</h3><p>ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æ ¹æ®ä¼ å…¥çš„ vector ç§»åŠ¨ç‰©ä½“ï¼Œshift æ˜¯ç›¸å¯¹ç§»åŠ¨ï¼Œmove_to æ˜¯ç§»åŠ¨åˆ°åæ ‡ç³»ä¸­çš„ç‚¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># create a mobject 'mob' first</span>mob<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">*</span>vectors<span class="token punctuation">)</span>mob<span class="token punctuation">.</span>move_to<span class="token punctuation">(</span><span class="token operator">*</span>vectors<span class="token punctuation">,</span> aligned_egde<span class="token punctuation">,</span> coor_mask<span class="token punctuation">)</span><span class="token comment"># corr_mask å¯ä»¥å±è”½æŒ‡å®šæ–¹å‘çš„ç§»åŠ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="scale-amp-stretch-amp-set-width-height"><a href="#scale-amp-stretch-amp-set-width-height" class="headerlink" title="scale &amp; stretch &amp; set_width/height"></a>scale &amp; stretch &amp; set_width/height</h3><p>å¯¹ç‰©ä½“è¿›è¡Œæ”¾å¤§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">mob<span class="token punctuation">.</span>scale<span class="token punctuation">(</span>factor<span class="token punctuation">,</span> about_egde<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> about_point<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯¹ç‰©ä½“è¿›è¡Œæ‹‰ä¼¸</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">mob<span class="token punctuation">.</span>stretch<span class="token punctuation">(</span>factor<span class="token punctuation">,</span> dim<span class="token punctuation">)</span>mob<span class="token punctuation">.</span>set_width<span class="token punctuation">(</span>width<span class="token punctuation">,</span> stretch<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>mob<span class="token punctuation">.</span>set_height<span class="token punctuation">(</span>height<span class="token punctuation">,</span> stretch<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="rotate"><a href="#rotate" class="headerlink" title="rotate"></a>rotate</h3><p>æ ¹æ®å³æ‰‹å®šå¾‹è¿›è¡Œæ—‹è½¬ </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># angle éœ€è¦ç”¨ manim ä¸­å®šä¹‰çš„ DEGREES or PI è¿›è¡Œè®¡ç®—</span>mob<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>angle<span class="token punctuation">,</span> axis<span class="token operator">=</span>OUT<span class="token punctuation">,</span> about_point<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="flip"><a href="#flip" class="headerlink" title="flip"></a>flip</h3><p>èƒ½å¤ŸæŒ‡å®šå¯¹ç§°è½´è¿›è¡Œé•œåƒç¿»è½¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">mob<span class="token punctuation">.</span>flip<span class="token punctuation">(</span><span class="token punctuation">)</span>mob<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>axis<span class="token operator">=</span>vector<span class="token punctuation">,</span> about_point<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="align-to-amp-next-to"><a href="#align-to-amp-next-to" class="headerlink" title="align_to &amp; next_to"></a>align_to &amp; next_to</h3><p>åæ ‡å’ŒæŸä¸ªç‰©ä½“å¯¹é½ï¼Œæˆ–è€…åœ¨æŸä¸ªç‰©ä½“çš„ç›¸é‚»ä½ç½®</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># direction is a vector like LEFT, RIGHT, UL</span>mob<span class="token punctuation">.</span>align_to<span class="token punctuation">(</span>mob_or_point<span class="token punctuation">,</span> direction<span class="token punctuation">)</span>mob<span class="token punctuation">.</span>next_to<span class="token punctuation">(</span>mob_or_point<span class="token punctuation">,</span> direction<span class="token punctuation">,</span> aligned_edge<span class="token punctuation">,</span> buff<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬äºŒè®²-manimå¸¸ç”¨å‡ ä½•ç±»"><a href="#ç¬¬äºŒè®²-manimå¸¸ç”¨å‡ ä½•ç±»" class="headerlink" title="ç¬¬äºŒè®² manimå¸¸ç”¨å‡ ä½•ç±»"></a>ç¬¬äºŒè®² manimå¸¸ç”¨å‡ ä½•ç±»</h2><h3 id="line-amp-arrow"><a href="#line-amp-arrow" class="headerlink" title="line &amp; arrow"></a>line &amp; arrow</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">line <span class="token operator">=</span> Line<span class="token punctuation">(</span>start_point<span class="token punctuation">,</span> end_point<span class="token punctuation">,</span> buff<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>arrow <span class="token operator">=</span> Aroow<span class="token punctuation">(</span>start_point<span class="token punctuation">,</span> end_point<span class="token punctuation">,</span> buff<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tip_length<span class="token punctuation">)</span><span class="token comment"># buff è°ƒæ•´çš„æ˜¯åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰å…¶ä»–æ›´å¤šçš„å˜åŒ–ï¼Œæ¯”å¦‚ Dashline Vector</p><h3 id="arc"><a href="#arc" class="headerlink" title="arc"></a>arc</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">arc <span class="token operator">=</span> Arc<span class="token punctuation">(</span>arc_center<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> start_angle<span class="token punctuation">,</span> angle<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="circle-amp-dot-amp-ellipse"><a href="#circle-amp-dot-amp-ellipse" class="headerlink" title="circle &amp; dot &amp; ellipse"></a>circle &amp; dot &amp; ellipse</h3><p>è¿™ä¸‰ç±»å‡ ä½•å›¾å½¢éƒ½æ˜¯ç»§æ‰¿äº arc ç±»ï¼Œæ‰€æœ‰å‚æ•°éƒ½æœ‰ç›¸ä¼¼ä¹‹å¤„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">circle <span class="token operator">=</span> Circle<span class="token punctuation">(</span>arc_center<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> stroke_width<span class="token punctuation">)</span>dot <span class="token operator">=</span> Dot<span class="token punctuation">(</span>arc_center<span class="token punctuation">,</span> radius<span class="token punctuation">)</span>ellipse <span class="token operator">=</span> Ellipse<span class="token punctuation">(</span>arc_center<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="annulus-amp-sector"><a href="#annulus-amp-sector" class="headerlink" title="annulus &amp; sector"></a>annulus &amp; sector</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">annulus <span class="token operator">=</span> Annulus<span class="token punctuation">(</span>outer_radis<span class="token punctuation">,</span> inner_radius<span class="token punctuation">)</span>sector <span class="token operator">=</span> Sector<span class="token punctuation">(</span>outer_radius<span class="token punctuation">,</span> inner_radius<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="polygon-amp-triangle"><a href="#polygon-amp-triangle" class="headerlink" title="polygon &amp; triangle"></a>polygon &amp; triangle</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">triangle <span class="token operator">=</span> Polygon<span class="token punctuation">(</span>point_1<span class="token punctuation">,</span> point_2<span class="token punctuation">,</span> point_3<span class="token punctuation">)</span>triangle <span class="token operator">=</span> Triangle<span class="token punctuation">(</span><span class="token punctuation">)</span>Hexagon <span class="token operator">=</span> RegularPolygon<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯¹äºå¤šè¾¹å½¢è¿˜æœ‰ä¸€ä¸ªç‰¹åˆ«çš„æ–¹æ³•ï¼Œå°†é¡¶ç‚¹å˜ä¸ºåœ†å¼§</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># mob is a polygon mobject instance</span>mob<span class="token punctuation">.</span>round_corners<span class="token punctuation">(</span>radius<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="rectangle-amp-square"><a href="#rectangle-amp-square" class="headerlink" title="rectangle &amp; square"></a>rectangle &amp; square</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">rectangle <span class="token operator">=</span> Rectangle<span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">)</span>square <span class="token operator">=</span> Square<span class="token punctuation">(</span>side_length<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="VGroup"><a href="#VGroup" class="headerlink" title="VGroup"></a>VGroup</h3><p>è¯¥æ–¹æ³•èƒ½å¤Ÿå°†å¤šä¸ª mobject æ”¾åˆ°ä¸€ä¸ªç»„ä¸­ï¼Œèƒ½å¤Ÿå®ç°ç±»ä¼¼ list çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç®¡ç†æˆå‘˜ã€åµŒå¥—ï¼ŒåŒæ—¶è¿˜èƒ½ä½¿ç”¨ mobject é€šç”¨æ–¹æ³•</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">vgroup <span class="token operator">=</span> VGroup<span class="token punctuation">(</span>mob0<span class="token punctuation">,</span> mob1<span class="token punctuation">,</span> mob2<span class="token punctuation">)</span>vgroup<span class="token punctuation">.</span>add<span class="token punctuation">(</span>mob3<span class="token punctuation">)</span>vgroup<span class="token punctuation">.</span>add_to_back<span class="token punctuation">(</span>mob4<span class="token punctuation">)</span>vgroup<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>mob2<span class="token punctuation">)</span>vgroup<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>UP<span class="token punctuation">)</span><span class="token comment"># å°†æˆå‘˜æŒ‰ç…§æŸä¸€æ–¹å‘å¯¹é½ï¼Œæœ¬è´¨ä¸Šæ˜¯å®ç°äº† next_to æ–¹æ³•</span>vg<span class="token punctuation">.</span>arrange<span class="token punctuation">(</span>DOWN<span class="token punctuation">,</span> aligned_edge<span class="token operator">=</span>LEFT<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¬¬ä¸‰è®²-é¢œè‰²çš„è¡¨ç¤ºã€è¿ç®—ä¸è®¾ç½®"><a href="#ç¬¬ä¸‰è®²-é¢œè‰²çš„è¡¨ç¤ºã€è¿ç®—ä¸è®¾ç½®" class="headerlink" title="ç¬¬ä¸‰è®² é¢œè‰²çš„è¡¨ç¤ºã€è¿ç®—ä¸è®¾ç½®"></a>ç¬¬ä¸‰è®² é¢œè‰²çš„è¡¨ç¤ºã€è¿ç®—ä¸è®¾ç½®</h2><h3 id="é¢œè‰²çš„è¡¨ç¤º"><a href="#é¢œè‰²çš„è¡¨ç¤º" class="headerlink" title="é¢œè‰²çš„è¡¨ç¤º"></a>é¢œè‰²çš„è¡¨ç¤º</h3><p>æœ‰ä¸‰ç§è¡¨ç¤ºæ–¹æ³•</p><ol><li><p>å®šä¹‰çš„å¸¸é‡ï¼Œå¦‚ä¸‹å›¾</p></li><li><p>åå…­è¿›åˆ¶ï¼Œå½¢å¦‚ #66CCFF</p></li><li><p>RGBæ•°ç»„ï¼Œå½¢å¦‚ np.array([255, 104, 100])</p></li></ol><p><img src="/archives/84b26b6c/image-20210729201211734.png" style="zoom: 20%;"></p><p>ä½†æ‰€æœ‰çš„è¡¨ç¤ºæ–¹æ³•ï¼Œåœ¨ manim ä¸­æœ€ç»ˆéƒ½ä¼šè½¬åŒ–ä¸º Color ç±»</p><p><strong>æ¨èä½¿ç”¨å¸¸é‡æˆ–è€…åå…­è¿›åˆ¶æ¥è¡¨ç¤ºé¢œè‰²</strong></p><h3 id="é¢œè‰²çš„è¿ç®—"><a href="#é¢œè‰²çš„è¿ç®—" class="headerlink" title="é¢œè‰²çš„è¿ç®—"></a>é¢œè‰²çš„è¿ç®—</h3><p>åˆ—å‡ ä¸ªå¸¸è§çš„è¿ç®—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åè‰²</span>invert_color<span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token comment"># æ’å€¼</span>interpolate_color<span class="token punctuation">(</span>color_1<span class="token punctuation">,</span> color_2<span class="token punctuation">,</span> ratio<span class="token punctuation">)</span><span class="token comment"># å¹³å‡</span>average_color<span class="token punctuation">(</span><span class="token operator">*</span>colors<span class="token punctuation">)</span><span class="token comment"># æ¢¯åº¦</span>color_gradient<span class="token punctuation">(</span><span class="token punctuation">[</span>color_1<span class="token punctuation">,</span> color_2<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token comment"># éšæœº</span>random_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/84b26b6c/image-20210729203331953.png" alt="color_gradient" style="zoom:25%;"></p><h3 id="ç‰©ä½“é¢œè‰²è®¾ç½®"><a href="#ç‰©ä½“é¢œè‰²è®¾ç½®" class="headerlink" title="ç‰©ä½“é¢œè‰²è®¾ç½®"></a>ç‰©ä½“é¢œè‰²è®¾ç½®</h3><p>stroke ä»£è¡¨è¾¹æ¡†ç€è‰²ï¼Œfill ä»£è¡¨å†…éƒ¨ç€è‰²</p><div class="table-container"><table><thead><tr><th>stroke</th><th>fill</th></tr></thead><tbody><tr><td>stroke_color</td><td>fill_color</td></tr><tr><td>stroke_opacity</td><td>fill_opacity</td></tr></tbody></table></div><p>ä¸Šé¢çš„å±æ€§éƒ½å¯ä»¥é€šè¿‡ set_stroke/fill æ¥æ›´æ”¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">mob<span class="token punctuation">.</span>set_stroke<span class="token punctuation">(</span>color<span class="token punctuation">,</span> width<span class="token punctuation">)</span>mob<span class="token punctuation">.</span>set_fill<span class="token punctuation">(</span>color<span class="token punctuation">,</span> opacity<span class="token punctuation">)</span>mob<span class="token punctuation">.</span>set_fill<span class="token punctuation">(</span><span class="token punctuation">[</span>color_1<span class="token punctuation">,</span> color_2<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> opacity<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ç»™-VGroup-å­ç‰©ä½“ä¸Šè‰²"><a href="#ç»™-VGroup-å­ç‰©ä½“ä¸Šè‰²" class="headerlink" title="ç»™ VGroup å­ç‰©ä½“ä¸Šè‰²"></a>ç»™ VGroup å­ç‰©ä½“ä¸Šè‰²</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># vg is a VGroup instance</span>vg<span class="token punctuation">.</span>set_color<span class="token punctuation">(</span>color<span class="token punctuation">)</span>vg<span class="token punctuation">.</span>set_color_by_gradient<span class="token punctuation">(</span><span class="token operator">*</span>colors<span class="token punctuation">)</span>vg<span class="token punctuation">.</span>set_colors_by_radial_gradient<span class="token punctuation">(</span>radius<span class="token punctuation">,</span> inner_color<span class="token punctuation">,</span> outer_color<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ <code>VMobject</code> çš„å†…ç½®æ–¹æ³•ï¼Œæ˜¯ä¸€ç§é€šç”¨çš„æ–¹æ³•ï¼Œè€Œä¸”è¿™äº›æ–¹æ³•ä¸ä»…ä»…å¯ä»¥è®¾ç½® <code>stroke</code> çš„é¢œè‰²ï¼Œä¹Ÿå¯ä»¥è®¾ç½® <code>width, opacity...</code></p><h2 id="ç¬¬å››è®²-æ’å…¥SVGã€å›¾ç‰‡ä¸æ–‡å­—"><a href="#ç¬¬å››è®²-æ’å…¥SVGã€å›¾ç‰‡ä¸æ–‡å­—" class="headerlink" title="ç¬¬å››è®² æ’å…¥SVGã€å›¾ç‰‡ä¸æ–‡å­—"></a>ç¬¬å››è®² æ’å…¥SVGã€å›¾ç‰‡ä¸æ–‡å­—</h2><h3 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h3><p>åœ¨ manim æ’å…¥å›¾ç‰‡éœ€è¦å…ˆå°†å›¾ç‰‡æ”¾åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œæˆ–è€…ä½¿ç”¨ <code>config.assets_dir</code> æŒ‡å®šç´ ææ–‡ä»¶å¤¹ã€‚ä¸åŒçš„å›¾ç‰‡ç±»å‹åˆ™ä½¿ç”¨ä¸åŒçš„å¯¹è±¡è¿›è¡Œå­˜å‚¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># SVG</span>mob <span class="token operator">=</span> SVGMobject<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token comment"># image: jpg, png, gif</span>mob <span class="token operator">=</span> ImageMobject<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>SVGMobject</code> æ˜¯ <code>VMobject</code> çš„å­ç±»ï¼Œå¯ä»¥ä½¿ç”¨å…¶æ‰€æœ‰åŠ¨ç”»ï¼Œä½† <code>ImageMobject</code> ä»…èƒ½ä½¿ç”¨éƒ¨åˆ†åŠ¨ç”»ï¼Œå¦‚ï¼šFadeIn</p><h3 id="æ–‡å­—ä¸å…¬å¼"><a href="#æ–‡å­—ä¸å…¬å¼" class="headerlink" title="æ–‡å­—ä¸å…¬å¼"></a>æ–‡å­—ä¸å…¬å¼</h3><p>åœ¨ manim ä¸­å¯ä»¥ä½¿ç”¨ <code>Text</code> åˆ›å»ºæ™®é€šæ–‡å­—å¯¹è±¡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">text <span class="token operator">=</span> Text<span class="token punctuation">(</span><span class="token operator">*</span>strings<span class="token punctuation">,</span> color<span class="token punctuation">,</span> font<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥ä¼ å…¥å¤šä¸ªå­—ç¬¦ä¸²ï¼ŒåŒæ · <code>Text</code> ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰€æœ‰åŠ¨ç”»ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨ LaTeX è¯­æ³•ä¹¦å†™æ–‡å­—å’Œå…¬å¼ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>Tex, MathTex</code> ç±»</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">text <span class="token operator">=</span> Tex<span class="token punctuation">(</span><span class="token operator">*</span>raw_strings<span class="token punctuation">)</span>formula <span class="token operator">=</span> MathTex<span class="token punctuation">(</span><span class="token operator">*</span>raw_strings<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰€æœ‰çš„æ–‡å­—å’Œå…¬å¼éƒ½æ˜¯ä¸€ä¸ª <code>VGroup</code>ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥å¯¹æ¯ä¸ªå­—ç¬¦å•ç‹¬æ“ä½œ</p><h2 id="ç¬¬äº”è®²-åæ ‡ç³»ç»Ÿä¸æ–¹ç¨‹"><a href="#ç¬¬äº”è®²-åæ ‡ç³»ç»Ÿä¸æ–¹ç¨‹" class="headerlink" title="ç¬¬äº”è®² åæ ‡ç³»ç»Ÿä¸æ–¹ç¨‹"></a>ç¬¬äº”è®² åæ ‡ç³»ç»Ÿä¸æ–¹ç¨‹</h2><h3 id="åæ ‡è½´"><a href="#åæ ‡è½´" class="headerlink" title="åæ ‡è½´"></a>åæ ‡è½´</h3><p>åœ¨ manim ä¸­å¯ä»¥æ’å…¥åæ ‡è½´</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># NumberLine</span><span class="token comment"># x_range æ ‡æ˜æ•°å‘¨çš„èŒƒå›´ä»¥åŠæ­¥é•¿</span>line <span class="token operator">=</span> NumberLine<span class="token punctuation">(</span>        numberline <span class="token operator">=</span> NumberLine<span class="token punctuation">(</span>            x_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>            include_numbers<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>            include_ticks<span class="token operator">=</span><span class="token boolean">False</span>        <span class="token punctuation">)</span><span class="token comment"># Axes</span><span class="token comment"># åˆ†åˆ«è®¾ç½® x, y åæ ‡è½´ï¼Œå…·ä½“å‚æ•°æ‰“åŒ…ä¸ºå­—å…¸ï¼Œå…³é”®å­—åŒ NumberLine</span>axes <span class="token operator">=</span> Axes<span class="token punctuation">(</span>            x_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            y_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            axis_config<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>                include_numbers<span class="token operator">=</span><span class="token boolean">True</span>            <span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token comment"># NumberPlane</span><span class="token comment"># æ³¨æ„è¿™é‡Œçš„æ­¥é•¿æ˜¯æŒ‡æ•°è½´çš„æ•°é‡</span>number_plane <span class="token operator">=</span> NumberPlane<span class="token punctuation">(</span>            x_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            y_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            background_line_style<span class="token operator">=</span><span class="token punctuation">{</span>                <span class="token string">"stroke_color"</span><span class="token punctuation">:</span> TEAL<span class="token punctuation">,</span>                <span class="token string">"stroke_width"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>                <span class="token string">"stroke_opacity"</span><span class="token punctuation">:</span> <span class="token number">0.6</span>            <span class="token punctuation">}</span>        <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ–¹ç¨‹"><a href="#æ–¹ç¨‹" class="headerlink" title="æ–¹ç¨‹"></a>æ–¹ç¨‹</h3><p>ä½¿ç”¨ <code>ParametricFunction</code> å¯ä»¥æ˜¾ç¤ºå‡½æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å•å˜é‡æ–¹ç¨‹ï¼Œè¿”å›ä¸‰ç»´ ndarray</span><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">construct</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    func <span class="token operator">=</span> ParametricFunction<span class="token punctuation">(</span>self<span class="token punctuation">.</span>func<span class="token punctuation">,</span> t_range <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> TAU<span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span>RED<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>add<span class="token punctuation">(</span>func<span class="token punctuation">.</span>scale<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>ManimCE æ–‡æ¡£æœ‰ä¸€ä¸ª <a href="https://docs.manim.community/en/stable/reference.html">reference manual</a>ï¼Œå®˜æ–¹æè¿°è¿™ä¸ªæ‰‹å†Œçš„åŠŸèƒ½ï¼š</p><blockquote><p>This reference manual details modules, functions, and variables included in Manim, describing what they are and what they do. </p></blockquote><p>é‡Œé¢åŒ…å«äº†å„ç§æ¨¡å—å’Œå‡½æ•°ï¼Œæ›´å¤šçš„ <code>VMobject</code> å’Œæ›´å¤šçš„åŠ¨ç”»æ“ä½œï¼Œæ–‡æ¡£ä¸­è¿˜æœ‰ <a href="https://docs.manim.community/en/stable/examples.html">Example Gallery</a> æä¾›å‚è€ƒ</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Package </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Manim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch tutorial</title>
      <link href="/archives/6c437432.html"/>
      <url>/archives/6c437432.html</url>
      
        <content type="html"><![CDATA[<h1 id="Pytorch-Tutorial"><a href="#Pytorch-Tutorial" class="headerlink" title="Pytorch Tutorial"></a>Pytorch Tutorial</h1><p><a href="https://pytorch.org/tutorials/">å®˜æ–¹ tutorial</a> <a href="https://pytorch.org/tutorials/beginner/ptcheat.html#">å®˜æ–¹ Cheat Sheet</a></p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><p>è¿™éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æ•´ä¸ª pytorch çš„ workflow</p><ol><li><p>Working with Data</p><p>pytorch æä¾›ä¸€äº›å°çš„æ•°æ®é›†ç”¨äºè®­ç»ƒå’Œæµ‹è¯•ã€‚å¯¹äºè®¡ç®—æœºè§†è§‰é¢†åŸŸçš„æ¨¡å— <code>TorchVision</code> åŒ…å«äº†ä¸€äº›å¸¸ç”¨æ•°æ®é›†ã€æ¨¡å‹å’Œè½¬æ¢å‡½æ•°ç­‰ç­‰ã€‚è£…è½½æ•°æ®é›†åˆ™ä½¿ç”¨ dataset, dataloader ç±»</p></li><li><p>Creating Models</p><p>ç»§æ‰¿ nn.Module ç±»ï¼Œåˆå§‹åŒ–ç›¸å…³æ¨¡å—ï¼Œå†™å¥½å‘å‰æ–¹ç¨‹</p></li><li><p>Optimizing</p><p>å®šä¹‰æŸå¤±å‡½æ•°ï¼Œå†ä½¿ç”¨åå‘ä¼ æ’­ç®—æ³•è¿›è¡Œä¼˜åŒ–</p></li><li><p>Saving &amp; Loading Models</p><p>ä¿å­˜æ¨¡å‹ï¼Œä»¥åŠè®­ç»ƒå¥½çš„å‚æ•°ï¼Œæ–¹ä¾¿ä¹‹åæµ‹è¯•å’ŒåŠ è½½</p></li></ol><h2 id="Tensor"><a href="#Tensor" class="headerlink" title="Tensor"></a>Tensor</h2><blockquote><p>Tensors are similar to <a href="https://numpy.org/">NumPyâ€™s</a> ndarrays, except that tensors can run on GPUs or other hardware accelerators. In fact, tensors and NumPy arrays can often share the same underlying memory, eliminating the need to copy data (see <a href="https://pytorch.org/tutorials/beginner/blitz/tensor_tutorial.html#bridge-to-np-label">Bridge with NumPy</a>). Tensors are also optimized for automatic differentiation</p></blockquote><p>ä»ä»¥ä¸Šçš„æè¿°æ¥çœ‹ Tensor æ•°æ®ç±»å‹æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>èƒ½å¤Ÿåœ¨ GPU ä¸Šè¿›è¡Œè®¡ç®—</li><li>èƒ½å¤Ÿè‡ªåŠ¨å¾®åˆ†</li></ol><p>å¦‚æœç†Ÿæ‚‰ Numpy çš„è¯ï¼Œå­¦ä¹  Tensor å°†ä¼šå˜å¾—æ›´åŠ è½»æ¾ã€‚è®¡åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†å­¦ä¹  Tensorï¼š</p><ol><li>åˆ›å»º Tensor</li><li>Tensor çš„å±æ€§</li><li>Tensor å†…ç½®æ–¹æ³•</li></ol><h3 id="åˆ›å»º-Tensor"><a href="#åˆ›å»º-Tensor" class="headerlink" title="åˆ›å»º Tensor"></a>åˆ›å»º Tensor</h3><p>å‚è€ƒ Cheat Sheet </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch <span class="token keyword">import</span> numpy <span class="token keyword">as</span> npx <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token operator">*</span>size<span class="token punctuation">)</span>              <span class="token comment"># tensor with independent N(0,1) entries</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token punctuation">[</span>ones<span class="token operator">|</span>zeros<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">*</span>size<span class="token punctuation">)</span>       <span class="token comment"># tensor with all 1's [or 0's]</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>L<span class="token punctuation">)</span>                 <span class="token comment"># create tensor from [nested] list or ndarray L</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>clone<span class="token punctuation">(</span><span class="token punctuation">)</span>                       <span class="token comment"># clone of x</span><span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>               <span class="token comment"># code wrap that stops autograd from tracking tensor history</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span>                  <span class="token comment"># arg, when set to True, tracks computation</span>                                    <span class="token comment"># history for future derivative calculations</span><span class="token comment"># create from other tensor</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>x<span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>x<span class="token punctuation">)</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>new_zeros<span class="token punctuation">(</span><span class="token operator">*</span>shape<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ›å»º tensor å’Œåˆ›å»º ndarray æ˜¯ç›¸ä¼¼çš„ã€‚æ—¢å¯ä»¥ç”ŸæˆæŒ‡å®šåˆ†å¸ƒçš„ tensorï¼Œä¹Ÿå¯ä»¥ä» ndarray ä¸­åˆ›å»ºã€‚ç”±äº tensor å’Œ ndarray å…³ç³»å¯†åˆ‡ï¼Œå®ƒä»¬ä¹‹é—´çš„è½¬æ¢ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚åŒæ—¶ tensor å’Œ numpy ä¹Ÿæ˜¯å…±ç”¨å†…å­˜çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># tensor è½¬åŒ–ä¸º ndarray</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>n <span class="token operator">=</span> x<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token comment"># è¯¥æ“ä½œä¼šæ”¹å˜ x</span><span class="token comment"># ndarray è½¬åŒ–ä¸º tensor</span>n <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Tensor-çš„å±æ€§"><a href="#Tensor-çš„å±æ€§" class="headerlink" title="Tensor çš„å±æ€§"></a>Tensor çš„å±æ€§</h3><p>ä¸»è¦ç”¨3ä¸ªå±æ€§ï¼šshape, dtype, deviece</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">tensor <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment"># f"string" ä»£è¡¨æ ¼å¼åŒ–ï¼Œç±»ä¼¼ str.format()</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Shape of tensor: </span><span class="token interpolation"><span class="token punctuation">{</span>tensor<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Datatype of tensor: </span><span class="token interpolation"><span class="token punctuation">{</span>tensor<span class="token punctuation">.</span>dtype<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Device tensor is stored on: </span><span class="token interpolation"><span class="token punctuation">{</span>tensor<span class="token punctuation">.</span>device<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›ä¸€æ­¥è¿˜æœ‰ä¸æ¢¯åº¦ç›¸å…³çš„å±æ€§ <code>grad, requires_grad, data</code></p><h3 id="Tensor-å†…ç½®æ–¹æ³•"><a href="#Tensor-å†…ç½®æ–¹æ³•" class="headerlink" title="Tensor å†…ç½®æ–¹æ³•"></a>Tensor å†…ç½®æ–¹æ³•</h3><blockquote><p>Over 100 tensor operations, including arithmetic, linear algebra, matrix manipulation (transposing, indexing, slicing), sampling and more are comprehensively described <a href="https://pytorch.org/docs/stable/torch.html">here</a>.</p></blockquote><p>è¿˜æ˜¯åˆ†æ¨¡å—æ¥æ¥æ‹›è¿™äº›å†…ç½®æ–¹æ³•</p><h4 id="Standard-numpy-like-indexing-and-slicing"><a href="#Standard-numpy-like-indexing-and-slicing" class="headerlink" title="Standard numpy-like indexing and slicing"></a>Standard numpy-like indexing and slicing</h4><p>tensor çš„ç´¢å¼•å’Œ ndarray çš„ç´¢å¼•æ˜¯ç›¸åŒçš„ï¼ŒåŒ…æ‹¬å¤šå…ƒç´¢å¼•ã€å¸ƒå°”ç´¢å¼•ã€èŠ±å¼ç´¢å¼•ï¼Œå‚è€ƒæ•´ç†çš„ numpy cheat sheet</p><h4 id="Move-tensors-to-GPU"><a href="#Move-tensors-to-GPU" class="headerlink" title="Move tensors to GPU"></a>Move tensors to GPU</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># We move our tensor to the GPU if available</span><span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    tensor <span class="token operator">=</span> tensor<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="Dimensionality"><a href="#Dimensionality" class="headerlink" title="Dimensionality"></a>Dimensionality</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>                                  <span class="token comment"># return tuple-like object of dimensions</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>tensor_seq<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>          <span class="token comment"># concatenates tensors along dim</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>tensor_seq<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># stack tensors of the same shape along dim</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>                       <span class="token comment"># reshapes x into size (a,b,...)</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span>                          <span class="token comment"># reshapes x into size (b,a) for some b</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>                      <span class="token comment"># swaps dimensions a and b</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token operator">*</span>dims<span class="token punctuation">)</span>                      <span class="token comment"># permutes dimensions</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>dim<span class="token punctuation">)</span>                      <span class="token comment"># tensor with added axis</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>                    <span class="token comment"># (a,b,c) tensor -&gt; (a,b,1,c) tensor</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># removes all dimensions of size 1 (a,1,b,1) -&gt; (a,b)</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>                      <span class="token comment"># removes specified dimension of size 1 (a,1,b,1) -&gt; (a,b,1)</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token operator">*</span>sizes<span class="token punctuation">)</span>y <span class="token operator">=</span> x<span class="token punctuation">.</span>repeat_interleave<span class="token punctuation">(</span><span class="token punctuation">[</span>tensor<span class="token operator">|</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token punctuation">)</span><span class="token comment"># similar to numpy.repeat()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Algebra"><a href="#Algebra" class="headerlink" title="Algebra"></a>Algebra</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">ret <span class="token operator">=</span> A<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>B<span class="token punctuation">)</span>       <span class="token comment"># matrix multiplication</span>ret <span class="token operator">=</span> A<span class="token punctuation">.</span>mv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>       <span class="token comment"># matrix-vector multiplication</span>ret <span class="token operator">=</span> y<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>x<span class="token punctuation">)</span>      <span class="token comment"># Computes the dot product of two 1D tensors</span>x <span class="token operator">=</span> x<span class="token punctuation">.</span>t<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment"># matrix transpose</span><span class="token comment"># This computes the element-wise product</span>z1 <span class="token operator">=</span> tensor_1 <span class="token operator">*</span> tensor_2<span class="token comment"># convert one element tensor to a Python numerical value</span>x<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="GPU-Usage"><a href="#GPU-Usage" class="headerlink" title="GPU Usage"></a>GPU Usage</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token comment"># check for cuda</span>torch<span class="token punctuation">.</span>version<span class="token punctuation">.</span>cuda<span class="token comment"># check version</span>torch<span class="token punctuation">.</span>__version__<span class="token comment"># check torch version</span>x <span class="token operator">=</span> x<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># move x's data from CPU to GPU and return new object</span>x <span class="token operator">=</span> x<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># move x's data from GPU to CPU and return new object</span><span class="token keyword">if</span> <span class="token keyword">not</span> args<span class="token punctuation">.</span>disable_cuda <span class="token keyword">and</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token comment"># device agnostic code and modularity</span>    args<span class="token punctuation">.</span>device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>                                                           args<span class="token punctuation">.</span>device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span>                       net<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token comment"># recursively convert their parameters and buffers to device specific tensors</span>x <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token comment"># copy your tensors to a device (gpu, cpu)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Datasets-amp-DataLoader"><a href="#Datasets-amp-DataLoader" class="headerlink" title="Datasets &amp; DataLoader"></a>Datasets &amp; DataLoader</h2><blockquote><p>Code for processing data samples can get messy and hard to maintain; we ideally want our dataset code to be decoupled from our model training code for better readability and modularity. PyTorch provides two data primitives: <code>torch.utils.data.DataLoader</code> and <code>torch.utils.data.Dataset</code> that allow you to use pre-loaded datasets as well as your own data. </p></blockquote><p>Dataset ç±»å­˜å‚¨äº†æ•°æ®é›†çš„è·¯å¾„ï¼Œå¹¶ä¸”å®šä¹‰äº† <code>__getitem__</code> æ–¹æ³•æ¥è·å–å•ä¸ªæ•°æ®é›†åŠå…¶å¯¹åº”æ ‡ç­¾ã€‚è€Œ DataLoder åˆ™å°†æ•°æ®é›†æ‰“åŒ…å½¢æˆä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œæ–¹ä¾¿ä¸åŒæ–¹å¼çš„éå†</p><h3 id="è½½å…¥-torchvision-ä¸­çš„æ•°æ®é›†"><a href="#è½½å…¥-torchvision-ä¸­çš„æ•°æ®é›†" class="headerlink" title="è½½å…¥ torchvision ä¸­çš„æ•°æ®é›†"></a>è½½å…¥ torchvision ä¸­çš„æ•°æ®é›†</h3><p>å…ˆä»‹ç»å¦‚ä½•ä» <code>torchvision</code> ä¸­è½½å…¥å®˜æ–¹æ•°æ®é›† <code>Fashion-MNIST</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> torchvision <span class="token keyword">import</span> datasets<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensortraining_data <span class="token operator">=</span> datasets<span class="token punctuation">.</span>FashionMNIST<span class="token punctuation">(</span>    root<span class="token operator">=</span><span class="token string">"data"</span><span class="token punctuation">,</span>    train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>test_data <span class="token operator">=</span> datasets<span class="token punctuation">.</span>FashionMNIST<span class="token punctuation">(</span>    root<span class="token operator">=</span><span class="token string">"data"</span><span class="token punctuation">,</span>    train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>    download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‚æ•°çš„è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li><code>root</code> is the path where the train/test data is stored,</li><li><code>train</code> specifies training or test dataset,</li><li><code>download=True</code> downloads the data from the internet if itâ€™s not available at <code>root</code>.</li><li><code>transform</code> and <code>target_transform</code> specify the feature and label transformations</li></ul><p>ç”¨ <code>matplotlib</code> æ¥å±•ç¤ºæ•°æ®é›†ä¸­çš„éƒ¨åˆ†å›¾åƒï¼Œçœ‹èƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> pltlabels_map <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"T-Shirt"</span><span class="token punctuation">,</span>    <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"Trouser"</span><span class="token punctuation">,</span>    <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"Pullover"</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">"Dress"</span><span class="token punctuation">,</span>    <span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">"Coat"</span><span class="token punctuation">,</span>    <span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">"Sandal"</span><span class="token punctuation">,</span>    <span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">"Shirt"</span><span class="token punctuation">,</span>    <span class="token number">7</span><span class="token punctuation">:</span> <span class="token string">"Sneaker"</span><span class="token punctuation">,</span>    <span class="token number">8</span><span class="token punctuation">:</span> <span class="token string">"Bag"</span><span class="token punctuation">,</span>    <span class="token number">9</span><span class="token punctuation">:</span> <span class="token string">"Ankle Boot"</span><span class="token punctuation">,</span><span class="token punctuation">}</span>figure <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>cols<span class="token punctuation">,</span> rows <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> cols <span class="token operator">*</span> rows <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sample_idx <span class="token operator">=</span> torch<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>training_data<span class="token punctuation">)</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>    img<span class="token punctuation">,</span> label <span class="token operator">=</span> training_data<span class="token punctuation">[</span>sample_idx<span class="token punctuation">]</span>    figure<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> cols<span class="token punctuation">,</span> i<span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>labels_map<span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"off"</span><span class="token punctuation">)</span>    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœå½¢å¦‚ä¸‹é¢çš„å›¾ç‰‡</p><p><img src="/archives/6c437432/sphx_glr_data_tutorial_001.png" style="zoom: 50%;"></p><h3 id="è½½å…¥è‡ªå®šä¹‰æ•°æ®é›†"><a href="#è½½å…¥è‡ªå®šä¹‰æ•°æ®é›†" class="headerlink" title="è½½å…¥è‡ªå®šä¹‰æ•°æ®é›†"></a>è½½å…¥è‡ªå®šä¹‰æ•°æ®é›†</h3><blockquote><p>A custom Dataset class must implement three functions: <code>__init__</code>, <code>__len__</code>, and <code>__getitem__</code>. </p></blockquote><ol><li><p><code>__init__</code></p><p>åˆå§‹åŒ–åŒ…å«å›¾åƒã€æ³¨é‡Šæ–‡ä»¶çš„ç›®å½•ï¼Œä»¥åŠå¯¹æ•°æ®é›†çš„ transform </p></li><li><p><code>__len__</code></p><p>è¿”å›æ•°æ®é›†æ ·æœ¬ä¸ªæ•°</p></li><li><p><code>__getitem__</code></p><p>è¯¥å‡½æ•°è¿”å›æ•°æ®é›†ä¸­ç´¢å¼•ä¸º idx çš„æ ·æœ¬åŠå…¶å¯¹åº”æ ‡ç­¾</p></li></ol><p>ä¸‹é¢é€šè¿‡ä¸€æ®µä»£ç æ¥å…·ä½“çœ‹çœ‹è¿™äº›å‡½æ•°çš„å®ç°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>io <span class="token keyword">import</span> read_image<span class="token keyword">class</span> <span class="token class-name">CustomImageDataset</span><span class="token punctuation">(</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> annotations_file<span class="token punctuation">,</span> img_dir<span class="token punctuation">,</span> transform<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> target_transform<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>img_labels <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>annotations_file<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>img_dir <span class="token operator">=</span> img_dir        self<span class="token punctuation">.</span>transform <span class="token operator">=</span> transform        self<span class="token punctuation">.</span>target_transform <span class="token operator">=</span> target_transform    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>img_labels<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span>        img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>img_dir<span class="token punctuation">,</span> self<span class="token punctuation">.</span>img_labels<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>idx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        image <span class="token operator">=</span> read_image<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>        label <span class="token operator">=</span> self<span class="token punctuation">.</span>img_labels<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">:</span>            image <span class="token operator">=</span> self<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>image<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>target_transform<span class="token punctuation">:</span>            label <span class="token operator">=</span> self<span class="token punctuation">.</span>target_transform<span class="token punctuation">(</span>label<span class="token punctuation">)</span>        <span class="token keyword">return</span> image<span class="token punctuation">,</span> label<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹å‡ºä¸»è¦æ€è·¯å°±æ˜¯ç»§æ‰¿åŸ <code>Dataset</code> ç±»ï¼Œç„¶åæ”¹å†™äº†ä¸Šé¢æåˆ°çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¹Ÿä½“ç°äº†é¢å‘å¯¹è±¡çš„å¤šæ€æ€§</p><h3 id="Transforms"><a href="#Transforms" class="headerlink" title="Transforms"></a>Transforms</h3><blockquote><p> We use <strong>transforms</strong> to perform some manipulation of the data and make it suitable for training. The <a href="https://pytorch.org/vision/stable/transforms.html">torchvision.transforms</a> module offers several commonly-used transforms out of the box.</p></blockquote><p>æ•°æ®å¢å¼ºæ˜¯æå‡è¡¨ç°çš„å¸¸ç”¨æ‰‹æ®µï¼Œå¯ä»¥é€šè¿‡å¯¹æ•°æ®é›†è¿›è¡Œ transform å®Œæˆã€‚æ–‡æ¡£ä¸¾äº†ä¸¤ä¸ªéå¸¸ç®€å•çš„ transform ä¾‹å­ï¼Œæ›´å¤šçš„åº”ç”¨è¿˜æ˜¯éœ€è¦ç»“åˆå…·ä½“è®ºæ–‡å…·ä½“å®è·µï¼š</p><ol><li><a href="https://pytorch.org/vision/stable/transforms.html#torchvision.transforms.ToTensor">ToTensor</a> converts a PIL image or NumPy <code>ndarray</code> into a <code>FloatTensor</code>. and scales the imageâ€™s pixel intensity values in the range [0., 1.]</li><li>Lambda transforms apply any user-defined lambda function. Here, we define a function to turn the integer into a one-hot encoded tensor. </li></ol><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> datasets<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor<span class="token punctuation">,</span> Lambdads <span class="token operator">=</span> datasets<span class="token punctuation">.</span>FashionMNIST<span class="token punctuation">(</span>    root<span class="token operator">=</span><span class="token string">"data"</span><span class="token punctuation">,</span>    train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>    transform<span class="token operator">=</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    target_transform<span class="token operator">=</span>Lambda<span class="token punctuation">(</span><span class="token keyword">lambda</span> y<span class="token punctuation">:</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scatter_<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨-DataLoader-è¿›è¡Œè¿­ä»£"><a href="#ä½¿ç”¨-DataLoader-è¿›è¡Œè¿­ä»£" class="headerlink" title="ä½¿ç”¨ DataLoader è¿›è¡Œè¿­ä»£"></a>ä½¿ç”¨ DataLoader è¿›è¡Œè¿­ä»£</h3><p>å°† dataset ä¼ å…¥ DataLoader å½“ä¸­ï¼Œå½¢æˆå¯è¿­ä»£å¯¹è±¡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoadertrain_dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>training_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æœéœ€è¦æ›´å¤æ‚çš„å–æ ·ï¼Œåˆ™éœ€è¦ <a href="https://pytorch.org/docs/stable/data.html#data-loading-order-and-sampler">Samplers</a>ï¼Œä¸‹é¢ä¸¾ä¸€ä¸ª sampler çš„å­ç±»è¿›è¡Œè¯´æ˜</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sampler <span class="token keyword">import</span> SubsetRandomSamplerNUM_TRAIN <span class="token operator">=</span> <span class="token number">5000</span>sampler <span class="token operator">=</span> SubsetRandomSampler<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>NUM_TRAIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># ä»…é‡‡æ ·å‰ 5000 ä¸ªæ ·æœ¬ä½œä¸ºè®­ç»ƒé›†</span>train_dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>training_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> sampler<span class="token operator">=</span>sampler<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨åˆ›å»ºå¥½ dataloader å®ä¾‹è¿‡åï¼Œç”±äºå…¶æ˜¯è¿­ä»£å™¨å¯¹è±¡ï¼Œä»¥é€šè¿‡å¾ªç¯è¿›è¡Œè¿­ä»£ã€‚è¿­ä»£å™¨è¿”å›å¯¹è±¡ä¸ºä¸€ä¸ªå…ƒç»„ï¼Œå…ƒç»„æˆå‘˜ä¸ºæ•°æ®é›†åˆ—è¡¨å’Œå…¶å¯¹åº”çš„æ ‡ç­¾åˆ—è¡¨ã€‚ä¸‹é¢ç”¨ <code>next &amp; iter</code> æŸ¥çœ‹è¿­ä»£å™¨è¿”å›çš„ç¬¬ä¸€ä¸ªå¯¹è±¡</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">train_features<span class="token punctuation">,</span> train_labels <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>train_dataloader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Feature batch shape: </span><span class="token interpolation"><span class="token punctuation">{</span>train_features<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Labels batch shape: </span><span class="token interpolation"><span class="token punctuation">{</span>train_labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>img <span class="token operator">=</span> train_features<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span>label <span class="token operator">=</span> train_labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">"gray"</span><span class="token punctuation">)</span>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Label: </span><span class="token interpolation"><span class="token punctuation">{</span>label<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># Output</span><span class="token comment"># Feature batch shape: torch.Size([64, 1, 28, 28])</span><span class="token comment"># Labels batch shape: torch.Size([64])</span><span class="token comment"># Label: 9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/6c437432/sphx_glr_data_tutorial_002.png" style="zoom:72%;"></p><h2 id="Build-Models"><a href="#Build-Models" class="headerlink" title="Build Models"></a>Build Models</h2><blockquote><p>Neural networks comprise of layers/modules that perform operations on data. The <a href="https://pytorch.org/docs/stable/nn.html">torch.nn</a> namespace provides all the building blocks you need to build your own neural network. </p><p>Every module in PyTorch subclasses the <a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html">nn.Module</a>. A neural network is a module itself that consists of other modules (layers). This nested structure allows for building and managing complex architectures easily.</p></blockquote><p>å»ºé€ ç½‘ç»œæ¨¡å‹çš„é€»è¾‘ä¸»è¦ä¸ºï¼š</p><ol><li>ç»§æ‰¿ <code>nn.Module</code> ç±»ï¼Œè¿™æ˜¯æ‰€æœ‰ç½‘ç»œçš„åŸºç±»ã€‚è®©è‡ªå®šä¹‰çš„æ¨¡å‹èƒ½å¤Ÿä½¿ç”¨åŸºç±»çš„æ–¹æ³•ï¼Œä¾¿äºç®¡ç†æ¨¡å‹æ¡†æ¶ï¼Œä¾‹å¦‚ï¼šæ‰§è¡Œå‘å‰è·¯å¾„ã€ç®¡ç†æ¨¡å‹å‚æ•°åŠæ¢¯åº¦ã€æ‰“å°æ¨¡å‹æ¨¡å—ã€æ¨¡å‹åµŒå¥—ç­‰ç­‰</li><li>é‡å†™ <code>__init__</code> æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­å®šä¹‰éœ€è¦çš„æ¨¡å—</li><li>é‡å†™ <code>forward</code> æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­å®šä¹‰å‘å‰è®¡ç®—çš„è·¯å¾„</li></ol><p>ä¸‹é¢ä¸¾ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œä¸ºä¾‹ï¼Œçœ‹çœ‹å…·ä½“å®ç°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nndevice <span class="token operator">=</span> <span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Using {} device'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># å®šä¹‰ç½‘ç»œæ¨¡å‹</span><span class="token keyword">class</span> <span class="token class-name">NeuralNetwork</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>flatten <span class="token operator">=</span> nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>linear_relu_stack <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">28</span><span class="token operator">*</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span>x<span class="token punctuation">)</span>         x <span class="token operator">=</span> self<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>        logits <span class="token operator">=</span> self<span class="token punctuation">.</span>linear_relu_stack<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">return</span> logits<span class="token comment"># å°†æ¨¡å‹æ”¾åˆ° GPU ä¸Š </span>model <span class="token operator">=</span> NeuralNetwork<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token comment"># æ‰“å°æ¨¡å‹æ¨¡å—</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model structure: "</span><span class="token punctuation">,</span> model<span class="token punctuation">,</span> <span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Layer: </span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string"> | Size: </span><span class="token interpolation"><span class="token punctuation">{</span>param<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | Values : </span><span class="token interpolation"><span class="token punctuation">{</span>param<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">2]</span><span class="token punctuation">}</span></span><span class="token string"> \n"</span></span><span class="token punctuation">)</span><span class="token comment"># ç®€å•æµ‹è¯•</span>X <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span>logits <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'logits: </span><span class="token interpolation"><span class="token punctuation">{</span>logits<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>pred_probab <span class="token operator">=</span> nn<span class="token punctuation">.</span>Softmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>logits<span class="token punctuation">)</span>y_pred <span class="token operator">=</span> pred_probab<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Predicted class: </span><span class="token interpolation"><span class="token punctuation">{</span>y_pred<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ä¸€äº›æ¨¡å—çš„åŠŸèƒ½å°±ä¸å†è¿™é‡Œé‡Œæè¿°äº†ï¼Œä¾‹å¦‚ï¼š<code>nn.Sequential, nn.Flatten</code>ï¼Œè¯·ç›´æ¥å‚è€ƒ <a href="https://pytorch.org/tutorials/beginner/basics/buildmodel_tutorial.html#build-the-neural-network">æ–‡æ¡£</a></p><h2 id="Automatic-Differentiation"><a href="#Automatic-Differentiation" class="headerlink" title="Automatic Differentiation"></a>Automatic Differentiation</h2><blockquote><p>To compute those gradients, PyTorch has a built-in differentiation engine called <code>torch.autograd</code>. It supports automatic computation of gradient for any computational graph.</p></blockquote><p>å®é™…ä¸Šåœ¨è‡ªå·±å†™ä»£ç æ—¶ï¼Œå¹¶æ²¡æœ‰æ˜¾å¼åœ°è°ƒç”¨ <code>torch.autograd</code>ï¼Œè¿™ä¸ªæ¨¡å—æ›´å¤šåœ°æ˜¯åšèƒŒååŠŸè‡£ã€‚åœ¨äº†è§£è‡ªåŠ¨å¾®åˆ†ä¹‹å‰ï¼Œéœ€è¦äº†è§£å¦‚ä½•ä½¿ç”¨åå‘ä¼ æ’­ç®—æ³•æ¥ç³»ç»Ÿåœ°è®¡ç®—å‚æ•°çš„æ¢¯åº¦ã€‚åå‘ä¼ æ’­ç®—æ³•çš„æ ¸å¿ƒå°±åœ¨äºï¼šé€šè¿‡è®¡ç®—å›¾å’Œå‘å‰è®¡ç®—æ—¶å­˜å‚¨çš„ä¸­é—´ç»“æœï¼Œä» root (æ ¹èŠ‚ç‚¹) è®¡ç®—åˆ° leaf (å¶èŠ‚ç‚¹)ï¼Œåå‘é€å±‚å¾—åˆ°å„ä¸ªèŠ‚ç‚¹çš„æ¢¯åº¦ã€‚äº†è§£åå‘ä¼ æ’­ç®—æ³•ï¼Œå®˜æ–¹æ–‡æ¡£ä¹Ÿæ¨èäº† <a href="https://www.bilibili.com/video/BV16x411V7Qg?from=search&amp;seid=15593528008565591695&amp;spm_id_from=333.337.0.0">3Blue1Brown è§†é¢‘</a>ï¼Œ3b1b nbï¼</p><h3 id="è‡ªåŠ¨å¾®åˆ†"><a href="#è‡ªåŠ¨å¾®åˆ†" class="headerlink" title="è‡ªåŠ¨å¾®åˆ†"></a>è‡ªåŠ¨å¾®åˆ†</h3><p>ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­æ¥å®ç°ç®€å•çš„è‡ªåŠ¨å¾®åˆ†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token comment"># ä½¿ç”¨éšæœºç§å­</span>torch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span><span class="token number">1998</span><span class="token punctuation">)</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># input tensor</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># expected output</span>w <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>b <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>z <span class="token operator">=</span> torch<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x<span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token operator">+</span>bloss <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>binary_cross_entropy_with_logits<span class="token punctuation">(</span>z<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥ä¸Šæ„å»ºäº†ä¸€ä¸ªç®€å•çš„è®¡ç®—æµç¨‹ï¼Œå°†éœ€è¦è®¡ç®—çš„æ¢¯åº¦çš„å‚æ•°è®¾ä¸º <code>requires_grad=True</code>ï¼Œæˆ–è€…ç”¨ <code>x.requires_grad_(True)</code>ï¼Œè¯´æ˜ä¸€ä¸‹ï¼šæ–¹æ³•ååç¼€å¸¦ä¸‹åˆ’çº¿ <code>_</code> åˆ™ä»£è¡¨è¯¥æ–¹æ³•ä¸º <code>in place</code> æ–¹æ³•ï¼Œä¼šç›´æ¥ä¿®æ”¹å˜é‡ </p><p>ç”¨å…¬å¼æ¥è¡¨ç¤ºä»¥ä¸Šçš„è®¡ç®—è¿‡ç¨‹</p><script type="math/tex; mode=display">z = x * w + b \\loss = -\frac{1}{N}\sum{y_i*ln(\sigma(z_i)) + (1-y_i)*ln(1 - \sigma(z_i))}</script><p>ç”¨è®¡ç®—å›¾è¡¨ç¤ºä»¥ä¸Šçš„è®¡ç®—è¿‡ç¨‹</p><p><img src="/archives/6c437432/comp-graph.png" style="zoom: 50%;"></p><p>å¯ä»¥çœ‹åˆ° tensor åœ¨è®¡ç®—è¿‡ç¨‹ä¸­åœ¨ä¸æ–­ç”Ÿæˆè®¡ç®—å›¾</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment"># tensor([1., 1., 1., 1., 1.])</span><span class="token keyword">print</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token comment"># tensor([-2.9086,  0.8690,  1.4758], grad_fn=&lt;AddBackward0&gt;)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸º z æ˜¯è®¡ç®—å¾—åˆ°çš„ tensorï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸­è¿˜åŒ…å«ä¸€ä¸ª <code>grad_fn</code>ï¼Œè¿™æ˜¯ pytorch ä¸­ <code>Function</code> ç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥æŠŠå…¶çœ‹ä½œè®¡ç®—å›¾çš„å…·ä½“å®ç°ã€‚æ¥ä¸‹æ¥åªéœ€è¦ä¸€è¡Œä»£ç ï¼Œå°±å¯ä»¥è®¡ç®—è®¡ç®—å›¾ä¸­æ‰€æœ‰éœ€è¦çš„æ¢¯åº¦</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>grad<span class="token punctuation">)</span><span class="token comment"># tensor([0.0172, 0.2348, 0.2713])</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ol><li><p>æ¯ä¸ªè®¡ç®—å›¾åªèƒ½è®¡ç®—ä¸€æ¬¡ï¼Œä¹‹åæ‰€æœ‰çš„ä¸­é—´ç»“æœå°†ä¼šè¢«æ¸…é™¤ï¼Œä½†å¯ä»¥ä½¿ç”¨ <code>loss.backward(retain_graph=True)</code> ä¿ç•™ä¸­é—´ç»“æœï¼Œä¸¾ä¸ªç®€å•ä¾‹å­è¯´æ˜ï¼ˆä»¥ä¸‹ä¾‹å­å‡æ²¿ç”¨ä¹‹å‰è‡ªåŠ¨å¾®åˆ†ä¾‹å­ä¸­çš„å˜é‡ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ç¬¬ä¸€æ¬¡ loss åå‘ä¼ æ’­è®¡ç®—æ¢¯åº¦</span>loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># åŸºäº loss åˆ›å»ºä¸€ä¸ªæ–°çš„ loss_2</span>loss_2  <span class="token operator">=</span> loss <span class="token operator">**</span> <span class="token number">2</span>loss_2<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># åœ¨ç¬¬äºŒæ¬¡åå‘ä¼ æ’­è®¡ç®—ä¸­ï¼Œæ˜¾ç„¶ä¼šé‡æ–°è¿›è¡Œç¬¬ä¸€æ¬¡çš„åå‘ä¼ æ’­çš„è®¡ç®—æµç¨‹</span><span class="token comment"># RuntimeError: Trying to backward through the graph a second time, but the buffers have already been freed. Specify retain_graph=True when calling backward the first time.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä¸€èˆ¬åªå¯¹æ ‡é‡è¿›è¡Œ <code>backward</code> æ“ä½œã€‚å¯¹çŸ¢é‡è¿›è¡Œ <code>backward</code> æ“ä½œï¼Œå³å¯¹çŸ¢é‡è¿›è¡Œæ±‚å¯¼ï¼Œä¼šå¾—åˆ°é›…å¯æ¯”çŸ©é˜µ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># w.shape=(5, 3) w.requires_grad=True</span>z <span class="token operator">=</span> w <span class="token operator">**</span> <span class="token number">2</span>z<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># RuntimeError: grad can be implicitly created only for scalar outputs</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹äºä¸­é—´å˜é‡ï¼ˆå³éå¶èŠ‚ç‚¹å˜é‡ï¼‰ï¼Œç”±äºåœ¨åå‘ä¼ æ’­æ—¶éœ€è¦è®¡ç®—å…¶æ¢¯åº¦ï¼Œåœ¨è‡ªåŠ¨å¾®åˆ†æ—¶ä¼šæ ‡è®°å…¶ <code>requires_grad=True</code>ï¼Œä½†ä¸€èˆ¬åœ¨åå‘ä¼ æ’­è®¡ç®—å®Œæˆä¹‹åï¼Œä¸ä¿ç•™è¿™äº›ä¸­é—´ç»“æœçš„æ¢¯åº¦ï¼Œå¦‚éœ€è¦åˆ™è¦è°ƒç”¨æ–¹æ³• <code>x.retain_grad()</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># z.retain_grad()</span>loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span>grad<span class="token punctuation">)</span><span class="token comment"># warnings.warn("The .grad attribute of a Tensor that is not a leaf Tensor is being accessed. Its .grad "</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="ç¦ç”¨è‡ªåŠ¨å¾®åˆ†"><a href="#ç¦ç”¨è‡ªåŠ¨å¾®åˆ†" class="headerlink" title="ç¦ç”¨è‡ªåŠ¨å¾®åˆ†"></a>ç¦ç”¨è‡ªåŠ¨å¾®åˆ†</h3><p>ç¦ç”¨è‡ªåŠ¨å¾®åˆ†ä¸»è¦åº”ç”¨åœ¨ä¸¤ä¸ªåœºæ™¯ï¼š</p><ol><li>Freeze parametersï¼Œå°†å‚æ•°ä»è®¡ç®—å›¾ä¸­å‰”é™¤ï¼Œgradient flow ä¸ä¼šç»è¿‡è¯¥å‚æ•°</li><li>ä»…è®¡ç®—å‘å‰è·¯å¾„ï¼Œä¸è·Ÿè¸ªæ‰€æœ‰æ¢¯åº¦ï¼ŒåŠ å¿«è®¡ç®—</li></ol><p>é’ˆå¯¹ä»¥ä¸Šçš„åœºæ™¯ï¼Œæœ‰ä¸¤ç§æ–¹æ³•èƒ½å¤Ÿç¦ç”¨è‡ªåŠ¨å¾®åˆ†ï¼š</p><ol><li><code>x.detach_()</code>ï¼šå°† x å˜é‡ <code>requires_grad=False</code></li><li><code>with torch.no_grad()</code>ï¼šåœ¨è¯¥æ¨¡å—å†…çš„æ‰€æœ‰è¿ç®—ï¼Œéƒ½ä¸ä¼šè·Ÿè¸ªè®¡ç®—å›¾ï¼Œå³æ‰€æœ‰å˜é‡ <code>requires_grad=False</code></li></ol><p>ä¸‹é¢ä»…å¯¹ <code>detach</code> æ–¹æ³•è¿›è¡Œé‡ç‚¹è¯´æ˜</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># detach</span><span class="token keyword">import</span> torchmode <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'no_detach'</span><span class="token punctuation">,</span> <span class="token string">'detach'</span><span class="token punctuation">]</span><span class="token keyword">for</span> mode_ <span class="token keyword">in</span> mode<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'MODE: </span><span class="token interpolation"><span class="token punctuation">{</span>mode_<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    y <span class="token operator">=</span> x <span class="token operator">**</span> <span class="token number">2</span>    z <span class="token operator">=</span> x <span class="token operator">**</span> <span class="token number">3</span>    <span class="token keyword">if</span> mode_ <span class="token operator">==</span> <span class="token string">'detach'</span><span class="token punctuation">:</span>        z<span class="token punctuation">.</span>detach_<span class="token punctuation">(</span><span class="token punctuation">)</span>    loss <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token operator">+</span>z<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'parameter z:\n</span><span class="token interpolation"><span class="token punctuation">{</span>z<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'x_grad:\n</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">''' resultMODE: no_detachparameter z:tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1.], grad_fn=&lt;PowBackward0&gt;)x_grad:tensor([5., 5., 5., 5., 5., 5., 5., 5., 5., 5.]) MODE: detachparameter z:tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1.])x_grad:tensor([2., 2., 2., 2., 2., 2., 2., 2., 2., 2.])  '''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å°† b èŠ‚ç‚¹ä»è®¡ç®—å›¾ä¸­å‰”é™¤ä¹‹åï¼Œx çš„æ¢¯åº¦å‡å°‘äº†ï¼Œå› ä¸º gradient flow ä¸ä» b èŠ‚ç‚¹æµè¿‡ï¼Œå‰åè®¡ç®—å›¾å¦‚ä¸‹</p><p><img src="/archives/6c437432/attached.png" alt="attached graph" style="zoom: 67%;"></p><p><img src="/archives/6c437432/detached.png" alt="detached graph" style="zoom:67%;"></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯åœ¨è®¡ç®—å›¾å»ºç«‹ä¹‹åï¼Œå¯¹å˜é‡è¿›è¡Œ detach å¹¶ä¸ä¼šå½±å“åå‘ä¼ æ’­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torchx <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>y <span class="token operator">=</span> x <span class="token operator">**</span> <span class="token number">2</span>z <span class="token operator">=</span> x <span class="token operator">**</span> <span class="token number">3</span>loss <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token operator">+</span>z<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'parameter z:\n</span><span class="token interpolation"><span class="token punctuation">{</span>z<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token comment"># tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1.], grad_fn=&lt;PowBackward0&gt;)</span>z<span class="token punctuation">.</span>detach_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'parameter z_detached:\n</span><span class="token interpolation"><span class="token punctuation">{</span>z<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token comment">#tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1.])</span>loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'x_grad:\n</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token comment"># tensor([5., 5., 5., 5., 5., 5., 5., 5., 5., 5.]) </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘çš„ç†è§£æ˜¯è®¡ç®—å›¾åœ¨æ„å»ºå®Œæˆä¹‹åï¼Œä»…è¿›è¡Œ detach ä¸ä¼šå¯¹å·²ç»ç”Ÿæˆçš„è®¡ç®—å›¾è¿›è¡Œä¿®æ”¹ï¼Œä¸” tensor æœ¬èº«çš„å€¼æ²¡æœ‰å‘ç”Ÿæ”¹ï¼Œè®¡ç®—å›¾å°±å¯ä»¥ä½¿ç”¨è¯¥å€¼è¿›è¡Œæ¢¯åº¦è®¡ç®—ã€‚è€Œä¹‹å‰çš„ for å¾ªç¯æ¯ä¸€æ¬¡å¾ªç¯éƒ½é‡æ–°åˆ›å»ºäº†è®¡ç®—å›¾</p><h2 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h2><p>è¿™é‡Œå°†æ˜¯æ•´ä¸ªæ·±åº¦å­¦ä¹ è€—æ—¶æœ€é•¿çš„éƒ¨åˆ†ï¼Œéœ€è¦å°†ä¹‹å‰çš„æ•°æ®é›†é€å…¥åˆ°æ¨¡å‹ä¹‹ä¸­ï¼Œä½¿ç”¨ä¼˜åŒ–ç®—æ³•æ”¹è¿›æ¨¡å‹ã€‚è¿™ä¸€éƒ¨åˆ†æ²¿ç”¨ä¹‹å‰çš„ <code>Fashion-MNIST</code> æ•°æ®é›†å’Œç¥ç»ç½‘ç»œï¼Œå®Œæ•´ä»£ç å‚è€ƒ <a href="https://pytorch.org/tutorials/beginner/basics/optimization_tutorial.html#prerequisite-codehttps://pytorch.org/tutorials/beginner/basics/optimization_tutorial.html#prerequisite-code">prerequisite code</a></p><h3 id="ä¼˜åŒ–å¾ªç¯"><a href="#ä¼˜åŒ–å¾ªç¯" class="headerlink" title="ä¼˜åŒ–å¾ªç¯"></a>ä¼˜åŒ–å¾ªç¯</h3><p>åœ¨æ•´ä¸ªå¾ªç¯è¿‡ç¨‹ä¸­ï¼Œé™¤äº†ä¹‹å‰æåˆ°çš„æ•°æ®é›†å’Œæ¨¡å‹ï¼Œè¿˜æœ‰ä¸¤ä¸ªé‡è¦å…ƒç´ ï¼šæŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨ã€‚Pytorch ä¸­çš„æŸå¤±å‡½æ•°åœ¨ <code>nn</code> æ¨¡å—ä¸‹ï¼Œä¼˜åŒ–å™¨åœ¨ <code>optim</code> æ¨¡å—ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optimloss_fn <span class="token operator">=</span> nn<span class="token punctuation">.</span>X<span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># where X is L1Loss, MSELoss, CrossEntropyLoss...</span>opt <span class="token operator">=</span> optim<span class="token punctuation">.</span>X<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>      <span class="token comment"># where X is SGD, Adadelta, Adagrad, Adam...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ•´ä½“çš„ä¼˜åŒ–é€»è¾‘åˆ†ä¸ºä¸¤æ­¥ï¼Œé¦–å…ˆä½¿ç”¨åå‘ä¼ æ’­ç®—æ³•è®¡ç®—å‡ºå‚æ•°çš„æ¢¯åº¦ï¼Œç„¶åæ ¹æ®è¿™äº›æ¢¯åº¦é‡‡ç”¨ä¸åŒçš„ä¼˜åŒ–ç®—æ³•è¿›è¡Œè¿­ä»£ä¼˜åŒ– <code>opt.step()</code> ã€‚ä¸‹é¢çš„ä»£ç å®ç°äº† <code>train_loop</code> å’Œ <code>test_loop</code> åˆ†åˆ«å®ç°è®­ç»ƒå’Œæµ‹è¯•æ¨¡å‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">train_loop</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_fn<span class="token punctuation">,</span> optimizer<span class="token punctuation">)</span><span class="token punctuation">:</span>    size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>    <span class="token keyword">for</span> batch<span class="token punctuation">,</span> <span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># Compute prediction and loss</span>        pred <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        loss <span class="token operator">=</span> loss_fn<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span>        <span class="token comment"># Backpropagation</span>        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> batch <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            loss<span class="token punctuation">,</span> current <span class="token operator">=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> batch <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"loss: </span><span class="token interpolation"><span class="token punctuation">{</span>loss<span class="token punctuation">:</span><span class="token format-spec">&gt;7f</span><span class="token punctuation">}</span></span><span class="token string">  [</span><span class="token interpolation"><span class="token punctuation">{</span>current<span class="token punctuation">:</span><span class="token format-spec">&gt;5d</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>size<span class="token punctuation">:</span><span class="token format-spec">&gt;5d</span><span class="token punctuation">}</span></span><span class="token string">]"</span></span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test_loop</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_fn<span class="token punctuation">)</span><span class="token punctuation">:</span>    size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>    num_batches <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>dataloader<span class="token punctuation">)</span>    test_loss<span class="token punctuation">,</span> correct <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>    <span class="token comment"># Will not build computational graph</span>    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> dataloader<span class="token punctuation">:</span>            pred <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span>            test_loss <span class="token operator">+=</span> loss_fn<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>            correct <span class="token operator">+=</span> <span class="token punctuation">(</span>pred<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>    test_loss <span class="token operator">/=</span> num_batches    correct <span class="token operator">/=</span> size    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Test Error: \n Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">*</span>correct<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">&gt;0.1f</span><span class="token punctuation">}</span></span><span class="token string">%, Avg loss: </span><span class="token interpolation"><span class="token punctuation">{</span>test_loss<span class="token punctuation">:</span><span class="token format-spec">&gt;8f</span><span class="token punctuation">}</span></span><span class="token string"> \n"</span></span><span class="token punctuation">)</span>model <span class="token operator">=</span> NeuralNetwork<span class="token punctuation">(</span><span class="token punctuation">)</span>    loss_fn <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>learning_rate <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">3</span>optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>epochs <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Epoch </span><span class="token interpolation"><span class="token punctuation">{</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">\n-------------------------------"</span></span><span class="token punctuation">)</span>    train_loop<span class="token punctuation">(</span>train_dataloader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_fn<span class="token punctuation">,</span> optimizer<span class="token punctuation">)</span>    test_loop<span class="token punctuation">(</span>test_dataloader<span class="token punctuation">,</span> model<span class="token punctuation">,</span> loss_fn<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Done!"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆç»“æœä¹Ÿè¯·ç›´æ¥æŸ¥çœ‹ <a href="https://pytorch.org/tutorials/beginner/basics/optimization_tutorial.html#optimization-loop">optimization loop</a></p><h2 id="Save-and-Load-the-Model"><a href="#Save-and-Load-the-Model" class="headerlink" title="Save and Load the Model"></a>Save and Load the Model</h2><h3 id="ä¿å­˜æ¨¡å‹å‚æ•°"><a href="#ä¿å­˜æ¨¡å‹å‚æ•°" class="headerlink" title="ä¿å­˜æ¨¡å‹å‚æ•°"></a>ä¿å­˜æ¨¡å‹å‚æ•°</h3><p>æ¨¡å‹çš„å‚æ•°å­˜å‚¨åœ¨å…¶å†…éƒ¨çš„ä¸€ä¸ªå­—å…¸å½“ä¸­ï¼Œä½¿ç”¨ <code>model.state_dict()</code> æ–¹æ³•å¯ä»¥è¿”å›è¯¥å­—å…¸ã€‚ä½¿ç”¨ <code>torch.save</code> æ–¹æ³•å³å¯å­˜å‚¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>models <span class="token keyword">as</span> modelsmodel <span class="token operator">=</span> models<span class="token punctuation">.</span>vgg16<span class="token punctuation">(</span>pretrained<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'model_weights.pth'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±å°†æ¨¡å‹å‚æ•°ä¿å­˜åˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚æœéœ€è¦åŠ è½½æ¨¡å‹å‚æ•°ï¼Œåˆ™å¿…é¡»è¦å…ˆåˆ›å»ºä¸€ä¸ªæ¨¡å‹å®ä¾‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">model <span class="token operator">=</span> models<span class="token punctuation">.</span>vgg16<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># we do not specify pretrained=True, i.e. do not load default weights</span>model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'model_weights.pth'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„ï¼š</strong>ä¸€å®šè¦åœ¨æ¨ç†ä¹‹å‰è°ƒç”¨ <code>model.eval()</code> æ–¹æ³•ï¼Œä»¥å°† dropout å’Œ batch_norm å±‚è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ã€‚ä¸è¿™æ ·åšä¼šäº§ç”Ÿä¸ä¸€è‡´çš„æ¨ç†ç»“æœ</p><h3 id="ä¿å­˜æ¨¡å‹å‚æ•°åŠå…¶ç»“æ„"><a href="#ä¿å­˜æ¨¡å‹å‚æ•°åŠå…¶ç»“æ„" class="headerlink" title="ä¿å­˜æ¨¡å‹å‚æ•°åŠå…¶ç»“æ„"></a>ä¿å­˜æ¨¡å‹å‚æ•°åŠå…¶ç»“æ„</h3><p>å¦‚æœæƒ³è¦åŒæ—¶ä¿å­˜å…¶ç»“æ„ï¼Œåˆ™ç›´æ¥ä¼ å…¥æ¨¡å‹æœ¬èº«</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">'model.pth'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åŠ è½½æ¨¡å‹è™½ç„¶ä¸éœ€è¦å…ˆå®ä¾‹åŒ–æ¨¡å‹ï¼Œä½†ä»éœ€è¦æœ‰æ¨¡å‹çš„å®šä¹‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Model class must be defined somewhere</span>model <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'model.pth'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="æ¨¡å‹å¯¼å‡ºä¸º-ONNX"><a href="#æ¨¡å‹å¯¼å‡ºä¸º-ONNX" class="headerlink" title="æ¨¡å‹å¯¼å‡ºä¸º ONNX"></a>æ¨¡å‹å¯¼å‡ºä¸º ONNX</h3><blockquote><p><strong>ONNX is an open format built to represent machine learning models.</strong> ONNX defines a common set of operators - the building blocks of machine learning and deep learning models - and a common file format to enable AI developers to use models with a variety of frameworks, tools, runtimes, and compilers.</p></blockquote><p>Pytorch æ”¯æŒå°†æ¨¡å‹è½¬ä¸º ONNX æ ¼å¼ï¼Œæ›´å¤šä¿¡æ¯å°±ä¸æ‰“ç®—æ•´ç†äº† <a href="https://pytorch.org/tutorials/beginner/basics/saveloadrun_tutorial.html#exporting-model-to-onnx">Exporting Model to ONNX</a> <a href="https://github.com/onnx/tutorials">ONNX tutorial</a></p><h2 id="æ•´ä½“å¤ä¹ "><a href="#æ•´ä½“å¤ä¹ " class="headerlink" title="æ•´ä½“å¤ä¹ "></a>æ•´ä½“å¤ä¹ </h2><blockquote><p>Congratulations! You have completed the PyTorch beginner tutorial! Try <a href="https://pytorch.org/tutorials/beginner/basics/quickstart_tutorial.html">revisting the first page</a> to see the tutorial in its entirety again. We hope this tutorial has helped you get started with deep learning on PyTorch. Good luck!</p></blockquote><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>æ ¹æ®è‡ªå·±åœ¨å®è·µä¸­é‡åˆ°çš„ torch å¸¸ç”¨æ“ä½œæ€»ç»“ï¼Œtorch é‡Œé¢ä¹ æƒ¯ä½¿ç”¨ <code>dim=</code> è€Œä¸æ˜¯ <code>axis=</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torchtorch<span class="token punctuation">.</span>eye<span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment"># n rows, m col</span>torch<span class="token punctuation">.</span>nonzero<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span class="token comment"># return a 2D tensor (N, input.shape)</span>torch<span class="token punctuation">.</span>where<span class="token punctuation">(</span>condition<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>torch<span class="token punctuation">.</span>clamp<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> <span class="token builtin">sum</span><span class="token punctuation">)</span><span class="token comment"># return a tuple (tensor, LongTensor)</span>torch<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token comment"># x is a tensor</span>x<span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token operator">*</span>sizes<span class="token punctuation">)</span><span class="token comment"># repeat times</span>x<span class="token punctuation">.</span>expand<span class="token punctuation">(</span><span class="token operator">*</span>sizes<span class="token punctuation">)</span><span class="token comment"># expand to sizes</span>x<span class="token punctuation">.</span>contigous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># è¿ç»­ç©ºé—´</span>x<span class="token punctuation">.</span>repeat_interleave<span class="token punctuation">(</span>tensor<span class="token punctuation">)</span><span class="token comment"># numpy.repeat()</span><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> FF<span class="token punctuation">.</span>interpolate<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token punctuation">)</span>F<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>LongTensor<span class="token punctuation">,</span> num_classes<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Pytorch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿™æœ¬ä¹¦èƒ½è®©ä½ ç¡å¥½</title>
      <link href="/archives/dead6afd.html"/>
      <url>/archives/dead6afd.html</url>
      
        <content type="html"><![CDATA[<h1 id="è¿™æœ¬ä¹¦èƒ½è®©ä½ ç¡å¥½"><a href="#è¿™æœ¬ä¹¦èƒ½è®©ä½ ç¡å¥½" class="headerlink" title="è¿™æœ¬ä¹¦èƒ½è®©ä½ ç¡å¥½"></a>è¿™æœ¬ä¹¦èƒ½è®©ä½ ç¡å¥½</h1><p>æ€»ä½“æ¥è®²åˆ†ä¸ºå‡ ä¸ªå¤§æ–¹é¢ï¼šç¡çœ è§‚å¿µï¼Œç¡çœ å’Œé”»ç‚¼çš„æ—¶é—´ï¼Œå…‰çº¿å½±å“ï¼Œé¥®é£Ÿå½±å“ï¼Œæ¸©åº¦å½±å“ï¼Œèº«å¿ƒæ”¾æ¾æŠ€å·§</p><h2 id="ç¬¬ä¸€ç« -äº†è§£ç¡çœ çš„ä»·å€¼ï¼ˆè§‚å¿µï¼‰"><a href="#ç¬¬ä¸€ç« -äº†è§£ç¡çœ çš„ä»·å€¼ï¼ˆè§‚å¿µï¼‰" class="headerlink" title="ç¬¬ä¸€ç«  äº†è§£ç¡çœ çš„ä»·å€¼ï¼ˆè§‚å¿µï¼‰"></a>ç¬¬ä¸€ç«  äº†è§£ç¡çœ çš„ä»·å€¼ï¼ˆè§‚å¿µï¼‰</h2><p>æ°¸è¿œè®°ä½å¤±çœ çš„ä»·å€¼ã€‚å½“è·å¾—å¿…é¡»çš„ç¡çœ ï¼Œä½ ä¼šè¡¨ç°å¾—æ›´å‡ºè‰²ï¼Œåšå‡ºæ›´æ˜æ™ºçš„å†³å®šï¼Œæ‹¥æœ‰æ›´å¥åº·çš„èº«ä½“ã€‚ç¡çœ ä¸æ˜¯æˆ‘ä»¬éœ€è¦é€¾è¶Šçš„éšœç¢ï¼Œå®ƒæ˜¯ä¸€ç§èº«ä½“æ‰€éœ€çš„è‡ªç„¶çŠ¶æ€ï¼Œå¯ä»¥å¢å¼ºæ¿€ç´ ä½œç”¨ï¼Œæ²»æ„ˆè‚Œè‚‰ã€ç»„ç»‡å’Œå™¨å®˜ï¼Œè®©èº«ä½“å…å—ç–¾ç—…ä¾µå®³ï¼Œè®©ç†æ™ºè¾¾åˆ°æœ€ä¼˜æ°´å¹³ã€‚é‡æ–°è°ƒé…ä½ çš„ç¡çœ ï¼Œä¸è¦æŠŠç¡çœ è§†ä¸ºéœ€è¦å…‹æœçš„éšœç¢ï¼ŒæŠŠç¡çœ çœ‹æˆå¯¹è‡ªå·±çš„ç‰¹æ®Šæ¬¾å¾…ï¼</p><h2 id="ç¬¬äºŒç« -ç™½å¤©å¤šæ™’å¤ªé˜³ï¼ˆå…‰çº¿ï¼‰"><a href="#ç¬¬äºŒç« -ç™½å¤©å¤šæ™’å¤ªé˜³ï¼ˆå…‰çº¿ï¼‰" class="headerlink" title="ç¬¬äºŒç«  ç™½å¤©å¤šæ™’å¤ªé˜³ï¼ˆå…‰çº¿ï¼‰"></a>ç¬¬äºŒç«  ç™½å¤©å¤šæ™’å¤ªé˜³ï¼ˆå…‰çº¿ï¼‰</h2><p>æ™¨å…‰æ˜¯å¦‚ä½•æ”¹å–„ç¡çœ çš„å‘¢ï¼Ÿå…‰çº¤å…¶å®æ˜¯åœ¨å‘ä¿¡å·ç»™ä¸‹ä¸˜è„‘åŠæ‰€æœ‰ç›¸å…³å™¨å®˜å’Œè…ºä½“ï¼Œæé†’å®ƒä»¬è¯¥é†’äº†ã€‚æœ€è¿‘ï¼Œä¸€é¡¹ç ”ç©¶è€ƒå¯Ÿäº†æ—¥ç­åŠå…¬å®¤äººå‘˜çš„ç¡çœ è´¨é‡ï¼Œç›¸æ¯”ç›´æ¥é çª—çš„äººå‘˜ï¼Œä¸é çª—äººå‘˜æ¥æ”¶çš„è‡ªç„¶å…‰ä¼šå°‘173%ï¼Œå¹¶å› æ­¤å¹³å‡æ²¡æ™šå°‘ç¡46åˆ†é’Ÿã€‚æƒ³è¦è·å¾—å®Œç¾çš„ç¡çœ ï¼Œè¤ªé»‘ç´ çœŸå®æ‰®æ¼”è€…æ˜æ˜Ÿçº§çš„è§’è‰²ã€‚è¤ªé»‘ç´ æ˜¯ç”±äººä½“ä¸­çš„æ¾æœè…ºå’Œå…¶ä»–ç»„ç»‡ç”Ÿæˆçš„ï¼Œå½“å®¤å¤–å˜æš—æ—¶ï¼Œèº«ä½“å°±ä¼šè‡ªç„¶åˆ†æ³Œè¤ªé»‘ç´ ã€‚ä½†æ˜¯å¦‚æœä¸èƒ½åœ¨æ­£ç¡®çš„æ—¶é—´è·å¾—é€‚å½“çš„å…‰çº¿ï¼Œæˆ‘ä»¬çš„èº«ä½“å°±ä¼šå‡ºç°é—®é¢˜ã€‚çš®è´¨é†‡å’Œè¤ªé»‘ç´ ç®—æ˜¯å‘ˆä½ ç›¸å…³çš„ä¸€å¯¹æ¿€ç´ ã€‚ç™½å¤©æ¥æ”¶é˜³å…‰ç…§å°„ä¹‹æ‰€ä»¥é‡è¦ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› æ˜¯å¯ä»¥åˆºæ¿€çš®è´¨é†‡çš„ç”Ÿæˆã€‚è·å¾—æ›´å¤šé˜³å…‰ç…§å°„ï¼Œå¯ä»¥ä¸ºæ­£å¸¸çš„çš®è´¨é†‡èŠ‚å¾‹å’Œè¤ªé»‘ç´ èŠ‚å¾‹æ§åˆ¶èŠ‚å¥ã€‚é˜³å…‰ä¸­å«æœ‰è®¸å¤šå½±å“èº«ä½“çš„æ³¢é•¿ï¼Œæˆ‘ä»¬æœ€éœ€è¦äº†è§£UVAå’ŒUVBï¼ŒUVä»£è¡¨ç´«å¤–çº¿ï¼Œå¯¹UVAçš„ä¸å¥åº·æ¥è§¦ä¹Ÿæ˜¯ä¸è¡Œçš„(ä¾‹å¦‚å¤ªé˜³æš´æ™’)ï¼ŒUVBå¯¹äººä½“å¥åº·çš„ä»·å€¼æœ€å¤§ï¼Œå› ä¸ºå®ƒæ˜¯å”¯ä¸€ä¼šåˆºæ¿€äººä½“ç”Ÿæˆç»´ç”Ÿç´ Dçš„æ³¢é•¿ã€‚</p><h2 id="ç¬¬ä¸‰ç« -ç¡å‰è¿œç¦»ç”µå­å±å¹•ï¼ˆå…‰çº¿ï¼‰"><a href="#ç¬¬ä¸‰ç« -ç¡å‰è¿œç¦»ç”µå­å±å¹•ï¼ˆå…‰çº¿ï¼‰" class="headerlink" title="ç¬¬ä¸‰ç«  ç¡å‰è¿œç¦»ç”µå­å±å¹•ï¼ˆå…‰çº¿ï¼‰"></a>ç¬¬ä¸‰ç«  ç¡å‰è¿œç¦»ç”µå­å±å¹•ï¼ˆå…‰çº¿ï¼‰</h2><p>æƒ³è¦ç«‹åˆ»æ”¹å–„ç¡çœ ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å‡å°‘æ™šé—´çœ‹ç”µå­å±å¹•çš„æ—¶é—´ã€‚è“å…‰ä¼šä¸¥é‡å½±å“ç¡çœ ï¼Œå› ä¸ºä¼šåˆºæ¿€äººä½“ç”Ÿæˆæ›´å¤šçš„ç™½å¤©æ¿€ç´ ï¼Œè¯¯å¯¼åŸæœ¬å‡†å¤‡ç¡è§‰çš„äººã€‚æˆ‘ä»¬ä½¿ç”¨ç”µå­è®¾å¤‡çš„æ–‡åŒ–ä¼ ç»Ÿä¸è¿‡åˆšåˆšå‡ åå¹´ï¼Œåœ¨å‡ ç™¾ä¸‡å¹´çš„è¿›åŒ–å†ç¨‹ä¸å‡ åå¹´ç†¬å¤œä¹ æƒ¯çš„å¯¹æŠ—ä¸­ï¼Œæˆ‘ä»¬çš„èƒ½åŠ›ä¹Ÿæ²¡è¿›åŒ–å¾—å¿«é€‚åº”ã€‚å¦‚æœä½ æƒ³æ ¹æ®èº«ä½“éœ€æ±‚ï¼Œè¿›å…¥æ·±åº¦ç¡çœ ï¼Œåœ¨ç¡å‰90åˆ†é’Ÿï¼Œä½ è¦å…³é—­æ‰€æœ‰å±å¹•ï¼Œè®©è¤ªé»‘ç´ æ¿€ç´ å’Œçš®è´¨é†‡æ°´å¹³å›å¤æ­£å¸¸ã€‚</p><h2 id="ç¬¬å››ç« -å»ºç«‹å’–å•¡å› å®µç¦ï¼ˆé¥®é£Ÿï¼‰"><a href="#ç¬¬å››ç« -å»ºç«‹å’–å•¡å› å®µç¦ï¼ˆé¥®é£Ÿï¼‰" class="headerlink" title="ç¬¬å››ç«  å»ºç«‹å’–å•¡å› å®µç¦ï¼ˆé¥®é£Ÿï¼‰"></a>ç¬¬å››ç«  å»ºç«‹å’–å•¡å› å®µç¦ï¼ˆé¥®é£Ÿï¼‰</h2><p>å’–å•¡å› æ˜¯ä¸€ç§å¼ºå¤§çš„ç¥ç»å…´å¥‹å‰‚ã€‚ç”±äºå’–å•¡å› æ‘„å…¥å¯¼è‡´ç¡çœ ä¸è¶³ï¼Œå¿…ç„¶ä¼šè®©æˆ‘ä»¬æ„Ÿè§‰æ›´åŠ ç–²æƒ«ï¼Œç–²æƒ«ä¹‹åæˆ‘ä»¬ä¼šæœŸå¾…æ›´å¤šçš„å’–å•¡å› ï¼Œè¿™ä¼šè®©æˆ‘ä»¬çš„ç¡çœ é—®é¢˜é›ªä¸ŠåŠ éœœã€‚å’–å•¡å› çš„åŠè¡°æœŸä¸º5~8å°æ—¶ï¼ŒåŠè¡°æœŸæœ¬è´¨ä¸Šæ˜¯æŒ‡ï¼Œäººä½“ç³»ç»Ÿä¸­çš„ç‰©è´¨æœ€é«˜æµ“åº¦é™ä½ä¸€èˆ¬æ‰€éœ€çš„æ—¶é—´ã€‚è®¾å®šä¸€ä¸ªå¿…é¡»éµå®ˆçš„å’–å•¡å› å°é‡‘ï¼Œç¡®ä¿åœ¨ä½ ç¡è§‰å‰ï¼Œå¯ä»¥æ’é™¤ä½“ç³»ä¸­çš„å¤§éƒ¨åˆ†å’–å•¡å› ï¼Œå¯¹äºå¤§éƒ¨åˆ†äººæ¥è¯´ï¼Œé‚£ä¸ªæ—¶é—´é€šå¸¸æ˜¯ä¸‹åˆ2ï¼š00å‰ã€‚</p><h2 id="ç¬¬äº”ç« -è®©è‡ªå·±å‡‰å¿«ç‚¹ï¼ˆæ¸©åº¦ï¼‰"><a href="#ç¬¬äº”ç« -è®©è‡ªå·±å‡‰å¿«ç‚¹ï¼ˆæ¸©åº¦ï¼‰" class="headerlink" title="ç¬¬äº”ç«  è®©è‡ªå·±å‡‰å¿«ç‚¹ï¼ˆæ¸©åº¦ï¼‰"></a>ç¬¬äº”ç«  è®©è‡ªå·±å‡‰å¿«ç‚¹ï¼ˆæ¸©åº¦ï¼‰</h2><p>å½“èº«ä½“è¯¥ä¼‘æ¯æ—¶ï¼Œäººä½“æ ¸å¿ƒæ¸©åº¦ä¼šè‡ªåŠ¨ä¸‹é™ï¼Œå¸®åŠ©äººä»¬å¯åŠ¨ç¡çœ çŠ¶æ€ã€‚å¦‚æœå¤–ç•Œæ¸©åº¦è¿‡é«˜ï¼Œèº«ä½“æƒ³è¿›å…¥ç†æƒ³çš„èˆ’é€‚ç¡çœ ï¼Œå°±ä¼šé¢ä¸´ä¸€ç‚¹ç”Ÿç†ä¸Šçš„æŒ‘æˆ˜ã€‚ç ”ç©¶è¡¨æ˜ï¼Œæœ€ä½³çš„ç¡çœ æ¸©åº¦æ˜¯15Â°~20Â°ã€‚å¦‚æœä½ æœ‰ç¡çœ éšœç¢ï¼Œè¯•ç€ç¡å‰èŠ±1.5~2å°æ—¶ï¼Œæ´—ä¸ªçƒ­æ°´æ¾¡ã€‚</p><h2 id="ç¬¬å…­ç« -é€‰æ‹©æ­£ç¡®çš„å…¥ç¡æ—¶é—´ï¼ˆæ—¶é—´ï¼‰"><a href="#ç¬¬å…­ç« -é€‰æ‹©æ­£ç¡®çš„å…¥ç¡æ—¶é—´ï¼ˆæ—¶é—´ï¼‰" class="headerlink" title="ç¬¬å…­ç«  é€‰æ‹©æ­£ç¡®çš„å…¥ç¡æ—¶é—´ï¼ˆæ—¶é—´ï¼‰"></a>ç¬¬å…­ç«  é€‰æ‹©æ­£ç¡®çš„å…¥ç¡æ—¶é—´ï¼ˆæ—¶é—´ï¼‰</h2><p>äººç±»åœ¨æ™š10ç‚¹åˆ°å‡Œæ™¨2ç‚¹å¤„äºç¡çœ çŠ¶æ€ï¼Œå¯ä»¥è·å¾—æœ€ä½³çš„æ¿€ç´ åˆ†æ³Œå’Œæ¢å¤æ•ˆæœã€‚å¦‚æœæœ‰äººç†¬åˆ°æ™šä¸Š10ç‚¹æˆ–11ç‚¹ï¼Œè¿›å…¥ç²¾åŠ›æ¢å¤çŠ¶æ€åï¼Œé€šå¸¸è§‰å¾—æƒ³ç¡è§‰æ›´éš¾å…¥ç¡ã€‚ç²¾åŠ›æ¢å¤çŠ¶æ€è·Ÿé”»ç‚¼çš„è¿‡ç¨‹åŒºåˆ«ä¸å¤§ï¼Œåšè¿‡è€åŠ›è®­ç»ƒçš„äººéƒ½ç›´åˆ°ï¼Œåªè¦åšæŒä¸€æ®µæ—¶é—´ï¼Œå³ä¾¿ä½ æ„Ÿè§‰ç´¯äº†ï¼Œèº«ä½“ä¹Ÿä¼šè¿›å…¥æ¢å¤çŠ¶æ€ï¼Œå†æ¬¡æ„Ÿè§‰ç²¾åŠ›æ»¡æ»¡ï¼Œç»§ç»­åšæŒä¸‹å»ã€‚</p><h2 id="ç¬¬åç« -è°ƒæš—å…‰çº¿ï¼ˆæ—¶é—´ï¼‰"><a href="#ç¬¬åç« -è°ƒæš—å…‰çº¿ï¼ˆæ—¶é—´ï¼‰" class="headerlink" title="ç¬¬åç«  è°ƒæš—å…‰çº¿ï¼ˆæ—¶é—´ï¼‰"></a>ç¬¬åç«  è°ƒæš—å…‰çº¿ï¼ˆæ—¶é—´ï¼‰</h2><p>å§å®¤é‡Œä»»ä½•çš„å…‰æºéƒ½ä¼šæ‰“ä¹±ç¡çœ æ¨¡å¼ï¼Œå³ä½¿æˆ´ä¸Šçœ¼ç½©ä¹Ÿä¸æ˜¯100%æœ‰æ•ˆçš„ã€‚ä½ çŸ¥é“çš®è‚¤ä¸Šå…¶å®æœ‰å…‰æ„Ÿå™¨å—ï¼Ÿå¦‚æœå§å®¤é‡Œæœ‰å…‰æºï¼Œä½ çš„èº«ä½“ä¼šæ¥æ”¶å…‰çº¿ï¼Œå‘å¤§è„‘å’Œå™¨å®˜å‘é€ä¿¡æ¯ä»è€Œå¹²æ‰°ç¡çœ ã€‚</p><h2 id="ç¬¬åä¸€ç« -è®²ç©¶æ–¹æ³•ï¼Œå¥½å¥½é”»ç‚¼ï¼ˆæ—¶é—´ï¼‰"><a href="#ç¬¬åä¸€ç« -è®²ç©¶æ–¹æ³•ï¼Œå¥½å¥½é”»ç‚¼ï¼ˆæ—¶é—´ï¼‰" class="headerlink" title="ç¬¬åä¸€ç«  è®²ç©¶æ–¹æ³•ï¼Œå¥½å¥½é”»ç‚¼ï¼ˆæ—¶é—´ï¼‰"></a>ç¬¬åä¸€ç«  è®²ç©¶æ–¹æ³•ï¼Œå¥½å¥½é”»ç‚¼ï¼ˆæ—¶é—´ï¼‰</h2><p>å…³é”®é—®é¢˜ä¸åœ¨äºé”»ç‚¼æœ¬èº«ï¼Œè€Œåœ¨äºé”»ç‚¼çš„æ—¶é—´å’Œæ–¹å¼ã€‚ä¸ºäº†ä¼˜åŒ–ç¡çœ ï¼Œä½ æ´»åŠ¨æ—¶éœ€è¦éµå¾ªå‡ ä¸ªåŸåˆ™ï¼š1.æ™šä¸Šä¸é€‚åˆé”»ç‚¼ï¼Œæ—©æ™¨é”»ç‚¼çš„å¥½å¤„ä¸èƒ½å¿½è§†ï¼›2.é•¿è·‘ä¸åˆ©äºå¥½çš„ç¡çœ ï¼›3.ä¸ºäº†è·å¾—æœ€ä½³çš„æ¿€ç´ ååº”ï¼Œéœ€è¦åšäº›ä¸¾é‡ç»ƒä¹ </p><h2 id="ç¬¬åå››ç« -å–é…’æ‚ ç€ç‚¹ï¼ˆé¥®é£Ÿï¼‰"><a href="#ç¬¬åå››ç« -å–é…’æ‚ ç€ç‚¹ï¼ˆé¥®é£Ÿï¼‰" class="headerlink" title="ç¬¬åå››ç«  å–é…’æ‚ ç€ç‚¹ï¼ˆé¥®é£Ÿï¼‰"></a>ç¬¬åå››ç«  å–é…’æ‚ ç€ç‚¹ï¼ˆé¥®é£Ÿï¼‰</h2><p>æ™šä¸Šå–é…’æœ‰åˆ©äºå¿«é€Ÿå…¥ç¡ï¼Œä½†æ˜¯å¿«é€Ÿçœ¼åŠ¨ç¡çœ ä¼šè¢«èº«ä½“ä¸­çš„é…’ç²¾ä¸¥é‡å¹²æ‰°ï¼Œä½ å°†æ— æ³•è¿›å…¥æ·±åº¦çš„ã€æŒç»­çš„å¿«é€Ÿçœ¼åŠ¨ç¡çœ ï¼Œå¤§è„‘å’Œèº«ä½“ä¹Ÿæ— æ³•å®Œå…¨æ¢å¤ã€‚</p><h2 id="ç¬¬åå…­ç« -è®©å¿ƒé‡Œè¯åœä¸‹æ¥-ï¼ˆå†¥æƒ³-è…¹å¼å‘¼å¸-æŠ€å·§ï¼‰"><a href="#ç¬¬åå…­ç« -è®©å¿ƒé‡Œè¯åœä¸‹æ¥-ï¼ˆå†¥æƒ³-è…¹å¼å‘¼å¸-æŠ€å·§ï¼‰" class="headerlink" title="ç¬¬åå…­ç«  è®©å¿ƒé‡Œè¯åœä¸‹æ¥ ï¼ˆå†¥æƒ³ è…¹å¼å‘¼å¸ æŠ€å·§ï¼‰"></a>ç¬¬åå…­ç«  è®©å¿ƒé‡Œè¯åœä¸‹æ¥ ï¼ˆå†¥æƒ³ è…¹å¼å‘¼å¸ æŠ€å·§ï¼‰</h2><h2 id="ç¬¬åå…«ç« -æ—©ç‚¹èµ·åºŠï¼ˆæ—¶é—´ï¼‰"><a href="#ç¬¬åå…«ç« -æ—©ç‚¹èµ·åºŠï¼ˆæ—¶é—´ï¼‰" class="headerlink" title="ç¬¬åå…«ç«  æ—©ç‚¹èµ·åºŠï¼ˆæ—¶é—´ï¼‰"></a>ç¬¬åå…«ç«  æ—©ç‚¹èµ·åºŠï¼ˆæ—¶é—´ï¼‰</h2><h2 id="ç¬¬åä¹ç« -é€‰æ‹©åˆé€‚çš„çº¤ä½“æ–¹æ³•-ï¼ˆæ¸è¿›å¼è‚Œè‚‰æ”¾æ¾-æŒ‰æ‘©-æŠ€å·§ï¼‰"><a href="#ç¬¬åä¹ç« -é€‰æ‹©åˆé€‚çš„çº¤ä½“æ–¹æ³•-ï¼ˆæ¸è¿›å¼è‚Œè‚‰æ”¾æ¾-æŒ‰æ‘©-æŠ€å·§ï¼‰" class="headerlink" title="ç¬¬åä¹ç«  é€‰æ‹©åˆé€‚çš„çº¤ä½“æ–¹æ³• ï¼ˆæ¸è¿›å¼è‚Œè‚‰æ”¾æ¾ æŒ‰æ‘© æŠ€å·§ï¼‰"></a>ç¬¬åä¹ç«  é€‰æ‹©åˆé€‚çš„çº¤ä½“æ–¹æ³• ï¼ˆæ¸è¿›å¼è‚Œè‚‰æ”¾æ¾ æŒ‰æ‘© æŠ€å·§ï¼‰</h2>]]></content>
      
      
      <categories>
          
          <category> ç”Ÿæ´» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¡çœ  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 3 é¢å‘å¯¹è±¡</title>
      <link href="/archives/59bf225c.html"/>
      <url>/archives/59bf225c.html</url>
      
        <content type="html"><![CDATA[<h1 id="python-é¢å‘å¯¹è±¡"><a href="#python-é¢å‘å¯¹è±¡" class="headerlink" title="python é¢å‘å¯¹è±¡"></a>python é¢å‘å¯¹è±¡</h1><h2 id="é¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#é¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="é¢å‘å¯¹è±¡ç¼–ç¨‹"></a>é¢å‘å¯¹è±¡ç¼–ç¨‹</h2><p>ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Ÿç”¨ä¸€æ®µè¯æè¿°é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼š</p><blockquote><p>æŠŠä¸€ç»„æ•°æ®ç»“æ„å’Œå¤„ç†å®ƒä»¬çš„æ–¹æ³•ç»„æˆå¯¹è±¡ï¼ˆobjectï¼‰ï¼ŒæŠŠç›¸åŒè¡Œä¸ºçš„å¯¹è±¡å½’çº³ä¸ºç±»ï¼ˆclassï¼‰ï¼Œé€šè¿‡ç±»çš„å°è£…ï¼ˆencapsulationï¼‰éšè—å†…éƒ¨ç»†èŠ‚ï¼Œé€šè¿‡ç»§æ‰¿ï¼ˆinheritanceï¼‰å®ç°ç±»çš„ç‰¹åŒ–ï¼ˆspecializationï¼‰å’Œæ³›åŒ–ï¼ˆgeneralizationï¼‰ï¼Œé€šè¿‡å¤šæ€ï¼ˆpolymorphismï¼‰å®ç°åŸºäºå¯¹è±¡ç±»å‹çš„åŠ¨æ€åˆ†æ´¾</p></blockquote><p>è¿™ä¸€æ®µè¯æˆ‘åœ¨ä¹‹å‰æ˜¯çœ‹å¾—äº‘é‡Œé›¾é‡Œï¼Œè¿™æ ·é«˜åº¦çš„æ¦‚æ‹¬è¿‡äºæŠ½è±¡ã€‚ç°åœ¨çœ‹è¿‡äº†ä¸€äº›ä»£ç è¿‡åï¼Œå†å›å¤´çœ‹è¿™æ®µè¯æ‰æ²¡é‚£ä¹ˆè¿·æƒ‘</p><h2 id="ç±»å’Œå¯¹è±¡"><a href="#ç±»å’Œå¯¹è±¡" class="headerlink" title="ç±»å’Œå¯¹è±¡"></a>ç±»å’Œå¯¹è±¡</h2><p>ç±»æ˜¯å¯¹è±¡çš„æ¨¡æ¿ï¼Œå¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ã€‚åœ¨é¢å‘å¯¹è±¡çš„ä¸–ç•Œä¸­ï¼Œä¸€åˆ‡çš†ä¸ºå¯¹è±¡ã€‚ä¸‹é¢æ¥åˆ›å»ºä¸€ä¸ªç±»</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age        <span class="token keyword">def</span> <span class="token function">introduce</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"My name is %s. I'm %d."</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹‹å‰æåˆ°è¿‡ <code>__init__()</code> æ–¹æ³•åœ¨ç±»ä¸­å±äºç‰¹æ®Šæ–¹æ³•ï¼Œä¼šåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥ç»™å¯¹è±¡ç»‘å®š <code>name</code> &amp; <code>age</code> ä¸¤ä¸ªå±æ€§ï¼Œè¿™æ ·åœ¨å…¶ä»–æ–¹æ³•é‡Œå°±èƒ½å¤Ÿéšæ„è°ƒç”¨è¿™äº›å±æ€§ï¼Œè€Œä¸éœ€è¦å†æ¬¡ä¼ å…¥è¿™äº›å‚æ•°ã€‚ä¸‹é¢æ¥åˆ›å»º <code>Student</code> ç±»çš„å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å…¶å†…éƒ¨å‡½æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">student_1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'Declan'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span>student_1<span class="token punctuation">.</span>introduce<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># My name is Declan. I'm 23.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åˆ›å»ºå¯¹è±¡ï¼Œå°±æ˜¯å°†ç±»å®ä¾‹åŒ–ï¼Œå…·ä½“ä¸€ç‚¹æ¥è¯´ï¼šç»™ç±»ä¼ å…¥ä¸€äº›å‚æ•°ï¼Œè®©å…¶ä»æ¨¡æ¿ç§°ä¸ºäº†ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ã€‚å¯ä»¥çœ‹åˆ°åœ¨åˆ›å»ºçš„å¯¹è±¡çš„ä»£ç é‡Œï¼Œå¹¶æ²¡æœ‰æ˜¾å¼ä½¿ç”¨ï¼Œä¹Ÿä¸èƒ½æ˜¾å¼ä½¿ç”¨ç‰¹æ®Šæ–¹æ³• <code>__init__()</code> </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># try this</span>student_2 <span class="token operator">=</span> Student<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token string">'Declan'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™æ ·åšä¸€å®šæ˜¯ä¼šæŠ¥é”™çš„ã€‚æ‰€ä»¥æ­£ç¡®çš„ç†è§£æ˜¯ï¼Œ<code>Student(name, age)</code> ä¸­çš„å‚æ•° <code>name</code> &amp; <code>age</code> å°±æ˜¯ç»™ <code>__init__()</code> çš„å‚æ•°ï¼Œå¹¶åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è‡ªåŠ¨è¿è¡Œ <code>__init__()</code> æ–¹æ³•</p><h3 id="è®¿é—®å¯è§æ€§é—®é¢˜"><a href="#è®¿é—®å¯è§æ€§é—®é¢˜" class="headerlink" title="è®¿é—®å¯è§æ€§é—®é¢˜"></a>è®¿é—®å¯è§æ€§é—®é¢˜</h3><p>åœ¨å¾ˆå¤šé¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†å¯¹è±¡çš„å±æ€§è®¾ç½®ä¸ºç§æœ‰çš„ï¼ˆprivateï¼‰æˆ–å—ä¿æŠ¤çš„ï¼ˆprotectedï¼‰ï¼Œç®€å•çš„è¯´å°±æ˜¯ä¸å…è®¸å¤–ç•Œè®¿é—®ï¼Œè€Œå¯¹è±¡çš„æ–¹æ³•é€šå¸¸éƒ½æ˜¯å…¬å¼€çš„ï¼ˆpublicï¼‰ï¼Œåœ¨ Python ä¸­ï¼Œå±æ€§å’Œæ–¹æ³•çš„è®¿é—®æƒé™åªæœ‰ä¸¤ç§ï¼Œä¹Ÿå°±æ˜¯å…¬å¼€çš„å’Œç§æœ‰çš„ï¼Œå¦‚æœå¸Œæœ›å±æ€§æ˜¯ç§æœ‰çš„ï¼Œåœ¨ç»™å±æ€§å‘½åæ—¶å¯ä»¥ç”¨ä¸¤ä¸ªä¸‹åˆ’çº¿ä½œä¸ºå¼€å¤´</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>__private <span class="token operator">=</span> <span class="token string">'private'</span>        self<span class="token punctuation">.</span>__func<span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token keyword">def</span> <span class="token function">__func</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__private<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'this function is private'</span><span class="token punctuation">)</span>test <span class="token operator">=</span> Test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># private</span><span class="token comment"># this function is private</span><span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>__private<span class="token punctuation">)</span><span class="token comment"># AttributeError: 'Test' object has no attribute '__private'</span><span class="token comment"># ç›´æ¥è®¿é—®è¢«é˜»æ‹¦ï¼Œä½†æ‹ä¸ªå¼¯è¿˜æ˜¯æœ‰æ–¹æ³•èƒ½å¤Ÿè®¿é—®</span><span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>_Test__private<span class="token punctuation">)</span><span class="token comment"># private</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åœ¨ç±»çš„å†…éƒ¨è°ƒç”¨è¿™äº›ç§æœ‰å˜é‡å’Œå‡½æ•°æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æƒ³è¦åœ¨å‡½æ•°ä¹‹å¤–ç›´æ¥è®¿é—®è¿™äº›å˜é‡å’Œå‡½æ•°æ˜¯è¢«ç¦æ­¢çš„ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸å»ºè®®å°†å±æ€§è®¾ç½®ä¸ºç§æœ‰çš„ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´å­ç±»æ— æ³•è®¿é—®ï¼ˆåé¢ä¼šè®²åˆ°ï¼‰ã€‚æ‰€ä»¥å¤§å¤šæ•° Python ç¨‹åºå‘˜ä¼šéµå¾ªä¸€ç§å‘½åæƒ¯ä¾‹å°±æ˜¯è®©å±æ€§åä»¥å•ä¸‹åˆ’çº¿å¼€å¤´å¦‚ <code>_name</code>ï¼Œæ¥è¡¨ç¤ºå±æ€§æ˜¯å—ä¿æŠ¤çš„ï¼Œæœ¬ç±»ä¹‹å¤–çš„ä»£ç åœ¨è®¿é—®è¿™æ ·çš„å±æ€§æ—¶åº”è¯¥è¦ä¿æŒæ…é‡</p><h2 id="ç±»çš„æ–¹æ³•"><a href="#ç±»çš„æ–¹æ³•" class="headerlink" title="ç±»çš„æ–¹æ³•"></a>ç±»çš„æ–¹æ³•</h2><h3 id="self"><a href="#self" class="headerlink" title="self"></a>self</h3><p>ç±»çš„æ–¹æ³•ä¸æ™®é€šçš„å‡½æ•°åªæœ‰ä¸€ä¸ªç‰¹åˆ«çš„åŒºåˆ«â€”â€”å®ƒä»¬å¿…é¡»æœ‰ä¸€ä¸ªé¢å¤–çš„<strong>ç¬¬ä¸€ä¸ªå‚æ•°åç§°</strong>ï¼ŒæŒ‰ç…§æƒ¯ä¾‹å®ƒçš„åç§°æ˜¯ selfï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å«å…¶å®ƒåå­—ï¼Œä¸‹é¢çœ‹çœ‹è¿™ä¸ª self åˆ°åº•ä»£è¡¨äº†ä»€ä¹ˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">:</span><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>SELF<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>SELF<span class="token punctuation">.</span>__class__<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">pointer_self</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>test <span class="token operator">=</span> Test<span class="token punctuation">(</span><span class="token punctuation">)</span>test<span class="token punctuation">.</span>pointer_self<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># &lt;class '__main__.Test'&gt;</span><span class="token comment"># &lt;__main__.Test object at 0x000001B64F611040&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»æ‰§è¡Œç»“æœå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼Œself ä»£è¡¨çš„æ˜¯ç±»çš„å®ä¾‹ï¼Œä»£è¡¨å½“å‰å¯¹è±¡çš„åœ°å€ï¼Œè€Œ self.class åˆ™æŒ‡å‘ç±»</p><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><p>å¦‚æœä¸€ç§è¯­è¨€ä¸æ”¯æŒç»§æ‰¿ï¼Œç±»å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚å­ç±»ä¼šç»§æ‰¿çˆ¶ç±»ï¼ˆä¹Ÿå«åŸºç±»ï¼‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”è¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ‰€ä»¥å­ç±»æ¯”çˆ¶ç±»æ‹¥æœ‰æ›´å¤šçš„èƒ½åŠ›ï¼Œä¸‹é¢çœ‹ä¸€ä¸ªç®€çŸ­çš„ä»£ç ï¼Œç†è§£ç»§æ‰¿æœºåˆ¶çš„é€»è¾‘</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># è¿™æ˜¯ä¹‹å‰å†™çš„å­¦ç”Ÿç±»</span><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age        self<span class="token punctuation">.</span>log <span class="token operator">=</span> <span class="token string">'this is a student'</span>        <span class="token keyword">def</span> <span class="token function">introduce</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"My name is %s. I'm %d."</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># ç°åœ¨å»ºç«‹ä¸€ä¸ªæœ¬ç§‘ç”Ÿç±»</span><span class="token keyword">class</span> <span class="token class-name">Undergraduate</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> grade<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>grade <span class="token operator">=</span> grade    <span class="token keyword">def</span> <span class="token function">which_grade</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'My grade is %d.'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>grade<span class="token punctuation">)</span>        <span class="token comment"># åœ¨å¤šæ€çš„æ—¶å€™å–æ¶ˆæ³¨é‡Š</span>    <span class="token comment"># def introduce(self):</span>    <span class="token comment">#     print("Hello! My name is %s. I'm %d." % (self.name, self.age))</span>student_1 <span class="token operator">=</span> Undergraduate<span class="token punctuation">(</span><span class="token string">'Declan'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>student_1<span class="token punctuation">.</span>which_grade<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># My grade is 1.</span><span class="token comment"># å­ç±»å®ä¾‹ç›´æ¥ä½¿ç”¨çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•</span><span class="token keyword">print</span><span class="token punctuation">(</span>student_1<span class="token punctuation">.</span>log<span class="token punctuation">)</span>student_1<span class="token punctuation">.</span>introduce<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># this is a student</span><span class="token comment"># My name is Declan. I'm 18.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡ç‚¹çš„å‡ ä¸ªé€»è¾‘ï¼š</p><ol><li>å£°æ˜çˆ¶ç±»ï¼Œåœ¨å®šä¹‰çš„ç±»ååä¼ å…¥çˆ¶ç±»åå³å¯ï¼Œå¦‚ <code>class Undergraduate(Student)</code></li><li>è°ƒç”¨çˆ¶ç±»ï¼Œé€šè¿‡ <code>super()</code> å‡½æ•°è°ƒç”¨çˆ¶ç±»ä¸­çš„å±æ€§ã€æ–¹æ³•ï¼Œå¦‚æœæ˜¯ python 2.x çš„è¯éœ€è¦ä½¿ç”¨ <code>super(å­ç±»å, self)</code> è°ƒç”¨</li><li>å®ä¾‹ä½¿ç”¨çˆ¶ç±»ï¼Œå­ç±»å®ä¾‹å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»ä¸­çš„å±æ€§ã€æ–¹æ³•</li></ol><h2 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h2><p>å­ç±»åœ¨ç»§æ‰¿äº†çˆ¶ç±»çš„æ–¹æ³•åï¼Œå¯ä»¥å¯¹çˆ¶ç±»å·²æœ‰çš„æ–¹æ³•ç»™å‡ºæ–°çš„å®ç°ç‰ˆæœ¬ï¼Œè¿™ä¸ªåŠ¨ä½œç§°ä¹‹ä¸ºæ–¹æ³•é‡å†™ï¼ˆoverrideï¼‰ï¼Œçˆ¶ç±»çš„æ–¹æ³•å¯ä»¥è¢«å¤šä¸ªå­ç±»è¿›è¡Œé‡å†™å¾—åˆ°å¤šä¸ªä¸åŒçš„å®ç°ç‰ˆæœ¬ï¼Œè¿™ä¸ªå°±æ˜¯å¤šæ€ï¼ˆpoly-morphismï¼‰</p><p>æŠŠä¸Šä¸€èŠ‚ä¸­å…³äºå¤šæ€çš„ä»£ç å–æ¶ˆæ³¨é‡Šï¼Œå†è°ƒç”¨ <code>introduce()</code> æ–¹æ³•</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">student_1<span class="token punctuation">.</span>introduce<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># Hello! My name is Declan. I'm 18.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å‘ç°æ¯”ä¹‹å‰çˆ¶ç±»çš„ <code>introduce()</code> å¤šæ‰“å°äº† <code>Hello!</code> é‡å†™æˆåŠŸï¼ </p><h2 id="è¡¥å……ï¼šç±»çš„ç‰¹æ®Šæ–¹æ³•"><a href="#è¡¥å……ï¼šç±»çš„ç‰¹æ®Šæ–¹æ³•" class="headerlink" title="è¡¥å……ï¼šç±»çš„ç‰¹æ®Šæ–¹æ³•"></a>è¡¥å……ï¼šç±»çš„ç‰¹æ®Šæ–¹æ³•</h2><p>è¿™äº›ç±»çš„ç‰¹æ®Šæ–¹æ³•ä¹Ÿå«é­”æœ¯æ–¹æ³•ï¼Œåœ¨ç‰¹æ®Šæ¡ä»¶ä¸‹è¢«è°ƒç”¨ï¼Œä¸‹é¢åˆ—ä¸¾ä¸€äº›</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">-</span> <span class="token operator">**</span>__init__ <span class="token punctuation">:</span><span class="token operator">**</span> æ„é€ å‡½æ•°ï¼Œåœ¨ç”Ÿæˆå¯¹è±¡æ—¶è°ƒç”¨<span class="token operator">-</span> <span class="token operator">**</span>__del__ <span class="token punctuation">:</span><span class="token operator">**</span> ææ„å‡½æ•°ï¼Œé‡Šæ”¾å¯¹è±¡æ—¶ä½¿ç”¨<span class="token operator">-</span> <span class="token operator">**</span>__repr__ <span class="token punctuation">:</span><span class="token operator">**</span> æ‰“å°å¯¹è±¡æ—¶è°ƒç”¨<span class="token operator">-</span> <span class="token operator">**</span>__setitem__ <span class="token punctuation">:</span><span class="token operator">**</span> æŒ‰ç…§ç´¢å¼•èµ‹å€¼<span class="token operator">-</span> <span class="token operator">**</span>__getitem__<span class="token punctuation">:</span><span class="token operator">**</span> æŒ‰ç…§ç´¢å¼•è·å–å€¼<span class="token operator">-</span> <span class="token operator">**</span>__len__<span class="token punctuation">:</span><span class="token operator">**</span> è·å¾—é•¿åº¦<span class="token operator">-</span> <span class="token operator">**</span>__cmp__<span class="token punctuation">:</span><span class="token operator">**</span> æ¯”è¾ƒè¿ç®—<span class="token operator">-</span> <span class="token operator">**</span>__call__<span class="token punctuation">:</span><span class="token operator">**</span> è®©å¯¹è±¡å˜ä¸ºå¯è°ƒç”¨å¯¹è±¡<span class="token comment"># ä¸‹é¢çš„é­”æœ¯æ–¹æ³•å¯ä»¥è¿›è¡Œç®—ç¬¦é‡è½½</span><span class="token operator">-</span> <span class="token operator">**</span>__add__<span class="token punctuation">:</span><span class="token operator">**</span> åŠ è¿ç®—<span class="token operator">-</span> <span class="token operator">**</span>__sub__<span class="token punctuation">:</span><span class="token operator">**</span> å‡è¿ç®—<span class="token operator">-</span> <span class="token operator">**</span>__mul__<span class="token punctuation">:</span><span class="token operator">**</span> ä¹˜è¿ç®—<span class="token operator">-</span> <span class="token operator">**</span>__truediv__<span class="token punctuation">:</span><span class="token operator">**</span> é™¤è¿ç®—<span class="token operator">-</span> <span class="token operator">**</span>__mod__<span class="token punctuation">:</span><span class="token operator">**</span> æ±‚ä½™è¿ç®—<span class="token operator">-</span> <span class="token operator">**</span>__pow__<span class="token punctuation">:</span><span class="token operator">**</span> ä¹˜æ–¹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®éªŒä¸€ä¸‹ <code>__repr__, __call__</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"My name is {}. I'm {}."</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> grade<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'grade {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span>name <span class="token operator">=</span> <span class="token string">'Declan'</span>age <span class="token operator">=</span> <span class="token number">23</span>stu <span class="token operator">=</span> Student<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token comment"># My name is Declan. I'm 23.</span><span class="token keyword">print</span><span class="token punctuation">(</span>stu<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># grade 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¡¥å……ï¼šè£…é¥°å™¨"><a href="#è¡¥å……ï¼šè£…é¥°å™¨" class="headerlink" title="è¡¥å……ï¼šè£…é¥°å™¨"></a>è¡¥å……ï¼šè£…é¥°å™¨</h2><p>å‚è€ƒ <a href="https://www.cnblogs.com/auguse/articles/9922257.html">åšå®¢</a> è¿›è¡Œæ•´ç†ã€‚è£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Python å‡½æ•°æˆ–ç±»ï¼Œå®ƒå¯ä»¥è®©å…¶ä»–å‡½æ•°æˆ–ç±»åœ¨ä¸éœ€è¦åšä»»ä½•ä»£ç ä¿®æ”¹çš„å‰æä¸‹å¢åŠ é¢å¤–åŠŸèƒ½ã€‚ç”±äºåœ¨å­¦ä¹  mmdetection ä¸­å‘ç° <code>registry</code> ç±»çš„å®ç°å°±éœ€è¦è£…é¥°å™¨çš„å¸®å¿™ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°†â€œèŠ±è´¹â€ä¸€äº›ç¯‡å¹…æ¥äº†è§£è£…é¥°å™¨çš„å†…éƒ¨é€»è¾‘</p><h3 id="è£…é¥°å™¨åŸºæœ¬åŸç†"><a href="#è£…é¥°å™¨åŸºæœ¬åŸç†" class="headerlink" title="è£…é¥°å™¨åŸºæœ¬åŸç†"></a>è£…é¥°å™¨åŸºæœ¬åŸç†</h3><p>ä¸‹é¢å…ˆçœ‹çœ‹ä¸ç”¨ python è£…é¥°å™¨ï¼Œæ€æ ·å®ç°å…¶ç±»ä¼¼çš„åŠŸèƒ½</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># åŸå‡½æ•°</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"My name is {}, and I'm {}."</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># å®šä¹‰ä¸€ä¸ªè£…é¥°å™¨æ¥åŒ…è£…åŸå‡½æ•°</span><span class="token keyword">def</span> <span class="token function">decorate</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'This is my introduction.'</span><span class="token punctuation">)</span>        func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token comment"># è¿”å›æ–°çš„å‡½æ•°å</span>    <span class="token keyword">return</span> wrap<span class="token comment"># å°†åŸå‡½æ•°åŒ…è£…ï¼Œå¹¶å°†åŸå‡½æ•°æŒ‡å‘è£…é¥°åçš„å‡½æ•°</span>test  <span class="token operator">=</span> decorate<span class="token punctuation">(</span>test<span class="token punctuation">)</span>name <span class="token operator">=</span> <span class="token string">'Declan'</span>age <span class="token operator">=</span> <span class="token number">23</span>test<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token comment"># This is my introduction.</span><span class="token comment"># My name is Declan, and I'm 23.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨ï¼Œè¯¥è£…é¥°å™¨çš„åŠŸèƒ½å°±æ˜¯åœ¨åŸå‡½æ•°ä¹‹å‰æ‰“å°ä¸€å¥è¯ <code>This is my introduction</code></p><p>python ä½¿ç”¨ <code>@</code> å…³é”®å­—æ¥å®ç°è£…é¥°å™¨ï¼Œå…·ä½“æ¥è¯´ <code>@</code> å…³é”®å­—å®ç°çš„æ˜¯ä¸Šé¢ä»£ç ä¸­çš„æ³¨é‡Šâ€œå°†åŸå‡½æ•°åŒ…è£…ï¼Œå¹¶å°†åŸå‡½æ•°æŒ‡å‘è£…é¥°åçš„å‡½æ•°â€ã€‚å°†ä¹‹å‰çš„è£…é¥°å™¨ï¼Œç”¨ <code>@</code> é‡æ–°å®ç°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å®šä¹‰ä¸€ä¸ªè£…é¥°å™¨æ¥åŒ…è£…åŸå‡½æ•°</span><span class="token keyword">def</span> <span class="token function">decorate</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'This is my introduction.'</span><span class="token punctuation">)</span>        func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token comment"># è¿”å›æ–°çš„å‡½æ•°å</span>    <span class="token keyword">return</span> wrap<span class="token comment"># åŸå‡½æ•°+è£…é¥°å™¨</span><span class="token decorator annotation punctuation">@decorate</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"My name is {}, and I'm {}."</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># test  = decortate(test)</span>name <span class="token operator">=</span> <span class="token string">'Declan'</span>age <span class="token operator">=</span> <span class="token number">23</span>test<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token comment"># This is my introduction.</span><span class="token comment"># My name is Declan, and I'm 23</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># &lt;class 'function'&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯åœ¨åŸå‡½æ•°ä¹‹å‰åŠ ä¸Š <code>@decorate</code> å°±å®ç°äº†å¯¹åŸå‡½æ•°çš„è£…é¥°ï¼Œæ›¿ä»£äº† <code>test  = decorate(test)</code> è¿™ä¸€æ­¥ï¼Œ<strong>è¿™å°±æ˜¯è£…é¥°å™¨çš„æœ¬è´¨</strong>ã€‚æ¢å¥è¯è¯´ <code>@</code> å…³é”®å­—å°†ä¸‹ä¸€è¡Œçš„å‡½æ•°/ç±»ï¼Œä½œä¸ºå‚æ•°ä¼ ç»™äº† <code>decorate</code> å‡½æ•°ï¼Œè€Œ <code>decorate(test)</code> é€šå¸¸å°†è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°å°†èƒ½ç”¨ <code>test</code> è¿›è¡Œè°ƒç”¨</p><p>ä¹‹å‰çš„è£…é¥°å™¨åªæ¥å—äº†åŸå‡½æ•° <code>test</code> ä½œä¸ºå‚æ•°ï¼Œé‚£å¦‚æœæƒ³è¦å®ç°ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œä¾‹å¦‚ <code>@decorate(*args)</code> åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ¥ä¸‹æ¥å®ç°ä¸€ä¸ªå¸¦å‚æ•°çš„è£…é¥°å™¨ï¼Œä¹Ÿå°±æ˜¯è£…é¥°å™¨çš„è£…é¥°å™¨ğŸ¤£ï¼Œè™½ç„¶è¿™ä¹ˆè¯´å¾ˆç»•å“ˆå“ˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">name <span class="token operator">=</span> <span class="token string">'Declan'</span>age <span class="token operator">=</span> <span class="token number">23</span><span class="token keyword">def</span> <span class="token function">param_decorate</span><span class="token punctuation">(</span>addtional<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"It's running before test(), and addtional is </span><span class="token interpolation"><span class="token punctuation">{</span>addtional<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">decorate</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">def</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'This is a introduction.'</span><span class="token punctuation">)</span>            func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>        <span class="token keyword">return</span> wrap    <span class="token keyword">return</span> decorate<span class="token decorator annotation punctuation">@param_decorate</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"My name is {}, and I'm {}."</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># It's running before test(), and addtional is 3.14</span>test<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token comment"># This is a introduction.</span><span class="token comment"># My name is Declan, and I'm 23</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ä»¥ä¸Šä»£ç ä¼šå‘ç°ï¼Œå³ä½¿æ²¡æœ‰è¿è¡Œ <code>test</code> å‡½æ•°ä¹Ÿè¾“å‡ºäº†å†…å®¹ã€‚è¿™æ˜¯å› ä¸ºç»™è£…é¥°å™¨æ·»åŠ å‚æ•°è¿‡åï¼Œé‚£ä¹ˆ <code>@</code> åè·Ÿéšçš„å°±æ˜¯ä¸€ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œpython å°±ä¼šçœŸå®åœ°æ‰§è¡Œè¯¥å‡½æ•°çš„å†…å®¹ã€‚æ‰§è¡Œ <code>param_decorate</code> å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°å <code>decorate</code>ï¼Œé‚£ä¹ˆæ­¤æ—¶ <code>@param_decorate()</code> ç›¸å½“äº <code>@decorate</code></p><p><strong>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ¥å­¦ä¹ è£…é¥°å™¨çš„å†…éƒ¨é€»è¾‘ï¼Œå°±æ˜¯ç›´æ¥å¯¹ä»£ç  debugï¼Œä¸€æ­¥æ­¥çœ‹ç¨‹åºæ˜¯å¦‚ä½•è¿è¡Œçš„</strong></p><h3 id="python-å†…ç½®è£…é¥°å™¨"><a href="#python-å†…ç½®è£…é¥°å™¨" class="headerlink" title="python å†…ç½®è£…é¥°å™¨"></a>python å†…ç½®è£…é¥°å™¨</h3><p>å†…ç½®çš„è£…é¥°å™¨å’Œæ™®é€šçš„è£…é¥°å™¨åŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ä¸€èˆ¬ç”¨äºç±»çš„æ–¹æ³•å½“ä¸­ï¼Œè®©ç±»å˜å¾—æ›´çµæ´»</p><h4 id="property"><a href="#property" class="headerlink" title="@property"></a>@property</h4><p>å‚è€ƒ <a href="https://www.runoob.com/python/python-func-property.html">èœé¸Ÿæ•™ç¨‹</a> <a href="https://www.liaoxuefeng.com/wiki/897692888725344/923030547069856">å»–é›ªå³°æ•™ç¨‹ </a>è¿›è¡Œæ•´ç†ã€‚<code>@property</code> èƒ½å¤Ÿç”¨äºç®¡ç†ç±»çš„ç§æœ‰å±æ€§ï¼Œæ–¹ä¾¿è¯»å–å±æ€§ã€ä¿®æ”¹å±æ€§ã€‚ä¸‹é¢çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¯¥è£…é¥°å™¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span>    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">get_the_score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""I'm the 'score' property."""</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_score     <span class="token decorator annotation punctuation">@get_the_score<span class="token punctuation">.</span>setter</span>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> value     <span class="token decorator annotation punctuation">@get_the_score<span class="token punctuation">.</span>deleter</span>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">del</span> self<span class="token punctuation">.</span>_scorestudent <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># setterä¸ä»…å¯ä»¥æ›´æ”¹å±æ€§å€¼ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºè¯¥å±æ€§</span>student<span class="token punctuation">.</span>get_the_score <span class="token operator">=</span> <span class="token number">60</span><span class="token comment"># æŸ¥çœ‹å±æ€§</span><span class="token keyword">print</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>get_the_score<span class="token punctuation">)</span><span class="token comment"># 60</span><span class="token comment"># ä¹Ÿä½¿ç”¨åŸå±æ€§åç§°æ›´æ”¹å’Œè®¿é—®</span>student<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">100</span><span class="token keyword">print</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token comment"># 100</span><span class="token comment"># åˆ é™¤å±æ€§</span><span class="token comment"># del student.score</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>@property</code> çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘æ„Ÿè§‰æˆ‘æ˜¯çœŸæ²¡ç†è§£ï¼Œè¿™é‡Œç›´æ¥å¼•ç”¨ä¸€ä¸‹å»–é›ªå³°æ•™ç¨‹ä¸­çš„è¯ï¼š</p><blockquote><p>æŠŠä¸€ä¸ª <code>get_the_score</code> æ–¹æ³•å˜æˆå±æ€§ï¼Œåªéœ€è¦åŠ ä¸Š <code>@property</code> å°±å¯ä»¥äº†ã€‚æ­¤æ—¶ï¼Œ<code>@property</code>æœ¬èº«åˆåˆ›å»ºäº†å¦ä¸€ä¸ªè£…é¥°å™¨ <code>@get_the_score.setter</code>ï¼Œè´Ÿè´£æŠŠä¸€ä¸ª setter æ–¹æ³•å˜æˆå±æ€§èµ‹å€¼ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬å°±æ‹¥æœ‰ä¸€ä¸ªå¯æ§çš„å±æ€§æ“ä½œ</p></blockquote><p>æˆ‘è‡ªå·±ç†è§£ï¼Œå¦‚æœéœ€è¦åªè¯»å±æ€§ï¼Œåˆ™åªä½¿ç”¨ <code>@property</code> è£…é¥°å™¨å°±å¯ä»¥äº†ï¼Œå¦‚æœè¿˜éœ€è¦å¯¹å±æ€§è¿›è¡Œè¿›ä¸€æ­¥æ“æ§åˆ™åŠ ä¸Šå…¶ä»– <code>setter, deleter</code> è£…é¥°å™¨</p><p>è€Œä¸”ï¼Œå¦‚æœä½¿ç”¨äº† <code>property</code> è£…é¥°å™¨ï¼Œå¿…é¡»è¦ä½¿ç”¨å•ä¸‹åˆ’çº¿å˜é‡ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼Œå…·ä½“åŸå› å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/53469919">çŸ¥ä¹é“¾æ¥</a></p><h4 id="classmethod"><a href="#classmethod" class="headerlink" title="@classmethod"></a>@classmethod</h4><p>å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/35643573">çŸ¥ä¹é“¾æ¥</a> è¿›è¡Œæ•´ç†ï¼Œ<code>classmethod</code> åˆè¢«å«åšç±»æ–¹æ³•ã€‚<code>__init__()</code> ä½œä¸ºç±»çš„æ„é€ å‡½æ•°ï¼Œèƒ½å¤Ÿåœ¨ç”Ÿæˆå¯¹è±¡æ—¶è°ƒç”¨ï¼Œä½†å¦‚æœæƒ³è¦ä½¿ç”¨å…¶ä»–æ„é€ å‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>@classmethod</code> å®ç°ï¼Œä¸‹é¢çœ‹å¦‚ä½•ä½¿ç”¨ç±»æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆä¸ºæ–¹ä¾¿ï¼ŒæŠŠé™æ€æ–¹æ³• <code>staticmethod</code> çš„ä»£ç ä¹Ÿå†™åœ¨è¿™å„¿ï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Date</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>year <span class="token operator">=</span> year        self<span class="token punctuation">.</span>month <span class="token operator">=</span> month        self<span class="token punctuation">.</span>day <span class="token operator">=</span> day        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{}å¹´{}æœˆ{}æ—¥'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>year<span class="token punctuation">,</span> self<span class="token punctuation">.</span>month<span class="token punctuation">,</span> self<span class="token punctuation">.</span>day<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@classmethod</span>    <span class="token keyword">def</span> <span class="token function">create_from_string</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>        year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span>string<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> cls<span class="token punctuation">(</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span>    <span class="token decorator annotation punctuation">@staticmethod</span>    <span class="token keyword">def</span> <span class="token function">is_leap</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> year <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> year <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">elif</span> year <span class="token operator">%</span> <span class="token number">400</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token comment"># æ™®é€šæ„é€ </span>date <span class="token operator">=</span> Date<span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token comment"># 2020å¹´7æœˆ31æ—¥</span><span class="token comment"># é€šè¿‡ç±»æ–¹æ³•æ„é€ </span>date <span class="token operator">=</span> Date<span class="token punctuation">.</span>create_from_string<span class="token punctuation">(</span><span class="token string">'2020-7-31'</span><span class="token punctuation">)</span><span class="token comment"># 2020å¹´7æœˆ31æ—¥</span><span class="token comment"># ä½¿ç”¨é™æ€æ–¹æ³•</span><span class="token keyword">print</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span>is_leap<span class="token punctuation">(</span><span class="token number">1900</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…¶è¡¨ç¤ºè°ƒç”¨å½“å‰çš„ç±»åï¼Œé»˜è®¤åç§°ä¸º <code>cls</code>ï¼Œæœ‰ç‚¹ç±»ä¼¼äº <code>self</code> è¡¨ç¤ºç±»çš„å®ä¾‹ã€‚é‚£ä¹ˆç±»æ–¹æ³•æœ€åçš„è¿”å›å€¼ <code>return cls(year, month, day)</code> ä¹Ÿå°±ä¸éš¾ç†è§£äº†ï¼Œç›¸å½“äº <code>return Data(year, month, day)</code> é‡æ–°åˆ›å»ºäº†å¯¹è±¡</p><p>ç±»æ–¹æ³•èƒ½å¤Ÿåœ¨ä¸æ”¹å˜åŸæœ¬æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œç»™ç±»çš„æ„é€ æ–¹æ³•å¢åŠ ä¸€äº›é¢å¤–åŠŸèƒ½ï¼Œä¾‹å¦‚å¯¹äºä¼ å…¥å‚æ•°åšä¸€äº›ä¸åŒçš„å¤„ç†ç­‰ç­‰</p><h4 id="staticmethod"><a href="#staticmethod" class="headerlink" title="@staticmethod"></a>@staticmethod</h4><p>å‚è€ƒ <a href="https://www.cnblogs.com/Meanwey/p/9788713.html">åšå®¢</a> çš„è¯´æ³•ï¼š<code>@staticmethod</code> é™æ€æ–¹æ³•åªæ˜¯åä¹‰ä¸Šå½’å±ç±»ç®¡ç†ï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨ç±»å˜é‡å’Œå®ä¾‹å˜é‡ï¼Œæ˜¯ç±»çš„å·¥å…·åŒ…ã€‚å› ä¸ºè¯¥å‡½æ•°ä¸ä¼ å…¥selfæˆ–è€…clsï¼Œæ‰€ä»¥ä¸èƒ½è®¿é—®ç±»å±æ€§å’Œå®ä¾‹å±æ€§ã€‚é™æ€æ–¹æ³•çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œä¸ç”¨åˆ›å»ºç±»çš„å®ä¾‹ä¹Ÿèƒ½å¤Ÿè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå…·ä½“è°ƒç”¨æ–¹æ³•å‚è€ƒä¸Šé¢ä»£ç </p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Python </tag>
            
            <tag> é¢å‘å¯¹è±¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 4 æ‹“å±•</title>
      <link href="/archives/c19cb72c.html"/>
      <url>/archives/c19cb72c.html</url>
      
        <content type="html"><![CDATA[<h1 id="python-æ‹“å±•"><a href="#python-æ‹“å±•" class="headerlink" title="python æ‹“å±•"></a>python æ‹“å±•</h1><h2 id="formatè¾“å‡º"><a href="#formatè¾“å‡º" class="headerlink" title="formatè¾“å‡º"></a>formatè¾“å‡º</h2><p>è¿™é‡Œæ€»ç»“ä¸€ä¸‹ format è¾“å‡ºçš„å½¢å¼ï¼Œä¸»è¦ä»¥ <code>{position:format}</code> å½¢å¼å¯¹å˜é‡è¿›è¡Œå¼•ç”¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">name <span class="token operator">=</span> <span class="token string">'Declan'</span>age <span class="token operator">=</span> <span class="token number">23</span><span class="token comment"># æŒ‰ç…§é¡ºåºå¼•ç”¨</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{0} {1} {0}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Declan 23 Declan</span><span class="token comment"># æŒ‰ç…§å…³é”®å­—å¼•ç”¨</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{name} {age}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token operator">=</span>name<span class="token punctuation">,</span> age<span class="token operator">=</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Declan 23</span><span class="token comment"># æ•°å­—æ ¼å¼åŒ–</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 23.00</span><span class="token comment"># è¾“å‡ºå·¦å³å¯¹é½</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:0&gt;10d}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># å‘å³å¯¹é½ï¼Œé»˜è®¤å®½åº¦ä¸º10ï¼Œä¸å¤Ÿä»¥0è¡¥ä½</span><span class="token comment"># 0000000023</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:x&lt;10b}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># å‘å·¦å¯¹é½ï¼Œé»˜è®¤å®½åº¦ä¸º10ï¼Œä¸å¤Ÿä»¥xè¡¥ä½</span><span class="token comment"># 10111xxxxx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¯»å†™æ–‡ä»¶"><a href="#è¯»å†™æ–‡ä»¶" class="headerlink" title="è¯»å†™æ–‡ä»¶"></a>è¯»å†™æ–‡ä»¶</h2><p>Python open() æ–¹æ³•ç”¨äºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿”å›æ–‡ä»¶å¯¹è±¡ï¼Œåœ¨å¯¹æ–‡ä»¶è¿›è¡Œå¤„ç†è¿‡ç¨‹éƒ½éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªå‡½æ•°ï¼Œå¦‚æœè¯¥æ–‡ä»¶æ— æ³•è¢«æ‰“å¼€ï¼Œä¼šæŠ›å‡º OSErrorã€‚<strong>æ³¨æ„ï¼š</strong>ä½¿ç”¨ open() æ–¹æ³•ä¸€å®šè¦ä¿è¯å…³é—­æ–‡ä»¶å¯¹è±¡ï¼Œå³è°ƒç”¨ close() æ–¹æ³•</p><p>open() å‡½æ•°å¸¸ç”¨å½¢å¼æ˜¯æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šæ–‡ä»¶å(file)å’Œæ¨¡å¼(mode)ï¼Œæ›´å¤šå‚æ•°æŸ¥è¯¢  <a href="https://www.runoob.com/python/file-methods.html">èœé¸Ÿæ•™ç¨‹</a>ã€‚ç°åœ¨ä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„ <code>mode</code> å‚æ•°ï¼š</p><ol><li><code>r</code>ï¼Œåªè¯»æ¨¡å¼ï¼Œä¸ºé»˜è®¤è®¾ç½®</li><li><code>w</code>ï¼Œå†™å…¥æ¨¡å¼ï¼Œä¼šæ“¦é™¤æ–‡ä»¶ä¸­ä¹‹å‰çš„å†…å®¹ï¼Œé‡æ–°å†™å…¥ã€‚å¦‚æœæ²¡æœ‰æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ›å»º</li><li><code>a</code>ï¼Œé™„åŠ æ¨¡å¼ï¼Œä¼šåœ¨æ–‡ä»¶æœ«å°¾åŠ å…¥æ–°å†…å®¹</li><li><code>r+</code>ï¼Œè¯»å†™æ¨¡å¼ï¼ŒæŒ‡é’ˆä½äºæ–‡ä»¶å¼€å¤´</li></ol><p>ä¸‹é¢ä»‹ç»æ“ä½œæ–‡ä»¶çš„åŸºæœ¬åŠŸèƒ½ï¼šè¯»å’Œå†™ã€‚æˆ‘ä»¬å…ˆåœ¨ python è„šæœ¬æ‰€åœ¨æ–‡ä»¶å¤¹æ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ <code>test.txt</code> å†…å®¹ä¸º <code>a, b, c</code></p><h3 id="è¯»æ–‡ä»¶"><a href="#è¯»æ–‡ä»¶" class="headerlink" title="è¯»æ–‡ä»¶"></a>è¯»æ–‡ä»¶</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token comment"># ä½¿ç”¨ read(size) è¾“å‡º</span><span class="token comment"># å¦‚æœä¸ä¼ å…¥è¾“å‡ºå­—ç¬¦æ•°é‡ï¼Œåˆ™å…¨éƒ¨è¾“å‡º</span><span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># a, b, c</span><span class="token comment"># è¯»å®Œæ–‡ä»¶è¿‡åéœ€è¦ç§»åŠ¨æŒ‡é’ˆåˆ°æ–‡ä»¶å¼€å¤´æ‰èƒ½é‡æ–°å†è¯»ä¸€é</span><span class="token comment"># ä½¿ç”¨ seek(offset)ï¼Œé»˜è®¤0ä½ç½®ä»æ–‡ä»¶å¼€å¤´ç®—èµ·</span>f<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment"># ä½¿ç”¨ readlines() é€è¡Œè¾“å‡º</span><span class="token comment"># è¯¥æ–¹æ³•è¿”å›å€¼æ˜¯ç”±æ¯ä¸€è¡Œå†…å®¹ç»„æˆçš„ä¸€ä¸ªåˆ—è¡¨</span><span class="token keyword">for</span> i <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment"># a, b, c</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token comment"># ä½¿ç”¨ write(str) åœ¨æŒ‡é’ˆå¤„å†™å…¥å†…å®¹</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\nadd something'</span><span class="token punctuation">)</span><span class="token comment"># a, b, c</span><span class="token comment"># add something</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœéœ€è¦å†™å…¥ä¸­æ–‡ï¼Œå»ºè®®è®¾ç½®ç¼–ç ä¸º utf-8ï¼Œ<code>open(filename, mode, encoding='utf-8')</code></p><h3 id="with-å…³é”®å­—"><a href="#with-å…³é”®å­—" class="headerlink" title="with å…³é”®å­—"></a>with å…³é”®å­—</h3><p>ä¸€äº›å¯¹è±¡å®šä¹‰äº†æ ‡å‡†çš„æ¸…ç†è¡Œä¸ºï¼Œæ— è®ºç³»ç»Ÿæ˜¯å¦æˆåŠŸçš„ä½¿ç”¨äº†å®ƒï¼Œä¸€æ—¦ä¸éœ€è¦å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ‡å‡†çš„æ¸…ç†è¡Œä¸ºå°±ä¼šæ‰§è¡Œã€‚åªéœ€è¦è¯¥å¯¹è±¡å®šä¹‰äº† <code>__enter__ &amp; __exit__</code> é­”æœ¯æ–¹æ³•ï¼Œå…³é”®å­— with å°±å¯ä»¥ä¿è¯è¯¸å¦‚æ–‡ä»¶ä¹‹ç±»çš„å¯¹è±¡åœ¨ä½¿ç”¨å®Œä¹‹åä¸€å®šä¼šæ­£ç¡®çš„æ‰§è¡Œä»–çš„æ¸…ç†æ–¹æ³•</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token comment"># statement</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="os-amp-sys-æ¨¡å—"><a href="#os-amp-sys-æ¨¡å—" class="headerlink" title="os &amp; sys æ¨¡å—"></a>os &amp; sys æ¨¡å—</h2><h3 id="os"><a href="#os" class="headerlink" title="os"></a>os</h3><p><strong>os</strong> æ¨¡å—æä¾›äº†éå¸¸ä¸°å¯Œçš„æ–¹æ³•ç”¨æ¥å¤„ç†æ–‡ä»¶å’Œç›®å½•ã€‚å…³äº os æ¨¡å—æ›´å¤šæ“ä½œå¯ä»¥æŸ¥è¯¢ <a href="https://www.runoob.com/python3/python3-os-file-methods.html">èœé¸Ÿæ•™ç¨‹</a>ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„éƒ¨åˆ†ã€‚ç”±äºè¿”å›çš„è¿™äº›è·¯å¾„å¤šä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²çš„æ“ä½œåœ¨è¿™é‡Œä¹Ÿä¼šç»å¸¸ä½¿ç”¨</p><h4 id="ç³»ç»Ÿç›¸å…³"><a href="#ç³»ç»Ÿç›¸å…³" class="headerlink" title="ç³»ç»Ÿç›¸å…³"></a>ç³»ç»Ÿç›¸å…³</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># æ“ä½œç³»ç»Ÿåç§°</span><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">)</span>   <span class="token comment"># ç¯å¢ƒå˜é‡ï¼Œè¿”å›ä¸€ä¸ªâ€œå­—å…¸â€</span><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>sep<span class="token punctuation">,</span> os<span class="token punctuation">.</span>pathsep<span class="token punctuation">)</span>   <span class="token comment"># è·¯å¾„åˆ†å‰²ç¬¦å·ï¼Œwindows ä¸º \ ;</span><span class="token comment"># æŸ¥çœ‹ä¸€ä¸‹ PATH ç¯å¢ƒå˜é‡</span><span class="token comment"># PATHä¸€èˆ¬ä¸ºç³»ç»ŸæŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„æœç´¢è·¯å¾„</span>PATH <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'PATH'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token keyword">for</span> path <span class="token keyword">in</span> PATH<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ–‡ä»¶å’Œç›®å½•"><a href="#æ–‡ä»¶å’Œç›®å½•" class="headerlink" title="æ–‡ä»¶å’Œç›®å½•"></a>æ–‡ä»¶å’Œç›®å½•</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ospath <span class="token operator">=</span> <span class="token string">'.'</span>  <span class="token comment"># å½“å‰æ–‡ä»¶å¤¹</span>os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">'folder'</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">'folder\subfolder'</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>path<span class="token punctuation">)</span>   <span class="token comment"># åˆ é™¤æ–‡ä»¶</span>os<span class="token punctuation">.</span>removedirs<span class="token punctuation">(</span>path<span class="token punctuation">)</span>   <span class="token comment"># åˆ é™¤ç©ºæ–‡ä»¶å¤¹</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token comment"># è¿”å›æ–‡ä»¶åˆ—è¡¨</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># è¿”å›å½“å‰è·¯å¾„</span><span class="token comment"># os.path æ˜¯ä¸€ä¸ªå¸¸ç”¨æ¨¡å—ï¼Œé‡ç‚¹ä»‹ç»</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>path<span class="token punctuation">)</span>   <span class="token comment"># è¿”å›ç»å¯¹è·¯å¾„</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>path<span class="token punctuation">)</span>   <span class="token comment"># è¿”å›è·¯å¾„çš„ dirname</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>path<span class="token punctuation">)</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token comment"># æŠŠè·¯å¾„åˆ†å‰²æˆ dirname å’Œ basenameï¼Œè¿”å›ä¸€ä¸ªå…ƒç»„</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splittext<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token comment"># å°†è·¯å¾„çš„æ‰©å±•ååˆ†ç¦»å‡ºæ¥</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token operator">*</span>path<span class="token punctuation">)</span><span class="token comment"># å°†å¤šä¸ªåç§°åˆæˆä¸ºä¸€ä¸ªè·¯å¾„å</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="sys"><a href="#sys" class="headerlink" title="sys"></a>sys</h3><p>sys å³ systemï¼Œè¯¥æ¨¡å—æä¾›äº†ä¸€äº›æ¥å£ï¼Œç”¨äºè®¿é—® Python è§£é‡Šå™¨è‡ªèº«ä½¿ç”¨å’Œç»´æŠ¤çš„å˜é‡ã€‚ä¸‹é¢åˆ—ä¸¾ä¸€äº›å¸¸ç”¨æˆå‘˜</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> syssys<span class="token punctuation">.</span>version <span class="token comment"># ç‰ˆæœ¬å·</span>sys<span class="token punctuation">.</span>path    <span class="token comment"># python è§£é‡Šå™¨æœç´¢è·¯å¾„</span>sys<span class="token punctuation">.</span>argv    <span class="token comment"># ä¼ å…¥å½“å‰ python æ–‡ä»¶çš„å‚æ•°åˆ—è¡¨</span>sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># é€€å‡ºçŠ¶æ€ç </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é”™è¯¯å’Œå¼‚å¸¸"><a href="#é”™è¯¯å’Œå¼‚å¸¸" class="headerlink" title="é”™è¯¯å’Œå¼‚å¸¸"></a>é”™è¯¯å’Œå¼‚å¸¸</h2><p>å½“ Python è„šæœ¬å‘ç”Ÿå¼‚å¸¸æ—¶æˆ‘ä»¬éœ€è¦æ•è·å¤„ç†å®ƒï¼Œå¦åˆ™ç¨‹åºä¼šç»ˆæ­¢æ‰§è¡Œ</p><h3 id="tryç›¸å…³"><a href="#tryç›¸å…³" class="headerlink" title="tryç›¸å…³"></a>tryç›¸å…³</h3><p>å¼‚å¸¸å¤„ç†çš„æ–¹æ³•</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    statement<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>    <span class="token comment"># å‘ç”Ÿå¼‚å¸¸æ—¶æ‰§è¡Œçš„ä»£ç </span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Something Wrong!'</span><span class="token punctuation">)</span>    statement<span class="token comment"># å¯ä»¥æœ‰å¤šä¸ª exception è¡¨ç¤ºé¢å¯¹ä¸åŒå¼‚å¸¸çš„å¤„ç†</span><span class="token keyword">except</span> Excepthion_2<span class="token punctuation">:</span>    <span class="token comment"># å‘ç”Ÿå¼‚å¸¸æ—¶æ‰§è¡Œçš„ä»£ç </span>    statement<span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token comment"># æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œçš„ä»£ç </span>    statement<span class="token keyword">finally</span><span class="token punctuation">:</span>    <span class="token comment"># æ— è®ºæœ‰æ²¡æœ‰å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œçš„ä»£ç </span>    statement<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="raise"><a href="#raise" class="headerlink" title="raise"></a>raise</h3><p>Python ä½¿ç”¨ raise è¯­å¥æŠ›å‡ºä¸€ä¸ªæŒ‡å®šçš„å¼‚å¸¸ã€‚æ›´å¤š python å†…ç½®å¼‚å¸¸æŸ¥çœ‹ <a href="https://www.runoob.com/python/python-exceptions.html">èœé¸Ÿæ•™ç¨‹</a></p><h3 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h3><p>Python assertï¼ˆæ–­è¨€ï¼‰ç”¨äºåˆ¤æ–­ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œåœ¨è¡¨è¾¾å¼æ¡ä»¶ä¸º false çš„æ—¶å€™è§¦å‘å¼‚å¸¸ã€‚å…¶åŸºæœ¬è¯­æ³•ä¸º</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">assert</span> expression <span class="token punctuation">[</span><span class="token punctuation">,</span> arguments<span class="token punctuation">]</span><span class="token comment"># ä¸ä»¥ä¸‹ä»£ç ç­‰ä»·</span><span class="token keyword">if</span> <span class="token keyword">not</span> expression<span class="token punctuation">:</span>    <span class="token keyword">raise</span> AssertionError<span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹‹åçš„å‚æ•°ä¸ºæŠ›å‡ºå¼‚å¸¸çš„è¡¥å……ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨åŠ ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">assert</span> <span class="token number">1</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Somenthing Wrong!'</span><span class="token comment"># ä»¥ä¸‹ä¸ºå¼‚å¸¸</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  File <span class="token string">"d:/..."</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>    <span class="token keyword">assert</span> <span class="token number">1</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Somenthing Wrong!'</span>AssertionError<span class="token punctuation">:</span> Somenthing Wrong!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="argparse-æ¨¡å—"><a href="#argparse-æ¨¡å—" class="headerlink" title="argparse æ¨¡å—"></a>argparse æ¨¡å—</h2><p>argsparse æ˜¯ python çš„å‘½ä»¤è¡Œè§£æçš„æ ‡å‡†æ¨¡å—ï¼Œå†…ç½®äºpythonï¼Œä¸éœ€è¦å®‰è£…ã€‚è¿™ä¸ªåº“å¯ä»¥è®©æˆ‘ä»¬<strong>ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­å°±å¯ä»¥å‘ç¨‹åºä¸­ä¼ å…¥å‚æ•°</strong>ï¼ŒåŒæ—¶argparseä¼šè‡ªåŠ¨ç”Ÿæˆå¸®åŠ©æ–‡æ¡£ï¼Œä¼ å…¥å‚æ•° <code>-h</code> æ˜¾ç¤ºã€‚ä¸‹é¢å†™ä¸€ä¸ª python è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># arg.py</span><span class="token keyword">import</span> argparse<span class="token comment"># åˆ›å»º parser å¹¶æ·»åŠ æè¿°ï¼Œé€šå¸¸ä¸ºè¯¥è„šæœ¬çš„ç”¨é€”</span>parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'this is a parser'</span><span class="token punctuation">)</span><span class="token comment"># æ·»åŠ å‚æ•°</span>parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'params'</span><span class="token punctuation">)</span><span class="token comment"># è§£æå‚æ•°</span>args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'show the params:'</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äº argparse æ¨¡å—æ˜¯ä»å‘½ä»¤è¡Œå‘æ–‡ä»¶ä¼ å…¥å‚æ•°ï¼Œæ‰€ä»¥ç°åœ¨åœ¨ cmd ä¸‹ç»™æ–‡ä»¶ååé¢ä¼ å…¥å‚æ•° 123 å¾—åˆ°ç»“æœå¦‚ä¸‹</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">(base) D:\VScodeProjects\LearnManim&gt;python arg.py 123show the params: 123# å‚æ•° 123 ä¼ å…¥åˆ°äº†æ–‡ä»¶ä¸­ parser çš„ä½ç½®å‚æ•° params ä¸­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä» <code>arg.py</code> ä¸­çœ‹å‡ºä½¿ç”¨ argparse æ¨¡å—çš„æ­¥éª¤ï¼š</p><ol><li>åˆ›å»º <code>ArgumentParser</code> å¯¹è±¡</li><li>ç»™å¯¹è±¡ä¸­åŠ å…¥å‚æ•° <code>add_argument</code></li><li>è§£æå¯¹è±¡ï¼Œä¹Ÿå³å°†å‘½ä»¤è¡Œä¸­çš„å‚æ•°ä¼ ç»™ <code>args</code>ï¼Œä¹‹åèƒ½å¤Ÿåƒç±»çš„å±æ€§ä¸€æ ·è°ƒç”¨è¿™äº›å‚æ•° <code>args.params</code></li></ol><p>ä¸‹é¢æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹æ–¹æ³• <code>add_argument</code>ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿæ–¹ä¾¿æˆ‘ä»¬ä»å‘½ä»¤è¡Œè¾“å…¥å‚æ•°ã€‚å…ˆæ¥çœ‹çœ‹è¯¥å‡½æ•°è‡ªå·±çš„å‚æ•°</p><ol><li><p>ä½ç½®å‚æ•°ï¼šä¸å¸¦ <code>-</code> çš„å‚æ•°ã€‚ä»å‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ä¼šæŒ‰ç…§é¡ºåºä¼ ç»™ parser æ·»åŠ çš„å‚æ•°ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º 123ï¼Œè€Œ parser ä¸­æ·»åŠ çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>params</code>ï¼Œæ‰€ä»¥ 123 ä¼ ç»™äº† <code>params</code>ã€‚æ­£å¦‚ python è‡ªèº«å‡½æ•°ä¼ å‚è§„åˆ™ä¸€æ ·ï¼Œä½ç½®å‚æ•°æ˜¯å¿…é¡»è¦ä¼ å…¥çš„å‚æ•°ï¼Œå¦‚æœä¸ä¼ å…¥åˆ™ä¼šæŠ¥é”™</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> D<span class="token punctuation">:</span>\VScodeProjects\LearnManim<span class="token operator">&gt;</span>python arg<span class="token punctuation">.</span>py         usage<span class="token punctuation">:</span> arg<span class="token punctuation">.</span>py <span class="token punctuation">[</span><span class="token operator">-</span>h<span class="token punctuation">]</span> paramsarg<span class="token punctuation">.</span>py<span class="token punctuation">:</span> error<span class="token punctuation">:</span> the following arguments are required<span class="token punctuation">:</span> params<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>å¯é€‰å‚æ•°ï¼šå¸¦ <code>-</code> çš„å‚æ•°ã€‚å¯é€‰å‚æ•°æœ‰ä¸¤ç§æ–¹å¼ï¼Œ</p><ul><li><code>-</code> æŒ‡å®šçŸ­å‚æ•°ï¼Œå¦‚ <code>-h</code></li><li><code>--</code> æŒ‡å®šé•¿å‚æ•°ï¼Œå¦‚ <code>--help</code></li></ul><p>ä¸¤ç§å‚æ•°å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå¯é€‰å‚æ•°å°±åƒ python å‡½æ•°ä¸­ä½¿ç”¨å…³é”®å­—ä¼ å‚ä¸€æ ·ã€‚ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ python è„šæœ¬</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># arg.py</span><span class="token keyword">import</span> argparseparser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'this is a parser'</span><span class="token punctuation">)</span>parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--params'</span><span class="token punctuation">,</span> <span class="token string">'-p'</span><span class="token punctuation">)</span>args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'show the params:'</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨çŸ­å‚æ•°å’Œé•¿å‚æ•°éƒ½å¯ä»¥ï¼Œä¸ä¼ å…¥å‚æ•°ä¹Ÿä¸ä¼šæŠ¥é”™</p><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">(base) D:\VScodeProjects\LearnManim&gt;python arg.py -p 1show the params: 1(base) D:\VScodeProjects\LearnManim&gt;python arg.py --params 1show the params: 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç±»å‹ <code>type</code>ï¼šæŒ‡å®šè¾“å…¥å‚æ•°çš„ç±»å‹</p></li><li><p>é»˜è®¤å€¼ <code>default</code>ï¼šæŒ‡å®šé»˜è®¤å€¼</p></li><li><p>å¸®åŠ© <code>help</code>ï¼šæè¿°è¯¥å‚æ•°çš„åŠŸèƒ½</p></li><li><p>å¿…é¡»å‚æ•° <code>required</code>ï¼šè¯¥å‚æ•°æ˜¯å¦ä¸ºå¿…é¡»ä¼ å…¥çš„å‚æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--params'</span><span class="token punctuation">,</span> <span class="token string">'-p'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'optional number'</span><span class="token punctuation">,</span> required<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åŠ¨ä½œ <code>action</code>ï¼šä¸éœ€è¦åœ¨å‘½ä»¤è¡Œä¼ å…¥å‚æ•°ã€‚å¸¸ç”¨å€¼ä¸º <code>action='store_true'</code> ä¹Ÿå³å½“ä¼ å…¥å…³é”®å­—æ—¶ï¼Œè¯¥å‚æ•°å€¼ä¸º <code>True</code> </p><pre class="line-numbers language-python" data-language="python"><code class="language-python">parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--params'</span><span class="token punctuation">,</span> <span class="token string">'-p'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">(base) D:\VScodeProjects\LearnManim&gt;python arg.py -p  show the params: True<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><p>å½“ç„¶è¿˜æœ‰æ›´å¤šçš„å‚æ•°ï¼Œå°±ä¸åˆ—ä¸¾äº†ï¼Œé‡åˆ°äº†å°±å»æŸ¥æ–‡æ¡£</p><h2 id="re-æ¨¡å—"><a href="#re-æ¨¡å—" class="headerlink" title="re æ¨¡å—"></a>re æ¨¡å—</h2><p>re ä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„ç¼©å†™ï¼Œæ‰€ä»¥éœ€è¦äº†è§£æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åŒ¹é…æŸäº›ç‰¹å®šæ¨¡å¼çš„æ•°æ®ï¼Œåœ¨ç¼–è¾‘æ–‡ä»¶ã€çˆ¬è™«ç­‰æ–¹é¢æœ‰ç€å¹¿æ³›åº”ç”¨ï¼Œä»¥ä¸‹å†…å®¹å‚è€ƒ <a href="https://www.bilibili.com/video/BV19t4y1y7qP/">bilibili</a> &amp; <a href="https://www.runoob.com/regexp/regexp-syntax.html">èœé¸Ÿæ•™ç¨‹</a> å­¦ä¹ ï¼Œè¿™é‡Œè®°å½•ä¸€äº›åŸºæœ¬çš„è¯­æ³•è§„åˆ™ï¼Œä»…ä¾›å¤ä¹ </p><h3 id="æ­£åˆ™åŒ–"><a href="#æ­£åˆ™åŒ–" class="headerlink" title="æ­£åˆ™åŒ–"></a>æ­£åˆ™åŒ–</h3><h4 id="å­—ç¬¦ç»„"><a href="#å­—ç¬¦ç»„" class="headerlink" title="å­—ç¬¦ç»„"></a>å­—ç¬¦ç»„</h4><p><code>[]</code>ï¼Œå­—ç¬¦ç»„ï¼ŒåŒ¹é…é›†åˆä¸­çš„ä»»æ„å­—ç¬¦ï¼Œå¦‚æœæƒ³è¡¨ç¤ºç‰¹æ®Šå­—ç¬¦åˆ™éœ€è¦è½¬ä¹‰å­—ç¬¦ <code>\</code></p><p> <code>^</code>ï¼Œåœ¨å­—ç¬¦ç»„å†…è¡¨ç¤ºå–åï¼Œåœ¨å­—ç¬¦ç»„å¤–è¡¨ç¤ºåŒ¹é…å¼€å¤´</p><p><code>$</code>ï¼ŒåŒ¹é…å­—ç¬¦ä¸²çš„æœ«å°¾</p><h4 id="å¿«æ·è¡¨ç¤º"><a href="#å¿«æ·è¡¨ç¤º" class="headerlink" title="å¿«æ·è¡¨ç¤º"></a>å¿«æ·è¡¨ç¤º</h4><p><code>\d</code>ï¼Œæ•°å­—</p><p><code>\s</code>ï¼Œç©ºæ ¼</p><p><code>\w</code>ï¼Œå­—ç¬¦ï¼ˆå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼‰</p><p>å¤§å†™ä¸ºå…¶å–å <code>\D</code> <code>\S</code> <code>\W</code> è¡¨ç¤ºéæ•°å­—ã€éç©ºæ ¼ã€éå­—ç¬¦</p><p><code>.</code>ï¼Œä¸ºä»»æ„å•ä¸ªå­—ç¬¦ï¼Œæ¢è¡Œç¬¦é™¤å¤–</p><h4 id="é™å®šç¬¦ï¼ˆæ§åˆ¶é‡å¤æ¬¡æ•°ï¼‰"><a href="#é™å®šç¬¦ï¼ˆæ§åˆ¶é‡å¤æ¬¡æ•°ï¼‰" class="headerlink" title="é™å®šç¬¦ï¼ˆæ§åˆ¶é‡å¤æ¬¡æ•°ï¼‰"></a>é™å®šç¬¦ï¼ˆæ§åˆ¶é‡å¤æ¬¡æ•°ï¼‰</h4><p><code>{n}</code>ï¼Œ<code>{n,}</code>ï¼Œ<code>{n, m}</code> n, m ä¸ºéè´Ÿæ•´æ•°ï¼Œè¡¨ç¤ºåŒ¹é…é‡å¤æ¬¡æ•°æˆ–è€…é‡å¤åŒºé—´</p><p><code>+</code>ï¼ŒåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œç›¸å½“äº <code>{1,}</code></p><p><code>*</code>ï¼ŒåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œç›¸å½“äº <code>{0,}</code></p><p><code>?</code> å¯é€‰å­—ç¬¦ï¼ŒåŒ¹é…0æ¬¡æˆ–1æ¬¡ã€‚ä¹Ÿå¯è¡¨ç¤ºéè´ªå©ªæ¨¡å¼ï¼ˆæœ€å°åŒ¹é…ï¼‰ï¼Œå¸¸ç”¨äº <code>+ or *</code> ä¹‹åã€‚ä¾‹å¦‚éœ€è¦åŒ¹é… <code>&lt;mark&gt;.*&lt;mark&gt;</code> è¿™æ ·çš„æ¨¡å¼ï¼Œå¦‚æœé‡åˆ°å­—ç¬¦ä¸² <code>&lt;mark&gt;1&lt;mark&gt; &lt;mark&gt;2&lt;mark&gt;</code> å°†ä¼šåŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸èƒ½åˆ† <code>&lt;mark&gt;1&lt;mark&gt;</code> å’Œ <code>&lt;mark&gt;2&lt;mark&gt;</code>ï¼Œè¿™æ—¶ä½¿ç”¨æœ€å°åŒ¹é…å³å¯å®Œæˆ <code>&lt;mark&gt;.*ï¼Ÿ&lt;mark&gt;</code></p><h4 id="å®šä½ç¬¦"><a href="#å®šä½ç¬¦" class="headerlink" title="å®šä½ç¬¦"></a>å®šä½ç¬¦</h4><p><code>$</code>ï¼ŒåŒ¹é…å­—ç¬¦ä¸²çš„æœ«å°¾</p><p><code>^</code>ï¼ŒåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œä½†å½“ <code>^</code> å’Œ <script type="math/tex">` åŒæ—¶å‡ºç°æ—¶ä¸ä»£è¡¨å¼€å¤´å’Œæœ«å°¾åˆ†åˆ«åŒ¹é…ï¼Œè€Œæ˜¯ä»£è¡¨æ•´ä¸ªå­—ç¬¦ä¸²å¿…é¡»åŒ¹é…è¯¥è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ `^python</script> ä»…èƒ½åŒ¹é… python è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸èƒ½åŒ¹é…å¼€å¤´æœ«å°¾ä¸º python çš„å­—ç¬¦ä¸²ï¼Œåƒ python â€¦ python æ˜¯ä¸è¢«åŒ¹é…çš„</p><p><code>\b</code>ï¼ŒåŒ¹é…å•è¯è¾¹ç•Œï¼Œå³å­—ä¸ç©ºæ ¼çš„ä½ç½®</p><h4 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h4><p><code>()</code>ï¼Œè¡¨ç¤ºæ•è·åˆ†ç»„ï¼Œ<code>()</code> ä¼šæŠŠæ¯ä¸ªåˆ†ç»„é‡Œçš„åŒ¹é…çš„å€¼ä¿å­˜èµ·æ¥ï¼Œ å¤šä¸ªåŒ¹é…å€¼å¯ä»¥é€šè¿‡è½¬ä¹‰ç¬¦+æ•°å­— n æ¥æŸ¥çœ‹ï¼Œä¸¾ä¸ªä¾‹å­ <code>(expression_1)(expression_2)\2\1</code></p><p><code>(?:)</code>ï¼Œä¸æ•è·ï¼Œåªä½¿ç”¨åˆ†ç»„åŠŸèƒ½</p><p><code>(express_1|express_2|express_3)</code>ï¼Œé€‰æ‹©ï¼Œæ»¡è¶³ä»»ä¸€è¡¨è¾¾å¼å³åŒ¹é…</p><p><code>(?=express)</code>ï¼Œæ­£å‘å…ˆè¡Œæ–­è¨€ï¼Œé¡ºåºä»å·¦å¾€å³çœ‹ï¼Œåˆ¤æ–­åœ¨è¯¥ä½ç½®çš„å­—ç¬¦æ˜¯å¦åŒ¹é…è¡¨è¾¾å¼ï¼Œå¦‚æ»¡è¶³è¡¨è¾¾å¼åˆ™åŒ¹é…æ•´ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚ <code>re(?=gular)</code> åªåŒ¹é… regular ä¸­çš„ re è€Œä¸åŒ¹é…å…¶ä»–å•è¯ä¸­çš„ re</p><p><code>(?&lt;=express)</code>ï¼Œæ­£å‘åè¡Œæ–­è¨€ï¼Œé¡ºåºä»å³å¾€å·¦ï¼Œå¦‚ <code>(?&lt;=re)open</code> åªåŒ¹é… reopen ä¸­çš„ openï¼Œä¸åŒ¹é…å…¶ä»–å•è¯ä¸­çš„ open</p><p><code>(?!express)</code>ï¼Œé€†å‘å…ˆè¡Œæ–­è¨€ï¼Œä¸æ»¡è¶³è¡¨è¾¾å¼åˆ™åŒ¹é…</p><p><code>(?&lt;!express)</code>ï¼Œé€†å‘åè¡Œæ–­è¨€</p><h3 id="æ¨¡å—æ–¹æ³•"><a href="#æ¨¡å—æ–¹æ³•" class="headerlink" title="æ¨¡å—æ–¹æ³•"></a>æ¨¡å—æ–¹æ³•</h3><ol><li><p><code>re.match(pattern, string, flags=0)</code>ï¼Œå°è¯•ä»å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®åŒ¹é…ä¸€ä¸ªæ¨¡å¼ï¼Œå¦‚æœä¸æ˜¯èµ·å§‹ä½ç½®åŒ¹é…æˆåŠŸçš„è¯ï¼Œmatch()å°±è¿”å›noneï¼ŒåŒ¹é…æˆåŠŸåˆ™è¿”å›åŒ¹é…å¯¹è±¡ MatchObject</p><p><code>flags</code> ä¸ºæ ‡å¿—ä½ï¼Œç”¨äºæ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ï¼Œå‚è€ƒ <a href="https://www.runoob.com/python/python-reg-expressions.html#flags">æ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦ - å¯é€‰æ ‡å¿—</a></p><p>ä½¿ç”¨ group(num) æˆ– groups() åŒ¹é…å¯¹è±¡å‡½æ•°æ¥è·å–åŒ¹é…è¡¨è¾¾å¼ä¸­çš„åˆ†ç»„ï¼Œå³è¡¨è¾¾å¼ä¸­è¦æœ‰æ‹¬å·</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> reline <span class="token operator">=</span> <span class="token string">"Cats are smarter than dogs"</span> a <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span> <span class="token string">r'(.*) are (.*?) .*'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Cats smarter</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># ('Cats', 'smarter')</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>group() ä¹Ÿå¯ä»¥ä¸€æ¬¡è¾“å…¥å¤šä¸ªç»„å·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒå°†è¿”å›ä¸€ä¸ªåŒ…å«é‚£äº›ç»„æ‰€å¯¹åº”å€¼çš„å…ƒç»„</p><p>å¦‚æœæ²¡æœ‰åˆ†ç»„ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ group() è°ƒç”¨ï¼Œä¸ç”¨ä¼ å‚ï¼Œé»˜è®¤ä¼ å…¥0</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> reline <span class="token operator">=</span> <span class="token string">"Cats are smarter than dogs"</span> a <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span> <span class="token string">r'.* are .*? .*'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># print(a.group(0)) is the same</span><span class="token comment"># Cats are smarter than dogs</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>re.search(pattern, string, flags=0)</code>ï¼Œæ‰«ææ•´ä¸ªå­—ç¬¦ä¸²å¹¶è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„åŒ¹é…å¯¹è±¡ MatchObject</p></li><li><p><code>re.findall(pattern, string, flags=0)</code>ï¼Œåœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°æ­£åˆ™è¡¨è¾¾å¼æ‰€åŒ¹é…çš„æ‰€æœ‰<strong>å­ä¸²</strong>ï¼Œå¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ï¼Œåˆ™è¿”å›ç©ºåˆ—è¡¨</p></li><li><p><code>re.sub(pattern, repl, string, count=0, flags=0)</code> ç”¨äºæ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„åŒ¹é…é¡¹</p></li><li><p><code>re.compile(pattern, flags=0)</code> ï¼Œæ ¹æ®ä¸€ä¸ªæ¨¡å¼å­—ç¬¦ä¸²å’Œå¯é€‰çš„æ ‡å¿—å‚æ•°ç”Ÿæˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œè¯¥å¯¹è±¡èƒ½å¤Ÿè°ƒç”¨ä¸€ç³»åˆ—çš„æ–¹æ³•ç”¨äºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å’Œæ›¿æ¢</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> reline <span class="token operator">=</span> <span class="token string">"re short for regular expression"</span> pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span> <span class="token string">r're'</span><span class="token punctuation">)</span>all_list <span class="token operator">=</span> pattern<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>line<span class="token punctuation">)</span>sub <span class="token operator">=</span> pattern<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'RE'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>all_list<span class="token punctuation">)</span><span class="token comment"># ['re', 're', 're']</span><span class="token keyword">print</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token comment"># RE short for REgular expREssion</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h2 id="å‘é€é‚®ä»¶"><a href="#å‘é€é‚®ä»¶" class="headerlink" title="å‘é€é‚®ä»¶"></a>å‘é€é‚®ä»¶</h2><p>å‚è€ƒé“¾æ¥ï¼š[å»–é›ªå³°][<a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017790702398272">https://www.liaoxuefeng.com/wiki/1016959663602400/1017790702398272</a>], <a href="https://blog.csdn.net/qq_24285815/article/details/98945385">CSDN</a></p><p>ç›´æ¥ä¸Šä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> smtplib<span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> Header<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> MIMEText<span class="token keyword">from</span> email<span class="token punctuation">.</span>utils <span class="token keyword">import</span> parseaddr<span class="token punctuation">,</span> formataddrmsg <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span><span class="token string">'hello, send by Python...'</span><span class="token punctuation">,</span> <span class="token string">'plain'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token comment"># è¾“å…¥Emailåœ°å€å’Œå£ä»¤:</span>from_addr <span class="token operator">=</span> <span class="token string">'hongkun20sme@smail.nju.edu.cn'</span>password <span class="token operator">=</span> <span class="token string">'your_passwd'</span><span class="token comment"># è¾“å…¥æ”¶ä»¶äººåœ°å€:</span>to_addr <span class="token operator">=</span> <span class="token string">'hongkun20sme@smail.nju.edu.cn'</span><span class="token comment"># è¾“å…¥SMTPæœåŠ¡å™¨åœ°å€: smtp.exmail.qq.com(ä½¿ç”¨SSLï¼Œç«¯å£å·465)</span>smtp_server <span class="token operator">=</span> <span class="token string">'smtp.exmail.qq.com'</span>port <span class="token operator">=</span> <span class="token number">465</span><span class="token comment"># ç¼–ç åå­—å’Œåœ°å€</span><span class="token keyword">def</span> <span class="token function">_format_addr</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    name<span class="token punctuation">,</span> addr <span class="token operator">=</span> parseaddr<span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token keyword">return</span> formataddr<span class="token punctuation">(</span><span class="token punctuation">(</span>Header<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>msg <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span><span class="token string">'hello, send by Python...'</span><span class="token punctuation">,</span> <span class="token string">'plain'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token comment"># å‘ä»¶äººï¼ˆä»…ä½œå†…å®¹ï¼Œä¸å®é™…å‚ä¸ SMTP æœåŠ¡ï¼‰</span>msg<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> _format_addr<span class="token punctuation">(</span><span class="token string">'MailBot &lt;%s&gt;'</span> <span class="token operator">%</span> from_addr<span class="token punctuation">)</span><span class="token comment"># æ”¶ä»¶äºº</span>msg<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> _format_addr<span class="token punctuation">(</span><span class="token string">'Declan Chen &lt;%s&gt;'</span> <span class="token operator">%</span> to_addr<span class="token punctuation">)</span><span class="token comment"># ä¸»é¢˜</span>msg<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token string">'æ¥è‡ªSMTPçš„é—®å€™â€¦â€¦'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># è¿™é‡Œä¸åŸå»–é›ªå³°æ•™ç¨‹ä¸­ä½¿ç”¨çš„ SMTP() æ–¹æ³•ä¸ä¸€æ ·ï¼Œä½¿ç”¨äº† SMTP_SSL() æ–¹æ³•</span>server <span class="token operator">=</span> smtplib<span class="token punctuation">.</span>SMTP_SSL<span class="token punctuation">(</span>smtp_server<span class="token punctuation">,</span> port<span class="token punctuation">)</span>server<span class="token punctuation">.</span>set_debuglevel<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>server<span class="token punctuation">.</span>login<span class="token punctuation">(</span>from_addr<span class="token punctuation">,</span> password<span class="token punctuation">)</span>server<span class="token punctuation">.</span>sendmail<span class="token punctuation">(</span>from_addr<span class="token punctuation">,</span> <span class="token punctuation">[</span>to_addr<span class="token punctuation">]</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>as_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>server<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><h3 id="æ—¶é—´å’Œæ—¥æœŸ"><a href="#æ—¶é—´å’Œæ—¥æœŸ" class="headerlink" title="æ—¶é—´å’Œæ—¥æœŸ"></a>æ—¶é—´å’Œæ—¥æœŸ</h3><h3 id="è¿›ç¨‹ã€çº¿ç¨‹"><a href="#è¿›ç¨‹ã€çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ã€çº¿ç¨‹"></a>è¿›ç¨‹ã€çº¿ç¨‹</h3><h3 id="Python-çˆ¬è™«"><a href="#Python-çˆ¬è™«" class="headerlink" title="Python çˆ¬è™«"></a>Python çˆ¬è™«</h3>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Python </tag>
            
            <tag> æ‹“å±• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 2 æ•°æ®ç»“æ„</title>
      <link href="/archives/760ade0a.html"/>
      <url>/archives/760ade0a.html</url>
      
        <content type="html"><![CDATA[<h1 id="Python-String-amp-Data-Structure"><a href="#Python-String-amp-Data-Structure" class="headerlink" title="Python String &amp; Data Structure"></a>Python String &amp; Data Structure</h1><h2 id="String-å­—ç¬¦ä¸²"><a href="#String-å­—ç¬¦ä¸²" class="headerlink" title="String å­—ç¬¦ä¸²"></a>String å­—ç¬¦ä¸²</h2><p>python ç”¨å•å¼•å· <code>''</code> æˆ–è€…åŒå¼•å· <code>""</code> æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œä¸‰å¼•å· <code>'''</code> å…è®¸è·¨å¤šè¡Œçš„å­—ç¬¦ä¸²</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">s1 <span class="token operator">=</span> <span class="token string">'hello, world!'</span>s2 <span class="token operator">=</span> <span class="token string">"hello, world!"</span><span class="token comment"># ä»¥ä¸‰ä¸ªåŒå¼•å·æˆ–å•å¼•å·å¼€å¤´çš„å­—ç¬¦ä¸²å¯ä»¥æŠ˜è¡Œ</span>s3 <span class="token operator">=</span> <span class="token triple-quoted-string string">"""hello, world!"""</span><span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å­—ç¬¦ä¸²ä¸­å¯ä»¥ä½¿ç”¨åæ–œæ  <code>\</code> è¡¨ç¤ºè½¬ä¹‰ï¼Œå¦‚ <code>\n, \t</code> ç­‰è½¬ä¹‰å­—ç¬¦ï¼Œå¦‚æœå¸Œæœ›è¾“å…¥åŸå­—ç¬¦ä¸²å¯åœ¨å¼•å·å‰åŠ  r å­—æ¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">s1 <span class="token operator">=</span> <span class="token string">'\n\\hello, world!\\\n'</span>s2 <span class="token operator">=</span> <span class="token string">r'\n\\hello, world!\\\n'</span><span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å­—ç¬¦ä¸²è¿ç®—"><a href="#å­—ç¬¦ä¸²è¿ç®—" class="headerlink" title="å­—ç¬¦ä¸²è¿ç®—"></a>å­—ç¬¦ä¸²è¿ç®—</h3><p>å­—ç¬¦ä¸²æ¥å— <code>+, *, [:], in</code> ç­‰è¿ç®—ï¼Œå¯¹å­—ç¬¦ä¸²å†…å®¹è¿›è¡Œåˆå¹¶ã€é‡å¤ã€æˆªå–ã€æˆå‘˜è¿ç®—</p><h3 id="å­—ç¬¦ä¸²æ ¼å¼åŒ–"><a href="#å­—ç¬¦ä¸²æ ¼å¼åŒ–" class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼åŒ–"></a>å­—ç¬¦ä¸²æ ¼å¼åŒ–</h3><p>å½“å­—ç¬¦ä¸²ä¸­éœ€è¦è¡¨ç¤ºå˜é‡æ—¶ï¼Œæ ¼å¼åŒ–è¡¨ç¤ºå°†ä¼šéå¸¸æœ‰ç”¨ï¼ŒåŸºæœ¬ç”¨æ³•å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">num<span class="token punctuation">,</span> pai <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.1415926</span>s <span class="token operator">=</span> <span class="token string">'here is a number %d, and pai is %.2f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>num<span class="token punctuation">,</span> pai<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åŸºæœ¬é€»è¾‘å°±æ˜¯ï¼Œä¸€ä¸ªèåœä¸€ä¸ªå‘ï¼Œæƒ³è¦åœ¨å­—ç¬¦ä¸²ä¸­æ’å…¥å˜é‡ï¼Œå°±åœ¨éœ€è¦æ’å…¥çš„åœ°æ–¹ç”¨ç›¸åº”çš„ç¬¦å·æ›¿ä»£ï¼Œç„¶ååœ¨å­—ç¬¦ä¸²åç”¨ <code>%</code> æŒ‡æ˜å˜é‡</p><p>è¿™é‡Œåˆ—å‡ ä¸ªå¸¸ç”¨çš„æ›¿ä»£ç¬¦å·ï¼š<code>%d, %f, %s, %e</code>ï¼Œæœ€åä¸€ä¸ª <code>%e</code> è¡¨ç¤ºç§‘å­¦è®¡æ•°</p><h3 id="å­—ç¬¦ä¸²å†…å»ºå‡½æ•°"><a href="#å­—ç¬¦ä¸²å†…å»ºå‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å†…å»ºå‡½æ•°"></a>å­—ç¬¦ä¸²å†…å»ºå‡½æ•°</h3><p>å­—ç¬¦ä¸²è‡ªå¸¦äº†å¾ˆå¤šæ–¹ä¾¿çš„æ–¹æ³•ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„ï¼Œstring ä»£è¡¨æŸä¸ªå­—ç¬¦ä¸²</p><ol><li><code>sting.count(str)</code>ï¼Œå­—ç¬¦ä¸²ä¸­æœ‰å¤šå°‘ä¸ª str</li><li><code>string.find(str)</code>ï¼Œstr åœ¨å­—ç¬¦ä¸²ä¸­çš„å“ªä¸ªä½ç½®ï¼Œå¦‚ä¸å­˜åœ¨è¿”å›-1</li><li><code>string.format(*args, **kwargs)</code>ï¼Œ<strong>å¢å¼ºç‰ˆæ ¼å¼åŒ–æ–¹æ³•ï¼Œéå¸¸æ¨èä½¿ç”¨è¯¥å‡½æ•°æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²</strong>ï¼Œå‚è€ƒ <a href="https://www.runoob.com/python/att-string-format.html">èœé¸Ÿæ•™ç¨‹</a></li><li><code>string.split(str)</code>ï¼Œ<strong>æŒ‰ç…§ str åˆ†éš”å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨</strong></li><li><code>string.join(Iterable)</code>ï¼Œå°†å¤šä¸ªå­—ç¬¦ä¸²ä½¿ç”¨ string è¿æ¥èµ·æ¥</li><li><code>string.replace(str1, str2)</code>ï¼Œå°† str1 æ›¿æ¢ä¸º str2</li></ol><h2 id="List-åˆ—è¡¨"><a href="#List-åˆ—è¡¨" class="headerlink" title="List åˆ—è¡¨"></a>List åˆ—è¡¨</h2><p>åˆ—è¡¨æ˜¯æœ€åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é¡ºåºå­˜å‚¨ä¸åŒçš„å¯¹è±¡ã€‚åœ¨ python ä¸­åˆ›å»ºåˆ—è¡¨ï¼š</p><ol><li>ç›´æ¥èµ‹å€¼ <code>LIST = []</code></li><li>ç±»å‹è½¬æ¢ <code>list(tuple)</code></li></ol><h3 id="åˆ—è¡¨è¿ç®—"><a href="#åˆ—è¡¨è¿ç®—" class="headerlink" title="åˆ—è¡¨è¿ç®—"></a>åˆ—è¡¨è¿ç®—</h3><p>åˆ—è¡¨ä¹Ÿæ¥å—ï¼š<code>+, *, [:], in</code> ç­‰è¿ç®—ç¬¦</p><h3 id="python-å†…ç½®å‡½æ•°æ“ä½œåˆ—è¡¨"><a href="#python-å†…ç½®å‡½æ•°æ“ä½œåˆ—è¡¨" class="headerlink" title="python å†…ç½®å‡½æ•°æ“ä½œåˆ—è¡¨"></a>python å†…ç½®å‡½æ•°æ“ä½œåˆ—è¡¨</h3><ol><li><code>len(list)</code></li><li><code>max(list)</code> &amp; <code>min(list)</code></li><li><code>for i in list</code> &amp; <code>for index, value in enumerate(list)</code>ï¼Œå¯¹åˆ—è¡¨è¿›è¡Œå¾ªç¯éå†</li></ol><h3 id="åˆ—è¡¨å†…å»ºå‡½æ•°"><a href="#åˆ—è¡¨å†…å»ºå‡½æ•°" class="headerlink" title="åˆ—è¡¨å†…å»ºå‡½æ•°"></a>åˆ—è¡¨å†…å»ºå‡½æ•°</h3><ol><li><code>list.append(obj)</code> &amp; <code>list.insert(index, obj)</code></li><li><code>list.remove(obj)</code> &amp; <code>list.pop()</code></li><li><code>list.sort(reverse=False)</code>ï¼Œå°†åˆ—è¡¨æŒ‰ç…§ä¸Šå‡å€¼æ’åˆ—ï¼Œè¿”å› None</li><li><code>list.copy()</code></li></ol><h2 id="Tuple-å…ƒç»„"><a href="#Tuple-å…ƒç»„" class="headerlink" title="Tuple å…ƒç»„"></a>Tuple å…ƒç»„</h2><p>å…ƒç»„å’Œåˆ—è¡¨ç±»ä¼¼ï¼Œä¹Ÿæ˜¯çº¿æ€§è¡¨çš„ä¸€ç§ï¼Œä¸è¿‡åœ¨å…ƒç»„å»ºç«‹è¿‡åï¼Œå…¶æˆå‘˜æ˜¯ä¸èƒ½å¤Ÿè¢«ä¿®æ”¹çš„ï¼Œå¢åŠ å’Œåˆ é™¤æˆå‘˜ä¹Ÿæ˜¯ä¸æ”¯æŒçš„ï¼Œåœ¨ python ä¸­åˆ›å»ºå…ƒç»„ï¼š</p><ol><li>ç›´æ¥èµ‹å€¼ <code>TUPLE = (1,)</code></li><li>ç±»å‹è½¬æ¢ <code>tuple(list)</code></li></ol><h3 id="å…ƒç»„è¿ç®—"><a href="#å…ƒç»„è¿ç®—" class="headerlink" title="å…ƒç»„è¿ç®—"></a>å…ƒç»„è¿ç®—</h3><p>å…ƒç»„æ”¯æŒ <code>+, *, [:], in</code> ç­‰è¿ç®—ç¬¦ï¼Œä½†æ³¨æ„ï¼Œç”±äºå…ƒç»„æˆå‘˜ä¸èƒ½è¢«ä¿®æ”¹çš„æ€§è´¨ï¼Œæ‰€ä»¥ä¸èƒ½å¤Ÿå¯¹ç´¢å¼•å€¼è¿›è¡Œæ–°çš„èµ‹å€¼ã€‚è™½ç„¶ä¸èƒ½å¢åŠ æˆå‘˜ï¼Œä½†æ˜¯ä»å¯ä»¥ä½¿ç”¨ <code>+</code> è¿ç®—ï¼Œå°†ä¸¤ä¸ªå…ƒç»„åˆå¹¶</p><h3 id="python-å†…ç½®å‡½æ•°æ“ä½œå…ƒç»„"><a href="#python-å†…ç½®å‡½æ•°æ“ä½œå…ƒç»„" class="headerlink" title="python å†…ç½®å‡½æ•°æ“ä½œå…ƒç»„"></a>python å†…ç½®å‡½æ•°æ“ä½œå…ƒç»„</h3><p>åœ¨åˆ—è¡¨å½“ä¸­èƒ½ç”¨çš„æ“ä½œä¹Ÿèƒ½ç”¨ä½œå…ƒç»„ï¼Œæ¯•ç«Ÿå…ƒç»„å¯ä»¥çœ‹ä½œä¸å¯ä¿®æ”¹æˆå‘˜çš„åˆ—è¡¨</p><h3 id="å…ƒç»„å†…å»ºå‡½æ•°"><a href="#å…ƒç»„å†…å»ºå‡½æ•°" class="headerlink" title="å…ƒç»„å†…å»ºå‡½æ•°"></a>å…ƒç»„å†…å»ºå‡½æ•°</h3><p>å…ƒç»„çš„å†…å»ºå‡½æ•°å°±ä¸å¦‚åˆ—è¡¨çš„ä¸°å¯Œäº†ï¼Œå¯ä»¥è¯´å…ƒç»„æœ‰çš„ï¼Œåˆ—è¡¨éƒ½æœ‰ã€‚ä¸‹é¢åˆ—ä¸¾ä¸¤ä¸ª</p><ol><li><p><code>tuple.count(obj)</code></p></li><li><p><code>tuple.index(obj)</code>ï¼Œè¿”å› obj åœ¨å…ƒç»„ä¸­çš„ç´¢å¼•æ•°ï¼Œè‹¥å…ƒç»„ä¸­ä¸å­˜åœ¨ obj åˆ™æŠ¥é”™</p></li></ol><p>æœ€åæä¸€å¥ï¼Œä¸ºä»€ä¹ˆæœ‰äº†åˆ—è¡¨è¿˜éœ€è¦æœ‰å…ƒç»„è¿™æ ·çš„æ•°æ®ç±»å‹å‘¢ï¼Ÿéƒ¨åˆ†åŸå› æ˜¯å…ƒç»„å¯ä»¥ç”¨äºä¿æŠ¤ä¸€äº›æ•°æ®ï¼Œè®©å…¶ä¸è¢«ä¿®æ”¹ï¼Œå¹¶ä¸”åˆ›å»ºå…ƒç»„åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šçš„ä»£ä»·æ›´å°</p><h2 id="Dict-å­—å…¸"><a href="#Dict-å­—å…¸" class="headerlink" title="Dict å­—å…¸"></a>Dict å­—å…¸</h2><p>å­—å…¸ä¹Ÿæ˜¯ä¸€ç§å¯å˜å®¹å™¨ï¼Œå…¶ä¸æ˜¯é€šè¿‡ index ç´¢å¼•è·å¾—å®¹å™¨å†…çš„å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ key: value å¯¹ï¼Œå°† key æ˜ å°„åˆ°å…¶å¯¹åº”çš„ valueã€‚æ¢å¥è¯è¯´å°±æ˜¯é€šè¿‡ key æ¥è·å¾—å®¹å™¨å†…çš„å¯¹è±¡ã€‚å¾ˆæ˜æ˜¾è¿™æ ·çš„æ˜ å°„æ€§è´¨éœ€è¦ key æ˜¯å”¯ä¸€çš„ï¼ŒåŒæ—¶ python ä¹Ÿè¦æ±‚ key æ˜¯ä¸å¯å˜çš„ï¼Œå¦‚æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå…ƒç»„ã€‚åˆ›å»ºå­—å…¸çš„æ–¹å¼ï¼š</p><ol><li><p>ç›´æ¥èµ‹å€¼ <code>DICT = {key_1ï¼švalue_1}</code></p></li><li><p>é€šè¿‡å†…ç½®å‡½æ•° <code>dict()</code> åˆ›å»ºï¼š</p><ul><li><p><code>dict(**kwargs)</code>ï¼Œä¼ å…¥ key=value å¯¹ï¼Œä¾‹å¦‚ <code>DICT = dict(a=1, b=2)</code>ï¼Œæ³¨æ„è¿™é‡Œ key ä¸ç”¨è½¬åŒ–ä¸ºå­—ç¬¦ä¸²å½¢å¼</p></li><li><p><code>dict(iterable, **kwargs)</code>ï¼Œä¼ å…¥å¯è¿­ä»£å¯¹è±¡ï¼Œå…¶ä¸­å¯è¿­ä»£å¯¹è±¡ä¸­çš„æˆå‘˜å¿…é¡»ä¸ºäºŒå…ƒå…ƒç»„ï¼ŒåŒæ—¶ä¹Ÿå¯ä»»æ„ä¼ å…¥ key=value å¯¹ï¼Œä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­</p></li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">ITER <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token comment"># ITER ä¹Ÿå¯ä»¥é€šè¿‡ python å†…ç½®å‡½æ•° zip() ç”Ÿæˆ</span><span class="token comment"># ITER = zip(['a', 'b'], [1, 2])</span>DICT <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>ITER<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>dict.fromkeys(iterable, value)</code>ï¼Œä¼ å…¥å¯è¿­ä»£å¯¹è±¡ï¼Œæ¯”å¦‚åˆ—è¡¨ã€å…ƒç»„éƒ½å¯ä»¥ï¼Œå°†è¿™äº›é¡ºåºè¡¨çš„æˆå‘˜ä½œä¸º key åˆ›å»ºå­—å…¸ï¼Œå¹¶ä¸”æ‰€æœ‰çš„ value éƒ½ç»Ÿä¸€åˆå§‹åŒ–</li></ul></li></ol><h3 id="å­—å…¸è¿ç®—"><a href="#å­—å…¸è¿ç®—" class="headerlink" title="å­—å…¸è¿ç®—"></a>å­—å…¸è¿ç®—</h3><p>å­—å…¸æ”¯æŒ <code>[], in</code> è¿ç®—ï¼Œæ˜¾ç„¶ <code>+, *</code> è¿ç®—å¯¹äºå­—å…¸æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚è€Œ <code>[]</code> è¿ç®—åŒºåˆ«äºåˆ—è¡¨å’Œå…ƒç»„ï¼Œç´¢å¼•å€¼ä¸æ˜¯æ•°å­—è€Œæ˜¯ key</p><h3 id="python-å†…ç½®å‡½æ•°æ“ä½œå­—å…¸"><a href="#python-å†…ç½®å‡½æ•°æ“ä½œå­—å…¸" class="headerlink" title="python å†…ç½®å‡½æ•°æ“ä½œå­—å…¸"></a>python å†…ç½®å‡½æ•°æ“ä½œå­—å…¸</h3><ol><li><p><code>len(dict)</code></p></li><li><p><code>for i in dict</code>ï¼Œæ³¨æ„è¿™æ ·å½¢å¼çš„å¾ªç¯åªä¼šå¯¹å­—å…¸ä¸­çš„ key è¿›è¡Œå¾ªç¯éå†ã€‚å¦‚æœæƒ³è¦åŒæ—¶å¯¹ key å’Œ value å¾ªç¯éå†åˆ™éœ€è¦è°ƒç”¨å­—å…¸å†…å»ºå‡½æ•° <code>dict.items()</code> è¿”å›å¯éå†çš„ (key, value) å…ƒç»„æ•°ç»„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">DICT <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> DICT<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment"># result: a b</span><span class="token keyword">for</span> key<span class="token punctuation">,</span>value <span class="token keyword">in</span> DICT<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s:%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># result: a:1 b:2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="å­—å…¸å†…å»ºå‡½æ•°"><a href="#å­—å…¸å†…å»ºå‡½æ•°" class="headerlink" title="å­—å…¸å†…å»ºå‡½æ•°"></a>å­—å…¸å†…å»ºå‡½æ•°</h3><ol><li><code>dict.get(key, default=None)</code>ï¼Œè¿”å›æŒ‡å®šé”®çš„å€¼ï¼Œå¦‚æœ key å€¼ä¸åœ¨å­—å…¸ä¸­åˆ™è¿”å› default å€¼ã€‚å¦‚æœå¸Œæœ›ä¸å­˜åœ¨ key å€¼æ—¶ï¼Œä¸ä»…è¿”å› default å€¼ï¼Œè¿˜åˆ›å»ºè¯¥ key å€¼ï¼Œåˆ™ä½¿ç”¨ <code>dict.setdefault(key, default=None)</code>ã€‚æ¯”è¾ƒç±»ä¼¼çš„ï¼Œå¦‚æœå­—å…¸ä¸­ä¸å­˜åœ¨æŸä¸ª keyï¼Œé‚£ä¹ˆä½¿ç”¨ <code>dict[key] = value</code> ä¹Ÿä¼šè‡ªåŠ¨åœ¨å­—å…¸ä¸­åˆ›å»º key, value å¯¹</li><li><code>dict.items()</code> è¿”å›å¯éå†çš„ (key, value) å…ƒç»„ç»„æˆçš„åˆ—è¡¨</li><li><p><code>dict.keys()</code> &amp; <code>dict.values()</code> è¿”å› key/value åˆ—è¡¨</p></li><li><p><code>dict.pop(key, default)</code> &amp; <code>dict.clear()</code> å‰è€…åˆ é™¤ key å€¼ï¼Œå¹¶è¿”å›è¯¥ key å¯¹åº” valueï¼Œè‹¥ä¸å­˜åœ¨è¯¥ key åˆ™è¿”å› defaultã€‚åè€…æ¸…ç©ºå­—å…¸æ‰€æœ‰å†…å®¹</p></li><li><code>dict.update(dict_new)</code> å°†æ–°å­—å…¸é‡Œçš„ (key, value) æ›´æ–°åˆ°æœ¬å­—å…¸ä¸­</li><li><code>dict.copy()</code></li></ol><h2 id="Set-é›†åˆ"><a href="#Set-é›†åˆ" class="headerlink" title="Set é›†åˆ"></a>Set é›†åˆ</h2><p>é›†åˆæ˜¯ä¸€ä¸ªæ— åºçš„ä¸é‡å¤å…ƒç´ åºåˆ—ï¼Œä¸”å…ƒç´ æ€§è´¨æ˜¯ä¸å¯å˜çš„ï¼Œå¦‚æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå…ƒç»„ã€‚åˆ›å»ºé›†åˆæœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</p><ol><li><p>ç›´æ¥èµ‹å€¼ <code>SET = {1, 2, 3}</code> è¿™é‡Œå¿…é¡»æœ‰å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå­—å…¸</p></li><li><p>ç±»å‹è½¬æ¢ <code>set(iterable)</code>ï¼Œä¼ å…¥å¯è¿­ä»£å¯¹è±¡ï¼Œå¯ä»¥æ˜¯åˆ—è¡¨ã€å…ƒç»„ï¼Œä¹Ÿå¯ä»¥ä¸ä¼ å‚æ•°ä»¥åˆ›å»ºç©ºé›†åˆ</p></li></ol><h3 id="é›†åˆè¿ç®—"><a href="#é›†åˆè¿ç®—" class="headerlink" title="é›†åˆè¿ç®—"></a>é›†åˆè¿ç®—</h3><p>é›†åˆè¿ç®—ç›¸æ¯”äºå‰é¢çš„æ•°æ®ç»“æ„å°±è¦æ›´å¤šäº†ï¼Œé™¤äº†åŸºç¡€çš„ <code>[], in</code> è¿™æ ·çš„ç´¢å¼•å’Œæˆå‘˜è¿ç®—ï¼Œè¿˜æœ‰ <code>&amp;, |, -, ^</code> äº¤é›†ã€å¹¶é›†ã€å·®é›†ã€å¼‚æˆ–ï¼ˆå¯¹ç§°å·®é›†ï¼‰</p><h3 id="python-å†…ç½®å‡½æ•°æ“ä½œé›†åˆ"><a href="#python-å†…ç½®å‡½æ•°æ“ä½œé›†åˆ" class="headerlink" title="python å†…ç½®å‡½æ•°æ“ä½œé›†åˆ"></a>python å†…ç½®å‡½æ•°æ“ä½œé›†åˆ</h3><p>åœ¨åˆ—è¡¨å½“ä¸­èƒ½ç”¨çš„æ“ä½œä¹Ÿèƒ½ç”¨ä½œé›†åˆï¼Œæ¯•ç«Ÿé›†åˆå¯ä»¥ç²—ç•¥çœ‹ä½œè¦æ±‚å…ƒç´ å”¯ä¸€çš„åˆ—è¡¨</p><h3 id="é›†åˆå†…å»ºå‡½æ•°"><a href="#é›†åˆå†…å»ºå‡½æ•°" class="headerlink" title="é›†åˆå†…å»ºå‡½æ•°"></a>é›†åˆå†…å»ºå‡½æ•°</h3><ol><li><code>set.add()</code></li><li><code>set.remove(obj)</code> &amp; <code>set.clear()</code> å‰è€…åˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œåè€…æ¸…ç©ºæ‰€æœ‰</li><li><code>set.issubset(set_new)</code> &amp; <code>set.issuperset(set_new)</code> &amp; <code>set.isdisjoint(set_new)</code> åˆ¤æ–­æ˜¯å¦æ˜¯é›†åˆçš„å­é›†ã€è¶…é›†ï¼Œä»¥åŠæ˜¯å¦æ˜¯ä¸ç›¸äº¤çš„</li></ol><h2 id="è¡¥å……ï¼šè¿­ä»£å™¨ï¼Œç”Ÿæˆå¼ï¼Œç”Ÿæˆå™¨"><a href="#è¡¥å……ï¼šè¿­ä»£å™¨ï¼Œç”Ÿæˆå¼ï¼Œç”Ÿæˆå™¨" class="headerlink" title="è¡¥å……ï¼šè¿­ä»£å™¨ï¼Œç”Ÿæˆå¼ï¼Œç”Ÿæˆå™¨"></a>è¡¥å……ï¼šè¿­ä»£å™¨ï¼Œç”Ÿæˆå¼ï¼Œç”Ÿæˆå™¨</h2><p>è¿™ä¸€éƒ¨åˆ†å°†ä¼šæ¶‰åŠåˆ°éƒ¨åˆ†é¢å‘å¯¹è±¡çš„å†…å®¹ï¼Œä»¥åŠ python çš„ç‰¹æ®Šæ–¹æ³•ã€‚ä¹‹å‰å°±æ˜¯å› ä¸ºç¼ºå°‘è¿™ä¸¤éƒ¨åˆ†çš„å†…å®¹çš„äº†è§£ï¼Œä¸€ç›´å¯¹è¿­ä»£å™¨ã€ç”Ÿæˆå™¨ä¸ç†è§£ï¼Œç°åœ¨è¿›è¡Œæ•´ç†ã€‚å‚è€ƒèµ„æ–™ï¼š<a href="https://www.runoob.com/python3/python3-iterator-generator.html">è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨</a> <a href="https://www.runoob.com/w3cnote/python-yield-used-analysis.html">æµ…æ yield</a> </p><h3 id="iterator-è¿­ä»£å™¨"><a href="#iterator-è¿­ä»£å™¨" class="headerlink" title="iterator è¿­ä»£å™¨"></a>iterator è¿­ä»£å™¨</h3><p>å…¶å®åœ¨ä¹‹å‰å°±å·²ç»è§åˆ°äº†è¿­ä»£å™¨äº†ï¼Œåˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸è¿™äº›æ•°æ®ç»“æ„éƒ½èƒ½å¤Ÿåœ¨ for-in å¾ªç¯çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆè¿­ä»£å™¨å¯¹è±¡ã€‚åœ¨ä¸€ä¸ªç±»ä¸­å¦‚ä½•å®ç°è¿­ä»£å™¨å¯¹è±¡ï¼Ÿpython æä¾›äº†ç‰¹æ®Šæ–¹æ³• <code>__iter__()</code> å’Œ <code>__next__()</code> å®ç°åˆ›é€ è¿­ä»£å™¨å¯¹è±¡ï¼Œå½“ç±»ä¸­æœ‰ <code>__iter__()</code> æ–¹æ³•æ—¶ï¼Œå°±æ„å‘³ç€è¿™ä¸ªç±»çš„å®ä¾‹ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡</p><p>è¿™é‡Œæä¸€ä¸‹ python ç±»ä¸­ <code>__function__()</code> å½¢å¼çš„å‡½æ•°è¢«æˆä¸ºç§°ä¸ºç‰¹æ®Šå‡½æ•°ï¼Œåœ¨ç‰¹å®šæ¡ä»¶å‘ç”Ÿæ—¶è¿è¡Œï¼Œè€Œ <code>__iter__()</code> å’Œ <code>__next__()</code> åˆ™ä¼šåœ¨ for-in å¾ªç¯ä¸­è¢«è°ƒç”¨ã€‚ä¸‹é¢é€šè¿‡è¿­ä»£å™¨å®ç°ä¸€ä¸ªç®€å• <code>ListDemo</code> äº†è§£å…¶å†…éƒ¨é€»è¾‘</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListDemo</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args        self<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å‡½æ•°å†…å¯ä»¥åšä¸€äº›åˆå§‹åŒ–æ“ä½œ</span>        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment"># æœ€åå¿…é¡»è¿”å›è¿­ä»£å™¨å¯¹è±¡æœ¬èº«</span>        <span class="token keyword">return</span> self    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>count<span class="token punctuation">:</span>            result <span class="token operator">=</span> self<span class="token punctuation">.</span>args<span class="token punctuation">[</span>self<span class="token punctuation">.</span>index<span class="token punctuation">]</span>            self<span class="token punctuation">.</span>index <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">return</span> result        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># å¾ªç¯ç»“æŸçš„æ ‡å¿—</span>            <span class="token keyword">raise</span> StopIteration<span class="token comment"># è¿è¡Œä¸€ä¸‹</span>LIST <span class="token operator">=</span>  ListDemo<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> LIST<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ•´ä¸ªè¿­ä»£å™¨åœ¨å¾ªç¯ä¸­åˆ°åº•åœ¨æ€ä¹ˆè¿è¡Œå‘¢ï¼Ÿé¦–å…ˆ <code>ListDemo</code> å…ˆè¿è¡Œäº† <code>__iter__()</code> è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œè¿”å›è¿­ä»£å™¨å¯¹è±¡æœ¬èº«ã€‚åœ¨å¾ªç¯å½“ä¸­ï¼Œ <code>ListDemo</code> ç±»åœ¨é‡å¤è°ƒç”¨ <code>__next__()</code> å‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœç»™ <code>i</code>ï¼Œæœ€åé‡åˆ° <code>StopIteration</code> ç»“æŸå¾ªç¯</p><p>python è¿˜æœ‰å†…ç½®å‡½æ•° <code>iter()</code>  &amp; <code>next()</code> ç”¨äºç›´æ¥è°ƒç”¨ <code>__iter__()</code> &amp; <code>__next__()</code> è€Œä¸éœ€è¦é‡åˆ°å¾ªç¯æ‰è§¦å‘</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">LIST <span class="token operator">=</span>  ListDemo<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>iterator <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>LIST<span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="generator-ç”Ÿæˆå™¨"><a href="#generator-ç”Ÿæˆå™¨" class="headerlink" title="generator ç”Ÿæˆå™¨"></a>generator ç”Ÿæˆå™¨</h3><p>å¦‚æœè¯´è¿­ä»£å™¨æ˜¯å®šä¹‰åœ¨ç±»å½“ä¸­çš„ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨å°±æ˜¯å¯ä»¥ç›´æ¥å®šä¹‰åœ¨æ™®é€šå‡½æ•°ä¸­çš„è¿­ä»£å™¨ã€‚é€šè¿‡ <code>yield</code> å…³é”®å­—èƒ½å¤Ÿå°†æ™®é€šå‡½æ•°å˜ä¸ºç”Ÿæˆå™¨ï¼Œå®ƒå°†å®ç°ä¹‹å‰çš„  <code>__iter__()</code> å’Œ <code>__next__()</code> åŠŸèƒ½ã€‚æ¯æ¬¡é‡åˆ° yield æ—¶å‡½æ•°ä¼šæš‚åœå¹¶ä¿å­˜å½“å‰æ‰€æœ‰çš„è¿è¡Œä¿¡æ¯ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>yield</code> çš„å€¼, å¹¶åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œ next() æ–¹æ³•æ—¶ä»å½“å‰ <code>yield</code> ä½ç½®ç»§ç»­è¿è¡Œã€‚ä¸‹é¢å®ç°ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—å‡½æ•°ï¼Œæ¥è¿›ä¸€æ­¥ç†è§£å…¶å†…éƒ¨é€»è¾‘</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>    a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>    count <span class="token operator">=</span> <span class="token number">0</span>     <span class="token keyword">while</span> count <span class="token operator">&lt;</span> n<span class="token punctuation">:</span>        <span class="token keyword">yield</span> a        a_ <span class="token operator">=</span> a        a <span class="token operator">=</span> b        b <span class="token operator">=</span> a_ <span class="token operator">+</span> b        count <span class="token operator">+=</span> <span class="token number">1</span>iterator <span class="token operator">=</span> fibonacci<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> iterator<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç±»æ¯”ä¸€ä¸‹ç±»ä¸­çš„è¿­ä»£å™¨ï¼Œèƒ½å¤Ÿæ›´å¿«é€Ÿçš„ç†è§£ã€‚é€šè¿‡ <code>yield</code> å£°æ˜è¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œè¿™æ ·ä¼šåœ¨é‡åˆ° for-in å¾ªç¯çš„æ—¶å€™ä¸æ–­åœ°è°ƒç”¨ next() æ–¹æ³•å¹¶è¿”å› <code>yield</code> å€¼ <code>a</code> èµ‹ç»™ <code>i</code>ã€‚åŒºåˆ«äºç±»ä¸­çš„ <code>__next__()</code>  æ–¹æ³•æ˜¯é‡å¤ <code>__next__()</code> å‡½æ•°å†…çš„ä»£ç ï¼Œç”Ÿæˆå™¨è¿è¡Œ <code>next()</code> å‡½æ•°ï¼Œåˆ™ä¼šä»å½“å‰ <code>yield</code> å¤„ç»§ç»­è¿è¡Œï¼Œç›´åˆ°ç¢°åˆ°ä¸‹ä¸€ä¸ª <code>yield</code> </p><h3 id="ç”Ÿæˆå¼"><a href="#ç”Ÿæˆå¼" class="headerlink" title="ç”Ÿæˆå¼"></a>ç”Ÿæˆå¼</h3><p>ç”Ÿæˆå¼æ˜¯ç”Ÿæˆå™¨çš„ä¸€ä¸ªç®€å•åº”ç”¨ï¼Œå¯ä»¥ç”¨äºç”Ÿæˆåˆ—è¡¨ã€å­—å…¸</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ä½¿ç”¨ç”Ÿæˆå¼åˆ›å»ºåˆ—è¡¨å’Œå­—å…¸</span>f <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>f <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token operator">+</span> y <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token string">'ABCDE'</span> <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token string">'1234567'</span><span class="token punctuation">]</span>f <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment"># ç”Ÿæˆå¼æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨</span>f <span class="token operator">=</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> f<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Python </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 1 åŸºç¡€</title>
      <link href="/archives/2bc936a0.html"/>
      <url>/archives/2bc936a0.html</url>
      
        <content type="html"><![CDATA[<h1 id="Python-Basic"><a href="#Python-Basic" class="headerlink" title="Python Basic"></a>Python Basic</h1><p>åœ¨è¿›è¡Œæ·±åº¦å­¦ä¹ çš„å®è·µä¸­ï¼Œè¶Šå‘æ„Ÿè§‰åˆ°è‡ªå·±çš„ python ç†è®ºä¸è¶³ï¼Œæƒ³è¦é‡æ–°å¿«é€Ÿæ•´ç†ä¸€ä¸‹ pythonï¼Œå»ºç«‹ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´ä½†ä¸ç»†è‡´çš„æ¡†æ¶ä¾›è‡ªå·±ä¹‹åå¤ä¹ ã€‚æ•´ç†èµ„æºæ¥è‡ªäº <a href="https://github.com/jackfrued/Python-100-Days">python 100 days</a> å’Œ <a href="https://www.runoob.com/python3/python3-tutorial.html">èœé¸Ÿæ•™ç¨‹</a> </p><h2 id="ä»€ä¹ˆæ˜¯-python"><a href="#ä»€ä¹ˆæ˜¯-python" class="headerlink" title="ä»€ä¹ˆæ˜¯ python?"></a>ä»€ä¹ˆæ˜¯ python?</h2><p>ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œä»¥ç¼©è¿›åˆ†å—ï¼Œæœ‰ç€æ´»è·ƒçš„ç¤¾åŒºå’Œä¸°å¯Œçš„ä¸‰æ–¹åº“ï¼Œåœ¨äººå·¥æ™ºèƒ½ã€ç½‘ç»œçˆ¬è™«ã€è‡ªåŠ¨è¿ç»´ã€Webå¼€å‘ç­‰é¢†åŸŸéƒ½æœ‰å¹¿æ³›åº”ç”¨</p><p>åœ¨æˆ‘çš„ç‹­éš˜ç†è§£å½“ä¸­ python = python.exeã€‚å½“æˆ‘åœ¨ä½¿ç”¨ anaconda æ—¶ï¼Œä¼šæœ‰ä¸åŒçš„ç¯å¢ƒï¼Œä¸€èˆ¬æ¯ä¸€ä¸ªç¯å¢ƒéƒ½æœ‰è‡ªå·±çš„ python.exeï¼Œå¦‚æœæˆ‘æƒ³è¦è¿è¡Œä¸€ä¸ª python è„šæœ¬ï¼Œé‚£ä¹ˆéœ€è¦é€‰æ‹©ä¸€ä¸ª python.exe/è§£é‡Šå™¨ /interpreter æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬</p><h2 id="å®‰è£…-python"><a href="#å®‰è£…-python" class="headerlink" title="å®‰è£… python"></a>å®‰è£… python</h2><p>å¼ºçƒˆå»ºè®®ç›´æ¥å®‰è£… anacondaï¼Œç®€ç§° condaã€‚è¿™æ˜¯ä¸€ä¸ªæµè¡Œçš„åŒ…ç®¡ç†å·¥å…·ï¼Œå…¶ç®¡ç†å¥¥ä¹‰å°±æ˜¯åˆ›å»ºâ€ç¯å¢ƒâ€œã€‚ç¯å¢ƒä¸­å¯ä»¥ä¸‹è½½åŒ…ï¼Œç®¡ç†åŒ…ï¼Œä¸”æ¯ä¸ªç¯å¢ƒéƒ½å¯ä»¥å®‰è£…è‡ªå·±çš„ python è§£é‡Šå™¨ã€‚è¿™å°±æ„å‘³ç€å¦‚æœä½ æƒ³è¦ä½¿ç”¨ä¸åŒç‰ˆæœ¬ python è§£é‡Šå™¨ï¼Œconda å¯ä»¥åšåˆ°ï¼Œåªéœ€è¦åˆ›å»ºå¤šä¸ª conda ç¯å¢ƒï¼Œæƒ³ç”¨å“ªä¸ªç‰ˆæœ¬å°±åˆ‡åˆ°å“ªä¸ªç‰ˆæœ¬çš„ conda ç¯å¢ƒï¼ŒåŒæ—¶ä¸åŒçš„ç¯å¢ƒå¯ä»¥ä¸‹è½½ä¸åŒçš„åŒ…ï¼Œå®ç°ä¸ä¸€æ ·çš„åŠŸèƒ½</p><h2 id="python-å¼€å‘å·¥å…·"><a href="#python-å¼€å‘å·¥å…·" class="headerlink" title="python å¼€å‘å·¥å…·"></a>python å¼€å‘å·¥å…·</h2><ol><li>python.exeï¼Œç›´æ¥åŒå‡»æ‰“å¼€å°±å¯ä»¥å¼€å§‹å†™ python ä»£ç äº†ï¼Œæœ€åŸç”Ÿçš„äº¤äº’å¼å¼€å‘å·¥å…·ï¼Œæ‡‚æˆ‘æ„æ€ï¼Ÿ</li><li>ipythonï¼Œæ¯”åŸç”Ÿå¼€å‘å·¥å…·å¥½ä¸€ç‚¹</li><li>pycharmï¼Œä¸“ä¸šè½¯ä»¶ï¼Œéå¸¸å¥½ç”¨</li><li>vscodeï¼Œå®‡å®™ç¬¬ä¸€å¼€å‘å·¥å…·ï¼Œæ‡‚ï¼Ÿ</li></ol><h2 id="å˜é‡ä¸ç±»å‹"><a href="#å˜é‡ä¸ç±»å‹" class="headerlink" title="å˜é‡ä¸ç±»å‹"></a>å˜é‡ä¸ç±»å‹</h2><p>ç°åœ¨æ­£å¼å¼€å§‹å¯¹ python è„šæœ¬è¿›è¡Œäº†è§£</p><p>ä»‹ç»å‡ ä¸ªåŸºç¡€æ•°æ®ç±»å‹ï¼š</p><ol><li>int </li><li>float</li><li>string</li><li>bool</li><li>complexï¼Œå¾ˆå°‘ç”¨</li></ol><h3 id="å˜é‡å‘½å"><a href="#å˜é‡å‘½å" class="headerlink" title="å˜é‡å‘½å"></a>å˜é‡å‘½å</h3><p>è§„åˆ™ï¼šä»¥å­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—æ„æˆï¼Œæ•°å­—ä¸èƒ½å¼€å¤´ï¼Œå­—æ¯å¤§å°å†™æ•æ„Ÿ</p><p>PEP 8è¦æ±‚ï¼š</p><ul><li>ä¸€èˆ¬ç”¨å°å†™å­—æ¯æ‹¼å†™ï¼Œå¤šä¸ªå•è¯ç”¨ä¸‹åˆ’çº¿è¿æ¥</li><li>å—ä¿æŠ¤çš„å®ä¾‹å±æ€§ç”¨å•ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼ˆåé¢ä¼šè®²åˆ°ï¼‰</li><li>ç§æœ‰çš„å®ä¾‹å±æ€§ç”¨ä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼ˆåé¢ä¼šè®²åˆ°ï¼‰</li></ul><h3 id="å˜é‡çš„ä½¿ç”¨"><a href="#å˜é‡çš„ä½¿ç”¨" class="headerlink" title="å˜é‡çš„ä½¿ç”¨"></a>å˜é‡çš„ä½¿ç”¨</h3><p>python ä¸­å˜é‡çš„åˆ›å»ºä¸éœ€è¦å£°æ˜ï¼Œç›´æ¥èµ‹å€¼å³åˆ›å»ºã€‚<strong>è¿˜å¯ä»¥ä½¿ç”¨å†…ç½®å‡½æ•°ï¼Œå¯¹å˜é‡ç±»å‹è¿›è¡Œè½¬æ¢ï¼šint(), float(), str()â€¦ä½¿ç”¨ type() æŸ¥çœ‹å˜é‡ç±»å‹</strong></p><p><strong>å†ä»‹ç»ä¸¤ä¸ªåŸºç¡€å‡½æ•°ï¼Œprint() &amp; input()ï¼Œå‰è€…ç”¨äºæ‰“å°ï¼Œåè€…ç”¨äºæ¥æ”¶é”®ç›˜è¾“å…¥å­—ç¬¦ä¸²</strong></p><h4 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h4><p>ä¸‹è¡¨å¤§è‡´æŒ‰ç…§ä¼˜å…ˆçº§ä»é«˜åˆ°ä½çš„é¡ºåºåˆ—å‡ºäº†æ‰€æœ‰çš„è¿ç®—ç¬¦</p><p><img src="/archives/2bc936a0/image-20210828224442524.png" style="zoom: 67%;"></p><p>æ¯”è¾ƒé™Œç”Ÿçš„æ˜¯ä½è¿ç®—ç¬¦ï¼Œèº«ä»½è¿ç®—ç¬¦ï¼Œæˆå‘˜è¿ç®—ç¬¦ï¼Œéœ€è¦é‡ç‚¹ç†è§£ä¸€ä¸‹ï¼Œå‚è€ƒ <a href="https://www.runoob.com/python/python-operators.html">èœé¸Ÿæ•™ç¨‹</a></p><h2 id="åˆ†æ”¯ä¸å¾ªç¯"><a href="#åˆ†æ”¯ä¸å¾ªç¯" class="headerlink" title="åˆ†æ”¯ä¸å¾ªç¯"></a>åˆ†æ”¯ä¸å¾ªç¯</h2><p>åˆ†æ”¯ä½¿ç”¨ ifâ€¦elifâ€¦else å½¢å¼å®ç°åˆ†æ”¯</p><p>å¾ªç¯æœ‰ä¸¤ç§å½¢å¼ï¼šfor-in å’Œ whileï¼Œé‡ç‚¹æä¸€ä¸‹ for-inï¼Œç”¨æ¥å¯¹ä¸€ä¸ªå®¹å™¨è¿›è¡Œè¿­ä»£éå¸¸æ–¹ä¾¿ï¼Œè¿™ä¸ªå®¹å™¨å¯ä»¥æ˜¯åˆ—è¡¨ï¼Œå­—å…¸ï¼Œå…ƒç»„ç­‰å…·æœ‰è¿­ä»£åŠŸèƒ½çš„å®¹å™¨ã€‚ä½¿ç”¨ <code>break &amp; continue</code> æ¥è·³å‡ºå¾ªç¯</p><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>python ä½¿ç”¨ def å…³é”®å­—å£°æ˜å‡½æ•°ï¼Œä»¥ return ç»“æŸï¼Œå¦‚æœæ²¡æœ‰ return é»˜è®¤è¿”å› Noneã€‚åœ¨ python ä¸­ï¼Œå‡½æ•°çš„å‚æ•°å¯ä»¥æœ‰é»˜è®¤å€¼ï¼Œä¹Ÿæ”¯æŒä½¿ç”¨å¯å˜å‚æ•° *args, **kwargs</p><h3 id="å‡½æ•°å‚æ•°"><a href="#å‡½æ•°å‚æ•°" class="headerlink" title="å‡½æ•°å‚æ•°"></a>å‡½æ•°å‚æ•°</h3><h4 id="å¯æ›´æ”¹å¯¹è±¡ä¸ä¸å¯æ›´æ”¹å¯¹è±¡"><a href="#å¯æ›´æ”¹å¯¹è±¡ä¸ä¸å¯æ›´æ”¹å¯¹è±¡" class="headerlink" title="å¯æ›´æ”¹å¯¹è±¡ä¸ä¸å¯æ›´æ”¹å¯¹è±¡"></a>å¯æ›´æ”¹å¯¹è±¡ä¸ä¸å¯æ›´æ”¹å¯¹è±¡</h4><p>ç”±äº python ä¸­çš„å˜é‡ä¸åƒ C è¯­è¨€ä¸€æ ·éœ€è¦å£°æ˜ï¼Œæ‰€ä»¥ python å‡½æ•°å‚æ•°æ˜¯ä¼ å€¼è¿˜æ˜¯å¼•ç”¨ï¼Œä¹Ÿå’Œ C è¯­è¨€ä¸ä¸€æ ·ã€‚ç”±äº python çš„å˜é‡ä¸éœ€è¦å£°æ˜ï¼Œé‚£ä¹ˆ python çš„å˜é‡ä¸ C è¯­è¨€å˜é‡æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ï¼Œä¸¾ä¸ªä¾‹å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1</span>b <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token keyword">is</span> b<span class="token punctuation">)</span><span class="token comment"># True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ° a å’Œ b å…¶å®æ˜¯æ¥è‡ªåŒä¸€ä¸ªå¯¹è±¡ï¼Œæ›´æ”¹äº† a çš„å€¼ï¼Œb ä¹Ÿä¸€èµ·è¢«æ›´æ”¹äº†ï¼Œå°±å¥½åƒ a å’Œ b çš„â€œæŒ‡é’ˆâ€éƒ½æŒ‡å‘äº†1</p><p>å‚è€ƒè¿™ä¸ª <a href="http://winterttr.me/2015/10/24/python-passing-arguments-as-value-or-reference/">åšå®¢</a>ï¼Œ â€œç±»å‹æ˜¯å±äºå¯¹è±¡çš„ï¼Œè€Œä¸æ˜¯å˜é‡çš„â€ï¼Œpython ä¸­çš„å˜é‡æ›´åƒæ˜¯ä¸€ä¸ªâ€œæŒ‡é’ˆâ€ï¼Œæ˜¯å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸€ä¸ªå˜é‡å¯ä»¥æŒ‡å‘ä»»æ„çš„å¯¹è±¡ã€‚1æ˜¯å±äº int å¯¹è±¡çš„ï¼Œè€Œä¸æ˜¯å±äº a, b å˜é‡çš„</p><p>ç°åœ¨å›åˆ°å‚æ•°ä¼ é€’è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥è®¤ä¸ºæ˜¯â€œå¼•ç”¨â€ä¼ é€’ï¼Œä½†æƒ…å†µåˆ†ä¸ºä¸¤ç§ï¼š</p><ol><li>ä¼ é€’å‚æ•°ä¸ºå¯æ›´æ”¹å¯¹è±¡ (mutable)ï¼Œä¾‹å¦‚ list, dict, np.arrayï¼Œåœ¨å‡½æ•°ä¸­<strong>ä¿®æ”¹</strong>å‚æ•°å€¼æ—¶ï¼Œä¼šæ”¹å˜åŸå˜é‡ï¼›<strong>èµ‹å€¼</strong>æ–°å€¼æ—¶ï¼Œä¸ä¼šæ”¹å˜åŸå˜é‡</li><li>ä¼ é€’å‚æ•°ä¸ºä¸å¯æ›´æ”¹å¯¹è±¡ (immutable)ï¼Œä¾‹å¦‚ strings, numbers, tuplesï¼Œåœ¨å‡½æ•°ä¸­<strong>èµ‹å€¼</strong>æ–°å€¼æ—¶ï¼Œä¸ä¼šæ”¹å˜åŸå˜é‡ï¼Œå³åŸå˜é‡æ‰€æŒ‡å¯¹è±¡ä¸å˜</li></ol><p>ä¸¾ä¸ªä¾‹å­æ¥ç†è§£ä¸€ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1</span>b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'this is c'</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    c <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token comment"># -1 [-1, 2, 3] 0</span>    test<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token comment"># 1 [-1, 2, 3] ['this is c']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å‚æ•°ç±»å‹"><a href="#å‚æ•°ç±»å‹" class="headerlink" title="å‚æ•°ç±»å‹"></a>å‚æ•°ç±»å‹</h4><p>è¿™é‡Œå‚è€ƒ <a href="https://cloud.tencent.com/developer/article/1640717">python å‚æ•°ï¼Œè…¾è®¯äº‘</a> è¿›è¡Œæ•´ç†ã€‚python å‡½æ•°çš„å½¢å‚åˆ†ä¸ºå››ç§ï¼š</p><ul><li>å¿…éœ€å‚æ•°ï¼šå¹³æ—¶æœ€å¸¸ç”¨çš„ï¼Œå¿…ä¼ ç¡®å®šæ•°é‡çš„å‚æ•°</li><li>ç¼ºçœå‚æ•°ï¼šåœ¨è°ƒç”¨å‡½æ•°æ—¶å¯ä»¥ä¼ ä¹Ÿå¯ä»¥ä¸ä¼ ï¼Œå¦‚æœä¸ä¼ å°†ä½¿ç”¨é»˜è®¤å€¼</li><li>å¯å˜å‚æ•°ï¼šå¯å˜é•¿åº¦å‚æ•°ï¼Œé€šå¸¸ç”¨ <code>*args</code> è¡¨ç¤º</li><li>å…³é”®å­—å‚æ•°ï¼šé•¿åº¦å¯å˜ï¼Œä½†éœ€è¦ä»¥ key=value å¯¹å½¢å¼ä¼ é€’ï¼Œé€šå¸¸ç”¨ <code>**kwargs</code> è¡¨ç¤º</li></ul><p>å¯¹äºå®šä¹‰å‡½æ•°æ—¶ï¼Œå‚æ•°ä½ç½®çš„å¼ºåˆ¶è¦æ±‚æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ol><li>ç¼ºçœå‚æ•°å¿…é¡»åœ¨å¿…é¡»å‚æ•°ä¹‹å</li><li>å…³é”®å­—å‚æ•°å¿…é¡»åœ¨æœ€å</li></ol><p>åœ¨ç»™å‡½æ•°ä¼ å…¥å‚æ•°æ—¶ï¼Œå¯ä»¥ä¼ å…¥ä¸¤ç§ç±»å‹ï¼š</p><ul><li>ä½ç½®å‚æ•°ï¼šç›´æ¥ä¼ å…¥å®å‚ï¼Œä¼ å…¥ä½ç½®ä¸å‡½æ•°å®šä¹‰æ—¶çš„å‚æ•°ä½ç½®ç›¸åŒ</li><li>å…³é”®å­—å‚æ•°ï¼šä»¥ <code>param=value</code> å½¢å¼å‡ºç°ï¼Œå¯ä»¥å¿½ç•¥å‡½æ•°å®šä¹‰æ—¶å‚æ•°çš„ä½ç½®</li></ul><p>python å¼ºåˆ¶è¦æ±‚ä½ç½®å‚æ•°å¿…é¡»åœ¨å…³é”®å­—å‚æ•°ä¹‹å‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'å¿…é¡»å‚æ•°: %s, %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ç¼ºçœå‚æ•°: %s, %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'å¯å˜å‚æ•°:'</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'å…³é”®å­—å‚æ•°:'</span><span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span>    test<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> e<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--------------------------'</span><span class="token punctuation">)</span>test<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'C'</span><span class="token punctuation">,</span> e<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span><span class="token comment"># ä¸Šé¢è¿‡æ—©ä¼ å…¥äº†å…³é”®å­—å‚æ•°ï¼Œå¯¼è‡´æ— æ³•ä¼ å…¥å¯å˜å‚æ•° *args</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢å†’å· <code>:</code> ä¹‹åè¡¨ç¤ºçš„æ˜¯ä½œè€…å»ºè®®çš„ä¼ å…¥å‚æ•°ç±»å‹ï¼Œç®­å¤´ <code>-&gt;</code> ä¹‹åä¸ºå»ºè®®çš„å‡½æ•°è¿”å›ç±»å‹</p><h3 id="è§£åŒ…"><a href="#è§£åŒ…" class="headerlink" title="è§£åŒ…"></a>è§£åŒ…</h3><p>å½“éœ€è¦ä¼ å…¥çš„å¤šä¸ªå‚æ•°è¢«æ‰“åŒ…åœ¨äº†ä¸€ä¸ªå…ƒç»„/å­—å…¸ä¸­ï¼Œå¯ä»¥é€šè¿‡è§£åŒ…çš„æ–¹å¼ï¼Œç›´æ¥æŠŠå…ƒç»„/å­—å…¸ä½œä¸ºå¯å˜å‚æ•°/å…³é”®å­—å‚æ•°ï¼Œä¼ å…¥åˆ°å‡½æ•°å½“ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">args <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>kwargs <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>b<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>test<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token comment"># 1 2 3</span>test<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token comment"># a b c</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè§£åŒ…å…ƒç»„ç”¨  <code>*</code>ï¼Œè§£åŒ…å­—å…¸ç”¨ <code>**</code></p><h3 id="lambda-åŒ¿åå‡½æ•°"><a href="#lambda-åŒ¿åå‡½æ•°" class="headerlink" title="lambda åŒ¿åå‡½æ•°"></a>lambda åŒ¿åå‡½æ•°</h3><p>lambda åªæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå‡½æ•°ä½“æ¯” def ç®€å•å¾ˆå¤šï¼Œæ‰€ä»¥åªèƒ½å°è£…æœ‰é™çš„é€»è¾‘ã€‚lambda å‡½æ•°çš„è¯­æ³•åªæœ‰ä¸€å¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">lambda</span> <span class="token punctuation">[</span>args_list<span class="token punctuation">]</span><span class="token punctuation">:</span> expression<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>expression</code> å¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ä¸‹é¢ä¸¾ä¸€ä¸ªä¾‹å­æ¥ä½¿ç”¨ lambda å‡½æ•°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">add <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> a <span class="token operator">+</span> b<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> a<span class="token operator">**</span>b<span class="token comment"># expression can be a function</span>exp_of_2 <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> exp<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>exp_of_2<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€è°“åŒ¿åï¼Œæ„å³ä¸å†ä½¿ç”¨ def è¯­å¥è¿™æ ·æ ‡å‡†çš„å½¢å¼å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ•…æ²¡æœ‰å‡½æ•°åï¼</p><h3 id="æ¨¡å—åŒ–ç®¡ç†"><a href="#æ¨¡å—åŒ–ç®¡ç†" class="headerlink" title="æ¨¡å—åŒ–ç®¡ç†"></a>æ¨¡å—åŒ–ç®¡ç†</h3><p>é€šè¿‡æ¨¡å—ç®¡ç† python æ–‡ä»¶/å‡½æ•°å°†ä¼šå˜å¾—éå¸¸æ–¹ä¾¿ï¼Œéœ€è¦ä½¿ç”¨çš„å‡½æ•°ï¼Œä½¿ç”¨å…³é”®å­— <code>import</code> å¯¼å…¥å³å¯ï¼Œå¯¼å…¥æ–¹æ³•æœ‰å¦‚ä¸‹ï¼š</p><ol><li><code>import module</code>ï¼šå¯¼å…¥æ¨¡å—ï¼Œä»¥ <code>module.func</code> ä½¿ç”¨æ¨¡å—ä¸­çš„å‡½æ•°ç­‰å†…å®¹</li><li><code>import module ad md</code>ï¼šå¯¼å…¥æ¨¡å—ï¼Œå‘½åä¸º mdï¼Œä½¿ç”¨æ–¹æ³•ç±»ä¼¼1</li><li><code>from module import func</code>ï¼šç›´æ¥ä»æ¨¡å—ä¸­å¯¼å…¥å‡½æ•°ï¼Œå¯ç›´æ¥ä½¿ç”¨ func()</li></ol><p>å½“æˆ‘ä»¬ä½¿ç”¨ import è¯­å¥çš„æ—¶å€™ï¼ŒPythonè§£é‡Šå™¨æ˜¯æ€æ ·æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶çš„å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ° Python çš„æœç´¢è·¯å¾„ï¼Œæœç´¢è·¯å¾„æ˜¯ç”±ä¸€ç³»åˆ—ç›®å½•åç»„æˆçš„ï¼ŒPython è§£é‡Šå™¨å°±ä¾æ¬¡ä»è¿™äº›ç›®å½•ä¸­å»å¯»æ‰¾æ‰€å¼•å…¥çš„æ¨¡å—ã€‚æœç´¢è·¯å¾„è¢«å­˜å‚¨åœ¨ sys æ¨¡å—ä¸­çš„ path å˜é‡ï¼Œæ­¤å˜é‡ä¸ºä¸€ä¸ªåˆ—è¡¨</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token keyword">for</span> path <span class="token keyword">in</span> sys<span class="token punctuation">.</span>path<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token comment"># d:\VScodeProjects\TestProj</span><span class="token comment"># D:\LenovoSoftstore\Anaconda\python38.zip</span><span class="token comment"># D:\LenovoSoftstore\Anaconda\lib\site-packages</span><span class="token comment"># ...MORE</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€èˆ¬ <code>sys.path</code> åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå³ä¸ºå½“å‰æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹</p><h4 id="if-name-â€˜-main-â€˜"><a href="#if-name-â€˜-main-â€˜" class="headerlink" title="if __name__ = â€˜__main__â€˜"></a>if __name__ = â€˜__main__â€˜</h4><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå¦‚æœå¯¼å…¥çš„æ¨¡å—ä¸­æœ‰å¯æ‰§è¡Œçš„ä»£ç ï¼Œé‚£ä¹ˆåœ¨å¯¼å…¥æ¨¡å—æ—¶å°±ä¼šæ‰§è¡Œã€‚ä½†äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›æ‰§è¡Œè¿™äº›ä»£ç ï¼Œåªæƒ³è¦å¯¼å…¥è¿™ä¸ªå‡½æ•°ï¼Œä¾‹å¦‚ä¸‹é¢çš„æ¨¡å—</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># module.py</span><span class="token keyword">def</span> <span class="token function">module_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'this is a module'</span><span class="token punctuation">)</span>module_func<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶å¦‚æœåœ¨å¦ä¸€ä¸ª python æ–‡ä»¶ä¸­ <code>import module</code> å°†ä¼šçœ‹åˆ°è¾“å‡º <code>this is a module</code>ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œéœ€è¦åœ¨æ¨¡å—ä¸­é™å®šè¿™äº›å¯æ‰§è¡Œä»£ç ï¼Œä»…åœ¨è¯¥æ¨¡å—ç›´æ¥è¿è¡Œçš„æ—¶å€™è¿è¡Œï¼Œè€Œä¸åœ¨å¯¼å…¥çš„æ—¶å€™è¿è¡Œã€‚å¯é‡‡å–å¦‚ä¸‹å½¢å¼</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># module.py</span><span class="token keyword">def</span> <span class="token function">module_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'this is a module'</span><span class="token punctuation">)</span><span class="token comment"># __name__æ˜¯Pythonä¸­ä¸€ä¸ªéšå«çš„å˜é‡å®ƒä»£è¡¨äº†æ¨¡å—çš„åå­—</span><span class="token comment"># åªæœ‰è¢«Pythonè§£é‡Šå™¨ç›´æ¥æ‰§è¡Œçš„æ¨¡å—çš„åå­—æ‰æ˜¯__main__</span><span class="token keyword">if</span> __name__ <span class="token operator">=</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>module_func<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæåˆ°äº†ä¸€ä¸ªéšå«å˜é‡ <code>__name__</code>ï¼Œæ˜¯ç”± python è‡ªåŠ¨ç”Ÿæˆçš„å˜é‡ï¼Œä¸éœ€è¦äººä¸ºå®šä¹‰ã€‚åœ¨ python ä¸­æœ‰å…¶ä»–çš„éšå«å˜é‡ï¼Œä¾‹å¦‚ <code>__doc__</code> ç”¨äºä¿å­˜å¯¹è±¡çš„è¯´æ˜æ€§æ–‡æ¡£ï¼Œé€šè¿‡å…³é”®å­— <code>?</code> å°±èƒ½è°ƒå‡ºæ–‡æ¡£ï¼Œ<a href="https://blog.csdn.net/u011699626/article/details/107981264">CSDN docå‚è€ƒ</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Basic </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows è½¯ä»¶æ¨è</title>
      <link href="/archives/c92482f1.html"/>
      <url>/archives/c92482f1.html</url>
      
        <content type="html"><![CDATA[<h2 id="Windows-çš„è½¯ä»¶"><a href="#Windows-çš„è½¯ä»¶" class="headerlink" title="Windows çš„è½¯ä»¶"></a>Windows çš„è½¯ä»¶</h2><ol><li><p>Listaryï¼Œæœç´¢ç¥å™¨</p></li><li><p>potplayer + ç®€æ´çš®è‚¤å®šåˆ¶ï¼Œè¯¥æ’­æ”¾å¼ºæ¯”ä½ æƒ³è±¡ä¸­æ›´å¼ºå¤§ï¼Œå¯¹å„ç§æ ¼å¼éƒ½æœ‰å¾ˆå¥½çš„å…¼å®¹æ€§ï¼Œè¿˜èƒ½å®æ—¶ç¿»è¯‘å­—å¹•ä»¥åŠå½•åˆ¶è§†é¢‘</p></li><li><p>bandzip</p></li><li><p>bilibili ç›´æ’­å§¬ï¼ŒOBSï¼Œå¯¹äº OBS çš„ç®€è¦æ•™ç¨‹æ”¾åœ¨åé¢</p></li><li><p>clash</p></li><li><p>æ»´ç­”æ¸…å•</p></li><li><p>chromeï¼Œæ²¹çŒ´æ’ä»¶ï¼šBilibili Evolvedï¼Œzoteroï¼Œgoogle translateï¼Œyoutube åŒè¯­å­—å¹•, translatesubtitles.co/</p></li><li><p>å°è±¡ç¬”è®°</p></li><li><p>typora</p></li><li><p>latex</p></li><li><p>vscode</p></li><li><p>zotero</p><ul><li><p>æ¨è plugin: zotero citation counts manager ç”¨äºçˆ¬å–æ–‡çŒ®å¼•ç”¨ã€‚æƒ³è¦å°† zotero çš„æ–‡çŒ®è¿›è¡Œè½¬ç§»æ—¶ï¼Œåªéœ€è¦è½¬ç§» storage åŠå…¶ zotero.split æ–‡ä»¶å³å¯</p></li><li><p>zotero ä¹Ÿæœ‰å¾ˆæ–¹ä¾¿çš„ word æ’ä»¶ï¼Œåœ¨éœ€è¦çš„æ–‡çŒ®åé¢ add/edit citation å°±å¯è¿›è¡Œæ’å…¥ï¼Œç„¶ååœ¨æ–‡æœ« add/edit bibliography å³å¯</p></li><li>ä¸ºäº†ä¿éšœ zotero äº‘ç«¯çš„ç©ºé—´ï¼Œæˆ‘é€‰æ‹©äº†åœ¨æ‹‰å–æ•°æ®æ—¶ä¸ä¸‹è½½ pdfï¼Œè¿™æ ·ç©ºé—´å°±å®Œå…¨å¤Ÿç”¨äº†ã€‚å°† pdf æ–‡æ¡£å•ç‹¬å­˜æ”¾åˆ°å…¶ä»–æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„è„šæœ¬è¿›è¡Œé‡æ–°å‘½åï¼Œè§£å†³ã€‚è„šæœ¬ä»£ç æ”¾åœ¨åé¢</li></ul></li><li><p>gitï¼Œå½“ github ä¸‹è½½æ–‡ä»¶æ…¢æ—¶è¯·æœç´¢ github é•œåƒèµ„æº</p></li><li><p>ç™¾åº¦ç½‘ç›˜ é˜¿é‡Œäº‘ç›˜</p></li><li><p>ps pr</p></li><li><p>WinSCPï¼ŒXshellï¼ŒMobaXtermï¼ˆå¼ºçƒˆæ¨èï¼Œå¯ä»¥æ›¿ä»£ WinSCP &amp; XShellï¼‰</p></li><li><p>SpaceSnifferï¼ŒæŸ¥çœ‹å­˜å‚¨ç©ºé—´</p></li><li><p>utorrent</p></li><li><p>LinuxReaderï¼Œæ–¹ä¾¿åŒç³»ç»Ÿåœ¨ Win ä¸­è·å– Linux ç³»ç»Ÿçš„æ–‡ä»¶</p></li><li><p>Snipasteï¼Œå¥½ç”¨çš„æˆªå›¾å·¥å…·ï¼Œä»¥åå†ä¹Ÿä¸ç”¨æ‰“å¼€ QQ å†æˆªå›¾äº†ğŸ˜</p></li><li><p>Drawio &amp; Excalidraoï¼Œç”¨äºç”»æµç¨‹å›¾/ç½‘ç»œæ¶æ„</p></li><li><p>Utoolsï¼Œä»‹ç»è‡ªå·±å¸¸ç”¨çš„åŠŸèƒ½ï¼šä¸­é”®å¿«é€Ÿç”¨ cmd/vscode æ‰“å¼€æ–‡ä»¶å¤¹ï¼›å‰ªåˆ‡æ¿æŸ¥çœ‹å†å²å‰ªåˆ‡è®°å½•ï¼›ç½‘é¡µå¿«å¼€èƒ½å¤Ÿå®ç°è¿…é€Ÿæœç´¢ï¼›ä¸­é”®æ˜¾ç¤ºç¿»è¯‘ï¼›OCR å›¾ç‰‡è½¬æ–‡å­—ï¼›Linux å‘½ä»¤æŸ¥è¯¢æ’ä»¶ï¼›å›¾ç‰‡å‹ç¼©æ’ä»¶ï¼›</p></li></ol><h2 id="OBS-ç®€è¦æ•™ç¨‹"><a href="#OBS-ç®€è¦æ•™ç¨‹" class="headerlink" title="OBS ç®€è¦æ•™ç¨‹"></a>OBS ç®€è¦æ•™ç¨‹</h2><p>ä¸»è¦æ ¹æ® <a href="https://www.bilibili.com/video/BV1wt4y1Q7rV?p=1">bilibili</a> è¿›è¡Œå­¦ä¹ </p><h3 id="ç•Œé¢ä»‹ç»"><a href="#ç•Œé¢ä»‹ç»" class="headerlink" title="ç•Œé¢ä»‹ç»"></a>ç•Œé¢ä»‹ç»</h3><p><img src="/archives/c92482f1/image-20210916200411505.png" style="zoom:80%;"></p><ol><li><p>æ¥æº</p><p>é¦–å…ˆ OBS æœ€åŸºæœ¬çš„åŠŸèƒ½å°±æ˜¯å½•åˆ¶ç”µè„‘å±å¹•/çª—å£ã€‚æˆ‘ä»¬éœ€è¦å‘Šè¯‰ OBS éœ€è¦æ·»åŠ å“ªäº›ä¿¡æ¯æºï¼Œè¿™å°±æ˜¯<strong>æ¥æº</strong>çª—å£çš„åŠŸèƒ½ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­æ·»åŠ äº†<strong>æ˜¾ç¤ºå™¨é‡‡é›†</strong>ï¼Œè¿™ä¸ªæ¥æºå°±èƒ½å¤Ÿè®°å½•ä½ çš„å±å¹•å†…æ‰€æ˜¾ç¤ºçš„å†…å®¹</p></li><li><p>åœºæ™¯</p><p><strong>OBS åœ¨ä¸€ä¸ªåœºæ™¯ä¸­å¯ä»¥æ·»åŠ å¤šä¸ªæ¥æº</strong>ï¼Œå¹¶ä¸”è°ƒæ•´è¿™äº›æ¥æºå¦‚ä½•æ˜¾ç¤ºå„ä¸ªæ¥æºï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›æœ€ç»ˆçš„ç”»é¢å·¦è¾¹ä¸º<strong>æ˜¾ç¤ºå™¨é‡‡é›†</strong>å†…å®¹ï¼Œå³è¾¹ä¸º<strong>æ¸¸æˆæº</strong>ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªåœºæ™¯ï¼Œåœ¨ç›´æ’­çš„æ—¶å€™å¯ä»¥ç›´æ¥é€‰æ‹©æŸä¸ªåœºæ™¯ï¼Œæˆ–è€…åœ¨åœºæ™¯ä¹‹é—´åˆ‡æ¢</p></li><li><p>æ··éŸ³å™¨</p><p>ç”¨äºé‡‡é›†ç”µè„‘å£°éŸ³å’Œéº¦å…‹é£å£°éŸ³</p></li></ol><h3 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h3><p>æŒæ¡ä»¥ä¸Šé€»è¾‘å°±èƒ½å¾ˆå¥½åœ°ä½¿ç”¨ OBS äº†ï¼Œå½“ç„¶è¿›ä¸€æ­¥ä½¿ç”¨è‚¯å®šè¦å¯¹<strong>è®¾ç½®</strong>è¿›è¡Œè°ƒæ•´ï¼Œä»¥ä¸‹ä¸ºæˆ‘çš„è®¾ç½®</p><p><img src="/archives/c92482f1/image-20210916201726253.png" style="zoom: 67%;"></p><p>æ¯”è¾ƒé‡è¦çš„å°±æ˜¯è¾“å‡ºè®¾ç½®ï¼Œä¸²æµä»£è¡¨ä½ ç›´æ’­æ—¶é‡‡é›†ç”»é¢çš„è´¨é‡ï¼Œå½•åƒå³ä»£è¡¨å½•åˆ¶ç”»é¢çš„è´¨é‡ã€‚ä¸‹é¢çœ‹çœ‹è¿™å‡ ä¸ªå‚æ•°</p><ol><li>ç ç‡ï¼Œè¶Šé«˜è§†é¢‘è´¨é‡è¶Šé«˜ï¼Œä¸€èˆ¬æ¨è 2k-8k ä¹‹é—´</li><li><p>ç¼–ç å™¨ï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œx264 ä»£è¡¨ç”¨ CPU è¿›è¡Œç¼–ç ï¼Œå…¶ä»–ç¡¬ä»¶åˆ™å¤šä¸º GPU</p></li><li><p>éŸ³é¢‘æ¯”ç‰¹ç‡ï¼Œä¸€èˆ¬ä¸º160æˆ–320</p></li></ol><p>é¢æ¿ä¸­çš„å…¶ä»–è®¾ç½®ï¼Œä¾‹å¦‚ï¼šæ¨æµç”¨äºè®¾ç½®ç›´æ’­å¹³å°æœåŠ¡å™¨ï¼Œè§†é¢‘è¿˜å¯ä»¥è¿›ä¸€æ­¥è®¾ç½®è§†é¢‘çš„åˆ†è¾¨ç‡ã€å¸§æ•°</p><h2 id="Arxiv-pdf-rename-script"><a href="#Arxiv-pdf-rename-script" class="headerlink" title="Arxiv pdf rename script"></a>Arxiv pdf rename script</h2><p>æˆ‘å¸Œæœ›é‡å‘½å arxiv ä¸‹è½½çš„ pdf æ–‡ä»¶ï¼Œä¸ç„¶å…¨æ˜¯æ•°å­— id å‘½åå¾ˆéš¾è¿›è¡Œç®¡ç†ï¼Œæ‰€ä»¥è‡ªå·±å†™äº†ä¸€ä¸ª python è„šæœ¬ï¼Œè¯¥è„šæœ¬æ˜¯ä½¿ç”¨ pdf æ–‡ä»¶åä½œä¸º id æŸ¥è¯¢ arxiv ä¸Šè®ºæ–‡çš„æ ‡é¢˜ã€ä½œè€…ã€å‘å¸ƒæ—¶é—´ï¼Œç„¶åé‡å‘½ååŸ pdf æ–‡ä»¶ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p><ol><li><p>ä¸‹è½½ <a href="https://github.com/lukasschwab/arxiv.py">arxiv</a> ä¸‰æ–¹åº“ <code>pip install arxiv</code></p></li><li><p>å°†ä½ çš„ pdf æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œä¾‹å¦‚ <code>archive</code></p></li><li><p>å°†è„šæœ¬ <code>rename.py</code> æ”¾åœ¨ä¸ <code>archive</code> åŒçº§çš„ç›®å½•ï¼Œå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">- archive- xxxx.xxxx.pdf- xxxx.xxxx.pdf- rename.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¿è¡Œ <code>python rename.py</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> arxiv<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path<span class="token comment"># PDF dir</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    archive <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'./archive'</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> pdf <span class="token keyword">in</span> archive<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'*.pdf'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">id</span> <span class="token operator">=</span> pdf<span class="token punctuation">.</span>stem        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">:</span> <span class="token keyword">continue</span>  <span class="token comment"># ignore processed pdf</span>        search <span class="token operator">=</span> arxiv<span class="token punctuation">.</span>Search<span class="token punctuation">(</span>id_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>search<span class="token punctuation">.</span>results<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token comment"># process title</span>        title <span class="token operator">=</span> result<span class="token punctuation">.</span>title<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">' -'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">220</span><span class="token punctuation">]</span>        <span class="token comment"># process time and author</span>        time <span class="token operator">=</span> result<span class="token punctuation">.</span>published<span class="token punctuation">.</span>year        author <span class="token operator">=</span> result<span class="token punctuation">.</span>authors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name        <span class="token comment"># rename path</span>        rename <span class="token operator">=</span> archive <span class="token operator">/</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">{</span>author<span class="token punctuation">}</span></span><span class="token string">.pdf'</span></span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>rename<span class="token punctuation">.</span>name<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">30]</span><span class="token punctuation">}</span></span><span class="token string">...'</span></span><span class="token punctuation">)</span>        pdf<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>rename<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç”Ÿæ´» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¨è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MMDetection Quick Run</title>
      <link href="/archives/6f4f5bd8.html"/>
      <url>/archives/6f4f5bd8.html</url>
      
        <content type="html"><![CDATA[<h1 id="MMDetection-Quick-Run"><a href="#MMDetection-Quick-Run" class="headerlink" title="MMDetection Quick Run"></a>MMDetection Quick Run</h1><p>æ•´ç†è‡ª <a href="https://mmdetection.readthedocs.io/en/latest/index.html">MMDetection å®˜æ–¹æ–‡æ¡£</a></p><h2 id="Part-1-Inference-and-train-with-existing-models-and-standard-datasets"><a href="#Part-1-Inference-and-train-with-existing-models-and-standard-datasets" class="headerlink" title="Part 1, Inference and train with existing models and standard datasets"></a>Part 1, Inference and train with existing models and standard datasets</h2><blockquote><p>MMDetection provides hundreds of existing and existing detection models in <a href="https://mmdetection.readthedocs.io/en/latest/model_zoo.html">Model Zoo</a>, and supports multiple standard datasets, including Pascal VOC, COCO, CityScapes, LVIS, etc.</p></blockquote><p>è¿™ä¸€éƒ¨åˆ†å°†ç®€è¦ä»‹ç»ï¼Œå¦‚ä½•ä½¿ç”¨ MMDetection å¯¹ Model zoo ä¸­çš„æ¨¡å‹è¿›è¡Œæµ‹è¯•å’Œè®­ç»ƒ</p><h3 id="Inference-with-existing-models"><a href="#Inference-with-existing-models" class="headerlink" title="Inference with existing models"></a>Inference with existing models</h3><blockquote><p>By inference, we mean using trained models to detect objects on images. In MMDetection, a model is defined by a configuration file and existing model parameters are save in a checkpoint file.</p></blockquote><p>è¿™é‡Œä»‹ç»äº† MMDetection æ¨¡å‹è¡¨ç¤ºçš„åŸºæœ¬é€»è¾‘ï¼š<code>configuration file</code>+ <code>checkpoint file</code> </p><p>æ–‡æ¡£ä»¥ Faster R-CNN ä¸ºä¾‹å­ï¼Œå¦‚ä½•è¿›è¡Œç›®æ ‡æ£€æµ‹æ¨ç†</p><blockquote><p>To start with, we recommend <a href="https://github.com/open-mmlab/mmdetection/tree/master/configs/faster_rcnn">Faster RCNN</a> with this <a href="https://github.com/open-mmlab/mmdetection/blob/master/configs/faster_rcnn/faster_rcnn_r50_fpn_1x_coco.py">configuration file</a> and this <a href="https://download.openmmlab.com/mmdetection/v2.0/faster_rcnn/faster_rcnn_r50_fpn_1x_coco/faster_rcnn_r50_fpn_1x_coco_20200130-047c8118.pth">checkpoint file</a>. It is recommended to download the checkpoint file to <code>checkpoints</code> directory.</p></blockquote><p>Q: config files åå­—çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ config å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­æœ‰ markdown æ–‡æ¡£è¿›è¡Œè¯´æ˜ï¼Œä¾‹å¦‚ <a href="https://github.com/open-mmlab/mmdetection/tree/master/configs/faster_rcnn">faster rcnn</a> </p><h4 id="High-level-APIs-for-inference"><a href="#High-level-APIs-for-inference" class="headerlink" title="High-level APIs for inference"></a>High-level APIs for inference</h4><p>åœ¨ä¹‹å‰ä¹Ÿè§åˆ°è¿‡è¿™ä¸ªä»£ç ï¼Œç°åœ¨å†æ¥çœ‹ä¸€çœ‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> mmdet<span class="token punctuation">.</span>apis <span class="token keyword">import</span> init_detector<span class="token punctuation">,</span> inference_detector<span class="token keyword">import</span> mmcv<span class="token comment"># Specify the path to model config and checkpoint file</span>config_file <span class="token operator">=</span> <span class="token string">'configs/faster_rcnn/faster_rcnn_r50_fpn_1x_coco.py'</span>checkpoint_file <span class="token operator">=</span> <span class="token string">'checkpoints/faster_rcnn_r50_fpn_1x_coco_20200130-047c8118.pth'</span><span class="token comment"># build the model from a config file and a checkpoint file</span>model <span class="token operator">=</span> init_detector<span class="token punctuation">(</span>config_file<span class="token punctuation">,</span> checkpoint_file<span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token string">'cuda:0'</span><span class="token punctuation">)</span><span class="token comment"># test a single image and show the results</span>img <span class="token operator">=</span> <span class="token string">'test.jpg'</span>  <span class="token comment"># or img = mmcv.imread(img), which will only load it once</span>result <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token comment"># visualize the results in a new window</span>model<span class="token punctuation">.</span>show_result<span class="token punctuation">(</span>img<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token comment"># or save the visualization results to image files</span>model<span class="token punctuation">.</span>show_result<span class="token punctuation">(</span>img<span class="token punctuation">,</span> result<span class="token punctuation">,</span> out_file<span class="token operator">=</span><span class="token string">'result.jpg'</span><span class="token punctuation">)</span><span class="token comment"># test a video and show the results</span>video <span class="token operator">=</span> mmcv<span class="token punctuation">.</span>VideoReader<span class="token punctuation">(</span><span class="token string">'video.mp4'</span><span class="token punctuation">)</span><span class="token keyword">for</span> frame <span class="token keyword">in</span> video<span class="token punctuation">:</span>    result <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model<span class="token punctuation">,</span> frame<span class="token punctuation">)</span>    model<span class="token punctuation">.</span>show_result<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> result<span class="token punctuation">,</span> wait_time<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­ç”¨åˆ°äº†æ˜¯è¿™ä¸‰ä¸ª API:</p><ol><li>å¼‚æ­¥æ¨ç† <code>async_inference_detector</code></li><li>ç»˜åˆ¶ <code>show_result</code></li><li>æ¨ç† <code>inference_detector</code></li></ol><p>è¿™é‡Œ <code>show_result</code> çš„å‚æ•°è¯·æŸ¥çœ‹ <a href="https://github.com/open-mmlab/mmdetection/blob/a1cecf63c713c53941b8dcf8a9d762baf8511f2c/mmdet/models/detectors/base.py">åŸä»£ç </a>ï¼Œå¦‚æœéœ€è¦æ˜¾ç¤ºçš„è¯è¦æ·»åŠ å‚æ•° <code>show=True</code>ã€‚ä½†åœ¨ç”¨ vscode è¿æ¥è¿œç¨‹æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œå³ä½¿è®¾ç½®äº† <code>show=True</code> ä¹Ÿä¸ä¼šå±•ç¤ºç»“æœï¼Œå¯èƒ½å› ä¸ºæœåŠ¡å™¨ä¸æ”¯æŒ GUIï¼Œæ›¿ä»£çš„æ–¹æ³•å°±æ˜¯åœ¨ Jupyter notebook æˆ–è€… interactive window ä¸­è¿è¡Œ</p><h4 id="Asynchronous-interface-supported-for-Python-3-7"><a href="#Asynchronous-interface-supported-for-Python-3-7" class="headerlink" title="Asynchronous interface - supported for Python 3.7+"></a>Asynchronous interface - supported for Python 3.7+</h4><p>è¿™ä¸€èŠ‚æ²¡æœ‰ç†è§£æ¸…æ¥šï¼Œåªç¨å¾®ç•™äº†ç‚¹å°è±¡ï¼šä½¿ç”¨å¼‚æ­¥æ¥å£ç†è®ºä¸Šèƒ½å¤ŸåŠ é€Ÿæ¨ç†/è®­ç»ƒè¿‡ç¨‹</p><h5 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h5><p>é¦–å…ˆä»€ä¹ˆæ˜¯ <a href="https://blog.csdn.net/lemon4869/article/details/107145903">å¼‚æ­¥æ€ç»´</a>ï¼Œåœ¨é“¾æ¥ä¸­çš„ç†è§£æ¥è¯´ï¼šå¼‚æ­¥å°±æ˜¯ä¸å¿…ç­‰å¾…æ¨ç†ç»“æŸæ‰å¼€å§‹ä¸‹ä¸€å¼ å›¾åƒçš„é¢„å¤„ç†ã€‚ä½†çœ‹åŸä»£ç è¯´çš„å¼‚æ­¥åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæˆ‘ä¹Ÿä¸å¤ªç†è§£ï¼Œä»¥åå†å›æ¥æ•´ç† asyncio ç›¸å…³çŸ¥è¯†å§</p><h5 id="async-amp-await"><a href="#async-amp-await" class="headerlink" title="async &amp; await"></a>async &amp; await</h5><p>ä»€ä¹ˆæ˜¯ Asynchronous interface <a href="https://zhuanlan.zhihu.com/p/353857526">çŸ¥ä¹é“¾æ¥</a></p><p>ä»€ä¹ˆæ˜¯ asyncio <a href="https://blog.csdn.net/permike/article/details/110821246">çŸ¥ä¹é“¾æ¥</a></p><p>Q: è¿™é‡Œéœ€è¦æ›´å¤šçš„ python çŸ¥è¯†ï¼Œæˆ‘å¾—å›å»è¡¥å……ï¼Œæ¯”å¦‚ with å…³é”®å­—ä»€ä¹ˆæ„æ€ï¼Ÿæ•´ä¸ªå¼‚æ­¥çš„è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œèƒ½å¦æŠŠæ•´ä¸ªæ—¶é—´ä¸äº‹ä»¶å¼„æ¸…æ¥šï¼Ÿ</p><h4 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h4><p>æ–‡æ¡£ç»™äº†3ä¸ªdemoï¼š</p><ol><li>Image Demo</li><li>Webcam Demo</li><li>Video Demo</li></ol><p>ç®€å•çœ‹äº†ä¸€ä¸‹ä»£ç ï¼Œçœ‹æ¥è¿˜éœ€è¦è¡¥å……æ€»ç»“ OpenCV çš„ä¸€äº›åŸºç¡€çŸ¥è¯†</p><h3 id="Test-existing-models-on-standard-datasets"><a href="#Test-existing-models-on-standard-datasets" class="headerlink" title="Test existing models on standard datasets"></a>Test existing models on standard datasets</h3><blockquote><p>MMDetection supports multiple public datasets including COCO, Pascal VOC, CityScapes, and <a href="https://github.com/open-mmlab/mmdetection/tree/master/configs/_base_/datasets">more</a>. This section will show how to test existing models on supported datasets.</p></blockquote><h4 id="Prepare-datasets"><a href="#Prepare-datasets" class="headerlink" title="Prepare datasets"></a>Prepare datasets</h4><p>æ¨èåœ¨é¡¹ç›®ä¹‹å¤–å»ºç«‹æ•°æ®é›†ï¼Œç„¶åä»¥è½¯é“¾æ¥çš„å½¢å¼æ”¾åˆ°é¡¹ç›®ä¸­ï¼Œä¸”ç›®å½•ç»“æ„è¦æ ¹æ® config files è§„æ”¾ç½®ï¼ˆæˆ–è€…ä½ è‡ªå·±ä¿®æ”¹ config filesï¼‰ï¼Œä¸¾ä¸ªå‡ ä¸ªä¾‹å­</p><pre class="line-numbers language-none"><code class="language-none">mmdetectionâ”œâ”€â”€ mmdetâ”œâ”€â”€ toolsâ”œâ”€â”€ configsâ”œâ”€â”€ dataâ”‚   â”œâ”€â”€ cocoâ”‚   â”‚   â”œâ”€â”€ annotationsâ”‚   â”‚   â”œâ”€â”€ train2017â”‚   â”‚   â”œâ”€â”€ val2017â”‚   â”‚   â”œâ”€â”€ test2017â”‚   â”œâ”€â”€ cityscapesâ”‚   â”‚   â”œâ”€â”€ annotationsâ”‚   â”‚   â”œâ”€â”€ leftImg8bitâ”‚   â”‚   â”‚   â”œâ”€â”€ trainâ”‚   â”‚   â”‚   â”œâ”€â”€ valâ”‚   â”‚   â”œâ”€â”€ gtFineâ”‚   â”‚   â”‚   â”œâ”€â”€ trainâ”‚   â”‚   â”‚   â”œâ”€â”€ valâ”‚   â”œâ”€â”€ VOCdevkitâ”‚   â”‚   â”œâ”€â”€ VOC2007â”‚   â”‚   â”œâ”€â”€ VOC2012<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Test-existing-models"><a href="#Test-existing-models" class="headerlink" title="Test existing models"></a>Test existing models</h4><blockquote><p>We provide testing scripts for evaluating an existing model on the whole dataset (COCO, PASCAL VOC, Cityscapes, etc.). </p></blockquote><p>å¯ä»¥åœ¨å•ä¸ª GPU ä¸Šæµ‹è¯•ï¼Œä¹Ÿå¯ä»¥åœ¨å¤šä¸ª GPU ä¸Šè¿›è¡Œåˆ†å¸ƒæµ‹è¯•</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># single-gpu testing</span>python tools/test.py <span class="token punctuation">\</span>    <span class="token variable">${CONFIG_FILE}</span> <span class="token punctuation">\</span>    <span class="token variable">${CHECKPOINT_FILE}</span> <span class="token punctuation">\</span>    <span class="token punctuation">[</span>--out <span class="token variable">${RESULT_FILE}</span><span class="token punctuation">]</span> <span class="token punctuation">\</span>    <span class="token punctuation">[</span>--eval <span class="token variable">${EVAL_METRICS}</span><span class="token punctuation">]</span> <span class="token punctuation">\</span>    <span class="token punctuation">[</span>--show<span class="token punctuation">]</span><span class="token comment"># multi-gpu testing</span><span class="token function">bash</span> tools/dist_test.sh <span class="token punctuation">\</span>    <span class="token variable">${CONFIG_FILE}</span> <span class="token punctuation">\</span>    <span class="token variable">${CHECKPOINT_FILE}</span> <span class="token punctuation">\</span>    <span class="token variable">${GPU_NUM}</span> <span class="token punctuation">\</span>    <span class="token punctuation">[</span>--out <span class="token variable">${RESULT_FILE}</span><span class="token punctuation">]</span> <span class="token punctuation">\</span>    <span class="token punctuation">[</span>--eval <span class="token variable">${EVAL_METRICS}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>mmdetection æä¾›å¯¹æ— æ ‡è®°æ•°æ®é›†è¿›è¡Œæµ‹è¯•ï¼Œä½†æ•°æ®é›†éœ€è¦ç¬¦åˆ COCO formatï¼Œå¦‚æœä¸æ˜¯ COCO format ä¾‹å¦‚ VOC æ•°æ®é›†ï¼Œéœ€è¦ä½¿ç”¨ <a href="https://github.com/open-mmlab/mmdetection/tree/master/tools/dataset_converters/pascal_voc.py">script in tools</a> è½¬åŒ–</p><p>mmdetection æä¾› batch inferenceï¼Œèƒ½å¤Ÿä¸€æ¬¡æ¨ç†å¤šä¸ªæ ·æœ¬ï¼Œåœ¨ config files ä¸­ä¿®æ”¹ <code>sample_per_gpu</code> å³å¯ï¼Œæˆ–è€…ä½¿ç”¨ <code>--cfg-options data.test.samples_per_gpu=2</code></p><p>è¿˜æœ‰å¾ˆå¤šå‚æ•°å¯ä»¥è°ƒæ•´ï¼Œå…·ä½“è¯·çœ‹æºä»£ç ï¼Œæ–‡æ¡£ä¹Ÿç»™å‡ºäº†å¾ˆå¤š <a href="https://mmdetection.readthedocs.io/en/latest/1_exist_data_model.html#examples">ä¾‹å­</a></p><h3 id="Train-predefined-models-on-standard-datasets"><a href="#Train-predefined-models-on-standard-datasets" class="headerlink" title="Train predefined models on standard datasets"></a>Train predefined models on standard datasets</h3><blockquote><p>This section will show how to train <em>predefined</em> models (under <a href="https://github.com/open-mmlab/mmdetection/tree/master/configs">configs</a>) on standard datasets i.e. COCO.</p><p><strong>Important</strong>: è®­ç»ƒçš„é»˜è®¤å­¦ä¹ ç‡çš„é…ç½®ä¸º 8ä¸ª GPU å’Œ 2 img/gpuï¼Œä¹Ÿå°±æ˜¯ batch size ä¸º16ï¼Œå¦‚æœä½¿ç”¨ä¸åŒçš„ batch size é‚£ä¹ˆå°±è¦æŒ‰ç…§çº¿æ€§ç¼©æ”¾åŸåˆ™æ›´æ”¹å­¦ä¹ ç‡ e.g., <code>lr=0.01</code> for 4 GPUs <em> 2 imgs/gpu and <code>lr=0.08</code> for 16 GPUs </em> 4 imgs/gpu.</p></blockquote><h4 id="Prepare-datasets-1"><a href="#Prepare-datasets-1" class="headerlink" title="Prepare datasets"></a>Prepare datasets</h4><p>å‡†å¤‡è¿‡ç¨‹å’Œä¸Šä¸€èŠ‚ Test éƒ¨åˆ†æ˜¯ä¸€è‡´çš„ã€‚å»ºè®®å…ˆå°†æ¨¡å‹ä¸‹è½½å¥½ï¼Œä»¥é˜²ç½‘ä¸å¥½å¯¼è‡´æŠ¥é”™</p><h4 id="Training-on-a-single-GPU"><a href="#Training-on-a-single-GPU" class="headerlink" title="Training on a single GPU"></a>Training on a single GPU</h4><p>åœ¨å•ä¸ª GPU ä¸Šè®­ç»ƒï¼ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python tools/train.py <span class="token punctuation">\</span>    <span class="token variable">${CONFIG_FILE}</span> <span class="token punctuation">\</span>    <span class="token punctuation">[</span>optional arguments<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è®­ç»ƒè¿‡ç¨‹ä¸­çš„ log å’Œ checkpoints éƒ½ä¼šè¢«å­˜æ”¾åˆ° <code>work_dir</code> å½“ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>--work-dir</code> é‡æ–°æŒ‡å®š</p><p>é»˜è®¤æ¯12ä¸ª epoch ä½¿ç”¨éªŒè¯é›†å¯¹æ¨¡å‹è¿›è¡Œä¸€æ¬¡è¯„ä¼° evaluationï¼Œtrain.py è¿˜æ¥å—ä¸€äº›å¸¸ç”¨å‚æ•°ï¼š</p><ul><li><code>--no-validate</code> (<strong>not suggested</strong>): Disable evaluation during training.</li><li><code>--work-dir ${WORK_DIR}</code>: Override the working directory.</li><li><code>--resume-from ${CHECKPOINT_FILE}</code>: Resume from a previous checkpoint file.</li><li><code>--options 'Key=value'</code>: Overrides other settings in the used config.</li></ul><p>æ–‡æ¡£æåˆ°ä¸¤ä¸ªå‚æ•°çš„åŒºåˆ«ï¼š<code>--resume-from &amp; --load-from</code> å‰è€…ä¸ä»…åŠ è½½å‚æ•°æƒé‡ï¼Œä¹ŸåŠ è½½ optimizer çš„çŠ¶æ€ï¼Œä¸»è¦ç”¨äºè®­ç»ƒè¢«çªç„¶æ‰“æ–­åæ¥ç€è®­ç»ƒã€‚åè€…åªåŠ è½½å‚æ•°æƒé‡ï¼Œä¸»è¦ç”¨äº finetuning</p><h4 id="Training-on-multiple-GPUs"><a href="#Training-on-multiple-GPUs" class="headerlink" title="Training on multiple GPUs"></a>Training on multiple GPUs</h4><p>åŒæ ·ï¼ŒåŸºæœ¬ç”¨æ³•</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">bash</span> ./tools/dist_train.sh <span class="token punctuation">\</span>    <span class="token variable">${CONFIG_FILE}</span> <span class="token punctuation">\</span>    <span class="token variable">${GPU_NUM}</span> <span class="token punctuation">\</span>    <span class="token punctuation">[</span>optional arguments<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å¯é€‰å‚æ•°å’Œä¸Šé¢è®­ç»ƒå•ä¸ª GPU æ˜¯ä¸€æ ·çš„</p><h5 id="Launch-multiple-jobs-simultaneously"><a href="#Launch-multiple-jobs-simultaneously" class="headerlink" title="Launch multiple jobs simultaneously"></a>Launch multiple jobs simultaneously</h5><p>åœ¨è®­ç»ƒå½“ä¸­ï¼Œé€šå¸¸ä¼šæœ‰å¤šä»»åŠ¡çš„å­˜åœ¨ï¼Œmmdetection ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†ç°åœ¨èƒ½åŠ›æœ‰é™ï¼Œå®åœ¨ä¸èƒ½ç†è§£å…·ä½“çš„å®ç°é€»è¾‘ï¼Œç•™ä¸ª <a href="https://mmdetection.readthedocs.io/en/latest/1_exist_data_model.html#training-on-multiple-gpus">åŸæ–‡æ¡£é“¾æ¥</a></p><p>æåˆ°äº†å¾ˆå¤šæ–°ä¸œè¥¿ï¼Œnodes, port, slurm, pytorch launch utilityâ€¦å¦‚æœèƒ½å¤Ÿåœ¨å®è·µä¸­ç†è§£è¿™äº›æ¦‚å¿µæ›´å¥½äº†</p><h2 id="Part-2-Train-with-customized-datasets"><a href="#Part-2-Train-with-customized-datasets" class="headerlink" title="Part 2, Train with customized datasets"></a>Part 2, Train with customized datasets</h2><blockquote><p> We use the <a href="https://github.com/matterport/Mask_RCNN/tree/master/samples/balloon">balloon dataset</a> as an example to describe the whole process.</p></blockquote><p>åŸºæœ¬æ­¥éª¤ä¸ºï¼š</p><ol><li>Prepare the customized dataset</li><li>Prepare a config</li><li>Train, test, inference models on the customized dataset.</li></ol><h3 id="Prepare-the-customized-dataset"><a href="#Prepare-the-customized-dataset" class="headerlink" title="Prepare the customized dataset"></a>Prepare the customized dataset</h3><p>mmdetection æ”¯æŒå¯¹ COCO format æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œå°†ä¸åŒæ ¼å¼çš„æ•°æ®é›†è½¬åŒ–ä¸º COCO format å³å¯ã€‚å¯èƒ½ä¹Ÿå¯ä»¥å¯¹ config file è¿›è¡Œé…ç½®ï¼Œæ¥é€‚é…ä¸åŒæ ¼å¼çš„æ•°æ®é›†ï¼Œä½†è¿™ä¸€éƒ¨åˆ†æ–‡æ¡£æ²¡æœ‰æåŠ</p><h4 id="COCO-annotation-format"><a href="#COCO-annotation-format" class="headerlink" title="COCO annotation format"></a>COCO annotation format</h4><blockquote><p>The necessary keys of COCO format for instance segmentation is as below, for the complete details, please refer <a href="https://cocodataset.org/#format-data">here</a>.</p></blockquote><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token punctuation">[</span>image<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"annotations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>annotation<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"categories"</span><span class="token operator">:</span> <span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">}</span>image = <span class="token punctuation">{</span>    <span class="token property">"id"</span><span class="token operator">:</span> int<span class="token punctuation">,</span>    <span class="token property">"width"</span><span class="token operator">:</span> int<span class="token punctuation">,</span>    <span class="token property">"height"</span><span class="token operator">:</span> int<span class="token punctuation">,</span>    <span class="token property">"file_name"</span><span class="token operator">:</span> str<span class="token punctuation">,</span><span class="token punctuation">}</span>annotation = <span class="token punctuation">{</span>    <span class="token property">"id"</span><span class="token operator">:</span> int<span class="token punctuation">,</span>    <span class="token property">"image_id"</span><span class="token operator">:</span> int<span class="token punctuation">,</span>    <span class="token property">"category_id"</span><span class="token operator">:</span> int<span class="token punctuation">,</span>    <span class="token property">"segmentation"</span><span class="token operator">:</span> RLE or <span class="token punctuation">[</span>polygon<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"area"</span><span class="token operator">:</span> float<span class="token punctuation">,</span>    <span class="token property">"bbox"</span><span class="token operator">:</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"iscrowd"</span><span class="token operator">:</span> <span class="token number">0</span> or <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">}</span>categories = <span class="token punctuation">[</span><span class="token punctuation">{</span>    <span class="token property">"id"</span><span class="token operator">:</span> int<span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> str<span class="token punctuation">,</span>    <span class="token property">"supercategory"</span><span class="token operator">:</span> str<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>balloon dataset format å½¢å¦‚ä¸‹</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>'base64_img_data'<span class="token operator">:</span> ''<span class="token punctuation">,</span> 'file_attributes'<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 'filename'<span class="token operator">:</span> '34020010494_e5cb88e1c4_k.jpg'<span class="token punctuation">,</span> 'fileref'<span class="token operator">:</span> ''<span class="token punctuation">,</span> 'regions'<span class="token operator">:</span> <span class="token punctuation">{</span>'<span class="token number">0</span>'<span class="token operator">:</span> <span class="token punctuation">{</span>'region_attributes'<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   'shape_attributes'<span class="token operator">:</span> <span class="token punctuation">{</span>'all_points_x'<span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    'all_points_y'<span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    'name'<span class="token operator">:</span> 'polygon'<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 'size'<span class="token operator">:</span> <span class="token number">1115004</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–‡æ¡£æä¾›äº†å‡½æ•°å°† balloon dataset JSON æ ¼å¼è½¬åŒ–ä¸º COCO formatï¼Œ<a href="https://mmdetection.readthedocs.io/en/latest/2_new_data_model.html#coco-annotation-format">åŸæ–‡æ¡£</a></p><h3 id="Prepare-a-config"><a href="#Prepare-a-config" class="headerlink" title="Prepare a config"></a>Prepare a config</h3><blockquote><p>The second step is to prepare a config thus the dataset could be successfully loaded. </p></blockquote><p>å‡è®¾ä»¥ balloon dataset è®­ç»ƒ Mask R-CNN with FPNï¼Œconfig åœ¨ <code>configs/balloon</code> å‘½åä¸º  <code>mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_balloon.py</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># The new config inherits a base config to highlight the necessary modification</span>_base_ <span class="token operator">=</span> <span class="token string">'mask_rcnn/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_coco.py'</span><span class="token comment"># We also need to change the num_classes in head to match the dataset's annotation</span>model <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    roi_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        bbox_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        mask_head<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>num_classes<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># Modify dataset related settings</span>dataset_type <span class="token operator">=</span> <span class="token string">'COCODataset'</span>classes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'balloon'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    train<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        img_prefix<span class="token operator">=</span><span class="token string">'balloon/train/'</span><span class="token punctuation">,</span>        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'balloon/train/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    val<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        img_prefix<span class="token operator">=</span><span class="token string">'balloon/val/'</span><span class="token punctuation">,</span>        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'balloon/val/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    test<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>        img_prefix<span class="token operator">=</span><span class="token string">'balloon/val/'</span><span class="token punctuation">,</span>        classes<span class="token operator">=</span>classes<span class="token punctuation">,</span>        ann_file<span class="token operator">=</span><span class="token string">'balloon/val/annotation_coco.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># We can use the pre-trained Mask RCNN model to obtain higher performance</span>load_from <span class="token operator">=</span> <span class="token string">'checkpoints/mask_rcnn_r50_caffe_fpn_mstrain-poly_3x_coco_bbox_mAP-0.408__segm_mAP-0.37_20200504_163245-42aa3d00.pth'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Train-amp-Test-Model"><a href="#Train-amp-Test-Model" class="headerlink" title="Train &amp; Test Model"></a>Train &amp; Test Model</h3><p>é…ç½®å¥½äº†æ•°æ®é›†è¿‡åï¼ŒåŸºæœ¬ä¸Šå°±å’Œ Part 1 ä¸­çš„è®­ç»ƒå’Œæµ‹è¯•æ–¹æ³•ä¸€æ ·</p><p>To train a model with the new config, you can simply run</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python tools/train.py configs/balloon/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_balloon.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>To test the trained model, you can simply run</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python tools/test.py configs/balloon/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_balloon.py <span class="token punctuation">\</span>work_dirs/mask_rcnn_r50_caffe_fpn_mstrain-poly_1x_balloon.py/latest.pth <span class="token punctuation">\</span>--eval bbox segm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="Part-3-Train-with-customized-models-and-standard-datasets"><a href="#Part-3-Train-with-customized-models-and-standard-datasets" class="headerlink" title="Part 3, Train with customized models and standard datasets"></a>Part 3, Train with customized models and standard datasets</h2><blockquote><p>In this note, you will know how to train, test and inference your own customized models under standard datasets.</p></blockquote><p>ä½¿ç”¨ cityscapes dataset è®­ç»ƒä¸ªæ€§åŒ– Cascade Mask R-CNN R50 modelï¼Œä½¿ç”¨ <a href="https://github.com/Gus-Guo/AugFPN"><code>AugFPN</code></a> æ›¿ä»£ <code>FPN</code> ä½œä¸º neckï¼Œå¹¶ä¸”åŠ ä¸Š <code>Rotate</code> or <code>Translate</code> ä½œä¸ºæ•°æ®å¢å¼º</p><p>åŸºæœ¬æ­¥éª¤æ¯” Part 2 å¤šä¸€ä¸ªå‡†å¤‡ customized model:</p><ol><li>Prepare the standard dataset</li><li>Prepare your own customized model</li><li>Prepare a config</li><li>Train, test, and inference models on the standard dataset</li></ol><h3 id="Prepare-the-standard-dataset"><a href="#Prepare-the-standard-dataset" class="headerlink" title="Prepare the standard dataset"></a>Prepare the standard dataset</h3><p>åŸºæœ¬æµç¨‹ï¼Œä¹Ÿæ˜¯éœ€è¦å°† cityscapes dataset è½¬ä¸º COCO formatï¼Œmmdetection ä¹Ÿæä¾›è½¬åŒ–è„šæœ¬ <code>tools/dataset_converters/cityscapes.py</code></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> cityscapesscriptspython tools/dataset_converters/cityscapes.py ./data/cityscapes --nproc <span class="token number">8</span> --out-dir ./data/cityscapes/annotations<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Prepare-your-own-customized-model"><a href="#Prepare-your-own-customized-model" class="headerlink" title="Prepare your own customized model"></a>Prepare your own customized model</h3><h4 id="1-Define-a-new-neck-e-g-AugFPN"><a href="#1-Define-a-new-neck-e-g-AugFPN" class="headerlink" title="1. Define a new neck (e.g. AugFPN)"></a>1. Define a new neck (e.g. AugFPN)</h4><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ–‡ä»¶ <code>mmdet/models/necks/augfpn.py</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>builder <span class="token keyword">import</span> NECKS@NECKS<span class="token punctuation">.</span>register_module<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">AugFPN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>                in_channels<span class="token punctuation">,</span>                out_channels<span class="token punctuation">,</span>                num_outs<span class="token punctuation">,</span>                start_level<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>                end_level<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>                add_extra_convs<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># implementation is ignored        pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ³¨æ„è¿™é‡Œç”¨äº†ä¸€ä¸ªè£…é¥°å™¨ï¼Œå¤ä¹  python çš„æ—¶å€™å¯ä»¥è”ç³»èµ·æ¥</p><h4 id="2-Import-the-module"><a href="#2-Import-the-module" class="headerlink" title="2. Import the module"></a>2. Import the module</h4><p>å¯¼å…¥æ¨¡å—æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ol><li><p>åœ¨  <code>mmdet/models/necks/__init__.py</code> å¯¼å…¥</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>augfpn <span class="token keyword">import</span> AugFPN<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åœ¨ config æ–‡ä»¶ä¸­æ›´æ”¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">custom_imports <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>    imports<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'mmdet.models.necks.augfpn.py'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    allow_failed_imports<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±é¿å…å»æ›´æ”¹åŸæ–‡ä»¶</p></li></ol><h4 id="3-Modify-the-config-file"><a href="#3-Modify-the-config-file" class="headerlink" title="3. Modify the config file"></a>3. Modify the config file</h4><p>å°† neck åŠ å…¥åˆ° config file ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">neck<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>    <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'AugFPN'</span><span class="token punctuation">,</span>    in_channels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    out_channels<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span>    num_outs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæƒ³è¦æ›´æ”¹åˆ«äººçš„æ¨¡å‹ï¼Œmmdetection éƒ½æ˜¯ä»¥ config file ä¸ºæ ¸å¿ƒï¼Œè€Œä¸å»æ›´æ”¹åŸæ–‡ä»¶</p><p>å¦‚æœè¦å®Œæˆ AugFPN, Rotate, Translate ä¸‰ä¸ªä¿®æ”¹çš„è¯ï¼Œåœ¨æ–‡æ¡£ä¸­ç»™å‡ºäº†å‚è€ƒçš„ <a href="https://mmdetection.readthedocs.io/en/latest/3_exist_data_new_model.html#prepare-a-config">config file</a></p><h3 id="Train-amp-Test-Model-1"><a href="#Train-amp-Test-Model-1" class="headerlink" title="Train &amp; Test Model"></a>Train &amp; Test Model</h3><p>è®­ç»ƒå’Œæµ‹è¯•åŸºæœ¬ä½¿ç”¨æ–¹æ³•åœ¨ä¹‹å‰å·²ç»ä»‹ç»è¿‡ï¼Œè¿™éƒ¨åˆ†ä¹Ÿä¸€æ ·</p><p>To train a model with the new config, you can simply run</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python tools/train.py configs/cityscapes/cascade_mask_rcnn_r50_augfpn_autoaug_10e_cityscapes.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>To test the trained model, you can simply run</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python tools/test.py configs/cityscapes/cascade_mask_rcnn_r50_augfpn_autoaug_10e_cityscapes.py <span class="token punctuation">\</span>work_dirs/cascade_mask_rcnn_r50_augfpn_autoaug_10e_cityscapes.py/latest.pth --eval bbox segm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><h3 id="pthæ–‡ä»¶é‡Œæœ‰ä»€ä¹ˆ"><a href="#pthæ–‡ä»¶é‡Œæœ‰ä»€ä¹ˆ" class="headerlink" title=".pthæ–‡ä»¶é‡Œæœ‰ä»€ä¹ˆ"></a>.pthæ–‡ä»¶é‡Œæœ‰ä»€ä¹ˆ</h3><p>è¦å›ç­”ä¸€ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæ˜¯ <a href="https://zhuanlan.zhihu.com/p/84797438">.pth æ–‡ä»¶ çŸ¥ä¹</a>ï¼Œåœ¨ mmdetection æ¡†æ¶ä¸­å¯ä»¥çœ‹åˆ° pth æ–‡ä»¶åŒ…å«äº†ä¸¤ä¸ªéƒ¨åˆ† <code>meta &amp; state_dict</code></p><p>å…¶ä¸­ <code>meta</code> ä¿å­˜äº†æ¨¡å‹çš„é…ç½®ä¿¡æ¯ï¼Œåˆ—å‡ºå…¶ keyï¼š</p><ol><li>mmdet_version</li><li><strong>config</strong></li><li>CLASSES</li><li>epoch</li><li>iter</li><li>mmcv_version</li><li>time</li></ol><p>è€Œ <code>state_dict</code> ä¿å­˜äº†æ¨¡å‹å‚æ•°å€¼ï¼Œåˆ—å‡ºéƒ¨åˆ† keyï¼š</p><p>backbone.conv1.weight<br>backbone.bn1.weight<br>backbone.bn1.bias<br>backbone.bn1.running_mean<br>backbone.bn1.running_var<br>backbone.bn1.num_batches_tracked<br>backbone.layer1.0.conv1.weight<br>backbone.layer1.0.bn1.weight<br>backbone.layer1.0.bn1.bias<br>backbone.layer1.0.bn1.running_mean<br>backbone.layer1.0.bn1.running_var<br>backbone.layer1.0.bn1.num_batches_tracked</p><p>â€¦â€¦.</p><h3 id="å¦‚ä½•ç†è§£-Registry"><a href="#å¦‚ä½•ç†è§£-Registry" class="headerlink" title="å¦‚ä½•ç†è§£ Registry"></a>å¦‚ä½•ç†è§£ Registry</h3><p>åœ¨å­¦ä¹  mmdetection è¿‡ç¨‹ä¸­ä¸€ç›´åˆä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•ä½¿ç”¨ config + registry è¿”å›ä¸€ä¸ª nn.Module ç±»çš„æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹æ˜¯å¦‚ä½•è¢«æ³¨å†Œåˆ° Registry ç±»å½“ä¸­çš„ï¼Ÿ</p><p>é˜…è¯»èµ„æºï¼š</p><ol><li><p><a href="https://blog.csdn.net/sinat_29963957">mmdetection æºç é˜…è¯»ç¬”è®°</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/337375549">mmdetection æ•´ä½“æ„å»ºæµç¨‹</a></p></li><li><p><a href="https://blog.csdn.net/wulele2/article/details/114139512">mmdetectionä¹‹modelæ„å»º</a></p></li><li><p><a href="https://mmtracking.readthedocs.io/en/latest/">MMCV å®˜æ–¹æ–‡æ¡£</a>ï¼Œè¿™ä¸ªæ–‡æ¡£ç›¸å½“æœ‰ç”¨ï¼Œæ˜¯ mmlab çš„é€šç”¨åŸºç¡€åº“ï¼Œè¦å¥½å¥½å­¦ä¹ ä¸€ä¸‹</p></li><li><p><a href="https://www.cnblogs.com/hester/p/10546235.html#:~:text=Python%E4%B8%AD%E4%B8%80%E4%B8%AApy%E6%96%87%E4%BB%B6%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9D%97%EF%BC%8C%E2%80%9C__all__%E2%80%9D%E5%8F%98%E9%87%8F%E6%98%AF%E4%B8%80%E4%B8%AA%E7%89%B9%E6%AE%8A%E7%9A%84%E5%8F%98%E9%87%8F%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8py%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%8C%85%E7%9A%84__init__.py%E4%B8%AD%E5%87%BA%E7%8E%B0%E3%80%82%20%E5%A6%82%EF%BC%9A%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%8C%E5%87%BD%E6%95%B0%EF%BC%8C%E7%B1%BB%E3%80%82%20%E5%A6%82%E4%B8%8B%EF%BC%8Ctest1.py%E5%92%8Cmain.py,%3F%20%3F%20%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E5%9C%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E7%9B%AE%E5%BD%95%E4%B8%8B%E3%80%82%20%E9%82%A3%E4%B9%88%E5%9C%A8%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84__all__%E5%8F%98%E9%87%8F%E5%B0%B1%E6%98%AF%E4%B8%BA%E4%BA%86%E9%99%90%E5%88%B6%E6%88%96%E8%80%85%E6%8C%87%E5%AE%9A%E8%83%BD%E8%A2%AB%E5%AF%BC%E5%85%A5%E5%88%B0%E5%88%AB%E7%9A%84%E6%A8%A1%E5%9D%97%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E7%B1%BB%EF%BC%8C%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E7%AD%89%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%8C%87%E5%AE%9A%E4%BA%86%E9%82%A3%E4%B9%88%E5%8F%AA%E8%83%BD%E6%98%AF%E6%8C%87%E5%AE%9A%E7%9A%84%E9%82%A3%E4%BA%9B%E5%8F%AF%E4%BB%A5%E8%A2%AB%E5%AF%BC%E5%85%A5%EF%BC%8C%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E9%BB%98%E8%AE%A4%E5%B0%B1%E6%98%AF%E5%85%A8%E9%83%A8%E5%8F%AF%E4%BB%A5%E5%AF%BC%E5%85%A5%EF%BC%8C%E5%BD%93%E7%84%B6%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7%E5%BA%94%E8%AF%A5%E9%99%A4%E5%A4%96%E3%80%82">python __all__å˜é‡</a></p></li><li>åœ¨ B ç«™ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªå®˜æ–¹ <a href="https://space.bilibili.com/630319191/channel/detail?cid=179690&amp;ctype=0">å­¦ä¹ è®²åº§ç³»åˆ—</a>ï¼Œè¿™ä¸ªè®²åº§ä¸å¤ªå’Œæˆ‘èƒƒå£ï¼Œåˆåœ¨ B ç«™ä¸Šæ‰¾äº†ä¸€ä¸ªè¥¿äº¤çš„ <a href="https://www.bilibili.com/video/BV1Jb4y1r7ir?p=1">æ•™å­¦è§†é¢‘</a>ï¼Œè¿™ä¸ªè§†é¢‘å°±æ¯”è¾ƒå‹å¥½ï¼Œå¯¹æˆ‘å¸®åŠ©æ›´å¤§</li></ol><p>æˆ‘ä¸€ç›´éƒ½å¾ˆä¸ç†è§£è¿™äº›ç±»æ˜¯æ€ä¹ˆæ³¨å†Œçš„ï¼Œä¸ºä»€ä¹ˆæœ‰çš„ä»£ç ä¼¼ä¹æ²¡æœ‰â€œæ˜æ˜¾â€åœ°è¿è¡Œï¼Œä½†æ˜¯è¿™äº›æ¨¡å—å°±å·²ç»è¢«æ³¨å†Œåˆ° Registry å½“ä¸­äº†ï¼Ÿçœ‹å®Œ MMCV æ–‡æ¡£ä¹‹åæ‰å¤§æ¦‚æ˜ç™½äº†ï¼Œé‡ç‚¹å°±åœ¨äº <code>__init__.py</code> æ–‡ä»¶ä»¥åŠ <code>__all__</code> å˜é‡ã€‚å¯ä»¥çœ‹åˆ°åœ¨è®¸å¤šæ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰ <code>__init__.py</code> æ–‡ä»¶ï¼Œä¾‹å¦‚ <code>mmdet/models/__init__.py</code>, <code>mmdet/models/backbones/__init__.py</code></p><p>å¦‚æœ import æ–‡ä»¶å¤¹/æ¨¡å—ä¸‹æœ‰ init.py æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ import è¯¥æ¨¡å—ä¹‹å‰å…ˆè¿è¡Œ init.py æ–‡ä»¶ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶ä¹‹ä¸­å®Œæˆäº†å„ä¸ªæ¨¡å—çš„æ³¨å†Œï¼Œå…¶ä¸­ <code>__all__</code> å˜é‡åŒ…å«äº†éœ€è¦å¯¼å…¥çš„æ¨¡å—åˆ—è¡¨</p><p>å…·ä½“çœ‹ä¸€ä¸‹å…¶ä¸­çš„å†…å®¹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>backbones <span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token comment"># noqa: F401,F403</span><span class="token keyword">from</span> <span class="token punctuation">.</span>builder <span class="token keyword">import</span> <span class="token punctuation">(</span>BACKBONES<span class="token punctuation">,</span> DETECTORS<span class="token punctuation">,</span> HEADS<span class="token punctuation">,</span> LOSSES<span class="token punctuation">,</span> NECKS<span class="token punctuation">,</span>                      ROI_EXTRACTORS<span class="token punctuation">,</span> SHARED_HEADS<span class="token punctuation">,</span> build_backbone<span class="token punctuation">,</span>                      build_detector<span class="token punctuation">,</span> build_head<span class="token punctuation">,</span> build_loss<span class="token punctuation">,</span> build_neck<span class="token punctuation">,</span>                      build_roi_extractor<span class="token punctuation">,</span> build_shared_head<span class="token punctuation">)</span><span class="token keyword">from</span> <span class="token punctuation">.</span>dense_heads <span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token comment"># noqa: F401,F403</span><span class="token keyword">from</span> <span class="token punctuation">.</span>detectors <span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token comment"># noqa: F401,F403</span><span class="token keyword">from</span> <span class="token punctuation">.</span>losses <span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token comment"># noqa: F401,F403</span><span class="token keyword">from</span> <span class="token punctuation">.</span>necks <span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token comment"># noqa: F401,F403</span><span class="token keyword">from</span> <span class="token punctuation">.</span>plugins <span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token comment"># noqa: F401,F403</span><span class="token keyword">from</span> <span class="token punctuation">.</span>roi_heads <span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token comment"># noqa: F401,F403</span>__all__ <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">'BACKBONES'</span><span class="token punctuation">,</span> <span class="token string">'NECKS'</span><span class="token punctuation">,</span> <span class="token string">'ROI_EXTRACTORS'</span><span class="token punctuation">,</span> <span class="token string">'SHARED_HEADS'</span><span class="token punctuation">,</span> <span class="token string">'HEADS'</span><span class="token punctuation">,</span> <span class="token string">'LOSSES'</span><span class="token punctuation">,</span>    <span class="token string">'DETECTORS'</span><span class="token punctuation">,</span> <span class="token string">'build_backbone'</span><span class="token punctuation">,</span> <span class="token string">'build_neck'</span><span class="token punctuation">,</span> <span class="token string">'build_roi_extractor'</span><span class="token punctuation">,</span>    <span class="token string">'build_shared_head'</span><span class="token punctuation">,</span> <span class="token string">'build_head'</span><span class="token punctuation">,</span> <span class="token string">'build_loss'</span><span class="token punctuation">,</span> <span class="token string">'build_detector'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Bug-amp-vscode-debugger"><a href="#Bug-amp-vscode-debugger" class="headerlink" title="Bug  &amp; vscode debugger"></a>Bug  &amp; vscode debugger</h3><p>æ£é¼“äº†ä¸€å¤©äº†åœ¨æœåŠ¡å™¨ï¼Œæ€ä¹ˆéƒ½ä¸èƒ½å¤Ÿæå¥½ xrdpï¼Œè¿˜å·®ç‚¹æŠŠç”µè„‘å¼„å‡ºç‚¹æ¯›ç—…â€¦æœ€åç”¨ <code>sudo dpkg --purge xrdp</code> åˆ é™¤äº†æ²¡æœ‰ä¸‹è½½å®Œå…¨çš„åŒ…æ‰å¼„å¥½äº†ã€‚æˆ‘è®¤ä¸ºå®éªŒå®¤çš„æœåŠ¡å™¨éœ€è¦ä¸€ä¸ªå¤§æ›´æ–°ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿå‡çº§ï¼Œå¦ä¸€ä¸ªæ˜¯æ¸…ç†å†…å­˜ï¼Œç°åœ¨å¤§æ¦‚è¿˜æœ‰350Gçš„ç©ºé—´å‰©ä½™ï¼Œæœ€é‡è¦çš„æ˜¯æœåŠ¡å™¨çš„ç½‘ç»œæ˜¯ä¸ªå¤§é—®é¢˜ï¼å¾ˆå¤šèµ„æºéƒ½æ— æ³•ç›´æ¥ä¸‹è½½ï¼Œæœ‰äº›èµ„æºä¸‹è½½èµ·æ¥éå¸¸åƒåŠ›</p><p>æ”¾ä¸€ä¸ª <a href="https://www.jianshu.com/p/ceb3c020e06b">nvidia-smiè®²è§£é“¾æ¥</a>ï¼Œç†è§£ä¸€ä¸‹å„ä¸ªæŒ‡æ ‡æ˜¯åœ¨è¯´ä»€ä¹ˆ</p><h4 id="vscode-debugger"><a href="#vscode-debugger" class="headerlink" title="vscode debugger"></a>vscode debugger</h4><p>åœ¨ä½¿ç”¨ vscode debug çš„æ—¶å€™å‘ç°æœ‰çš„ä»£ç å¹¶ä¸ä¼š step inï¼Œåæ¥å‘ç°è¿™äº›ä»£ç éƒ½æ˜¯é€šè¿‡ pip/conda install ä¸‹è½½çš„åº“ä¸­çš„ä»£ç ã€‚è€Œ vscode çš„ debugger ä¼šé»˜è®¤è®¾å®šåªåœ¨ â€˜MyCodeâ€™ ä¸­è¿›è¡Œ debugï¼Œç®€å•çš„è¯´ï¼Œå¦‚æœä¸æ˜¯â€œè‡ªå·±â€å†™çš„ä»£ç ï¼Œvscode debugger æ˜¯ä¸ä¼š step in çš„</p><p>è§£å†³åŠæ³•ï¼šåœ¨ debugger çš„ json æ–‡ä»¶ä¸­è®¾ç½® <code>"justMyCode: false"</code></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>    <span class="token comment">// Use IntelliSense to learn about possible attributes.</span>    <span class="token comment">// Hover to view descriptions of existing attributes.</span>    <span class="token comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">{</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Python: Current File"</span><span class="token punctuation">,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"python"</span><span class="token punctuation">,</span>            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"${file}"</span><span class="token punctuation">,</span>            <span class="token property">"console"</span><span class="token operator">:</span> <span class="token string">"integratedTerminal"</span><span class="token punctuation">,</span>            <span class="token comment">// add the next line into your .json file</span>            <span class="token property">"justMyCode"</span><span class="token operator">:</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span>    <span class="token punctuation">]</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ol><li><p>è¿˜éœ€è¦æ•´ç† MMCV ä»¥äº†è§£æ•´ä¸ª OpenMMLab çš„è¿è¡Œé€»è¾‘ </p></li><li><p>å¯¹äºå¦‚ä½•è®­ç»ƒè‡ªå·±çš„ç½‘ç»œè¿˜è¦ç»§ç»­çœ‹æ–‡æ¡£ä¸­çš„ Tutorial éƒ¨åˆ†</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MMDetection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£… MMDetection ç¬”è®°</title>
      <link href="/archives/54605061.html"/>
      <url>/archives/54605061.html</url>
      
        <content type="html"><![CDATA[<h1 id="å®‰è£…-MMDetection-ç¬”è®°"><a href="#å®‰è£…-MMDetection-ç¬”è®°" class="headerlink" title="å®‰è£… MMDetection ç¬”è®°"></a>å®‰è£… MMDetection ç¬”è®°</h1><p>æƒ³æ³•ï¼šé€šè¿‡è¿™ç§æ ‡å‡†åŒ–çš„ç®—æ³•æ¡†æ¶ï¼Œæ¥è¿›è¡Œç»„åˆå®éªŒ</p><p>ä½†æ˜¯ç›®å‰ SE-SSD æ²¡æœ‰æ”¯æŒï¼Œå¯ä»¥å°è¯•ç»„åˆä¸€ä¸‹</p><h2 id="OpenMMLab"><a href="#OpenMMLab" class="headerlink" title="OpenMMLab"></a>OpenMMLab</h2><p>å®˜ç½‘ï¼š<a href="https://openmmlab.com/">https://openmmlab.com/</a></p><p>github: <a href="https://github.com/open-mmlab">https://github.com/open-mmlab</a></p><p>å­é¡¹ç›®å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://mmdetection.readthedocs.io/zh_CN/latest/">MMDetection</a> <a href="https://mmdetection3d.readthedocs.io/zh_CN/latest/index.html">MMDetection3D</a></p><p>ä»€ä¹ˆæ˜¯ OpenMMLabï¼Ÿä»€ä¹ˆæ˜¯ MMDdetctionï¼Ÿ</p><blockquote><p>OpenMMLab æ˜¯ä¸€ä¸ªè®¡ç®—æœºè§†è§‰å¼€æºç®—æ³•ä½“ç³»å’Œæ¡†æ¶ï¼Œæ¶‰åŠè¶…è¿‡10ç§ç ”ç©¶æ–¹å‘ï¼Œå¼€æ”¾è¶…è¿‡100ç§ç®—æ³•ã€800ç§é¢„è®­ç»ƒæ¨¡å‹</p><p>MMDetection is an open source object detection toolbox based on PyTorch. It is a part of the OpenMMLab project.</p></blockquote><h2 id="å®‰è£…ç¯å¢ƒ"><a href="#å®‰è£…ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¯å¢ƒ"></a>å®‰è£…ç¯å¢ƒ</h2><p>æˆ‘æ‰“ç®—å…ˆç†Ÿæ‚‰ MMDetectionï¼Œå› ä¸ºè¿™ä¸ªé¡¹ç›®åœ¨ github ä¸Š star æ˜¯ç›¸å¯¹è¾ƒå¤šçš„ï¼Œç„¶åå†è¿›ä¸€æ­¥å­¦ä¹  mmdetection 3Dï¼Œä¸‹é¢æ¥å®‰è£… MMDetection ç¯å¢ƒ</p><p>é¦–å…ˆçœ‹çœ‹ä¾èµ–çš„è¦æ±‚</p><ul><li>Linux å’Œ macOS ï¼ˆWindows ç†è®ºä¸Šæ”¯æŒï¼‰</li><li>Python 3.6+</li><li>PyTorch 1.3+</li><li>CUDA 9.2+ ï¼ˆå¦‚æœåŸºäº PyTorch æºç å®‰è£…ï¼Œä¹Ÿèƒ½å¤Ÿæ”¯æŒ CUDA 9.0ï¼‰</li><li>GCC 5+</li><li><a href="https://mmcv.readthedocs.io/en/latest/#installation">MMCV</a></li></ul><p>ä¹‹åä¸‹è½½çš„ä¾èµ–ç‰ˆæœ¬å‚è€ƒè¦æ±‚æ¥</p><ol><li><p>åˆ›å»º conda ç¯å¢ƒ <code>conda create -n mmlab python=3.7</code></p></li><li><p>å®‰è£… pytorch</p><p>åœ¨ <a href="https://pytorch.org/get-started/previous-versions/">pytorch previous versions</a> ä¸­æŸ¥æ‰¾ä½ æƒ³è¦çš„ç‰ˆæœ¬ï¼Œæˆ‘é€‰æ‹©å¦‚ä¸‹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">conda <span class="token function">install</span> <span class="token assign-left variable">pytorch</span><span class="token operator">==</span><span class="token number">1.5</span>.1 <span class="token assign-left variable">torchvision</span><span class="token operator">==</span><span class="token number">0.6</span>.1 <span class="token assign-left variable">cudatoolkit</span><span class="token operator">=</span><span class="token number">10.1</span> -c pytorch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ­¤æ—¶æŸ¥çœ‹æˆ‘çš„ç”µè„‘ä¸Šå®‰è£…çš„ CUDA ç‰ˆæœ¬ï¼Œä½¿ç”¨å‘½ä»¤ <code>nvcc -V</code></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nvcc: NVIDIA <span class="token punctuation">(</span>R<span class="token punctuation">)</span> Cuda compiler driverCopyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2005</span>-2018 NVIDIA CorporationBuilt on Sat_Aug_25_21:08:01_CDT_2018Cuda compilation tools, release <span class="token number">10.0</span>, V10.0.130<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¯¥ç‰ˆæœ¬ä¸º 10.0 å’Œ cudatoolkit çš„ 10.1 ç‰ˆæœ¬å¹¶ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆ pytorch ç©¶ç«Ÿæ˜¯ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨ 10.0 çš„ç‰ˆæœ¬ï¼Œéœ€è¦æ›´æ”¹ä¸€ä¸‹ç¯å¢ƒ CUDA_HOME ç¯å¢ƒå˜é‡ã€‚æ›´å¤šçš„ä¿¡æ¯ï¼Œè¯·é˜…è¯»è¡¥å……ç¬”è®°</p></li></ol><h2 id="å®‰è£…-MMDetection"><a href="#å®‰è£…-MMDetection" class="headerlink" title="å®‰è£… MMDetection"></a>å®‰è£… MMDetection</h2><p>å®˜æ–¹æ¨èä½¿ç”¨ <a href="https://github.com/open-mmlab/mim">MIM</a> å®‰è£… MMDetection</p><blockquote><p>MIM provides a unified interface for launching and installing OpenMMLab projects and their extensions, and managing the OpenMMLab model zoo.</p></blockquote><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> openmimmim <span class="token function">install</span> mmdet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>MIM è‡ªåŠ¨ä¸‹è½½äº† mmdet åŠå…¶å¯¹åº”ä¾èµ–</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># mim list</span>Package    Version    Source---------  ---------  -----------------------------------------mmcv-full  <span class="token number">1.3</span>.10     https://github.com/open-mmlab/mmcvmmdet      <span class="token number">2.15</span>.0     https://github.com/open-mmlab/mmdetection<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>å°† MMDetection ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼Œè¿è¡Œå¦‚ä¸‹ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> mmdet<span class="token punctuation">.</span>apis <span class="token keyword">import</span> inference_detector<span class="token punctuation">,</span> init_detectorconfig_file <span class="token operator">=</span> <span class="token string">'configs/faster_rcnn/faster_rcnn_r50_fpn_1x_coco.py'</span><span class="token comment"># ä» model zoo ä¸‹è½½ checkpoint å¹¶æ”¾åœ¨ `checkpoints/` æ–‡ä»¶ä¸‹</span><span class="token comment"># ç½‘å€ä¸º: http://download.openmmlab.com/mmdetection/v2.0/faster_rcnn/faster_rcnn_r50_fpn_1x_coco/faster_rcnn_r50_fpn_1x_coco_20200130-047c8118.pth</span>checkpoint_file <span class="token operator">=</span> <span class="token string">'checkpoints/faster_rcnn_r50_fpn_1x_coco_20200130-047c8118.pth'</span>device <span class="token operator">=</span> <span class="token string">'cuda:0'</span><span class="token comment"># åˆå§‹åŒ–æ£€æµ‹å™¨</span>model <span class="token operator">=</span> init_detector<span class="token punctuation">(</span>config_file<span class="token punctuation">,</span> checkpoint_file<span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span><span class="token comment"># æ¨ç†æ¼”ç¤ºå›¾åƒ</span>img <span class="token operator">=</span> <span class="token string">'demo/demo.jpg'</span>result <span class="token operator">=</span> inference_detector<span class="token punctuation">(</span>model<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token comment"># ç»˜åˆ¶ç»“æœå›¾</span>model<span class="token punctuation">.</span>show_result<span class="token punctuation">(</span>img<span class="token punctuation">,</span> result<span class="token punctuation">,</span> wait_time<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¡¥å……ï¼šPytorch-amp-CUDA"><a href="#è¡¥å……ï¼šPytorch-amp-CUDA" class="headerlink" title="è¡¥å……ï¼šPytorch &amp; CUDA"></a>è¡¥å……ï¼šPytorch &amp; CUDA</h2><h3 id="CUDA-amp-CUDA-toolkit-amp-pytorch-install-with-conda"><a href="#CUDA-amp-CUDA-toolkit-amp-pytorch-install-with-conda" class="headerlink" title="CUDA &amp; CUDA toolkit &amp; pytorch install with conda"></a>CUDA &amp; CUDA toolkit &amp; pytorch install with conda</h3><p>conda åœ¨å®‰è£… Pytorch ç­‰ä¼šä½¿ç”¨åˆ° CUDA çš„æ¡†æ¶æ—¶ï¼Œä¼šè‡ªåŠ¨ä¸ºç”¨æˆ·å®‰è£… cudatoolkitï¼Œå…¶ä¸»è¦åŒ…å«åº”ç”¨ç¨‹åºåœ¨ä½¿ç”¨ CUDA ç›¸å…³çš„åŠŸèƒ½æ—¶æ‰€ä¾èµ–çš„åŠ¨æ€é“¾æ¥åº“ã€‚åœ¨å®‰è£…äº† cudatoolkit åï¼Œåªè¦ç³»ç»Ÿä¸Šå­˜åœ¨ä¸å½“å‰çš„ cudatoolkit æ‰€å…¼å®¹çš„ Nvidia é©±åŠ¨ï¼Œåˆ™å·²ç»ç¼–è¯‘å¥½çš„ CUDA ç›¸å…³çš„ç¨‹åºå°±å¯ä»¥ç›´æ¥è¿è¡Œï¼Œè€Œä¸éœ€è¦å®‰è£…å®Œæ•´çš„ Nvidia å®˜æ–¹æä¾›çš„ CUDA Toolkit </p><p>ç»è¿‡è‡ªå·±çš„å®éªŒï¼Œç¯å¢ƒä¸­çš„ CUDA_HOME å˜é‡æ˜¯æ¸…ç©ºçš„ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰è®¾ç½® /usr/local/cuda è½¯é“¾æ¥ï¼Œä½†æ˜¯ pytorch ä¾ç„¶èƒ½å¤Ÿè°ƒç”¨ GPUï¼Œè¯´æ˜åªéœ€è¦ä½ çš„ Nvidia Driver å’Œ conda install cudatoolkit å…¼å®¹ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä» Nvidia å®˜ç½‘ä¸­ä¸‹è½½å®Œæ•´çš„ CUDA Toolkit</p><p>ç»¼ä¸Š Pytorch æŸ¥æ‰¾ cuda è·¯å¾„é¡ºåºä¸ºï¼š</p><ol><li><p>å…ˆæŸ¥æ‰¾ç¯å¢ƒå˜é‡ä¸­æ˜¯å¦å­˜åœ¨ CUDA_PATH / CUDA_HOME å¦‚æœ‰åˆ™ä½¿ç”¨è¯¥è·¯å¾„æŒ‡å‘çš„ CUDA ç‰ˆæœ¬ã€‚å…¶ä¸­ CUDA_PATH ä¸º windows ç¯å¢ƒå˜é‡ï¼ŒCUDA_HOME ä¸º Linux ç¯å¢ƒå˜é‡</p></li><li><p>è‹¥æ‰¾ä¸åˆ° CUDA_HOMEï¼Œåˆ™æŸ¥çœ‹ usr/local/cuda æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™ä½¿ç”¨è¯¥è·¯å¾„æŒ‡å‘çš„ CUDA ç‰ˆæœ¬</p></li><li><p>è‹¥ä¸¤ä¸ªè·¯å¾„éƒ½ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ conda ä¸‹è½½çš„ cudatoolkitï¼Œä¹Ÿå³ä¸‹è½½ pytorch æ—¶è‡ªåŠ¨ä¸‹è½½çš„ cudatoolkit</p></li></ol><p>æ¨è <a href="https://www.cnblogs.com/yhjoker/p/10972795.html">å‚è€ƒé“¾æ¥</a> è¿›è¡Œæ·±å…¥äº†è§£</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> OpenMMLab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MMDetection </tag>
            
            <tag> å®‰è£…æ•™ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çŒ«å¤´é¹°å…ˆç”Ÿå‚¬çœ å½•éŸ³æ–‡æœ¬</title>
      <link href="/archives/11812369.html"/>
      <url>/archives/11812369.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.bilibili.com/video/BV16f4y1S72h">bilibili link</a></p><p>my name is Mr. Owl</p><p>I will shortly lead you through a guided hypnosis</p><p>please donâ€™t listen to this while driving or operating machinery</p><p>you may also want to have a glass of water nearby</p><p>it can help ground you after a recession</p><p>I would like you to start by simply lying down in a comfortable position </p><p>perhaps on some cushions</p><p>or on a couch</p><p>and just take a few moments to relax your mind</p><p>(a moment â€¦)</p><p>in a moment</p><p>Iâ€™m going to ask you to imagine a place</p><p>a special place</p><p>you may see it</p><p>feel it</p><p>imagine it or experience it</p><p>in any way you want</p><p>and you might find your mind wondering quite a bit</p><p>but that doesnâ€™t matter to you</p><p>the sound of my voice will continue to relax you</p><p>and it doesnâ€™t matter if you donâ€™t hear a word I say</p><p>because very soon now</p><p>you are going to be relaxed</p><p>more than you have ever known</p><p>imagine now that you are in that place</p><p>that place you know well</p><p>a hotel by a lake</p><p>and you are here </p><p>at the top of a gorgeous staircase</p><p>in a large open hallway</p><p>a really beautiful old hotel</p><p>itâ€™s such a comfortable temperature here</p><p>daylight streams in through the window</p><p>slightly warm</p><p>such a peaceful place to be</p><p>and at the bottom of those stairs</p><p>an open doorway</p><p>leading to a garden</p><p>in a few moments</p><p>I will count</p><p>from 1 to 10</p><p>and count you down each step</p><p>let each number</p><p>represent a step</p><p>and each step takes you deeper and deeper</p><p>into relaxation</p><p>so that by the time I get to ten</p><p>you can allow yourself</p><p>to be as deeply relaxed</p><p>as you ever can be</p><p>and youâ€™ll still hear</p><p>the sound of my voice</p><p>and as you look down</p><p>you can glimpse</p><p>through the open door</p><p>that intriguing garden</p><p>itâ€™s so interesting to you</p><p>to explore and discover</p><p>this special place</p><p>the sunlight to the windows on your skin</p><p>thereâ€™s no one around</p><p>that needs anything from you</p><p>no one around</p><p>to bother you</p><p>1</p><p>when you are ready</p><p>take your first step now</p><p>relaxing letting go</p><p>2</p><p>take another step</p><p>feeling more at ease</p><p>and at peace with yourself</p><p>3</p><p>perhaps noticing</p><p>heavy</p><p>restful feeling</p><p>spreading down your legs</p><p>with every step</p><p>4</p><p>just drifting deeper</p><p>and deeper down</p><p>5</p><p>another step</p><p>becoming calmer</p><p>and even calmer still</p><p>continuing to relax</p><p>continuing to let go</p><p>and feeling so good</p><p>6</p><p>perhaps beginning to notice</p><p>any sounds becoming part of your experience of comfort</p><p>relaxation</p><p>and anything you notice</p><p>becoming part of your experience</p><p>7</p><p>sinking deeper and deeper</p><p>drifting</p><p>further</p><p>into this welcoming</p><p>relaxed state</p><p>8</p><p>enjoying those feelings</p><p>half awake</p><p>half asleep</p><p>9</p><p>noticing way of growing relaxation</p><p>and spreading comfort</p><p>10</p><p>an now</p><p>at the bottom of the stairs</p><p>and wandering through that open door</p><p>how into the gardon beyond</p><p>soak up those feelings of</p><p>tranquility</p><p>see</p><p>hear</p><p>feel sense or imagine this</p><p>beautiful garden</p><p>the greens</p><p>the flowers</p><p>the trees</p><p>the brown</p><p>the clear blue sky</p><p>feel the warmth of the sun</p><p>on your head and shoulders</p><p>enjoy a moment here</p><p>and peace</p><p>inhale the sense of the garden</p><p>there is no one around</p><p>wanting anything from you</p><p>needing anything from you</p><p>no one expecting anything</p><p>so enjoy this</p><p>peace</p><p>and quiet</p><p>for a few moments more</p><p>notice now</p><p>at the end of this garden</p><p>a set of steps</p><p>leading down to a sturdy pier</p><p>at the edge of lake</p><p>so now</p><p>take the steps now</p><p>sinking further and further into relaxation</p><p>as you do</p><p>more and more relaxed with each step</p><p>until you step onto the wooden pier</p><p>then stepping forward</p><p>towards that beautiful crystal blue water</p><p>the sun on your skin</p><p>and gentle breeze</p><p>and here</p><p>at the end of the pier</p><p>a fishing rod</p><p>You take it in your hand</p><p>feel a comforting weight of it</p><p>not too heavy to hold</p><p>but you know that itâ€™s strong and sturdy</p><p>it will not struggle with the weight of todayâ€™s catch</p><p>slowly and deliberately</p><p>you unravel some of the line</p><p>you pull back the rod</p><p>and cast that line into that crystal</p><p>clear</p><p>blue water</p><p>it sits in that water for a moment</p><p>and soon you feel a gentle pull on the fishing rod</p><p>youâ€™ve caught something</p><p>you gently crank back the handle</p><p>pulling your catch out of the water</p><p>what have you caught</p><p>itâ€™s a white cube</p><p>so square and perfect on every side</p><p>a little water drips from it</p><p>as you gently swing it back onto the pier beside you</p><p>you lower the fishing rod to your side</p><p>and you take</p><p>the white cube from the line</p><p>whatâ€™s inside this cube</p><p>itâ€™s a memory</p><p>a good memory</p><p>a memory from your life</p><p>a memory of a time when you were happy</p><p>and strong</p><p>and confident</p><p>you pick up the cube</p><p>you hold it close to your face</p><p>and now you can see this memory</p><p>you see it in a vivid wide screen</p><p>The colors are rich</p><p>the image is bright</p><p>the sound is clear and strong and vibrant</p><p>so strong and vibrant that you step into this memory</p><p>you are inside</p><p>let those feelings grow inside you</p><p>feeling happy and strong and confident and bright</p><p>take a moment to enjoy this</p><p>to live in it</p><p>to breathe</p><p>this beautiful positive memory from the white cube</p><p>feeling strong and confident</p><p>and bright and happy</p><p>now</p><p>slowly</p><p>and with care</p><p>you move out of the memory</p><p>and you lower the cube</p><p>from in front of your face</p><p>and se t it down gently on the pier beside you</p><p>take a moment now</p><p>look out</p><p>onto the lake</p><p>at the cool blue water</p><p>the peace</p><p>tranquility of it</p><p>you kneel down and lower the white cube</p><p>into the peaceful water</p><p>and as the ripples slow and stop</p><p>you catch sight of your own reflection</p><p>and you see how beautiful you are</p><p>how strong you are</p><p>you can see positivity in your eye</p><p>like jewels</p><p>you stand and look out at that lake</p><p>calm serene and full of power</p><p>breathe it in gently</p><p>and then breathe it out gently</p><p>all that power thatâ€™s within you</p><p>I let you enjoy those feelings for a few moments more</p><p>allow you time to bask in that life</p><p>but soon</p><p>soon Iâ€™ll start count from one up to five</p><p>when I reach five</p><p>you will be back in the room</p><p>1</p><p>starting to come back</p><p>become aware of your breathing</p><p>your body and the space around you</p><p>2</p><p>moving your legs start to wiggle your toes and feet</p><p>a lovely grounding energy, traveling up your legs</p><p>3</p><p>moving your arms starting to stretch, feel the energy moving through your body again</p><p>4 </p><p>your eyes starting to open</p><p>And on the next count your eyes fully open </p><p>5</p><p>eyes fully open, feeling refreshed and recharged and being fully aware of being in the space</p><p>welcome back</p>]]></content>
      
      
      <categories>
          
          <category> ç”Ÿæ´» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¡çœ  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ¡å‹è®¿è°ˆ(çºªå½•ç‰‡)åŸ¹è®­</title>
      <link href="/archives/c8ed5799.html"/>
      <url>/archives/c8ed5799.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ ¡å‹è®¿è°ˆ-çºªå½•ç‰‡-åŸ¹è®­"><a href="#æ ¡å‹è®¿è°ˆ-çºªå½•ç‰‡-åŸ¹è®­" class="headerlink" title="æ ¡å‹è®¿è°ˆ(çºªå½•ç‰‡)åŸ¹è®­"></a>æ ¡å‹è®¿è°ˆ(çºªå½•ç‰‡)åŸ¹è®­</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ol><li><p>è®¤è¯†çºªå½•ç‰‡å’Œå£è¿°å²</p><p>ä»€ä¹ˆæ˜¯çœŸå®ï¼Œä»€ä¹ˆæ˜¯å¥½çš„çºªå½•ç‰‡</p></li><li><p>æ²¡æœ‰ç»å¯¹çš„çœŸå®ï¼Œè®©æ•…äº‹æœ‰é€»è¾‘ï¼Œäººç‰©æœ‰å‘å±•ï¼Œè®©è§‚ä¼—æ„Ÿåˆ°çœŸå®ï¼Œæ˜¯ä¸€ä¸ªå¥½çš„çºªå½•ç‰‡çš„æ¡ä»¶</p></li></ol><h2 id="å‰æœŸè°ƒç ”"><a href="#å‰æœŸè°ƒç ”" class="headerlink" title="å‰æœŸè°ƒç ”"></a>å‰æœŸè°ƒç ”</h2><ol><li>ä¸ªäººç»´åº¦ï¼šç”Ÿå¹³ï¼Œè¡Œä¸šä¿¡æ¯ï¼Œçªå‡ºæˆå°±ï¼Œå®¶åº­æƒ…å†µ</li><li>å†å²ç»´åº¦ï¼šç»å†è¿‡å“ªäº›é‡å¤§çš„å†å²äº‹ä»¶ï¼Œä¸å…¶ä»–äººç‰©åœ¨å†å²ä¸Šçš„äº¤é›†</li><li>äº‹ä»¶å™è¿°ï¼šèµ·å› ï¼Œè¿‡ç¨‹ï¼Œç»“æœï¼Œå†å²æ„ä¹‰</li><li>æœ€ç»ˆå½¢æˆä¸€ä¸ªäººç‰©å°ä¼ </li></ol><h3 id="æ¡ˆä¾‹åˆ†äº«ã€Šå—å¤§åˆ›ä¸šè€…çš„æ—¶ä»£è„‰æã€‹"><a href="#æ¡ˆä¾‹åˆ†äº«ã€Šå—å¤§åˆ›ä¸šè€…çš„æ—¶ä»£è„‰æã€‹" class="headerlink" title="æ¡ˆä¾‹åˆ†äº«ã€Šå—å¤§åˆ›ä¸šè€…çš„æ—¶ä»£è„‰æã€‹"></a>æ¡ˆä¾‹åˆ†äº«ã€Šå—å¤§åˆ›ä¸šè€…çš„æ—¶ä»£è„‰æã€‹</h3><h2 id="æ•…äº‹æ’°å†™"><a href="#æ•…äº‹æ’°å†™" class="headerlink" title="æ•…äº‹æ’°å†™"></a>æ•…äº‹æ’°å†™</h2><ol><li>ä¸€å¥è¯æ¦‚æ‹¬ä½ çš„æ•…äº‹ logline</li><li>æ•…äº‹çš„ä»‹ç»ä¸ç»“æ„ï¼Œå…³äºå½±ç‰‡çš„æ•…äº‹ç»“æ„ï¼Œå¼€å¤´ã€è¿‡ç¨‹ã€ç»“å°¾ã€é‡è¦èŠ‚ç‚¹</li><li>äººç‰©çš„å¡‘é€ éœ€è¦æœ‰æˆé•¿ï¼Œæœ‰å¥—è·¯ï¼Œä»å¹³å‡¡åˆ°ä¸å¹³å‡¡çš„å¾ªç¯è¿‡ç¨‹</li></ol><h2 id="æ’°å†™é‡‡è®¿é—®é¢˜"><a href="#æ’°å†™é‡‡è®¿é—®é¢˜" class="headerlink" title="æ’°å†™é‡‡è®¿é—®é¢˜"></a>æ’°å†™é‡‡è®¿é—®é¢˜</h2><ol><li>æ’°å†™é—®é¢˜æŒ‰ç…§æ—¶é—´çº¿çš„é¡ºåºï¼Œå¸®åŠ©è¢«é‡‡è®¿äººå›å¿†</li><li>æœ‰å¿…é¡»å®Œæˆçš„å›ºå®šåŠ¨ä½œï¼šé‡è¦å†ç¨‹çš„å›é¡¾ï¼Œé‡è¦æ—¶é—´ç‚¹çš„è®²è¿°ï¼Œå…³äºä¸»é¢˜çš„å¿…ç„¶è”ç³»ï¼Œæ‰€æœ‰äººéƒ½å¸Œæœ›è¢«ç†è§£ã€è¢«å°Šé‡</li><li><p>å›ºå®šåŠ¨ä½œä¹‹å¤–çš„æƒŠå–œé—®é¢˜ï¼šæœ‰ä¸€äº›å°–é”æ·±åˆ»çš„è¯é¢˜ï¼Œåœ¨å¿ƒé‡Œæ‹Ÿå®šå¥½ï¼Œåœ¨ç°åœºæ‰¾ç‚¹åˆ‡å…¥</p></li><li><p>å¤šäººç‰©é‡‡è®¿æ—¶çš„é—®é¢˜æ€è·¯ï¼šé‡‡è®¿è€…ä¹‹é—´çš„å…±æ€§ã€ç‰¹æ€§é—®é¢˜ï¼Œä»¥åŠç›¸åº”çš„æƒŠå–œé—®é¢˜</p></li></ol><h2 id="ç¡®å®šè§†è§‰ä¸æ–‡å­—å±•ç°å½¢å¼"><a href="#ç¡®å®šè§†è§‰ä¸æ–‡å­—å±•ç°å½¢å¼" class="headerlink" title="ç¡®å®šè§†è§‰ä¸æ–‡å­—å±•ç°å½¢å¼"></a>ç¡®å®šè§†è§‰ä¸æ–‡å­—å±•ç°å½¢å¼</h2><ol><li>é˜è¿°å¼ï¼šæœ‰æ—ç™½ã€æœ‰é‡‡è®¿</li><li>è§‚å¯Ÿå¼ï¼šè§‚å¯Ÿäººç‰©</li><li>å‚ä¸å¼ï¼šç±»ä¼¼äº äº’åŠ¨vlog</li><li>æ‰®æ¼”å¼ï¼šæ‰¾æ¼”å‘˜æ‰®æ¼”</li><li>èµ„æ–™å¼ï¼šç”¨èµ„æ–™å’Œäººç‰©è¿˜åŸ</li><li>åŠ¨ç”»çºªå½•ç‰‡</li></ol><p>é˜è¿° + èµ„æ–™ä¸ºå¸¸è§ç»„åˆ</p><h2 id="ç°åœºæ‹æ‘„"><a href="#ç°åœºæ‹æ‘„" class="headerlink" title="ç°åœºæ‹æ‘„"></a>ç°åœºæ‹æ‘„</h2><p>æ‘„åƒæœºã€ä¸‰è„šæ¶ã€è¯ç­’ã€ç¯</p><p>æ³¨æ„äº‹é¡¹ï¼š</p><ol><li>å—è®¿è€…çŸ¥æ™“æ‹æ‘„å†…å®¹ã€ç”¨é€”ã€ç­¾æ–‡ä»¶</li><li>è°ƒæ•´ç¯å¢ƒï¼Œè®©å—è®¿è€…æ„Ÿåˆ°èˆ’é€‚ï¼Œä½†åŒæ—¶å¯èƒ½éœ€è¦ç‰ºç‰²ç”»è´¨</li><li>å¼€å§‹å‰å…ˆèŠèŠå®¶å¸¸ï¼ŒåŒæ—¶è°ƒæ•´å£°éŸ³å’Œæ„å›¾ï¼Œè°ƒæ•´ç”»é¢æ°´å¹³</li><li>é‡‡è®¿æ—¶ï¼Œä¸€å®šä¸è¦æ‰“æ–­å—è®¿è€…ï¼Œå§‹ç»ˆä¿æŒçœ¼ç¥äº¤æµï¼Œä¸è¦ä½¿ç”¨è¯­æ°”è¯â€œå—¯ï¼Œå•Šâ€ä¹‹ç±»çš„</li><li>éšå³è°ƒæ•´é‡‡è®¿çš„é¡ºåº</li></ol><h2 id="è·Ÿæ‹"><a href="#è·Ÿæ‹" class="headerlink" title="è·Ÿæ‹"></a>è·Ÿæ‹</h2><ol><li>é•œå¤´ç¨³å®š</li><li>é•œå¤´è¡¨ç°</li><li>ç´ æä¿ç®¡ï¼Œä¸€å®šè¦åŒå¤‡ä»½ï¼Œç”šè‡³ä¸‰å¤‡ä»½ï¼å› ä¸ºç´ ææ˜¯å¾ˆâ€œè´µâ€çš„ï¼Œä¸è¦ç”¨å‰ªåˆ‡ï¼</li><li>ä¿æŒâ€œè®°å½•æ„Ÿâ€ï¼Œè®©é•œå¤´æŒç»­å¼€æœºï¼Œæœ‰æ¯”æ²¡æœ‰å¼º</li></ol><h2 id="Transcription-amp-paper-cut"><a href="#Transcription-amp-paper-cut" class="headerlink" title="Transcription &amp; paper cut"></a>Transcription &amp; paper cut</h2><ol><li>å°†è§†é¢‘ä¸­çš„æ–‡å­—å¯¹è¯å¯¼å‡º</li><li>å®Œæˆå½±ç‰‡è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬æ˜¯å‰ªè¾‘çš„æ ¹æ®ä¸é€»è¾‘</li></ol><h2 id="å‰ªè¾‘ä¸åæœŸ"><a href="#å‰ªè¾‘ä¸åæœŸ" class="headerlink" title="å‰ªè¾‘ä¸åæœŸ"></a>å‰ªè¾‘ä¸åæœŸ</h2><ol><li>å‰ªè¾‘ä¸»è¦æ•…äº‹çº¿</li><li>å¢åŠ èµ„æ–™ã€ç´ æã€ç‰¹æ•ˆåŒ…è£…</li><li>å£°éŸ³åˆ¶ä½œã€è°ƒè‰²</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç”Ÿæ´» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çºªå½•ç‰‡ </tag>
            
            <tag> åŸ¹è®­ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Conda ç¬”è®°</title>
      <link href="/archives/c8895fc.html"/>
      <url>/archives/c8895fc.html</url>
      
        <content type="html"><![CDATA[<h1 id="Conda-Cheat-Sheet"><a href="#Conda-Cheat-Sheet" class="headerlink" title="Conda Cheat Sheet"></a>Conda Cheat Sheet</h1><p>è®°å½•ä¸€äº›å¸¸ç”¨çš„ conda å‘½ä»¤å¸®åŠ©å¿«é€Ÿç®¡ç†ç¯å¢ƒï¼Œæ•´ç†è‡ªå®˜æ–¹ <a href="https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-cheatsheet.pdf">CONDA CHEAT SHEET</a></p><h2 id="Install-in-Linux"><a href="#Install-in-Linux" class="headerlink" title="Install in Linux"></a>Install in Linux</h2><p>å®‰è£… <a href="https://conda.io/projects/conda/en/latest/user-guide/install/linux.html">miniconda</a>ï¼Œå¯ä»¥ä¸ care ç¬¬äºŒæ­¥ Verifyï¼Œä¸‹è½½å¥½ .sh æ–‡ä»¶åç›´æ¥è¿è¡Œï¼Œç„¶åè¿˜è¦å°†å…¶åŠ å…¥ PATH ä¸­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">export PATH<span class="token operator">=</span>$PATH<span class="token punctuation">:</span><span class="token operator">/</span>home<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>miniconda3<span class="token operator">/</span><span class="token builtin">bin</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><h3 id="conda-info"><a href="#conda-info" class="headerlink" title="conda info"></a>conda info</h3><p>è¿™ä¸ªå‘½ä»¤éå¸¸ç®¡ç”¨ï¼ŒåŸºæœ¬ä¸Šèƒ½å¤Ÿçœ‹åˆ°æ‰€æœ‰çš„ conda é…ç½®ä¿¡æ¯</p><h3 id="conda-install"><a href="#conda-install" class="headerlink" title="conda install"></a>conda install</h3><p><code>conda install PACKAGENAME</code> ä¸‹è½½æŒ‡å®šåŒ…</p><h3 id="conda-update"><a href="#conda-update" class="headerlink" title="conda update"></a>conda update</h3><p><code>conda update PACKAGENAME</code> æ›´æ–°æŒ‡å®šåŒ… </p><h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><h3 id="conda-create-n"><a href="#conda-create-n" class="headerlink" title="conda create -n"></a>conda create -n</h3><p><code>conda create -n py36 python=3.6</code> åˆ›é€ ä¸€ä¸ª python 3.6 çš„ç¯å¢ƒ py36</p><p>æ³¨æ„ï¼šä¸€èˆ¬éƒ½è¦åŠ ä¸Š <code>python=x.x</code> å¦åˆ™ä½¿ç”¨çš„æ˜¯ base ç¯å¢ƒçš„ python è§£é‡Šå™¨</p><h3 id="conda-env-list"><a href="#conda-env-list" class="headerlink" title="conda env list"></a>conda env list</h3><p>åˆ—å‡ºç›®å‰æœ‰çš„ç¯å¢ƒ</p><h3 id="conda-env-remove"><a href="#conda-env-remove" class="headerlink" title="conda env remove"></a>conda env remove</h3><p><code>conda env remove -n env_name</code> ç§»é™¤ç¯å¢ƒ</p><h3 id="conda-activate-deactivate"><a href="#conda-activate-deactivate" class="headerlink" title="conda activate/deactivate"></a>conda activate/deactivate</h3><p><code>conda activate/deactivate env_name</code> æ¿€æ´»/é€€å‡ºç¯å¢ƒ</p><h2 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h2><h3 id="conda-install-1"><a href="#conda-install-1" class="headerlink" title="conda install"></a>conda install</h3><p><code>conda install PACKAGENAME</code> ä¸‹è½½åŒ…</p><p><code>conda install --file requirements.txt</code> é€šè¿‡ requirements æ–‡ä»¶ä¸‹è½½åŒ…</p><h3 id="conda-remove"><a href="#conda-remove" class="headerlink" title="conda remove"></a>conda remove</h3><p><code>conda remove PACKAGENAME</code> ç§»é™¤åŒ…</p><h3 id="conda-list"><a href="#conda-list" class="headerlink" title="conda list"></a>conda list</h3><p><code>conda list PACKAGENAME</code> æŸ¥çœ‹ç¯å¢ƒçš„æŸä¸ªåŒ…ï¼Œå¦‚æœä¸åŠ  PACKAGENAME åˆ™åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒ</p><h3 id="conda-clean"><a href="#conda-clean" class="headerlink" title="conda clean"></a>conda clean</h3><p>å¦‚æœä¸æ¸…ç†çš„è¯ï¼Œanaconda è¿˜æ˜¯å¾ˆåƒå­˜å‚¨çš„ï¼Œä¼šé€æ¸ç§¯ç´¯å¾ˆå¤šä¸‹è½½åŒ…</p><p><code>conda clean --all</code>  Remove index cache, lock files, unused cache packages, and tarballs.</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="ç¦ç”¨è‡ªåŠ¨å¯åŠ¨-base-ç¯å¢ƒ"><a href="#ç¦ç”¨è‡ªåŠ¨å¯åŠ¨-base-ç¯å¢ƒ" class="headerlink" title="ç¦ç”¨è‡ªåŠ¨å¯åŠ¨ base ç¯å¢ƒ"></a>ç¦ç”¨è‡ªåŠ¨å¯åŠ¨ base ç¯å¢ƒ</h3><p>æ¯æ¬¡æ‰“å¼€æ–°çš„ shell éƒ½ä¼šè‡ªåŠ¨è¿›å…¥ base ç¯å¢ƒï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤è¡Œç¦ç”¨</p><p><code>conda config --set auto_activate_base false</code></p><h3 id="é•œåƒæºè®¾ç½®"><a href="#é•œåƒæºè®¾ç½®" class="headerlink" title="é•œåƒæºè®¾ç½®"></a>é•œåƒæºè®¾ç½®</h3><p>ç¼–è¾‘ <code>~/.condarc</code> æ–‡ä»¶ï¼Œè®¾ç½®é•œåƒæºï¼Œå¦‚æ²¡æœ‰è¯¥æ–‡ä»¶å¯ä½¿ç”¨ <code>conda config</code> åˆ›å»º</p><p><a href="https://mirror.nju.edu.cn/help/anaconda">å—äº¬å¤§å­¦é•œåƒæºå®˜æ–¹å¸®åŠ©æ–‡æ¡£</a></p><pre class="line-numbers language-.condarc" data-language=".condarc"><code class="language-.condarc">channels:  - defaultsshow_channel_urls: truedefault_channels:  - https://mirror.nju.edu.cn/anaconda/pkgs/main  - https://mirror.nju.edu.cn/anaconda/pkgs/r  - https://mirror.nju.edu.cn/anaconda/pkgs/msys2custom_channels:  conda-forge: https://mirror.nju.edu.cn/anaconda/cloud  msys2: https://mirror.nju.edu.cn/anaconda/cloud  bioconda: https://mirror.nju.edu.cn/anaconda/cloud  menpo: https://mirror.nju.edu.cn/anaconda/cloud  pytorch: https://mirror.nju.edu.cn/anaconda/cloud  simpleitk: https://mirror.nju.edu.cn/anaconda/cloud<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ <code>conda config --show</code> è¿›è¡ŒæŸ¥çœ‹å½“å‰é…ç½®ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–é•œåƒæºï¼Œä¾‹å¦‚ï¼š<a href="https://mirrors.bfsu.edu.cn/help/anaconda/">åŒ—äº¬å¤–å›½è¯­å¤§å­¦é•œåƒæº</a> é€Ÿåº¦ä¹Ÿå¾ˆå¿«</p><p>åŒæ—¶ä¹Ÿæ›´æ–°ä¸€ä¸‹ pypi æº</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># å¯èƒ½éœ€è¦å…ˆæ›´æ–° pipï¼Œä¸€èˆ¬ä¸ç”¨</span>pip <span class="token function">install</span> pip -U<span class="token comment"># Linux</span>pip <span class="token function">install</span> pip -U --user<span class="token comment"># Windows</span><span class="token comment"># è®¾ç½®é•œåƒ</span>pip config <span class="token builtin class-name">set</span> global.index-url https://mirrors.bfsu.edu.cn/pypi/web/simple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Conda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Manim æ•™ç¨‹</title>
      <link href="/archives/5654e2fe.html"/>
      <url>/archives/5654e2fe.html</url>
      
        <content type="html"><![CDATA[<h1 id="Manim-note"><a href="#Manim-note" class="headerlink" title="Manim note"></a>Manim note</h1><p>å®˜æ–¹ <a href="https://github.com/3b1b/manim">github é¡¹ç›®</a></p><blockquote><p>Note, there are two versions of manim. This repository began as a personal project by the author of <a href="https://www.3blue1brown.com/">3Blue1Brown</a> for the purpose of animating those videos, with video-specific code available <a href="https://github.com/3b1b/videos">here</a>. In 2020 a group of developers forked it into what is now the <a href="https://github.com/ManimCommunity/manim/">community edition</a>, with a goal of being more stable, better tested, quicker to respond to community contributions, and all around friendlier to get started with. See <a href="https://docs.manim.community/en/stable/installation/versions.html?highlight=OpenGL#which-version-to-use">this page</a> for more details.</p></blockquote><p>è¿™é‡Œæåˆ°æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„ manimï¼Œæ¨èä½¿ç”¨ community editionï¼Œè¿™ä¸ªç‰ˆæœ¬æ›´ç¨³å®šï¼Œæ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œä¸‹é¢æ˜¯ä¸¤ä¸ªå‚è€ƒé“¾æ¥</p><ol><li><p><a href="https://github.com/ManimCommunity/manim/">ManimCE github</a></p></li><li><p><a href="https://www.manim.community/">ManimCE documentation</a></p></li></ol><p>å¼ºçƒˆæ¨èæ ¹æ®å®˜æ–¹æ–‡æ¡£è¿›è¡Œå­¦ä¹ ï¼Œå› ä¸ºç½‘ä¸Šçš„å¾ˆå¤šèµ„æºéƒ½æ˜¯è¿‡æ—¶çš„ï¼ŒåŒ…æ‹¬æˆ‘è¿™ç¯‡ç¬”è®°ä¹Ÿä¼šå¯èƒ½ä¼šå¾ˆå¿«è¿‡æ—¶ã€‚è¿™ç¯‡ç¬”è®°ä¸»è¦è®°å½•å¦‚ä½•å®‰è£… ManimCEï¼Œä»¥åŠå…¶ä»£ç é€»è¾‘ï¼Œæ›´å¤šå®ç”¨çš„åŠ¨ç”»æ–¹æ³•å¦å¤–å†åšæ•´ç†</p><h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><h3 id="Install-dependencies"><a href="#Install-dependencies" class="headerlink" title="Install dependencies"></a>Install dependencies</h3><p>å®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ª<a href="https://hub.gke2.mybinder.org/user/behackl-725d956-b7bf9b4aef40b78-cns6ckcq/notebooks/basic%20example%20scenes.ipynb"> jupyter notebook</a> é¢„å…ˆè£…è½½å¥½äº† manim ç¯å¢ƒï¼Œå¦‚æœä½ ç°åœ¨ä¸æƒ³å®‰è£…çš„è¯ï¼Œå¯ä»¥åœ¨è¿™ä¸ª notebook é‡Œé¢è¿›è¡Œå°å®éªŒ</p><p>ManimCE éœ€è¦é¢„å…ˆä¸‹è½½ä¸¤ä¸ªè½¯ä»¶ ffmpeg å’Œ LaTexã€‚æ–‡æ¡£ä¸­å»ºè®®ä½¿ç”¨ Scoop, Chocolatey ç­‰åŒ…ç®¡ç†è½¯ä»¶æ¥ä¸‹è½½ dependenciesï¼Œä½†æˆ‘å¤ªæ‡’äº†ï¼Œä¸æƒ³å†ä¸‹ä¸€ä¸ªåŒ…ç®¡ç†è½¯ä»¶ï¼Œè€Œä¸”æˆ‘è‡ªå·±çš„ç”µè„‘ä¸Šæœ¬æ¥å°±å®‰è£…äº† LaTex å’Œ ffmpeg æ‰€ä»¥åªè¦ç¡®ä¿ ManimCE  èƒ½å¤Ÿè°ƒç”¨è¿™äº› dependencies å³å¯ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯è®© ffmpeg å’Œ LaTex å‘½ä»¤åŠ å…¥ç¯å¢ƒå˜é‡</p><p>ç»™ä¸¤ä¸ªå‚è€ƒé“¾æ¥ï¼š<a href="https://zhuanlan.zhihu.com/p/118362010">ffmpeg çŸ¥ä¹æ•™ç¨‹</a>  <a href="https://www.bilibili.com/video/BV11h41127FD?from=search&amp;seid=5330798070960440671">LaTexç®€ä»‹ bilibili</a></p><p>æœ€ååœ¨å‘½ä»¤è¡Œçª—å£è¾“å…¥ <code>ffmpeg -version</code> å’Œ  <code>tex -version</code> æ£€æŸ¥çœ‹çœ‹èƒ½å¦æˆåŠŸè¿è¡Œ</p><h3 id="Install-ManimCE"><a href="#Install-ManimCE" class="headerlink" title="Install ManimCE"></a>Install ManimCE</h3><blockquote><p>Manim Community runs on Python 3.7+. If youâ€™d like to just use the library, you can install it from PyPI via pip:</p></blockquote><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pip <span class="token function">install</span> manim<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å› ä¸ºä¹ æƒ¯äº†ç”¨ condaï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©åœ¨ conda ä¸­åˆ›å»ºä¸€ä¸ª Manim ç¯å¢ƒï¼Œç„¶åå† pip install</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">conda create -n manim <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.8</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(ç„¶è€Œæœ€ç»ˆå´ç¨€é‡Œç³Šæ¶‚çš„å®‰è£…åœ¨äº† base ç¯å¢ƒ)</p><p>ä½¿ç”¨ <code>conda list manim</code> æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼Œé€šè¿‡ <a href="https://docs.manim.community/en/stable/tutorials/quickstart.html">Quickstart</a> ç®€å•è¿è¡Œä¸€ä¸ªç¨‹åºï¼Œæ£€æŸ¥æ•´ä¸ªæµç¨‹æ˜¯å¦èƒ½å¤Ÿè¿è¡Œ</p><h2 id="Tutorials"><a href="#Tutorials" class="headerlink" title="Tutorials"></a>Tutorials</h2><h3 id="Quickstart"><a href="#Quickstart" class="headerlink" title="Quickstart"></a>Quickstart</h3><p>ä¸‹é¢æ˜¯ä¸€æ®µç®€å•çš„ä»£ç ï¼Œèƒ½å¤Ÿå®ç°ä»çŸ©å½¢åˆ°åœ†å½¢çš„å˜æ¢</p><p><img src="/archives/5654e2fe/SquareToCircle_ManimCE_v0.8.0.gif" alt="SquareToCircle_ManimCE_v0.8.0" style="zoom: 25%;"></p><p>ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># scene.py</span><span class="token keyword">from</span> manim <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">class</span> <span class="token class-name">SquareToCircle</span><span class="token punctuation">(</span>Scene<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">construct</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        circle <span class="token operator">=</span> Circle<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># create a circle</span>        circle<span class="token punctuation">.</span>set_fill<span class="token punctuation">(</span>PINK<span class="token punctuation">,</span> opacity<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>  <span class="token comment"># set color and transparency</span>        square <span class="token operator">=</span> Square<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># create a square</span>        square<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>PI <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment"># rotate a certain amount</span>        self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>Create<span class="token punctuation">(</span>square<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># animate the creation of the square</span>        self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>Transform<span class="token punctuation">(</span>square<span class="token punctuation">,</span> circle<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># interpolate the square into the circle</span>        self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>FadeOut<span class="token punctuation">(</span>square<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># fade out animation</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ terminal ä¸­æ‰§è¡Œæ–‡ä»¶</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">manim -pql scene.py SquareToCircle<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»ä¸Šé¢çš„ä»£ç èƒ½å¤Ÿçœ‹å‡º Manim çš„ä¸€äº›åŸºæœ¬æ¡†æ¶ï¼Œé¦–å…ˆè¦æœ‰ class ç±»åˆ«ä½œä¸ºåœºæ™¯ Sceneï¼Œåœ¨è¿™ä¸ª class ä¸­å®šä¹‰ construct() å‡½æ•°æ¥å®ç°åŠ¨ç”»æ•ˆæœï¼Œç„¶åé€šè¿‡å‘½ä»¤è¡Œæ¸²æŸ“å‡ºåŠ¨ç”»ã€‚æ–‡æ¡£ä¸­æåˆ°çš„ Tip:</p><blockquote><p>Every animation must be contained within the <a href="https://docs.manim.community/en/stable/reference/manim.scene.scene.Scene.html#manim.scene.scene.Scene.construct"><code>construct()</code></a> method of a class that derives from <a href="https://docs.manim.community/en/stable/reference/manim.scene.scene.Scene.html#manim.scene.scene.Scene"><code>Scene</code></a>. Other code, for example auxiliary or mathematical functions, may reside outside the class.</p></blockquote><h3 id="A-deeper-look"><a href="#A-deeper-look" class="headerlink" title="A deeper look"></a>A deeper look</h3><p>ä¸»è¦æ¥åˆ†æä¸€ä¸‹ä¸Šé¢çš„å‘½ä»¤</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">manim -pql scene.py SquareToCircle<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–‡æ¡£ä¸­è§£é‡Š</p><blockquote><p>First, this command executes manim on the file <code>scene.py</code>, which contains our animation code. Further, this command tells manim exactly which <code>Scene</code> is to be rendered, in this case, it is <code>SquareToCircle</code>. This is necessary because a single scene file may contain more than one scene. Next, the flag -p tells manim to play the scene once itâ€™s rendered, and the -ql flag tells manim to render the scene in low quality.</p></blockquote><p>ä¸‹é¢æ˜¯å‡ ä¸ªå¸¸è§çš„å‚æ•°ï¼š</p><ol><li><code>-ql, -qm, -qh, -qk</code> åˆ†åˆ«ä»£è¡¨ä¸åŒåˆ†è¾¨ç‡ï¼Œä»ä½åˆ°é«˜ï¼Œå†åˆ°4k</li><li><code>-a</code> æ¸²æŸ“æ‰€æœ‰çš„ Scene</li><li><code>-i</code> è¾“å‡ºä¸º gif æ ¼å¼</li><li><code>-f</code> æ¸²æŸ“å®Œæˆåæ‰“å¼€æ‰€åœ¨æ–‡ä»¶å¤¹</li></ol><h3 id="Manimâ€™s-building-blocks"><a href="#Manimâ€™s-building-blocks" class="headerlink" title="Manimâ€™s building blocks"></a>Manimâ€™s building blocks</h3><p>Manim ä¸­æœ‰3ä¸ªé‡è¦æ¦‚å¿µ</p><ol><li><strong>mathematical object</strong> (or <strong>mobject</strong> for short)</li><li><strong>animation</strong></li><li><strong>scene</strong>.</li></ol><blockquote><p>As we will see in the following sections, each of these three concepts is implemented in manim as a separate class: the <a href="https://docs.manim.community/en/stable/reference/manim.mobject.mobject.Mobject.html#manim.mobject.mobject.Mobject"><code>Mobject</code></a>, <a href="https://docs.manim.community/en/stable/reference/manim.animation.animation.Animation.html#manim.animation.animation.Animation"><code>Animation</code></a>, and <a href="https://docs.manim.community/en/stable/reference/manim.scene.scene.Scene.html#manim.scene.scene.Scene"><code>Scene</code></a> classes.</p></blockquote><h4 id="Mobject"><a href="#Mobject" class="headerlink" title="Mobject"></a>Mobject</h4><blockquote><p>Any object that can be displayed on the screen is a <code>mobject</code>, even if it is not necessarily <em>mathematical</em> in nature.</p></blockquote><p>é€šè¿‡ scene ç±»ä¸­çš„æ–¹æ³• add(), remove() æ¥åœ¨åœºæ™¯ä¸­åŠ å…¥ mobject</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> manim <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">class</span> <span class="token class-name">CreatingMobjects</span><span class="token punctuation">(</span>Scene<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">construct</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        circle <span class="token operator">=</span> Circle<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>add<span class="token punctuation">(</span>circle<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>circle<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äº mobject å±æ€§çš„è°ƒæ•´ï¼Œæ˜¯é€šè¿‡è°ƒ mobject ç±»çš„æ–¹æ³•æ¥å®Œæˆ</p><ol><li><p>Placing mobject location. é€‰æ‹©åœ¨å“ªé‡ŒåŠ å…¥ç‰©ä½“</p><p>.shift()  .move_to()  .next_to()  .align_to()</p></li><li><p>Styling mobjects. å¯¹ç‰©ä½“è¿›è¡Œé£æ ¼æ¸²æŸ“</p><p>.set_stroke()  .set_fill()</p></li><li><p>Mobject on-screen order. æ·»åŠ å…¥åœºæ™¯çš„ mobject æ˜¯æœ‰é¡ºåºçš„ï¼Œåæ·»åŠ çš„ç‰©ä½“ä¼šè¦†ç›–åˆ°å›¾å±‚çš„ä¸Šæ–¹</p></li></ol><h4 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h4><blockquote><p>At the heart of manim is animation. Generally, you can add an animation to your scene by calling the <code>play()</code> method.</p></blockquote><p>ä¸€èˆ¬æ¥è®²é€šè¿‡ play() æ–¹æ³•æ¥åŠ å…¥åŠ¨ç”»</p><blockquote><p>Animations are procedures that interpolate between two mobjects.</p></blockquote><p>åŠ¨ç”»çš„åŸºæœ¬åŸç†å¯ä»¥ç†è§£ä¸ºï¼Œä½¿ç”¨ä¸åŒçš„å‡½æ•°åœ¨ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´è¿›è¡Œæ’å€¼ï¼Œç„¶åä½¿ç”¨ play() æ–¹æ³•è¿›è¡Œæ’­æ”¾ï¼Œæ¯”å¦‚åœ¨ Quickstart ä¸­çš„åŠ¨ç”»</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>Create<span class="token punctuation">(</span>square<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># animate the creation of the square</span>self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>Transform<span class="token punctuation">(</span>square<span class="token punctuation">,</span> circle<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># interpolate the square into the circle</span>self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>FadeOut<span class="token punctuation">(</span>square<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># fade out animation</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åªè¦å¯å˜çš„å±æ€§ï¼Œéƒ½å¯ä»¥ä½¿ç”¨åŠ¨ç”»ï¼Œé€šè¿‡ <code>Mobject.aminate</code> å®ç°</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> manim <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">class</span> <span class="token class-name">ApplyMethodExample</span><span class="token punctuation">(</span>Scene<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">construct</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        square <span class="token operator">=</span> Square<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_fill<span class="token punctuation">(</span>RED<span class="token punctuation">,</span> opacity<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>add<span class="token punctuation">(</span>square<span class="token punctuation">)</span>        <span class="token comment"># animate the change of color</span>        self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>square<span class="token punctuation">.</span>animate<span class="token punctuation">.</span>set_fill<span class="token punctuation">(</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># animate the change of position</span>        self<span class="token punctuation">.</span>play<span class="token punctuation">(</span>square<span class="token punctuation">.</span>animate<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>UP<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/5654e2fe/ApplyMethodExample_ManimCE_v0.8.0.gif" alt="ApplyMethodExample_ManimCE_v0.8.0" style="zoom: 25%;"></p><h4 id="Scene"><a href="#Scene" class="headerlink" title="Scene"></a>Scene</h4><blockquote><p>The <a href="https://docs.manim.community/en/stable/reference/manim.scene.scene.Scene.html#manim.scene.scene.Scene"><code>Scene</code></a> class is the connective tissue of manim. </p></blockquote><p>æ‰€æœ‰çš„ mobject å’Œ animation éƒ½å¿…é¡»åŠ å…¥åˆ° scene ä¸­æ‰èƒ½è¢«å±•ç°å‡ºæ¥ï¼Œå¹¶ä¸” scene ä¸­å¿…é¡»åŒ…å« construct() æ–¹æ³•</p><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><blockquote><p>Manim provides an extensive configuration system that allows it to adapt to many different use cases. There are many configuration options that can be configured at different times during the scene rendering process. </p></blockquote><p>åœ¨æ¸²æŸ“åŠ¨ç”»çš„è¿‡ç¨‹ä¸­è¿˜å¯ä»¥è®¾ç½®æ›´å¤šçš„å‚æ•°ï¼Œæ¯”å¦‚è§†é¢‘æ¸²æŸ“è´¨é‡çš„é«˜ä½ <code>-ql, -qh</code></p><p>èƒ½å¤Ÿè®¾ç½® Configuration çš„æ–¹æ³•æœ‰å‡ ç§</p><ol><li><p>The ManimConfig class</p><blockquote><p>The most direct way of configuring manim is via the global <code>config</code> object, which is an instance of <a href="https://docs.manim.community/en/stable/reference/manim._config.utils.ManimConfig.html#manim._config.utils.ManimConfig"><code>ManimConfig</code></a>.</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> manim <span class="token keyword">import</span> <span class="token operator">*</span>config<span class="token punctuation">.</span>background_color <span class="token operator">=</span> WHITEconfig<span class="token punctuation">[</span><span class="token string">"background_color"</span><span class="token punctuation">]</span> <span class="token operator">=</span> WHITE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>Command-line arguments</p><blockquote><p>The following example specifies the output file name (with the <code>-o</code> flag), renders only the first ten animations (<code>-n</code> flag) with a white background (<code>-c</code> flag), and saves the animation as a .gif instead of as a .mp4 file (<code>-i</code> flag). It uses the default quality and does not try to open the file after it is rendered.</p></blockquote><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">manim -o myscene -i -n <span class="token number">0,10</span> -c WHITE <span class="token operator">&lt;</span>file.py<span class="token operator">&gt;</span> SceneName<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>The config files</p><blockquote><p>Manim can also be configured using a configuration file. A configuration file is a file ending with the suffix <code>.cfg</code>. To use a configuration file when rendering your scene, you must create a file with name <code>manim.cfg</code> in the same directory as your scene code.</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span>CLI<span class="token punctuation">]</span><span class="token comment"># my config file</span>output_file <span class="token operator">=</span> myscenesave_as_gif <span class="token operator">=</span> <span class="token boolean">True</span>background_color <span class="token operator">=</span> WHITE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h4 id="A-list-of-all-config-options"><a href="#A-list-of-all-config-options" class="headerlink" title="A list of all config options"></a>A list of all config options</h4><pre class="line-numbers language-config" data-language="config"><code class="language-config">     aspect_ratio              assets_dir        background_color       background_opacity           bottom          custom_folders         disable_caching                 dry_run  ffmpeg_loglevel             flush_cache            frame_height              frame_rate       frame_size             frame_width          frame_x_radius          frame_y_radiusfrom_animation_number          fullscreen              images_dir              input_file        left_side                 log_dir             log_to_file        max_files_cached        media_dir             media_width       movie_file_extension    notify_outdated_version      output_file       partial_movie_dir            pixel_height             pixel_width          plugins                 preview            progress_bar                 quality       right_side             save_as_gif         save_last_frame               save_pngs      scene_names       show_in_file_browser                sound                 tex_dir     tex_template       tex_template_file                text_dir                     top      transparent       upto_animation_number   use_opengl_renderer     use_webgl_renderer        verbosity               video_dir       webgl_renderer_path       window_position   window_monitor             window_size               write_all          write_to_movie<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Using-Text"><a href="#Using-Text" class="headerlink" title="Using Text"></a>Using Text</h3><p>There are two different ways by which you can render <strong>Text</strong> in videos:</p><ol><li>Using Pango (<a href="https://docs.manim.community/en/stable/reference/manim.mobject.svg.text_mobject.html#module-manim.mobject.svg.text_mobject"><code>text_mobject</code></a>)</li><li>Using LaTeX (<a href="https://docs.manim.community/en/stable/reference/manim.mobject.svg.tex_mobject.html#module-manim.mobject.svg.tex_mobject"><code>tex_mobject</code></a>)</li></ol><p>ä¸€èˆ¬å¦‚æœä¸ç”¨å…¬å¼çš„è¯ï¼Œç›´æ¥ä½¿ç”¨ text_mobject å°±å¯ä»¥äº†</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> manim <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">class</span> <span class="token class-name">HelloWorld</span><span class="token punctuation">(</span>Scene<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">construct</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        text <span class="token operator">=</span> Text<span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scale<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>add<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/5654e2fe/image-20210729160507790.png" style="zoom:25%;"></p><p>ä½¿ç”¨ tex_mobject çš„è¯ï¼Œå¦‚ä¸‹</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> manim <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">class</span> <span class="token class-name">HelloLaTeX</span><span class="token punctuation">(</span>Scene<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">construct</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        tex <span class="token operator">=</span> Tex<span class="token punctuation">(</span><span class="token string">r"\LaTeX"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scale<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tex<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/archives/5654e2fe/image-20210729160532548.png" style="zoom: 33%;"></p><p>æ³¨æ„éœ€è¦ä½¿ç”¨ raw string <code>r('...')</code> å› ä¸º Latex ä¸­å¾ˆå¤šç‰¹æ®Šå­—ç¬¦éœ€è¦è¿›è¡Œè½¬ä¹‰</p><p>è¿˜æœ‰ä¸åŒçš„æ–¹æ³•éƒ½èƒ½è¿”å› text_mobject &amp; tex_mobjectï¼Œæ¯”å¦‚ MarkupText, MathTex </p><p>è¿™ç¯‡ç¬”è®°å°±åˆ°è¿™é‡Œäº†ï¼Œè¿˜æœ‰å¥½å¤šå¥½ç©çš„åŠŸèƒ½å°±è¯·è‡ªè¡Œæ¢ç´¢å§ ğŸ˜</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Python </category>
          
          <category> Package </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Manim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Faster RCNN</title>
      <link href="/archives/2ad8fafc.html"/>
      <url>/archives/2ad8fafc.html</url>
      
        <content type="html"><![CDATA[<h1 id="Faster-RCNN-note"><a href="#Faster-RCNN-note" class="headerlink" title="Faster RCNN note"></a>Faster RCNN note</h1><p>æœ¬æ–‡æ€»ç»“è‡ªçŸ¥ä¹é“¾æ¥<a href="https://zhuanlan.zhihu.com/p/31426458">https://zhuanlan.zhihu.com/p/31426458</a></p><h2 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h2><p>Faster RCNNå…¶å®å¯ä»¥åˆ†ä¸º4ä¸ªä¸»è¦å†…å®¹ï¼š</p><ol><li><p>Conv layers </p><p>Faster RCNNé¦–å…ˆä½¿ç”¨ä¸€ç»„åŸºç¡€çš„conv+relu+poolingå±‚æå–imageçš„feature mapsã€‚è¯¥feature mapsè¢«å…±äº«ç”¨äºåç»­RPNå±‚å’Œå…¨è¿æ¥å±‚ã€‚</p></li><li><p>Region Proposal Networks</p><p>è¯¥å±‚é€šè¿‡softmaxåˆ¤æ–­anchorså±äºpositiveæˆ–è€…negativeï¼Œå†åˆ©ç”¨bounding box regressionä¿®æ­£anchorsè·å¾—ç²¾ç¡®çš„proposalsã€‚</p></li><li><p>Roi Pooling</p><p>è¯¥å±‚æ”¶é›†è¾“å…¥çš„feature mapså’Œproposalsï¼Œç»¼åˆè¿™äº›ä¿¡æ¯åæå–proposal feature mapsï¼Œé€å…¥åç»­å…¨è¿æ¥å±‚åˆ¤å®šç›®æ ‡ç±»åˆ«ã€‚</p></li><li><p>Classification</p><p>åˆ©ç”¨proposal feature mapsè®¡ç®—proposalçš„ç±»åˆ«ï¼ŒåŒæ—¶å†æ¬¡bounding box regressionè·å¾—æ£€æµ‹æ¡†æœ€ç»ˆçš„ç²¾ç¡®ä½ç½®ã€‚</p></li></ol><p><img src="/archives/2ad8fafc/image-20210614151135341.png" style="zoom: 67%;"></p><h2 id="Conv-Layers"><a href="#Conv-Layers" class="headerlink" title="Conv Layers"></a>Conv Layers</h2><p>Conv layerséƒ¨åˆ†å…±æœ‰13ä¸ªconvå±‚ï¼Œ13ä¸ªreluå±‚ï¼Œ4ä¸ªpoolingå±‚ </p><ol><li>æ‰€æœ‰çš„convå±‚éƒ½æ˜¯ï¼škernel_size=3ï¼Œpad=1ï¼Œstride=1</li><li>æ‰€æœ‰çš„poolingå±‚éƒ½æ˜¯ï¼škernel_size=2ï¼Œpad=0ï¼Œstride=2</li></ol><p>é‚£ä¹ˆï¼Œä¸€ä¸ªMxNå¤§å°çš„çŸ©é˜µç»è¿‡Conv layerså›ºå®šå˜ä¸º(M/16)x(N/16)</p><h2 id="Region-Proposal-Networks"><a href="#Region-Proposal-Networks" class="headerlink" title="Region Proposal Networks"></a>Region Proposal Networks</h2><h3 id="Anchors"><a href="#Anchors" class="headerlink" title="Anchors"></a>Anchors</h3><p>æåˆ°RPNç½‘ç»œï¼Œå°±ä¸èƒ½ä¸è¯´anchorsã€‚æ‰€è°“anchorsï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç»„ç”±ç¨‹åºç”Ÿæˆçš„çŸ©å½¢ã€‚ç›´æ¥è¿è¡Œä½œè€…demoä¸­çš„generate_anchors.pyå¯ä»¥å¾—åˆ°ä»¥ä¸‹è¾“å‡º (ä¸è¦è¢«è¿™äº›æ•°å­—å“åˆ°äº†ï¼Œæ²¡æœ‰å…·ä½“æ„ä¹‰)</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">84</span><span class="token punctuation">.</span>  <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">.</span>   <span class="token number">99</span><span class="token punctuation">.</span>   <span class="token number">55</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">176</span><span class="token punctuation">.</span>  <span class="token operator">-</span><span class="token number">88</span><span class="token punctuation">.</span>  <span class="token number">191</span><span class="token punctuation">.</span>  <span class="token number">103</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">360</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">184</span><span class="token punctuation">.</span>  <span class="token number">375</span><span class="token punctuation">.</span>  <span class="token number">199</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">56</span><span class="token punctuation">.</span>  <span class="token operator">-</span><span class="token number">56</span><span class="token punctuation">.</span>   <span class="token number">71</span><span class="token punctuation">.</span>   <span class="token number">71</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">120</span><span class="token punctuation">.</span>  <span class="token number">135</span><span class="token punctuation">.</span>  <span class="token number">135</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">248</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">248</span><span class="token punctuation">.</span>  <span class="token number">263</span><span class="token punctuation">.</span>  <span class="token number">263</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">36</span><span class="token punctuation">.</span>  <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">.</span>   <span class="token number">51</span><span class="token punctuation">.</span>   <span class="token number">95</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">168</span><span class="token punctuation">.</span>   <span class="token number">95</span><span class="token punctuation">.</span>  <span class="token number">183</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">168</span><span class="token punctuation">.</span> <span class="token operator">-</span><span class="token number">344</span><span class="token punctuation">.</span>  <span class="token number">183</span><span class="token punctuation">.</span>  <span class="token number">359</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¯è¡Œæœ‰4ä¸ªå€¼ï¼Œä»£è¡¨äº†çŸ©å½¢å·¦ä¸Šè§’å’Œå³ä¸‹è§’ä¸¤ä¸ªç‚¹$(x_1, y_1, x_2, y_2)$ </p><p>ä¸€å…±9ä¸ªçŸ©å½¢ï¼Œæ¥ç»„äºä¸åŒé•¿å®½æ¯”å’Œä¸åŒå¤§å°çš„ç»„åˆï¼šé•¿å®½æ¯”æœ‰3ç§ï¼Œ1:1, 1:2, 2:1</p><p><img src="/archives/2ad8fafc/image-20210614152512944.png" style="zoom:50%;"></p><p>é‚£ä¹ˆè¿™9ä¸ªanchorsæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿå€Ÿç”¨Faster RCNNè®ºæ–‡ä¸­çš„åŸå›¾ï¼Œå¦‚å›¾7ï¼Œéå†Conv layersè®¡ç®—è·å¾—çš„feature mapsï¼Œä¸ºæ¯ä¸€ä¸ªç‚¹éƒ½é…å¤‡è¿™9ç§anchorsä½œä¸ºåˆå§‹çš„æ£€æµ‹æ¡†</p><p><img src="/archives/2ad8fafc/v2-c93db71cc8f4f4fd8cfb4ef2e2cef4f4_720w.jpg" style="zoom:80%;"></p><p>ç®€å•è§£é‡Šä¸€ä¸‹ä¸Šå›¾ï¼š</p><ol><li><p>conv feature mapä¸­ï¼Œæ¯ä¸€ä¸ªç‚¹éƒ½æ˜¯256-dimensions</p></li><li><p>intermidiate layerä¸º 3x3 å·ç§¯ï¼Œout put dimensionä¸º256ï¼Œå¾—åˆ°æ–°çš„conv feature map</p></li><li><p>åœ¨æ–°çš„conv feature mapä¸Šï¼Œæˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªç‚¹é¢„å…ˆè®¾å®šçš„kä¸ªanchoråšbounding box regressionå’Œsoftmaxåˆ†ç±»(positive, nagetiveä¸¤ç±»)ï¼Œåˆ†åˆ«å¯¹åº”4k coordinatesï¼Œ2k scores</p><p>æ¢å¥è¯è¯´ï¼Œå°±æ˜¯æŠŠæŸä¸€anchoråŒºåŸŸä¸­çš„ç‰¹å¾å‘é‡æ‹¿å»åšpredictionï¼Œé¢„æµ‹å†…å®¹ä¸ºè¯¥ç‚¹çš„åˆ†ç±»å’Œè¯¥ç‚¹/anchorå¯¹åº”çš„bounding boxå‚æ•°</p></li><li><p>ç”±äºanchoræ•°é‡æ˜¯å·¨å¤§çš„ï¼Œè®­ç»ƒç¨‹åºä¼šåœ¨åˆé€‚çš„anchorsä¸­<strong>éšæœº</strong>é€‰å–128ä¸ªpostive anchors+128ä¸ªnegative anchorsè¿›è¡Œè®­ç»ƒ</p></li></ol><h3 id="Bounding-box-regressionåŸç†"><a href="#Bounding-box-regressionåŸç†" class="headerlink" title="Bounding box regressionåŸç†"></a>Bounding box regressionåŸç†</h3><p>æ€æ ·åœ¨anchorçš„åŸºç¡€ä¸Šå›å½’å¾—åˆ°ground truthæ ‡ç­¾å‘¢ï¼Ÿ</p><p>ç»™å®šanchor $(A_x, A_y, A_w, A_h)$ ï¼Œç»™å®šground truth $(G_x, G_y, G_w, G_h)$</p><p>æˆ‘ä»¬åªè¦å»é¢„æµ‹ä¸­å¿ƒç‚¹çš„ä½ç½®åç§»ï¼Œä»¥åŠçŸ©å½¢é•¿å®½çš„ç¼©æ”¾å³å¯</p><p>ä¸ªäººè§‰å¾—è¿™æ ·çš„å›å½’æ–¹æ³•æœ‰ç‚¹éº»çƒ¦ï¼Œè¿™æ ·æ¥çœ‹CenterNetä¸­çš„bounding boxå›å½’æ˜¯ç›¸å½“ç›´æ¥çš„</p><h3 id="Proposal"><a href="#Proposal" class="headerlink" title="Proposal"></a>Proposal</h3><ol><li>ç”Ÿæˆanchorsï¼Œå¾—åˆ°å¯¹åº”çš„confidence score &amp; bounding box regressionï¼Œå½¢æˆæœ€åˆçš„proposal</li><li>å¯¹æ‰€æœ‰anchorsï¼Œæ ¹æ®positive scoreè¿›è¡Œæ’åºï¼Œå–å‰6000ä¸ªanchor proposals</li><li>å»é™¤è¾ƒå°å’Œè¶…å‡ºè¾¹ç•Œçš„proposal</li><li>NMS</li></ol><h2 id="ROI-Pooling"><a href="#ROI-Pooling" class="headerlink" title="ROI Pooling"></a>ROI Pooling</h2><p>Rol poolingå±‚æœ‰2ä¸ªè¾“å…¥ï¼š</p><ol><li>åŸå§‹feature maps</li><li>RPNè¾“å‡ºçš„proposals</li></ol><p>è¿™ä¸€ä¸ªPoolingæ“ä½œè¿˜è¦æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯éœ€è¦å¤„ç†ä¸åŒå¤§å°çš„proposal (kernel)ã€‚ç»å…¸çš„pooingæ“ä½œæ˜¯ä½¿ç”¨ç›¸åŒå¤§å°çš„kernelï¼Œè¿™é‡Œæˆ‘ä»¬è¦é¢„å…ˆå¯¹ proposal (region of interest) è¿›è¡Œç»Ÿä¸€çš„åˆ†å‰²ï¼Œä½¿å¾—poolingç»“æœæ˜¯ç›¸åŒçš„è¡¨ç¤º(å¦‚ä¸‹å›¾)</p><p><img src="/archives/2ad8fafc/image-20210614164103022.png" style="zoom: 67%;"></p><h2 id="Classification"><a href="#Classification" class="headerlink" title="Classification"></a>Classification</h2><p>Classificationéƒ¨åˆ†åˆ©ç”¨å·²ç»è·å¾—çš„proposal feature mapsï¼Œé€šè¿‡full connectå±‚ä¸softmaxè®¡ç®—æ¯ä¸ªproposalå…·ä½“å±äºé‚£ä¸ªç±»åˆ«ï¼ˆå¦‚äººï¼Œè½¦ï¼Œç”µè§†ç­‰ï¼‰ï¼Œè¾“å‡ºcls_probæ¦‚ç‡å‘é‡ï¼›åŒæ—¶å†æ¬¡åˆ©ç”¨bounding box regressionè·å¾—æ¯ä¸ªproposalçš„ä½ç½®åç§»é‡bbox_predï¼Œç”¨äºå›å½’æ›´åŠ ç²¾ç¡®çš„ç›®æ ‡æ£€æµ‹æ¡†</p><p><img src="/archives/2ad8fafc/image-20210614164211554.png" style="zoom:80%;"></p><h2 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h2><p>Faster R-CNNçš„è®­ç»ƒï¼Œæ˜¯åœ¨å·²ç»è®­ç»ƒå¥½çš„modelï¼ˆå¦‚VGGï¼ŒZFï¼‰çš„åŸºç¡€ä¸Šç»§ç»­è¿›è¡Œè®­ç»ƒï¼Œå®é™…è®­ç»ƒè¿‡ç¨‹ä¸ºä»¥ä¸‹ï¼š</p><ol><li>åœ¨å·²ç»è®­ç»ƒå¥½çš„model(e.g. VGG)ï¼Œè®­ç»ƒRPN</li><li>ç”¨æ­¥éª¤1ä¸­å¾—åˆ°çš„RPNæå‡ºproposal</li><li>ç”¨æå‡ºçš„Proposalè®­ç»ƒFast RCNN</li><li>ç”¨æ­¥éª¤4ä¸­è®­ç»ƒå¥½çš„Fast RCNNç»§ç»­è®­ç»ƒRPN</li><li>é‡å¤2</li><li>é‡å¤3</li></ol><p>å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ç§ç±»ä¼¼è¿­ä»£çš„è¿‡ç¨‹ï¼Œä½†åªå¾ªç¯äº†2æ¬¡ï¼Œæ–‡ç« æå‡ºæ›´å¤šçš„å¾ªç¯å¹¶ä¸ä¼šå¸¦æ¥ç›¸åº”çš„æå‡</p>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Faster RCNN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VSCode æ•™ç¨‹</title>
      <link href="/archives/ca50f614.html"/>
      <url>/archives/ca50f614.html</url>
      
        <content type="html"><![CDATA[<h1 id="VSCode-note"><a href="#VSCode-note" class="headerlink" title="VSCode note"></a>VSCode note</h1><p>å­¦ä¹ è§†é¢‘ <a href="https://www.bilibili.com/video/BV1ty4y1S7mC?p=1">bilibili</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ç›´æ¥åœ¨å®˜ç½‘ä¸€é”®ä¸‹è½½ï¼Œå®‡å®™ç¬¬ä¸€å¼€å‘å·¥å…·ï¼Œè€Œä¸”è¿˜æ˜¯å…è´¹çš„<span class="github-emoji"><span>ğŸ˜†</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ vscodeï¼Œæœ‰æ—¶å‡ºç°ä¸€äº›è«åå…¶å¦™çš„ bug<span class="github-emoji"><span>ğŸ˜¢</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f622.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼Œå¯ä»¥ä½¿ç”¨å‰å‡ ä¸ªç‰ˆæœ¬çš„ï¼Œå¦‚æœç”¨ç†Ÿäº†æŸä¸€ä¸ªç‰ˆæœ¬é‚£æš‚æ—¶ä¸è¦æ›´æ–°äº†å§ã€‚å¦‚æœæƒ³è¦å®Œæ•´å¸è½½çš„è¯éœ€è¦åˆ é™¤ <code>usr/.vscode</code> å’Œ <code>AppData/Code</code> æ–‡ä»¶ï¼Œæ„Ÿè§‰æ•´ä½“æ¥çœ‹ vscode ä¾ç„¶æ˜¯åœ¨å‘å±•å½“ä¸­çš„å¼€å‘å·¥å…·</p><h3 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h3><ol><li><p>vscode æ”¯æŒæ›´æ¢ä¸»é¢˜çš®è‚¤</p></li><li><p>vscode æ”¯æŒæ’ä»¶æ‰©å±•ï¼Œèƒ½å¤Ÿå®ç°å¤šç§åŠŸèƒ½æ¥æé«˜ç¼–ç¨‹æ•ˆç‡ï¼Œå¦‚ä¸‹è½½ä¸åŒè¯­è¨€ï¼Œé«˜äº®ä»£ç ç­‰ç­‰ï¼Œæ¨èçš„æ’ä»¶ï¼šPython, Gitlens, Remote SSH</p></li><li><p>é€šè¿‡å¿«æ·é”® palette æŸ¥æ‰¾æ–‡ä»¶ Ctrl + Pï¼ŒæŸ¥æ‰¾å‘½ä»¤ Ctrl + Shift + Pï¼ŒæŠ˜å å·¦ä¾§å·¥å…·æ  Ctrl + B</p><p>å¯ä»¥ä¿®æ”¹ä¸€äº›ä½ å¸¸ç”¨å‘½ä»¤çš„å¿«æ·é”®ï¼Œæˆ‘ä¿®æ”¹äº†å¦‚ä¸‹å‘½ä»¤ï¼š</p><ol><li>Run in python file: Ctrl + enter</li><li>Start debugging: Shift +enter</li><li>Close panels: Ctrl + Alt + P</li><li>Insert Line Above/Below: Ctrl + Shifg + \\ or Enter</li><li>Collapse folders: Ctrl + Shift + F</li></ol></li><li><p>è®¾ç½®é¢æ¿å¿«æ·é”® Ctrl + ,</p></li><li><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶ Ctrl + N</p></li></ol><h2 id="äº¤äº’å¼æ¼”ç»ƒåœº-Interactive-Playground"><a href="#äº¤äº’å¼æ¼”ç»ƒåœº-Interactive-Playground" class="headerlink" title="äº¤äº’å¼æ¼”ç»ƒåœº Interactive Playground"></a>äº¤äº’å¼æ¼”ç»ƒåœº Interactive Playground</h2><p>ä¸€äº›ç¼–è¾‘çš„å°æŠ€å·§</p><ol><li><p>åŒæ—¶é€‰ä¸­åŒåå­—æ®µ Ctrl + Shift + Lï¼Œä½†è¿™ä¸ªåŠŸèƒ½æ²¡æœ‰ Refactoring æ™ºèƒ½</p></li><li><p>IntelliSense è‡ªåŠ¨è¡¥å…¨ api åŠŸèƒ½ Ctrl + space</p></li><li><p>è¡Œæ“ä½œ</p><ol><li>å¤åˆ¶è¡Œï¼Œåœ¨æ²¡æœ‰ä»»ä½•ä¸œè¥¿é€‰ä¸­çš„æ—¶å€™ç›´æ¥ Ctrl + C</li><li>ä¸Šä¸‹ç§»åŠ¨è¡Œï¼ŒAlt + ä¸Šä¸‹é”®</li><li>åˆ é™¤è¡Œ Ctrl + Shift + K</li></ol></li><li><p>Formatting è§„èŒƒä»£ç ï¼Œéœ€è¦è‡ªå·±å®šä¹‰ format</p></li></ol><h2 id="ä¸€äº›æ¨èçš„è®¾ç½®"><a href="#ä¸€äº›æ¨èçš„è®¾ç½®" class="headerlink" title="ä¸€äº›æ¨èçš„è®¾ç½®"></a>ä¸€äº›æ¨èçš„è®¾ç½®</h2><p>æ‰“å¼€ settings</p><ol><li>åœ¨ç†Ÿæ‚‰ä¹‹åå…³é—­ welcome/startup ç•Œé¢</li><li>å»ºè®®ä½¿ç”¨è‹±æ–‡ç•Œé¢</li><li>è®¾ç½®å­—ä½“ JetBrains Monoï¼Œè¿˜å¯ä»¥é¡ºä¾¿è®¾ç½®ä¸€ä¸‹å­—å·ã€‚å®‰è£…å­—ä½“<a href="https://blog.csdn.net/HUSTHY/article/details/104023077">æ•™ç¨‹</a></li><li>è®¾ç½®æ˜¯å¦æ˜¾ç¤ºç¼©ç•¥å›¾ minimap</li><li><p>è®¾ç½® restore windows æ˜¯å¦ç›´æ¥æ¢å¤ä¸Šä¸€æ¬¡çš„é¡¹ç›®</p></li><li><p>è®¾ç½®å¼€å¯ Trims final newlines è‡ªåŠ¨æ¶ˆé™¤æ–‡ä»¶æœ«å°¾å¤šä½™çš„ç©ºè¡Œ</p></li></ol><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>ä¸‹è½½ Python æ’ä»¶</p><h3 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h3><ol><li><p>åœ¨åº•éƒ¨çš„ status bar æ·»åŠ  python è§£é‡Šå™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ palette æ¥æ·»åŠ  interpreterã€‚ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ç”µè„‘ä¸Šçš„ python interpreter (åŒ…æ‹¬ anaconda ä¸­åˆ›å»ºçš„ç¯å¢ƒ)</p></li><li><p>å»ºç«‹ debug ç¯å¢ƒ craete a launch.json fileï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤å€¼å°±å¥½ï¼Œè¯¦ç»†è¯´æ˜åœ¨ <a href="https://zhuanlan.zhihu.com/p/142642410">çŸ¥ä¹</a></p><p>è¡¥å……ï¼šé»˜è®¤é…ç½®åª debug å½“å‰ folder ä¸‹çš„ä»£ç ï¼ˆâ€œè‡ªå·±â€çš„ä»£ç ï¼‰ï¼Œå¦‚æœæ˜¯ pip/conda install å®‰è£…çš„ä»£ç ï¼ˆâ€œåˆ«äººâ€çš„ä»£ç ï¼‰ï¼Œæ˜¯ä¸ä¼šè¿›è¡Œ debug çš„ã€‚å¦‚æœæƒ³è¦ debug æ‰€æœ‰ä»£ç åˆ™é…ç½®æ–‡ä»¶éœ€è¦åŠ ä¸Š <code>"justMyCode": false</code> <a href="https://blog.csdn.net/g534441921/article/details/102743393">CSDN</a></p><p>è¡¥å……ï¼šå¯¹äºéœ€è¦ä¼ å‚æ•°çš„ python è„šæœ¬è°ƒè¯•å¯ä»¥å‚è€ƒ <a href="https://www.zhihu.com/question/50700473">çŸ¥ä¹</a></p></li><li><p>Jupyter notebook æ˜¯æ’ä»¶é‡Œè‡ªå¸¦çš„åŠŸèƒ½ï¼Œç›´æ¥æ‰“å¼€ ipynb æ–‡ä»¶å°±å¯ä»¥è¿è¡Œä»£ç å—ï¼é€šè¿‡é€‰æ‹© notebook ä¸­çš„ kernel (å…·ä½“ä¸€ç‚¹è¯´å°±æ˜¯é€‰æ‹© conda ä¸­çš„ç¯å¢ƒ) å°±èƒ½åœ¨ä½ æƒ³è¦çš„ç¯å¢ƒä¸­è¿è¡Œäº†ï¼Œéå¸¸æ–¹ä¾¿</p></li><li><p>å½“ workspace æ¯”è¾ƒå¤§çš„æ—¶å€™ Pylance å¯èƒ½åŠ è½½å¾—å¾ˆæ…¢ï¼Œå‚è€ƒ <a href="https://stackoverflow.com/questions/50389852/visual-studio-code-intellisense-not-working">Stack Overflow</a> åœ¨ Folder ä¸‹æ–°å»º pyrightconfig.json è¿›è¡Œé…ç½®ï¼ˆæ³¨æ„ä¸æ˜¯åœ¨ .vscode/ ä¸‹æ–°å»ºï¼Œè€Œæ˜¯ç›´æ¥åœ¨ workspace root ä¸‹ï¼</p></li></ol><h3 id="è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨"><a href="#è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨" class="headerlink" title="è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨"></a>è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨</h3><p>ç”±äºè¦è·‘ä¸€äº›æ¨¡å‹ï¼Œè‡ªå·±çš„ç”µè„‘æ˜¾å¡æ ¹æœ¬è·‘ä¸åŠ¨ï¼Œé‚£å°±<del>ç™½å«–</del>è¿æ¥åˆ°å®éªŒå®¤çš„æœåŠ¡å™¨â€‹</p><p>é€šè¿‡ vscode Extensions: <code>Remote-SSH</code> å®Œæˆï¼Œ<a href="https://zhuanlan.zhihu.com/p/141205262">çŸ¥ä¹</a></p><p>åœ¨ Remote Expolorer -&gt; SSH TARGETS -&gt; config ä¸­æ·»åŠ é…ç½®</p><pre class="line-numbers language-config" data-language="config"><code class="language-config"># Read more about SSH config files: https://linux.die.net/man/5/ssh_configHost random_name    HostName host_ip    User user_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é‡åˆ°äº†æŠ¥é”™ <code>Resolver error: Error: Running the contributed command: '_workbench.downloadResource' failed.</code> æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ã€‚åŸå› å¯èƒ½åœ¨äºæœåŠ¡å™¨æ˜¯åœ¨å†…ç½‘ï¼Œæ²¡æœ‰åŠæ³•åœ¨æœåŠ¡å™¨ä¸Šè‡ªåŠ¨ä¸‹è½½å¥½ vscode-serverï¼Œäºæ˜¯åªèƒ½æœ¬åœ°ä¸‹è½½ï¼Œç„¶åä¸Šä¼ </p><p>å‚è€ƒ <a href="https://blog.csdn.net/ibless/article/details/118610776">CSDN</a> è§£å†³é—®é¢˜</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> VSCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CenterPoint å¤ç°ç¬”è®°</title>
      <link href="/archives/ba7995ee.html"/>
      <url>/archives/ba7995ee.html</url>
      
        <content type="html"><![CDATA[<h1 id="CenterPoint-å¤ç°ç¬”è®°"><a href="#CenterPoint-å¤ç°ç¬”è®°" class="headerlink" title="CenterPoint å¤ç°ç¬”è®°"></a>CenterPoint å¤ç°ç¬”è®°</h1><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><ol><li><p>pytorchä¸‹è½½å¦‚æœå¾ˆæ…¢ï¼Œè¯·é‡‡ç”¨é•œåƒï¼</p></li><li><p>ä¸‹è½½cmakeä½¿ç”¨aptï¼Œä½†è¦æ›´æ–°ä¸‹è½½æºä¸ºé˜¿é‡Œäº‘ï¼Œè¿™æ ·ç‰ˆæœ¬æ‰å¤Ÿæ–°</p></li><li><p>å®‰è£…spconvæ—¶æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">The following packages have unmet dependencies: gsettings-desktop-schemas <span class="token builtin class-name">:</span> Breaks: mutter <span class="token punctuation">(</span><span class="token operator">&lt;</span> <span class="token number">3.31</span>.4<span class="token punctuation">)</span> but <span class="token number">3.28</span>.4+git20200505-0ubuntu18.04.2 is to be installedE: Error, pkgProblemResolver::Resolve generated breaks, this may be caused by held packages.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç½‘ç»œä¸Šä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨aptitude</p><pre class="line-numbers language-SHell" data-language="SHell"><code class="language-SHell"># download aptitudesudo apt install aptitudesudo aptitude install &lt;packagename&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¡€æ³ªæ•™è®­ï¼Œä¸è¦è½»æ˜“ä½¿ç”¨aptitudeï¼Œç³»ç»Ÿå¾ˆå¤šä¸œè¥¿éƒ½è¢«æ”¹å†™äº†ï¼Œç»è¿‡ä¸€ç•ªæŠ˜è…¾å‡çº§åˆ°äº†ubuntu 20.04ï¼Œä¹Ÿä¸çŸ¥é“ä¹‹å‰å®‰è£…çš„ä¸œè¥¿æœ‰æ²¡æœ‰è¢«åŠ¨</p><p>å°è±¡ä¸­æåˆ°â€held packagesâ€ï¼Œåº”è¯¥æŒ‰ç…§é‚£ç§æ–¹å¼è§£å†³</p></li><li><p>åœ¨ä¸‹è½½ spconv æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">CMake Error at CMakeLists.txt:2 <span class="token punctuation">(</span>project<span class="token punctuation">)</span>:  No CMAKE_CUDA_COMPILER could be found.  raise CalledProcessError<span class="token punctuation">(</span>retcode, cmd<span class="token punctuation">)</span>subprocess.CalledProcessError: Command <span class="token string">'['</span>cmake<span class="token string">', '</span>/home/declan/CenterPoint/spconv<span class="token string">', '</span>-DCMAKE_PREFIX_PATH<span class="token operator">=</span>/home/declan/anaconda3/envs/centerpoint/lib/python3.6/site-packages/torch<span class="token string">', '</span>-DPYBIND11_PYTHON_VERSION<span class="token operator">=</span><span class="token number">3.6</span><span class="token string">', '</span>-DSPCONV_BuildTests<span class="token operator">=</span>OFF<span class="token string">', '</span>-DCMAKE_CUDA_FLAGS<span class="token operator">=</span><span class="token string">"--expt-relaxed-constexpr"</span><span class="token string">', '</span>-DCMAKE_LIBRARY_OUTPUT_DIRECTORY<span class="token operator">=</span>/home/declan/CenterPoint/spconv/build/lib.linux-x86_64-3.6/spconv<span class="token string">', '</span>-DCMAKE_BUILD_TYPE<span class="token operator">=</span>Release<span class="token string">']'</span> returned non-zero <span class="token builtin class-name">exit</span> status <span class="token number">1</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°è¯•è®¾ç½® CUDA è·¯å¾„</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">PYTHONPATH</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${PYTHONPATH}</span>:/home/declan/CenterPoint"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/cuda-10.0/bin:<span class="token environment constant">$PATH</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">CUDA_PATH</span><span class="token operator">=</span>/usr/local/cuda-10.0<span class="token builtin class-name">export</span> <span class="token assign-left variable">CUDA_HOME</span><span class="token operator">=</span>/usr/local/cuda-10.0<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/usr/local/cuda-10.0/lib64:<span class="token variable">$LD_LIBRARY_PATH</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ²¡æœ‰æ•ˆæœã€‚#241 issueså’Œæˆ‘é—®é¢˜ä¸€æ¨¡ä¸€æ · <a href="https://github.com/traveller59/spconv/issues/241">https://github.com/traveller59/spconv/issues/241</a></p><p>å°è¯•å¢åŠ è·¯å¾„ </p><p>try adding â€˜-DCMAKE_CUDA_COMPILER=/usr/local/cuda-10.1/bin/nvccâ€™ in cmake_args</p><p>ä¾æ—§å¤±è´¥</p><p>å°è¯•ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„g++ sudo apt install g++-7ï¼Œæ˜¾ç¤ºå·²ç»ä¸‹è½½ï¼Œæˆ‘ä»¬éœ€è¦åˆ‡æ¢ç‰ˆæœ¬</p><p>ls name* å¯ä»¥åˆ—å‡ºæ‰€æœ‰nameå¼€å¤´çš„åŒ…</p><p><a href="https://blog.csdn.net/FontThrone/article/details/104279224">https://blog.csdn.net/FontThrone/article/details/104279224</a></p><p>â€”slave ä½¿å¾—g++ gccç‰ˆæœ¬ä¿æŒä¸€è‡´ 70 90ä¸ºé‡è¦æƒé‡priority</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 <span class="token number">70</span> --slave /usr/bin/g++ g++ /usr/bin/g++-7<span class="token function">sudo</span> update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 <span class="token number">90</span> --slave /usr/bin/g++ g++ /usr/bin/g++-9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯¹g++å’Œgccè¿›è¡Œç®¡ç†</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">  Selection    Path            Priority   Status------------------------------------------------------------* <span class="token number">0</span>            /usr/bin/gcc-9   <span class="token number">90</span>        auto mode  <span class="token number">1</span>            /usr/bin/gcc-7   <span class="token number">70</span>        manual mode  <span class="token number">2</span>            /usr/bin/gcc-9   <span class="token number">90</span>        manual mode<span class="token function">sudo</span> update-alternatives --config gcc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆåŠŸ</p></li><li><p>é€‰æ‹©äº† nuScenes mini æ•°æ®é›†</p></li><li><p>è¿è¡Œæµ‹è¯•</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python ./tools/dist_test.py infos_val_10sweeps_withvelo_filter_True.json  --work_dir work_dirs/CONFIG_NAME --checkpoint work_dirs/CONFIG_NAME/latest.pth --speed_test <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ModuleNotFoundError: No module named <span class="token string">'torchie'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å°è¯•å°†torchieæ–‡æ¡£ç›´æ¥åŠ å…¥åˆ°PYTHONPATHå½“ä¸­</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">PYTHONPATH</span><span class="token operator">=</span><span class="token variable">$PYTHONPATH</span>:/home/delcan/CenterPoint/det3d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ–°æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:  File <span class="token string">"./tools/dist_test.py"</span>, line <span class="token number">211</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span>  File <span class="token string">"./tools/dist_test.py"</span>, line <span class="token number">102</span>, <span class="token keyword">in</span> main    logger <span class="token operator">=</span> get_root_logger<span class="token punctuation">(</span>cfg.log_level<span class="token punctuation">)</span>  File <span class="token string">"/home/declan/CenterPoint/det3d/torchie/utils/config.py"</span>, line <span class="token number">146</span>, <span class="token keyword">in</span> __getattr__    <span class="token builtin class-name">return</span> getattr<span class="token punctuation">(</span>self._cfg_dict, name<span class="token punctuation">)</span>  File <span class="token string">"/home/declan/CenterPoint/det3d/torchie/utils/config.py"</span>, line <span class="token number">29</span>, <span class="token keyword">in</span> __getattr__    raise exAttributeError: <span class="token string">'ConfigDict'</span> object has no attribute <span class="token string">'log_level'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯èƒ½æ˜¯å› ä¸º nuscenes_mini æµ‹è¯•é›†åŸå› </p><p><a href="https://github.com/tianweiy/CenterPoint/issues/106">https://github.com/tianweiy/CenterPoint/issues/106</a></p><p>æˆ‘æ ¹æ®ä¸Šé¢çš„å†…å®¹å¯¹æºç è¿›è¡Œäº†ä¿®æ”¹ï¼Œå…ˆå°è¯• train ä¸€ä¸‹</p><p>ä¾æ—§æŠ¥é”™ï¼Œå†æ£€æŸ¥å¯èƒ½æ˜¯å› ä¸ºé…ç½®æ–‡ä»¶æ²¡æœ‰å¯¹çš„åŸå› </p><p><a href="https://github.com/open-mmlab/mmdetection/issues/3093">https://github.com/open-mmlab/mmdetection/issues/3093</a></p><p>é€šè¿‡æ­£ç¡®é…ç½® <code>nusc_centerpoint_voxelnet_0075voxel_fix_bn_z.py</code> æ–‡ä»¶è§£å†³ä¸Šé¢æŠ¥é”™</p><p><code>./configs/nusc/voxelnet/nusc_centerpoint_voxelnet_0075voxel_fix_bn_z.py</code></p><p>ç”±äºæ²¡æœ‰å®Œæ•´çš„ nuScenes æ•°æ®é›†ï¼Œåˆæœ‰æ–°çš„é”™è¯¯æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">FileNotFoundError: <span class="token punctuation">[</span>Errno <span class="token number">2</span><span class="token punctuation">]</span> No such <span class="token function">file</span> or directory: <span class="token string">'nuScenes/samples/LIDAR_TOP/n008-2018-08-27-11-48-51-0400__LIDAR_TOP__1535385105950634.pcd.bin'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è·³è¿‡è¿™é‡Œï¼Œå°è¯•è·‘ä¸€ä¸ª demo</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">python ./tools/dist_test.py ./configs/nusc/voxelnet/nusc_centerpoint_voxelnet_0075voxel_fix_bn_z.py --work_dir work_dirs/nusc_centerpoint_voxelnet_0075voxel_fix_bn_z --checkpoint work_dirs/nusc_centerpoint_voxelnet_0075voxel_fix_bn_z/latest.pth --speed_test <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸Šé¢çš„æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">FileNotFoundError: <span class="token punctuation">[</span>Errno <span class="token number">2</span><span class="token punctuation">]</span> No such <span class="token function">file</span> or directory: <span class="token string">'nuScenes/samples/LIDAR_TOP/n015-2018-10-02-10-50-40+0800__LIDAR_TOP__1538448754047572.pcd.bin'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥æ‰¾ç›®å½•å‘ç°è¿™ä¸ªæ–‡ä»¶å…¶å®æ˜¯å­˜åœ¨çš„ï¼Œè¯´æ˜è·¯å¾„æ²¡æœ‰å¯¹ï¼Œåœ¨ CentePoint ç›®å½•ä¸‹æ·»åŠ  nuScenes çš„è½¯é“¾æ¥å°±å¯ä»¥è§£å†³äº†</p></li><li><p>æœ€ç»ˆ RuntimeError: CUDA out of memory å³ä½¿ batch_size = 1 ä¹Ÿç›´æ¥ç‚¸äº†ï¼Œæ”¾å¼ƒï¼</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> papers </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CenterPoint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½² Hexo åšå®¢æ•™ç¨‹</title>
      <link href="/archives/d547a647.html"/>
      <url>/archives/d547a647.html</url>
      
        <content type="html"><![CDATA[<h1 id="é˜¿é‡Œäº‘æœåŠ¡å™¨ECS"><a href="#é˜¿é‡Œäº‘æœåŠ¡å™¨ECS" class="headerlink" title="é˜¿é‡Œäº‘æœåŠ¡å™¨ECS"></a>é˜¿é‡Œäº‘æœåŠ¡å™¨ECS</h1><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://www.bilibili.com/video/BV177411K7bH">ç‹‚ç¥è¯´_bilibili</a></p><p>å®˜æ–¹é“¾æ¥ï¼š</p><p><a href="https://developer.aliyun.com/plan/grow-up">é˜¿é‡Œäº‘å¼€å‘è€…æˆé•¿è®¡åˆ’</a></p><p><a href="https://developer.aliyun.com/adc/student?spm=a2c6h.19776329.J_4403085560.4.658b3d804yW1UU#J_3120529270">ECSè®­ç»ƒè¥</a></p><p><a href="https://www.aliyun.com/product/ecs?spm=5176.224200.J_8058803260.52.1401586cYUB7hI">äº‘æœåŠ¡å™¨ECS</a></p><h2 id="å­¦ç”Ÿæœº"><a href="#å­¦ç”Ÿæœº" class="headerlink" title="å­¦ç”Ÿæœº"></a>å­¦ç”Ÿæœº</h2><p>å¦‚æœæ˜¯å­¦ç”Ÿ/æ–°ç”¨æˆ·ï¼Œä¸€å®šè¦å»çœ‹çœ‹æœ‰å“ªäº›ä¼˜æƒ ï¼Œæ¯”å¦‚<a href="https://developer.aliyun.com/plan/grow-up">é˜¿é‡Œäº‘å¼€å‘è€…æˆé•¿è®¡åˆ’</a>ã€‚æ­¤åˆ»é˜¿é‡Œäº‘æä¾›çš„å­¦ç”Ÿä¼˜æƒ æ˜¯å…è´¹ä½¿ç”¨2ä¸ªæœˆçš„æœåŠ¡å™¨èµ„æºã€‚å¦‚æœè´­ä¹°çš„è¯ï¼Œä¸€ä¸ª1æ ¸2Gçš„æœåŠ¡å™¨å°±è¶³å¤Ÿäº†</p><p><img src="/archives/d547a647/image-20210717163630430-1627213118656.png" style="zoom: 25%;"></p><h2 id="è®¾ç½®å®‰å…¨ç»„"><a href="#è®¾ç½®å®‰å…¨ç»„" class="headerlink" title="è®¾ç½®å®‰å…¨ç»„"></a>è®¾ç½®å®‰å…¨ç»„</h2><p>è¿›å…¥æ§åˆ¶å°å¼€å¯ç«¯å£ï¼Œå¦åˆ™å¤–éƒ¨æ— æ³•è®¿é—®ã€‚é™¤äº†é»˜è®¤çš„ä¸‰ä¸ªç«¯å£ï¼Œé€šè¿‡â€œå¿«é€Ÿæ·»åŠ â€ï¼Œæˆ‘å†æ·»åŠ äº† http(80) &amp; https(443) ä¸¤ä¸ªç«¯å£ã€‚ç”±äºç°åœ¨æˆ‘å¯¹è®¡ç®—æœºç½‘ç»œä¸€çªä¸é€šï¼Œæ‰€ä»¥å…ˆå°±è¿™æ ·å§</p><p><img src="/archives/d547a647/image-20210717155930905-1627213118658.png" style="zoom: 33%;"></p><h2 id="é‡ç½®å®ä¾‹å¯†ç "><a href="#é‡ç½®å®ä¾‹å¯†ç " class="headerlink" title="é‡ç½®å®ä¾‹å¯†ç "></a>é‡ç½®å®ä¾‹å¯†ç </h2><p>ä¿®æ”¹å¯†ç ä¹‹åå®ä¾‹å°±ä¼šè‡ªåŠ¨é‡å¯</p><p>ç„¶åå°±å¯ä»¥é€šè¿‡ <code>ssh root@ip</code> è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå…¶ä¸­ ip æ˜¯ä½ æœåŠ¡å™¨çš„å…¬ç½‘ ip</p><p><img src="/archives/d547a647/image-20210717162311907-1627213118658.png" style="zoom: 33%;"></p><h2 id="Enjoy"><a href="#Enjoy" class="headerlink" title="Enjoy"></a>Enjoy</h2><p>ä¹‹åå°±å¯ä»¥åƒæ“ä½œ Linux ä¸€æ ·ï¼Œæ“ä½œè‡ªå·±çš„æœåŠ¡å™¨å•¦ï¼</p><h2 id="å°†åšå®¢éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š"><a href="#å°†åšå®¢éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š" class="headerlink" title="å°†åšå®¢éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š"></a>å°†åšå®¢éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š</h2><p>å‡ ä¸ªå‚è€ƒæ•™ç¨‹ï¼š<a href="https://developer.aliyun.com/article/775005">é˜¿é‡Œäº‘æ•™ç¨‹</a> <a href="https://blog.csdn.net/weixin_41154636/article/details/99685965">csdn æ•™ç¨‹</a> <a href="https://cloud.tencent.com/developer/article/1632020">è…¾è®¯äº‘æ•™ç¨‹</a> <a href="https://zhuanlan.zhihu.com/p/120743882">çŸ¥ä¹æ•™ç¨‹</a></p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆæ ¹æ®ä¹‹å‰çš„ Linux å®‰è£…æ•™ç¨‹ç®€å•è®¾ç½®ä¸€ä¸‹è‡ªå·±çš„æœåŠ¡å™¨ï¼šæ·»åŠ æ–°ç”¨æˆ·ï¼Œæ›´æ”¹ä¸»æœºå</p><p>ç°åœ¨æœ¬åœ°é…ç½®å¥½ hexo ç¯å¢ƒï¼Œå…·ä½“é…ç½®è¿‡ç¨‹åœ¨ä¹‹å‰çš„åšå®¢æœ‰è¯¦ç»†è®°å½•</p><h3 id="åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…-git"><a href="#åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…-git" class="headerlink" title="åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… git"></a>åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… git</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> yum <span class="token function">install</span> -y <span class="token function">git</span><span class="token comment"># å®‰è£…æˆåŠŸåæŸ¥çœ‹ git version</span><span class="token function">git</span> --version <span class="token function">git</span> version <span class="token number">2.27</span>.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºä¹‹å‰åœ¨ Ubuntu ä¸Šä½¿ç”¨çš„æ˜¯ apt åŒ…ç®¡ç†ï¼Œåœ¨ CentOS ä¸Šåˆ™æ¢ä¸º yum åŒ…ç®¡ç†ã€‚æˆ‘è¯•éªŒäº†ä¸€ä¸‹ï¼Œå¦‚æœä¸åŠ  sudo æ˜¯ä¸èƒ½ä¸‹è½½æˆåŠŸçš„</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Error: This <span class="token builtin class-name">command</span> has to be run under the root user.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰€ä»¥æˆ‘è®¤ä¸º yum å’Œ apt ä¸€æ ·éœ€è¦ sudo æƒé™</p><h3 id="å®‰è£…-nginx"><a href="#å®‰è£…-nginx" class="headerlink" title="å®‰è£… nginx"></a>å®‰è£… nginx</h3><p>ä»€ä¹ˆæ˜¯ nginxï¼Ÿä¸‹é¢æ˜¯å®˜ç½‘æè¿°</p><blockquote><p>NGINX is a highâ€‘performance, highly scalable, highly available web server, reverse proxy server, and web accelerator (combining the features of an HTTP load balancer, content cache, and more).</p></blockquote><p>åœ¨æˆ‘ç†è§£çœ‹æ¥ï¼Œéƒ¨ç½²ç½‘ç«™çš„è¿‡ç¨‹ä¸­ nginx å°±æ˜¯ç”¨æ¥æä¾›ç½‘é¡µæœåŠ¡çš„æœåŠ¡å™¨ã€‚è¿™é‡Œå°±è¦æ›´è¿›ä¸€æ­¥ç†è§£ä»€ä¹ˆæ˜¯å¹¿ä¹‰ä¸Šçš„æœåŠ¡å™¨</p><blockquote><p>ä»å¹¿ä¹‰ä¸Šè®²ï¼ŒæœåŠ¡å™¨æ˜¯æŒ‡ç½‘ç»œä¸­èƒ½å¯¹å…¶å®ƒæœºå™¨æä¾›æŸäº›æœåŠ¡çš„è®¡ç®—æœºç³»ç»Ÿã€‚ä»ç‹­ä¹‰ä¸Šè®²ï¼ŒæœåŠ¡å™¨æ˜¯ä¸“æŒ‡æŸäº›é«˜æ€§èƒ½è®¡ç®—æœºï¼Œèƒ½é€šè¿‡ç½‘ç»œï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚</p></blockquote><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> yum <span class="token function">install</span> -y nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å»ºç«‹-git-ä»“åº“"><a href="#å»ºç«‹-git-ä»“åº“" class="headerlink" title="å»ºç«‹ git ä»“åº“"></a>å»ºç«‹ git ä»“åº“</h3><p>Hexo å¯ä»¥ä½¿ç”¨ git æ¥éƒ¨ç½²ï¼Œè¿™æ ·æ¯æ¬¡å†™å®Œä¹‹åå°±éƒ½å¯ä»¥ä½¿ç”¨gitæ¥ä¸€é”®éƒ¨ç½²äº†ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚æˆ‘ä»¬å…ˆä¸ºç³»ç»Ÿæ·»åŠ ä¸€ä¸ª git ç”¨æˆ·</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">useradd</span> -m <span class="token function">git</span> <span class="token comment"># æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ·</span><span class="token function">passwd</span> <span class="token function">git</span> <span class="token comment"># è®¾ç½®gitç”¨æˆ·å¯†ç </span><span class="token function">su</span> <span class="token function">git</span> <span class="token comment"># åˆ‡æ¢ç”¨æˆ·è¿›è¡Œåç»­æ“ä½œ</span><span class="token builtin class-name">cd</span> /home/git/<span class="token function">mkdir</span> -p projects/blog <span class="token comment"># æŠŠé¡¹ç›®ç›®å½•å»ºç«‹èµ·æ¥</span><span class="token function">mkdir</span> repos <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> repos<span class="token function">git</span> init --bare blog.git <span class="token comment"># åˆ›å»ºä»“åº“</span><span class="token builtin class-name">cd</span> blog.git/hooks<span class="token function">vim</span> post-receive <span class="token comment"># åˆ›å»ºä¸€ä¸ªé’©å­</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>post-receiveæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/sh</span><span class="token function">git</span> --work-tree<span class="token operator">=</span>/home/git/projects/blog --git-dir<span class="token operator">=</span>/home/git/repos/blog.git checkout -f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç»™ post-receive æ·»åŠ æ‰§è¡Œæƒé™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">chmod</span> +x post-receive<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>git init â€”bare å’Œ git init æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ <a href="https://blog.csdn.net/sinat_34349564/article/details/52487860">csdn é“¾æ¥</a></p><p>hooksæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ <a href="https://blog.csdn.net/weixin_41154636/article/details/99685965">csdn é“¾æ¥</a></p><p>è¯¥é’©å­çš„æ„æ€æ˜¯å½“æœ¬åœ°æœ‰æäº¤åˆ°æœåŠ¡å™¨æ—¶ï¼Œä¼šå°†æ–‡ä»¶æ”¾åœ¨/home/hexoä¸‹</p><p><code>-f</code>è¿™ä¸ªå‚æ•°å¦‚æœåœ¨å¤šäººåä½œçš„åšå®¢ä¸­å¯èƒ½ä¼šå¼•å‘ä¸å¥½çš„ç»“æœï¼Œå› ä¸ºä»–æ˜¯å¼ºåˆ¶æ›´æ–°çš„æ„æ€ï¼Œä¼šå°†æœ¬åœ°ç‰ˆæœ¬è¦†ç›–æ‰è¿œç¨‹æœåŠ¡å™¨çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯æ˜¯ä¸ªäººçš„åšå®¢ç³»ç»Ÿå°±æ— æ‰€è°“äº†</p><h3 id="å°†å…¬é’¥é…ç½®åˆ°æœåŠ¡å™¨ä¸Š"><a href="#å°†å…¬é’¥é…ç½®åˆ°æœåŠ¡å™¨ä¸Š" class="headerlink" title="å°†å…¬é’¥é…ç½®åˆ°æœåŠ¡å™¨ä¸Š"></a>å°†å…¬é’¥é…ç½®åˆ°æœåŠ¡å™¨ä¸Š</h3><p>å¯ä»¥é€šè¿‡å»ºç«‹SSHä¿¡ä»»å…³ç³»ï¼Œæ¥å…å»ç™»é™†æœåŠ¡å™¨æ—¶è¾“å…¥å¯†ç çš„æ­¥éª¤</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ssh-copy-id -i ~/.ssh/id_rsa.pub git@server_ip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ‘å°è¯•äº†ä¸€ä¸‹è‡ªå·±æ‰‹åŠ¨å¤åˆ¶ id_rsa.pub åˆ° authorized_keys æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯ä¸èƒ½å®ç°å…å¯†ç™»é™†ï¼Œå¯èƒ½æ—¶å¤åˆ¶æ—¶çš„å­—ç¬¦ä¸²å‡ºç°äº†é—®é¢˜ï¼Œä¹‹å‰åœ¨ github æ—¶ä¹Ÿé‡åˆ°äº†ç±»ä¼¼é—®é¢˜ï¼Œç›´æ¥å¤åˆ¶å…¬é’¥æ— æ³•è¯†åˆ«çš„æƒ…å†µ</p><h3 id="æ›´æ”¹-git-ç”¨æˆ·é»˜è®¤-shell"><a href="#æ›´æ”¹-git-ç”¨æˆ·é»˜è®¤-shell" class="headerlink" title="æ›´æ”¹ git ç”¨æˆ·é»˜è®¤ shell"></a>æ›´æ”¹ git ç”¨æˆ·é»˜è®¤ shell</h3><p>ä¸ºäº†å®‰å…¨ï¼Œæˆ‘ä»¬æœ€å¥½ç¦ç”¨ git ç”¨æˆ·çš„ shell ç™»å½•æƒé™ã€‚ä»è€Œåªèƒ½ç”¨ git cloneï¼Œgit push ç­‰ git æ“ä½œè®¿é—®æœåŠ¡å™¨</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">cat</span> /etc/shells <span class="token comment"># æŸ¥çœ‹ git-shell æ˜¯å¦åœ¨ç™»å½•æ–¹å¼é‡Œé¢</span><span class="token function">which</span> git-shell <span class="token comment"># æ‰¾åˆ°git-shellçš„è·¯å¾„ï¼Œè®°ä¸‹æ¥</span><span class="token function">sudo</span> <span class="token function">vim</span> /etc/shells <span class="token comment"># æŠŠ git-shell è·¯å¾„æ·»åŠ åˆ°æ–‡ä»¶æœ«å°¾</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ›´æ”¹ git ç”¨æˆ· shell</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/passwd<span class="token comment"># å°†åŸæ¥çš„ /bin/bash æ”¹ä¸º /usr/bin/git-shell</span><span class="token comment"># git:x:1001:1001::/home/git:/usr/bin/git-shell</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p> è¿™æ ·å½“ä½ å†æ¬¡ç”¨ ssh è¿æ¥ git ç”¨æˆ·æ—¶å°±ä¼šå‡ºç°ä»¥ä¸‹ä¿¡æ¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">fatal: Interactive <span class="token function">git</span> shell is not enabled.hint: ~/git-shell-commands should exist and have <span class="token builtin class-name">read</span> and execute access.Connection to your_ip closed.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="éƒ¨ç½²ä¸Šçº¿"><a href="#éƒ¨ç½²ä¸Šçº¿" class="headerlink" title="éƒ¨ç½²ä¸Šçº¿"></a>éƒ¨ç½²ä¸Šçº¿</h3><p>æˆ‘ä»¬ä¿®æ”¹<strong>æœ¬åœ°</strong> hexo é…ç½®æ–‡ä»¶ _config.yml</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">deploy</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> git  <span class="token key atrule">repo</span><span class="token punctuation">:</span> git@your_ip<span class="token punctuation">:</span>/home/git/repos/blog.git<span class="token comment"># repo: git@github.com:name/name.github.io.git</span>  <span class="token key atrule">branch</span><span class="token punctuation">:</span> master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®å¥½åå°±æ˜¯ hexo ä¸‰è¿ä¸€é”®éƒ¨ç½²ï¼š<code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</code></p><h3 id="é…ç½®-nginx"><a href="#é…ç½®-nginx" class="headerlink" title="é…ç½® nginx"></a>é…ç½® nginx</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /etc/nginx<span class="token function">cp</span> nginx.conf nginx_backup.conf <span class="token comment"># å¤‡ä»½é…ç½®æ–‡ä»¶</span><span class="token function">vim</span> nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æœ‰ä¸¤ä¸ªéœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š</p><ol><li><p>å¼€å¤´çš„ <code>user nginx</code> è¦æ”¹ä¸º <code>user root</code> </p></li><li><p>server éƒ¨åˆ†</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span> <span class="token comment">#ç›‘å¬80ç«¯å£</span>        <span class="token directive"><span class="token keyword">server_name</span> 139.159.245.212</span><span class="token punctuation">;</span> <span class="token comment">#ä½ çš„æœåŠ¡å™¨åï¼Œé€šå¸¸æ˜¯åŸŸåï¼Œå¦‚æœæ˜¯åŸŸåï¼Œä½ å°±éœ€è¦ç›‘å¬80ç«¯å£</span>        <span class="token directive"><span class="token keyword">root</span>       /home/git/projects/blog</span><span class="token punctuation">;</span> <span class="token comment">#ç½‘ç«™çš„æ ¹ç›®å½•</span>        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>é…ç½®å¥½å <code>nginx -s reload</code> é‡æ–°åŠ è½½é…ç½®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿›è¡ŒåŠ è½½ï¼Œåˆ™è¿˜éœ€è¦å…ˆè¿è¡Œå‘½ä»¤ <code>nginx -c /etc/nginx/nginx.conf</code></p><p>ç°åœ¨ä½ å°±å¯ä»¥é€šè¿‡ ip åœ°å€è®¿é—®ä½ çš„ç½‘é¡µå•¦ï¼</p><p>æˆ‘å‘ç°ç”±äºæˆ‘çš„ç½‘ç«™å°é¢å¤ªå¤§(æœ‰6M)ï¼Œæ‰“å¼€æ—¶åŠ è½½æ¯”è¾ƒæ…¢ã€‚æ‰€ä»¥æˆ‘éœ€è¦å‹ç¼©ä¸€ä¸‹å°é¢å›¾ç‰‡çš„å¤§å°ï¼Œæ¨èä¸¤ä¸ªå‹ç¼©å›¾ç‰‡ç½‘ç«™</p><p><a href="https://compressjpeg.com/">https://compressjpeg.com/</a></p><p><a href="https://tinypng.com/">https://tinypng.com/</a></p><h2 id="åŸŸå"><a href="#åŸŸå" class="headerlink" title="åŸŸå"></a>åŸŸå</h2><p>ä»€ä¹ˆæ˜¯åŸŸåï¼Ÿå‚è€ƒé“¾æ¥ï¼š<a href="https://www.bilibili.com/video/BV1kE411i7Jo?from=search&amp;seid=2556702162224412196">CodeSheep bilibili</a></p><p>å»ºè®®é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://help.aliyun.com/product/35473.html?spm=a2c4g.11186623.6.540.5b09689epNroGg">é˜¿é‡Œäº‘åŸŸåæœåŠ¡</a> <a href="https://help.aliyun.com/document_detail/61257.html?spm=a2c4g.11174283.2.6.36904c070bCdBM">ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘åŸŸåæœåŠ¡</a></p><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ <a href="https://help.aliyun.com/document_detail/54068.htm?spm=a2c4g.11186623.2.13.5ff0689efHL52u#task-1830383">æ³¨å†Œé€šç”¨åŸŸå</a>ï¼ŒèŠ±è´¹79å…ƒå·¨èµ„æ³¨å†Œäº†3å¹´åŸŸå hongkun.space</p><p><img src="/archives/d547a647/image-20210717235130445-1627213118658.png" style="zoom:50%;"></p><p>å®Œæˆè´­ä¹°è¿‡åè¿˜éœ€è¦è¿›è¡Œï¼š</p><ol><li><a href="https://help.aliyun.com/document_detail/35881.htm?spm=a2c4g.11186623.2.14.275a689e1pnnCW#concept-uhk-w5v-12b">å®åè®¤è¯</a>ï¼šä¸€èˆ¬3å¤©å·¦å³å®¡æ ¸é€šè¿‡</li><li><a href="https://beian.aliyun.com/pcContainer/formpage?page=selfBa&amp;pageAction=init&amp;orderType=100">åŸŸåå¤‡æ¡ˆ</a>ï¼šåˆå®¡1-2å¤©ï¼Œå®Œæ•´å¤‡æ¡ˆå®¡æ ¸è¿‡ç¨‹å¤§æ¦‚åå¤šå¤©</li></ol><p>æ³¨æ„éœ€è¦å…ˆè¿›è¡Œå®åè®¤è¯ï¼Œç„¶åæ‰èƒ½å®Œæˆå¤‡æ¡ˆ</p><p>è¿™é‡Œæˆ‘è¿˜é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘é€šè¿‡å­¦ç”Ÿä¼˜æƒ å…è´¹é¢†å–çš„æœåŠ¡å™¨ä¸èƒ½è¿›è¡ŒåŸŸåå¤‡æ¡ˆï¼Œå› ä¸ºè‡³å°‘éœ€è¦æœ‰3ä¸ªæœˆçš„æœåŠ¡å™¨ä½¿ç”¨æƒæ‰èƒ½å¤‡æ¡ˆã€‚çœ‹æ¥è¿˜æ˜¯å¾—è‡ªå·±è´­ä¹°ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæˆ‘å†æ¬¡èŠ±è´¹å·¨èµ„96å…ƒï¼ˆæ–°ç”¨æˆ·ä¼˜æƒ ï¼‰è´­ä¹°äº†ä¸€å¹´çš„è½»é‡åº”ç”¨æœåŠ¡å™¨</p><h3 id="è½»é‡åº”ç”¨æœåŠ¡å™¨"><a href="#è½»é‡åº”ç”¨æœåŠ¡å™¨" class="headerlink" title="è½»é‡åº”ç”¨æœåŠ¡å™¨"></a>è½»é‡åº”ç”¨æœåŠ¡å™¨</h3><p><a href="https://www.aliyun.com/product/swas?spm=5176.8789780.J_8058803260.52.578945b5xsNx3V">è½»é‡åº”ç”¨æœåŠ¡å™¨</a>æœ‰å•ç‹¬çš„<a href="https://account.aliyun.com/login/login.htm?spm=5176.161059.J_5253785160.3.2c9ea505nvWZQs&amp;oauth_callback=https%3A%2F%2Fswas.console.aliyun.com%2F%3Fspm%3D5176.161059.J_835498.2.3e9f7fdaKmYuj7&amp;lang=zh#/servers">æ§åˆ¶å°</a>ï¼Œç”¨æ¥éƒ¨ç½²ç½‘ç«™æ€§ä»·æ¯”éå¸¸ä¸é”™ï¼Œé…ç½®è¿‡ç¨‹å’Œä¸Šé¢çš„äº‘æœåŠ¡å™¨ä¸€æ ·</p><p>åœ¨è½»é‡åº”ç”¨æœåŠ¡å™¨çš„æ§åˆ¶å°ä¸­ï¼ŒåŸŸåè§£æå’Œå¤‡æ¡ˆå°±åœ¨æ¦‚è§ˆé¡µé¢å½“ä¸­ï¼Œæ ¹æ®æµç¨‹è¿›è¡Œå³å¯</p><p><img src="/archives/d547a647/image-20210725173426850.png" style="zoom: 33%;"></p><h2 id="éƒ¨ç½²-SSL-è¯ä¹¦-https"><a href="#éƒ¨ç½²-SSL-è¯ä¹¦-https" class="headerlink" title="éƒ¨ç½² SSL è¯ä¹¦ (https)"></a>éƒ¨ç½² SSL è¯ä¹¦ (https)</h2><p>ç½‘ç«™ç°åœ¨å¯ä»¥è®¿é—®äº†ï¼Œä½†æ˜¯å¦‚ä¸‹å›¾å¯è§ï¼Œç™»é™†ç½‘ç«™ä¼šæç¤º <strong>Not Secure!!!</strong></p><p><img src="/archives/d547a647/image-20210802105224250.png" style="zoom: 50%;"></p><p>è¿™å¯ä¸èƒ½å¿ï¼Œäºæ˜¯æˆ‘æ ¹æ® <a href="https://blog.csdn.net/qq_33505555/article/details/106046616">CSDN æ•™ç¨‹</a> ç»™é˜¿é‡Œäº‘æœåŠ¡å™¨é…ç½® SSL è¯ä¹¦ï¼Œä½¿ç”¨çš„æ˜¯ FreeSSL ä¸€ä¸ªæä¾›å…è´¹ https è¯ä¹¦ç”³è¯·çš„ç½‘ç«™</p><h3 id="ä½¿ç”¨-FreeSSL-ç”³è¯·è¯ä¹¦"><a href="#ä½¿ç”¨-FreeSSL-ç”³è¯·è¯ä¹¦" class="headerlink" title="ä½¿ç”¨ FreeSSL ç”³è¯·è¯ä¹¦"></a>ä½¿ç”¨ FreeSSL ç”³è¯·è¯ä¹¦</h3><p>è€è§„çŸ©ï¼Œå…ˆçœ‹çœ‹ <a href="https://blog.freessl.cn/tag/ssl-apply/">å®˜ç½‘æ•™ç¨‹</a></p><ol><li><p>ç”Ÿæˆ CSR <a href="https://cloud.tencent.com/document/product/400/5367">ä»€ä¹ˆæ˜¯ CSR ? è…¾è®¯äº‘æ–‡æ¡£</a></p><p>æ•™ç¨‹ä¸­æ¨èä½¿ç”¨ Keymanager ç”Ÿæˆ</p></li><li><p>åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸­é…ç½® DNS è§£æï¼Œå¹¶å¯¹é…ç½®è¿›è¡Œæ£€æµ‹å’ŒéªŒè¯</p><p>éªŒè¯æˆåŠŸåå¯ä»¥åœ¨ FreeSSL æ§åˆ¶å°ä¸­æŸ¥çœ‹è¯ä¹¦</p><p><img src="/archives/d547a647/image-20210802141326078.png" style="zoom:33%;"></p><p>åœ¨â€œæ›´å¤šæ“ä½œâ€ä¸­å¯ä»¥ä¸‹è½½è¯ä¹¦ï¼Œä¸€ä¸ª pem æ–‡ä»¶ï¼Œä¸€ä¸ª private.key</p><p><img src="/archives/d547a647/image-20210802141919162.png" style="zoom:33%;"></p></li><li><p>ç„¶åå°†è¯ä¹¦ .pem æ–‡ä»¶å¯¼å…¥åˆ° keymanager ä¸­</p><p><img src="/archives/d547a647/image-20210802170924734.png" style="zoom: 25%;"></p></li><li><p>è¿›è¡Œä¸€é”®éƒ¨ç½²ã€‚åŸºäºä½ è‡ªå·±çš„æ¡†æ¶ï¼Œé€‰æ‹©ä¸åŒçš„éƒ¨ç½²æ–¹æ³•ï¼Œæˆ‘é€‰æ‹©éƒ¨ç½²åˆ° Nginx ä¸Šã€‚è¿™é‡Œçš„â€œä¸€é”®éƒ¨ç½²â€å®è´¨ä¸Šå°±æ˜¯ä¸Šä¼ ä½ çš„è¯ä¹¦åˆ°æœåŠ¡å™¨ä¸Š</p><p><img src="/archives/d547a647/image-20210802171457165.png" style="zoom: 33%;"></p><p>éƒ¨ç½²æˆåŠŸè¿‡åï¼Œä½¿ç”¨ <a href="https://myssl.com/">myssl.com </a> æ£€æŸ¥ç½‘ç«™çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯å¦‚æœä½ çš„ Nginx é…ç½®ä¸å¯¹çš„è¯ï¼Œ</p></li><li><p>é…ç½® Nginx</p><p>ç°åœ¨æˆ‘ä»¬å¸Œæœ›é€šè¿‡ https 443 ç«¯å£æ¥æ‰“å¼€ç½‘ç«™ï¼Œä¸ä¹‹å‰ç›‘å¬ http 80 ç«¯å£ï¼Œæˆ‘ä»¬ç›‘å¬ 443 ç«¯å£ï¼Œç„¶åå°† 80 ç«¯å£é‡å®šå‘</p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>      <span class="token comment">#listen 80;</span>      <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span></span><span class="token punctuation">;</span>      <span class="token directive"><span class="token keyword">ssl</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>      <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/ssl/cert.pem</span><span class="token punctuation">;</span>      <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/ssl/key.pem</span><span class="token punctuation">;</span>      <span class="token directive"><span class="token keyword">server_name</span>  hongkun.space</span><span class="token punctuation">;</span>      <span class="token directive"><span class="token keyword">root</span>         /home/git/blog</span><span class="token punctuation">;</span>  ...  <span class="token punctuation">}</span>  <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>      <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>      <span class="token directive"><span class="token keyword">server_name</span> hongkun.space      <span class="token comment"># permenant redirect to https</span>      return <span class="token number">301</span> https://hongkun.space<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®å¥½è¿‡åé‡å¯ <code>nginx -s reload</code></p></li><li><p>ç°åœ¨è®¿é—®ç½‘ç«™ï¼Œæ—è¾¹å°±æœ‰é«˜è´µçš„<span class="github-emoji"><span>ğŸ”’</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f512.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p><p><img src="/archives/d547a647/image-20210802173016910.png" style="zoom:50%;"></p><p>éƒ¨ç½²æˆåŠŸè¿‡åï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <a href="https://myssl.com/">myssl.com </a> æ£€æŸ¥ç½‘ç«™çš„å®‰å…¨æ€§</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶ </category>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> é˜¿é‡Œäº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CS231N Assignment2 ç¬”è®°</title>
      <link href="/archives/407bb789.html"/>
      <url>/archives/407bb789.html</url>
      
        <content type="html"><![CDATA[<h1 id="cs231n-2021-Assignment-2-note"><a href="#cs231n-2021-Assignment-2-note" class="headerlink" title="cs231n 2021 Assignment 2 note"></a>cs231n 2021 Assignment 2 note</h1><h2 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h2><p>assignment æ¨¡æ¿: <a href="https://github.com/cs231n/cs231n.github.io">github</a> </p><p>å®˜æ–¹: <a href="https://cs231n.github.io/assignments2021/assignment2/">è¯¾ç¨‹é“¾æ¥</a></p><p>assignment å‚è€ƒé“¾æ¥: <a href="https://github.com/amanchadha/stanford-cs231n-assignments-2020">2020</a></p><p>å‘ç°äº†ä¸€ç§æ–°çš„æ¨¡å¼: pycharm + git + anaconda &amp; jupyter</p><p>ä¸Šé¢çš„ç»„åˆèƒ½å¤Ÿå¸®åŠ©å†™ä»£ç çš„æ•ˆç‡æå‡ï¼Œpycharm èƒ½å¤Ÿå¸®åŠ©è°ƒè¯•ï¼Œgit ç”¨äºç‰ˆæœ¬ç®¡ç†ï¼Œconda ç”¨äºç¯å¢ƒç®¡ç†ã€‚jupyter åœ¨æµ‹è¯•ä»£ç å—ä¸Šæœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”å¾ˆå¤š cs231n çš„ä½œä¸šå½¢å¼éƒ½æ˜¯ä»¥ ipynb çš„æ–‡ä»¶ç±»å‹å‘å¸ƒï¼Œæ›´é€‚åˆåœ¨ jupyter ä¸Šæ‰“å¼€ï¼Œè€Œä¸” jupyter èƒ½å¤Ÿç›´æ¥ä½¿ç”¨åˆ›å»ºå¥½çš„ conda ç¯å¢ƒï¼Œç‰¹åˆ«æ–¹ä¾¿</p><p>ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œæœ€ç»ˆå†³å®šä½¿ç”¨ vs code æ›¿æ¢ pycharmï¼ŒåŸå› æ˜¯ vs code æœ‰ jupyter notebook æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥æ˜¾ç¤ºåœ¨ editor å†…ï¼Œæ¯” Pycharm æ›´æ–¹ä¾¿è€Œä¸”ä»¥åæƒ³è¦å­¦ä¹ å…¶ä»–è¯­è¨€ vs code ä¼˜åŠ¿æ›´å¤§</p><h2 id="è¿‡ç¨‹ä¸­çš„ç¼–ç¨‹å¤ä¹ "><a href="#è¿‡ç¨‹ä¸­çš„ç¼–ç¨‹å¤ä¹ " class="headerlink" title="è¿‡ç¨‹ä¸­çš„ç¼–ç¨‹å¤ä¹ "></a>è¿‡ç¨‹ä¸­çš„ç¼–ç¨‹å¤ä¹ </h2><ol><li><p>é‡æ–°å¤ä¹ äº† numpy çš„ä¸€äº›ç”¨æ³•ï¼Œä¸€ä¸ªé‡è¦æ€æƒ³å°±æ˜¯å°½é‡å°‘è€ƒè™‘ä½¿ç”¨å¾ªç¯è§£å†³ï¼Œè¦ä»¥ index ç´¢å¼•æ€æƒ³æ¥è§£å†³æ•°æ®çš„æ“ä½œé—®é¢˜ã€‚</p><p>reshapeå·²ç»å­˜åœ¨çš„shape</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>b<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å½“æ¥å—å‚æ•°æ˜¯å…ƒç»„è€Œæ˜¯å¯å˜å‚æ•° <em>args çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨ </em>tuple æ¥å°†å‚æ•°å˜ä¸º *args</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token operator">*</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¦å­¦ä¼šå–„ç”¨çŸ©é˜µç‚¹ä¹˜ A * Bï¼Œæ˜¯å°†å¯¹åº”å…ƒç´ ç›¸ä¹˜ï¼Œåœ¨è®¡ç®—æ¨¡çš„æ—¶å€™ï¼Œæˆ–è€…å½“å…¶ä¸­ä¸€ä¸ªæ˜¯ indication function æ—¶å¾ˆæœ‰ç”¨</p></li><li><p>é‡æ–°å¤ä¹ äº†å­—å…¸çš„ç”¨æ³•ï¼Œæ ¸å¿ƒæ˜¯åˆ›é€ å­—å…¸ï¼Œdict(), dict.fromkeys()</p><p>å­—å…¸çš„ key, val è¿­ä»£å™¨ï¼Œå¦‚æœä¸ç”¨ itemsï¼Œåˆ™åªæœ‰ key</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> key<span class="token punctuation">,</span> val <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>pas<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>å¯¹äºæ ¼å¼åŒ–å­—ç¬¦ä¸²æœ‰æ–°çš„è®¤çŸ¥ï¼Œä¸‹é¢ä¾‹å­</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>self<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'b%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> weight_scale <span class="token operator">*</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>hd<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¯ä»¥ç”¨è¿™æ ·çš„å½¢å¼æ¥è°ƒç”¨ key</p></li></ol><h2 id="Fully-Connected-Networks"><a href="#Fully-Connected-Networks" class="headerlink" title="Fully Connected Networks"></a>Fully Connected Networks</h2><ol><li>å¯¹äºç½‘ç»œçš„è®¤çŸ¥æœ‰äº†æ›´æ–°ã€‚è¦æŠŠå±‚(layer, w)å’Œç‚¹(node, x)åˆ†å¼€æ¥çœ‹ï¼Œè¿™æ ·ç½‘ç»œç»“æ„æ‰æ›´æ¸…æ™°ã€‚ä¸€èˆ¬éšè—å±‚ä¸åŒ…å«è¾“å‡ºå±‚</li><li><strong>åå‘ä¼ æ’­ç†Ÿæ‚‰ back propagationï¼Œå°¤å…¶æ˜¯çŸ©é˜µç›¸ä¹˜çš„åå‘ä¼ æ’­ï¼Œåªéœ€è¦è®°ä½ç»“è®ºå°±è¡Œäº†ã€‚å¯¹äºå¹¿æ’­è¿‡åçš„ç»“æœï¼Œéœ€è¦å°†å¹¿æ’­çš„çŸ©é˜µä½œ sum å¤„ç†ï¼Œå¾—åˆ°å¹¿æ’­å‰çš„å¯¹åº”å…ƒç´ æ¢¯åº¦</strong></li><li>5 layers å’Œ 3 layers ç½‘ç»œä¼˜åŒ–æ—¶æ¯”è¾ƒï¼Œå·®å¼‚åœ¨å“ªé‡Œï¼Ÿ5 layer æ›´éš¾ä¼˜åŒ–ï¼Œå¯¹äºåˆå§‹å€¼æ•æ„Ÿ</li><li><strong>å¯¹äºä¼˜åŒ–ç®—æ³•è¿›è¡Œäº†è¿›ä¸€æ­¥äº†è§£ï¼Œç”±ä¸‰ä¸ªæ ¸å¿ƒç‚¹ï¼šAdaGrad, Momentum, EWA æœ€åè‡ªç„¶æ¨å‡º Adam ä¼˜åŒ–ç®—æ³•</strong></li><li><strong>åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™é‡è¦çš„ç‰ˆæœ¬éœ€è¦ä¿å­˜ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ git</strong></li></ol><h2 id="Batch-normalization"><a href="#Batch-normalization" class="headerlink" title="Batch normalization"></a>Batch normalization</h2><p>è¿›ä¸€æ­¥æ¸…æ™°äº† bn çš„è¿‡ç¨‹ä¸ä½œç”¨ï¼Œå¯ä»¥å›çœ‹è‡ªå·±çš„ç¬”è®°äº†è§£è¯¦æƒ…</p><h3 id="Inline-Question-1"><a href="#Inline-Question-1" class="headerlink" title="Inline Question 1"></a>Inline Question 1</h3><p><strong>How does the scale of weight initialization affect models with/without batch normalization differently, and why?</strong></p><p>You should find that using batch normalization helps the network to converge much faster. </p><p>ä½¿ç”¨ batch normalization ä¼šè®©ç½‘ç»œåœ¨è®­ç»ƒé›†ä¸Šæ”¶æ•›æ›´å¿«ã€‚è¿™å’Œæ™®é€šçš„ normalization æ˜¯ä¸€ä¸ªé“ç†ï¼Œå‡å°‘ zigzag æ‹å¼¯</p><p>è¿˜æœ‰å‡ ä¸ªéœ€è¦çŸ¥é“å’Œç†è§£çš„ç‚¹æ˜¯ï¼š</p><ol><li>batch normalization å¸®åŠ©ç¼“è§£æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸çš„é—®é¢˜ï¼Œè¿™å°†å‡ç¼“å› ä¸º weight initialization è¿‡å¤§æˆ–è¿‡å°è€Œäº§ç”Ÿæ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸çš„é—®é¢˜</li><li>batch normalization æœ‰ä¸€å®šçš„æ­£åˆ™åŒ–æ•ˆæœï¼Œé¿å…è¿‡æ‹Ÿåˆ</li></ol><p><img src="/archives/407bb789/image-20210707160726541.png" style="zoom: 67%;"></p><h3 id="Inline-Question-2"><a href="#Inline-Question-2" class="headerlink" title="Inline Question 2"></a>Inline Question 2</h3><p><strong>hat does this imply about the relationship between batch normalization and batch size? Why is this relationship observed?</strong></p><p>ä¸€èˆ¬è§„å¾‹æ˜¯ï¼šbatch size è¶Šå¤§è®­ç»ƒé›†ä¸Šæ”¶æ•›è¶Šå¿«ã€‚å½“ batch size æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œæ¯” baseline é€Ÿåº¦æ›´æ…¢ï¼ŒåŸå› åœ¨äºè¿‡å°‘çš„æ ·æœ¬å¸¦æ¥çš„åå·®å¤ªå¤§ï¼Œè¿™æ ·çš„å™ªéŸ³ä¼šå½±å“è®­ç»ƒå’Œæµ‹è¯•è¡¨ç°</p><p><img src="/archives/407bb789/image-20210707164225500.png" style="zoom: 67%;"></p><p>åœ¨è®­ç»ƒå’Œæµ‹è¯•æ—¶å‡ä¼šç”¨åˆ° bn layerï¼Œæµ‹è¯•æ—¶ç”¨çš„ $\mu,\sigma$  å‚æ•°æ˜¯è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ•°åŠ æƒå¹³å‡ EWA</p><h3 id="Layer-Normalization"><a href="#Layer-Normalization" class="headerlink" title="Layer Normalization"></a>Layer Normalization</h3><p>ç”¨åœ¨ RNN ä¸­æ›´å¤šï¼Œå¦‚æœä»¥åæ¥è§¦ NLP é¢†åŸŸçš„è¯å†æ·±å…¥æ•´ç†ã€‚ç®€å•çš„è§£é‡Š <a href="https://zhuanlan.zhihu.com/p/74516930">çŸ¥ä¹é“¾æ¥</a> </p><p>å‡è®¾æˆ‘ä»¬æœ‰ 10è¡Œ 3åˆ— çš„æ•°æ®ï¼Œå³æˆ‘ä»¬çš„batchsize = 10ï¼Œæ¯ä¸€è¡Œæ•°æ®æœ‰ä¸‰ä¸ªç‰¹å¾ï¼Œè¿™æ˜¯ä¸€ç§â€œåˆ—ç¼©æ”¾â€ã€‚</p><p>è€Œlayeræ–¹å‘ç›¸åï¼Œå®ƒé’ˆå¯¹çš„æ˜¯æ¯ä¸€è¡Œè¿›è¡Œç¼©æ”¾ã€‚å³åªçœ‹ä¸€ç¬”æ•°æ®ï¼Œç®—å‡ºè¿™ç¬”æ‰€æœ‰ç‰¹å¾çš„å‡å€¼ä¸æ–¹å·®å†ç¼©æ”¾ã€‚è¿™æ˜¯ä¸€ç§â€œè¡Œç¼©æ”¾â€ã€‚</p><p>Q: ä¸ºä»€ä¹ˆ gamma å’Œ beta è¿˜æ˜¯åŸæ¥çš„ (D, ) å½¢çŠ¶ï¼ŸLayer normalization åœ¨ RNN ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p><p><img src="/archives/407bb789/image-20210707200112133.png" style="zoom: 67%;"></p><p>çœ‹å¾—å‡º layer normalization åœ¨è®­ç»ƒä¸Šä¹Ÿæ˜¯æœ‰ä¸€å®šä½œç”¨çš„ï¼Œä½†åœ¨å›¾åƒæ–¹é¢ç›¸æ¯”äº batch normalization æ•ˆæœå·®ä¸€ç‚¹ï¼Œå¦ä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„ç»“æœæ˜¯ï¼Œå¯¹äº layer normalization æ¥è¯´ hidden dimension å–è¾ƒå¤§å€¼è¾ƒå¥½</p><h2 id="Drop-out"><a href="#Drop-out" class="headerlink" title="Drop out"></a>Drop out</h2><p>ä¸¤è¡Œä»£ç è§£å†³ (inverted) dropout layer æ ¸å¿ƒ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">mask <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">input</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">&lt;</span> poutput <span class="token operator">=</span> <span class="token builtin">input</span> <span class="token operator">*</span> mask <span class="token operator">/</span> p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>vallina dropout æ˜¯åœ¨ test æ—¶å°†è¾“å‡ºä¹˜ä»¥ p ä½¿å¾—è¾“å‡ºæ˜¯ä¸€ä¸ªåˆç†æœŸæœ›å€¼ã€‚ä½†å¦‚æœæˆ‘ä»¬åœ¨è®­ç»ƒçš„æ—¶å€™å·²ç»é™¤ä»¥ p äº†ï¼Œåœ¨æµ‹è¯•æ—¶å°±ä¸éœ€è¦ä½œä»»ä½•æ“ä½œã€‚ä¸‹å›¾ä¸ºæ­£åˆ™åŒ–æ•ˆæœ regularization</p><p><img src="/archives/407bb789/image-20210708160433242.png" style="zoom:67%;"></p><h2 id="Convolutional-Neural-Networks"><a href="#Convolutional-Neural-Networks" class="headerlink" title="Convolutional Neural Networks"></a>Convolutional Neural Networks</h2><ol><li><p>ç”¨åµŒå¥—å¾ªç¯å®ç°äº†æœ€åŸå§‹çš„å·ç§¯æ“ä½œï¼Œä½¿ç”¨ np.pad å‡½æ•°èƒ½å®ç° padding æ“ä½œï¼Œæ„Ÿè§‰è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¸æ˜¯é‚£ä¹ˆçµæ´»</p></li><li><p>è¿”å›æœ€å¤§å€¼åæ ‡ np.argmaxï¼Œå¦‚æœæƒ³è¦è¿”å›å¤šå…ƒåæ ‡è¿˜éœ€è¦ä½¿ç”¨ np.unravel_index è½¬åŒ–</p><p><code>np.unravel(indices, shape)</code></p></li><li><p>assignment æä¾›äº† fast_layers.py æ¥å®ç°å¿«é€Ÿå·ç§¯æ“ä½œï¼Œæ¯”æˆ‘è‡ªå·±å†™çš„å¾ªç¯ä»£ç è¦å¿« 1000 å¤šå€ï¼Œä½¿ç”¨äº† im2col æŠ€å·§ä»¥åŠ Cpython extension</p></li><li><p>ä¸ºä»€ä¹ˆåœ¨æ­£åˆ™åŒ–çš„æ—¶å€™æ­£åˆ™é¡¹ä¸­ä¸åŒ…æ‹¬åå·® b? ä¸ªäººç†è§£è®¤ä¸º b å¯¹äºæ­£åˆ™åŒ–çš„è´¡çŒ®å¹¶ä¸å¤§ï¼Œè€Œ w å‚æ•°åˆ™å æ®äº†ç»å¤§éƒ¨åˆ†çš„å‚æ•°ã€‚</p></li></ol><h3 id="Spatial-Batch-Normalization"><a href="#Spatial-Batch-Normalization" class="headerlink" title="Spatial Batch Normalization"></a>Spatial Batch Normalization</h3><p>è¿™æ˜¯å·ç§¯ç¥ç»ç½‘ç»œç‰¹æœ‰çš„ batch normalizationã€‚ä¹‹å‰ä½¿ç”¨çš„ batch normalization é¢å¯¹çš„æ˜¯ (N, D) å½¢çŠ¶çš„æ•°æ®ï¼Œä½†å·ç§¯è¿‡åå¾—åˆ°çš„è¾“å‡ºæ˜¯ç±»ä¼¼ (N, C, H, W) è¿™æ ·çš„å¤šç»´æ•°æ®ã€‚é‚£æˆ‘ä»¬åº”è¯¥æ€æ ·å»è®¡ç®—è¿™ä¸€æ‰¹æ•°æ®çš„ç»Ÿè®¡é‡ $\mu, \sigma$ å‘¢ï¼Ÿ</p><p>å¦‚æœæ²¿ç€ä¹‹å‰çš„æ€ç»´ï¼Œæˆ‘ä»¬åªæ²¿ç€æ ·æœ¬æ•°æ®è½´ N å»è®¡ç®— $\mu, \sigma$ </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># data.shape = (N, C, H, W)</span>mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>var  <span class="token operator">=</span> np<span class="token punctuation">.</span>var<span class="token punctuation">(</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™å°†ä¼šå¾—åˆ° (C, H, W) å½¢çŠ¶çš„ç»Ÿè®¡é‡ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå€¼ (c, h, w)ï¼Œå…¶æ ·æœ¬æ¥è‡ªäº N ä¸ªåƒç´ ç‚¹ï¼ˆåŒä¸€ channelï¼ŒåŒä¸€ä½ç½®ï¼‰ã€‚ä½†æˆ‘ä»¬å¸Œæœ›æ ·æœ¬çš„æ•°é‡æ›´å¹¿æ³›ä¸€äº›ï¼Œå…·ä½“ä¸€ç‚¹æ¥è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æ ·æœ¬æ¥è‡ªäº N ä¸ª feature map (H, W)ï¼Œç”¨ numpy è¡¨ç¤ºä¸º</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># data.shape = (N, C, H, W)</span>mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>var <span class="token operator">=</span> np<span class="token punctuation">.</span>var<span class="token punctuation">(</span>data<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™å°†ä¼šå¾—åˆ° (C,) å½¢çŠ¶çš„ç»Ÿè®¡é‡ï¼Œå³ï¼šå¾—åˆ°äº†å¯¹äºæŸä¸€ä¸ª channel çš„ç»Ÿè®¡é‡ï¼Œè¿™æ˜¯åˆç†çš„ï¼Œå› ä¸ºåŒä¸€ä¸ª channel æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ª kernelã€‚è¿™æ ·æˆ‘ä»¬ä¸ä»…å¾—åˆ°äº†æ›´å¹¿æ³›æ ·æœ¬çš„ç»Ÿè®¡é‡ï¼Œè¿˜å‡å°‘äº†å‚æ•°æ•°é‡</p><p>å¦‚æœè¦ä½¿ç”¨ä¹‹å‰å†™çš„ batch_norm å‡½æ•°çš„è¯å¯ä»¥å°†æ•°æ®è½¬åŒ–ä¸º (N <em> H </em> W, C) ï¼Œåœ¨ numpy ä¸­ä½¿ç”¨ transpose + reshape å°±å¯ä»¥å®Œæˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">data<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> C<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Spatial-Group-Normalization"><a href="#Spatial-Group-Normalization" class="headerlink" title="Spatial Group Normalization"></a>Spatial Group Normalization</h3><p>ä¸€å¼ å›¾å±•ç¤ºBatch Normï¼Œ Layer Norm ï¼ŒGroup Normçš„åŒºåˆ«</p><p><img src="/archives/407bb789/image-20210710193505933.png" alt="image-20210710193505933"></p><p>Group Normå¯ä»¥ç†è§£ä¸ºåœ¨layer Normçš„åŸºç¡€ä¸Šï¼Œè¾“å…¥ç»´åº¦ä¸º (N, C, H, W)ï¼Œå¯¹Cè¿›è¡Œåˆ†ç»„ï¼Œå³ (N, G, C//G, H, W)ã€‚ä¸ºäº†å®Œæˆè¿™ä¸€éƒ¨åˆ†ï¼Œé‡æ–°æ€è€ƒäº†å¦‚ä½•åŸºäºç³»ç»Ÿè®¡ç®— back propagation</p><p><strong>å¯ä»¥ä»¥é‡è¦çš„ä¸­é—´å˜é‡ä¸ºèŠ‚ç‚¹ï¼Œæ ¹æ®è®¡ç®—å›¾é€æ­¥æ¨å¯¼æ¢¯åº¦ã€‚éš¾ç‚¹åœ¨äºæœ‰çŸ©é˜µå‚ä¸çš„è®¡ç®—ï¼Œç»å¸¸ä¼´éšç€çŸ©é˜µå½¢çŠ¶çš„æ”¹å˜ï¼Œåœ¨è¿›è¡Œ back propagation ä¸­ä¸€å®šè¦è®©æ¢¯åº¦è·Ÿç€è¿™äº›è®¡ç®—è¿›è¡Œå‡ç»´å’Œé™ç»´ï¼Œå¯ä»¥æƒ³è±¡ä¸ºæ¢¯åº¦ä¼šéšç€è¿™äº›èŠ‚ç‚¹å½¢çŠ¶çš„å˜åŒ–è¿›è¡Œå¤æ‚çš„æµåŠ¨ï¼Œæœ‰åˆ†æµ(ä¾‹å¦‚é™ç»´åº¦)ï¼Œä¹Ÿæœ‰æ±‡åˆ(ä¾‹å¦‚ broadcast)</strong></p><p>ä¾‹å¦‚ï¼Œåœ¨ forward pass ä¸­ broadcast ä¼šå°†çŸ©é˜µå‡ç»´ï¼Œsum ä¼šå°†çŸ©é˜µé™ç»´ï¼Œå¦‚æœåœ¨ backward pass ä¸­é‡åˆ° broadcast æ“ä½œæ—¶ï¼Œåˆ™éœ€è¦å°† upper_grad æ ¹æ®å¯¹åº”ç»´åº¦æ±‚å’Œï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬è¦æ±‚ä¸‹é¢ X çš„æ¢¯åº¦çš„è¯ï¼Œä»£ç åº”è¯¥æ—¶è¿™æ ·çš„</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># input: X, X.shape = (N, D)</span><span class="token comment"># f(X) = X - np.mean(X)</span><span class="token comment"># upper_grad = dout, dout.shape = (N, D)</span>dmean <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>dout<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment"># sum broadcast dimension</span>dmean <span class="token operator">=</span> dmean <span class="token operator">/</span> N<span class="token comment"># mean operation back prop</span>dX <span class="token operator">=</span> dout <span class="token operator">-</span> dmean<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæƒ³ä¸ä½¿ç”¨è®¡ç®—å›¾ç›´æ¥æŒ‰ç…§ä¸€èˆ¬çš„çŸ©é˜µæ¢¯åº¦è®¡ç®—ï¼Œé‡åˆ°å¯¹çŸ©é˜µ/å‘é‡æ±‚å¯¼æ—¶ï¼Œå°±ä¼šå‡ºç°å¼ é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ç»´åº¦ä¼šå¢åŠ ï¼Œéœ€è¦ç†Ÿæ‚‰å¼ é‡çš„è¿ç®—åŠå…¶æ€ç»´ã€‚è¿˜æ˜¯å€Ÿç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œä½†æˆ‘ä»¬æŠŠå¹³å‡å€¼ä½œä¸º (N, D) å½¢çŠ¶æ¥çœ‹å¾…</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># input: X, X.shape = (N, D)</span><span class="token comment"># f(X) = X - np.mean(X) * np.ones(X.shape)</span><span class="token comment"># upper_grad = dout, dout.shape = (N, D)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><script type="math/tex; mode=display">\frac{\partial{loss}}{\partial{f(x)}} = doutï¼Œ\ f(x)=x-\mu\\\frac{\partial{f(x)}}{\partial{\mu}} = a\ ((N\times D) \times (N\times D))\ shape\ tensor\\\frac{\partial{loss}}{\partial{\mu}}=\frac{\partial{loss}}{\partial{f(x)}} Â·\frac{\partial{f(x)}}{\partial{\mu}}=dout\\\frac{\partial{\mu}}{\partial{x}} = a\ ((N\times D) \times (N\times D))\ shape\ tensor\\\frac{\partial{loss}}{\partial{x}}=\frac{\partial{loss}}{\partial{f(x)}}Â·\frac{\partial{f(x)}}{\partial{x}} - \frac{\partial{loss}}{\partial{f(x)}}Â·\frac{\partial{f(x)}}{\partial{\mu}}Â·\frac{\partial{\mu}}{\partial{x}}=dout -doutÂ·\frac{\partial{\mu}}{\partial{x}}</script><p>è¿™å°†æ˜¯ä¸€ç§æ™®é€‚çš„æ–¹æ³•ï¼Œæ›´åŠ æŠ½è±¡åŒ–ï¼Œèƒ½å¤Ÿå¤„ç†ä»»ä½•çš„çŸ©é˜µæ±‚å¯¼ï¼Œä½†ä¸æ¨èå®é™…ä¸­ä½¿ç”¨ã€‚</p><p>ä¸è®ºä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œæœ€æ ¸å¿ƒçš„è¿˜æ˜¯è¦ç†è§£æ¢¯åº¦æµåŠ¨çš„æœ¬è´¨â€”â€”æŸä¸€ä¸ªå˜é‡çš„å˜åŠ¨èƒ½å¤Ÿå¼•èµ·è¾“å‡ºå¤šå°‘å˜åŠ¨</p><h2 id="BUG"><a href="#BUG" class="headerlink" title="BUG"></a>BUG</h2><h3 id="Fully-Connected-Layer"><a href="#Fully-Connected-Layer" class="headerlink" title="Fully Connected Layer"></a>Fully Connected Layer</h3><p>ç°åœ¨å¡åœ¨äº† solver ä¸Š</p><p>ä¸èƒ½å¾—åˆ° overfitting çš„ç»“æœ</p><ol><li><p>å°è¯•æ›´æ¢ solver çœ‹èƒ½å¦å¾—åˆ°ä¸ä¸€æ ·çš„ç»“æœ</p><p>å¤±è´¥äº†</p></li><li><p>å°è¯•ä½¿ç”¨2016çš„æ‰€æœ‰ç­”æ¡ˆï¼Œçœ‹æ˜¯å¦æ˜¯è‡ªå·±çš„ä»£ç å‡ºé—®é¢˜äº†</p><p>å¤±è´¥äº†</p><p>å°æŠ€å·§ Ctrl+r èƒ½å¤Ÿæ›´æ¢ pycharm ç›¸åŒå­—æ®µ</p></li><li><p>å°è¯•æ›´æ”¹ colab æœ¬èº«çš„æ–‡ä»¶ï¼Œä½¿ç”¨2016å¹´çš„colabæ–‡ä»¶</p><p>æˆåŠŸï¼ŒåŸå› åœ¨äº learning rate å¤ªå°äº†ï¼Œä¸èƒ½æ‰¾åˆ°å…¨å±€æœ€ä¼˜</p></li></ol><h3 id="Batch-normalization-1"><a href="#Batch-normalization-1" class="headerlink" title="Batch normalization"></a>Batch normalization</h3><ol><li><p>å¡åœ¨äº†è®¡ç®— back prop ä¸Š</p><p>æœ€åå‡ºç°çš„å¤±è¯¯è¿˜æ˜¯åœ¨äºæ¯ä¸€ä¸ªå…¬å¼å¿…é¡»è¦ç²¾ç¡®æ‰è¡Œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">norm_x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> sample_mean<span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>sample_var <span class="token operator">+</span> eps<span class="token punctuation">)</span>norm_x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> sample_mean<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>sample_var<span class="token punctuation">)</span> <span class="token operator">+</span> eps<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸Šé¢ä¸¤ä¸ªå¼å­è™½ç„¶åœ¨è®¡ç®—ç»“æœä¸Šç›¸å·®ä¸å¤šï¼Œä½†æ˜¯åœ¨ç½‘ç»œçš„è®¡ç®—ä¸­ï¼Œä¸€ç‚¹ç‚¹çš„è¯¯å·®ä¼ æ’­è¿‡åä¼šå˜å¾—è¶Šæ¥è¶Šå¤§</p></li><li><p>å°è¯•ä½¿ç”¨ jupyter è¿›è¡Œç¼–ç¨‹ï¼Œé‡åˆ°é—®é¢˜ï¼šThe kernel appears to have died. It will restart automatically</p><p>ä»¥ä¸ºæ˜¯ jupyter çš„é—®é¢˜ï¼Œä½†æµ‹è¯•äº†ä¸åŒçš„è½¯ä»¶éƒ½å‡ºé”™äº†ï¼Œæœ€ç»ˆå‘ç°æ˜¯è‡ªå·±ä»£ç çš„é—®é¢˜ï¼å½“æ‰¾äº†ä¸€åœˆæ²¡æœ‰æ‰¾åˆ°ç­”æ¡ˆæ—¶ï¼Œå¯èƒ½å°±è¦æ€€ç–‘è‡ªå·±äº†ï¼Œè€Œä¸æ˜¯æ€€ç–‘è½¯ä»¶å‡ºäº†é—®é¢˜ï¼ä¸è¿‡è¿™ä¹Ÿæœ‰å¥½å¤„ï¼Œè®©æˆ‘å†³å®šæ”¾å¼ƒä½¿ç”¨ pycharm è½¬æˆ˜ vs code</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> è¯¾ç¨‹ </category>
          
          <category> CS231N </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CS231N </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux/Windows å®‰è£…ç¬”è®°</title>
      <link href="/archives/53e3a160.html"/>
      <url>/archives/53e3a160.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="Install-Linux-Subsystem"><a href="#Install-Linux-Subsystem" class="headerlink" title="Install Linux Subsystem"></a>Install Linux Subsystem</h2><p>å®‰è£…ä¸€ä¸ªåŒç³»ç»Ÿå¯èƒ½å¯¹äºåˆå­¦è€…æ¥è®²æ˜¯æ¯”è¾ƒå‹å¥½çš„ï¼Œéšç€å¯¹ Linux çš„äº†è§£è¶Šæ¥è¶Šå¤šï¼Œæ›´å¤šçš„ Linux ä½¿ç”¨è½¬ç§»åˆ°äº†æœåŠ¡å™¨ä¸Šï¼Œå¯¹åŒç³»ç»Ÿçš„éœ€æ±‚è¶Šæ¥è¶Šå°‘ã€‚å¹¶ä¸” windows ç°åœ¨æ”¯æŒäº† linux å­ç³»ç»Ÿï¼ˆWSLï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ dockerï¼Œè¿™æ ·å®‰è£…åŒç³»ç»Ÿå°±æ˜¾å¾—æ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„é€‰é¡¹äº†ã€‚æˆ‘ä¹‹å‰å°±ç®—å®‰è£…äº†åŒç³»ç»Ÿï¼Œç°åœ¨ä¹Ÿå°†å…¶åˆ é™¤äº†ï¼Œé‡Šæ”¾äº† 100G ç©ºé—´ï¼Œåˆ é™¤å‚è€ƒï¼š<a href="https://www.bilibili.com/video/BV1Ba411z75z/">bilibili</a>ï¼Œå†è´´ä¸€ä¸ª <a href="https://docs.microsoft.com/en-us/windows/wsl/install">WSL</a> å®˜ç½‘</p><p>è¿™ä¸ª up çš„ç³»åˆ—è§†é¢‘éƒ½æ•™å¾—éå¸¸å¥½,ï¼š<a href="https://www.bilibili.com/video/BV1aA411s7PJ">bilibili</a>ï¼Œæ•™ä½ å¦‚ä½•å®‰è£…æ¼‚äº®çš„ WSLï¼Œé…åˆ vscode + zsh å˜ä¸ºå¼ºåŠ›å¼€å‘ç¯å¢ƒï¼Œä¸‹é¢ç®€è¦æ€»ç»“ zsh çš„å®‰è£…ï¼š</p><ol><li><p>å®‰è£… zsh <code>sudo apt install zsh</code></p></li><li><p>æ ¹æ® <a href="https://github.com/ohmyzsh/ohmyzsh">ohmyzsh</a> é¡¹ç›®è¿›è¡Œå®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨ç½‘ç»œå®‰è£…ï¼š</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">bash</span> -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">wget</span> -O- https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span class="token variable">)</span></span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¹Ÿå¯ä»¥æŠŠä¸Šé¢é“¾æ¥ä¸­çš„è„šæœ¬å¤åˆ¶ä¸‹æ¥ï¼Œä¿å­˜ä¸º <code>install.sh</code>ï¼Œç„¶åæ‰§è¡Œ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sh</span> install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å®‰è£…æ’ä»¶ã€‚æ’ä»¶æ¨è <a href="https://github.com/zsh-users/zsh-autosuggestions">zsh-autusuggestions</a>ï¼ŒæŠŠè¿™ä¸ªé¡¹ç›® clone åˆ° <code>~/.oh-my-zsh/custom/plugins</code> ä¸­</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> ~/.oh-my-zsh/custom/plugins<span class="token function">git</span> clone https://github.com/zsh-users/zsh-autosuggestions.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶ååœ¨ <code>~/.zshrc</code> é‡Œé…ç½® plugin</p><pre class="line-numbers language-.zshrc" data-language=".zshrc"><code class="language-.zshrc">plugins=(git zsh-autosuggestions)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h2 id="Install-Ubuntu"><a href="#Install-Ubuntu" class="headerlink" title="Install Ubuntu"></a>Install Ubuntu</h2><p>ï¼ˆå¦‚æœä»éœ€è¦ï¼‰å®‰è£…åŒç³»ç»Ÿï¼šç§»æ­¥ <a href="https://www.bilibili.com/video/BV18W41137XB">bilibili</a>ï¼ˆå»ºè®®å®‰è£…æœ€æ–°ç‰ˆï¼Œç¾è§‚ä¸”ä½“éªŒæ›´å‹å¥½ï¼‰æˆ–è€…é˜…è¯» <a href="https://ubuntu.com/tutorials/install-ubuntu-desktop#1-overview">ubuntu å®˜æ–¹æ•™ç¨‹</a></p><h2 id="Common-Settings"><a href="#Common-Settings" class="headerlink" title="Common Settings"></a>Common Settings</h2><ol><li><p>è®¾ç½® root å¯†ç ã€‚ç„¶ååˆ›å»ºæ–°ç”¨æˆ·ï¼Œå¹¶è®¾ç½®æ–°ç”¨æˆ·å¯†ç ä»¥åŠ sudo æƒé™ <code>/etc/sudoers</code> </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">username <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ä¿®æ”¹ /etc/hostnameï¼Œreboot åæ°¸ä¹…æ›´æ”¹ä¸»æœºå</p></li><li><p>å¯èƒ½å‡ºç°å¯åŠ¨ windows çš„æ—¶å€™æœ‰ bitlockerï¼Œç¦ç”¨ bitlocker å®‰å…¨åè®®</p></li><li><p>é…ç½®ä»£ç† clashï¼Œä» youtube ä¸Šå­¦çš„ï¼ˆè¿·é€”å°ä¹¦ç«¥ï¼‰ï¼Œè¦ç‚¹å°±æ˜¯å°†é…ç½®æ–‡ä»¶ config.yaml å’Œ Country.mmdb ç§»åŠ¨åˆ° ~/.config/clash æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œé…ç½®æ–‡ä»¶é€šè¿‡ clash for windows ç”Ÿæˆï¼Œæ–‡ä»¶ç›®å½•ä¸º User/.config/clash(/profiles) ã€‚é€šè¿‡ clash dashboard åˆ‡æ¢èŠ‚ç‚¹ <a href="http://clash.razord.top/">http://clash.razord.top/</a></p><p>è®©Terminalèµ°ä»£ç†çš„æ–¹æ³•(desktopä¸Šçš„settingsä¸­è®¾å®šä¼šæ”¹å†™terminalç«¯ï¼Œä½¿ç”¨exportæ”¹å†™åˆ™ä¸ä¼šå½±å“desktop)ï¼Œå‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/46973701">çŸ¥ä¹é“¾æ¥</a></p></li><li><p>å®˜ç½‘ä¸‹è½½git anaconda chrome typora chrome baiduyun vscodeè½¯ä»¶å¹¶å®‰è£…</p><p>conda install, pip install ä¸‹è½½é€Ÿåº¦æ…¢æ—¶ï¼Œè¯·ä½¿ç”¨å›½å†…é•œåƒæºï¼Œä¾‹å¦‚ï¼š</p><ol><li><a href="https://mirrors.bfsu.edu.cn/help/anaconda/">åŒ—äº¬å¤–å›½è¯­å¤§å­¦é•œåƒæº</a>ï¼ˆæˆªè‡³2021/6/15ä¸‹è½½é€Ÿåº¦å¾ˆå¿«ï¼‰</li><li><a href="https://mirror.tuna.tsinghua.edu.cn/help/anaconda/">æ¸…åå¤§å­¦é•œåƒæº</a></li><li><a href="https://mirror.nju.edu.cn/help/anaconda">å—äº¬å¤§å­¦é•œåƒæº</a>ï¼ˆå—å¤§æœ¬å®¶æ¨èï¼‰</li></ol></li><li><p>é…ç½® nvidia driver: æ ¹æ® <a href="https://zhuanlan.zhihu.com/p/59618999">çŸ¥ä¹é“¾æ¥</a> ï¼Œåœ¨å‘½ä»¤è¡Œé‡Œä¸‹è½½æ¨èçš„driverã€‚å¦‚æœåœ¨é…ç½® nvidia driver çš„è¿‡ç¨‹ä¸­å‡ºç°è¿æ¥ä¸ä¸Šæ˜¾å¡ï¼Œå¯èƒ½éœ€è¦å…³é—­ security bootã€‚å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/336429888">ç¨šæ™–å›</a> çš„æ•™ç¨‹ï¼Œä¸‹è½½å®‰è£… CUDAï¼Œé€‰æ‹© runfileã€‚</p><p>å¦‚æœæƒ³ç§»é™¤æ‰€æœ‰ cuda, cudnn, nvidia driver</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">apt-get</span> remove --purge nvidia*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è®¾ç½® cuda path</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">CUDA_HOME</span><span class="token operator">=</span>/usr/local/cuda<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">${CUDA_HOME}</span>/lib64<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">${CUDA_HOME}</span>/bin:<span class="token variable">${<span class="token environment constant">PATH</span>}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>(2022/1/31 æ›´æ–°) å°è¯•ä½¿ç”¨å‘½ä»¤è¡Œåœ¨ ubuntu 16.04 ä¸Šæ›´æ–°é©±åŠ¨ï¼Œä¸å¤ªé¡ºåˆ©ï¼Œå› ä¸º ppa ä¸­å¥½åƒæ²¡æœ‰å¯¹è¿™ 16.04 è¿›è¡Œæ”¯æŒï¼Œæœ€æ–°ä»…æ”¯æŒåˆ° 430ï¼Œé€šè¿‡å…¶ä»–æ–¹æ³•å¯èƒ½æˆåŠŸï¼Œä½†æˆ‘å°±ä¸è¿›è¡Œè¿‡å¤šå°è¯•äº†ã€‚æœ€ç»ˆä½¿ç”¨ <code>sudo apt install nvidia-418</code> æ¢å¤äº†ä¹‹å‰çš„é©±åŠ¨ç‰ˆæœ¬ï¼Œå…¶ä¸­é‡åˆ°çš„æŠ¥é”™ <code>NVIDIA NVML Driver/library version mismatch</code>ï¼Œå‚è€ƒäº† <a href="https://stackoverflow.com/questions/43022843/nvidia-nvml-driver-library-version-mismatch">StackOverflow </a> ä¸­çš„ç¬¬äºŒä¸ªå›ç­”è§£å†³</p><p>æ•™ç¨‹é‡Œè¿˜æ•™äº†å¦‚ä½•æ›´æ–° apt source ä¸ºé˜¿é‡Œäº‘é•œåƒæºï¼Œé•œåƒä¸­çš„è½¯ä»¶ä¼šæŒç»­è€Œä¸”ä¸‹è½½é€Ÿåº¦å¾ˆå¿«ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©æ›´æ¢ä¸º <a href="https://mirror.nju.edu.cn/help/ubuntu">å—äº¬å¤§å­¦é•œåƒæº</a> å¦‚ä¸‹æ‰€ç¤º</p>  <pre class="line-numbers language-source.list" data-language="source.list"><code class="language-source.list">sudo cp /etc/apt/sources.list /etc/apt/sources.list.backsudo sed -i 's/archive.ubuntu.com/mirrors.nju.edu.cn/g' /etc/apt/sources.listsudo sed -i 's/security.ubuntu.com/mirrors.nju.edu.cn/g' /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶æ•™ç¨‹é‡Œä¹Ÿè®¾ç½®äº† sudoï¼Œè®©æ¯ä¸€æ¬¡ sudo éƒ½ä¸éœ€è¦è¾“å…¥å¯†ç </p></li><li><p>pip install é‡åˆ°é—®é¢˜ enter your password to unlock your login keyring</p><p>è§£å†³æ–¹æ³•ï¼Œç›´æ¥cancelï¼Œæˆ–è€…åœ¨passwd and keyä¸­æ›´æ”¹å¯†ç </p></li></ol><h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><p>å®éªŒå®¤æœ‰ä¸€ä¸ªç©ºçš„ä¸»æœºï¼Œæ¯”è¾ƒè€ï¼Œæƒ³è¦é‡æ–°æ¸…ç†ä¸€ä¸‹è‡ªå·±ç”¨ã€‚æˆ‘å¹¶æ²¡æœ‰é€‰æ‹©é‡è£…æ•´ä¸ªç³»ç»Ÿï¼Œè€Œæ˜¯é€‰æ‹©é‡ç½®ï¼Œå³æ¢å¤å‡ºå‚è®¾ç½®</p><p>èµ„æºä¸‹è½½ï¼š<a href="https://msdn.itellyou.cn/">MSDN</a> <a href="https://rufus.ie/zh/">rufus</a> MSDN æä¾›äº†éœ€è¦çš„å„ä¸ª Windows ç‰ˆæœ¬çš„ isoï¼Œä½¿ç”¨ rufus å°† iso çƒ§å…¥åˆ°Uç›˜é‡Œ</p><p>Win10 å®‰è£…æ•™ç¨‹ï¼š<a href="https://www.bilibili.com/video/BV1DJ411D79y/?spm_id_from=333.788.recommend_more_video.-1">bilibili</a></p><p>Windows æ¿€æ´»ï¼š<a href="https://github.com/TGSAN/CMWTAT_Digital_Edition/releases">github</a></p><p>github å¦‚æœä¸‹è½½ä¸å¤Ÿå¿«ï¼Œè‡ªè¡Œæœç´¢ github é•œåƒï¼Œè¿™é‡Œç•™ä¸€ä¸ªå‚è€ƒ <a href="https://ghproxy.com/">link</a></p><p>ç£ç›˜ç®¡ç†ï¼š<a href="https://www.bilibili.com/video/BV1Uj411f7wj">bilibili</a></p><p>Office ä¸‹è½½ï¼š<a href="https://otp.landian.vip/zh-cn/">Office Tool plus</a></p><p>Office Tool plus <a href="https://www.coolhub.top/archives/11">ä½¿ç”¨æ–¹æ³•</a>ï¼š</p><ol><li><p>å¸è½½åŸæœ‰çš„ office wpsï¼Œå¹¶æ¸…é™¤æ—§ç‰ˆæœ¬æ¿€æ´»ä¿¡æ¯ï¼ˆæ¿€æ´»é¡µé¢ -&gt; è®¸å¯è¯ç®¡ç† -&gt; æ¸…é™¤æ¿€æ´»çŠ¶æ€ï¼‰</p></li><li><p>æ¨è Microsoft 365 ä¼ä¸šåº”ç”¨ç‰ˆ</p></li><li><p>ä½¿ç”¨ä¸€é”®å®‰è£…ä»£ç </p><pre class="line-numbers language-none"><code class="language-none">deploy /addProduct O365ProPlusRetail_zh-cn_Access,Bing,Groove,Lync,OneDrive,OneNote,Outlook,Publisher,Teams /channel Current /downloadFirst<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>åœ¨ä¹‹åä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°è®¸å¯è¯é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·ç®±ä¸­çš„<strong>ä¿®å¤Officeè®¸å¯è¯é—®é¢˜</strong>ã€‚æ­¤æ—¶éœ€è¦ä¸€ä¸ª <a href="https://www.coolhub.top/tech-articles/kms_list.html">KMS åœ°å€</a>ï¼Œå¡«å…¥å³å¯</p></li></ol><p>å¥½ç”¨çš„ windows terminal: <a href="https://github.com/microsoft/terminal">github</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å®‰è£…æ•™ç¨‹ </tag>
            
            <tag> Linux </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git æ•™ç¨‹</title>
      <link href="/archives/2121b11b.html"/>
      <url>/archives/2121b11b.html</url>
      
        <content type="html"><![CDATA[<h1 id="Git-reorganiszed-note"><a href="#Git-reorganiszed-note" class="headerlink" title="Git reorganiszed note"></a>Git reorganiszed note</h1><p>é‡æ–°æ•´ç†äº† git çš„å¸¸ç”¨æ“ä½œå‘½ä»¤ï¼Œèƒ½å¤Ÿè¦†ç›–å¤§éƒ¨åˆ†ç‰ˆæœ¬ç®¡ç†åœºæ™¯ï¼Œé€‚åˆä½œä¸ºæçº²è¿›è¡Œå¤ä¹ </p><p>æ•´ç†æ¥è‡ªï¼š<a href="https://www.bilibili.com/video/BV1FE411P7B3?from=search&amp;seid=1905221215711628694">bilibili</a> <a href="https://www.liaoxuefeng.com/wiki/896043488029600">å»–é›ªå³°æ•™ç¨‹</a></p><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p>å½“é‡åˆ°å›½å¤–èµ„æºä¸‹è½½å¾ˆæ…¢çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨é•œåƒèµ„æº</p><p>è§†é¢‘é‡Œä½¿ç”¨äº†æ·˜å®é•œåƒå®‰è£… windows ç‰ˆæœ¬ <a href="https://npm.taobao.org/mirrors/">https://npm.taobao.org/mirrors/</a></p><p>ubuntu ç›´æ¥ä½¿ç”¨ <code>apt install git</code> ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ</p><h2 id="Git-é…ç½®"><a href="#Git-é…ç½®" class="headerlink" title="Git é…ç½®"></a>Git é…ç½®</h2><p>é¦–å…ˆè¦ç†è§£çš„æ˜¯ï¼Œåœ¨windows ä¸­ git bash çš„åŸºæœ¬æ“ä½œå‘½ä»¤å’Œ Linux  terminal æ˜¯ä¸€æ ·çš„ã€‚åœ¨ Linux ä¸­ git æ˜¯é›†æˆåˆ° terminal å½“ä¸­çš„</p><h3 id="git-config"><a href="#git-config" class="headerlink" title="git  config"></a>git  config</h3><p>é…ç½®ç”¨æˆ·åå’Œé‚®ç®±</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> config --global user.name <span class="token string">'your_name'</span><span class="token function">git</span> config --global user.email <span class="token string">'***@qq.com'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¹‹åçš„æ‰€æœ‰æäº¤éƒ½ä¼šä½¿ç”¨ä½ çš„ç”¨æˆ·å’Œé‚®ç®±</p><p>è¿˜å¯ä»¥æ ¹æ®éœ€æ±‚é…ç½®ä»£ç†</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># è®¾ç½®ä»£ç†</span><span class="token function">git</span> config --global http.proxy http://127.0.0.1:1080<span class="token comment"># æŸ¥çœ‹ä»£ç†</span><span class="token function">git</span> config --global --get http.proxy<span class="token comment"># å–æ¶ˆä»£ç†</span><span class="token function">git</span> config --global --unset http.proxy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Git-åŸºæœ¬ç†è®º"><a href="#Git-åŸºæœ¬ç†è®º" class="headerlink" title="Git åŸºæœ¬ç†è®º"></a>Git åŸºæœ¬ç†è®º</h2><p>ç›´æ¥ä¸Šå›¾ï¼Œé‡ç‚¹å…³æ³¨å·¦ä¾§å‘½ä»¤</p><p><img src="/archives/2121b11b/image-20210628141830141.png" style="zoom:80%;"></p><p>ä»å·¥ä½œåŒº -&gt; æš‚å­˜åŒºï¼š<code>git add</code></p><p>ä»æš‚å­˜åŒº -&gt; æœ¬åœ°ä»“åº“ï¼š<code>git commit</code></p><p>ä»æœ¬åœ°ä»“åº“ -&gt; è¿œç¨‹ä»“åº“ï¼š<code>git push</code></p><p>è¿™ä¸‰ä¸ªå‘½ä»¤å°±èƒ½å¤Ÿè®©ä½ æ„Ÿå—åˆ° git ç‰ˆæœ¬æ§åˆ¶çš„åŸºæœ¬æµç¨‹</p><h2 id="Git-ä»“åº“æ­å»º"><a href="#Git-ä»“åº“æ­å»º" class="headerlink" title="Git ä»“åº“æ­å»º"></a>Git ä»“åº“æ­å»º</h2><h3 id="git-init-amp-git-clone"><a href="#git-init-amp-git-clone" class="headerlink" title="git init &amp; git clone"></a>git init &amp; git clone</h3><p>ç”Ÿæˆä»“åº“(master åˆ†æ”¯)çš„ä¸¤ç§æ–¹æ³•</p><ol><li><code>git init</code> åˆå§‹åŒ–ï¼Œç”Ÿæˆ .git æ–‡ä»¶</li><li><code>git clone url</code> å…‹éš†è¿œç¨‹ä»“åº“</li><li><code>git clone -b branch_name url</code> å…‹éš†æŒ‡å®šåˆ†æ”¯</li></ol><p>åˆ é™¤ä»“åº“åˆ™åªéœ€è¦åˆ é™¤ .git æ–‡ä»¶å¤¹å³å¯</p><h3 id="git-proxy-ä»£ç†"><a href="#git-proxy-ä»£ç†" class="headerlink" title="git proxy ä»£ç†"></a>git proxy ä»£ç†</h3><p>å¦‚æœåœ¨ clone é¡¹ç›®çš„æ—¶å€™å‘ç°é€Ÿåº¦å¾ˆæ…¢ï¼Œæ¨èä½¿ç”¨å›½å†…çš„é•œåƒæºï¼Œå¦‚ï¼š<a href="https://gitclone.com/">gitclone</a> <a href="https://doc.fastgit.org/zh-cn/">fastgit</a></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> config --global url.<span class="token string">"https://gitclone.com/"</span>.insteadOf https://<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨ <code>git config --list</code> æŸ¥çœ‹å½“å‰çš„é…ç½®ï¼Œå¦‚æœéœ€è¦é‡æ–°é…ç½®çš„è¯ï¼Œå¯ä»¥ç¼–è¾‘ <code>~/.gitconfig</code></p><h2 id="Git-æ–‡ä»¶åŸºæœ¬æ“ä½œ"><a href="#Git-æ–‡ä»¶åŸºæœ¬æ“ä½œ" class="headerlink" title="Git æ–‡ä»¶åŸºæœ¬æ“ä½œ"></a>Git æ–‡ä»¶åŸºæœ¬æ“ä½œ</h2><h3 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h3><p><code>git status</code> æŸ¥çœ‹ git æ–‡ä»¶çŠ¶æ€ï¼Œ<code>git status file_name</code> å¯æŒ‡å®šæ–‡ä»¶</p><p>æ–‡ä»¶çš„å‡ ç§çŠ¶æ€ï¼š</p><ol><li>untracked æ–‡ä»¶åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œä»æ²¡æœ‰ add è¿‡</li><li>unmodify æ–‡ä»¶å·²ç» commit ä¸”åº“ä¸­æœ€æ–°ç‰ˆæœ¬å’Œå½“å‰æ–‡ä»¶æ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥é€šè¿‡ <code>git rm</code> å°†å…¶ç§»å‡ºç‰ˆæœ¬åº“ç®¡ç†</li><li>modified æ–‡ä»¶åœ¨ commit æˆ–è€… add è¿‡åæœ‰è¿‡ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>git checkout</code> ä¸¢å¼ƒä¿®æ”¹</li><li>staged (æ–‡ä»¶åœ¨ä¹‹å‰ commit è¿‡åæœ‰è¿‡ä¿®æ”¹) ç»è¿‡ addï¼Œæ²¡æœ‰ commit</li></ol><p>å½“å­˜åœ¨æ–‡ä»¶ä¸ºä¸­æ–‡å‘½åæ—¶ git status ä¼šæ˜¾ç¤ºä¸ºè½¬ä¹‰æ•°å­—ä¸²å½¢å¦‚ \351\237â€¦ è¿™æ ·çš„ä¹±ç è§£å†³æ–¹æ³•å¦‚ä¸‹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> config --global core.quotepath <span class="token boolean">false</span><span class="token comment"># core.quotepathçš„ä½œç”¨æ˜¯æ§åˆ¶è·¯å¾„æ˜¯å¦ç¼–ç æ˜¾ç¤ºçš„é€‰é¡¹, å½“å­—ç¬¦ä¸ºä¸­æ–‡æ—¶ä¼šè½¬ä¹‰è¾“å‡º</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸æƒ³æŠŠæŸäº›æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œå¯åœ¨ä¸»ç›®å½•ä¸‹å»ºç«‹ .gitignore æ–‡ä»¶ï¼Œä¾‹å¦‚ä½ ä¸è¯¦æŠŠ txt ç±»å‹æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œåˆ™åœ¨ .gitignore æ–‡ä»¶ä¸­å†™å…¥ *.txt å³å¯ï¼Œå…¶ä»–å…·ä½“è§„åˆ™ä¸ä½œä»‹ç»ï¼Œä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p><h3 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h3><p><code>git add file_name</code> å°†æ–‡ä»¶åŠ å…¥æš‚å­˜åŒºï¼Œæ–‡ä»¶æˆä¸º staged çŠ¶æ€</p><p><code>git add .</code> å°†å½“å‰æ–‡ä»¶å¤¹ addï¼Œæ¯”è¾ƒæ–¹ä¾¿å¿«æ·</p><h3 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h3><p><code>git commit -m 'message content'</code> å°†æš‚å­˜åŒºæ‰€æœ‰æ–‡ä»¶åŠ å…¥åˆ°ç‰ˆæœ¬åº“ä¸­ï¼Œå¹¶ç•™ä¸‹æ­¤æ¬¡æäº¤çš„ message</p><p><code>git commit -am 'message content'</code> å°†åŒæ—¶å®Œæˆ <code>git add all</code>ï¼ˆå³å°†æ‰€æœ‰æ”¹åŠ¨æ–‡ä»¶åŠ å…¥æš‚å­˜åŒºï¼‰å’Œ <code>git commit</code> æ“ä½œ</p><p><code>git commit --amend</code> å¯ä»¥ä¿®æ”¹ä¸Šä¸€æ¬¡æäº¤çš„ commit message</p><h3 id="git-rm"><a href="#git-rm" class="headerlink" title="git rm"></a>git rm</h3><p><code>git rm --cached file_name</code> å°†å·²ç» commit çš„æ–‡ä»¶ä»ç‰ˆæœ¬åº“ä¸­ç§»é™¤å˜ä¸º untracked æ–‡ä»¶</p><p><code>git rm file_name</code> ä¸ä½¿ç”¨å‚æ•°åˆ™ä»£è¡¨å½»åº•åˆ é™¤è¯¥æ–‡ä»¶</p><h2 id="Git-ç‰ˆæœ¬å›é€€"><a href="#Git-ç‰ˆæœ¬å›é€€" class="headerlink" title="Git ç‰ˆæœ¬å›é€€"></a>Git ç‰ˆæœ¬å›é€€</h2><h3 id="git-log-amp-git-reflog"><a href="#git-log-amp-git-reflog" class="headerlink" title="git log &amp; git reflog"></a>git log &amp; git reflog</h3><p><code>git log</code> æŸ¥çœ‹ commit å†å²è®°å½•ï¼Œidï¼Œä½œè€…ç­‰ä¿¡æ¯</p><p><code>git reflog</code> æŸ¥çœ‹æ‰€æœ‰çš„æ“ä½œ</p><h3 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h3><p><code>git reset --hard commit_id</code> å°†å›é€€åˆ°æŸä¸€ä¸ª commit ç‰ˆæœ¬ï¼Œid åªç”¨å†™å‰å‡ ä½ï¼Œgit è‡ªåŠ¨è¯†åˆ«</p><p><code>git reset --hard HEAD^</code> å°†å›é€€åˆ°ä¸Šä¸€ä¸ª commit ç‰ˆæœ¬ï¼Œå¦‚æœå›é€€ä¸¤ä¸ªåˆ™æ˜¯ HEAD^^</p><p><code>--hard</code> å‚æ•°å…¶å®ä»£è¡¨å›é€€åˆ°æŸä¸ª commit åï¼Œè¯¥ commit ä¹‹åçš„è®°å½•éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚ä½† git æ°¸è¿œéƒ½æœ‰åæ‚”è¯åƒï¼Œå¦‚æœå›é€€åˆ°ä»¥å‰çš„ç‰ˆæœ¬æƒ³è¦å†å›æ¥ï¼Œä½¿ç”¨ git reflog æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤</p><h3 id="git-checkout"><a href="#git-checkout" class="headerlink" title="git checkout"></a>git checkout</h3><p><code>git checkout filename</code> èƒ½å¤Ÿè®©æ–‡ä»¶å›åˆ°æœ€è¿‘ä¸€æ¬¡ add æˆ–è€… commit æ—¶çš„çŠ¶æ€</p><h2 id="åˆ†æ”¯ä¸å†²çª"><a href="#åˆ†æ”¯ä¸å†²çª" class="headerlink" title="åˆ†æ”¯ä¸å†²çª"></a>åˆ†æ”¯ä¸å†²çª</h2><h3 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a>git branch</h3><p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ›´åŠ æ·±å…¥ç†è§£ git çš„å·¥ä½œå½¢è±¡ï¼Œworking tree</p><p>é™¤äº† master åˆ†æ”¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºå…¶ä»–åˆ†æ”¯ï¼ŒHEAD æ‰€æŒ‡çš„å°±æ˜¯ working tree â€œç”Ÿé•¿â€çš„åœ°æ–¹ï¼Œç„¶åæˆ‘ä»¬å°†åˆ†æ”¯åˆå¹¶ï¼Œä¹Ÿå³è®© master â€œèµ¶ä¸Šæ¥â€ï¼Œå†åˆ é™¤ dev åˆ†æ”¯ã€‚git åˆ†æ”¯è¿˜æœ‰ä¸€ä¸ªä¸€èˆ¬è§„åˆ™æ˜¯ï¼Œmaster åˆ†æ”¯æ°¸è¿œæ˜¯æœ€ç¨³å®šçš„åˆ†æ”¯ï¼Œå¼€å‘éƒ½åœ¨ dev æˆ–å…¶ä»–åˆ†æ”¯ä¸Šè¿›è¡Œ</p><p><img src="/archives/2121b11b/branch_1.png" style="zoom: 50%;"></p><p><img src="/archives/2121b11b/branch_2.png" style="zoom: 50%;"></p><p><img src="/archives/2121b11b/branch_3.png" style="zoom:50%;"></p><p><code>git branch</code> å¯ä»¥æŸ¥çœ‹åˆ†æ”¯æƒ…å†µ</p><p><code>git branch -d branch_name</code> ç”¨äºåˆ é™¤åˆ†æ”¯</p><h3 id="git-switch"><a href="#git-switch" class="headerlink" title="git switch"></a>git switch</h3><p><code>git switch -c branch_name</code> ä½¿ç”¨ git swich æ¥åˆ›å»ºåˆ†æ”¯</p><p><code>git switch branch_name</code> ä½¿ç”¨ git swich æ¥åˆ‡æ¢åˆ†æ”¯</p><p><code>git switch -c branch_name origin/branch_name</code> åˆ›å»ºåˆ†æ”¯å¹¶å¤åˆ¶è¿œç¨‹çš„åˆ†æ”¯åˆ°æœ¬åœ°</p><h3 id="git-merge"><a href="#git-merge" class="headerlink" title="git merge"></a>git merge</h3><p><code>git merge branch_name</code> å°†æŸä¸ªåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯</p><p>å¦‚æœå‘ç”Ÿäº†å†²çªï¼šä¸¤ä¸ª branch ä¸­åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­æœ‰ä¸åŒçš„ä¿®æ”¹è€Œæ— æ³•åˆå¹¶ï¼Œé‚£ä¹ˆéœ€è¦è§£å†³å†²çªã€‚ï¼ˆåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æœ‰ä¿®æ”¹ï¼Œæ˜¯æ ¹æ® commit id ä¹‹ç±»çš„æ ‡è®°èŠ‚ç‚¹æ¥åˆ¤æ–­çš„ï¼Œä½†æ˜¯å¦å­˜åœ¨å†²çªåˆ™æ˜¯æ ¹æ®æ–‡ä»¶çš„å†…å®¹ï¼‰</p><p><img src="/archives/2121b11b/branch_4.png" style="zoom:50%;"></p><p>å…ˆä½¿ç”¨ <code>git status</code> æŸ¥çœ‹å“ªä¸ªæ–‡ä»¶å‘ç”Ÿå†²çªï¼Œç„¶åä½¿ç”¨ vim ç¼–è¾‘ï¼Œgit ä¼šè‡ªåŠ¨åœ¨æ–‡æ¡£ä¸­æ ‡æ˜å†²çªçš„åœ°æ–¹ã€‚æ€æ ·ä¿®æ”¹æ— æ‰€è°“ï¼Œåªè¦ä½  add &amp; commit è¿‡åï¼Œgit å°±ä¼šé»˜è®¤å†²çªè§£å†³ï¼Œå¹¶å°†ä½ çš„æ–‡ä»¶ä½œä¸ºæœ€æ–°çš„ç‰ˆæœ¬åŠ å…¥ç‰ˆæœ¬åº“ä¸­ï¼Œæ›´æ–° working tree</p><p>å¦‚æœå¯¹äº git ä¸­ recursive 3-way merge ç®—æ³•æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚çœ‹ <a href="https://en.wikipedia.org/wiki/Merge_(version_control">ç»´åŸºç™¾ç§‘</a>)</p><h2 id="è¿œç¨‹ä»“åº“"><a href="#è¿œç¨‹ä»“åº“" class="headerlink" title="è¿œç¨‹ä»“åº“"></a>è¿œç¨‹ä»“åº“</h2><h3 id="æ·»åŠ è¿œç¨‹ä»“åº“-github-or-gitee"><a href="#æ·»åŠ è¿œç¨‹ä»“åº“-github-or-gitee" class="headerlink" title="æ·»åŠ è¿œç¨‹ä»“åº“ github or gitee"></a>æ·»åŠ è¿œç¨‹ä»“åº“ github or gitee</h3><p>gitee ä¸ºå›½å†…ç½‘ç«™ï¼Œä¼ è¾“é€Ÿåº¦æ›´å¿«ã€‚é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°†æœ¬æœºä¸è¿œç¨‹è¿æ¥ï¼ˆä»¥ github ä¸ºä¾‹ï¼‰ï¼š</p><ol><li><p>æ³¨å†Œ github è´¦å·</p></li><li><p>ç”Ÿæˆ ssh å…¬é’¥</p><ol><li><p>åœ¨æœ¬æœº user ç›®å½•ä¸‹æ‰¾åˆ° ssh æ–‡ä»¶å¤¹ï¼ˆå®‰è£… git è¿‡åè¿™ä¸ªæ–‡ä»¶å¤¹ä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰</p></li><li><p>åœ¨ shell ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ ssh å¯†é’¥ï¼Œå…¶ä¸­ rsa æ˜¯ä¸€ç§åŠ å¯†ç®—æ³• </p><p><code>ssh-keygen -t rsa</code></p><p>ä¹‹åä½ å°±èƒ½åœ¨ .ssh æ–‡ä»¶ä¸­æ‰¾åˆ° id_rsa å’Œ id_rsa.pub æ–‡ä»¶</p></li></ol></li><li><p>æ·»åŠ  id_rsa.pub åˆ° github è´¦æˆ·è®¾ç½®ä¸­</p></li></ol><p>è¿™æ ·å°±æŠŠæœ¬æœºå’Œè¿œç¨‹ä»“åº“è¿æ¥èµ·æ¥äº†ï¼Œå…·ä½“çš„è¯´æ˜¯å°†æœ¬æœºä¸ä½ çš„ github è´¦å·é€šè¿‡ ssh è¿æ¥èµ·æ¥äº†</p><h3 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a>git remote</h3><p>ä½ çš„è´¦å·é‡Œå¯ä»¥æœ‰å¾ˆå¤šçš„ä»“åº“ï¼Œæˆ‘ä»¬æƒ³è¦å°†æœ¬åœ°ä»“åº“ä¸æŸä¸€ä¸ªæŒ‡å®šä»“åº“é“¾æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯</p><p><code>git remote add origin [url]</code></p><p>è¿œç¨‹ä»“åº“çš„åå­—å« originï¼Œè¿™æ˜¯ git çš„é»˜è®¤å«æ³•ï¼Œurl æ˜¯ä»“åº“çš„ https æˆ–è€… ssh</p><p><code>git remote -v</code> æŸ¥çœ‹æ·»åŠ çš„è¿œç¨‹ä»“åº“ï¼Œ<code>-v</code> ä»£è¡¨ verbose æ¨¡å¼ï¼Œè¯¥ä¸å¸¦å‚æ•°ä»…è¿”å›è¿œç¨‹ä»“åº“çš„åå­— <code>origin</code> </p><p><code>git remote remove origin</code> ç§»é™¤ä¸è¿œç¨‹ä»“åº“çš„é“¾æ¥</p><h3 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h3><p>æŠŠæœ¬åœ°åº“çš„å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤</p><p><code>git push -u orgin master</code></p><p>è¿™æ ·å°±æŠŠæœ¬åœ° master åˆ†æ”¯å†…å®¹æ¨é€åˆ°äº†è¿œç¨‹çš„ master åˆ†æ”¯ã€‚-u å‚æ•°ä¸º set upstream çš„æ„æ€ï¼Œåœ¨æ¨é€çš„åŒæ—¶å°†æˆ‘ä»¬çš„æœ¬åœ° master åˆ†æ”¯å’Œè¿œç¨‹ master åˆ†æ”¯è”ç³»èµ·æ¥ï¼ˆç›¸å½“äºä½œäº† <code>git branch -u origin/master</code> ï¼‰ï¼Œä»Šååˆ™å¯ä»¥ç›´æ¥è¾“å…¥ git push æ¥ç®€åŒ–æ¨é€å‘½ä»¤ï¼Œå¼ºçƒˆå»ºè®®åœ¨ç¬¬ä¸€æ¬¡ push çš„æ—¶å€™å¸¦ä¸Š -u å‚æ•°</p><p>å…¶ä»–æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„ push å’Œè¿æ¥ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ŒæŠŠä¸Šé¢å‘½ä»¤çš„ master æ”¹ä¸ºå¯¹åº”åˆ†æ”¯çš„åå­—ï¼ˆä¾‹å¦‚ï¼šdev åˆ†æ”¯ï¼‰å³å¯ï¼Œå‰ææ˜¯æœ¬åœ°è¦åˆ‡æ¢åˆ°é‚£ä¸ªåˆ†æ”¯ï¼Œä¸”è¿œç¨‹å­˜åœ¨åŒåçš„åˆ†æ”¯</p><p>ä¸ªäººè®¤ä¸º <code>git push</code> ä¸€èˆ¬æ˜¯åœ¨åŒåçš„æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ä¹‹é—´è¿›è¡Œ</p><h3 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a>git pull</h3><p>æ–‡ä»¶å†²çªä¸ä»…å‡ºç°åœ¨æœ¬åœ°çš„ merge å½“ä¸­ï¼Œä¹Ÿå­˜åœ¨åœ¨ push æ“ä½œå½“ä¸­ã€‚push çš„æœ¬è´¨ä¹Ÿæ˜¯å°†æœ¬åœ°å’Œè¿œç¨‹è¿™ä¸¤ä¸ª branch è¿›è¡Œèåˆã€‚å½“è¿™ä¸ªè¿œç¨‹ä»“åº“åªæœ‰ä½ ä¸€ä¸ªäººåœ¨ push æ—¶ï¼Œæ˜¯ä¸ä¼šæœ‰å†²çªçš„ï¼Œå› ä¸ºè¿œç¨‹çš„ working tree åªä¼šä¸€ç›´å¾€å‰å»¶ä¼¸ï¼›å½“æœ‰å¤šä¸ªäººéƒ½åœ¨å¯¹æŸä¸€ä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œworking tree å°±ç›¸å½“äºæœ‰äº†å¤šä¸ªåˆ†æ”¯ï¼Œåœ¨ push çš„æ—¶å€™å°±ä¼šå½¢æˆå†²çªã€‚å¦‚æœæœ‰è¿œç«¯çš„å†²çªå½¢æˆï¼Œå°±éœ€è¦ä½¿ç”¨ <code>git pull</code></p><p><code>git pull</code> æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€ä¸ªæ˜¯æ‹‰å–ä»£ç åˆ°æœ¬åœ°ï¼Œå¦ä¸€ä¸ªæ˜¯å°è¯•ä¸æœ¬åœ°ä»£ç åˆå¹¶ï¼Œå¦‚æœä¸èƒ½ä½¿ç”¨ fast forward åˆå¹¶ï¼Œåˆ™éœ€è¦è‡ªå·±æ¥ä¿®æ”¹å†²çªéƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†å’Œ <code>git merge</code> æ˜¯ä¸€æ ·çš„</p><h3 id="æ­å»ºè‡ªå·±çš„è¿œç¨‹ä»“åº“"><a href="#æ­å»ºè‡ªå·±çš„è¿œç¨‹ä»“åº“" class="headerlink" title="æ­å»ºè‡ªå·±çš„è¿œç¨‹ä»“åº“"></a>æ­å»ºè‡ªå·±çš„è¿œç¨‹ä»“åº“</h3><blockquote><p>è¿œç¨‹ä»“åº“å®é™…ä¸Šå’Œæœ¬åœ°ä»“åº“æ²¡å•¥ä¸åŒï¼Œçº¯ç²¹ä¸ºäº†7x24å°æ—¶å¼€æœºå¹¶äº¤æ¢å¤§å®¶çš„ä¿®æ”¹ã€‚GitHubå°±æ˜¯ä¸€ä¸ªå…è´¹æ‰˜ç®¡å¼€æºä»£ç çš„è¿œç¨‹ä»“åº“ã€‚ä½†æ˜¯å¯¹äºæŸäº›è§†æºä»£ç å¦‚ç”Ÿå‘½çš„å•†ä¸šå…¬å¸æ¥è¯´ï¼Œæ—¢ä¸æƒ³å…¬å¼€æºä»£ç ï¼Œåˆèˆä¸å¾—ç»™GitHubäº¤ä¿æŠ¤è´¹ï¼Œé‚£å°±åªèƒ½è‡ªå·±æ­å»ºä¸€å°GitæœåŠ¡å™¨ä½œä¸ºç§æœ‰ä»“åº“ä½¿ç”¨ã€‚</p></blockquote><p>ä¾æ—§æ˜¯å‚è€ƒ <a href="https://www.liaoxuefeng.com/wiki/896043488029600/899998870925664">å»–é›ªå³°æ•™ç¨‹</a>ï¼Œä¸è¿‡è‡ªå·±åœ¨å®ç°æ—¶æœ‰ä¸€äº›åŒºåˆ«ã€‚åœ¨è¿›è¡Œ git clone æ“ä½œæ—¶ï¼Œå…‹éš†çš„é“¾æ¥ä¸åº”è¯¥ä½¿ç”¨ç»å¯¹è·¯å¾„ <code>git clone git@server:/srv/sample.git</code> åº”è¯¥å»æ‰ç¬¬ä¸€ä¸ªæ–œæ  <code>git clone git@server:srv/sample.git</code></p><h2 id="Git-IDE"><a href="#Git-IDE" class="headerlink" title="Git + IDE"></a>Git + IDE</h2><p>ç°åœ¨ git å’Œå¾ˆå¤š IDE éƒ½æœ‰è”åŠ¨ï¼Œå¯ä»¥ç›´æ¥åœ¨ IDE ä¸­æ–¹ä¾¿çš„æ“ä½œ gitï¼Œç”šè‡³å°† git å¯è§†åŒ–ï¼Œå¯ä»¥ç›´è§‚çœ‹åˆ°ä½ å¯¹æ–‡ä»¶çš„ä¿®æ”¹</p><p>ä»¥ pycharm å’Œ vscode ä¸ºä¾‹ï¼Œåªè¦åœ¨ä½ çš„é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹æœ‰ .git æ–‡ä»¶å³å¯ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ git init æ–°å»º </p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹ </category>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-theme-matery æ•™ç¨‹</title>
      <link href="/archives/b129f5ae.html"/>
      <url>/archives/b129f5ae.html</url>
      
        <content type="html"><![CDATA[<h1 id="hexo-theme-matery-note"><a href="#hexo-theme-matery-note" class="headerlink" title="hexo-theme-matery note"></a>hexo-theme-matery note</h1><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>å‚è€ƒåŸ github é¡¹ç›®è¿›è¡Œæ•´ç†ï¼š<a href="https://github.com/blinkfox/hexo-theme-matery">https://github.com/blinkfox/hexo-theme-matery</a></p><h3 id="config-yml-çš„ä¿®æ”¹å»ºè®®"><a href="#config-yml-çš„ä¿®æ”¹å»ºè®®" class="headerlink" title="_config.yml çš„ä¿®æ”¹å»ºè®®"></a>_config.yml çš„ä¿®æ”¹å»ºè®®</h3><p>åœ¨ hexo æ ¹ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­ï¼š</p><ol><li><p>åˆ‡æ¢ theme ä¸º hexo-theme-matery</p></li><li><p>url æ”¹ä¸ºç½‘ç«™ url (å¦‚ï¼š<a href="http://xxx.github.io">http://xxx.github.io</a>)</p></li><li><p>per_page æ•°å€¼æ”¹ä¸º6åŠ6çš„å€æ•°ï¼Œè¿™æ ·æ–‡ç« åˆ—è¡¨åœ¨å„ä¸ªå±å¹•ä¸‹éƒ½èƒ½è¾ƒå¥½æ˜¾ç¤º</p></li><li><p>æ’å…¥å›¾ç‰‡ï¼ˆæœ‰ç‚¹å¤æ‚ï¼Œå¯ä»¥å…ˆè·³è¿‡ï¼‰ã€‚æ ¹æ® <a href="https://zhuanlan.zhihu.com/p/265077468">çŸ¥ä¹é“¾æ¥</a> é…ç½®å¥½ post_asset_folderï¼Œé‡Œé¢æåˆ°çš„ typora æŠ€å·§ä¹Ÿå¾ˆå®ç”¨ï¼Œå»ºè®®é‡‡ç”¨ã€‚ä¸”ä¸€èˆ¬æ¥è®²é“¾æ¥ä¸­æåˆ°çš„ hexo-renderer-marked æ’ä»¶éƒ½æ˜¯å·²ç»å†…ç½®å¥½çš„ï¼Œä¸ç„¶ä½ çš„åšå®¢ä¸ä¼šæ¸²æŸ“æˆåŠŸã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸èƒ½æ§åˆ¶å›¾ç‰‡å¤§å°ï¼Œè€Œä¸”é…ç½®è¿‡ typora åè¿˜è¦å†æ”¹å›¾ç‰‡çš„è·¯å¾„ã€‚æˆ‘å†ä¸‹è½½äº† hexo-asset-image æ’ä»¶è¿‡åï¼Œç›´æ¥ç”¨ typora ä¸­çš„ html æ–¹æ³• <code>&lt;img src='post_name/img.jpg'&gt;</code>å¼•ç”¨å›¾ç‰‡ï¼Œä¸éœ€è¦äºŒæ¬¡æ›´æ”¹è·¯å¾„</p></li></ol><h3 id="æ–°å»ºåˆ†ç±»-categories-é¡µ"><a href="#æ–°å»ºåˆ†ç±»-categories-é¡µ" class="headerlink" title="æ–°å»ºåˆ†ç±» categories é¡µ"></a>æ–°å»ºåˆ†ç±» categories é¡µ</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> hexo new page <span class="token string">'categories'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>categories é¡µæ˜¯ç”¨æ¥å±•ç¤ºæ‰€æœ‰åˆ†ç±»çš„é¡µé¢</p><p>ä¿®æ”¹ <code>/source/categories/index.md</code> æ–‡ä»¶çš„ front-matter (Front-matter æ˜¯æ–‡ä»¶æœ€ä¸Šæ–¹ä»¥ â€”- åˆ†éš”çš„åŒºåŸŸï¼Œç”¨äºæŒ‡å®šä¸ªåˆ«æ–‡ä»¶çš„å˜é‡)</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">---title: categoriesdate: <span class="token number">2018</span>-09-30 <span class="token number">17</span>:25:30type: <span class="token string">"categories"</span>layout: <span class="token string">"categories"</span>---<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³äº page å’Œ post çš„åŒºåˆ«ï¼šä¸¤è€…å…¶å®å¾ˆç›¸ä¼¼ï¼Œä½ å¯ä»¥æŠŠ page çœ‹ä½œæ˜¯ç‰¹æ®Šçš„ postï¼Œç”¨æ¥æ”¾ç½®ä¸€äº›ç‰¹æ®Šå†…å®¹ï¼šå¦‚åˆ†ç±»ã€æ ‡ç­¾ç­‰ç­‰ã€‚</p><p>hexo çš„åˆ†ç±»æ˜¯æœ‰ç­‰çº§å…³ç³»çš„ï¼Œæˆ‘ä»¬ä»¥ä¸‹é¢çš„ post front-matter ä¸ºä¾‹</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">title: æˆ‘çš„åšå®¢æ­å»ºç¬”è®°date: 2021-06-29 15:26:41tags:<span class="token list punctuation">-</span> hexo<span class="token list punctuation">-</span> åšå®¢æ­å»ºcategories:<span class="token list punctuation">-</span> è½¯ä»¶åŸºç¡€<span class="token list punctuation">-</span> hexo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæ–‡ä»¶åœ¨åˆ†ç±»æ—¶ä¼šè¢«åˆ†é…åˆ°æ‰€æœ‰æåˆ°çš„ categories ä¸­ï¼Œè¿™äº› categories çš„è·¯å¾„æ˜¯é€æ¸å¾€ä¸‹çš„ <code>/categories/è½¯ä»¶åŸºç¡€/hexo/</code>ï¼Œå®ƒä»¬éƒ½æœ‰è‡ªå·±çš„ page æ¥æ”¶çº³å±äºè‡ªå·±ç±»åˆ«çš„æ–‡ç« ã€‚</p><h3 id="æ–°å»ºæ ‡ç­¾-tags-é¡µ"><a href="#æ–°å»ºæ ‡ç­¾-tags-é¡µ" class="headerlink" title="æ–°å»ºæ ‡ç­¾ tags é¡µ"></a>æ–°å»ºæ ‡ç­¾ tags é¡µ</h3><p>æ–°å»º page</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo new page <span class="token string">"tags"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿®æ”¹å¯¹åº” index.md</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">---title: tagsdate: <span class="token number">2018</span>-09-30 <span class="token number">18</span>:23:38type: <span class="token string">"tags"</span>layout: <span class="token string">"tags"</span>---<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»™ post æŒ‡å®š tags åªéœ€è¦åœ¨ front-matter ä¸­å†™å¥½å°±è¡Œäº†ï¼Œå¦‚ä¸Šé¢ categories çš„ä¾‹å­ã€‚</p><h3 id="æ–°å»ºå…³äºæˆ‘-about-é¡µ"><a href="#æ–°å»ºå…³äºæˆ‘-about-é¡µ" class="headerlink" title="æ–°å»ºå…³äºæˆ‘ about é¡µ"></a>æ–°å»ºå…³äºæˆ‘ about é¡µ</h3><h3 id="æ–°å»ºç•™è¨€æ¿-contact-é¡µ"><a href="#æ–°å»ºç•™è¨€æ¿-contact-é¡µ" class="headerlink" title="æ–°å»ºç•™è¨€æ¿ contact é¡µ"></a>æ–°å»ºç•™è¨€æ¿ contact é¡µ</h3><h3 id="æ–°å»ºå‹æƒ…é“¾æ¥-friends-é¡µ"><a href="#æ–°å»ºå‹æƒ…é“¾æ¥-friends-é¡µ" class="headerlink" title="æ–°å»ºå‹æƒ…é“¾æ¥ friends é¡µ"></a>æ–°å»ºå‹æƒ…é“¾æ¥ friends é¡µ</h3><p>æ–°å»ºæ–¹æ³•éƒ½æ˜¯å’Œä¸Šé¢çš„æ–¹æ³•ä¸€æ ·çš„</p><h2 id="èœå•å¯¼èˆªé…ç½®ä¸æ¸²æŸ“"><a href="#èœå•å¯¼èˆªé…ç½®ä¸æ¸²æŸ“" class="headerlink" title="èœå•å¯¼èˆªé…ç½®ä¸æ¸²æŸ“"></a>èœå•å¯¼èˆªé…ç½®ä¸æ¸²æŸ“</h2><h3 id="åç§°ã€è·¯å¾„ã€å›¾æ ‡"><a href="#åç§°ã€è·¯å¾„ã€å›¾æ ‡" class="headerlink" title="åç§°ã€è·¯å¾„ã€å›¾æ ‡"></a>åç§°ã€è·¯å¾„ã€å›¾æ ‡</h3><p>é…ç½®èœå•å¯¼èˆªçš„åç§°ã€è·¯å¾„urlã€å’Œå›¾æ ‡iconï¼Œé…ç½®æ–‡ä»¶åœ¨ <code>themes/hexo-theme-matery/._config.yml</code></p><p>æ›´æ”¹ menu éƒ¨åˆ†å³å¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">menu:  <span class="token comment"># æŠŠ Index æ”¹ä¸º Home</span>  Home:    url: /    icon: fas fa-home  Tags:    url: /tags    icon: fas fa-tags<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯è¯¥çš„éƒ¨åˆ†ï¼š</p><ol><li>åç§°å¯ä»¥æ˜¯ä¸­æ–‡</li><li>å›¾æ ‡å¯ä»¥åœ¨ <a href="https://fontawesome.com/icons">Font Awesome</a> ä¸­æŸ¥æ‰¾</li><li>è¿˜å¯ä»¥ä½¿ç”¨äºŒçº§èœå•ã€‚äºŒçº§èœå•åœ¨å®ç°ä¸Šå¯ä»¥ç†è§£ä¸ºåˆ›å»ºäº†ä¸€ä¸ªè½¯é“¾æ¥ï¼Œåˆ°ä½ æŒ‡å®šçš„ page ä¸Šã€‚</li></ol><p>ç”±äºæˆ‘å¯¹äºè¿™ä¸ªå¯¼èˆªè¿˜æ˜¯æ¯”è¾ƒæ»¡æ„ï¼Œå°±ä¸ä½œè¿‡å¤šä¿®æ”¹</p><h3 id="ä¿®æ”¹é¡µè„š"><a href="#ä¿®æ”¹é¡µè„š" class="headerlink" title="ä¿®æ”¹é¡µè„š"></a>ä¿®æ”¹é¡µè„š</h3><p>é¡µè„šä¿¡æ¯å¯èƒ½éœ€è¦åšå®šåˆ¶åŒ–ä¿®æ”¹ï¼Œä¿®æ”¹çš„åœ°æ–¹åœ¨ä¸»é¢˜æ–‡ä»¶çš„ <code>/layout/_partial/footer.ejs</code> æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬ç«™ç‚¹ã€ä½¿ç”¨çš„ä¸»é¢˜ã€è®¿é—®é‡ç­‰ã€‚</p><p>ç”±äºä»£ç çœ‹ä¸æ˜ç™½ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒè¯¦ç»†çš„ <a href="https://sunhwee.com/posts/6e8839eb.html">æ•™ç¨‹</a>ã€‚æ ¹æ®æ•™ç¨‹ä¿®æ”¹äº†ç‰ˆæƒä¿¡æ¯ï¼Œå¢åŠ äº†ç½‘ç«™è¿è¡Œæ—¶é—´ï¼Œè®¿é—®äººæ•°çš„ä»£ç ç›®å‰ä¸éœ€è¦ä¿®æ”¹</p><h3 id="ä»£ç é«˜äº®"><a href="#ä»£ç é«˜äº®" class="headerlink" title="ä»£ç é«˜äº®"></a>ä»£ç é«˜äº®</h3><p>ä¿®æ”¹ Hexo æ ¹ç›®å½•ä¸‹ <code>_config.yml</code> æ–‡ä»¶ä¸­ <code>highlight.enable</code> çš„å€¼ä¸º <code>false</code>ï¼Œå¹¶å°† <code>prismjs.enable</code> çš„å€¼è®¾ç½®ä¸º <code>true</code></p><p>ä»¥ä¸Šçš„è®¾ç½®å¹¶ä¸ç®¡ç”¨ï¼Œæ²¡æœ‰é«˜äº®ä¹Ÿæ²¡æœ‰è¡Œå·</p><p>ä½†æ˜¯æˆ‘ä¸‹è½½äº† hexo-prism-plugin åˆå¸è½½æ‰è¿™ä¸ªæ’ä»¶ï¼Œå°±æœ‰é«˜äº®äº†ï¼Œä½†ä¾æ—§æ²¡æœ‰è¡Œå·</p><p>è€ƒè™‘æ˜¯ matery.css æ–‡ä»¶ä¸­ pre ä¸‹ paddidng ä¸å¤Ÿå¤§çš„é—®é¢˜ï¼Œå¢åŠ  padding ä½†ä¾ç„¶æ²¡èƒ½è§£å†³</p><p>è€ƒè™‘æ˜¯ä¸æ˜¯æœ¬èº« prism æ–‡ä»¶å‡ºäº†é—®é¢˜ï¼Œé‡æ–°åˆ°å®˜ç½‘ä¸Šä¸‹è½½äº† prism.js å’Œ prism.css æ›¿æ¢åŸæ¥ç³»ç»Ÿä¸­å¯¹åº”çš„æ–‡ä»¶ï¼ŒåŒæ—¶è°ƒæ•´ä¸Šé¢æåˆ°çš„ padding å‚æ•°ï¼Œæœ€åæˆåŠŸï¼</p><p>prism.js æ–‡ä»¶ä½ç½®åœ¨ <code>node_modules/prismjs</code></p><p>prism.css æ–‡ä»¶ä½ç½®åœ¨ <code>themes/hexo-theme-matery/source/libs/prism</code></p><p>ç°åœ¨æƒ³è¦å»é™¤éš”ç¦»çš„é‚£æ¡ç«–çº¿ï¼Œå°è¯•é‡å¤ <a href="https://github.com/blinkfox/hexo-theme-matery/issues/103">github issue</a> çš„æ“ä½œï¼Œæ“ä½œè¿‡åç«–çº¿æ²¡æœ‰å»é™¤ï¼Œä¸è¿‡ç¨å¾®è°ƒæ•´äº†ä¸€ä¸‹ä»£ç ä½ç½®ï¼Œä¹ŸæŒºå¥½çœ‹</p><p>æœ€ç»ˆï¼Œæˆ‘é€šè¿‡ä¿®æ”¹ prism.css ä¸­ border-right ä¸º 0pxï¼Œå»é™¤äº†è¡Œå·å’Œä»£ç ä¹‹é—´çš„åˆ†éš”çº¿ï¼</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.line-numbers .line-numbers-rows</span> <span class="token punctuation">{</span><span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><span class="token property">top</span><span class="token punctuation">:</span> -0.2em<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span> -3.8em<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 3em<span class="token punctuation">;</span> <span class="token comment">/* works for line-numbers below 1000 lines */</span><span class="token property">letter-spacing</span><span class="token punctuation">:</span> -1px<span class="token punctuation">;</span><span class="token property">border-right</span><span class="token punctuation">:</span> 0px solid #999<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨è§£å†³æ ‡å·å’Œ code æ²¡å¯¹é½çš„é—®é¢˜ï¼Œä¿®æ”¹ prism.css æ–‡ä»¶ä¸­ <code>.line-numbers .line-numbers-rows</code> ä¸‹ top å‚æ•°ä¸º -0.2emï¼Œå¾®è°ƒæˆåŠŸï¼æ²»å¥½äº†å¼ºè¿«ç—‡ï¼</p><h3 id="æ¸²æŸ“è¡¨æ ¼"><a href="#æ¸²æŸ“è¡¨æ ¼" class="headerlink" title="æ¸²æŸ“è¡¨æ ¼"></a>æ¸²æŸ“è¡¨æ ¼</h3><p>hexo å¯¹è¡¨æ ¼çš„æ¸²æŸ“ä¸ typora æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ­£æ–‡å’Œè¡¨æ ¼éœ€è¦é—´éš”ä¸¤è¡Œã€‚è€Œä¸” hexo å¹¶ä¸ä¼šæ˜¾ç¤ºåŒæ‹¬å·ï¼Œå»ºè®®ä½¿ç”¨ä»£ç æ ¼å¼å¼•ç”¨åŒæ‹¬å· <code>{{}}</code></p><h2 id="é…ç½®-theme-ä¸­çš„-config-yml"><a href="#é…ç½®-theme-ä¸­çš„-config-yml" class="headerlink" title="é…ç½® theme ä¸­çš„ _config.yml"></a>é…ç½® theme ä¸­çš„ _config.yml</h2><ol><li><p>æ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„æ³¨é‡Šï¼Œç®€å•ä¿®æ”¹äº†ä¸‹é¢çš„è®¾ç½®</p><p>dream, music, video, recommend, github &amp; social link, reward, clicklove, myProjects, mySkills, subtitle, banner</p></li><li><p>å–æ¶ˆ rainbow ç‰¹æ•ˆ</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.bg-cover:after</span> <span class="token punctuation">{</span>    <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨ hexo d æ—¶é‡åˆ°é—®é¢˜</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">err: Error: Spawn failed<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç¬¬äºŒå¤©è‡ªåŠ¨å¥½äº†ï¼Œæ ¹æœ¬åŸå› æ˜¯ç½‘ç»œæ²¡æœ‰èµ°é€šçš„é—®é¢˜ï¼Œä¹‹åå¯èƒ½å†æ¬¡é‡åˆ°ï¼Œåˆ°æ—¶å€™å†è§£å†³ï¼Œå»ºè®®åœ¨ github ä¸Šæœç´¢</p><p>ç°åœ¨å‘ç°äº†ï¼Œç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯ root ç”¨æˆ·ä¸‹çš„ git é…ç½®ï¼Œè€Œæˆ‘ root ç”¨æˆ·ä¸‹ git config æ²¡æœ‰è®¾ç½®å¥½å‚æ•°æ‰€ä»¥éƒ¨ç½²å¤±è´¥ã€‚æˆ‘åœ¨ root ç›®å½•çš„ .gitconfig å’Œ .ssh ä¸‹é…ç½®å¥½äº† user.name ssh ç­‰å¿…è¦ git é…ç½®å°±æˆåŠŸäº†ã€‚è¿™è¯´æ˜äº†åœ¨ linux ä¸‹ä¸åŒçš„ç”¨æˆ·éƒ½éœ€è¦è‡ªå·±å»é…ç½® git</p></li><li><p>ä¿®æ”¹åšå®¢ feature image åªé€‰ç”¨1å¼ ç®€å•å›¾æ¥ä»£è¡¨ã€‚åŸæ¥æœ‰ 24 å¼ å›¾ï¼Œæˆ‘æŠŠ24ä¸ªè·¯å¾„å…¨éƒ¨æ”¹ä¸ºåŒ1å¼ å›¾ã€‚</p></li><li><p>å› ä¸ºä¹‹åéœ€è¦å†™å…¥æ•°å­¦å…¬å¼ï¼Œå°† mathjax æ”¹ä¸º trueã€‚ä½†å‘ç°æ˜¾ç¤ºå…¬å¼æ¸²æŸ“ä¸æ­£å¸¸ï¼Œè€Œä¸”å°æ‹¬å·æ˜¾ç¤ºä¸å‡ºæ¥ã€‚æ ¹æ® <a href="https://github.com/blinkfox/hexo-theme-matery/issues/119">github issue</a> è§£å†³æ— æ³•æ¢è¡Œé—®é¢˜ï¼Œå°†æ¸²æŸ“å™¨æ¢ä¸º hexo-renderer-kramed è€Œä¸”ä»£ç é«˜äº®æ’ä»¶ä¼¼ä¹å¹¶æ²¡å—åˆ°å½±å“ã€‚æ ¹æ® <a href="https://adaning.github.io/posts/33457.html">MathJaxå¸¸è§é—®é¢˜</a> è§£å†³å°æ‹¬å·æ— æ³•æ˜¾ç¤ºé—®é¢˜ã€‚æ ¹æ® <a href="https://www.jianshu.com/p/7ab21c7f0674">åšå®¢</a> å†è¿›ä¸€æ­¥é…ç½® kramed æ¸²æŸ“ï¼Œè§£å†³å¤§æ‹¬å·çš„å†²çªé—®é¢˜ã€‚ä¹Ÿé‡åˆ°è¿‡æœ¬åœ° <code>hexo s</code> èƒ½å¤Ÿæ¸²æŸ“å…¬å¼ï¼Œä½†æ˜¯ <code>hexo d</code> éƒ¨ç½²åå…¬å¼æ— æ³•æ¸²æŸ“çš„æƒ…å†µï¼Œæ ¹æ® <a href="https://blog.csdn.net/qq_44846324/article/details/114582328">åšå®¢</a> ä¸­è§£å†³è¯­ä¹‰å†²çªè§£å†³é—®é¢˜</p></li></ol><h2 id="é…ç½®-matery-css"><a href="#é…ç½®-matery-css" class="headerlink" title="é…ç½® matery.css"></a>é…ç½® matery.css</h2><p>ä¸ºäº†è¿›ä¸€æ­¥è®¾ç½®æˆ‘ä»¬çš„ç½‘é¡µï¼Œè®©å…¶æ›´å…·æœ‰ä¸ªæ€§åŒ–ï¼Œå°±éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´ matery.css æ–‡ä»¶ã€‚</p><ol><li><p>è®¾ç½® å¯¼èˆªé¢œè‰²</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.bg-color</span> <span class="token punctuation">{</span>    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #BEBEBE 0%<span class="token punctuation">,</span> #708090 100%<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æŸ¥è¯¢é¢œè‰²ä»£ç ç½‘å€ï¼š<a href="https://tool.oschina.net/commons?type=3">https://tool.oschina.net/commons?type=3</a></p></li><li><p>ç”±äºåˆšå¼€å§‹åŠ è½½æ—¶ banner å›¾ç‰‡æ²¡æœ‰è¿…é€ŸåŠ è½½ï¼Œä¼šé»˜è®¤å…ˆåŠ è½½æ©™è‰²ï¼Œæˆ‘æ”¹æˆç°è‰²</p><p>ä¿®æ”¹â€œ\Hexo\themes\hexo-theme-matery\layout\ _partial\index-cover.ejsâ€æ–‡ä»¶ä¸­çš„ç¬¬63è¡Œå³å¯ã€‚</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>carousel-item red white-text bg-cover about-cover<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŠŠâ€œredâ€ä¿®æ”¹ä¸ºå…¶ä»–é¢œè‰²å³å¯ã€‚æˆ‘æ”¹ä¸º slate gray</p></li><li><p>æ”¹å˜ progress-bar é¢œè‰²</p></li><li><p>æ”¹å˜å›åˆ°é¡¶éƒ¨æŒ‰é’®é¢œè‰² top-scroll</p></li><li><p>æ”¹å˜å°é¢æ‰“å­—æ•ˆæœçš„æ–‡å­—å¤§å°ã€é¢œè‰² .bg-cover .description</p></li><li><p>ä¿®æ”¹äº†æ‰“å­—æ•ˆæœçš„é¢œè‰²è¿‡åï¼Œæˆ‘å‘ç°æ–‡ç« æ ‡é¢˜çš„é¢œè‰²ä¹Ÿè·Ÿç€æ”¹äº†ã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨ä¸‹é¢çš„ .bg-cover .description å¢åŠ å±æ€§ color: #color_codeï¼Œè¿™æ ·å°±èƒ½åˆ†åˆ«è°ƒæ•´å®ƒä»¬çš„é¢œè‰²ã€‚</p></li><li><p>ä¿®æ”¹ about é¡µé¢é“¾æ¥é¢œè‰² aboutme</p></li><li><p>ä¿®æ”¹ archive é¡µé¢æ—¶é—´çº¿é¢œè‰² cd-timeline</p></li></ol><h2 id="æ’ä»¶ä¼˜åŒ–"><a href="#æ’ä»¶ä¼˜åŒ–" class="headerlink" title="æ’ä»¶ä¼˜åŒ–"></a>æ’ä»¶ä¼˜åŒ–</h2><h3 id="æ–‡ç« -url-ä¼˜åŒ–"><a href="#æ–‡ç« -url-ä¼˜åŒ–" class="headerlink" title="æ–‡ç«  url ä¼˜åŒ–"></a>æ–‡ç«  url ä¼˜åŒ–</h3><p>æˆ‘æ²¡æœ‰ä½¿ç”¨é¡¹ç›®ä¸­ä¸»è¦ä»‹ç»çš„è½¬æ‹¼éŸ³æ–¹æ³•ï¼Œé‚£æ ·ç”Ÿæˆçš„é“¾æ¥å¤ªé•¿äº†ï¼Œè€Œæ˜¯ä½¿ç”¨ hexo-abbrlink æ’ä»¶</p><pre class="line-numbers language-sehll" data-language="sehll"><code class="language-sehll">npm install hexo-abbrlink --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨æ ¹ç›®å½• _config.yml æ–‡ä»¶ä¸­ä¿®æ”¹</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">permalink</span><span class="token punctuation">:</span> archives/<span class="token punctuation">:</span>abbrlink.html<span class="token key atrule">abbrlink</span><span class="token punctuation">:</span>    <span class="token key atrule">alg</span><span class="token punctuation">:</span> crc32   <span class="token comment">#ç®—æ³•ï¼š crc16(default) and crc32</span>    <span class="token key atrule">rep</span><span class="token punctuation">:</span> hex     <span class="token comment">#è¿›åˆ¶ï¼š dec(default) and hex</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ hexo ä¸‰è¿æ—¶é‡åˆ°æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">FATAL YAMLException: duplicated mapping key <span class="token punctuation">(</span><span class="token number">111</span>:1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¯´æ˜æœ‰åŸé…ç½®æ–‡ä»¶ä¸­å·²ç»æœ‰ permalink çš„å®šä¹‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé‡Œæœ¬èº«çš„ permalink ä»£ç æ³¨é‡Šæ‰ï¼Œå®Œç¾è¿è¡Œï¼ç°åœ¨æˆ‘ä»¬çš„æ–‡ç«  url æœ€åæ˜¯ç‰¹æ®Šçš„æ•°å­—id <code>/archives/48732.html</code></p><h3 id="æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶"><a href="#æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶" class="headerlink" title="æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶"></a>æ–‡ç« å­—æ•°ç»Ÿè®¡æ’ä»¶</h3><h3 id="æ·»åŠ -emoji-è¡¨æƒ…æ”¯æŒ"><a href="#æ·»åŠ -emoji-è¡¨æƒ…æ”¯æŒ" class="headerlink" title="æ·»åŠ  emoji è¡¨æƒ…æ”¯æŒ"></a>æ·»åŠ  emoji è¡¨æƒ…æ”¯æŒ</h3><h3 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h3><p>ä¸Šé¢ä¸‰ä¸ªéƒ¨åˆ†éƒ½æ˜¯æŒ‰ç…§ hexo-thme-matery github é¡¹ç›®é…ç½®çš„</p><h3 id="è¯„è®ºæ’ä»¶utterance"><a href="#è¯„è®ºæ’ä»¶utterance" class="headerlink" title="è¯„è®ºæ’ä»¶utterance"></a>è¯„è®ºæ’ä»¶utterance</h3><p>matery åœ¨é…ç½®æ–‡ä»¶ä¸­å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ‰çš„è¯„è®ºè½¯ä»¶æœ‰å®‰å…¨éšæ‚£ï¼Œæ¨èä½¿ç”¨ utterance</p><p>å°è¯• utteranceï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›å¸è½½ valineï¼Œæ³¨é”€ lean cloud</p><p>ä¹Ÿå°è¯•äº† livere å®‰è£…ä¹Ÿå¾ˆä¸å‹å¥½</p><p>æˆåŠŸåœ¨ contact é¡µé¢ä¸‹å±•ç¤ºäº† utteranceï¼Œæ–¹æ³•æ˜¯åœ¨ contact.ejs æ–‡æ¡£ä¸‹æ‰¾äº†ä¸€ä¸ªåœ°æ–¹æ’å…¥ä¸‹é¢çš„ä»£ç ï¼ˆè®°å¾—æ”¹ä¸º rè‡ªå·±çš„ github repoï¼Œå½¢å¼ä¸º <owner>/<name> ï¼‰ï¼Œ</name></owner></p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://utteranc.es/client.js<span class="token punctuation">"</span></span><span class="token attr-name">repo</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[ENTER REPO HERE]<span class="token punctuation">"</span></span><span class="token attr-name">issue-term</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pathname<span class="token punctuation">"</span></span><span class="token attr-name">theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>github-light<span class="token punctuation">"</span></span><span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>anonymous<span class="token punctuation">"</span></span><span class="token attr-name">async</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘æ’å…¥åœ¨ <code>&lt;div class="card"&gt;</code> åé¢ï¼Œæ˜¯ç®¡ç”¨çš„ã€‚å› ä¸ºåŸé¡¹ç›®è¯´ï¼Œæ’å…¥åˆ°ä½ çš„ layout éœ€è¦å‡ºç°çš„åœ°æ–¹ï¼Œæˆ‘ä¸æ‡‚å‰ç«¯çš„ä»£ç ï¼Œåªèƒ½èƒ¡ä¹±æ’å…¥äº†ï¼Œç®¡ç”¨å°±è¡Œï¼æˆ‘çŒœæµ‹è¿™æ˜¯ä¸€ä¸ªâ€œå¡ç‰‡ç±»â€èƒ½å¤Ÿå­˜æ”¾ä½ çš„å†…å®¹ï¼Œä»¥ç™½è‰²å¡ç‰‡åœ¨é¡µé¢ä¸­å±•ç¤ºå‡ºæ¥ã€‚</p><p>ç”¨åŒæ ·çš„æ–¹æ³•åœ¨ post ä¸‹æ·»åŠ è¯„è®ºã€‚æ‰¾åˆ° <code>/hexo-theme-matery/layout/_partial/post-detail.ejs</code> æ–‡ä»¶ï¼Œæ‰¾åˆ°è¯„è®ºçš„å¸ƒå±€ä¹‹å¤„ï¼ˆæœç´¢ä¸»é¢˜è‡ªå¸¦çš„è¯„è®ºæ’ä»¶å¦‚ gittalkï¼Œå°±èƒ½æ‰¾åˆ°ï¼‰æ’å…¥ä¸Šé¢çš„ä»£ç å³å¯ã€‚ä½†æ˜¯æ¸²æŸ“è¿‡åèƒŒæ™¯æ˜¯é€æ˜çš„ï¼Œä¸å¤ªå¥½çœ‹ï¼Œæˆ‘å¸Œæœ›æƒ³ contact ä¸€æ ·æœ‰ç™½è‰²èƒŒæ™¯ï¼Œé‚£å°±å¤åˆ¶ä¸€ä¸‹ contact.ejs ä¸­çš„â€œå¡ç‰‡ç±»â€è¯„è®ºåŒºå°±è¡Œäº†ã€‚</p><h3 id="åˆ†ç±»ä¼˜åŒ–"><a href="#åˆ†ç±»ä¼˜åŒ–" class="headerlink" title="åˆ†ç±»ä¼˜åŒ–"></a>åˆ†ç±»ä¼˜åŒ–</h3><p>matery ä¸»é¢˜çš„åˆ†ç±»æ²¡æœ‰å¤šå±‚åˆ†ç±»ï¼Œåœ¨ categories é¡µé¢åªæœ‰åƒ tag ä¸€æ ·æ ‡ç­¾ï¼Œè¿™æ ·çš„åˆ†ç±»åˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæ ¹æ® <a href="https://notes.zhangxiaocai.cn/posts/5a99eb4d.html#toc-heading-8">Hexo Matery ä¸»é¢˜æ·»åŠ å¤šçº§åˆ†ç±»</a> è¿›è¡Œè®¾ç½®ï¼Œå¯ä»¥å¾—åˆ°æ›´å¥½çš„åˆ†ç±»é¡µï¼Œç±»åˆ«ä¹‹é—´å°†æœ‰å±‚æ¬¡å…³ç³»</p><p>å…·ä½“æ¥è®²ï¼Œé‡‡ç”¨äº†åšå®¢é‡Œæœ€æ–°æ›´æ–°çš„ä»£ç ï¼Œåˆä½œäº†ä»¥ä¸‹æ”¹åŠ¨ï¼š</p><ol><li><p>ç»™ category-item, category-count ç­‰å¢åŠ  color å±æ€§ï¼Œæ”¹ä¸ºè‡ªå·±å–œæ¬¢çš„é¢œè‰²</p></li><li><p>ç»™ category-title å¢åŠ  font-size å±æ€§ï¼Œä¿®æ”¹æ ‡é¢˜å¤§å°</p></li><li><p>ç”±äºæ¯æ¬¡è¿›å…¥ç›®å½•é»˜è®¤è¦å±•å¼€ä¸€ä¸ªç±»åˆ«ï¼Œæ”¹åŠ¨ä¸‹æ–¹ä»£ç ï¼Œè®©æ‰€æœ‰ç±»åˆ«åˆå§‹çŠ¶æ€é»˜è®¤æŠ˜å </p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* origin code: &lt;li  class="&lt;%= subCats.length &gt; 0 ? 'active' : '' %&gt;" &gt; */</span><span class="token operator">&lt;</span>li  <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"&lt;%= subCats.length &gt; 10000 ? 'active' : '' %&gt;"</span> <span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>åˆ é™¤ç®­å¤´å˜åŒ– <code>category-item-action col s11 m11</code></p></li></ol><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><h3 id="ç½‘ç«™SEOä¼˜åŒ–"><a href="#ç½‘ç«™SEOä¼˜åŒ–" class="headerlink" title="ç½‘ç«™SEOä¼˜åŒ–"></a>ç½‘ç«™SEOä¼˜åŒ–</h3><p>Search Engine Optimization</p><p>å°†è‡ªå·±çš„ç½‘ç«™æäº¤ç»™æœç´¢å¼•æ“</p><h3 id="ä¸æ–­æ›´æ–°"><a href="#ä¸æ–­æ›´æ–°" class="headerlink" title="ä¸æ–­æ›´æ–°"></a>ä¸æ–­æ›´æ–°</h3><p>æŒç»­æ›´æ–°åšå®¢å†…å®¹ï¼Œå®Œå–„åˆ†ç±»</p>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶ </category>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> åšå®¢æ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„åšå®¢æ­å»ºç¬”è®°</title>
      <link href="/archives/4984.html"/>
      <url>/archives/4984.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ªäººåšå®¢æ­å»º-hexo"><a href="#ä¸ªäººåšå®¢æ­å»º-hexo" class="headerlink" title="ä¸ªäººåšå®¢æ­å»º hexo"></a>ä¸ªäººåšå®¢æ­å»º hexo</h1><p>æ•´ä½“å‚è€ƒè¿‡ç¨‹ä¸º CodeSheep è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1Yb411a7ty">https://www.bilibili.com/video/BV1Yb411a7ty</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="Node-js-amp-npm"><a href="#Node-js-amp-npm" class="headerlink" title="Node.js &amp; npm"></a>Node.js &amp; npm</h3><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://developer.aliyun.com/article/760687">https://developer.aliyun.com/article/760687</a></p><p>æˆ‘é€‰æ‹©äº† apt å®‰è£…</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nodejs <span class="token function">npm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç‰ˆæœ¬ä¿¡æ¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">nodejs --versionv10.19.0<span class="token function">npm</span> --version<span class="token number">6.14</span>.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç‰ˆæœ¬è¿˜æ˜¯æœ‰ç‚¹è€æ—§</p><h3 id="æ·˜å®é•œåƒ-cnpm"><a href="#æ·˜å®é•œåƒ-cnpm" class="headerlink" title="æ·˜å®é•œåƒ cnpm"></a>æ·˜å®é•œåƒ cnpm</h3><p>cnpm çš„å®˜æ–¹ä»‹ç»æ˜¯ï¼šcnpmæ˜¯ä¸€ä¸ªå®Œæ•´ npmjs.or é•œåƒï¼Œä½ å¯ä»¥ç”¨æ­¤ä»£æ›¿å®˜æ–¹ç‰ˆæœ¬(åªè¯»)ï¼ŒåŒæ­¥é¢‘ç‡ç›®å‰ä¸º <strong>10åˆ†é’Ÿ</strong> ä¸€æ¬¡ä»¥ä¿è¯å°½é‡ä¸å®˜æ–¹æœåŠ¡åŒæ­¥ã€‚</p><p>å®‰è£…äº† cnpm å°±å¯ä»¥ä½¿ç”¨é•œåƒèµ„æºä¸‹è½½åŒ…ï¼Œå¦‚æœä¸å¸Œæœ›ä½¿ç”¨é•œåƒèµ„æºåˆ™æ¢å› npm å‘½ä»¤å³å¯ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> -g cnpm --registry<span class="token operator">=</span>https://registry.npm.taobao.org<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> cnpm <span class="token function">install</span> -g hexo-cli<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç‰ˆæœ¬ä¿¡æ¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo -vhexo-cli: <span class="token number">4.3</span>.0os: linux <span class="token number">5.4</span>.0-77-generic Ubuntu <span class="token number">20.04</span>.2 LTS <span class="token punctuation">(</span>Focal Fossa<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="æ­å»ºåšå®¢"><a href="#æ­å»ºåšå®¢" class="headerlink" title="æ­å»ºåšå®¢"></a>æ­å»ºåšå®¢</h2><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> blog <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> blog<span class="token function">sudo</span> hexo init<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœå“ªé‡Œå‡ºé”™äº†ï¼Œæƒ³é‡æ¥ï¼Œç›´æ¥åˆ é™¤ blog æ–‡ä»¶å¤¹å³å¯</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‡åˆ°æŠ¥é”™</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">INFO  Validating configINFO  Start processingFATAL <span class="token punctuation">{</span> err:   TypeError: line.matchAll is not a <span class="token keyword">function</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åŸå› åœ¨äº nodejs ç‰ˆæœ¬å¤ªä½ï¼Œå°è¯•ä½¿ç”¨ n å‡çº§ nodejs</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> -g n<span class="token function">sudo</span> n latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æŸ¥çœ‹ç‰ˆæœ¬</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">node -vv16.4.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æˆåŠŸå¯åŠ¨ hexo serverï¼Œä½ å¯ä»¥é€šè¿‡ <a href="http://localhost:4000">http://localhost:4000</a> è®¿é—®ä½ çš„æœ¬åœ°åšå®¢å•¦ï¼</p><h3 id="å†™ç¬¬ä¸€ç¯‡æ–‡ç« "><a href="#å†™ç¬¬ä¸€ç¯‡æ–‡ç« " class="headerlink" title="å†™ç¬¬ä¸€ç¯‡æ–‡ç« "></a>å†™ç¬¬ä¸€ç¯‡æ–‡ç« </h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> hexo new <span class="token string">'Fisrt Blog'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¿¡æ¯</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">INFO  Validating configINFO  Created: /home/declan/Documents/blog/source/_posts/First-Blog.md<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä½ çš„æ–‡ç« ä½ç½®åœ¨ä¸Šé¢çš„è·¯å¾„ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå¯ä»¥é€šè¿‡ markdown è¯­æ³•è¿›è¡Œä¹¦å†™</p><h3 id="ç”Ÿæˆ"><a href="#ç”Ÿæˆ" class="headerlink" title="ç”Ÿæˆ"></a>ç”Ÿæˆ</h3><p>æ¸…ç†ä¸€äº›ç¼“å­˜ï¼Œç„¶åç”Ÿæˆæˆ‘ä»¬çš„é¡µé¢ï¼ŒåŒæ ·ä½¿ç”¨ hexo server ä»æœ¬åœ°æŸ¥çœ‹æ•ˆæœ</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hexo cleanhexo generatehexo server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="å¸ƒå±åˆ°è¿œç«¯"><a href="#å¸ƒå±åˆ°è¿œç«¯" class="headerlink" title="å¸ƒå±åˆ°è¿œç«¯"></a>å¸ƒå±åˆ°è¿œç«¯</h2><h3 id="github"><a href="#github" class="headerlink" title="github"></a>github</h3><p>åœ¨ github æ–°å»ºä»“åº“ name.github.io nameä¸€å®šè¦æ˜¯ä½ çš„ github ç”¨æˆ·å</p><p>åœ¨ blog ç›®å½•ä¸‹ï¼Œä¸‹è½½ git deployer</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> cnpm <span class="token function">install</span> --save hexo-deployer-git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="è®¾ç½®-config-yml"><a href="#è®¾ç½®-config-yml" class="headerlink" title="è®¾ç½® _config.yml"></a>è®¾ç½® _config.yml</h3><p>åœ¨ blog ç›®å½•ä¸‹æ‰“å¼€ _config.yml æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ€åçš„ # Deployments ä¸Šä¿®æ”¹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># Deployment</span><span class="token comment">## Docs: https://hexo.io/docs/one-command-deployment</span>deploy:  type: <span class="token string">'git'</span>  repo: https://github.com/DeclK/declk.github.io.git  branch: master<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Deploy"><a href="#Deploy" class="headerlink" title="Deploy"></a>Deploy</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç°åœ¨ä½ çš„ä»“åº“é‡Œå¤šäº†ä¸€äº›æ–‡ä»¶</p><p>ä»¥åä½ å°±å¯ä»¥é€šè¿‡ä½ çš„ä»“åº“å <em>*</em>.github.io æ¥è®¿é—®ä½ çš„åšå®¢å•¦ï¼</p><h2 id="æ›´æ¢ä¸»é¢˜"><a href="#æ›´æ¢ä¸»é¢˜" class="headerlink" title="æ›´æ¢ä¸»é¢˜"></a>æ›´æ¢ä¸»é¢˜</h2><p>åœ¨å¯»æ‰¾äº†è®¸ä¹…è¿‡åå†³å®šä½¿ç”¨ <a href="https://github.com/blinkfox/hexo-theme-matery">hexo-theme-matery</a></p><h2 id="å¯ç§»æ¤æ€§"><a href="#å¯ç§»æ¤æ€§" class="headerlink" title="å¯ç§»æ¤æ€§"></a>å¯ç§»æ¤æ€§</h2><p>å¦‚æœæŠŠ hexo æ•´ä¸ªåšå®¢é¡¹ç›®ç§»åˆ°å¦ä¸€å°ç”µè„‘ä¸Šï¼Œä¾ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›å°å›°éš¾ï¼Œä½†æ˜¯æ ¹æ® hexo çš„æç¤ºå‘½ä»¤ï¼Œå¾ˆå¿«å°±èƒ½è§£å†³</p>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶ </category>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> åšå®¢æ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
